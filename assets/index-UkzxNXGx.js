import{e as Y,u as W,b as F,c as w,j as e,d as a,r as x,i as X,f as J,_ as L,t as v}from"./index-CQs3wXys.js";import{E as Z}from"./EmptyState-DNkTeHW1.js";import{T as ee}from"./TablePagination-DIiSuGph.js";import{u as k}from"./useMutation-D9dT1mhA.js";import{u as N}from"./useQuery-DrwXjJzc.js";import{u as se}from"./useConfirm-9PPCxKmU.js";import{u as te}from"./formik.esm-C_3GEhhV.js";import{c as re,a as y,e as oe}from"./index.esm-85kEx3I1.js";import{S as ne}from"./SidePanelFormButtons-CTKwSU1t.js";import{g as ae,r as A,U as I,a as ce}from"./helpers-BS8e34QL.js";import{c as ie}from"./PageMain-BTzMuvvj.js";function Q(){const n=Y(),t=W(),r=F(),i=(o,p={})=>N({queryKey:["users",{...o}],queryFn:()=>n.get("users",{params:o}),...p}),m=k({mutationKey:["users","new"],mutationFn:o=>n.post("users",o),onSuccess:()=>{t.invalidateQueries(["users"]).catch(r)}}),l=k({mutationKey:["users","edit"],mutationFn:o=>n.put("users",o),onSuccess:()=>{t.invalidateQueries(["users"]).catch(r)}}),c=k({mutationKey:["users","remove"],mutationFn:o=>n.delete("users",{params:o}),onSuccess:()=>{t.invalidateQueries(["users"]).catch(r)}}),d=k({mutationKey:["users","lock"],mutationFn:o=>n.post("users/lock",o),onSuccess:()=>{t.invalidateQueries(["users"]).catch(r)}}),h=k({mutationKey:["users","unlock"],mutationFn:o=>n.post("users/unlock",o),onSuccess:()=>{t.invalidateQueries(["users"]).catch(r)}}),b=(o,p={})=>N({queryKey:["groups",o.computer_id],queryFn:()=>n.get(`computers/${o.computer_id}/groups`),...p}),g=(o,p={})=>N({queryKey:["userGroups",o.computer_id,o.username],queryFn:()=>n.get(`computers/${o.computer_id}/users/${o.username}/groups`),...p}),s=k({mutationKey:["groups","add"],mutationFn:o=>n.post(`computers/${o.computer_id}/usergroups/update_bulk`,o),onSuccess:()=>{t.invalidateQueries(["users"]).catch(r)}}),u=k({mutationKey:["groups","remove"],mutationFn:o=>n.post(`computers/${o.computer_id}/usergroups/update_bulk`,o),onSuccess:()=>{t.invalidateQueries(["users"]).catch(r)}});return{getUsersQuery:i,getGroupsQuery:b,getUserGroupsQuery:g,createUserQuery:m,removeUserQuery:c,editUserQuery:l,lockUserQuery:d,unlockUserQuery:h,addUserToGroupQuery:s,removeUserFromGroupQuery:u}}const ue="_headerContainer_j1328_1",le="_searchContainer_j1328_6",B={headerContainer:ue,searchContainer:le},E=({instanceId:n})=>{const t=F(),{closeSidePanel:r}=w(),{createUserQuery:i,getGroupsQuery:m}=Q(),{mutateAsync:l,isLoading:c}=i,{data:d,isLoading:h}=m({computer_id:n}),g=((d==null?void 0:d.data.groups)??[]).map(u=>({label:u.name,value:u.name})),s=te({initialValues:{name:"",username:"",password:"",confirmPassword:"",requirePasswordReset:!1,location:"",homePhoneNumber:"",workPhoneNumber:"",primaryGroupValue:""},validationSchema:re().shape({name:y().required("This field is required"),username:y().required("This field is required"),password:y().required("This field is required"),confirmPassword:y().required("This field is required").oneOf([oe("password"),""],"Passwords must match"),location:y(),homePhoneNumber:y(),workPhoneNumber:y(),primaryGroupValue:y().required("This field is required")}),onSubmit:async u=>{try{await l({computer_ids:[n],name:u.name,username:u.username,password:u.password,require_password_reset:u.requirePasswordReset,location:u.location,home_phone:u.homePhoneNumber,work_phone:u.workPhoneNumber,primary_groupname:u.primaryGroupValue}),r()}catch(o){t(o)}}});return e.jsxs(a.Form,{noValidate:!0,onSubmit:s.handleSubmit,name:"add-new-user",children:[e.jsx(a.Input,{type:"text",label:"Username",autoComplete:"new-username",required:!0,error:s.touched.username&&s.errors.username?s.errors.username:void 0,...s.getFieldProps("username")}),e.jsx(a.Input,{type:"text",label:"Name",required:!0,error:s.touched.name&&s.errors.name?s.errors.name:void 0,...s.getFieldProps("name")}),e.jsx(a.Input,{type:"password",label:"Passphrase",autoComplete:"new-password",required:!0,error:s.touched.password&&s.errors.password?s.errors.password:void 0,...s.getFieldProps("password")}),e.jsx(a.Input,{type:"password",label:"Confirm passphrase",autoComplete:"new-password",required:!0,error:s.touched.confirmPassword&&s.errors.confirmPassword?s.errors.confirmPassword:void 0,...s.getFieldProps("confirmPassword")}),e.jsx(a.Input,{type:"checkbox",label:"Require passphrase reset",help:"User must change password at first login",...s.getFieldProps("requirePasswordReset"),checked:s.values.requirePasswordReset}),e.jsx(a.Select,{label:"Primary Group",disabled:h,options:[{label:"Select",value:""},...g],...s.getFieldProps("primaryGroupValue"),error:s.touched.primaryGroupValue&&s.errors.primaryGroupValue?s.errors.primaryGroupValue:void 0}),e.jsx(a.Input,{type:"text",label:"Location",error:s.touched.location&&s.errors.location?s.errors.location:void 0,...s.getFieldProps("location")}),e.jsx(a.Input,{type:"text",label:"Home phone",error:s.touched.homePhoneNumber&&s.errors.homePhoneNumber?s.errors.homePhoneNumber:void 0,...s.getFieldProps("homePhoneNumber")}),e.jsx(a.Input,{type:"text",label:"Work phone",error:s.touched.workPhoneNumber&&s.errors.workPhoneNumber?s.errors.workPhoneNumber:void 0,...s.getFieldProps("workPhoneNumber")}),e.jsx(ne,{submitButtonDisabled:c,submitButtonText:"Add user"})]})},de="_cta_hpksw_1",me={cta:de},pe=({instanceId:n,selectedUsers:t,setSelected:r,handleEditUser:i})=>{const[m,l]=x.useState(!1),c=t.length===1?t[0]:void 0,{locked:d,unlocked:h}=ae(t),b=ie("(min-width: 620px)"),g=F(),{notify:s}=X(),{setSidePanelContent:u,closeSidePanel:o}=w(),{confirmModal:p,closeConfirmModal:$}=se(),{removeUserQuery:f,lockUserQuery:_,unlockUserQuery:P}=Q(),{mutateAsync:j}=f,{mutateAsync:U}=_,{mutateAsync:M}=P,C=async(S,q)=>{try{await S({computer_ids:[n],usernames:ce(t),delete_home:q==="removed"?m:void 0}),r&&r([]),o(),s.success({message:`Successfully requested to be ${q}`})}catch(H){g(H)}finally{$()}},T=async()=>{await C(U,"locked")},G=async()=>{await C(M,"unlocked")},V=async()=>{await C(j,"removed")},K=()=>{u("Add new user",e.jsx(E,{instanceId:n}))},R=async()=>{p({title:`Delete ${c?c.username:"users"}`,body:e.jsxs("div",{children:[e.jsx("p",{className:"u-no-margin--bottom",children:c?`This will delete user ${c.username}. You can delete this user's home folders at the same time`:"This will delete selected users. You can delete their home folders as well"}),e.jsx(a.Input,{label:"Delete the home folders as well",type:"checkbox",onChange:()=>l(S=>!S)})]}),buttons:[e.jsx(a.Button,{appearance:"negative",onClick:V,children:"Delete"},"remove")]})},O=async()=>{p({title:`Lock ${c?`user ${c.username}`:`${t.length} users`}`,body:A({user:c,selectedUsers:t,userAction:I.Lock}),buttons:[e.jsx(a.Button,{appearance:"positive",onClick:T,children:"Lock"},"lock")]})},z=async()=>{p({title:`Unlock ${c?`user ${c.username}`:`${t.length} users`}`,body:A({user:c,selectedUsers:t,userAction:I.Unlock}),buttons:[e.jsx(a.Button,{appearance:"positive",onClick:G,children:"Unlock"},"unlock")]})};return e.jsxs("div",{className:J("p-panel__controls u-no-padding--top",{"u-no-margin--left":i,[me.cta]:r&&b}),children:[r&&e.jsxs(a.Button,{hasIcon:!0,onClick:K,className:"u-no-margin--right",children:[e.jsx(a.Icon,{name:"plus"}),e.jsx("span",{children:"Add user"})]}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[((c==null?void 0:c.enabled)||r)&&e.jsxs(a.Button,{disabled:h===0,onClick:O,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"lock-locked"}),e.jsx("span",{children:"Lock"})]}),(!(c!=null&&c.enabled)||r)&&e.jsxs(a.Button,{disabled:d===0,onClick:z,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlock"})]}),i&&c&&e.jsxs(a.Button,{onClick:()=>i(c),className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(a.Button,{disabled:t.length===0,onClick:R,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"delete"}),e.jsx("span",{children:"Delete"})]})]})})]})},he=(n,t)=>n.filter(r=>t.includes(r.uid)),ge=({instanceId:n,onPageChange:t,onSearch:r,selected:i,setSelected:m,users:l})=>{const[c,d]=x.useState(""),h=(s=c)=>{r(s),t(1)},b=()=>{d(""),h("")},g=s=>{s.preventDefault(),h()};return e.jsxs("div",{className:B.headerContainer,children:[e.jsx("div",{className:B.searchContainer,children:e.jsx(a.Form,{onSubmit:g,noValidate:!0,children:e.jsx(a.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,"aria-label":"User search",value:c,onChange:s=>{d(s)},className:"u-no-margin--bottom",onClear:b})})}),e.jsx(pe,{instanceId:n,setSelected:m,selectedUsers:he(l,i)})]})},xe="_status_1n2s0_1",be="_actions_1n2s0_7",D={status:xe,actions:be},je=x.lazy(()=>L(()=>import("./index-BSgYrUgA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))),ye=x.lazy(()=>L(()=>import("./index-k2FtxY_l.js"),__vite__mapDeps([21,1,2,22,23,11,12,13,14,15,16,17,3,4,5,6,7,18,19,20]))),ke=({instanceId:n,users:t,selected:r,setSelected:i})=>{const{setSidePanelContent:m}=w(),l=s=>{m("Edit user",e.jsx(x.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(je,{instanceId:n,user:s})}))},c=s=>{m("User details",e.jsx(x.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(ye,{user:s,instanceId:n,handleEditUser:l})}))},d=()=>{i(r.length!==0?[]:t.map(({uid:s})=>s))},h=s=>{r.includes(s.uid)?i(r.filter(u=>u!==s.uid)):i([...r,s.uid])},b=[{content:e.jsxs(e.Fragment,{children:[e.jsx(a.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),checked:r.length===t.length&&t.length>0,onChange:d,indeterminate:r.length>0&&r.length<t.length}),e.jsx("span",{children:"USERNAME"})]})},{content:"Status",sortKey:"status"},{content:"UID"},{content:"Full Name"},{content:""}],g=t.map(s=>({columns:[{content:e.jsxs(e.Fragment,{children:[e.jsx(a.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:`Select user ${s.username}`}),checked:r.includes(s.uid),onChange:()=>h(s)}),e.jsx(a.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{c(s)},"aria-label":`Show details of user ${s.username}`,children:s.username})]}),role:"rowheader","aria-label":`User ${s.username}`},{content:e.jsx("div",{className:D.status,children:s.enabled?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"p-icon--lock-unlock"}),e.jsx("span",{children:"Unlocked"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"p-icon--lock-locked-active"}),e.jsx("span",{children:"Locked"})]})}),"aria-label":`User ${s.username} status`},{content:s.uid,"aria-label":"uid"},{content:s.name?s.name:"-","aria-label":"full name"},{className:D.actions,content:e.jsxs(a.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left p-tooltip--btm-center","aria-label":`Edit ${s.name} profile`,onClick:()=>{l(s)},children:[e.jsx("span",{className:"p-tooltip__message",children:"Edit"}),e.jsx("i",{className:"p-icon--edit u-no-margin--left"})]})}],sortData:{status:s.enabled,uid:s.uid,fullname:s.username}}));return e.jsx(a.MainTable,{headers:b,rows:g,sortable:!0})},fe=(n,t)=>n?t.filter(({username:r,name:i})=>{const m=i==null?void 0:i.toUpperCase().includes(n.toUpperCase()),l=r.toUpperCase().includes(n.toUpperCase());return m||l}):t,_e=1e3,Ue=({instanceId:n})=>{const[t,r]=x.useState(1),[i,m]=x.useState(20),[l,c]=x.useState([]),[d,h]=x.useState(""),{setSidePanelContent:b}=w(),{getUsersQuery:g}=Q(),{data:s,isLoading:u}=g({computer_id:n,limit:_e}),o=(s==null?void 0:s.data.results)??[],p=x.useMemo(()=>fe(d,o),[d,o]),f=((j,U)=>p.slice(U,U+j))(i,(t-1)*i),_=j=>{r(j),c([])},P=()=>{b("Add new user",e.jsx(E,{instanceId:n}))};return e.jsxs(e.Fragment,{children:[u&&e.jsx(v,{}),!u&&(!s||s.data.results.length===0)&&e.jsx(Z,{title:"No users found",body:"Add new users by clicking the button below",icon:"connected",cta:[e.jsx(a.Button,{appearance:"positive",onClick:P,children:"Add user"},"empty-state-add-new-user")]}),!u&&p.length&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{instanceId:n,onPageChange:_,onSearch:j=>h(j),selected:l,setSelected:c,users:f}),e.jsx(ke,{instanceId:n,selected:l,setSelected:c,users:f})]}),e.jsx(ee,{currentPage:t,totalItems:p.length,paginate:_,pageSize:i,setPageSize:j=>{m(j)},currentItemCount:f.length})]})},we=Ue,Be=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"}));export{pe as U,Be as i,Q as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-BSgYrUgA.js","assets/index-CQs3wXys.js","assets/index-C_8s_0a6.css","assets/formik.esm-C_3GEhhV.js","assets/index.esm-85kEx3I1.js","assets/SidePanelFormButtons-CTKwSU1t.js","assets/SidePanelFormButtons.module-CoxOjuX8.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/MultiSelectField-_3K3CoZM.js","assets/MultiSelectField.module-D1r8qo_i.js","assets/MultiSelectField-B2rqRhX9.css","assets/EmptyState-DNkTeHW1.js","assets/EmptyState-BNXajmMK.css","assets/TablePagination-DIiSuGph.js","assets/TablePagination-JK-zjkSx.css","assets/useMutation-D9dT1mhA.js","assets/useQuery-DrwXjJzc.js","assets/useConfirm-9PPCxKmU.js","assets/helpers-BS8e34QL.js","assets/PageMain-BTzMuvvj.js","assets/PageMain-DtiowUD8.css","assets/index-k2FtxY_l.js","assets/InfoItem-BtzYmEJw.js","assets/InfoItem-BbayMzTk.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
