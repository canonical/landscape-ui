const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BHto18Be.js","assets/index-DdDZs9iJ.js","assets/index-CNplmdTt.css","assets/HeaderWithSearch-CXY4tLKs.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/CellInput-Bpg6A5ZW.js","assets/SidePanelTablePagination-BB-a982T.js","assets/PageMain-B3ytKPSD.js","assets/PageMain-CIunaku7.css","assets/useRoles-BNFkLHId.js","assets/useExpandableRow-DKL1BEGd.js","assets/index-DkxMn-0U.css","assets/index-PjZjhkvN.js","assets/AssociationBlock-D19zpqMb.js","assets/MultiSelectField-CAV9jDpg.js","assets/MultiSelectField-GyNA33om.css","assets/useInstances-xzL-A-Ng.js","assets/AssociationBlock-DQBJa-xL.css","assets/SidePanelFormButtons-BSX-z9y0.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/index-DMx8LsFe.js","assets/index-DDhyFEdk.js","assets/FileInput-BMhZBSoE.js","assets/PackageProfileConstraintsBlock-CdVNBcXj.js","assets/PackageProfileConstraintsBlock-CdyFUl7u.css","assets/index-CLnfUnnC.css"])))=>i.map(i=>d[i]);
import{i as K,c as U,h as W,k as v,l as N,M as L,a6 as G,P as x,U as R,Q as Y,O as E,af as J,j as e,N as I,aF as X,y as _,r as d,q as P,d as l,o as C,a2 as b,B as F,C as q,I as j,aa as D,H as Z,ap as ee,f as ae,aA as se,ai as te,aB as ne,aC as oe,aq as ie,ao as re,E as ce}from"./index-DdDZs9iJ.js";import{P as le,a as de,b as ue}from"./PageMain-B3ytKPSD.js";import{u as Q}from"./useRoles-BNFkLHId.js";import{H as M}from"./HeaderWithSearch-CXY4tLKs.js";import{S as pe}from"./SidePanelTablePagination-BB-a982T.js";import{u as ge}from"./useExpandableRow-DKL1BEGd.js";function T(){const a=K(),s=U(),i=W(),o=(n={},r={})=>N({queryKey:["packageProfiles",n],queryFn:async()=>s.get("packageprofiles",{params:n}),...r}),m=v({mutationFn:async n=>s.post("packageprofiles",n),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),c=v({mutationFn:async n=>s.post("packageprofiles",n),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),p=v({mutationFn:async n=>i.get("RemovePackageProfile",{params:n}),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),g=v({mutationFn:async({name:n,...r})=>s.put(`packageprofiles/${n}`,r),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),f=({instanceId:n,...r},y={})=>N({queryKey:["instancePackageProfiles",{instanceId:n,...r}],queryFn:async()=>s.get(`computers/${n}/packages/profile`,{params:r}),...y}),u=({name:n,...r},y={})=>N({queryKey:["packageProfileConstraints",{name:n,...r}],queryFn:async()=>s.get(`packageprofiles/${n}/constraints`,{params:r}),...y}),h=v({mutationFn:async({name:n,...r})=>s.post(`packageprofiles/${n}/constraints`,r),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),k=v({mutationFn:async({id:n,name:r,...y})=>s.put(`packageprofiles/${r}/constraints/${n}`,y),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),t=v({mutationFn:async({name:n,...r})=>s.delete(`packageprofiles/${n}/constraints`,{params:r}),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])});return{addPackageProfileConstraintsQuery:h,copyPackageProfileQuery:m,createPackageProfileQuery:c,editPackageProfileConstraintQuery:k,editPackageProfileQuery:g,getInstancePackageProfileQuery:f,getPackageProfileConstraintsQuery:u,getPackageProfilesQuery:o,removePackageProfileConstraintsQuery:t,removePackageProfileQuery:p}}const z={constraint:"",notAnyVersion:!1,package:"",rule:"",version:""},Xe=Object.fromEntries(Object.keys(z).map(a=>[a,!0])),me={constraint:"",id:0,package:"loading",rule:"",version:"",notAnyVersion:!1},he=[{label:"Any",value:""},{label:"Newer or equal to",value:">="},{label:"Newer than",value:">"},{label:"Equal to",value:"="},{label:"Older than",value:"<"},{label:"Older or equal to",value:"<="}],Pe=[{label:"Select",value:""},{label:"Conflicts with",value:"conflicts"},{label:"Depends on",value:"depends"}],Ze={access_group:G,all_computers:!1,constraints:[z],constraintsType:"",csvFile:null,description:"",isCsvFileParsed:!1,material:"",source_computer_id:0,tags:[],title:""},ea=L().shape({access_group:x(),all_computers:E(),constraints:R().when("constraintsType",{is:"manual",then:a=>a.of(L().shape({constraint:x().required("Required."),notAnyVersion:E(),package:x().required("Required."),rule:x().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")}),version:x().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")})})).min(1,"Package profiles must have at least one package constraint.")}),constraintsType:x().required("This field is required."),csvFile:J().nullable().test({name:"mime-type",message:"Invalid file type.",test:a=>!a||a.type==="text/csv"}).when("constraintsType",{is:"material",then:a=>a.required("This field is required.")}),description:x().required("This field is required."),isCsvFileParsed:E(),material:x().when("constraintsType",{is:"material",then:a=>a.required("The file cannot be empty.")}),source_computer_id:Y().when("constraintsType",{is:"instance",then:a=>a.min(1,"This field is required.")}),tags:R().of(x()),title:x().required("This field is required.")}),V=({packageProfile:a})=>!a.tags.length&&!a.all_computers?e.jsx(I,{}):a.computers.constrained.length?e.jsxs(X,{to:{pathname:"/instances",search:`query=${encodeURIComponent(`profile:package:${a.id}`)}`},children:[a.computers.constrained.length," ",_(a.computers.constrained.length,"instance")]}):"0 instances",fe="_constraint_1lz67_1",xe="_hidden_1lz67_5",B={constraint:fe,hidden:xe},ke=({row:a,column:s})=>{const i={};return a.original.package==="loading"?s.id==="package"?i.colSpan=3:(i.className=B.hidden,i["aria-hidden"]=!0):s.id==="package"?i.role="rowheader":s.id==="constraint"?i["aria-label"]="Constraint":s.id==="rule"?i["aria-label"]="Rule":s.id==="version"&&(i["aria-label"]="Version"),i},ye=({isConstraintsLoading:a,profileConstraints:s,search:i})=>{const o=d.useMemo(()=>a?[me]:s?s.map(c=>({...c,notAnyVersion:!!c.version})):[],[a,s]),m=d.useMemo(()=>[{accessor:"constraint",className:B.constraint,Header:"Constraint",Cell:({row:{original:c}})=>{var p;return((p=Pe.find(({value:g})=>g===c.constraint))==null?void 0:p.label)??c.constraint}},{accessor:"package",Header:"Package",Cell:({row:{original:c}})=>c.package==="loading"?e.jsx(P,{}):c.package},{accessor:"version",Header:"Version",Cell:({row:{original:c}})=>{var p;return c.version?`${(p=he.find(({value:g})=>g===c.rule))==null?void 0:p.label} ${c.version}`:"Any"}}],[o]);return e.jsx(l.ModularTable,{columns:m,data:o,getCellProps:ke,emptyMsg:`No constraints found with the search: "${i}"`})},je="_actions_nxngq_1",be={actions:je},ve=d.lazy(()=>b(()=>import("./index-BHto18Be.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Ce=({profile:a})=>{const[s,i]=d.useState(1),[o,m]=d.useState(20),[c,p]=d.useState(""),{setSidePanelContent:g}=C(),{getPackageProfileConstraintsQuery:f}=T(),{data:u,isLoading:h}=f({name:a.name,limit:o,offset:(s-1)*o,search:c}),k=()=>{g(`Change "${a.title}" profile's constraints`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ve,{profile:a})}),"medium")};return e.jsxs(e.Fragment,{children:[!c&&s===1&&o===20&&h&&e.jsx(P,{}),(c||s!==1||o!==20||!h&&u&&u.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(M,{className:be.actions,onSearch:t=>p(t),actions:e.jsx(l.Button,{className:"u-no-margin--bottom",type:"button",onClick:k,children:"Change package constraints"})}),e.jsx(ye,{isConstraintsLoading:h,profileConstraints:u==null?void 0:u.data.results,search:c}),e.jsx(pe,{currentPage:s,pageSize:o,paginate:t=>i(t),setPageSize:t=>m(t),totalItems:u==null?void 0:u.data.count})]})]})},_e=d.lazy(async()=>b(()=>import("./index-PjZjhkvN.js"),__vite__mapDeps([12,1,2,13,14,15,16,17,18,19,20,9,7,8,3,4,6,10]))),Te=d.lazy(async()=>b(()=>import("./index-DMx8LsFe.js"),__vite__mapDeps([21,1,2,18,19,20,13,14,15,16,17,7,8,9,3,4,6,10]))),Se=({profile:a})=>{var $,w;const[s,i]=d.useState(!1),o=F(),{notify:m}=q(),{closeSidePanel:c,setSidePanelContent:p}=C(),{removePackageProfileQuery:g}=T(),{getAccessGroupQuery:f}=Q(),{data:u}=f(),h=(u==null?void 0:u.data)??[],{mutateAsync:k,isPending:t}=g,n=()=>{i(!0)},r=()=>{i(!1)},y=async()=>{try{await k({name:a.name}),r(),c(),m.success({message:`Package profile "${a.name}" removed successfully.`,title:"Package profile removed"})}catch(A){r(),o(A)}},S=()=>{p("Edit package profile",e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Te,{profile:a})}))},H=()=>{p("Duplicate package profile",e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(_e,{profile:a})}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(l.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:H,children:[e.jsx(l.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate profile"})]}),e.jsxs(l.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:S,children:[e.jsx(l.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(l.Button,{className:"p-segmented-control__button",hasIcon:!0,type:"button",onClick:n,"aria-label":`Remove ${a.title} package profile`,children:[e.jsx(l.Icon,{name:l.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(l.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(l.Col,{size:3,children:e.jsx(j,{label:"Title",value:a.title})}),e.jsx(l.Col,{size:3,children:e.jsx(j,{label:"Name",value:a.name})}),e.jsx(l.Col,{size:9,children:e.jsx(j,{label:"Description",value:a.description})}),e.jsx(l.Col,{size:3,children:e.jsx(j,{label:"Access group",value:(($=h.find(A=>A.name===a.access_group))==null?void 0:$.title)??a.access_group})}),e.jsx(l.Col,{size:9,children:e.jsx(j,{label:"Tags",...a.tags.length>0?{type:"truncated",value:a.tags.join(", ")}:{value:e.jsx(I,{})}})}),e.jsx(l.Col,{size:3,children:e.jsx(j,{label:"Associated to",value:e.jsx(V,{packageProfile:a})})}),e.jsx(l.Col,{size:3,children:e.jsx(j,{label:"Pending on",value:`${((w=a.computers.pending)==null?void 0:w.length)??0} ${_(a.computers.pending.length,"instance")}`})}),e.jsx(l.Col,{size:3,children:e.jsx(j,{label:"Not compliant on",value:`${a.computers["non-compliant"].length} ${_(a.computers["non-compliant"].length,"instance")}`})})]}),e.jsx(Ce,{profile:a}),e.jsx(D,{isOpen:s,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:t,confirmButtonDisabled:t,close:r,confirmationText:`remove ${a.title}`,onConfirm:y,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},Ae=d.lazy(async()=>b(()=>import("./index-BHto18Be.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Ne=d.lazy(async()=>b(()=>import("./index-PjZjhkvN.js"),__vite__mapDeps([12,1,2,13,14,15,16,17,18,19,20,9,7,8,3,4,6,10]))),Ee=d.lazy(async()=>b(()=>import("./index-DMx8LsFe.js"),__vite__mapDeps([21,1,2,18,19,20,13,14,15,16,17,7,8,9,3,4,6,10]))),Oe=({profile:a})=>{const s=F(),{notify:i}=q(),{setSidePanelContent:o}=C(),{removePackageProfileQuery:m}=T(),{value:c,setTrue:p,setFalse:g}=Z(),{mutateAsync:f,isPending:u}=m,h=()=>{o(`Change "${a.title}" profile's constraints`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ae,{profile:a})}),"medium")},k=()=>{o(`Edit "${a.title}" profile`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ee,{profile:a})}))},t=()=>{o(`Duplicate "${a.title}" profile`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ne,{profile:a})}))},n=async()=>{try{await f({name:a.name}),i.success({message:`Package profile "${a.title}" removed successfully`,title:"Package profile removed"})}catch(S){s(S)}finally{g()}},r=[{icon:"edit",label:"Edit","aria-label":`Edit ${a.title} profile`,onClick:k},{icon:"applications",label:"Change package constraints","aria-label":`Change ${a.title} package constraints`,onClick:h},{icon:"canvas",label:"Duplicate","aria-label":`Duplicate ${a.title} profile`,onClick:t}],y=[{icon:"delete",label:"Remove","aria-label":`Remove ${a.title} profile`,onClick:p}];return e.jsxs(e.Fragment,{children:[e.jsx(ee,{toggleAriaLabel:`${a.title} profile actions`,actions:r,destructiveActions:y}),e.jsx(D,{isOpen:c,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:u,confirmButtonDisabled:u,close:g,confirmationText:`remove ${a.title}`,onConfirm:n,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},Ie=`These instances are not compliant
with the profile. They do not have a
pending activity to become compliant.`,$e=`These instances are not compliant
with the profile. They do have a
pending activity to apply its
constraints.`,we=a=>({column:s,row:{index:i}})=>{const o={};switch(s.id){case"title":o.role="rowheader";break;case"description":o["aria-label"]="Description";break;case"access_group":o["aria-label"]="Access group";break;case"tags":o["aria-label"]="Tags",a===i&&(o.className="expandedCell");break;case"computers['non-compliant']":o["aria-label"]="Not compliant instances";break;case"computers['pending']":o["aria-label"]="Pending instances";break;case"computers['constrained']":o["aria-label"]="Associated instances";break;case"actions":o["aria-label"]="Actions";break}return o},Le=a=>({index:s,original:i})=>{const o={};return a===s&&(o.className="expandedRow"),o["aria-label"]=`${i.title} package profile row`,o},Re="_description_y3fly_1",Fe="_noWrap_y3fly_2",O={description:Re,noWrap:Fe},qe=({packageProfiles:a})=>{const{search:s}=ae(),{setSidePanelContent:i}=C(),{getAccessGroupQuery:o}=Q(),{expandedRowIndex:m,handleExpand:c,getTableRowsRef:p}=ge(),{data:g}=o(),f=(g==null?void 0:g.data.map(({name:t,title:n})=>({label:n,value:t})))??[],u=t=>{i(t.title,e.jsx(Se,{profile:t}),"medium")},h=d.useMemo(()=>s?a.filter(t=>t.title.toLowerCase().includes(s.toLowerCase())):a,[a,s]),k=d.useMemo(()=>[{...se,Cell:({row:{original:t}})=>e.jsxs(ne,{children:[e.jsx(l.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{u(t)},children:t.title}),e.jsx("span",{className:"u-text--muted",children:t.name})]})},{accessor:"description",className:O.description,Header:"Description"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:{access_group:t}}})=>{var n;return((n=f.find(({value:r})=>r===t))==null?void 0:n.label)??t}},{accessor:"tags",Header:"Tags",Cell:({row:{original:{tags:t},index:n}})=>t.length>0?e.jsx(oe,{content:t.map(r=>e.jsx("span",{className:"truncatedItem",children:r},r)),isExpanded:n==m,onExpand:()=>{c(n)},showCount:!0}):e.jsx(I,{})},{accessor:"computers['non-compliant']",Header:e.jsxs("div",{className:O.noWrap,children:[e.jsx("span",{children:"Not compliant "}),e.jsx(l.Tooltip,{position:"btm-left",message:Ie,children:e.jsx(l.Icon,{name:"help"})})]}),Cell:({row:{original:t}})=>e.jsx(e.Fragment,{children:`${t.computers["non-compliant"].length} ${_(t.computers["non-compliant"].length,"instance")}`})},{accessor:"computers['pending']",Header:e.jsxs("div",{className:O.noWrap,children:[e.jsx("span",{children:"Pending "}),e.jsx(l.Tooltip,{position:"btm-left",message:$e,children:e.jsx(l.Icon,{name:"help"})})]}),Cell:({row:{original:t}})=>{var n;return e.jsx(e.Fragment,{children:`${((n=t.computers.pending)==null?void 0:n.length)??0} ${_(t.computers.pending.length,"instance")}`})}},{accessor:"computers['constrained']",Header:"Associated",Cell:({row:{original:t}})=>e.jsx(V,{packageProfile:t})},{...te,Cell:({row:{original:t}})=>e.jsx(Oe,{profile:t})}],[f.length,m]);return e.jsx("div",{ref:p,children:e.jsx(ie,{columns:k,data:h,emptyMsg:`No package profiles found with the search "${s}"`,getCellProps:we(m),getRowProps:Le(m),minWidth:1200})})},De=()=>e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsx(re,{filtersToDisplay:["search"]})]}),Qe=d.lazy(()=>b(()=>import("./index-DDhyFEdk.js").then(a=>a.i),__vite__mapDeps([22,1,2,13,14,15,16,17,18,19,20,9,23,24,5,25,26]))),Me=()=>{const{setSidePanelContent:a}=C(),s=()=>{a("Add package profile",e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Qe,{})}),"medium")};return e.jsx(ce,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You havenâ€™t added any package profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-packages",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage packages in Landscape"})]}),cta:[e.jsx(l.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add")],title:"No package profiles found"})},ze=({packageProfiles:a=[]})=>e.jsxs(e.Fragment,{children:[e.jsx(De,{}),e.jsx(qe,{packageProfiles:a})]}),Ve=()=>{const{getPackageProfilesQuery:a}=T(),{data:s,isLoading:i}=a();return e.jsxs(e.Fragment,{children:[i&&e.jsx(P,{}),!i&&(!s||s.data.result.length===0)&&e.jsx(Me,{}),!i&&s&&s.data.result.length>0&&e.jsx(ze,{packageProfiles:s==null?void 0:s.data.result})]})},Be=d.lazy(()=>b(()=>import("./index-DDhyFEdk.js").then(a=>a.a),__vite__mapDeps([22,1,2,13,14,15,16,17,18,19,20,9,23,24,5,25,26])).then(a=>({default:a.PackageProfileCreateForm}))),He=()=>{const{setSidePanelContent:a}=C(),s=()=>{a("Add package profile",e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Be,{})}),"medium")};return e.jsxs(le,{children:[e.jsx(de,{title:"Package profiles",actions:[e.jsx(l.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add-package-profile")]}),e.jsx(ue,{children:e.jsx(Ve,{})})]})},aa=Object.freeze(Object.defineProperty({__proto__:null,default:He},Symbol.toStringTag,{value:"Module"}));export{Pe as C,z as E,Ze as I,me as L,qe as P,Xe as T,ea as V,he as a,De as b,Me as c,aa as i,T as u};
