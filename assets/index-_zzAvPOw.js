const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-FNpILsDZ.js","assets/index-CWcKsy1s.js","assets/index-DgLN2HdX.css","assets/SelectAllButton-J-tZAKqh.js","assets/ExpandableTableFooter-BQ4j4vB9.js","assets/ExpandableTableFooter-DWm8zyWg.css","assets/usePackages-Bl3d3F-R.js","assets/useFetchOld-C69hZMNo.js","assets/usePackages-D2X0CFCl.css","assets/usePageParams-DkLGTNjY.js","assets/index-opcF9JuM.css","assets/index-AUpxiNcI.js","assets/index-DXCgn1fK.css","assets/index-D-dOzcfP.js","assets/UsnList-CjroGW6J.js","assets/NoData-BpcNkgZe.js","assets/TablePagination-BcBBIvrg.js","assets/TablePaginationBase-C6dHHOjO.js","assets/TablePaginationBase-CJl3HN1X.css","assets/TruncatedCell-BKScFINj.js","assets/TruncatedCell-CoXbu3VM.css","assets/helpers-BonKpxw0.js","assets/helpers-CCHFURK6.css","assets/UsnList-B4hAwQmb.css"])))=>i.map(i=>d[i]);
import{j as e,m as E,h as g,r as l,t as u,k as x,l as I,_ as o,p as T,q as v,f as L,s as C,g as m,K as V,n as N}from"./index-CWcKsy1s.js";import{S as R}from"./SidePanelFormButtons-Bf5kZdPn.js";import"./usePageParams-DkLGTNjY.js";import{h,a as B,b}from"./helpers-CW7le698.js";import"./InstancesPageActions-R0cumHn6.js";import{a as D,u as F}from"./usePackages-Bl3d3F-R.js";import"./SidePanelFormButtons.module-C5v714vX.js";import"./useInstances-CT4apT1D.js";import"./useFetchOld-C69hZMNo.js";import"./index-lRXV2AeE.js";import"./TablePagination-BcBBIvrg.js";import"./TablePaginationBase-C6dHHOjO.js";import"./StatusFilter-DKMV2jQL.js";import"./TableFilter-p3Fq3U0t.js";import"./TableFilterChips-VUu1Q1pQ.js";import"./NoData-BpcNkgZe.js";const $=({instances:t})=>{const a=t.filter(({alerts:i})=>h(i)).length,r=t.filter(({alerts:i})=>B(i)).length,s=t.filter(({alerts:i})=>!b(i)).length;return e.jsxs("div",{children:[e.jsx("span",{children:"You selected "}),e.jsx("span",{children:e.jsx("b",{children:t.length})}),e.jsx("span",{children:" instances:"}),e.jsxs("ul",{className:E({"u-no-margin--bottom":s>0}),children:[a>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Security upgrades are available for "}),e.jsx("b",{children:a}),e.jsx("span",{children:a!==1?" instances":" instance"})]}),r>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Regular upgrades are available for "}),e.jsx("b",{children:r}),e.jsx("span",{children:r!==1?" instances":" instance"})]})]}),s>0&&e.jsxs("p",{children:[e.jsx("span",{children:"No upgrades for "}),e.jsx("span",{children:e.jsx("b",{children:s})}),e.jsx("span",{children:s!==1?" instances needed.":" instance needed."})]})]})},k=[{id:"tab-link-instances",label:"Instances"},{id:"tab-link-packages",label:"Packages"},{id:"tab-link-usns",label:"USNs"}],p={instances:l.lazy(()=>o(()=>import("./index-FNpILsDZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),packages:l.lazy(()=>o(()=>import("./index-AUpxiNcI.js"),__vite__mapDeps([11,1,2,6,7,8,9,3,4,5,12]))),usns:l.lazy(()=>o(()=>import("./index-D-dOzcfP.js"),__vite__mapDeps([13,1,2,14,9,3,4,5,15,16,17,18,19,20,6,7,8,21,22,23])))},q=g().shape({excludedPackages:u().of(g().shape({id:I().required(),exclude_packages:u().of(x())})),excludedUsns:u().of(x())}),w=({activeTabLinkId:t,onTabLinkClick:a,withUsnsTab:r})=>k.filter(({id:s})=>r||s!=="tab-link-usns").map(({id:s,label:i})=>({id:s,label:i,active:s===t,onClick:()=>a(s),role:"tab"})),O=t=>({excludedPackages:t.map(({id:a})=>({id:a,exclude_packages:[]})),excludedUsns:[]}),ie=({selectedInstances:t})=>{const[a,r]=l.useState(k[0].id),s=t.filter(({alerts:n})=>b(n)),i=s.filter(({alerts:n})=>h(n)),j=T(),{notify:f}=v(),{closeSidePanel:P}=L(),{upgradeInstancesPackagesQuery:_}=D(),{upgradeUsnsQuery:U}=F(),{mutateAsync:S}=_,{mutateAsync:y}=U,A=async n=>{try{a==="tab-link-usns"?await y({computers:i.map(({id:d})=>({id:d,exclude_usns:n.excludedUsns}))}):await S({computers:n.excludedPackages}),P(),f.success({title:"You queued packages to be upgraded",message:`Packages on ${t.length} ${t.length!==1?"instances":"instance"} will be upgraded and are queued in Activities`})}catch(d){j(d)}},c=C({initialValues:O(s),onSubmit:A,validationSchema:q});return e.jsxs(m.Form,{onSubmit:c.handleSubmit,children:[e.jsx($,{instances:t}),e.jsx(m.Tabs,{links:w({activeTabLinkId:a,onTabLinkClick:n=>r(n),withUsnsTab:i.length>0})}),e.jsx(V,{children:e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":a,children:e.jsxs(l.Suspense,{fallback:e.jsx(N,{}),children:[a==="tab-link-instances"&&e.jsx(p.instances,{excludedPackages:c.values.excludedPackages,instances:s,onExcludedPackagesChange:n=>c.setFieldValue("excludedPackages",n)}),a==="tab-link-packages"&&e.jsx(p.packages,{excludedPackages:c.values.excludedPackages,instances:s,onExcludedPackagesChange:n=>c.setFieldValue("excludedPackages",n)}),a==="tab-link-usns"&&e.jsx(p.usns,{excludedUsns:c.values.excludedUsns,instances:i,onExcludedUsnsChange:n=>c.setFieldValue("excludedUsns",n)})]})})}),e.jsx(R,{submitButtonDisabled:c.isSubmitting,submitButtonText:"Upgrade"})]})};export{ie as Upgrades};
