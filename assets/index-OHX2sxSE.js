const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bgc24rnF.js","assets/index-Bd4iIRe_.js","assets/index-C0ZxZ9J6.css","assets/moment-C5S46NFB.js","assets/useInstances-CXxtUloJ.js","assets/useFetchOld-CisSrTSd.js","assets/moment-DWLH54Z_.js","assets/TablePagination-9gj_8Kgx.js","assets/usePageParams-CGqhdr-B.js","assets/TablePaginationBase-BDX0aSIU.js","assets/TablePaginationBase-CJl3HN1X.css","assets/TableFilterChips-DUUXOsEl.js","assets/TableFilterChips-BAnU27MY.css","assets/NoData-BBZVu-3W.js","assets/index-DlELVwax.css"])))=>i.map(i=>d[i]);
import{j as e,E as Y,g as c,m as O,r as l,_ as Q,e as U,b as G,f as R,c as k,d as $,n as S,O as J,s as X,h as Z,l as q,o as ee,L as te,D as se}from"./index-Bd4iIRe_.js";import{m as ae}from"./moment-DWLH54Z_.js";import{T as ne}from"./TablePagination-9gj_8Kgx.js";import{u as C}from"./usePageParams-CGqhdr-B.js";import{T as V,t as v,a as ie}from"./TableFilterChips-DUUXOsEl.js";import{u as re}from"./useFetchOld-CisSrTSd.js";import{N as H}from"./NoData-BBZVu-3W.js";const ce=()=>e.jsx(Y,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no activities yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage computers in Landscape"})]}),icon:"switcher-environments",title:"No activities found"}),oe="_wrapper_22uzw_1",le="_search_22uzw_9",ue="_buttonContainer_22uzw_13",de="_button_22uzw_13",pe="_icon_22uzw_43",j={wrapper:oe,search:le,buttonContainer:ue,button:de,icon:pe},me=({inputValue:s,onDescriptionClick:t,onInputChange:n,onSearchClick:o,onClear:r})=>e.jsxs("div",{className:j.wrapper,children:[e.jsx(c.SearchBox,{autocomplete:"off",shouldRefocusAfterReset:!0,externallyControlled:!0,value:s,onChange:n,onSearch:o,onClear:r,className:O("u-no-margin--bottom",j.search)}),e.jsx("div",{className:j.buttonContainer,children:e.jsx(c.Button,{type:"button",onClick:t,className:j.button,children:e.jsx(c.Icon,{name:c.ICONS.help,className:j.icon})})})]}),he="_term_1p61y_1",ge={term:he},ye=({open:s,onClose:t,data:n})=>{const o=[{Header:"Term",accessor:"term",className:ge.term,Cell:({value:r})=>typeof r=="string"?e.jsx("code",{children:r}):null},{Header:"Description",accessor:"description",Cell:({value:r})=>typeof r=="string"||l.isValidElement(r)?e.jsx("span",{className:"u-text--muted",children:r}):null}];return s&&e.jsxs(c.Modal,{title:"Search help",close:t,children:[e.jsx("p",{children:"Available search terms for use in the search box. If multiple search terms are separated by OR, any of the conditions will match. Otherwise, all conditions must be met for a instance to match. When a term is preceded by NOT, the condition must not match. If the searched value contains spaces or non-ASCII characters, it must be quoted."}),e.jsx(c.ModularTable,{className:"u-no-margin--bottom",columns:l.useMemo(()=>o,[]),data:l.useMemo(()=>n,[])})]})},fe="_container_1le1l_1",xe="_sticky_1le1l_9",_e="_searchContainer_1le1l_15",be="_filters_1le1l_19",F={container:fe,sticky:xe,searchContainer:_e,filters:be},ve="_iconError_xphpu_1",je="_iconWarning_xphpu_5",Se="_iconWarningRed_xphpu_9",w={iconError:ve,iconWarning:je,iconWarningRed:Se},E={succeeded:{icon:"success",label:"Succeeded"},scheduled:{icon:"spinner",label:"Scheduled"},waiting:{icon:"status-waiting",label:"Waiting"},undelivered:{icon:"status-queued",label:"Queued"},delivered:{icon:"status-in-progress",label:"In progress"},blocked:{icon:`warning-grey ${w.iconWarningRed}`,label:"Blocked"},unapproved:{icon:`warning-grey ${w.iconWarning}`,label:"Unapproved"},canceled:{icon:"error-grey",label:"Cancelled"},failed:{icon:`error-grey ${w.iconError}`,label:"Failed"}},Ce=[{term:"id:<activity_id>",description:"Search for activities with a specific ID."},{term:"parent-id:<parent_id>",description:"Search for children activities of a specific ID."},{term:"created-after:<date>",description:e.jsxs("span",{children:["Search for activities created after a specific date or time, specified with the ISO-8601 format. The precision depends on how far you specify, for example ",e.jsx("code",{children:"2011-01"}),", ",e.jsx("code",{children:"2011-01-01"}),","," ",e.jsx("code",{children:"2011-01-01T10:30"})," are valid values."]})},{term:"created-before:<date>",description:"Search for activities created before a specific date or time. The format is the same as created-after."},{term:"creator:<email>",description:"Search for activities created by a particular person (specified by email address)."},{term:"computer:<criteria>",description:"Search for activities related to the given instances. The criteria is itself another query argument to search instances. See Instance Queries for details."},{term:"type:<type>",description:"Search for activities of a specific type."}],L=[{label:"All",value:""},...Object.entries(E).filter(([s])=>s!=="unapproved").map(([s,{label:t}])=>({label:t,value:s}))],Te=({options:s})=>{const{setPageParams:t,status:n}=C();return e.jsx(V,{multiple:!1,label:"Status",hasToggleIcon:!0,hasBadge:!0,options:s,onItemSelect:o=>t({status:o}),selectedItem:n})},Ae=({options:s})=>{const[t,n]=l.useState(""),{setPageParams:o,type:r}=C(),u=s.filter(d=>d.label.toLowerCase().includes(t.toLowerCase()));return e.jsx(V,{multiple:!1,label:"Type",hasToggleIcon:!0,hasBadge:!0,onSearch:d=>n(d),options:u,onItemSelect:d=>o({type:d}),selectedItem:r})},De=l.lazy(()=>Q(()=>import("./index-Bgc24rnF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])));function B(){const s=re(),t=U(),n=G(),{setSidePanelContent:o}=R(),r=(i={},h={})=>$({queryKey:["activities",i],queryFn:()=>t.get("activities",{params:i}),...h}),u=({activityId:i,...h},x={})=>$({queryKey:["activities",{activityId:i,...h}],queryFn:()=>t.get(`activities/${i}`,{params:h}),...x}),d=(i={},h={})=>$({queryKey:["activityTypes"],queryFn:()=>s.get("GetActivityTypes",{params:i}),...h}),b=k({mutationKey:["activities","cancel"],mutationFn:i=>s.get("CancelActivities",{params:i}),onSuccess:()=>n.invalidateQueries({queryKey:["activities"]})}),g=k({mutationKey:["activities","approve"],mutationFn:i=>s.get("ApproveActivities",{params:i}),onSuccess:()=>n.invalidateQueries({queryKey:["activities"]})}),p=k({mutationFn:i=>t.post("activities/reapply",i),onSuccess:()=>n.invalidateQueries({queryKey:["activities"]})}),T=k({mutationFn:i=>t.post("activities/revert",i),onSuccess:()=>n.invalidateQueries({queryKey:["activities"]})});return{getActivitiesQuery:r,getSingleActivityQuery:u,getActivityTypesQuery:d,cancelActivitiesQuery:b,approveActivitiesQuery:g,redoActivitiesQuery:p,undoActivitiesQuery:T,openActivityDetails:i=>{o(i.summary,e.jsx(l.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(De,{activityId:i.id})}))}}}function Ie(s){const{state:t}=J(),n=t==null?void 0:t.activity;l.useEffect(()=>{t!=null&&t.activity&&(s(t.activity),window.history.replaceState({},""))},[n])}const Ne="_container_1r60q_1",ke="_buttons_1r60q_6",M={container:Ne,buttons:ke},Fe=()=>{const[s,t]=l.useState(!1),{setPageParams:n,fromDate:o,toDate:r}=C(),u=X({initialValues:{fromDate:o||"",toDate:r||""},enableReinitialize:!0,validationSchema:Z().shape({fromDate:q(),toDate:q()}),onSubmit:d=>{n({fromDate:d.fromDate,toDate:d.toDate}),t(!1)}});return e.jsx(c.ContextualMenu,{visible:s,autoAdjust:!0,toggleAppearance:"base",toggleLabel:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Date range"}),e.jsx("span",{className:O(v.badgeContainer),children:o||r?e.jsx(c.Badge,{value:o&&r?2:1,className:v.badge}):null})]}),toggleClassName:v.toggle,toggleProps:{onClick:()=>{t(!s)}},hasToggleIcon:!0,dropdownClassName:v.dropdown,position:"left",children:e.jsxs(c.Form,{onSubmit:u.handleSubmit,noValidate:!0,className:M.container,children:[e.jsxs("div",{className:v.container,children:[e.jsx(c.Input,{type:"datetime-local",label:"From",...u.getFieldProps("fromDate")}),e.jsx(c.Input,{type:"datetime-local",label:"To",...u.getFieldProps("toDate")})]}),e.jsxs("div",{className:M.buttons,children:[e.jsx(c.Button,{small:!0,type:"button",appearance:"base",onClick:()=>{t(!1),u.resetForm()},children:"Cancel"}),e.jsx(c.Button,{small:!0,type:"submit",appearance:"positive",children:"Add"})]})]})})},$e=({resetSelectedIds:s})=>{const{search:t,setPageParams:n}=C(),{instanceId:o}=ee(),{getActivityTypesQuery:r}=B(),[u,d]=l.useState(""),[b,g]=l.useState(!1),{data:p}=r(),A=((p==null?void 0:p.data)??[]).map(y=>({label:y,value:y})),i=[{label:"All",value:""},...A],h=!!o,x=()=>{u&&(n({search:t?`${t},${u}`:`${u}`}),d(""),s())},_=()=>{n({search:""})},D=y=>{y.preventDefault(),x()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:O(F.container,{[F.sticky]:!h}),children:[e.jsx("div",{className:F.searchContainer,children:e.jsx(c.Form,{onSubmit:D,noValidate:!0,children:e.jsx(me,{inputValue:u,onInputChange:y=>{d(y)},onSearchClick:x,onDescriptionClick:()=>g(!0),onClear:_})})}),e.jsxs("div",{className:F.filters,children:[e.jsx(Te,{options:L}),e.jsx(Ae,{options:i}),e.jsx(Fe,{})]})]}),e.jsx(ye,{open:b,data:Ce,onClose:()=>g(!1)}),e.jsx(ie,{filtersToDisplay:["search","status","type","fromDate","toDate"],statusOptions:L,typeOptions:i,useSearchAsQuery:!0})]})},we="_checkbox_19yw3_1",Pe="_description_19yw3_5",Ee="_link_19yw3_9",P={checkbox:we,description:Pe,link:Ee},Oe=(s,t)=>s&&t?` created-after:${s} created-before:${t}`:s?` created-after:${s}`:t?` created-before:${t}`:"",Qe=s=>s?` type:${s}`:"",qe=s=>s?` status:${s}`:"",He=l.lazy(()=>Q(()=>import("./index-Bgc24rnF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),Ye=({instanceId:s,selectedIds:t,setSelectedIds:n})=>{const{search:o,status:r,fromDate:u,toDate:d,type:b,currentPage:g,pageSize:p}=C(),{setSidePanelContent:T}=R(),{getActivitiesQuery:A}=B(),i=Oe(u,d),h=Qe(b),x=qe(r),_=`${o}${x}${i}${h}`,D=a=>{T(a.summary,e.jsx(l.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(He,{activityId:a.id})}))};Ie(D);const y=()=>{n([])},{data:m,isPending:I}=A({query:`${s?`computer:id:${s}`:""} ${_??""}`.trim(),limit:p,offset:(g-1)*p}),f=l.useMemo(()=>(m==null?void 0:m.data.results)??[],[m]),W=()=>{n(t.length!==0?[]:f.map(({id:a})=>a))},z=a=>{n(t.includes(a)?t.filter(N=>N!==a):[...t,a])},K=l.useMemo(()=>[{accessor:"checkbox",className:P.checkbox,Header:e.jsx(c.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:W,checked:f.length>0&&t.length===f.length,indeterminate:t.length>0&&t.length<f.length}),Cell:({row:a})=>e.jsx(c.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:a.original.summary}),inline:!0,labelClassName:"u-no-margin--bottom u-no-padding--top",checked:t.includes(a.original.id),onChange:()=>{z(a.original.id)}})},{accessor:"summary",className:P.description,Header:"Description",Cell:({row:a})=>e.jsx(c.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>D(a.original),children:a.original.summary})},{accessor:"activity_status",Header:"Status",Cell:({row:{original:{activity_status:a}}})=>E[a].label,getCellIcon:({row:{original:{activity_status:a}}})=>E[a].icon},{accessor:"computer_id",Header:"Instance",Cell:({row:a})=>a.original.computer_id?e.jsxs(te,{className:P.link,to:`/instances/${a.original.computer_id}`,children:["ID: ",a.original.computer_id]}):e.jsx(H,{})},{accessor:"creation_time",Header:"Created at",Cell:({row:a})=>e.jsx(e.Fragment,{children:ae(a.original.creation_time).format(se)})},{accessor:"creator.name",Header:"Creator",Cell:({row:a})=>{var N;return e.jsx(e.Fragment,{children:((N=a.original.creator)==null?void 0:N.name)??e.jsx(H,{})})}}].filter(a=>!s||a.accessor!=="computer_id"),[f,t]);return e.jsxs(e.Fragment,{children:[!_&&g===1&&p===20&&I&&e.jsx(S,{}),!_&&g===1&&p===20&&!I&&(!m||!m.data.count)&&e.jsx(ce,{}),(!!_||g!==1||p!==20||!I&&m&&m.data.count>0)&&e.jsxs(e.Fragment,{children:[e.jsx($e,{resetSelectedIds:y}),I?e.jsx(S,{}):e.jsx(c.ModularTable,{emptyMsg:"No activities found according to your search parameters.",columns:K,data:f}),e.jsx(ne,{totalItems:m==null?void 0:m.data.count,currentItemCount:f.length,handleClearSelection:y})]})]})},Le=l.lazy(()=>Q(()=>import("./index-Bgc24rnF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),Ue=s=>e.jsx(l.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Le,{...s})});export{Ye as A,Te as S,E as a,Ue as b,ye as c,B as u};
