import{j as a,m as f,_ as h,f as y,z as P,$ as x,b as E,a0 as A,C as L,H as j,a2 as _,o as b,d as g}from"./index-b6eKq6Xg.js";import{A as F}from"./AvailableProviderList-Dz_lTPm_.js";const W=({methods:e})=>{if(!e)return null;const i=!!(e.standalone_oidc.available&&e.standalone_oidc.enabled),o=!!(e.ubuntu_one.available&&e.ubuntu_one.enabled),p=!!(e.password.available&&e.password.enabled),r=!!(e.pam.available&&e.pam.enabled),c=e.oidc.available?e.oidc.configurations.filter(({enabled:u})=>u):[],n=p||r,l=o||i||e.oidc.configurations.length>0;return a.jsxs(a.Fragment,{children:[n&&a.jsx(M,{isIdentityAvailable:r}),l&&a.jsx(F,{isStandaloneOidcEnabled:i,isUbuntuOneEnabled:o,oidcProviders:c}),!n&&!l&&a.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},B=(e={})=>{const i=f(),[o]=h(),r=o.has("code")?"employee-access/login/methods":"login/methods",{data:c,isLoading:n,isError:l}=y({queryKey:["loginMethods"],queryFn:async()=>i.get(r),...e});return{loginMethods:c?.data??null,loginMethodsLoading:n,isLoginMethodsError:l}},q="_buttonRow_f3s21_1",S={buttonRow:q},M=({isIdentityAvailable:e})=>{const[i]=h(),o=P(),{signInWithEmailAndPasswordQuery:p}=x(),{redirectToExternalUrl:r,setAuthLoading:c,setUser:n}=E(),l=A(),u=i.get("redirect-to"),v=i.has("external"),{mutateAsync:w}=p,s=L({initialValues:{email:"",password:""},validationSchema:j().shape({email:e?b().required("This field is required"):b().required("This field is required").matches(/^[a-zA-Z0-9-_.]+@[a-zA-Z0-9-.]*[a-zA-Z]$/,"Please provide a valid email address").test({message:"Please provide a valid email address",test:m=>{if(m.match(/\.\./))return!1;const[t,d]=m.split("@");return!(!t||!d||t.startsWith(".")||t.endsWith(".")||!d.includes(".")||d.startsWith(".")||d.startsWith("-")||d.match(/\.-/)||d.match(/-\./))}}),password:b().required("This field is required")}),onSubmit:async m=>{try{const{data:t}=await w({email:m.email,password:m.password});v&&u?r(u,{replace:!0}):("current_account"in t&&(c(!0),n(t)),l(u??_,{replace:!0}))}catch(t){o(t)}}});return a.jsxs(g.Form,{onSubmit:s.handleSubmit,children:[a.jsx(g.Input,{type:"text",label:e?"Identity":"Email",error:s.touched.email&&s.errors.email?s.errors.email:void 0,...s.getFieldProps("email"),"data-testid":"email"}),a.jsx(g.PasswordToggle,{id:"password",label:"Password",error:s.touched.password&&s.errors.password?s.errors.password:void 0,...s.getFieldProps("password"),"data-testid":"password"}),a.jsx("div",{className:S.buttonRow,children:a.jsx(g.Button,{type:"submit",appearance:"positive",disabled:s.isSubmitting||!s.isValid,className:"u-no-margin--bottom",children:"Sign in"})})]})};export{W as L,B as u};
