import{j as e,r as b,o as P,p as w,R as U,g as x,m as k,n as H,q as K,f as V}from"./index-CYtilM9P.js";import{S as Y}from"./SidePanelFormButtons-BzdUfBMS.js";import{u as M}from"./index-PQrFIM4i.js";import{a as A}from"./usePackages-DpHUrRSm.js";import{D as z}from"./downshift.esm-C81puorD.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./usePageParams-ZZvT3eZS.js";import"./TablePagination-BBOB7v53.js";import"./TablePaginationBase-CdWtR2Ho.js";import"./StatusFilter-B35ZyMlb.js";import"./TableFilter-Cre4PFKR.js";import"./TableFilterChips-Dqh7xIWp.js";import"./useFetchOld-DGhJqqp0.js";import"./NoData-1Ct4F_u9.js";const G=200,J=(s,l)=>{const a=s.toLowerCase(),i=l.toLowerCase(),n=a.indexOf(i);return n>=0?e.jsxs(e.Fragment,{children:[s.substring(0,n),e.jsx("strong",{children:s.substring(n,n+l.length)}),s.substring(n+l.length)]}):s},W="_container_10sit_1",X="_suggestionsContainer_10sit_5",Z="_pointer_10sit_12",ee="_highlighted_10sit_17",te="_selectedContainer_10sit_21",g={container:W,suggestionsContainer:X,pointer:Z,highlighted:ee,selectedContainer:te},se=({selectedItems:s,setSelectedItems:l})=>{var I;const[a,i]=b.useState(""),[n,c]=b.useState(!1),[r,m]=b.useState(""),{instanceId:f}=P(),_=w(),{getInstancePackagesQuery:S}=A(),j=Number(f),{data:u,isFetching:o}=S({instance_id:j,available:!0,installed:!1,upgrade:!1,held:!1,limit:50,search:a},{enabled:a.length>2}),p=((I=u==null?void 0:u.data)==null?void 0:I.results)??[],B=t=>!s.map(d=>d.name).includes(t.name),C=p.filter(B),E=t=>{l(s.filter(d=>d.name!==t))},T=()=>{c(!1)},N=()=>{m(""),i("")},y=()=>{r.length>2?c(!0):c(!1)},$=t=>{m(t),t.length>2&&i(t)},F=U(()=>{try{y()}catch(t){_(t)}},G),O=t=>{l([...s,t]),N()},L=t=>{t&&(O(t),c(!1))},q=t=>{t.key==="Escape"?t.currentTarget.blur():F()},v=!n&&r.length<3?"Min 3. characters":p.length===0&&a&&!o?`No packages found by "${a}"`:null;return e.jsxs("div",{className:g.container,children:[e.jsx(z,{onSelect:L,itemToString:()=>"",isOpen:n,children:({getInputProps:t,getItemProps:d,getMenuProps:Q,highlightedIndex:R})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(x.SearchBox,{...t(),placeholder:"Search for available packages",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:r,onChange:$,onClear:N,onBlur:T,onFocus:y,onKeyUp:q}),v?e.jsx("span",{className:"p-form-help-text",children:v}):null,n&&(C.length>0||o)?e.jsx("ul",{className:k("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",g.suggestionsContainer),...Q(),children:o?e.jsx(H,{}):C.map((h,D)=>e.jsxs("li",{className:k("p-list__item",g.pointer,{[g.highlighted]:R===D}),...d({item:h,index:D}),children:[e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:J(h.name,a)}),e.jsx("div",{children:e.jsx("small",{className:"u-text-muted",children:h.available_version})})]},h.name))}):null]})}),e.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:s.length?s.map(t=>e.jsxs("li",{className:k("p-autocomplete__result p-list__item p-card u-no-margin--bottom",g.selectedContainer),children:[e.jsxs("div",{children:[e.jsx("div",{children:t.name}),e.jsx("small",{className:"u-text--muted p-text--small",children:t.available_version})]}),e.jsx(x.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom",onClick:()=>E(t.name),children:e.jsx(x.Icon,{name:x.ICONS.delete})})]},t.name)):null})]})},fe=()=>{const[s,l]=b.useState([]),{instanceId:a,childInstanceId:i}=P(),n=w(),{notify:c}=K(),{packagesActionQuery:r}=A(),{closeSidePanel:m}=V(),{openActivityDetails:f}=M(),_=Number(i??a),{mutateAsync:S,isPending:j}=r,u=async()=>{try{const{data:o}=await S({action:"install",computer_ids:[_],package_ids:s.map(({id:p})=>p)});m(),c.success({title:`You queued ${s.length===1?`package ${s[0].name}`:`${s.length} packages`} to be installed.`,message:`${s.length===1?`${s[0].name} package`:`${s.length} selected packages`} will be installed and are queued in Activities.`,actions:[{label:"Details",onClick:()=>{f(o)}}]})}catch(o){n(o)}};return e.jsxs(e.Fragment,{children:[e.jsx(se,{selectedItems:s,setSelectedItems:o=>{l(o)}}),e.jsx(Y,{submitButtonDisabled:j||s.length===0,submitButtonText:"Install packages",submitButtonAppearance:"positive",onSubmit:u})]})};export{fe as default};
