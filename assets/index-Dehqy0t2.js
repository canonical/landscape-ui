const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-p1qScOfU.js","assets/index-u_EhbhC_.js","assets/index-DWaf_ZwL.css","assets/moment-C5S46NFB.js","assets/InfoItem-DfMbt4qK.js","assets/InfoItem-C-lWh_lY.css","assets/useConfirm-B8tJ1H3c.js","assets/useInstances-iAR4_yRz.js","assets/PageMain-CmLgxdJK.js","assets/PageMain-BIuYvhUI.css","assets/useMutation-CrcSbzv3.js","assets/useFetchOld-BBfSXCp-.js","assets/moment-BMNhdv00.js","assets/TablePagination-B-hCaI46.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-TkE3cuN_.js","assets/EmptyState-BqInhbHc.js","assets/EmptyState-DUn4ZRie.css","assets/SearchHelpPopup-DV4iUDnA.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/NoData-BfY2RoAl.js","assets/index-4jXkfcLF.css"])))=>i.map(i=>d[i]);
import{j as e,h as s,i as D,r as u,_ as F,d as Z,c as ee,f as R,l as S,K as te,e as ie,B as ne}from"./index-u_EhbhC_.js";import{m as ae}from"./moment-BMNhdv00.js";import{T as oe}from"./TablePagination-B-hCaI46.js";import{E as se}from"./EmptyState-BqInhbHc.js";import{S as ce}from"./SearchHelpPopup-DV4iUDnA.js";import{u as w}from"./PageMain-CmLgxdJK.js";import{u as j}from"./useMutation-CrcSbzv3.js";import{u as re}from"./useFetchOld-BBfSXCp-.js";import{u as le}from"./useConfirm-B8tJ1H3c.js";import{u as q}from"./usePageParams-TkE3cuN_.js";import{N as ue}from"./NoData-BfY2RoAl.js";const de=()=>e.jsx(se,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no activities yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage computers in Landscape"})]}),icon:"switcher-environments",title:"No activities found"}),pe="_wrapper_1avtj_1",he="_search_1avtj_9",me="_buttonContainer_1avtj_13",ve="_button_1avtj_13",ye="_icon_1avtj_43",x={wrapper:pe,search:he,buttonContainer:me,button:ve,icon:ye},ge=({inputValue:a,onDescriptionClick:t,onInputChange:c,onSearchClick:y,onClear:h})=>e.jsxs("div",{className:x.wrapper,children:[e.jsx(s.SearchBox,{autocomplete:"off",shouldRefocusAfterReset:!0,externallyControlled:!0,value:a,onChange:c,onSearch:y,onClear:h,className:D("u-no-margin--bottom",x.search)}),e.jsx("div",{className:x.buttonContainer,children:e.jsx("button",{type:"button",onClick:t,className:x.button,children:e.jsx("i",{className:D("p-icon--help",x.icon)})})})]}),_e=u.lazy(()=>F(()=>import("./index-p1qScOfU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])));function B(){const a=re(),t=Z(),c=ee(),{setSidePanelContent:y}=R(),h=(i={},l={})=>w({queryKey:["activities",i],queryFn:()=>t.get("activities",{params:i}),...l}),d=({activityId:i,...l},p={})=>w({queryKey:["activities",{activityId:i,...l}],queryFn:()=>t.get(`activities/${i}`,{params:l}),...p}),r=(i={},l={})=>w({queryKey:["activityTypes"],queryFn:()=>a.get("GetActivityTypes",{params:i}),...l}),g=j({mutationKey:["activities","cancel"],mutationFn:i=>a.get("CancelActivities",{params:i}),onSuccess:()=>c.invalidateQueries({queryKey:["activities"]})}),b=j({mutationKey:["activities","approve"],mutationFn:i=>a.get("ApproveActivities",{params:i}),onSuccess:()=>c.invalidateQueries({queryKey:["activities"]})}),v=j({mutationFn:i=>t.post("activities/reapply",i),onSuccess:()=>c.invalidateQueries({queryKey:["activities"]})}),_=j({mutationFn:i=>t.post("activities/revert",i),onSuccess:()=>c.invalidateQueries({queryKey:["activities"]})});return{getActivitiesQuery:h,getSingleActivityQuery:d,getActivityTypesQuery:r,cancelActivitiesQuery:g,approveActivitiesQuery:b,redoActivitiesQuery:v,undoActivitiesQuery:_,openActivityDetails:i=>{y(i.summary,e.jsx(u.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(_e,{activityId:i.id})}))}}}function be(a){const{state:t}=te(),c=t==null?void 0:t.activity;u.useEffect(()=>{t!=null&&t.activity&&(a(t.activity),window.history.replaceState({},""))},[c])}const fe="_container_honpf_1",xe="_searchContainer_honpf_8",Ae="_select_honpf_12",je="_cta_honpf_17",C={container:fe,searchContainer:xe,select:Ae,cta:je},Ce="_iconError_xphpu_1",Se="_iconWarning_xphpu_5",Te="_iconWarningRed_xphpu_9",$={iconError:Ce,iconWarning:Se,iconWarningRed:Te},E={succeeded:{icon:"success",label:"Succeeded"},scheduled:{icon:"spinner",label:"Scheduled"},waiting:{icon:"status-waiting",label:"Waiting"},undelivered:{icon:"status-queued",label:"Queued"},delivered:{icon:"status-in-progress",label:"In progress"},blocked:{icon:`warning-grey ${$.iconWarningRed}`,label:"Blocked"},unapproved:{icon:`warning-grey ${$.iconWarning}`,label:"Unapproved"},canceled:{icon:"error-grey",label:"Cancelled"},failed:{icon:`error-grey ${$.iconError}`,label:"Failed"}},ke=[{term:"id:<activity_id>",description:"Search for activities with a specific ID."},{term:"parent-id:<parent_id>",description:"Search for children activities of a specific ID."},{term:"created-after:<date>",description:e.jsxs("span",{children:["Search for activities created after a specific date or time, specified with the ISO-8601 format. The precision depends on how far you specify, for example ",e.jsx("code",{children:"2011-01"}),", ",e.jsx("code",{children:"2011-01-01"}),","," ",e.jsx("code",{children:"2011-01-01T10:30"})," are valid values."]})},{term:"created-before:<date>",description:"Search for activities created before a specific date or time. The format is the same as created-after."},{term:"creator:<email>",description:"Search for activities created by a particular person (specified by email address)."},{term:"computer:<criteria>",description:"Search for activities related to the given instances. The criteria is itself another query argument to search instances. See Instance Queries for details."},{term:"type:<type>",description:"Search for activities of a specific type."}],Ne=[{label:"All",value:""},...Object.entries(E).filter(([a])=>a!=="unapproved").map(([a,{label:t}])=>({label:t,value:a}))],we=({resetSelectedIds:a,selectedIds:t})=>{const{search:c,status:y,setPageParams:h}=q(),d=ie(),{confirmModal:r,closeConfirmModal:g}=le(),{approveActivitiesQuery:b,cancelActivitiesQuery:v,redoActivitiesQuery:_,undoActivitiesQuery:f}=B(),[i,l]=u.useState(c),[p,A]=u.useState(!1),{mutateAsync:T,isPending:k}=b,{mutateAsync:n,isPending:m}=v,{mutateAsync:N,isPending:L}=_,{mutateAsync:O,isPending:H}=f,P=()=>{h({search:i,status:y}),a()},K=o=>{h({status:o})},M=()=>{h({search:""})},W=o=>{o.preventDefault(),P()},I=async()=>{try{await T({query:`id:${t.join(" OR id:")}`})}catch(o){d(o)}finally{g()}},U=()=>{r({title:`Approve ${t.length===1?"activity":"activities"}`,body:`Are you sure you want to approve selected ${t.length===1?"activity":"activities"}?`,buttons:[e.jsx(s.Button,{appearance:"positive",onClick:I,children:"Approve"},"approve")]})},V=async()=>{try{await n({query:`id:${t.join(" OR id:")}`})}catch(o){d(o)}finally{g()}},z=()=>{r({title:`Cancel ${t.length===1?"activity":"activities"}`,body:`Are you sure you want to cancel selected ${t.length===1?"activity":"activities"}?`,buttons:[e.jsx(s.Button,{appearance:"positive",onClick:V,children:"Apply"},"cancel")]})},Y=async()=>{try{await N({activity_ids:t})}catch(o){d(o)}finally{g()}},G=()=>{r({title:`Redo ${t.length===1?"activity":"activities"}`,body:`Are you sure you want to redo selected ${t.length===1?"activity":"activities"}?`,buttons:[e.jsx(s.Button,{appearance:"positive",onClick:Y,children:"Redo"},"redo")]})},J=async()=>{try{await O({activity_ids:t})}catch(o){d(o)}finally{g()}},X=()=>{r({title:`Undo ${t.length===1?"activity":"activities"}`,body:`Are you sure you want to undo selected ${t.length===1?"activity":"activities"}?`,buttons:[e.jsx(s.Button,{appearance:"positive",onClick:J,children:"Undo"},"undo")]})};return e.jsxs("div",{className:C.container,children:[e.jsxs("div",{className:C.searchContainer,children:[e.jsx(s.Form,{onSubmit:W,noValidate:!0,children:e.jsx(ge,{inputValue:i,onInputChange:o=>{l(o)},onSearchClick:P,onDescriptionClick:()=>A(!0),onClear:M})}),e.jsx(ce,{open:p,onClose:()=>{A(!1)},data:ke})]}),e.jsx(s.Select,{label:"Status",labelClassName:"u-no-margin--bottom",wrapperClassName:C.select,className:"u-no-margin--bottom",options:Ne,onChange:o=>K(o.target.value),value:y}),e.jsx("div",{className:D("p-segmented-control",C.cta),children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsx(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:U,disabled:t.length===0||k,children:"Approve"}),e.jsx(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:z,disabled:t.length===0||m,children:"Cancel"}),e.jsx(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:X,disabled:t.length===0||H,children:"Undo"}),e.jsx(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:G,disabled:t.length===0||L,children:"Redo"})]})},"buttons")]})},$e="_checkbox_15zhq_1",De="_description_15zhq_5",Q={checkbox:$e,description:De},Ee=u.lazy(()=>F(()=>import("./index-p1qScOfU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))),Ie=({instanceId:a})=>{const[t,c]=u.useState([]),{search:y,status:h,currentPage:d,pageSize:r}=q(),{setSidePanelContent:g}=R(),{getActivitiesQuery:b}=B(),v=`${y}${h?` status:${h}`:""}`,_=n=>{g(n.summary,e.jsx(u.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Ee,{activityId:n.id})}))};be(_);const f=()=>{c([])},{data:i,isLoading:l}=b({query:`${a?`computer:id:${a}`:""} ${v??""}`.trim(),limit:r,offset:(d-1)*r}),p=u.useMemo(()=>(i==null?void 0:i.data.results)??[],[i]),A=()=>{c(n=>n.length?[]:p.map(({id:m})=>m))},T=n=>{c(m=>m.includes(n)?m.filter(N=>N!==n):[...m,n])},k=u.useMemo(()=>[{accessor:"checkbox",className:Q.checkbox,Header:e.jsx(s.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:A,checked:p.length>0&&t.length===p.length,indeterminate:t.length>0&&t.length<p.length}),Cell:({row:n})=>e.jsx(s.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:n.original.summary}),inline:!0,labelClassName:"u-no-margin--bottom u-no-padding--top",checked:t.includes(n.original.id),onChange:()=>{T(n.original.id)}})},{accessor:"summary",className:Q.description,Header:"Description",Cell:({row:n})=>e.jsx(s.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>_(n.original),children:n.original.summary})},{accessor:"activity_status",Header:"Status",Cell:({row:{original:{activity_status:n}}})=>E[n].label,getCellIcon:({row:{original:{activity_status:n}}})=>E[n].icon},{accessor:"creation_time",Header:"Created at",Cell:({row:n})=>e.jsx(e.Fragment,{children:ae(n.original.creation_time).format(ne)})},{accessor:"creator.name",Header:"Creator",Cell:({row:n})=>{var m;return e.jsx(e.Fragment,{children:((m=n.original.creator)==null?void 0:m.name)??e.jsx(ue,{})})}}],[p,t]);return e.jsxs(e.Fragment,{children:[!v&&d===1&&r===50&&l&&e.jsx(S,{}),!v&&d===1&&r===50&&!l&&(!i||!i.data.count)&&e.jsx(de,{}),(!!v||d!==1||r!==50||!l&&i&&i.data.count>0)&&e.jsxs(e.Fragment,{children:[e.jsx(we,{resetSelectedIds:f,selectedIds:t}),e.jsx(s.ModularTable,{emptyMsg:`No activities found with the search ${v}`,columns:k,data:p}),e.jsx(oe,{totalItems:i==null?void 0:i.data.count,currentItemCount:p.length,handleClearSelection:f})]})]})},Fe=u.lazy(()=>F(()=>import("./index-p1qScOfU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))),Ue=a=>e.jsx(u.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Fe,{...a})});export{Ie as A,E as a,Ue as b,B as u};
