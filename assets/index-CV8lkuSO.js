import{e as x,l as R,f as F,j as t,g as u}from"./index-Cgvo6fQq.js";import{u as j}from"./formik.esm-zcnRqfub.js";import{u as C}from"./useRoles-sIUGLpYl.js";import{g as V,a as _,b as I,c as Q}from"./index-BxH_5uei.js";import{P as f,A as O}from"./AccessGroupBlock-C3W0gZUi.js";import{S as $}from"./SidePanelFormButtons-BVcav9Rr.js";import{c as w,b as y,a as c}from"./index.esm-CZHDkGlX.js";import"./useFetchOld-CDdL40Ij.js";import"./useMutation-BlYl6rGT.js";import"./useQuery-BkysfzoD.js";import"./PageMain-CgsCzV83.js";import"./EmptyState-BsWnPxd1.js";import"./TruncatedCell-Cgvmf07L.js";import"./useConfirm-CH1qaKO5.js";import"./useOnClickOutside-C8-jCCi3.js";import"./SidePanelFormButtons.module-DyBJG5lm.js";const B={access_groups:[],description:"",name:"",permissions:[]},N=w().shape({access_groups:y().of(c()),description:c(),name:c().required("This field is required.").matches(/^[a-zA-Z][-+a-zA-Z0-9]*$/,"Name must start with a letter and can contain alphanumeric characters, ‘-‘ and ‘+’."),permissions:y().of(c())}),k=(o,i)=>({accessGroupsToAdd:V(o.access_groups,i),permissionsToAdd:o.permissions.includes("AddComputerToAccessGroup")?[...o.permissions,"RemoveComputerFromAccessGroup"]:o.permissions}),D=(o,i,m)=>{const{addAccessGroups:p,addPermissions:d}=m,r=[],{accessGroupsToAdd:n,permissionsToAdd:a}=k(o,i);return n.length>0&&r.push(p({name:o.name,access_groups:n})),a.length>0&&r.push(d({name:o.name,permissions:a})),r},E=()=>{const o=x(),{notify:i}=R(),{closeSidePanel:m}=F(),{createRoleQuery:p,addPermissionsToRoleQuery:d,addAccessGroupsToRoleQuery:r,getAccessGroupQuery:n,getPermissionsQuery:a}=C(),{data:l}=a(),g=l?_(l.data):[],{data:A}=n(),h=A?I(Q(A.data)):[],{mutateAsync:b}=p,{mutateAsync:P}=d,{mutateAsync:T}=r,s=j({initialValues:B,validationSchema:N,onSubmit:async e=>{await b({description:e.description,name:e.name});const G=D(e,h,{addAccessGroups:T,addPermissions:P});try{await Promise.all(G),m(),i.success({title:"New role has been added",message:`You added the role '${e.name}'`})}catch(S){o(S)}}});return t.jsxs(u.Form,{onSubmit:s.handleSubmit,noValidate:!0,children:[t.jsx(u.Input,{type:"text",label:"Role name",required:!0,autoComplete:"off",...s.getFieldProps("name"),error:s.touched.name&&s.errors.name?s.errors.name:void 0}),t.jsx(u.Input,{type:"text",label:"Description",autoComplete:"off",...s.getFieldProps("description"),error:s.touched.description&&s.errors.description?s.errors.description:void 0}),t.jsx(f,{description:"These permissions are for managing the account as a whole. They are not limited to the specified access groups, but instead apply globally.",onPermissionChange:e=>s.setFieldValue("permissions",e),options:g.filter(({global:e})=>e),permissions:s.values.permissions,title:"Global permissions"}),t.jsx(f,{description:"These permissions only apply to selected access groups.",onPermissionChange:e=>s.setFieldValue("permissions",e),options:g.filter(({global:e})=>!e),permissions:s.values.permissions,title:"Permissions"}),t.jsx(O,{accessGroupOptions:h,accessGroups:s.values.access_groups,onAccessGroupChange:e=>{s.setFieldValue("access_groups",e)}}),t.jsx($,{submitButtonDisabled:s.isSubmitting,submitButtonText:"Add"})]})},is=E;export{is as default};
