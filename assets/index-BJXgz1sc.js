import{O as U,a0 as j,z as S,B as b,j as e,V as I,d as u,x as g,az as L,R as P,r as E,w as p,l as d,i as _,E as v}from"./index-BniO5lih.js";import{u as m}from"./useUsns-r5HiN7yD.js";import{H as k}from"./HeaderWithSearch-S6PnmELF.js";import{U as w}from"./UsnList-CIBCq4Ry.js";import"./constants-HWGNn3R9.js";import"./SelectAllButton-DQS6yqhs.js";import"./ExpandableTableFooter-DavPKb8s.js";const A="_actions_1l3g0_1",N={actions:A},B=({usns:s})=>{const{instanceId:t,childInstanceId:a}=U(),n=j(),i=S(),{notify:c}=b(),{upgradeInstanceUsnsQuery:r}=m(),o=Number(t),{mutateAsync:h,isPending:l}=r,f=()=>{n(P.instances.details.fromParams({instanceId:t,childInstanceId:a},{tab:"activities"})),c.clear()},y=async()=>{try{await h({instanceId:o,usns:s}),c.success({title:"You queued packages to be upgraded",message:`Affected packages for ${g(s.length,`"${s[0]}" security issue`,`${s.length} selected security issues`)} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:f}]})}catch(x){i(x)}};return e.jsxs(e.Fragment,{children:[e.jsx(k,{actions:e.jsx("div",{className:I("p-segmented-control",N.actions),children:e.jsxs(u.ConfirmationButton,{className:"p-segmented-control__button has-icon u-no-margin--bottom",type:"button",disabled:s.length===0,confirmationModalProps:{title:"Upgrade affected packages",children:e.jsxs("p",{children:["This will upgrade affected packages for"," ",g(s.length,`"${s[0]}" security issue`,`${s.length} selected security issues`),"."]}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:l,confirmButtonDisabled:l,onConfirm:y},children:[e.jsx(u.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]})})}),e.jsx(L,{filtersToDisplay:["search"]})]})},C=({instance:s,isUsnsLoading:t,totalUsnCount:a,usns:n})=>{const[i,c]=E.useState([]),{search:r}=p();return e.jsxs(e.Fragment,{children:[e.jsx(B,{usns:i}),e.jsx(w,{tableType:"paginated",instances:[s],isUsnsLoading:t,onSelectedUsnsChange:o=>{c(o)},search:r,selectedUsns:i,totalUsnCount:a,usns:n})]})},T=({currentPage:s,getUsnsQueryLoading:t,pageSize:a,search:n})=>!n&&s===1&&a===d&&t,D=({search:s,currentPage:t,pageSize:a,getUsnsQueryLoading:n,getUsnsQueryResult:i})=>!s&&t===1&&a===d&&!n&&(!i||i.data.results.length===0),F=({currentPage:s,getUsnsQueryLoading:t,getUsnsQueryResult:a,pageSize:n,search:i})=>i||s>1||n!==d||!t&&a&&a.data.results.length>0,R=({instance:s})=>{const{search:t,currentPage:a,pageSize:n}=p(),{getUsnsQuery:i}=m(),{data:c,isLoading:r}=i({computer_ids:[s.id],limit:n,offset:(a-1)*n,search:t,show_packages:!1});return e.jsxs(e.Fragment,{children:[T({search:t,currentPage:a,pageSize:n,getUsnsQueryLoading:r})&&e.jsx(_,{}),D({search:t,currentPage:a,pageSize:n,getUsnsQueryLoading:r,getUsnsQueryResult:c})&&e.jsx(v,{icon:"inspector-debug",title:"No security issues found"}),F({currentPage:a,getUsnsQueryLoading:r,getUsnsQueryResult:c,pageSize:n,search:t})&&e.jsx(C,{instance:s,isUsnsLoading:r,totalUsnCount:c?.data.count??0,usns:c?.data.results??[]})]})};export{R as default};
