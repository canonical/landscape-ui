import{c as I,i as $,k as B,l as R,j as e,r as E,B as P,am as V,d,p as D,q as v,R as L,C as Q,o as U,F as W}from"./index-DVhJuAPo.js";import{S as Y}from"./SidePanelFormButtons-kDYEusMZ.js";import"./index-B0tTVAZI.js";import"./EmployeeGroupIdentityIssuerList-UqPqGFJQ.js";import{u as G}from"./EmployeeList-D0gA-5hV.js";import{D as H}from"./downshift.esm-BJ4JE-Tl.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";import"./HeaderWithSearch-VQme5nSA.js";import"./SidePanelTablePagination-CclnmuZY.js";const M=()=>{const s=I(),n=$(),{mutateAsync:l,isPending:c}=B({mutationKey:["employee","associate"],mutationFn:async({employee_id:t,...o})=>s.post(`employees/${t}/computers`,o),onSuccess:(t,o)=>{n.invalidateQueries({queryKey:["instances",o.computer_id]})}});return{associateEmployeeWithInstance:l,isAssociating:c}},z=()=>{const s=I(),n=$(),{mutateAsync:l,isPending:c}=B({mutationKey:["employee","disassociate"],mutationFn:async({employee_id:t,computer_id:o})=>s.delete(`employees/${t}/computers/${o}`),onSuccess:(t,o)=>{n.invalidateQueries({queryKey:["instances",o.computer_id]})}});return{disassociateEmployeeFromInstance:l,isDisassociating:c}},J=(s,n={})=>{const l=I(),{id:c,...t}=s,{data:o,isPending:u}=R({queryKey:["employee",s],queryFn:async()=>l.get(`employees/${c}`,{params:t}),...n});return{employee:o?.data,isPending:u}},X="_container_cafe2_1",Z="_suggestionsContainer_cafe2_5",ee="_pointer_cafe2_12",se="_highlighted_cafe2_17",te="_selectedContainer_cafe2_21",g={container:X,suggestionsContainer:Z,pointer:ee,highlighted:se,selectedContainer:te},ae=200,ne=(s,n)=>{const l=s.toLowerCase(),c=n.toLowerCase(),t=l.indexOf(c);return t>=0?e.jsxs(e.Fragment,{children:[s.substring(0,t),e.jsx("strong",{children:s.substring(t,t+n.length)}),s.substring(t+n.length)]}):s},oe=({employee:s,setEmployee:n,loadingExistingEmployee:l})=>{const[c,t]=E.useState(""),[o,u]=E.useState(!1),[m,y]=E.useState(""),_=P(),{employees:f,isFetching:p}=G({listenToUrlParams:!1},{search:c,with_groups:!0},{enabled:c.length>2}),S=a=>s?.id!==a.id,b=f.filter(S),j=()=>{n(null)},C=()=>{u(!1)},N=()=>{y(""),t("")},r=()=>{m.length>2?u(!0):u(!1)},F=a=>{y(a),a.length>2&&t(a)},i=V(()=>{try{r()}catch(a){_(a)}},ae),h=a=>{a&&(n(a),u(!1),N())},T=a=>{a.key==="Escape"?a.currentTarget.blur():i()},A=!o&&m.length<3?"Min 3. characters":f.length===0&&c&&!p?`No employees found by "${c}"`:null;return e.jsxs("div",{className:g.container,children:[e.jsx(H,{onSelect:h,itemToString:()=>"",isOpen:o,children:({getInputProps:a,getItemProps:O,getMenuProps:k,highlightedIndex:K})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(d.SearchBox,{...a(),placeholder:"Search for employees",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:m,onChange:F,onClear:N,onBlur:C,onFocus:r,onKeyUp:T}),A?e.jsx("span",{className:"p-form-help-text",children:A}):null,o&&(b.length>0||p)?e.jsx("ul",{className:D("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",g.suggestionsContainer),...k(),children:p?e.jsx(v,{}):b.map((x,w)=>e.jsxs("li",{className:D("p-list__item",g.pointer,{[g.highlighted]:K===w}),...O({item:x,index:w}),children:[e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:ne(x.name,c)}),e.jsx("small",{className:"u-text-muted",children:x.groups?.map(q=>q.name).join(", ")})]},x.id))}):null]})}),l&&e.jsx(v,{}),s&&e.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:e.jsxs("li",{className:D("p-autocomplete__result p-list__item p-card u-no-margin--bottom",g.selectedContainer),children:[e.jsxs("div",{children:[e.jsx("div",{children:s.name}),e.jsx("span",{children:e.jsx("small",{className:"u-text--muted p-text--small",children:s.groups?.map(a=>a.name).join(", ")})})]}),e.jsx(d.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom",onClick:j,children:e.jsx(d.Icon,{name:d.ICONS.delete})})]},s.id)})]})},ie=[{label:"Associate",value:"associate"},{label:"Disassociate",value:"disassociate"}],fe=({instanceTitle:s,employeeId:n})=>{const{instanceId:l,childInstanceId:c}=L(),t=P(),{notify:o}=Q(),{closeSidePanel:u}=U(),m=Number(c??l),{associateEmployeeWithInstance:y,isAssociating:_}=M(),{disassociateEmployeeFromInstance:f,isDisassociating:p}=z(),{employee:S,isPending:b}=J({id:n||0},{enabled:!!n}),j=async i=>{try{await y({computer_id:m,employee_id:i.id}),u(),o.success({title:`You have successfully associated ${i.name}`,message:`${i.name} has been successfully associated with ${s}.`})}catch(h){t(h)}},C=async i=>{try{await f({computer_id:m,employee_id:i.id}),u(),o.success({title:`You have successfully disassociated ${i.name}`,message:`${i.name} has been successfully disassociated from ${s}.`})}catch(h){t(h)}},r=W({initialValues:{action:"associate",employee:S||null},enableReinitialize:!0,onSubmit:async i=>{i.employee&&(i.action==="associate"?await j(i.employee):await C(i.employee))}}),F=!r.values.employee&&r.values.action==="associate"||_||p;return e.jsxs(d.Form,{noValidate:!0,onSubmit:r.handleSubmit,children:[e.jsx(d.Select,{label:"Associate or disassociate an employee",labelClassName:"u-off-screen",options:ie,...r.getFieldProps("action")}),r.values.action==="associate"&&e.jsx(oe,{employee:r.values.employee,setEmployee:async i=>await r.setFieldValue("employee",i),loadingExistingEmployee:n?b:!1}),e.jsx(Y,{submitButtonDisabled:F,submitButtonText:r.values.action==="associate"?"Associate":"Disassociate",submitButtonAppearance:"positive"})]})};export{fe as default};
