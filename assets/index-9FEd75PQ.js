const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-FqYE2tVj.js","assets/index-Dfc97QGW.js","assets/index-CBwtg6kZ.css","assets/AssociationBlock-BvR_yeWx.js","assets/MultiSelectField-fcXogomg.js","assets/MultiSelectField-GyNA33om.css","assets/useGetTags-oA_gPXb8.js","assets/AssociationBlock-vsPH8fvb.css","assets/SidePanelFormButtons-BdOP5SSP.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/SidePanel-BVCSOSpO.js","assets/SidePanel-5ugWznou.css","assets/useRoles-TXLG25Jr.js","assets/useFetchOld-BgGVMMmJ.js","assets/formikErrors-Bw8iTXYS.js","assets/FileInput-Bh7FqDbd.js","assets/useGetInstances-Ccq0NH3v.js","assets/InstancesPageActions-Dns4Yse-.js","assets/index-S_kjB96R.js","assets/NoData-DMN9LLPq.js","assets/ResponsiveTable-ViIMTRR6.js","assets/ResponsiveTable-Czda4kFo.css","assets/TablePagination-B0v8QAQr.js","assets/TableFilterChips-DXWGZ6VK.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-DZURD2KR.css","assets/PageParamFilter-C5PJgjVf.js","assets/TableFilter-BmLRyeMD.js","assets/TableFilter-B85Stwni.css","assets/index-DzMlcK9Q.css","assets/ListTitle-DsIgCqjQ.js","assets/ListTitle-CxCHkD9o.css","assets/StaticLink-BNg3qc2M.js","assets/TruncatedCell-Cf7_euhM.js","assets/Truncated-D8EZCoK1.js","assets/Truncated-uqJp6ujM.css","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-DYtdXwcw.js","assets/index-DiSNWm9B.js","assets/TextConfirmationModal-O9rtHEfo.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/InfoGrid-CrJbMYy5.js","assets/InfoItem-DImpX37B.js","assets/InfoItem-D8nPzgUA.css","assets/InfoGrid-D3QqOHFx.css","assets/InstancesPageActions-ChZMRYY_.css","assets/HeaderWithSearch-cCuZhEhs.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SidePanelTablePagination-D0fGsgDJ.js","assets/ProfileAssociatedInstancesLink-CSFk2VcW.js","assets/PageMain-LS0GxKmV.js","assets/PageMain-30196XJe.css","assets/constants-BTpoIHxf.js","assets/constants-DyJ5Z5BJ.js","assets/table-CdFwMAPu.js","assets/index-PU_JNssD.css"])))=>i.map(i=>d[i]);
import{v as O,f as R,w as h,c as S,J as x,p as T,i,n as _,ac as w,l as E,an as $,z as F,B as D,s as C,j as a,g as Q,ab as V,r as u,d as k,aw as M,x as L,E as H,e as K,$ as v}from"./index-Dfc97QGW.js";import{P as z,a as B,b as U}from"./PageMain-LS0GxKmV.js";import{S as y}from"./SidePanel-BVCSOSpO.js";import{a as W,u as G}from"./TableFilterChips-DXWGZ6VK.js";import{u as Y}from"./useFetchOld-BgGVMMmJ.js";import"./InstancesPageActions-Dns4Yse-.js";import"./index-DiSNWm9B.js";import"./InfoGrid-CrJbMYy5.js";import{H as J}from"./HeaderWithSearch-cCuZhEhs.js";import{P as X}from"./ProfileAssociatedInstancesLink-CSFk2VcW.js";import{L as Z}from"./constants-BTpoIHxf.js";import{L as ee}from"./constants-DyJ5Z5BJ.js";import{L as ae}from"./ListTitle-DsIgCqjQ.js";import{N as te}from"./NoData-DMN9LLPq.js";import{R as se}from"./ResponsiveTable-ViIMTRR6.js";import{T as ne}from"./TruncatedCell-Cf7_euhM.js";import{u as ie}from"./useExpandableRow-DYtdXwcw.js";import{u as re}from"./useRoles-TXLG25Jr.js";import{T as oe}from"./TextConfirmationModal-O9rtHEfo.js";import{c as ce}from"./table-CdFwMAPu.js";function q(){const e=O(),t=R(),r=Y(),l=(n={},o={})=>S({queryKey:["packageProfiles",n],queryFn:async({signal:f})=>t.get("packageprofiles",{params:n,signal:f}),...o}),c=h({mutationFn:async n=>t.post("packageprofiles",n),onSuccess:async()=>e.invalidateQueries({queryKey:["packageProfiles"]})}),d=h({mutationFn:async n=>t.post("packageprofiles",n),onSuccess:async()=>e.invalidateQueries({queryKey:["packageProfiles"]})}),m=h({mutationFn:async n=>r.get("RemovePackageProfile",{params:n}),onSuccess:async()=>e.invalidateQueries({queryKey:["packageProfiles"]})}),p=h({mutationFn:async({name:n,...o})=>t.put(`packageprofiles/${n}`,o),onSuccess:async()=>e.invalidateQueries({queryKey:["packageProfiles"]})}),g=({instanceId:n,...o},f={})=>S({queryKey:["instancePackageProfiles",{instanceId:n,...o}],queryFn:async()=>t.get(`computers/${n}/packages/profile`,{params:o}),...f}),P=({name:n,...o},f={})=>S({queryKey:["packageProfileConstraints",{name:n,...o}],queryFn:async()=>t.get(`packageprofiles/${n}/constraints`,{params:o}),...f}),s=h({mutationFn:async({name:n,...o})=>t.post(`packageprofiles/${n}/constraints`,o),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["packageProfiles"]}),e.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),j=h({mutationFn:async({id:n,name:o,...f})=>t.put(`packageprofiles/${o}/constraints/${n}`,f),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["packageProfiles"]}),e.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),A=h({mutationFn:async({name:n,...o})=>t.delete(`packageprofiles/${n}/constraints`,{params:o}),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["packageProfiles"]}),e.invalidateQueries({queryKey:["packageProfileConstraints"]})])});return{addPackageProfileConstraintsQuery:s,copyPackageProfileQuery:c,createPackageProfileQuery:d,editPackageProfileConstraintQuery:j,editPackageProfileQuery:p,getInstancePackageProfileQuery:g,getPackageProfileConstraintsQuery:P,getPackageProfilesQuery:l,removePackageProfileConstraintsQuery:A,removePackageProfileQuery:m}}const I={constraint:"",notAnyVersion:!1,package:"",rule:"",version:""},Ge=Object.fromEntries(Object.keys(I).map(e=>[e,!0])),Ye={constraint:"",id:0,package:"loading",rule:"",version:"",notAnyVersion:!1},Je=[{label:"Any",value:""},{label:"Newer or equal to",value:">="},{label:"Newer than",value:">"},{label:"Equal to",value:"="},{label:"Older than",value:"<"},{label:"Older or equal to",value:"<="}],Xe=[{label:"Select",value:""},{label:"Conflicts with",value:"conflicts"},{label:"Depends on",value:"depends"}],N=x().of(T().shape({constraint:i().required("Required."),notAnyVersion:_(),package:i().required("Required."),rule:i().when("notAnyVersion",{is:!0,then:e=>e.required("Required.")}),version:i().when("notAnyVersion",{is:!0,then:e=>e.required("Required.")})})).min(1,"Package profiles must have at least one package constraint."),Ze={access_group:w,all_computers:!1,constraints:[I],constraintsType:"",csvFile:null,description:"",isCsvFileParsed:!1,material:"",source_computer_id:0,tags:[],title:""},ea=T().shape({access_group:i(),all_computers:_(),constraints:x().when("constraintsType",{is:"manual",then:()=>N}),constraintsType:i().required("This field is required."),csvFile:$().nullable().test({name:"mime-type",message:"Invalid file type.",test:e=>!e||e.type==="text/csv"}).when("constraintsType",{is:"material",then:e=>e.required("This field is required.")}),description:i().required("This field is required."),isCsvFileParsed:_(),material:i().when("constraintsType",{is:"material",then:e=>e.required("The file cannot be empty.")}),source_computer_id:E().when("constraintsType",{is:"instance",then:e=>e.min(1,"This field is required.")}),tags:x().of(i()),title:i().required("This field is required.")}),aa=T().shape({constraints:N}),ta={constraint:"",id:0,notAnyVersion:!1,package:"",rule:"",version:""},sa=T().shape({constraint:i().required("Required."),id:E(),notAnyVersion:_(),package:i().required("Required."),rule:i().when("notAnyVersion",{is:!0,then:e=>e.required("Required.")}),version:i().when("notAnyVersion",(e,t)=>e[0]?t.required("Required."):t)}),le=({close:e,isOpen:t,packageProfile:r})=>{const l=F(),{notify:c}=D(),{setPageParams:d}=C(),{removePackageProfileQuery:m}=q(),{mutateAsync:p,isPending:g}=m,P=async()=>{try{await p({name:r.name}),d({sidePath:[],profile:""}),c.success({message:`Package profile "${r.name}" removed successfully.`,title:"Package profile removed"})}catch(s){l(s)}finally{e()}};return a.jsx(oe,{isOpen:t,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:g,confirmationText:`remove ${r.title}`,onConfirm:P,close:e,children:a.jsxs("p",{children:['This will remove "',r.title,'" profile. This action is ',a.jsx("b",{children:"irreversible"}),"."]})})},na=T().shape({access_group:i(),all_computers:_(),description:i(),tags:x().of(i()),title:i()}),ia=T().shape({all_computers:_(),description:i(),tags:x().of(i()),title:i().required("This field is required")}),de=()=>a.jsxs(a.Fragment,{children:[a.jsx(J,{}),a.jsx(W,{filtersToDisplay:["search"]})]}),pe=({profile:e})=>{const{createPageParamsSetter:t}=C(),{value:r,setTrue:l,setFalse:c}=Q(),d=t({sidePath:["edit-constraints"],profile:e.name}),m=t({sidePath:["edit"],profile:e.name}),p=t({sidePath:["duplicate"],profile:e.name}),g=[{icon:"edit",label:"Edit","aria-label":`Edit ${e.title} profile`,onClick:m},{icon:"applications",label:"Change package constraints","aria-label":`Change ${e.title} package constraints`,onClick:d},{icon:"canvas",label:"Duplicate","aria-label":`Duplicate ${e.title} profile`,onClick:p}],P=[{icon:"delete",label:"Remove","aria-label":`Remove ${e.title} profile`,onClick:l}];return a.jsxs(a.Fragment,{children:[a.jsx(V,{toggleAriaLabel:`${e.title} profile actions`,actions:g,destructiveActions:P}),a.jsx(le,{close:c,isOpen:r,packageProfile:e})]})},ue=`These instances are not compliant
with the profile. They do not have a
pending activity to become compliant.`,me=`These instances are not compliant
with the profile. They do have a
pending activity to apply its
constraints.`,{getCellProps:ge,getRowProps:Pe}=ce({itemTypeName:"package profile",headerColumnId:"title"}),fe="_description_y3fly_1",he="_noWrap_y3fly_2",b={description:fe,noWrap:he},ye=({packageProfiles:e})=>{const{search:t,createPageParamsSetter:r}=C(),{getAccessGroupQuery:l}=re(),{expandedRowIndex:c,handleExpand:d,getTableRowsRef:m}=ie(),{data:p}=l(),g=u.useMemo(()=>t?e.filter(s=>s.title.toLowerCase().includes(t.toLowerCase())):e,[e,t]),P=u.useMemo(()=>[{...ee,meta:{ariaLabel:({original:s})=>`${s.title} profile title and name`},Cell:({row:{original:s}})=>a.jsxs(ae,{children:[a.jsx(k.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:r({sidePath:["view"],profile:s.name}),children:s.title}),a.jsx("span",{className:"u-text--muted",children:s.name})]})},{accessor:"description",className:b.description,Header:"Description",meta:{ariaLabel:({original:s})=>`${s.title} profile description`}},{accessor:"access_group",Header:"Access group",meta:{ariaLabel:({original:s})=>`${s.title} profile access group`},Cell:({row:{original:{access_group:s}}})=>M(s,p)},{accessor:"tags",Header:"Tags",meta:{ariaLabel:({original:s})=>`${s.title} profile tags`,isExpandable:!0},Cell:({row:{original:{tags:s},index:j}})=>s.length>0?a.jsx(ne,{content:s.map(A=>a.jsx("span",{className:"truncatedItem",children:A},A)),isExpanded:j==c,onExpand:()=>{d(j)},showCount:!0}):a.jsx(te,{})},{accessor:"computers['non-compliant']",meta:{ariaLabel:({original:s})=>`${s.title} profile non-compliant instances`},Header:a.jsxs("div",{className:b.noWrap,children:[a.jsx("span",{children:"Not compliant "}),a.jsx(k.Tooltip,{position:"btm-left",message:ue,children:a.jsx(k.Icon,{name:"help"})})]}),Cell:({row:{original:s}})=>a.jsx(a.Fragment,{children:`${s.computers["non-compliant"].length} ${L(s.computers["non-compliant"].length,"instance")}`})},{accessor:"computers['pending']",meta:{ariaLabel:({original:s})=>`${s.title} profile pending instances`},Header:a.jsxs("div",{className:b.noWrap,children:[a.jsx("span",{children:"Pending "}),a.jsx(k.Tooltip,{position:"btm-left",message:me,children:a.jsx(k.Icon,{name:"help"})})]}),Cell:({row:{original:s}})=>a.jsx(a.Fragment,{children:`${s.computers.pending?.length??0} ${L(s.computers.pending.length,"instance")}`})},{accessor:"computers['constrained']",meta:{ariaLabel:({original:s})=>`${s.title} profile constrained instances`},Header:"Associated",Cell:({row:{original:s}})=>a.jsx(X,{profile:s,count:s.computers.constrained.length,query:`package:${s.id}`})},{...Z,Cell:({row:{original:s}})=>a.jsx(pe,{profile:s})}],[r,c,p,d]);return a.jsx(se,{ref:m,columns:P,data:g,emptyMsg:`No package profiles found with the search "${t}"`,getCellProps:ge(c),getRowProps:Pe(c),minWidth:1200})},ke=()=>{const{createPageParamsSetter:e}=C(),t=e({sidePath:["add"],profile:""});return a.jsx(H,{body:a.jsxs(a.Fragment,{children:[a.jsx("p",{children:"You havenâ€™t added any package profiles yet."}),a.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-packages",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage packages in Landscape"})]}),cta:[a.jsx(k.Button,{type:"button",appearance:"positive",onClick:t,children:"Add package profile"},"add")],title:"No package profiles found"})},_e=({packageProfiles:e=[]})=>a.jsxs(a.Fragment,{children:[a.jsx(de,{}),a.jsx(ye,{packageProfiles:e})]}),Te=()=>{const{getPackageProfilesQuery:e}=q(),{data:t,isLoading:r}=e();return a.jsxs(a.Fragment,{children:[r&&a.jsx(K,{}),!r&&(!t||t.data.result.length===0)&&a.jsx(ke,{}),!r&&t&&t.data.result.length>0&&a.jsx(_e,{packageProfiles:t?.data.result})]})},ve=u.lazy(async()=>v(()=>import("./index-FqYE2tVj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56])).then(e=>({default:e.PackageProfileAddSidePanel}))),xe=u.lazy(async()=>v(()=>import("./index-FqYE2tVj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56])).then(e=>({default:e.PackageProfileConstraintsAddSidePanel}))),Ce=u.lazy(async()=>v(()=>import("./index-FqYE2tVj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56])).then(e=>({default:e.PackageProfileConstraintsEditSidePanel}))),je=u.lazy(async()=>v(()=>import("./index-FqYE2tVj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56])).then(e=>({default:e.PackageProfileDetailsSidePanel}))),Ae=u.lazy(async()=>v(()=>import("./index-FqYE2tVj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56])).then(e=>({default:e.PackageProfileDuplicateSidePanel}))),Se=u.lazy(async()=>v(()=>import("./index-FqYE2tVj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56])).then(e=>({default:e.PackageProfileEditSidePanel}))),be=()=>{const{sidePath:e,lastSidePathSegment:t,createPageParamsSetter:r}=C();G("sidePath",["add","add-constraints","duplicate","edit","edit-constraints","view"]);const l=r({sidePath:["add"],profile:""});return a.jsxs(z,{children:[a.jsx(B,{title:"Package profiles",actions:[a.jsx(k.Button,{type:"button",appearance:"positive",onClick:l,children:"Add package profile"},"add-package-profile")]}),a.jsx(U,{hasTable:!0,children:a.jsx(Te,{})}),a.jsxs(y,{onClose:r({sidePath:[],profile:""}),isOpen:!!e.length,size:t==="add"||t==="add-constraints"||t==="edit-constraints"||t==="view"?"medium":void 0,children:[t==="add"&&a.jsx(y.Suspense,{children:a.jsx(ve,{})},"add"),t==="add-constraints"&&a.jsx(y.Suspense,{children:a.jsx(xe,{})},"add-constraints"),t==="duplicate"&&a.jsx(y.Suspense,{children:a.jsx(Ae,{})},"duplicate"),t==="edit"&&a.jsx(y.Suspense,{children:a.jsx(Se,{})},"edit"),t==="edit-constraints"&&a.jsx(y.Suspense,{children:a.jsx(Ce,{})},"edit-constraints"),t==="view"&&a.jsx(y.Suspense,{children:a.jsx(je,{})},"view")]})]})},ra=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));export{Xe as C,I as E,Ze as I,Ye as L,le as P,Ge as T,ea as V,Je as a,aa as b,sa as c,ta as d,na as e,ia as f,de as g,ye as h,ke as i,ra as j,q as u};
