const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BP5H7Ii4.js","assets/index-BnGQjbY6.js","assets/index-DEuNBe7s.css","assets/moment-C5S46NFB.js","assets/InfoItem-BswH9Yly.js","assets/InfoItem-C-lWh_lY.css","assets/useInstances-CpKKtvcK.js","assets/useFetchOld-DQCAu5Am.js","assets/moment-CgQ6uYrs.js","assets/TablePagination-DcZ99TxS.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-C2L-bJ16.js","assets/SearchHelpPopup-nSh8D6xy.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/NoData-DZVW07Vw.js","assets/index-4jXkfcLF.css"])))=>i.map(i=>d[i]);
import{j as e,E as U,d as c,c as F,r as u,_ as L,h as z,e as Y,i as Q,f as C,g as D,o as T,K as G,q as J,D as X}from"./index-BnGQjbY6.js";import{m as Z}from"./moment-CgQ6uYrs.js";import{T as ee}from"./TablePagination-DcZ99TxS.js";import{S as te}from"./SearchHelpPopup-nSh8D6xy.js";import{u as ie}from"./useFetchOld-DQCAu5Am.js";import{u as q}from"./usePageParams-C2L-bJ16.js";import{N as ne}from"./NoData-DZVW07Vw.js";const ae=()=>e.jsx(U,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no activities yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage computers in Landscape"})]}),icon:"switcher-environments",title:"No activities found"}),oe="_wrapper_1avtj_1",se="_search_1avtj_9",ce="_buttonContainer_1avtj_13",re="_button_1avtj_13",le="_icon_1avtj_43",j={wrapper:oe,search:se,buttonContainer:ce,button:re,icon:le},ue=({inputValue:a,onDescriptionClick:t,onInputChange:s,onSearchClick:g,onClear:m})=>e.jsxs("div",{className:j.wrapper,children:[e.jsx(c.SearchBox,{autocomplete:"off",shouldRefocusAfterReset:!0,externallyControlled:!0,value:a,onChange:s,onSearch:g,onClear:m,className:F("u-no-margin--bottom",j.search)}),e.jsx("div",{className:j.buttonContainer,children:e.jsx(c.Button,{type:"button",onClick:t,className:j.button,children:e.jsx(c.Icon,{name:c.ICONS.help,className:j.icon})})})]}),de=u.lazy(()=>L(()=>import("./index-BP5H7Ii4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])));function R(){const a=ie(),t=z(),s=Y(),{setSidePanelContent:g}=Q(),m=(i={},r={})=>D({queryKey:["activities",i],queryFn:()=>t.get("activities",{params:i}),...r}),d=({activityId:i,...r},p={})=>D({queryKey:["activities",{activityId:i,...r}],queryFn:()=>t.get(`activities/${i}`,{params:r}),...p}),h=(i={},r={})=>D({queryKey:["activityTypes"],queryFn:()=>a.get("GetActivityTypes",{params:i}),...r}),f=C({mutationKey:["activities","cancel"],mutationFn:i=>a.get("CancelActivities",{params:i}),onSuccess:()=>s.invalidateQueries({queryKey:["activities"]})}),_=C({mutationKey:["activities","approve"],mutationFn:i=>a.get("ApproveActivities",{params:i}),onSuccess:()=>s.invalidateQueries({queryKey:["activities"]})}),v=C({mutationFn:i=>t.post("activities/reapply",i),onSuccess:()=>s.invalidateQueries({queryKey:["activities"]})}),y=C({mutationFn:i=>t.post("activities/revert",i),onSuccess:()=>s.invalidateQueries({queryKey:["activities"]})});return{getActivitiesQuery:m,getSingleActivityQuery:d,getActivityTypesQuery:h,cancelActivitiesQuery:f,approveActivitiesQuery:_,redoActivitiesQuery:v,undoActivitiesQuery:y,openActivityDetails:i=>{g(i.summary,e.jsx(u.Suspense,{fallback:e.jsx(T,{}),children:e.jsx(de,{activityId:i.id})}))}}}function pe(a){const{state:t}=G(),s=t==null?void 0:t.activity;u.useEffect(()=>{t!=null&&t.activity&&(a(t.activity),window.history.replaceState({},""))},[s])}const me="_container_honpf_1",he="_searchContainer_honpf_8",ve="_select_honpf_12",ge="_cta_honpf_17",S={container:me,searchContainer:he,select:ve,cta:ge},ye="_iconError_xphpu_1",fe="_iconWarning_xphpu_5",_e="_iconWarningRed_xphpu_9",E={iconError:ye,iconWarning:fe,iconWarningRed:_e},P={succeeded:{icon:"success",label:"Succeeded"},scheduled:{icon:"spinner",label:"Scheduled"},waiting:{icon:"status-waiting",label:"Waiting"},undelivered:{icon:"status-queued",label:"Queued"},delivered:{icon:"status-in-progress",label:"In progress"},blocked:{icon:`warning-grey ${E.iconWarningRed}`,label:"Blocked"},unapproved:{icon:`warning-grey ${E.iconWarning}`,label:"Unapproved"},canceled:{icon:"error-grey",label:"Cancelled"},failed:{icon:`error-grey ${E.iconError}`,label:"Failed"}},be=[{term:"id:<activity_id>",description:"Search for activities with a specific ID."},{term:"parent-id:<parent_id>",description:"Search for children activities of a specific ID."},{term:"created-after:<date>",description:e.jsxs("span",{children:["Search for activities created after a specific date or time, specified with the ISO-8601 format. The precision depends on how far you specify, for example ",e.jsx("code",{children:"2011-01"}),", ",e.jsx("code",{children:"2011-01-01"}),","," ",e.jsx("code",{children:"2011-01-01T10:30"})," are valid values."]})},{term:"created-before:<date>",description:"Search for activities created before a specific date or time. The format is the same as created-after."},{term:"creator:<email>",description:"Search for activities created by a particular person (specified by email address)."},{term:"computer:<criteria>",description:"Search for activities related to the given instances. The criteria is itself another query argument to search instances. See Instance Queries for details."},{term:"type:<type>",description:"Search for activities of a specific type."}],xe=[{label:"All",value:""},...Object.entries(P).filter(([a])=>a!=="unapproved").map(([a,{label:t}])=>({label:t,value:a}))],Ae=({resetSelectedIds:a,selectedIds:t})=>{const{search:s,status:g,setPageParams:m}=q(),d=J(),{approveActivitiesQuery:h,cancelActivitiesQuery:f,redoActivitiesQuery:_,undoActivitiesQuery:v}=R(),[y,b]=u.useState(s),[i,r]=u.useState(!1),{mutateAsync:p,isPending:x}=h,{mutateAsync:N,isPending:A}=f,{mutateAsync:n,isPending:l}=_,{mutateAsync:w,isPending:B}=v,$=()=>{m({search:y,status:g}),a()},O=o=>{m({status:o})},H=()=>{m({search:""})},M=o=>{o.preventDefault(),$()},I=async()=>{try{await p({query:`id:${t.join(" OR id:")}`})}catch(o){d(o)}},K=async()=>{try{await N({query:`id:${t.join(" OR id:")}`})}catch(o){d(o)}},W=async()=>{try{await n({activity_ids:t})}catch(o){d(o)}},V=async()=>{try{await w({activity_ids:t})}catch(o){d(o)}};return e.jsxs("div",{className:S.container,children:[e.jsxs("div",{className:S.searchContainer,children:[e.jsx(c.Form,{onSubmit:M,noValidate:!0,children:e.jsx(ue,{inputValue:y,onInputChange:o=>{b(o)},onSearchClick:$,onDescriptionClick:()=>r(!0),onClear:H})}),e.jsx(te,{open:i,onClose:()=>{r(!1)},data:be})]}),e.jsx(c.Select,{label:"Status",labelClassName:"u-no-margin--bottom",wrapperClassName:S.select,className:"u-no-margin--bottom",options:xe,onChange:o=>O(o.target.value),value:g}),e.jsx("div",{className:F("p-segmented-control",S.cta),children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",disabled:t.length===0||x,confirmationModalProps:{title:`Approve ${t.length===1?"activity":"activities"}`,children:e.jsxs("p",{children:["Are you sure you want to approve selected"," ",t.length===1?"activity":"activities","?"]}),confirmButtonLabel:"Approve",confirmButtonAppearance:"positive",confirmButtonDisabled:x,confirmButtonLoading:x,onConfirm:I},children:"Approve"}),e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",disabled:t.length===0||A,confirmationModalProps:{title:`Cancel ${t.length===1?"activity":"activities"}`,children:e.jsxs("p",{children:["Are you sure you want to cancel selected"," ",t.length===1?"activity":"activities","?"]}),confirmButtonLabel:"Apply",confirmButtonAppearance:"positive",confirmButtonDisabled:A,confirmButtonLoading:A,onConfirm:K},children:"Cancel"}),e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",disabled:t.length===0||B,confirmationModalProps:{title:`Undo ${t.length===1?"activity":"activities"}`,children:e.jsxs("p",{children:["Are you sure you want to undo selected"," ",t.length===1?"activity":"activities","?"]}),confirmButtonLabel:"Undo",confirmButtonAppearance:"positive",confirmButtonDisabled:B,confirmButtonLoading:B,onConfirm:V},children:"Undo"}),e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",disabled:t.length===0||l,confirmationModalProps:{title:`Redo ${t.length===1?"activity":"activities"}`,children:e.jsxs("p",{children:["Are you sure you want to redo selected"," ",t.length===1?"activity":"activities","?"]}),confirmButtonLabel:"Redo",confirmButtonAppearance:"positive",confirmButtonDisabled:l,confirmButtonLoading:l,onConfirm:W},children:"Redo"})]})},"buttons")]})},je="_checkbox_15zhq_1",Ce="_description_15zhq_5",k={checkbox:je,description:Ce},Se=u.lazy(()=>L(()=>import("./index-BP5H7Ii4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),$e=({instanceId:a})=>{const[t,s]=u.useState([]),{search:g,status:m,currentPage:d,pageSize:h}=q(),{setSidePanelContent:f}=Q(),{getActivitiesQuery:_}=R(),v=`${g}${m?` status:${m}`:""}`,y=n=>{f(n.summary,e.jsx(u.Suspense,{fallback:e.jsx(T,{}),children:e.jsx(Se,{activityId:n.id})}))};pe(y);const b=()=>{s([])},{data:i,isLoading:r}=_({query:`${a?`computer:id:${a}`:""} ${v??""}`.trim(),limit:h,offset:(d-1)*h}),p=u.useMemo(()=>(i==null?void 0:i.data.results)??[],[i]),x=()=>{s(n=>n.length?[]:p.map(({id:l})=>l))},N=n=>{s(l=>l.includes(n)?l.filter(w=>w!==n):[...l,n])},A=u.useMemo(()=>[{accessor:"checkbox",className:k.checkbox,Header:e.jsx(c.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:x,checked:p.length>0&&t.length===p.length,indeterminate:t.length>0&&t.length<p.length}),Cell:({row:n})=>e.jsx(c.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:n.original.summary}),inline:!0,labelClassName:"u-no-margin--bottom u-no-padding--top",checked:t.includes(n.original.id),onChange:()=>{N(n.original.id)}})},{accessor:"summary",className:k.description,Header:"Description",Cell:({row:n})=>e.jsx(c.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>y(n.original),children:n.original.summary})},{accessor:"activity_status",Header:"Status",Cell:({row:{original:{activity_status:n}}})=>P[n].label,getCellIcon:({row:{original:{activity_status:n}}})=>P[n].icon},{accessor:"creation_time",Header:"Created at",Cell:({row:n})=>e.jsx(e.Fragment,{children:Z(n.original.creation_time).format(X)})},{accessor:"creator.name",Header:"Creator",Cell:({row:n})=>{var l;return e.jsx(e.Fragment,{children:((l=n.original.creator)==null?void 0:l.name)??e.jsx(ne,{})})}}],[p,t]);return e.jsxs(e.Fragment,{children:[!v&&d===1&&h===50&&r&&e.jsx(T,{}),!v&&d===1&&h===50&&!r&&(!i||!i.data.count)&&e.jsx(ae,{}),(!!v||d!==1||h!==50||!r&&i&&i.data.count>0)&&e.jsxs(e.Fragment,{children:[e.jsx(Ae,{resetSelectedIds:b,selectedIds:t}),e.jsx(c.ModularTable,{emptyMsg:`No activities found with the search ${v}`,columns:A,data:p}),e.jsx(ee,{totalItems:i==null?void 0:i.data.count,currentItemCount:p.length,handleClearSelection:b})]})]})},Te=u.lazy(()=>L(()=>import("./index-BP5H7Ii4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),ke=a=>e.jsx(u.Suspense,{fallback:e.jsx(T,{}),children:e.jsx(Te,{...a})});export{$e as A,P as a,ke as b,R as u};
