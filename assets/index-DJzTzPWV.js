const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CGo83RZ4.js","assets/index-CYddq1Dt.js","assets/index-B4xaleMR.css","assets/MultiSelectField-Gz723sxa.js","assets/MultiSelectField-CD3NDVCz.css","assets/SidePanelFormButtons-y29iSwpX.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/TagsAddConfirmationModal-CJtYBGvz.js","assets/TagsAddConfirmationModal-HDr0Q-Wm.css","assets/useGetTags-CnCFjIwc.js","assets/useRoles-CskDJFuI.js","assets/AssociationBlock-vsPH8fvb.css","assets/index-DyhHNcW-.js","assets/ScriptsTabs-D11am1mG.js","assets/constants-BvfXqWjy.js","assets/TextConfirmationModal-D1Pp81Mj.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/HeaderWithSearch-LK3eyMPY.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-B5TEWRbk.js","assets/ScriptsTabs-DN44MVZt.css","assets/DeliveryBlock-B2uL8WPp.js","assets/DeliveryBlock-VExRkUer.css","assets/ScriptDropdown-BtLfueXX.js","assets/downshift.esm-DfWau1lZ.js","assets/ScriptDropdown-DwZ4WXvX.css","assets/index-Sd1ayBU7.js","assets/CodeEditor-CMX2-5Un.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-CP4BKfCm.js","assets/AttachmentFile-CPOI2Dg1.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-B902W7Hp.js","assets/EmployeeList-B8AgFMIz.js","assets/EmployeeList-DRxY5zMq.css","assets/useGetEmployees-Dbb8t8uu.js","assets/index-DiU0noXl.css","assets/index-DFhP8yW2.js","assets/SidePanelTableFilterChips-BeBEEeX5.js","assets/SidePanelTablePagination-BZmtQkdg.js","assets/Chip-J31nkkkX.js","assets/Chip-R6WqXyae.css","assets/InstanceRemoveFromLandscapeModal-CMc4-rKh.js","assets/useRemoveInstancesFromLandscape-UWrPnLbk.js","assets/WslInstancesEmptyState-IPVytzE6.js","assets/GroupFilter-D4LLilYf.js","assets/WslInstancesEmptyState-CBT5OoUG.css","assets/index-DWa9RADh.css"])))=>i.map(i=>d[i]);
import{l as d,j as t,F as C,d as l,aE as be,b as Y,g as ve,h as _e,i as xe,S as je,v as Ie,ak as we,w as Se,x as Ce,z as R,a as Re,o as ke,Q as Ae,p as Fe,n as Ee,$ as Me,aF as De,aG as Te,Z as _,q as Le,A as S,av as c,M as E,K as i,aC as Q,N as U,s as W,_ as M}from"./index-CYddq1Dt.js";import{T as Pe}from"./TextConfirmationModal-D1Pp81Mj.js";import{C as $e}from"./Chip-J31nkkkX.js";import"./EmployeeList-B8AgFMIz.js";import{u as Be,I as Oe}from"./InstanceRemoveFromLandscapeModal-CMc4-rKh.js";import{u as ze}from"./useRoles-CskDJFuI.js";import"./index-B5TEWRbk.js";import{W as Ne,a as Ve}from"./WslInstancesEmptyState-IPVytzE6.js";const qe="_container_dj78y_1",Ge="_wrapped_dj78y_8",Qe="_innerContainer_dj78y_13",Ue="_button_dj78y_17",We="_titleRow_dj78y_21",I={container:qe,wrapped:Ge,innerContainer:Qe,button:Ue,titleRow:We},Ye=({actions:{destructive:e=[],nondestructive:a=[]},title:g})=>{e=e.filter(s=>!s.excluded),a=a.filter(s=>!s.excluded);const b=[...a,...e],u={nondestructive:[],destructive:[]},[n,v]=d.useState(b),[f,k]=d.useState(u),[D,w]=d.useState(!1),[T,L]=d.useState(0),x=a.filter(s=>s.collapsed).length+e.filter(s=>s.collapsed).length>1,P=(s,h)=>{if(f.destructive.length||f.nondestructive.length)return;if((!s.lastElementChild||s.lastElementChild.getBoundingClientRect().right<=h.getBoundingClientRect().right)&&!x){w(!1);return}w(!0);const y=[],m={nondestructive:[],destructive:[]};a.forEach((p,j)=>{s.children[j].getBoundingClientRect().right>s.getBoundingClientRect().right||p.collapsed&&x?m.nondestructive.push(p):y.push(p)}),e.forEach((p,j)=>{j+=a.length,s.children[j].getBoundingClientRect().right>s.getBoundingClientRect().right||p.collapsed&&x?m.destructive.push(p):y.push(p)}),v(y),k(m)},A=s=>{const h=s?.parentElement?.parentElement;if(!h)return;P(s,h);const y=new ResizeObserver(()=>{const{width:m}=h.getBoundingClientRect();m!==T&&(v(b),k(u),L(m))});return y.observe(h),()=>{y.disconnect()}};return t.jsxs("div",{className:C(I.titleRow,{[I.wrapped]:!n.length}),children:[g,t.jsxs("div",{className:C(I.container,{[I.wrapped]:!n.length}),children:[t.jsx("div",{className:C(I.innerContainer,"p-segmented-control"),children:t.jsx("div",{ref:A,className:"p-segmented-control__list",children:n.map(({collapsed:s,excluded:h,icon:y,label:m,...p})=>t.jsxs(l.Button,{className:C(I.button,"u-no-margin--bottom p-segmented-control__button"),...p,children:[t.jsx(l.Icon,{name:y}),t.jsx("span",{children:m})]},m))})}),D&&t.jsx(be,{hasToggleIcon:!0,toggleLabel:n.length?"More actions":"Actions",toggleClassName:"u-no-margin--bottom",toggleDisabled:[...e,...a].every(s=>s.disabled),actions:f.nondestructive,destructiveActions:f.destructive})]})]})},Ke=()=>{const e=Y(),a=ve(),{mutateAsync:g,isPending:b}=_e({mutationKey:["employee","disassociate"],mutationFn:async({employee_id:u,computer_id:n})=>e.delete(`employees/${u}/computers/${n}`),onSuccess:(u,n)=>{a.invalidateQueries({queryKey:["instances",n.computer_id]})}});return{disassociateEmployeeFromInstance:g,isDisassociating:b}},He=(e,a={})=>{const g=Y(),{id:b,...u}=e,{data:n,isLoading:v}=xe({queryKey:["employees","employee",e],queryFn:async()=>g.get(`employees/${b}`,{params:u}),...a});return{employee:n?.data,isGettingEmployee:v}},Ze=e=>{switch(e.type){case"package":return`/profiles/package?sidePath=view&profile=${e.name}`;case"reboot":return`/profiles/reboot?sidePath=view&profile=${e.id}`;case"removal":return`/profiles/removal?sidePath=view&profile=${e.id}`;case"repository":return`/profiles/repository?search=${e.title}`;case"script":return`/scripts?tab=profiles&sidePath=view&profile=${e.id}`;case"security":return`/profiles/security?sidePath=view&profile=${e.id}`;case"upgrade":return`/profiles/upgrade?sidePath=view&profile=${e.id}`;case"wsl":return`/profiles/wsl?sidePath=view&profile=${e.name}`}},Je=({profile:e})=>t.jsx(je,{to:Ze(e),children:e.title}),Xe={deliver_after:"",deliverImmediately:!0,action:null},et=Ie().shape({deliver_after:Ce().when("deliverImmediately",{is:!1,then:e=>e.required("This field is required").test({message:"Invalid date",test:a=>R(a).isValid()}).test({message:"Date must be in the future",test:a=>R(a).isAfter()})}),deliverImmediately:Se(),action:we().oneOf(["shutdown","reboot"]).required()}),tt="_headerContainer_10wnq_1",st="_status_10wnq_6",at="_heading_10wnq_12",B={headerContainer:tt,status:st,heading:at},it=d.lazy(async()=>M(()=>import("./index-CGo83RZ4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),ot=d.lazy(async()=>M(()=>import("./index-DyhHNcW-.js"),__vite__mapDeps([13,14,1,2,15,11,16,17,18,19,20,21,22,23,5,6,7,24,25,26,27,28,29,30,31,32,33,34,35])).then(e=>({default:e.RunInstanceScriptForm}))),lt=d.lazy(async()=>M(()=>import("./index-B902W7Hp.js"),__vite__mapDeps([36,1,2,5,6,7,37,15,38,27,39,40]))),nt=d.lazy(async()=>M(()=>import("./index-DFhP8yW2.js"),__vite__mapDeps([41,1,2,42,43,16,17,44,45,37,15,38,46,47,11,22,48,49,18,19,50,51]))),rt=({instance:e})=>{const{isFeatureEnabled:a}=Re(),g=ke(),b=Ae(),{notify:u}=Fe(),{setSidePanelContent:n}=Ee(),{openActivityDetails:v}=Me(),{employee:f,isGettingEmployee:k}=He({id:e.employee_id??0},{enabled:!!e.employee_id}),{restartInstances:D,isRestartingInstances:w}=De(),{getAccessGroupQuery:T}=ze(),{sanitizeInstance:L,isSanitizingInstance:x}=Be(),{shutDownInstances:P,isShuttingDownInstances:A}=Te(),{disassociateEmployeeFromInstance:s,isDisassociating:h}=Ke(),{value:y,setTrue:m,setFalse:p}=_(),{value:j,setTrue:K,setFalse:H}=_(),{value:Z,setTrue:J,setFalse:X}=_(),{value:ee,setTrue:te,setFalse:se}=_(),{value:ae,setTrue:ie,setFalse:oe}=_(),{value:le,setTrue:ne,setFalse:O}=_(),{value:re,setTrue:ce,setFalse:z}=_(),{data:N,isPending:de}=T(),r=Le({initialValues:Xe,validationSchema:et,onSubmit:async o=>{if(!o.action)return;const q={computer_ids:[e.id],deliver_after:o.deliverImmediately?void 0:`${o.deliver_after}:00Z`};try{const{data:$}=o.action==="reboot"?await D(q):await P(q),G=o.action==="reboot"?"restarted":"shut down";u.success({title:`You queued "${e.title}" to be ${G}`,message:`Instance "${e.title}" will be ${G} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{v($)}}]})}catch($){g($)}}});if(de||k)return t.jsx(S,{});const ue=async()=>{try{const{data:o}=await L({computer_id:e.id,computer_title:e.title});u.success({title:`You have successfully marked ${e.title} to be sanitized.`,message:"An activity has been queued to sanitize it. The data will be permanently irrecoverable once complete.",actions:[{label:"View details",onClick:()=>{v(o)}}]})}catch(o){g(o)}finally{O()}},me=()=>{n("Edit instance",t.jsx(d.Suspense,{fallback:t.jsx(S,{}),children:t.jsx(it,{instance:e})}))},pe=()=>{n("Run script",t.jsx(d.Suspense,{fallback:t.jsx(S,{}),children:t.jsx(ot,{parentAccessGroup:e.access_group,query:`id:${e.id}`})}))},he=()=>{n(`Associate employee with ${e.title}`,t.jsx(d.Suspense,{fallback:t.jsx(S,{}),children:t.jsx(lt,{instanceTitle:e.title})}))},ye=()=>{n(`Active profiles associated with ${e.title}`,t.jsx(d.Suspense,{fallback:t.jsx(S,{}),children:t.jsx(nt,{instance:e})}),"medium")},ge=async()=>{try{await s({computer_id:e.id,employee_id:e.employee_id??0}),z(),u.success({title:`You have successfully disassociated ${f?.name??"the employee"}.`,message:`${f?.name??"The employee"} has been successfully disassociated from ${e.title}.`})}catch(o){g(o)}},F=async o=>{await r.setFieldValue("action",o),r.handleSubmit()},V=()=>{b("/instances",{replace:!0})},fe=N?N.data:[];return t.jsxs(t.Fragment,{children:[t.jsx(Ye,{title:t.jsxs("div",{className:B.headerContainer,children:[t.jsx("h2",{className:C("p-heading--4 u-no-padding--top",B.heading),children:e.title}),e.is_wsl_instance&&t.jsx($e,{value:"WSL instance"})]}),actions:{nondestructive:[{icon:"edit",label:"Edit",onClick:me},{icon:"restart",label:"Restart",onClick:m,excluded:!c(e).power},{icon:"power-off",label:"Shut down",onClick:K,excluded:!c(e).power},{icon:"code",label:"Run script",onClick:pe,excluded:!c(e).scripts},{icon:l.ICONS.user,label:"Associate employee",onClick:he,collapsed:!0,excluded:!a("employee-management")||!c(e).employees||e.employee_id!==null},{icon:l.ICONS.user,label:"Disassociate employee",onClick:ce,collapsed:!0,excluded:!a("employee-management")||!c(e).employees||e.employee_id===null}],destructive:[{icon:"restart",label:"Reinstall",onClick:J,collapsed:!0,excluded:!c(e).uninstallation},{icon:"close",label:"Uninstall",onClick:te,collapsed:!0,excluded:!c(e).uninstallation},{icon:l.ICONS.delete,label:"Remove from Landscape",onClick:ie,collapsed:!0},{icon:"tidy",label:"Sanitize",onClick:ne,collapsed:!0,excluded:!c(e).sanitization}]}},e.employee_id??"no-employee"),t.jsxs(E,{children:[t.jsx(E.Item,{title:"Status",children:t.jsxs(i,{children:[t.jsx(i.Item,{label:"Status",value:t.jsxs("div",{className:B.status,children:[t.jsx(l.Icon,{name:Q(e).icon??""}),t.jsx("span",{children:Q(e).label})]})}),t.jsx(i.Item,{label:"Last ping time",value:R(e.last_ping_time).isValid()?R(e.last_ping_time).format(U):null}),t.jsx(i.Item,{label:"Access group",value:fe.find(o=>o.name===e.access_group)?.title||e.access_group}),t.jsx(i.Item,{label:"Tags",value:e.tags.join(", ")||null,type:"truncated"}),t.jsx(i.Item,{label:"Profiles",value:e.profiles?.length?e.profiles.length===1?t.jsx(Je,{profile:e.profiles[0]}):t.jsxs(l.Button,{type:"button",className:"u-no-margin",appearance:"link",onClick:ye,children:[e.profiles.length," profiles"]}):null,type:"truncated"}),c(e).employees&&t.jsx(i.Item,{label:"Associated employee",value:f?.name})]})}),t.jsx(E.Item,{title:"Registration details",children:t.jsxs(i,{children:[t.jsx(i.Item,{label:"Hostname",value:e.hostname}),t.jsx(i.Item,{label:"ID",value:e.id}),c(e).hardware&&t.jsx(i.Item,{label:"Serial number",value:e.grouped_hardware?.system.serial}),c(e).hardware&&t.jsx(i.Item,{label:"Product identifier",value:e.grouped_hardware?.system.model}),t.jsx(i.Item,{label:"OS",value:e.distribution_info?.description}),c(e).hardware&&t.jsx(i.Item,{label:"IP addresses",value:Array.isArray(e.grouped_hardware?.network)?e.grouped_hardware.network.map(o=>o.ip).join(", "):null,type:"truncated"}),t.jsx(i.Item,{label:"Registered",value:R(e.registered_at).format(U)})]})}),t.jsx(E.Item,{title:"Other",children:t.jsxs(i,{children:[t.jsx(i.Item,{label:"Annotations",value:null}),t.jsx(i.Item,{label:"Comment",value:e.comment||null})]})})]}),y&&t.jsx(l.ConfirmationModal,{close:p,title:"Restart instance",confirmButtonLabel:"Restart",confirmButtonAppearance:"positive",confirmButtonDisabled:w,confirmButtonLoading:w,onConfirm:async()=>F("reboot"),children:t.jsxs(l.Form,{onSubmit:async()=>F("reboot"),noValidate:!0,children:[t.jsx(l.CheckboxInput,{label:"Deliver as soon as possible",...r.getFieldProps("deliverImmediately"),checked:r.values.deliverImmediately}),t.jsx(l.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...r.getFieldProps("deliver_after"),disabled:r.values.deliverImmediately,error:W(r,"deliver_after")}),t.jsxs("p",{children:['This will restart "',e.title,'" instance.']})]})}),j&&t.jsx(l.ConfirmationModal,{close:H,title:"Shut down instance",confirmButtonLabel:"Shut down",confirmButtonAppearance:"positive",confirmButtonDisabled:A,confirmButtonLoading:A,onConfirm:async()=>F("shutdown"),children:t.jsxs(l.Form,{onSubmit:async()=>F("shutdown"),noValidate:!0,children:[t.jsx(l.CheckboxInput,{label:"Deliver as soon as possible",...r.getFieldProps("deliverImmediately"),checked:r.values.deliverImmediately}),t.jsx(l.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...r.getFieldProps("deliver_after"),disabled:r.values.deliverImmediately,error:W(r,"deliver_after")}),t.jsxs("p",{children:['This will shut down "',e.title,'" instance.']})]})}),re&&t.jsx(l.ConfirmationModal,{close:z,title:`Disassociate employee from ${e.title}`,confirmButtonLabel:"Disassociate",confirmButtonAppearance:"negative",confirmButtonDisabled:h,confirmButtonLoading:h,onConfirm:ge,children:t.jsxs("p",{children:["You are about to disassociate instance ",e.title," from"," ",f?.name,". This will revoke their access to the instance’s details and recovery key."]})}),e.is_wsl_instance&&t.jsxs(t.Fragment,{children:[t.jsx(Ne,{close:X,instances:[{name:e.title,computer_id:e.id}],isOpen:Z,windowsInstance:e}),t.jsx(Ve,{close:se,instances:[{name:e.title,computer_id:e.id}],isOpen:ee,onSuccess:V,parentId:e.parent.id})]}),t.jsx(Oe,{close:oe,instance:e,isOpen:ae,onSuccess:V}),t.jsx(Pe,{isOpen:le,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:x,confirmButtonLoading:x,onConfirm:ue,close:O,confirmationText:`sanitize ${e.title}`,title:"Sanitize instance",children:t.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",e.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})},bt=Object.freeze(Object.defineProperty({__proto__:null,default:rt},Symbol.toStringTag,{value:"Module"}));export{Je as P,bt as i};
