const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-P9liSqMa.js","assets/index-D7L52Usx.js","assets/index-D38JayDC.css","assets/UdebCheckboxInput-o_0B9_k5.js","assets/UdebCheckboxInput-mCgCMP_S.css","assets/debug-DNZdc8BH.js","assets/useGPGKeys-CIDs8xs3.js","assets/useFetchOld-CWYny7Ul.js","assets/debug-CHNhm1j1.css","assets/MultiSelectField-8ySbsJSv.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-DZRMrQBu.js","assets/SidePanelFormButtons.module-C5v714vX.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/formikErrors-BUNw6La4.js","assets/constants-QAUlYMep.js","assets/usePageParams-Dca0RWLJ.js","assets/NoData-B53LG0Lk.js","assets/index-aoW6kjiK.js","assets/TablePagination-DjfTN4E-.js","assets/TablePaginationBase-BoY31WVq.js","assets/TablePaginationBase-CJl3HN1X.css","assets/StatusFilter-BakkenLf.js","assets/TableFilter-x1KXuSMG.js","assets/TableFilter-DXBG6q86.css","assets/TableFilterChips-O4uz0lGb.js","assets/TableFilterChips-CHqetGbX.css","assets/index-geI-abAU.css","assets/constants-DhXkDRlN.css"])))=>i.map(i=>d[i]);
import{r as m,j as e,g as c,B as ce,p as ie,f as le,m as w,n as F,_ as de}from"./index-D7L52Usx.js";import{S as me}from"./SidePanelTablePagination-CgqlZbTr.js";import"./usePageParams-Dca0RWLJ.js";import{f as ge,p as ue}from"./constants-QAUlYMep.js";import"./TablePaginationBase-BoY31WVq.js";import"./useFetchOld-CWYny7Ul.js";import"./NoData-B53LG0Lk.js";import"./index-aoW6kjiK.js";import"./TablePagination-DjfTN4E-.js";import"./StatusFilter-BakkenLf.js";import"./TableFilter-x1KXuSMG.js";import"./TableFilterChips-O4uz0lGb.js";const fe="_version_sfav3_1",pe="_content_sfav3_5",A={version:fe,content:pe},he=({isUpload:o,packagesToShow:n,search:s,selectedPackages:l,setSelectedPackages:u})=>{const g=m.useMemo(()=>[{accessor:"packageName",Header:({rows:a})=>o?e.jsxs(e.Fragment,{children:[e.jsx(c.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),disabled:!a.length,indeterminate:!!l.length&&l.length<a.length,checked:l.length===a.length&&!!l.length,onChange:()=>{u(d=>d.length?[]:a.map((p,x)=>x))}}),e.jsx("span",{children:"Package"})]}):"Package",Cell:({row:a})=>o?e.jsx(c.CheckboxInput,{inline:!0,label:a.original.packageName,checked:l.includes(a.index),onChange:()=>{u(d=>d.includes(a.index)?d.filter(p=>p!==a.index):[...d,a.index])}}):a.original.packageName},{accessor:"packageVersion",Header:"Version",getCellIcon:({row:a})=>a.original.difference?"warning":!1,className:A.version,Cell:({row:a})=>a.original.difference?e.jsx(c.Tooltip,{position:"top-center",message:a.original.difference==="delete"?"Package deleted":`Version differs
from parent pocket.
Parent version:
${a.original.newVersion}`,children:e.jsx("span",{children:a.original.packageVersion})}):a.original.packageVersion}],[n,l.length]);return e.jsx(c.ModularTable,{columns:g,data:n,emptyMsg:s?`No packages found with the search: "${s}".`:void 0,className:A.content,getCellProps:({column:a})=>{switch(a.id){case"packageName":return{role:"rowheader"};case"packageVersion":return{"aria-label":"Version"};default:return{}}}})},Pe="_ctaRow_qlsck_1",ke={ctaRow:Pe},xe=m.lazy(async()=>de(()=>import("./index-P9liSqMa.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]))),k=1,Q=20,Te=({distributionName:o,pocket:n,seriesName:s})=>{const[l,u]=m.useState(k),[g,a]=m.useState(Q),[d,p]=m.useState([]),[x,H]=m.useState(!1),[y,V]=m.useState(""),[j,_]=m.useState(""),R=ce("(max-width: 619px)"),B=ie(),{setSidePanelContent:O,closeSidePanel:U}=le(),{listPocketQuery:q,diffPullPocketQuery:K,pullPackagesToPocketQuery:G,syncMirrorPocketQuery:J,removePackagesFromPocketQuery:W,removePocketQuery:X}=ge(),{mutate:Y,isPending:D}=J,{mutate:Z,isPending:T}=G,N=()=>{n.mode==="mirror"?Y({name:n.name,series:s,distribution:o}):n.mode==="pull"&&Z({name:n.name,series:s,distribution:o})},ee=()=>{O(`Edit ${n.name} pocket`,e.jsx(m.Suspense,{fallback:e.jsx(F,{}),children:e.jsx(xe,{pocket:n,distributionName:o,seriesName:s})}))},{mutateAsync:ne,isPending:v}=X,ae=async()=>{try{await ne({distribution:o,series:s,name:n.name}),U()}catch(t){B(t)}},{mutateAsync:te,isPending:b}=W,E=!D&&!T&&!b&&!v,{data:S,isLoading:M}=q({name:n.name,series:s,distribution:o,search:j,limit:g,offset:l*g-g},{enabled:E}),C=(S==null?void 0:S.data)??{count:0,results:[]},f=C.results.map(t=>({packageName:t.name,packageVersion:t.version})),{data:$}=K({name:n.name,series:s,distribution:o},{enabled:n.mode==="pull"&&!M&&E}),z=($==null?void 0:$.data)??{},h=[];for(const t in z){const r={add:[],update:[],delete:[],...z[t]};for(const[i,P]of r.add)h.push({packageName:i,newVersion:P,difference:"add"});(r.update.length||r.delete.length)&&H(!0);for(const[i,,P]of r.update)h.push({packageName:i,newVersion:P,difference:"update"});for(const[i]of r.delete)h.push({packageName:i,difference:"delete",newVersion:""})}const oe=()=>x?(f.forEach((t,r)=>{const i=h.find(({packageName:P})=>t.packageName===P);i&&(f[r].difference=i.difference,i.newVersion!==""&&(f[r].newVersion=i.newVersion))}),[...f.filter(({difference:t})=>t),...f.filter(({difference:t})=>!t)]):f,I=m.useMemo(()=>oe(),[l,g,j,x,f.length,h.length]),se=async()=>{const t=I.filter((r,i)=>d.includes(i)).map(({packageName:r})=>r);try{await te({name:n.name,series:s,distribution:o,packages:t})}catch(r){B(r)}},L=!j&&l===k&&g===Q&&!C.count,re=n.mode==="upload"?{size:8,medium:4}:{size:6,medium:3};return e.jsxs(e.Fragment,{children:[e.jsxs(c.Row,{className:w("u-no-padding--left u-no-padding--right",ke.ctaRow),children:[e.jsx(c.Col,{...re,children:e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[n.mode!=="upload"&&e.jsx(c.Button,{className:"p-segmented-control__button",type:"button",onClick:N,disabled:D&&T,"aria-label":n.mode==="mirror"?`Synchronize ${n.name} pocket of ${o}/${s}`:`Pull packages to ${n.name} pocket of ${o}/${s}`,children:n.mode==="mirror"?"Sync":"Pull"}),e.jsx(c.Button,{className:"p-segmented-control__button",type:"button",onClick:ee,"aria-label":`Edit ${n.name} pocket of ${o}/${s}`,children:"Edit"}),e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button",type:"button","aria-label":`Remove ${n.name} pocket of ${o}/${s}`,confirmationModalProps:{title:"Deleting pocket",children:e.jsxs("p",{children:["Do you really want to delete ",n.name," pocket from"," ",s," series of ",o," distribution?"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:v,confirmButtonLoading:v,onConfirm:ae},children:"Remove"}),n.mode==="upload"&&e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:!d.length||b,"aria-label":`Remove selected packages from ${n.name} pocket of ${o}/${s}`,confirmationModalProps:{title:"Deleting packages from pocket",children:e.jsxs("p",{children:["This will delete ",d.length," selected"," ",ue(d.length,"package","packages")," ","from ",n.name," pocket ",s," series of"," ",o," distribution"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:b,confirmButtonLoading:b,onConfirm:se},children:"Remove packages"})]})})}),n.mode!=="upload"&&!L&&e.jsx(c.Col,{size:6,medium:3,children:e.jsx(c.Form,{onSubmit:t=>{t.preventDefault(),_(y),u(k)},noValidate:!0,children:e.jsx(c.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,"aria-label":"Package search",onChange:t=>{V(t)},value:y,onClear:()=>{V(""),_(""),u(k)},className:w({"is-dense":!R,"u-no-margin--bottom":R}),onSearch:()=>{_(y),u(k)},autocomplete:"off"})})})]}),M?e.jsx(F,{}):L?e.jsx("p",{children:"No packages found"}):e.jsxs(e.Fragment,{children:[e.jsx(he,{isUpload:n.mode==="upload",packagesToShow:I,search:j,selectedPackages:d,setSelectedPackages:p}),e.jsx(me,{currentPage:l,totalItems:C.count,paginate:t=>{p([]),u(t)},pageSize:g,setPageSize:t=>{a(t)}})]})]})};export{Te as default};
