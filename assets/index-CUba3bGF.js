const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dau-LdDI.js","assets/index-_k3Mqmx0.js","assets/index-QfA8j4AK.css","assets/index-C-Cemkxt.css"])))=>i.map(i=>d[i]);
import{f,j as t,g as a,r as c,n as k,_ as C,h as P,k as o,i as S,p as q,z as F,s as B}from"./index-_k3Mqmx0.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new e.Error().stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="0e77e3cb-e3e1-42bf-87f2-8da2686bdc24",e._sentryDebugIdIdentifier="sentry-dbid-0e77e3cb-e3e1-42bf-87f2-8da2686bdc24")}catch{}const E="_container_18vdw_1",N="_backButton_18vdw_14",T="_chevronIcon_18vdw_19",l={container:E,backButton:N,chevronIcon:T},A=c.lazy(()=>C(()=>import("./index-Dau-LdDI.js"),__vite__mapDeps([0,1,2,3]))),D=({action:e})=>{const{closeSidePanel:r,setSidePanelContent:i}=f(),u=()=>{i("Choose an identity provider",t.jsx(c.Suspense,{fallback:t.jsx(k,{}),children:t.jsx(A,{})}))};return t.jsxs("div",{className:l.container,children:[e==="add"&&t.jsxs(a.Button,{type:"button",hasIcon:!0,onClick:u,className:l.backButton,children:[t.jsx(a.Icon,{name:"chevron-up",className:l.chevronIcon}),t.jsx("span",{children:"Back"})]}),t.jsx(a.Button,{type:"button",onClick:r,appearance:"base",className:"u-no-margin--bottom",children:"Cancel"}),t.jsx(a.Button,{type:"submit",appearance:"positive",className:"u-no-margin--bottom",children:e==="edit"?"Save changes":"Add ID provider"})]})},V={client_id:"",client_secret:"",enabled:!1,issuer:"",name:""},L=e=>P().shape({client_id:(e==null?void 0:e.provider)==="ubuntu-one"?o():o().required("This field is required"),client_secret:(e==null?void 0:e.provider)==="ubuntu-one"?o():o().required("This field is required"),enabled:S(),issuer:(e==null?void 0:e.provider)==="ubuntu-one"?o():o().url().required("This field is required"),name:(e==null?void 0:e.provider)==="ubuntu-one"?o():o().required("This field is required")}),$="_urlContainer_3ww2d_1",U="_url_3ww2d_1",_={urlContainer:$,url:U},H=e=>{const{action:r,provider:i}=e,u=q(),{closeSidePanel:h}=f(),{getSingleProviderQuery:p,addProviderQuery:g,updateProviderQuery:x,toggleUbuntuOneQuery:y}=F(),{data:s}=p({providerId:r==="edit"?i.id:0},{enabled:r==="edit"&&i.provider!=="ubuntu-one"}),{mutateAsync:I}=g,{mutateAsync:j}=x,{mutateAsync:v}=y,n=B({initialValues:V,onSubmit:async d=>{const m={configuration:{issuer:d.issuer,client_id:d.client_id,client_secret:d.client_secret,name:d.name,provider:r==="add"?i.provider_slug:i.provider},enabled:d.enabled};try{r==="add"?await I(m):i.provider==="ubuntu-one"?await v({ubuntu_one:d.enabled}):await j({...m,providerId:i.id}),h()}catch(w){u(w)}},validationSchema:L(r==="edit"?i:null)});c.useEffect(()=>{r!=="edit"||i.provider!=="ubuntu-one"||n.setFieldValue("enabled",i.enabled)},[r,i]),c.useEffect(()=>{s&&n.setValues({client_id:s.data.configuration.client_id,client_secret:s.data.configuration.client_secret,enabled:s.data.enabled,issuer:s.data.configuration.issuer,name:s.data.configuration.name})},[s]);const b=r==="edit"&&!e.canBeDisabled&&(s==null?void 0:s.data.enabled);return t.jsxs(a.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:[(r!=="edit"||i.provider!=="ubuntu-one")&&t.jsxs("div",{className:_.urlContainer,children:[t.jsx("span",{children:"Redirect URL "}),t.jsx(a.Icon,{name:"information"}),t.jsx("code",{className:_.url,children:r==="add"?i.redirect_uri:s==null?void 0:s.data.redirect_uri}),t.jsx("p",{className:"p-text--small u-text--muted u-no-margin--bottom",children:"You will need to set this in the configuration of your identity provider."})]}),t.jsx(a.Tooltip,{message:b&&"At least one identity provider must be active on the Landscape account.",children:t.jsx(a.Input,{type:"checkbox",label:"Enabled",...n.getFieldProps("enabled"),checked:n.values.enabled,disabled:b,help:`If checked the identity provider will be enabled ${r==="add"?"when it is created.":"for logging in."}`})}),(r!=="edit"||i.provider!=="ubuntu-one")&&t.jsxs(t.Fragment,{children:[t.jsx(a.Input,{type:"text",label:"Name",required:!0,...n.getFieldProps("name"),autoComplete:"off",error:n.touched.name&&n.errors.name?n.errors.name:void 0}),t.jsx(a.Input,{type:"text",label:"Client ID",required:!0,...n.getFieldProps("client_id"),autoComplete:"off",error:n.touched.client_id&&n.errors.client_id?n.errors.client_id:void 0}),t.jsx(a.Input,{type:"text",label:"Client Secret",required:!0,...n.getFieldProps("client_secret"),autoComplete:"off",error:n.touched.client_secret&&n.errors.client_secret?n.errors.client_secret:void 0}),t.jsx(a.Input,{type:"url",label:"Issuer",required:!0,...n.getFieldProps("issuer"),autoComplete:"off",error:n.touched.issuer&&n.errors.issuer?n.errors.issuer:void 0})]}),t.jsx(D,{action:r})]})};export{H as default};
