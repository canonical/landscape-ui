import{O as j,c as l,a as b,A as U,B as I,j as s,o as P,n as g,x as p,ak as S,r as $,p as k,E as v}from"./index-2G8kPGdZ.js";import{u as m}from"./useUsns-BChDylpS.js";import{H as L}from"./HeaderWithSearch-BARHGHUj.js";import{U as N}from"./UsnList-BF5FTEo3.js";import"./SelectAllButton-Ca3aLYB1.js";import"./ExpandableTableFooter-BsJSTyvW.js";import"./TruncatedCell-CXgY3D1d.js";const _="_actions_1l3g0_1",w={actions:_},A=({usns:t})=>{const{instanceId:c,childInstanceId:a}=j(),{setPageParams:n}=l(),o=b(),e=U(),{notify:i}=I(),{upgradeInstanceUsnsQuery:r}=m(),d=Number(c),{mutateAsync:h,isPending:u}=r,f=()=>{o(`/instances/${a?`${d}/${a}`:`${d}`}`),n({tab:"activities"}),i.clear()},x=async()=>{try{await h({instanceId:d,usns:t}),i.success({title:"You queued packages to be upgraded",message:`Affected packages for ${p(t.length,`"${t[0]}" security issue`,`${t.length} selected security issues`)} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:f}]})}catch(y){e(y)}};return s.jsxs(s.Fragment,{children:[s.jsx(L,{actions:s.jsx("div",{className:P("p-segmented-control",w.actions),children:s.jsxs(g.ConfirmationButton,{className:"p-segmented-control__button has-icon u-no-margin--bottom",type:"button",disabled:t.length===0,confirmationModalProps:{title:"Upgrade affected packages",children:s.jsxs("p",{children:["This will upgrade affected packages for"," ",p(t.length,`"${t[0]}" security issue`,`${t.length} selected security issues`),"."]}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:u,confirmButtonDisabled:u,onConfirm:x},children:[s.jsx(g.Icon,{name:"change-version"}),s.jsx("span",{children:"Upgrade"})]})})}),s.jsx(S,{filtersToDisplay:["search"]})]})},B=({instance:t,isUsnsLoading:c,totalUsnCount:a,usns:n})=>{const[o,e]=$.useState([]),{search:i}=l();return s.jsxs(s.Fragment,{children:[s.jsx(A,{usns:o}),s.jsx(N,{tableType:"paginated",instances:[t],isUsnsLoading:c,onSelectedUsnsChange:r=>e(r),search:i,selectedUsns:o,totalUsnCount:a,usns:n})]})},z=({instance:t})=>{const{search:c,currentPage:a,pageSize:n}=l(),{getUsnsQuery:o}=m(),{data:e,isLoading:i}=o({computer_ids:[t.id],limit:n,offset:(a-1)*n,search:c,show_packages:!1});return s.jsxs(s.Fragment,{children:[!c&&a===1&&n===20&&i&&s.jsx(k,{}),!c&&a===1&&n===20&&!i&&(!e||e.data.results.length===0)&&s.jsx(v,{icon:"inspector-debug",title:"No security issues found"}),(c||a>1||n!==20||!i&&e&&e.data.results.length>0)&&s.jsx(B,{instance:t,isUsnsLoading:i,totalUsnCount:(e==null?void 0:e.data.count)??0,usns:(e==null?void 0:e.data.results)??[]})]})};export{z as default};
