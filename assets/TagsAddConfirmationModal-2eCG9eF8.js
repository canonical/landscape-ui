import{m,f as P,ah as x,r as C,x as r,j as o,d as s,i as w,ai as d}from"./index-BniO5lih.js";import{M as $}from"./ModalTablePagination-C3EVWdri.js";const _=(t,n)=>{const i=m(),{data:l,isFetching:a,isPending:c,refetch:g}=P({queryKey:["profileChanges",t],queryFn:async()=>i.get("tags/profile-diff",{params:t}),...n});return{isFetchingProfileChanges:a,isPendingProfileChanges:c,profileChanges:l?.data.results??[],profileChangesCount:l?.data.count??0,refetchProfileChanges:g}},j=t=>{const n={};return n["aria-label"]=`${t.original.profile.name} profile change row`,n},b=({instances:t,profileChangesCount:n,tags:i,...l})=>{const{count:a,decrement:c,increment:g}=x(1),{isPendingProfileChanges:f,profileChanges:u}=_({instance_ids:t.map(e=>e.id),tags:i,limit:d,offset:(a-1)*d}),p=C.useMemo(()=>[i.length>1?{Header:"Tag",Cell:({row:{original:e}})=>e.tag}:null,{Header:"Active profiles",Cell:({row:{original:e}})=>e.profile.name},{Header:"Profile type",Cell:({row:{original:e}})=>({ChildInstanceProfile:"WSL",PackageProfile:"Package",RebootProfile:"Reboot",RemovalProfile:"Removal",RepositoryProfile:"Repository",ScriptProfile:"Script",UpgradeProfile:"Upgrade",UsgProfile:"Security"})[e.profile.profile_type]},{Header:"Associated instances",Cell:({row:{original:e}})=>{const h=`${e.profile.current_associated_instances} ${r(e.profile.current_associated_instances,"instance")}`;return e.profile.will_exceed_limit?o.jsxs(s.Tooltip,{message:`Adding ${r(t.length,"this instance","these instances")} will exceed the instance limit.`,children:[o.jsx(s.Icon,{name:"warning"}),h]}):h},getCellIcon:({row:{original:e}})=>e.profile.will_exceed_limit?"":null}].filter(e=>e!=null),[]);return o.jsxs(s.ConfirmationModal,{title:`Add ${r(i.length,`"${i[0]}" tag`,`${i.length} tags`)} to ${r(t.length,`"${t[0].title}"`,`${t.length} instances`)}`,confirmButtonLabel:"Add tags",...l,children:[o.jsx("p",{children:"Adding tags could trigger irreversible changes to your instances."}),o.jsxs("p",{children:["Adding"," ",r(i.length,`the ${i[0]} tag`,`these ${i.length} tags`)," ","to"," ",r(t.length,`the ${t[0].title} instance`,`${t.length} instances`)," ","will associate the ",r(t.length,"instance")," with the following profiles."]}),o.jsx("p",{children:"Some instances might not be associated with certain profiles due to restrictions."}),f?o.jsx(w,{}):o.jsx(s.ModularTable,{className:"u-no-margin--bottom",columns:p,data:u,getRowProps:j}),o.jsx($,{max:Math.ceil(n/d),current:a,onPrev:c,onNext:g})]})};export{b as T,_ as u};
