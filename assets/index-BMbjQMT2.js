import{J as k,x as _,y as q,w as T,z as A,F as B,Q,k as t,V as C,j as s,i as a,B as i}from"./index-DJOjDjNm.js";import{S as M}from"./SidePanelFormButtons-DvKehNDS.js";import{M as D}from"./MultiSelectField-BOOAz4Kk.js";import{u as E}from"./index-D7j8tKi1.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./helpers-C2_LsOc2.js";import"./HeaderWithSearch-_Iy_BKXs.js";import"./constants-WmFl1fxe.js";const K=({user:n})=>{const{instanceId:g}=k(),h=_(),{notify:w}=q(),{closeSidePanel:b}=T(),{editUserQuery:y,getGroupsQuery:P,getUserGroupsQuery:f,addUserToGroupQuery:G,removeUserFromGroupQuery:x}=E(),m=Number(g),{data:F,isLoading:S}=P({computer_id:m}),{data:V}=f({username:n.username,computer_id:m}),{mutateAsync:N}=y,{mutateAsync:j}=G,{mutateAsync:I}=x,l=F?.data.groups??[],d=l.map(e=>({label:e.name,value:String(e.gid)})),p=V?.data.groups.map(e=>String(e.gid))||[],r=A({initialValues:{name:n.name??"",username:n.username,password:"",confirmPassword:"",location:n.location??"",homePhoneNumber:n.home_phone??"",workPhoneNumber:n.work_phone??"",primaryGroupValue:String(n.primary_gid),additionalGroupValue:p},validationSchema:B().shape({username:t().required("This field is required"),name:t(),password:t(),confirmPassword:t().when("password",([e],u)=>e&&e.length>0?u.trim().required("Confirm password is required").oneOf([C("password"),""],"Passwords must match"):u.notRequired()),location:t(),homePhoneNumber:t(),workPhoneNumber:t(),primaryGroupValue:t().required("This field is required"),additionalGroupValue:Q().of(t())}),onSubmit:async e=>{const u=e.additionalGroupValue.filter(o=>!p.includes(o)),U=p.filter(o=>!e.additionalGroupValue.includes(o)),c=l.filter(o=>u.includes(String(o.gid))).map(o=>o.name);try{const o=[];u.length&&o.push(j({computer_id:m,groupnames:c,usernames:[e.username],action:"add"})),U.length&&o.push(I({computer_id:m,groupnames:c,usernames:[e.username],action:"remove"})),o.push(N({computer_ids:[m],name:e.name,username:e.username,password:e.password,location:e.location,home_phone:e.homePhoneNumber,work_phone:e.workPhoneNumber,primary_groupname:e.primaryGroupValue})),await Promise.all(o),b(),w.success({message:"User updated successfully"})}catch(o){h(o)}}});return s.jsxs(a.Form,{onSubmit:r.handleSubmit,noValidate:!0,name:"edit-user",children:[s.jsx(a.Input,{type:"text",label:"Username",required:!0,autoComplete:"new-username",error:i(r,"username"),...r.getFieldProps("username")}),s.jsx(a.Input,{type:"text",label:"Name",error:i(r,"name"),...r.getFieldProps("name")}),s.jsx(a.Input,{type:"password",label:"Password",autoComplete:"new-password",error:i(r,"password"),...r.getFieldProps("password")}),s.jsx(a.Input,{type:"password",label:"Confirm password",autoComplete:"new-password",error:i(r,"confirmPassword"),...r.getFieldProps("confirmPassword")}),s.jsx(a.Select,{"data-testid":"primaryGroupValue",label:"Primary Group",required:!0,disabled:S,options:d,...r.getFieldProps("primaryGroupValue"),error:i(r,"primaryGroupValue")}),s.jsx(D,{variant:"condensed",placeholder:"Select groups",label:"Additional Groups",items:d,selectedItems:d.filter(({value:e})=>r.values.additionalGroupValue.includes(e)),onItemsUpdate:e=>{r.setFieldValue("additionalGroupValue",e.map(({value:u})=>u))},error:i(r,"additionalGroupValue")}),s.jsx(a.Input,{type:"text",label:"Location",error:i(r,"location"),...r.getFieldProps("location")}),s.jsx(a.Input,{type:"text",label:"Home phone",error:i(r,"homePhoneNumber"),...r.getFieldProps("homePhoneNumber")}),s.jsx(a.Input,{type:"text",label:"Work phone",error:i(r,"workPhoneNumber"),...r.getFieldProps("workPhoneNumber")}),s.jsx(M,{submitButtonDisabled:r.isSubmitting,submitButtonText:"Save changes"})]})};export{K as default};
