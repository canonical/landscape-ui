import{r as x,b as y,z as I,j as t,h as s,k as U,y as N,a as A,l as T,m as k,n as E,p as R,R as $,t as F}from"./index-DADCH2pl.js";import{A as q}from"./AuthTemplate-B-_2fzrR.js";import{r as P}from"./helpers-Bo73Thd0.js";import{S as g}from"./constants-LFXGfoad.js";const B="_list_463vl_1",C="_button_463vl_17",D="_icon_463vl_25",u={list:B,button:C,icon:D},H=({isStandaloneOidcEnabled:m,isUbuntuOneEnabled:b,oidcProviders:p,onInvitation:e})=>{const[n,i]=x.useState(0),[c]=y(),{getOidcUrlQuery:d,getUbuntuOneUrlQuery:a,getInvitationSummaryQuery:o}=I(),l=c.get("redirect-to"),r=c.get("invitation_id"),S=c.has("external"),{data:_}=o({invitationId:r??""},{enabled:!!r});x.useEffect(()=>{_&&e(_.data.account_title)},[_]);const h={};n>0&&(h.id=n),l&&(h.return_to=l),r&&(h.invitation_id=r),S&&(h.external=!0);const{data:w}=d(h,{enabled:n!==0});x.useEffect(()=>{w&&P(w.data.location)},[w]);const f={};l&&(f.return_to=`${window.origin}${l}`),r&&(f.invitation_id=r),S&&(f.external=!0);const{data:j,refetch:O}=a(f,{enabled:!1});return x.useEffect(()=>{j&&P(j.data.location)},[j]),t.jsxs("ul",{className:u.list,children:[b&&t.jsx("li",{className:"p-list__item",children:t.jsxs(s.Button,{type:"button",hasIcon:!0,onClick:O,className:u.button,children:[t.jsx(s.Icon,{name:g["ubuntu-one"].icon,className:u.icon}),t.jsx("span",{children:"Sign in with Ubuntu One"})]})}),m&&t.jsx("li",{className:"p-list__item",children:t.jsxs(s.Button,{type:"button",hasIcon:!0,onClick:()=>i(-1),className:u.button,children:[t.jsx(s.Icon,{name:g["standalone-oidc"].icon,className:u.icon}),t.jsx("span",{children:"Sign in with Enterprise Login"})]})}),p.map(v=>t.jsx("li",{className:"p-list__item",children:t.jsxs(s.Button,{type:"button",hasIcon:!0,onClick:()=>i(v.id),className:u.button,children:[t.jsx(s.Icon,{name:g[v.provider].icon,className:u.icon}),t.jsx("span",{children:`Sign in with ${v.name}`})]})},v.id))]})},V="_buttonRow_46ihv_1",W={buttonRow:V},z=()=>{const[m]=y(),b=U(),{signInWithEmailAndPasswordQuery:p}=I(),{setUser:e}=N(),n=A(),i=m.get("redirect-to"),c=m.has("external"),{mutateAsync:d}=p,a=T({initialValues:{email:"",password:"",remember:!1},validationSchema:k().shape({email:E().required("This field is required"),password:E().required("This field is required"),remember:R()}),onSubmit:async o=>{try{const{data:l}=await d({email:o.email,password:o.password});if(c&&i)P(i,{replace:!0});else{e(l,o.remember);const r=new URL(i??$,location.origin);n(r.toString().replace(r.origin,""),{replace:!0})}}catch(l){b(l)}}});return t.jsxs(s.Form,{onSubmit:a.handleSubmit,children:[t.jsx(s.Input,{type:"text",label:"Identity",error:a.touched.email&&a.errors.email?a.errors.email:void 0,...a.getFieldProps("email"),"data-testid":"email"}),t.jsx(s.PasswordToggle,{id:"password",label:"Password",error:a.touched.password&&a.errors.password?a.errors.password:void 0,...a.getFieldProps("password"),"data-testid":"password"}),t.jsx(s.CheckboxInput,{label:"Remember this device",...a.getFieldProps("remember")}),t.jsx("div",{className:W.buttonRow,children:t.jsx(s.Button,{type:"submit",appearance:"positive",disabled:a.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},Q=()=>{const[m,b]=x.useState(""),{getLoginMethodsQuery:p}=I(),{data:e,isLoading:n}=p(),i=e!=null&&e.data.oidc.available?e==null?void 0:e.data.oidc.configurations.filter(({enabled:o})=>o):[],c=!!(e!=null&&e.data.standalone_oidc.available&&e.data.standalone_oidc.enabled),d=!!(e!=null&&e.data.ubuntu_one.available&&e.data.ubuntu_one.enabled),a=!!(e!=null&&e.data.password.available&&e.data.password.enabled);return t.jsxs(q,{invitationAccount:m,title:"Sign in to Landscape",children:[n&&t.jsx(F,{}),!n&&a&&t.jsx(z,{}),!n&&(d||c||i.length>0)&&t.jsx(H,{isStandaloneOidcEnabled:c,isUbuntuOneEnabled:d,oidcProviders:i,onInvitation:o=>b(o)}),!n&&!a&&!d&&!i.length&&t.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})};export{Q as default};
