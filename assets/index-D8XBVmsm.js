const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BSWDJ7rx.js","assets/index-BCIQRWZN.js","assets/index-0_yY5HGy.css","assets/MultiSelectField-Bz6oob34.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-C4haZDXg.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/TagsAddConfirmationModal-mVPOAn0n.js","assets/TagsAddConfirmationModal-HDr0Q-Wm.css","assets/useGetTags-38AHaK0e.js","assets/useRoles-DLpkJJtB.js","assets/AssociationBlock-DQBJa-xL.css","assets/index-B1CfemJJ.js","assets/ScriptsTabs-DM7z99GU.js","assets/HeaderWithSearch-R8DS_T4K.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-CBC07LaC.js","assets/useExpandableRow-BvExhRGJ.js","assets/ScriptsTabs-DN44MVZt.css","assets/DeliveryBlock-DI386HEJ.js","assets/DeliveryBlock-VExRkUer.css","assets/ScriptDropdown-DWxuusJ8.js","assets/downshift.esm-Nv4baBou.js","assets/ScriptDropdown-DwZ4WXvX.css","assets/index-CxWvxuwT.js","assets/CodeEditor-B9H1Cf2i.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-D4qblZjj.js","assets/AttachmentFile-C3gH8mH5.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-lXW2BemA.js","assets/AutoinstallFileVersionHistory-D-ua3Cao.js","assets/SidePanelTablePagination-CFMakOLa.js","assets/AutoinstallFileVersionHistory-BUeZdID_.css","assets/EmployeeList-BLK_T3zJ.js","assets/EmployeeList-DRxY5zMq.css","assets/useGetEmployees-CMvSyYnE.js","assets/index-DiU0noXl.css"])))=>i.map(i=>d[i]);
import{i as b,j as e,o as B,d as t,aK as ye,a as W,G as fe,at as je,H as ve,J as _e,A as w,b as Y,e as Ce,f as Ie,g as we,p as Se,X as Re,q as Fe,n as Ae,a5 as ke,aL as Ee,aM as Me,a4 as v,s as De,v as k,aD as h,I as n,aN as G,D as U,N as x,t as Q,ac as ze,a2 as T}from"./index-BCIQRWZN.js";import{C as Ne}from"./AutoinstallFileVersionHistory-D-ua3Cao.js";import{u as Be,I as Te}from"./InstanceRemoveFromLandscapeModal-Dk4WNv0o.js";import{u as Le}from"./useRoles-DLpkJJtB.js";import{h as Oe,i as $e}from"./WslInstancesEmptyState-gh8PoS-6.js";import"./index-CBC07LaC.js";import"./EmployeeList-BLK_T3zJ.js";import"./SidePanelTablePagination-CFMakOLa.js";import"./useRemoveInstancesFromLandscape-BqaB7PNT.js";import"./GroupFilter-BSIipte-.js";import"./HeaderWithSearch-R8DS_T4K.js";import"./useExpandableRow-BvExhRGJ.js";const Ve="_container_pgwx9_1",Pe="_innerContainer_pgwx9_9",qe="_button_pgwx9_13",N={container:Ve,innerContainer:Pe,button:qe},Ge=({actions:{destructive:s=[],nondestructive:i=[]}})=>{s=s.filter(o=>!o.excluded),i=i.filter(o=>!o.excluded);const a=[...i,...s],g={nondestructive:[],destructive:[]},[d,r]=b.useState(a),[y,j]=b.useState(g),[E,S]=b.useState(!1),[R,M]=b.useState(0),I=i.filter(o=>o.collapsed).length+s.filter(o=>o.collapsed).length>1,F=(o,f)=>{if(y.destructive.length||y.nondestructive.length)return;if((!o.lastElementChild||o.lastElementChild.getBoundingClientRect().right<=f.getBoundingClientRect().right)&&!I){S(!1);return}S(!0);const u=[],m={nondestructive:[],destructive:[]};i.forEach((p,_)=>{o.children[_].getBoundingClientRect().right>o.getBoundingClientRect().right||p.collapsed&&I?m.nondestructive.push(p):u.push(p)}),s.forEach((p,_)=>{_+=i.length,o.children[_].getBoundingClientRect().right>o.getBoundingClientRect().right||p.collapsed&&I?m.destructive.push(p):u.push(p)}),r(u),j(m)},D=o=>{const f=o?.parentElement?.parentElement;if(!f)return;F(o,f);const u=new ResizeObserver(()=>{const{width:m}=f.getBoundingClientRect();m!==R&&(r(a),j(g),M(m))});return u.observe(f),()=>{u.disconnect()}};return e.jsxs("div",{className:N.container,children:[e.jsx("div",{className:B(N.innerContainer,"p-segmented-control"),children:e.jsx("div",{ref:D,className:"p-segmented-control__list",children:d.map(({collapsed:o,excluded:f,icon:u,label:m,...p})=>e.jsxs(t.Button,{className:B(N.button,"u-no-margin--bottom p-segmented-control__button"),...p,children:[e.jsx(t.Icon,{name:u}),e.jsx("span",{children:m})]},m))})}),E&&e.jsx(ye,{hasToggleIcon:!0,toggleLabel:d.length?"More actions":"Actions",toggleClassName:"u-no-margin--bottom",toggleDisabled:[...s,...i].every(o=>o.disabled),actions:y.nondestructive,destructiveActions:y.destructive})]})},Ue=({profiles:s})=>{const{isFeatureEnabled:i}=W();return i("script-profiles")||(s=s.filter(a=>a.type!=="script")),i("usg-profiles")||(s=s.filter(a=>a.type!=="security")),i("wsl-child-instance-profiles")||(s=s.filter(a=>a.type!=="wsl")),s.map((a,g)=>e.jsxs("span",{children:[a.title,g<s.length-1?", ":""]},`${a.type}${a.id}`))},Qe={deliver_after:"",deliverImmediately:!0,action:null},We=fe().shape({deliver_after:_e().when("deliverImmediately",{is:!1,then:s=>s.required("This field is required").test({message:"Invalid date",test:i=>w(i).isValid()}).test({message:"Date must be in the future",test:i=>w(i).isAfter()})}),deliverImmediately:ve(),action:je().oneOf(["shutdown","reboot"]).required()}),Ye="_titleRow_b58e9_1",He="_headerContainer_b58e9_9",Ke="_status_b58e9_14",Je="_heading_b58e9_20",Xe="_block_b58e9_24",C={titleRow:Ye,headerContainer:He,status:Ke,heading:Je,block:Xe},Ze=()=>{const s=Y(),i=Ce(),{mutateAsync:a,isPending:g}=Ie({mutationKey:["employee","disassociate"],mutationFn:async({employee_id:d,computer_id:r})=>s.delete(`employees/${d}/computers/${r}`),onSuccess:(d,r)=>{i.invalidateQueries({queryKey:["instances",r.computer_id]})}});return{disassociateEmployeeFromInstance:a,isDisassociating:g}},es=(s,i={})=>{const a=Y(),{id:g,...d}=s,{data:r,isLoading:y}=we({queryKey:["employees","employee",s],queryFn:async()=>a.get(`employees/${g}`,{params:d}),...i});return{employee:r?.data,isGettingEmployee:y}},ss=b.lazy(async()=>T(()=>import("./index-BSWDJ7rx.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),ts=b.lazy(async()=>T(()=>import("./index-B1CfemJJ.js"),__vite__mapDeps([13,14,1,2,11,15,16,17,18,19,20,21,5,6,7,22,23,24,25,26,27,28,29,30,31,32,33])).then(s=>({default:s.RunInstanceScriptForm}))),is=b.lazy(async()=>T(()=>import("./index-lXW2BemA.js"),__vite__mapDeps([34,1,2,5,6,7,19,35,36,37,38,39,25,40,41]))),bs=({instance:s})=>{const{isFeatureEnabled:i}=W(),a=Se(),g=Re(),{notify:d}=Fe(),{setSidePanelContent:r}=Ae(),{openActivityDetails:y}=ke(),{employee:j,isGettingEmployee:E}=es({id:s.employee_id??0},{enabled:!!s.employee_id}),{restartInstances:S,isRestartingInstances:R}=Ee(),{getAccessGroupQuery:M}=Le(),{sanitizeInstance:I,isSanitizingInstance:F}=Be(),{shutDownInstances:D,isShuttingDownInstances:o}=Me(),{disassociateEmployeeFromInstance:f,isDisassociating:u}=Ze(),{value:m,setTrue:p,setFalse:_}=v(),{value:H,setTrue:K,setFalse:J}=v(),{value:X,setTrue:Z,setFalse:ee}=v(),{value:se,setTrue:te,setFalse:ie}=v(),{value:oe,setTrue:ae,setFalse:le}=v(),{value:ne,setTrue:re,setFalse:L}=v(),{value:ce,setTrue:de,setFalse:O}=v(),{data:$,isPending:ue}=M(),c=De({initialValues:Qe,validationSchema:We,onSubmit:async l=>{if(!l.action)return;const P={computer_ids:[s.id],deliver_after:l.deliverImmediately?void 0:`${l.deliver_after}:00Z`};try{const{data:z}=l.action==="reboot"?await S(P):await D(P),q=l.action==="reboot"?"restarted":"shut down";d.success({title:`You queued "${s.title}" to be ${q}`,message:`Instance "${s.title}" will be ${q} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{y(z)}}]})}catch(z){a(z)}}});if(ue||E)return e.jsx(k,{});const me=async()=>{try{const{data:l}=await I({computer_id:s.id,computer_title:s.title});d.success({title:`You have successfully marked ${s.title} to be sanitized.`,message:"An activity has been queued to sanitize it. The data will be permanently irrecoverable once complete.",actions:[{label:"View details",onClick:()=>{y(l)}}]})}catch(l){a(l)}finally{L()}},pe=()=>{r("Edit instance",e.jsx(b.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(ss,{instance:s})}))},he=()=>{r("Run script",e.jsx(b.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(ts,{parentAccessGroup:s.access_group,query:`id:${s.id}`})}))},ge=()=>{r(`Associate employee with ${s.title}`,e.jsx(b.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(is,{instanceTitle:s.title})}))},xe=async()=>{try{await f({computer_id:s.id,employee_id:s.employee_id??0}),O(),d.success({title:`You have successfully disassociated ${j?.name??"the employee"}.`,message:`${j?.name??"The employee"} has been successfully disassociated from ${s.title}.`})}catch(l){a(l)}},A=async l=>{await c.setFieldValue("action",l),c.handleSubmit()},V=()=>{g("/instances",{replace:!0})},be=$?$.data:[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:C.titleRow,children:[e.jsxs("div",{className:C.headerContainer,children:[e.jsx("h2",{className:B("p-heading--4 u-no-padding--top",C.heading),children:s.title}),s.is_wsl_instance&&e.jsx(Ne,{value:"WSL instance"})]}),e.jsx(Ge,{actions:{nondestructive:[{icon:"edit",label:"Edit",onClick:pe},{icon:"restart",label:"Restart",onClick:p,excluded:!h(s).power},{icon:"power-off",label:"Shut down",onClick:K,excluded:!h(s).power},{icon:"code",label:"Run script",onClick:he,excluded:!h(s).scripts},{icon:t.ICONS.user,label:"Associate employee",onClick:ge,collapsed:!0,excluded:!i("employee-management")||!h(s).employees||!!s.employee_id},{icon:t.ICONS.user,label:"Disassociate employee",onClick:de,collapsed:!0,excluded:!i("employee-management")||!h(s).employees||s.employee_id===null}],destructive:[{icon:"restart",label:"Reinstall",onClick:Z,collapsed:!0,excluded:!h(s).uninstallation},{icon:"close",label:"Uninstall",onClick:te,collapsed:!0,excluded:!h(s).uninstallation},{icon:t.ICONS.delete,label:"Remove from Landscape",onClick:ae,collapsed:!0},{icon:"tidy",label:"Sanitize",onClick:re,collapsed:!0,excluded:!h(s).sanitization}]}},s.employee_id??"no-employee")]}),e.jsxs("section",{children:[e.jsx("h5",{className:"u-no-margin--bottom",children:"Instance status"}),e.jsxs(t.Row,{className:"u-no-padding u-no-margin",children:[e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Status",value:e.jsxs("div",{className:C.status,children:[e.jsx(t.Icon,{name:G(s).icon??""}),e.jsx("span",{children:G(s).label})]})})}),e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Last ping time",value:w(s.last_ping_time).isValid()?w(s.last_ping_time).format(U):e.jsx(x,{})})}),e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Access group",value:be.find(l=>l.name===s.access_group)?.title||s.access_group})})]}),e.jsxs(t.Row,{className:"u-no-padding u-no-margin",children:[e.jsx(t.Col,{size:3,children:e.jsx(n,{type:"truncated",label:"Profiles",value:s.profiles?.length?e.jsx(Ue,{profiles:s.profiles}):e.jsx(x,{})})}),h(s).employees&&i("employee-management")&&e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Associated employee",value:j?j.name:e.jsx(x,{})})})]})]}),e.jsxs("section",{className:C.block,children:[e.jsx("h5",{children:"Registration details"}),e.jsxs(t.Row,{className:"u-no-padding u-no-margin",children:[e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Hostname",value:s.hostname??e.jsx(x,{})})}),e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Instance ID",value:s.id})}),h(s).hardware&&e.jsxs(e.Fragment,{children:[e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Serial number",value:s.grouped_hardware?.system.serial??e.jsx(x,{})})}),e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Product identifier",value:s.grouped_hardware?.system.model??e.jsx(x,{})})})]})]}),e.jsxs(t.Row,{className:"u-no-padding u-no-margin",children:[e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"OS",value:s.distribution_info?s.distribution_info.description:e.jsx(x,{})})}),h(s).hardware&&e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"IP addresses",type:"truncated",value:Array.isArray(s.grouped_hardware?.network)?s.grouped_hardware.network.map(l=>l.ip).join(", "):e.jsx(x,{})})}),e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Registered",value:w(s.registered_at).format(U)})})]})]}),e.jsxs("section",{className:C.block,children:[e.jsx("h5",{children:"Other"}),e.jsxs(t.Row,{className:"u-no-padding u-no-margin",children:[e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Annotations",value:e.jsx(x,{})})}),e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Comment",value:s.comment||e.jsx(x,{})})})]})]}),m&&e.jsx(t.ConfirmationModal,{close:_,title:"Restart instance",confirmButtonLabel:"Restart",confirmButtonAppearance:"positive",confirmButtonDisabled:R,confirmButtonLoading:R,onConfirm:async()=>A("reboot"),children:e.jsxs(t.Form,{onSubmit:async()=>A("reboot"),noValidate:!0,children:[e.jsx(t.CheckboxInput,{label:"Deliver as soon as possible",...c.getFieldProps("deliverImmediately"),checked:c.values.deliverImmediately}),e.jsx(t.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...c.getFieldProps("deliver_after"),disabled:c.values.deliverImmediately,error:Q(c,"deliver_after")}),e.jsxs("p",{children:['This will restart "',s.title,'" instance.']})]})}),H&&e.jsx(t.ConfirmationModal,{close:J,title:"Shut down instance",confirmButtonLabel:"Shut down",confirmButtonAppearance:"positive",confirmButtonDisabled:o,confirmButtonLoading:o,onConfirm:async()=>A("shutdown"),children:e.jsxs(t.Form,{onSubmit:async()=>A("shutdown"),noValidate:!0,children:[e.jsx(t.CheckboxInput,{label:"Deliver as soon as possible",...c.getFieldProps("deliverImmediately"),checked:c.values.deliverImmediately}),e.jsx(t.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...c.getFieldProps("deliver_after"),disabled:c.values.deliverImmediately,error:Q(c,"deliver_after")}),e.jsxs("p",{children:['This will shut down "',s.title,'" instance.']})]})}),ce&&e.jsx(t.ConfirmationModal,{close:O,title:`Disassociate employee from ${s.title}`,confirmButtonLabel:"Disassociate",confirmButtonAppearance:"negative",confirmButtonDisabled:u,confirmButtonLoading:u,onConfirm:xe,children:e.jsxs("p",{children:["You are about to disassociate instance ",s.title," from"," ",j?.name,". This will revoke their access to the instance’s details and recovery key."]})}),s.is_wsl_instance&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{close:ee,instances:[{name:s.title,computer_id:s.id}],isOpen:X,windowsInstance:s}),e.jsx($e,{close:ie,instances:[{name:s.title,computer_id:s.id}],isOpen:se,onSuccess:V,parentId:s.parent.id})]}),e.jsx(Te,{close:le,instances:[s],isOpen:oe,onSuccess:V}),e.jsx(ze,{isOpen:ne,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:F,confirmButtonLoading:F,onConfirm:me,close:L,confirmationText:`sanitize ${s.title}`,title:"Sanitize instance",children:e.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",s.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})};export{bs as default};
