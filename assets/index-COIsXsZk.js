const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BY-pRYCv.js","assets/index-ClG4AO4X.js","assets/index-snvkEeYU.css","assets/useInstances-BPK1gQa7.js","assets/ResponsiveButtons-B8In4Cyg.js","assets/ResponsiveButtons-C56n2q_V.css","assets/InstancesPageActions-Dmd5okvh.js","assets/InstancesPageActions-B7AIml_J.css","assets/useRoles-C3np57d3.js","assets/TagsAddConfirmationModal-7Ju_QsGR.js","assets/TagsAddConfirmationModal-HDr0Q-Wm.css","assets/WslInstancesHeader-KlfEKTAc.js","assets/HeaderWithSearch-HMiSqRye.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/WslInstancesHeader-Dj3EjS23.css","assets/index-KgqhRPrR.css","assets/index-CsjubI0U.js","assets/index-BzXEPdn_.css","assets/index-D1LECO36.js","assets/index-B8MQ95pn.css","assets/index-rJcf-YTq.js","assets/useUsns-CDkgmD5a.js","assets/useUsns-BRJzzA4M.css","assets/useSelection-Domo-LTQ.js","assets/index-B0p01W4u.css","assets/index-BScovg0-.js","assets/useGetActivities-CSRuIYpR.js","assets/ActivitiesEmptyState-Gz4EjZT9.js","assets/index-DBdBeJNb.js","assets/PageMain-BT2JE7aV.js","assets/PageMain-CIunaku7.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-CzrLW3IK.css","assets/index-D8R65ZyW.js","assets/index-BAsg6f-x.css","assets/index-rGQWxXRh.js","assets/SidePanelFormButtons-BitiQJ8Y.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/helpers-CaNW0Pzo.js","assets/index-DQLukqVs.css","assets/index-041JnLsI.js","assets/UsnList-BebhxiNK.js","assets/SelectAllButton-BVy2wbNP.js","assets/ExpandableTableFooter-BeM7LD30.js","assets/ExpandableTableFooter-CF0EpBAN.css","assets/UsnList-lBcfXQ7t.css","assets/index-CsHgpdRJ.css","assets/index-CPZsGEnT.js","assets/index-B1Uu4xTW.css","assets/index-BdPS58xC.js","assets/downshift.esm-BmDrMQEV.js","assets/index-BcIsbW0p.css","assets/index-DxlnPhPi.js","assets/constants-BFww9-SR.js","assets/index-CNIav8so.css","assets/index-CPoDHAQL.js","assets/constants-Dwl1JGyb.js","assets/index-DgHoeIwv.css","assets/index-D2q-B44X.js"])))=>i.map(i=>d[i]);
import{Y as P,j as n,E as Q,d as g,n as v,c as K,an as F,k as a,p as l,a2 as u,b as C,g as A,h as m,i as I,Q as D,a as V}from"./index-ClG4AO4X.js";import{P as O,a as U,b as z}from"./PageMain-BT2JE7aV.js";import{u as B,a as N}from"./useUsns-CDkgmD5a.js";import{u as q}from"./useInstances-BPK1gQa7.js";import{c as $}from"./SingleInstanceTabs.module-Cm1BYFZQ.js";import{d as k,R as H}from"./ResponsiveButtons-B8In4Cyg.js";const M=({childInstanceId:e,instanceId:t})=>{const s=P();return n.jsx(Q,{title:"Instance not found",icon:"connected",body:n.jsxs("p",{className:"u-no-margin--bottom",children:[n.jsx("span",{children:"Seems like the instance with id = "}),n.jsx("code",{children:t}),n.jsx("span",{children:" doesn't "}),e?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:"have a child instance with id = "}),n.jsx("code",{children:e})]}):n.jsx("span",{children:"exist"}),"."]}),cta:[n.jsx(g.Button,{appearance:"positive",onClick:async()=>s("/instances",{replace:!0}),type:"button","aria-label":"Go back",children:"Back to Instances page"},"go-back-to-instances-page"),n.jsx(g.Button,{onClick:async()=>s("/",{replace:!0}),type:"button","aria-label":"Go back",children:"Home page"},"go-back-to-home-page")]})},x={ubuntu:"Ubuntu",ubuntuCore:"Ubuntu Core",windows:"Microsoft"},G=[{label:"Info",id:"tab-link-info",condition:()=>!0},{label:"WSL",id:"tab-link-wsl",condition:e=>e.distribution_info?.distributor===x.windows},{label:"Activities",id:"tab-link-activities",condition:()=>!0},{label:"Kernel",id:"tab-link-kernel",condition:e=>e.distribution_info?.distributor===x.ubuntu},{label:"Security issues",id:"tab-link-security-issues",condition:e=>e.distribution_info?.distributor===x.ubuntu},{label:"Packages",id:"tab-link-packages",condition:e=>e.distribution_info?.distributor===x.ubuntu},{label:"Snaps",id:"tab-link-snaps",condition:e=>e.distribution_info?.distributor!==x.windows},{label:"Processes",id:"tab-link-processes",condition:e=>e.distribution_info?.distributor!==x.windows},{label:"Ubuntu Pro",id:"tab-link-ubuntu-pro",condition:e=>[x.ubuntu,x.ubuntuCore,x.windows].includes(e.distribution_info?.distributor??"")},{label:"Users",id:"tab-link-users",condition:e=>![x.ubuntuCore,x.windows].includes(e.distribution_info?.distributor??"")},{label:"Hardware",id:"tab-link-hardware",condition:e=>e.distribution_info?.distributor!==x.windows}],W=({id:e,label:t,packageCount:s,packagesLoading:d,usnCount:b,usnLoading:_,kernelCount:r,kernelLoading:o})=>e==="tab-link-packages"&&d||e==="tab-link-security-issues"&&_||e==="tab-link-kernel"&&o?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:t}),n.jsx(g.Spinner,{className:"u-no-margin--bottom u-no-padding--top"})]}):e==="tab-link-packages"&&s?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:t}),n.jsx(g.Badge,{value:s})]}):e==="tab-link-security-issues"&&b?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:t}),n.jsx(g.Badge,{value:b,isNegative:!0})]}):e==="tab-link-kernel"&&r?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:t}),n.jsx(g.Badge,{value:r})]}):t,Y=({activeTabId:e,instance:t,onActiveTabChange:s,packageCount:d,packagesLoading:b,usnCount:_,usnLoading:r,kernelCount:o,kernelLoading:p})=>G.filter(j=>j.condition(t)).map(({label:j,id:i})=>({label:W({label:j,id:i,packageCount:d,packagesLoading:b,usnCount:_,usnLoading:r,kernelCount:o,kernelLoading:p}),id:i,role:"tab",active:i===e,onClick:()=>{s(i)}})),J=a.lazy(async()=>u(()=>import("./index-BY-pRYCv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),X=a.lazy(async()=>u(()=>import("./index-CsjubI0U.js"),__vite__mapDeps([16,1,2,12,13,17]))),Z=a.lazy(async()=>u(()=>import("./index-D1LECO36.js"),__vite__mapDeps([18,1,2,19]))),ee=a.lazy(async()=>u(()=>import("./index-rJcf-YTq.js"),__vite__mapDeps([20,1,2,21,4,5,22,12,13,23,24]))),ne=a.lazy(async()=>u(()=>import("./index-BScovg0-.js"),__vite__mapDeps([25,1,2,23,26,27]))),te=a.lazy(async()=>u(()=>import("./index-DBdBeJNb.js"),__vite__mapDeps([28,1,2,29,30,21,4,5,22,3,31,32,33]))),se=a.lazy(async()=>u(()=>import("./index-D8R65ZyW.js"),__vite__mapDeps([34,1,2,11,12,13,3,14,35]))),ae=a.lazy(async()=>u(()=>import("./index-rGQWxXRh.js").then(e=>e.i),__vite__mapDeps([36,1,2,37,38,39,40,4,5,12,13,41]))),re=a.lazy(async()=>u(()=>import("./index-041JnLsI.js"),__vite__mapDeps([42,1,2,21,4,5,22,12,13,43,44,45,46,47,48]))),ie=a.lazy(async()=>u(()=>import("./index-CPZsGEnT.js"),__vite__mapDeps([49,1,2,50]))),oe=a.lazy(async()=>u(()=>import("./index-BdPS58xC.js"),__vite__mapDeps([51,1,2,37,38,39,52,12,13,40,4,5,53]))),ce=({instance:e,packageCount:t,packagesLoading:s,usnCount:d,usnLoading:b,kernelCount:_,kernelLoading:r})=>{const{closeSidePanel:o}=v(),{tab:p,setPageParams:j}=K(),i=p?`tab-link-${p}`:"tab-link-info",c=Y({activeTabId:i,instance:e,onActiveTabChange:h=>{j({tab:h.replace("tab-link-","")}),o()},packageCount:t,packagesLoading:s,usnCount:d,usnLoading:b,kernelCount:_,kernelLoading:r});return n.jsxs(n.Fragment,{children:[n.jsx(g.Tabs,{listClassName:"u-no-margin--bottom",links:c}),n.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":i,className:$.tabPanel,children:n.jsxs(F,{children:[i==="tab-link-info"&&n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(J,{instance:e})}),i==="tab-link-wsl"&&n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(se,{instance:e})}),i==="tab-link-activities"&&n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(ne,{instanceId:e.id})}),i==="tab-link-kernel"&&n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(te,{instanceTitle:e.title})}),i==="tab-link-security-issues"&&n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(re,{instance:e})}),i==="tab-link-packages"&&n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(ee,{})}),i==="tab-link-snaps"&&n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(oe,{})}),i==="tab-link-processes"&&n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(X,{})}),i==="tab-link-ubuntu-pro"&&n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(ie,{instance:e})}),i==="tab-link-users"&&n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(ae,{})}),i==="tab-link-hardware"&&n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(Z,{instance:e})})]})})]})},le=e=>{if(e)return e.parent?[{label:"Instances",path:"/instances"},{label:e.parent.title,path:`/instances/${e.parent.id}`},{label:e.title,current:!0}]:[{label:"Instances",path:"/instances"},{label:e.title,current:!0}]},ue=e=>{if(!(!e||e.length===0||!e[0]?.Livepatch?.Fixes))return e[0].Livepatch.Fixes.length},de=(e,t)=>e.distribution?t:0,be=(e,t)=>e.distribution?t:0,pe=e=>e?.title??"",ge=(e,t)=>parseInt(t||(e??"")),_e=(e,t,s)=>!!e&&(!t||t===s),xe=(e,t,s)=>!!e&&k("ubuntu",e)&&(!s||e.parent?.id===parseInt(t??"")),je=(e,t,s)=>!!e&&k("ubuntu",e)&&(!s||e.parent?.id===parseInt(t??"")),he=(e,t,s)=>!!e&&k("ubuntu",e)&&(!s||e.parent?.id===parseInt(t??"")),ke=e=>e?[e.id]:[],f=e=>e?e.id:0,ye=(e,t,s)=>e&&(!s||e.parent&&e.parent.id===parseInt(t??"")),me="_container_pnq0d_1",Ie={container:me},fe=a.lazy(async()=>u(()=>import("./index-DxlnPhPi.js"),__vite__mapDeps([54,1,2,55,29,30,21,4,5,22,3,31,32,56]))),Pe=a.lazy(async()=>u(()=>import("./index-CPoDHAQL.js"),__vite__mapDeps([57,1,2,58,55,29,30,21,4,5,22,3,31,32,59]))),ve=a.lazy(async()=>u(()=>import("./index-D2q-B44X.js"),__vite__mapDeps([60,1,2,3,58,29,30,21,4,5,22,31,32,59]))),Fe=({instanceName:e,hasTableData:t,kernelStatuses:s})=>{const{setSidePanelContent:d}=v(),b=s?.installed?.version_rounded??"",_=s?.downgrades??[],r=s?.upgrades??[],o=()=>{d("Downgrade kernel",n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(fe,{instanceName:e,currentKernelVersion:b,downgradeKernelVersions:_})}))},p=()=>{d("Upgrade kernel",n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(Pe,{instanceName:e,currentKernelVersion:b,upgradeKernelVersions:r})}))},j=()=>{d(`Restart ${e}`,n.jsx(a.Suspense,{fallback:n.jsx(l,{}),children:n.jsx(ve,{instanceName:e,showNotification:t,newKernelVersionId:r[0]?.id})}))};return n.jsxs("div",{className:Ie.container,children:[n.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:"Kernel overview"}),n.jsx(H,{collapseFrom:"lg",buttons:[n.jsxs(g.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:j,children:[n.jsx(g.Icon,{name:"restart"}),n.jsx("span",{children:"Restart instance"})]},"restart-instance"),n.jsxs(g.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:_.length===0,onClick:o,children:[n.jsx(g.Icon,{name:"begin-downloading"}),n.jsx("span",{children:"Downgrade kernel"})]},"downgrade-kernel"),n.jsxs(g.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:r.length===0,onClick:p,children:[n.jsx(g.Icon,{name:"change-version"}),n.jsx("span",{children:"Upgrade kernel"})]},"upgrade-kernel")]})]})};function Ee(){const e=C(),t=A(),s=({id:r},o={})=>I({queryKey:["kernel",r],queryFn:async()=>e.get(`computers/${r}/livepatch/kernel`),...o}),d=({id:r,...o},p={})=>I({queryKey:["kernel",{id:r,...o}],queryFn:async()=>e.get(`computers/${r}/livepatch/info`,{params:o}),...p}),b=m({mutationKey:["kernel","downgrade"],mutationFn:async({id:r,...o})=>e.post(`computers/${r}/kernel/downgrade`,o),onSuccess:async()=>t.invalidateQueries({queryKey:["kernel"]})}),_=m({mutationKey:["kernel","upgrade"],mutationFn:async({id:r,...o})=>e.post(`computers/${r}/kernel/upgrade`,o),onSuccess:async()=>t.invalidateQueries({queryKey:["kernel"]})});return{getKernelQuery:s,getLivepatchInfoQuery:d,downgradeKernelQuery:b,upgradeKernelQuery:_}}const we=()=>{const{instanceId:e,childInstanceId:t}=D(),{user:s}=V(),d=P(),{getSingleInstanceQuery:b}=q(),{getUsnsQuery:_}=B(),{getInstancePackagesQuery:r}=N(),{getLivepatchInfoQuery:o}=Ee(),p=a.useRef("");a.useEffect(()=>{s?.current_account&&(p.current||(p.current=s.current_account),p.current!==s.current_account&&d("/instances",{replace:!0}))},[s?.current_account]);const{data:j,isLoading:i}=b({instanceId:ge(e,t),with_annotations:!0,with_grouped_hardware:!0},{enabled:_e(e,p.current,s?.current_account)}),c=j?.data??null,{data:h,isLoading:E}=_({computer_ids:ke(c),limit:1},{enabled:he(c,e,t)}),{data:w,isLoading:L}=r({available:!1,upgrade:!0,instance_id:f(c),limit:1},{enabled:xe(c,e,t)}),{data:S,isLoading:R}=o({id:f(c)},{enabled:je(c,e,t)}),T=ue(S?.data.livepatch_info?.json?.output?.Status),y=ye(c,e,t);return n.jsxs(O,{children:[n.jsx(U,{title:pe(c),hideTitle:!0,breadcrumbs:le(c)}),n.jsx(z,{children:i?n.jsx(l,{}):n.jsxs(n.Fragment,{children:[!y&&n.jsx(M,{childInstanceId:t,instanceId:e}),c&&y&&n.jsx(ce,{instance:c,packageCount:de(c,Number(w?.data.count)),packagesLoading:L,usnCount:be(c,Number(h?.data.count)),usnLoading:E,kernelCount:c.distribution?T:0,kernelLoading:R})]})})]})},Ce=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"}));export{Fe as K,Ce as i,Ee as u};
