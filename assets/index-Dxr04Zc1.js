import{B as y,j as e,h as c,g as T,r as I,E as _,v as C,t as w}from"./index-DADCH2pl.js";import{T as K}from"./TablePagination-LiCSCehs.js";import{I as F}from"./InfoItem-C9PzTGG1.js";import{h as l}from"./moment-C5S46NFB.js";import{N as u}from"./NoData-WFE5Fwmh.js";import{u as S,K as B}from"./index-CCrs4fxB.js";import{u as A}from"./usePageParams-P7Q2IB6j.js";import"./TablePagination.module-CgQ3jx4B.js";import"./PageMain-BY8_2MnI.js";import"./useUsns-DZndNDnQ.js";import"./useFetchOld-CG1Ychvt.js";import"./useInstances-d-XuXnnW.js";import"./moment-D73YTwfa.js";const M=(a,t)=>{switch(a){case"Fully patched":return"All available kernel security patches have been applied. You have no pending patches";case"Kernel upgrade available":return`A new kernel version is available. The current version is covered by Livepatch until ${l(t).format(y)}`;case"Restart required":return"Low and/or medium patches have been installed. You must restart to complete patching.";case"End of life":return"The kernel is no longer covered by Livepatch. It is not getting high and critical security patches.";case"Livepatch disabled":return"Livepatch is disabled. Kernel patches will not be applied automatically until you enabled Livepatch.";default:return"There was an error getting the status"}},H=a=>{switch(a){case"Patched by Livepatch":case"Fully patched":case"Kernel upgrade available":return"status-succeeded-small";case"Restart required":return"status-waiting-small";case"End of life":return"status-failed-small";default:return"status-failed-small"}},q=(a,t)=>{const s=l(t),r=l(),o=s.diff(r,"days");return o<0||!a?"status-failed-small":o<7?"status-waiting-small":"status-succeeded-small"},k=(a,t)=>{if(!a)return"Livepatch is disabled";const s=l(t),r=l();return s.diff(r,"days")<0?"Expired":`Expires on ${l(t).format(y)}`},V="_statusIcon_13tou_1",Y="_tooltipIcon_13tou_5",$="_container_13tou_9",d={statusIcon:V,tooltipIcon:Y,container:$},U=({kernelOverview:a})=>{const t=a.status!=="Livepatch disabled",s=[{label:"current kernel version",value:a.currentVersion||e.jsx(u,{})},{label:"kernel status",value:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:t?a.status||e.jsx(u,{}):"Not covered by Livepatch"}),e.jsxs(c.Tooltip,{message:M(a.status,a.expirationDate),className:d.tooltipIcon,children:[e.jsx(c.Icon,{name:"help","aria-hidden":!0}),e.jsx("span",{className:"u-off-screen",children:"Help"})]})]})},{label:"livepatch coverage",value:k(t,a.expirationDate)}];return e.jsx(c.Row,{className:T("u-no-padding--left u-no-padding--right u-no-max-width",d.container),children:s.map(({label:r,value:o})=>e.jsxs(c.Col,{size:3,children:[r==="status"&&e.jsx(c.Icon,{name:H(a.status),"aria-hidden":!0,className:d.statusIcon}),r==="livepatch coverage"&&e.jsx(c.Icon,{name:q(t,a.expirationDate),"aria-hidden":!0,className:d.statusIcon}),e.jsx(F,{label:r,value:o})]},r))})},z=`There are no pending kernel security patches to apply at this time.
                Livepatch applies critical and high security patches in the background without requiring a system restart.
                Patches found since last restart and their status will be shown here.`,Q=a=>`https://cve.mitre.org/cgi-bin/cvename.cgi?name=${a}`,G=a=>{const t={};switch(a.column.id){case"Name":t.role="rowheader";break;case"Patched":t["aria-label"]="Status";break;case"Description":t["aria-label"]="Description";break;case"Bug":t["aria-label"]="Bug";break}return t},R="_description_1s9gq_1",J={description:R},W=({kernelData:a})=>{const t=I.useMemo(()=>[{Header:e.jsx("span",{children:"CVE"}),accessor:"Name",Cell:({row:s})=>e.jsx(c.Link,{href:Q(s.original.Name),target:"_blank",rel:"nofollow noopener noreferrer",className:"u-no-margin--bottom u-no-padding--top",children:s.original.Name})},{Header:"Status",accessor:"Patched",Cell:({row:{original:s}})=>s.Patched?"Patched by Livepatch":"Unpatched",getCellIcon:({row:{original:s}})=>s.Patched?"status-succeeded-small":"status-failed-small",disableSortBy:!0},{Header:"Description",accessor:"Description",className:J.description,Cell:({row:s})=>s.original.Description||e.jsx(u,{}),disableSortBy:!0},{Header:"Bug",accessor:"Bug",Cell:({row:s})=>s.original.Bug||e.jsx(u,{}),disableSortBy:!0}],[]);return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"p-heading--5 u-no-padding u-no-margin",children:"Patches discovered since last restart"}),a.length===0?e.jsx(_,{title:"No outstanding kernel patches",body:z}):e.jsx(c.ModularTable,{columns:t,data:a,getCellProps:G,sortable:!0,initialSortColumn:"Name",initialSortDirection:"ascending"})]})},de=({instanceTitle:a})=>{var x,b,f,v;const{instanceId:t,childInstanceId:s}=C(),{pageSize:r,currentPage:o}=A(),{getKernelQuery:N,getLivepatchInfoQuery:L}=S(),g=Number(s??t),{data:n,isPending:p}=N({id:g}),{data:i}=L({id:g}),h=((x=i==null?void 0:i.data.livepatch_info)==null?void 0:x.json.output.Status[0].Livepatch.Fixes)??[],P=(E,j)=>h.slice(j,j+E),m=I.useMemo(()=>P(r,(o-1)*r),[h,o,r]),D={currentVersion:((b=i==null?void 0:i.data.livepatch_info)==null?void 0:b.json.output.Status[0].Kernel)??((f=n==null?void 0:n.data.installed)==null?void 0:f.version_rounded)??"",expirationDate:((v=i==null?void 0:i.data.livepatch_info)==null?void 0:v.json.output.Status[0].UpgradeRequiredDate)??"",status:(n==null?void 0:n.data.smart_status)??""};return e.jsxs(e.Fragment,{children:[p&&e.jsx(w,{}),!p&&!(n!=null&&n.data.installed)&&e.jsx(_,{title:"Kernel Information Unavailable",body:(n==null?void 0:n.data.message)||"No kernel information available"}),!p&&(n==null?void 0:n.data.installed)&&e.jsxs(e.Fragment,{children:[e.jsx(B,{instanceName:a,hasTableData:m.length>0,kernelStatuses:n.data}),e.jsx(U,{kernelOverview:D}),e.jsx(W,{kernelData:m}),e.jsx(K,{totalItems:h.length,currentItemCount:m.length})]})]})};export{de as default};
