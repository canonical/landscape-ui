const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BKc9dkdO.js","assets/index-BnGQjbY6.js","assets/index-DEuNBe7s.css","assets/SidePanelFormButtons--Q9YZC4o.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/MultiSelectField-D0iET_ss.js","assets/MultiSelectField-DOBW8uWL.css","assets/TablePagination-DcZ99TxS.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-C2L-bJ16.js","assets/helpers-BMGocV8F.js","assets/HeaderWithSearch-DC0deZG5.js","assets/HeaderWithSearch-DQybm8h_.css","assets/NoData-DZVW07Vw.js","assets/index-CYP-XQow.js","assets/InfoItem-BswH9Yly.js","assets/InfoItem-C-lWh_lY.css"])))=>i.map(i=>d[i]);
import{h as Y,e as X,f,g as v,p as F,q,i as I,t as J,k as Z,n as y,v as ee,j as e,d as n,r as x,_ as A,s as se,c as re,o as S,E as oe}from"./index-BnGQjbY6.js";import{T as te}from"./TablePagination-DcZ99TxS.js";import{S as ne}from"./SidePanelFormButtons--Q9YZC4o.js";import{g as ae,r as D,U as $,a as ie}from"./helpers-BMGocV8F.js";import{u as M}from"./usePageParams-C2L-bJ16.js";import{H as ce}from"./HeaderWithSearch-DC0deZG5.js";import{N as ue}from"./NoData-DZVW07Vw.js";function B(){const o=Y(),t=X(),i=(s,p={})=>v({queryKey:["users",{...s}],queryFn:()=>o.get("users",{params:s}),...p}),u=f({mutationKey:["users","new"],mutationFn:s=>o.post("users",s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),l=f({mutationKey:["users","edit"],mutationFn:s=>o.put("users",s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),d=f({mutationKey:["users","remove"],mutationFn:s=>o.delete("users",{params:s}),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),g=f({mutationKey:["users","lock"],mutationFn:s=>o.post("users/lock",s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),h=f({mutationKey:["users","unlock"],mutationFn:s=>o.post("users/unlock",s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),b=(s,p={})=>v({queryKey:["groups",(s==null?void 0:s.computer_id)??""],queryFn:()=>{if(!s)throw new Error("Missing required parameters");return o.get(`computers/${s.computer_id}/groups`)},...p}),a=(s,p={})=>v({queryKey:["userGroups",(s==null?void 0:s.computer_id)??"",(s==null?void 0:s.username)??""],queryFn:()=>{if(!s)throw new Error("Missing required parameters");return o.get(`computers/${s.computer_id}/users/${s.username}/groups`)},...p}),m=f({mutationKey:["groups","add"],mutationFn:s=>o.post(`computers/${s.computer_id}/usergroups/update_bulk`,s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),r=f({mutationKey:["groups","remove"],mutationFn:s=>o.post(`computers/${s.computer_id}/usergroups/update_bulk`,s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})});return{getUsersQuery:i,getGroupsQuery:b,getUserGroupsQuery:a,createUserQuery:u,removeUserQuery:d,editUserQuery:l,lockUserQuery:g,unlockUserQuery:h,addUserToGroupQuery:m,removeUserFromGroupQuery:r}}const le="_actions_1l3g0_1",de={actions:le},K=()=>{const{instanceId:o}=F(),t=q(),{closeSidePanel:i}=I(),{createUserQuery:u,getGroupsQuery:l}=B(),d=Number(o),{mutateAsync:g}=u,{data:h,isLoading:b}=l({computer_id:d}),m=((h==null?void 0:h.data.groups)??[]).map(s=>({label:s.name,value:s.name})),r=J({initialValues:{name:"",username:"",password:"",confirmPassword:"",requirePasswordReset:!1,location:"",homePhoneNumber:"",workPhoneNumber:"",primaryGroupValue:""},validationSchema:Z().shape({name:y().required("This field is required"),username:y().required("This field is required"),password:y().required("This field is required"),confirmPassword:y().required("This field is required").oneOf([ee("password"),""],"Passwords must match"),location:y(),homePhoneNumber:y(),workPhoneNumber:y(),primaryGroupValue:y().required("This field is required")}),onSubmit:async s=>{try{await g({computer_ids:[d],name:s.name,username:s.username,password:s.password,require_password_reset:s.requirePasswordReset,location:s.location,home_phone:s.homePhoneNumber,work_phone:s.workPhoneNumber,primary_groupname:s.primaryGroupValue}),i()}catch(p){t(p)}}});return e.jsxs(n.Form,{noValidate:!0,onSubmit:r.handleSubmit,name:"add-new-user",children:[e.jsx(n.Input,{type:"text",label:"Username",autoComplete:"new-username",required:!0,error:r.touched.username&&r.errors.username?r.errors.username:void 0,...r.getFieldProps("username")}),e.jsx(n.Input,{type:"text",label:"Name",required:!0,error:r.touched.name&&r.errors.name?r.errors.name:void 0,...r.getFieldProps("name")}),e.jsx(n.Input,{type:"password",label:"Passphrase",autoComplete:"new-password",required:!0,error:r.touched.password&&r.errors.password?r.errors.password:void 0,...r.getFieldProps("password")}),e.jsx(n.Input,{type:"password",label:"Confirm passphrase",autoComplete:"new-password",required:!0,error:r.touched.confirmPassword&&r.errors.confirmPassword?r.errors.confirmPassword:void 0,...r.getFieldProps("confirmPassword")}),e.jsx(n.Input,{type:"checkbox",label:"Require passphrase reset",help:"User must change password at first login",...r.getFieldProps("requirePasswordReset"),checked:r.values.requirePasswordReset}),e.jsx(n.Select,{label:"Primary Group",disabled:b,options:[{label:"Select",value:""},...m],...r.getFieldProps("primaryGroupValue"),error:r.touched.primaryGroupValue&&r.errors.primaryGroupValue?r.errors.primaryGroupValue:void 0}),e.jsx(n.Input,{type:"text",label:"Location",error:r.touched.location&&r.errors.location?r.errors.location:void 0,...r.getFieldProps("location")}),e.jsx(n.Input,{type:"text",label:"Home phone",error:r.touched.homePhoneNumber&&r.errors.homePhoneNumber?r.errors.homePhoneNumber:void 0,...r.getFieldProps("homePhoneNumber")}),e.jsx(n.Input,{type:"text",label:"Work phone",error:r.touched.workPhoneNumber&&r.errors.workPhoneNumber?r.errors.workPhoneNumber:void 0,...r.getFieldProps("workPhoneNumber")}),e.jsx(ne,{submitButtonDisabled:r.isSubmitting,submitButtonText:"Add user"})]})},me=x.lazy(()=>A(()=>import("./index-BKc9dkdO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),pe=({selectedUsers:o,handleClearSelection:t,sidePanel:i=!1})=>{const[u,l]=x.useState(!1),{instanceId:d}=F(),g=q(),{notify:h}=se(),{setSidePanelContent:b,closeSidePanel:a}=I(),{removeUserQuery:m,lockUserQuery:r,unlockUserQuery:s}=B(),{mutateAsync:p,isPending:N}=m,{mutateAsync:k,isPending:_}=r,{mutateAsync:P,isPending:j}=s,w=Number(d),c=o.length===1?o[0]:void 0,{locked:Q,unlocked:E}=ae(o),C=async(U,L)=>{try{await U({computer_ids:[w],usernames:ie(o),delete_home:L==="removed"?u:void 0}),t&&t(),a(),h.success({message:`Successfully requested to be ${L}`})}catch(W){g(W)}},G=async()=>{await C(k,"locked")},V=async()=>{await C(P,"unlocked")},H=async()=>{await C(p,"removed")},R=()=>{b("Add new user",e.jsx(K,{}))},O=U=>{b("Edit user",e.jsx(x.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(me,{user:U})}))},z=()=>{l(U=>!U)};return e.jsxs("div",{className:re("p-panel__controls u-no-padding--top",{"u-no-margin--left":i}),children:[!i&&e.jsxs(n.Button,{className:"u-no-margin--right",type:"button",hasIcon:!0,onClick:R,children:[e.jsx(n.Icon,{name:n.ICONS.plus}),e.jsx("span",{children:"Add user"})]}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[((c==null?void 0:c.enabled)||!i)&&e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:E===0,"aria-disabled":E===0,confirmationModalProps:{title:`Lock ${c?`user ${c.username}`:`${o.length} users`}`,children:D({user:c,selectedUsers:o,userAction:$.Lock}),confirmButtonLabel:"Lock",confirmButtonAppearance:"positive",confirmButtonLoading:_,confirmButtonDisabled:_,onConfirm:G},children:[e.jsx(n.Icon,{name:"lock-locked"}),e.jsx("span",{children:"Lock"})]}),(!(c!=null&&c.enabled)||!i)&&e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:Q===0,"aria-disabled":Q===0,confirmationModalProps:{title:`Unlock ${c?`user ${c.username}`:`${o.length} users`}`,children:D({user:c,selectedUsers:o,userAction:$.Unlock}),confirmButtonLabel:"Unlock",confirmButtonAppearance:"positive",confirmButtonLoading:j,confirmButtonDisabled:j,onConfirm:V},children:[e.jsx(n.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlock"})]}),i&&c&&e.jsxs(n.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>O(c),children:[e.jsx(n.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:o.length===0,"aria-disabled":o.length===0,confirmationModalProps:{title:`Delete ${c?c.username:"users"}`,children:e.jsxs("div",{children:[e.jsx("p",{className:"u-no-margin--bottom",children:c?`This will delete user ${c.username}. You can delete this user's home folders at the same time.`:"This will delete selected users. You can delete their home folders as well."}),e.jsx(n.Input,{label:"Delete the home folders as well",type:"checkbox",checked:u,onChange:z})]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonLoading:N,confirmButtonDisabled:N,onConfirm:H},children:[e.jsx(n.Icon,{name:n.ICONS.delete}),e.jsx("span",{children:"Delete"})]})]})})]})},he=(o,t)=>o.filter(i=>t.includes(i.uid)),ge=({selected:o,handleClearSelection:t,users:i})=>{const{setPageParams:u}=M(),l=d=>{u({search:d}),t()};return e.jsx(ce,{onSearch:l,actions:e.jsx("div",{className:de.actions,children:e.jsx(pe,{handleClearSelection:t,selectedUsers:he(i,o)})})})},be="_status_1or9p_1",xe="_actions_1or9p_7",T={status:be,actions:xe},ye=({column:o})=>{const t={};switch(o.id){case"username":t.role="rowheader";break;case"enabled":t["aria-label"]="Status";break;case"uid":t["aria-label"]="User id";break;case"name":t["aria-label"]="Full name";break}return t},fe=x.lazy(()=>A(()=>import("./index-BKc9dkdO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),je=x.lazy(()=>A(()=>import("./index-CYP-XQow.js"),__vite__mapDeps([16,1,2,17,18,15,8,9,10,11,3,4,5,12,13,14]))),ke=({users:o,selected:t,setSelected:i})=>{const{setSidePanelContent:u}=I(),l=a=>{u("Edit user",e.jsx(x.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(fe,{user:a})}))},d=a=>{u("User details",e.jsx(x.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(je,{user:a})}))},g=()=>{i(t.length!==0?[]:o.map(({uid:a})=>a))},h=a=>{t.includes(a)?i(t.filter(m=>m!==a)):i([...t,a])},b=x.useMemo(()=>[{accessor:"username",Header:e.jsxs(e.Fragment,{children:[e.jsx(n.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:g,checked:o.length>0&&t.length===o.length,indeterminate:t.length>0&&t.length<o.length}),e.jsx("span",{children:"username"})]}),Cell:({row:a})=>e.jsxs(e.Fragment,{children:[e.jsx(n.CheckboxInput,{inline:!0,label:e.jsxs("span",{className:"u-off-screen",children:["Select user ",a.original.username]}),checked:t.includes(a.original.uid),onChange:()=>h(a.original.uid)}),e.jsx(n.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>d(a.original),"aria-label":`Show details of user ${a.original.username}`,children:a.original.username})]})},{Header:"status",accessor:"enabled",sortType:"basic",Cell:({row:a})=>e.jsx("div",{className:T.status,children:a.original.enabled?e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlocked"})]}):e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{name:"lock-locked-active"}),e.jsx("span",{children:"Locked"})]})})},{Header:"UID",accessor:"uid",sortType:"basic"},{Header:"Full Name",accessor:"name",sortType:"basic",Cell:({row:a})=>a.original.name||e.jsx(ue,{})},{accessor:"actions",className:T.actions,Cell:({row:a})=>e.jsx(n.Tooltip,{message:"Edit",position:"btm-center",children:e.jsx(n.Button,{type:"button",small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Edit ${a.original.name} profile`,onClick:()=>l(a.original),children:e.jsx(n.Icon,{name:"edit",className:"u-no-margin--left"})})})}],[o]);return e.jsx(n.ModularTable,{columns:b,data:o,emptyMsg:"No users available",sortable:!0,initialSortDirection:"ascending",initialSortColumn:"username",getCellProps:ye})},_e=(o,t)=>o?t.filter(({username:i,name:u})=>{const l=u==null?void 0:u.toUpperCase().includes(o.toUpperCase()),d=i.toUpperCase().includes(o.toUpperCase());return l||d}):t,Ue=1e3,we=()=>{const[o,t]=x.useState([]),{instanceId:i,childInstanceId:u}=F(),{search:l,currentPage:d,pageSize:g}=M(),{setSidePanelContent:h}=I(),{getUsersQuery:b}=B(),a=Number(u??i),{data:m,isLoading:r}=b({computer_id:a,limit:Ue}),s=(m==null?void 0:m.data.results)??[],p=x.useMemo(()=>_e(l,s),[l,s]),k=((j,w)=>p.slice(w,w+j))(g,(d-1)*g),_=()=>{t([])},P=()=>{h("Add new user",e.jsx(K,{}))};return e.jsxs(e.Fragment,{children:[r&&e.jsx(S,{}),!r&&(!m||m.data.results.length===0)&&e.jsx(oe,{title:"No users found",body:"Add new users by clicking the button below",icon:"connected",cta:[e.jsx(n.Button,{type:"button",appearance:"positive",onClick:P,children:"Add user"},"empty-state-add-new-user")]}),(l||!r&&p.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{selected:o,handleClearSelection:_,users:k}),e.jsx(ke,{selected:o,setSelected:j=>t(j),users:k})]}),e.jsx(te,{handleClearSelection:_,totalItems:p.length,currentItemCount:k.length})]})},Ae=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"}));export{pe as U,Ae as i,B as u};
