const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CgiI3ADR.js","assets/index-CNSDWj8Q.js","assets/index-CoB-_C5O.css","assets/SidePanelFormButtons-DIizKTix.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/MultiSelectField-CqoYdMk0.js","assets/MultiSelectField-GyNA33om.css","assets/formikErrors-Bw8iTXYS.js","assets/TablePagination-CFXNvqsZ.js","assets/TableFilterChips-06YfpJdc.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-CLgA9gvz.css","assets/helpers-CHVZpA7p.js","assets/InstancesPageActions-DL7_pmR1.js","assets/index-D-YBZSy_.js","assets/NoData-6ZK9sV5u.js","assets/useFetchOld-BAAs34Op.js","assets/PageParamFilter-ChSwlZqZ.js","assets/TableFilter-2AKF5NjJ.js","assets/TableFilter-B85Stwni.css","assets/ResponsiveTable-BXalKviy.js","assets/ResponsiveTable-DsN8RVSX.css","assets/index-B1ULwG00.css","assets/ListTitle-BUruUKn1.js","assets/ListTitle-CxCHkD9o.css","assets/StaticLink-BEYCGcPv.js","assets/TruncatedCell-BMum6DLZ.js","assets/Truncated-Dtg97i8C.js","assets/Truncated-uqJp6ujM.css","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-B4jhRgod.js","assets/index-CySvbr4l.js","assets/TextConfirmationModal-q88mH05g.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/InfoGrid-3w5mqARw.js","assets/InfoItem-Bt7JBIPo.js","assets/InfoItem-D8nPzgUA.css","assets/InfoGrid-D3QqOHFx.css","assets/InstancesPageActions-h3D4euDx.css","assets/HeaderWithSearch-D2tNhOlz.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/constants-CDnVvJTb.js","assets/index-pWRI0b4u.js"])))=>i.map(i=>d[i]);
import{q as G,r as p,f as ae,t as ue,v as k,c as q,C as B,y as H,x as P,B as ce,k as ie,h as x,I as le,j as e,d as o,z as de,G as L,e as N,_ as E,a4 as me,E as pe,L as he,R as ye}from"./index-CNSDWj8Q.js";import{a as ge}from"./TablePagination-CFXNvqsZ.js";import{S as be}from"./SidePanelFormButtons-DIizKTix.js";import{g as f}from"./formikErrors-Bw8iTXYS.js";import{g as xe,r as O,U as R,a as fe}from"./helpers-CHVZpA7p.js";import{R as ke}from"./InstancesPageActions-DL7_pmR1.js";import{H as je}from"./HeaderWithSearch-D2tNhOlz.js";import{T as we}from"./TableFilterChips-06YfpJdc.js";import{L as M}from"./constants-CDnVvJTb.js";import{N as Ue}from"./NoData-6ZK9sV5u.js";import{R as _e}from"./ResponsiveTable-BXalKviy.js";const A=5e3;function Ce({data:s,sortFunctions:n}){const{sortBy:a,sort:c}=G();return p.useMemo(()=>{const i=n[a];return!a||!c||!i?s:s.toSorted((l,h)=>{const y=i(l,h);return c==="asc"?y:-y})},[s,a,c,n])}function Q(){const s=ae(),n=ue(),a=(t,g={})=>q({queryKey:["users",{...t}],queryFn:async()=>s.get("users",{params:t}),...g}),c=k({mutationKey:["users","new"],mutationFn:async t=>s.post("users",t),onSuccess:async()=>n.invalidateQueries({queryKey:["users"]})}),i=k({mutationKey:["users","edit"],mutationFn:async t=>s.put("users",t),onSuccess:async()=>n.invalidateQueries({queryKey:["users"]})}),l=k({mutationKey:["users","remove"],mutationFn:async t=>s.delete("users",{params:t}),onSuccess:async()=>n.invalidateQueries({queryKey:["users"]})}),h=k({mutationKey:["users","lock"],mutationFn:async t=>s.post("users/lock",t),onSuccess:async()=>n.invalidateQueries({queryKey:["users"]})}),y=k({mutationKey:["users","unlock"],mutationFn:async t=>s.post("users/unlock",t),onSuccess:async()=>n.invalidateQueries({queryKey:["users"]})}),b=(t,g={})=>q({queryKey:["groups",t?.computer_id??""],queryFn:async()=>{if(!t)throw new Error("Missing required parameters");return s.get(`computers/${t.computer_id}/groups`)},...g}),r=(t,g={})=>q({queryKey:["userGroups",t?.computer_id??"",t?.username??""],queryFn:async()=>{if(!t)throw new Error("Missing required parameters");return s.get(`computers/${t.computer_id}/users/${t.username}/groups`)},...g}),d=k({mutationKey:["groups","add"],mutationFn:async t=>s.post(`computers/${t.computer_id}/usergroups/update_bulk`,t),onSuccess:async()=>n.invalidateQueries({queryKey:["users"]})}),u=k({mutationKey:["groups","remove"],mutationFn:async t=>s.post(`computers/${t.computer_id}/usergroups/update_bulk`,t),onSuccess:async()=>n.invalidateQueries({queryKey:["users"]})});return{getUsersQuery:a,getGroupsQuery:b,getUserGroupsQuery:r,createUserQuery:c,removeUserQuery:l,editUserQuery:i,lockUserQuery:h,unlockUserQuery:y,addUserToGroupQuery:d,removeUserFromGroupQuery:u}}const Se="_actions_1l3g0_1",Ie={actions:Se},V=()=>{const{instanceId:s}=B(),n=H(),{closeSidePanel:a}=P(),{createUserQuery:c,getGroupsQuery:i}=Q(),l=Number(s),{mutateAsync:h}=c,{data:y,isLoading:b}=i({computer_id:l}),d=(y?.data.groups??[]).map(t=>({label:t.name,value:t.name})),u=ce({initialValues:{name:"",username:"",password:"",confirmPassword:"",requirePasswordReset:!1,location:"",homePhoneNumber:"",workPhoneNumber:"",primaryGroupValue:""},validationSchema:ie().shape({name:x().required("This field is required"),username:x().required("This field is required"),password:x().required("This field is required"),confirmPassword:x().required("This field is required").oneOf([le("password"),""],"Passwords must match"),location:x(),homePhoneNumber:x(),workPhoneNumber:x(),primaryGroupValue:x().required("This field is required")}),onSubmit:async t=>{try{await h({computer_ids:[l],name:t.name,username:t.username,password:t.password,require_password_reset:t.requirePasswordReset,location:t.location,home_phone:t.homePhoneNumber,work_phone:t.workPhoneNumber,primary_groupname:t.primaryGroupValue}),a()}catch(g){n(g)}}});return e.jsxs(o.Form,{noValidate:!0,onSubmit:u.handleSubmit,name:"add-new-user",children:[e.jsx(o.Input,{type:"text",label:"Username",autoComplete:"new-username",required:!0,error:f(u,"username"),...u.getFieldProps("username")}),e.jsx(o.Input,{type:"text",label:"Name",required:!0,error:f(u,"name"),...u.getFieldProps("name")}),e.jsx(o.Input,{type:"password",label:"Password",autoComplete:"new-password",required:!0,error:f(u,"password"),...u.getFieldProps("password")}),e.jsx(o.Input,{type:"password",label:"Confirm password",autoComplete:"new-password",required:!0,error:f(u,"confirmPassword"),...u.getFieldProps("confirmPassword")}),e.jsx(o.Input,{type:"checkbox",label:"Require password reset",help:"User must change password at first login.",...u.getFieldProps("requirePasswordReset"),checked:u.values.requirePasswordReset}),e.jsx(o.Select,{label:"Primary Group",disabled:b,options:[{label:"Select",value:""},...d],...u.getFieldProps("primaryGroupValue"),error:f(u,"primaryGroupValue")}),e.jsx(o.Input,{type:"text",label:"Location",error:f(u,"location"),...u.getFieldProps("location")}),e.jsx(o.Input,{type:"text",label:"Home phone",error:f(u,"homePhoneNumber"),...u.getFieldProps("homePhoneNumber")}),e.jsx(o.Input,{type:"text",label:"Work phone",error:f(u,"workPhoneNumber"),...u.getFieldProps("workPhoneNumber")}),e.jsx(be,{submitButtonDisabled:u.isSubmitting,submitButtonText:"Add user"})]})},Ne=p.lazy(async()=>E(()=>import("./index-CgiI3ADR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42]))),Pe=({selectedUsers:s,handleClearSelection:n,sidePanel:a=!1})=>{const[c,i]=p.useState(!1),{instanceId:l}=B(),h=H(),{notify:y}=de(),{setSidePanelContent:b,closeSidePanel:r}=P(),{removeUserQuery:d,lockUserQuery:u,unlockUserQuery:t}=Q(),[g,j]=p.useState(!1),[F,w]=p.useState(!1),[S,I]=p.useState(!1),{mutateAsync:U,isPending:_}=d,{mutateAsync:z,isPending:T}=u,{mutateAsync:W,isPending:$}=t,Y=Number(l),m=s.length===1?s[0]:void 0,{locked:X,unlocked:J}=xe(s),v=async(C,D)=>{try{await C({computer_ids:[Y],usernames:fe(s),delete_home:D==="removed"?c:void 0}),n&&n(),r(),y.success({message:`Successfully requested to be ${D}`})}catch(re){h(re)}},Z=async()=>{await v(z,"locked")},ee=async()=>{await v(W,"unlocked")},se=async()=>{await v(U,"removed")},te=()=>{b("Add new user",e.jsx(V,{}))},ne=C=>{b("Edit user",e.jsx(p.Suspense,{fallback:e.jsx(N,{}),children:e.jsx(Ne,{user:C})}))},oe=()=>{i(C=>!C)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:L("p-panel__controls u-no-padding--top",{"u-no-margin--left":a}),children:[!a&&e.jsxs(o.Button,{className:L("u-no-margin--right",{"u-no-margin--bottom":!a}),type:"button",hasIcon:!0,onClick:te,children:[e.jsx(o.Icon,{name:o.ICONS.plus}),e.jsx("span",{children:"Add user"})]}),e.jsx(ke,{collapseFrom:a?void 0:"lg",buttons:[(m?.enabled||!a)&&e.jsxs(o.Button,{hasIcon:!0,type:"button",disabled:J===0,onClick:()=>{j(!0)},children:[e.jsx(o.Icon,{name:"lock-locked"}),e.jsx("span",{children:"Lock"})]},"lock"),(!m?.enabled||!a)&&e.jsxs(o.Button,{hasIcon:!0,type:"button",disabled:X===0,onClick:()=>{w(!0)},children:[e.jsx(o.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlock"})]},"unlock"),a&&m&&e.jsxs(o.Button,{className:L("p-segmented-control__button has-icon",{"u-no-margin--bottom":!a}),type:"button",onClick:()=>{ne(m)},children:[e.jsx(o.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]},"edit"),e.jsxs(o.Button,{hasIcon:!0,type:"button",disabled:s.length===0,onClick:()=>{I(!0)},children:[e.jsx(o.Icon,{name:o.ICONS.delete}),e.jsx("span",{children:"Delete"})]},"delete")]})]}),g&&e.jsx(o.ConfirmationModal,{title:`Lock ${m?`user ${m.username}`:`${s.length} users`}`,close:()=>{j(!1)},confirmButtonLabel:"Lock",confirmButtonAppearance:"positive",confirmButtonLoading:T,confirmButtonDisabled:T,onConfirm:Z,children:O({user:m,selectedUsers:s,userAction:R.Lock})}),F&&e.jsx(o.ConfirmationModal,{title:`Unlock ${m?`user ${m.username}`:`${s.length} users`}`,close:()=>{w(!1)},confirmButtonLabel:"Unlock",confirmButtonAppearance:"positive",confirmButtonLoading:$,confirmButtonDisabled:$,onConfirm:ee,children:O({user:m,selectedUsers:s,userAction:R.Unlock})}),S&&e.jsx(o.ConfirmationModal,{title:`Delete ${m?m.username:"users"}`,close:()=>{I(!1)},confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonLoading:_,confirmButtonDisabled:_,onConfirm:se,children:e.jsxs("div",{children:[e.jsx("p",{className:"u-no-margin--bottom",children:m?`This will delete user ${m.username}. You can delete this user's home folders at the same time.`:"This will delete selected users. You can delete their home folders as well."}),e.jsx(o.Input,{label:"Delete the home folders as well",type:"checkbox",checked:c,onChange:oe})]})})]})},Fe=(s,n)=>s.filter(a=>n.includes(a.uid)),ve=({selected:s,handleClearSelection:n,users:a})=>e.jsxs(e.Fragment,{children:[e.jsx(je,{actions:e.jsx("div",{className:Ie.actions,children:e.jsx(Pe,{handleClearSelection:n,selectedUsers:Fe(a,s)})})}),e.jsx(we,{filtersToDisplay:["search"]})]}),qe={username:(s,n)=>s.username.localeCompare(n.username),status:(s,n)=>Number(s.enabled)-Number(n.enabled),name:(s,n)=>(s.name||"").localeCompare(n.name||""),uid:(s,n)=>s.uid-n.uid},Le="_status_xcrdk_1",Ae="_statusCell_xcrdk_7",K={status:Le,statusCell:Ae},Be=p.lazy(async()=>E(()=>import("./index-CgiI3ADR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42]))),Ee=p.lazy(async()=>E(()=>import("./index-pWRI0b4u.js"),__vite__mapDeps([43,1,2,35,36,16,28,29,37,38,9,10,11,12,3,4,5,8,13,14,15,17,18,19,20,21,22,23,24,25,26,27,30,31,32,33,34,39,40,41,42]))),Qe=({users:s,selected:n,setSelected:a})=>{const{setSidePanelContent:c}=P(),i=r=>{c("Edit user",e.jsx(p.Suspense,{fallback:e.jsx(N,{}),children:e.jsx(Be,{user:r})}))},l=r=>{c("User details",e.jsx(p.Suspense,{fallback:e.jsx(N,{}),children:e.jsx(Ee,{user:r})}))},h=()=>{a(n.length!==0?[]:s.map(({uid:r})=>r))},y=r=>{n.includes(r)?a(n.filter(d=>d!==r)):a([...n,r])},b=p.useMemo(()=>[{accessor:"checkbox",className:"checkbox-column",Header:e.jsx(o.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),labelClassName:"u-no-margin--bottom u-no-padding--top",onChange:h,checked:s.length>0&&n.length===s.length,indeterminate:n.length>0&&n.length<s.length,disabled:s.length===0}),Cell:({row:{original:r}})=>e.jsx(o.CheckboxInput,{inline:!0,label:e.jsxs("span",{className:"u-off-screen",children:["Select user ",r.username]}),disabled:s.length===0,checked:n.includes(r.uid),onChange:()=>{y(r.uid)}})},{Header:"username",role:"rowheader",Cell:({row:{original:r}})=>e.jsx(o.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{l(r)},"aria-label":`Show details of user ${r.username}`,children:r.username})},{Header:"status",className:K.statusCell,Cell:({row:{original:r}})=>e.jsx("div",{className:K.status,children:r.enabled?e.jsxs(e.Fragment,{children:[e.jsx(o.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlocked"})]}):e.jsxs(e.Fragment,{children:[e.jsx(o.Icon,{name:"lock-locked-active"}),e.jsx("span",{children:"Locked"})]})})},{Header:"UID",accessor:"uid"},{Header:"Full name",Cell:({row:{original:r}})=>r.name||e.jsx(Ue,{})},{Header:M.Header,className:M.className,Cell:({row:{original:r}})=>e.jsx(me,{toggleAriaLabel:`"${r.name}" user actions`,actions:[{icon:"edit",label:"Edit","aria-label":`Edit "${r.name}" user`,onClick:()=>{i(r)}}]})}],[s,n]);return e.jsx(_e,{columns:b,data:s,emptyMsg:"No users found according to your search parameters."})},Te=(s,n)=>s?n.filter(({username:a,name:c})=>{const i=c?.toUpperCase().includes(s.toUpperCase()),l=a.toUpperCase().includes(s.toUpperCase());return i||l}):n,$e=()=>{const[s,n]=p.useState([]),{instanceId:a,childInstanceId:c}=B(),{search:i,currentPage:l,pageSize:h}=G(),{setSidePanelContent:y}=P(),{getUsersQuery:b}=Q(),r=Number(c??a),{data:d,isLoading:u}=b({computer_id:r,limit:A}),t=d?.data.results??[],g=Ce({data:t,sortFunctions:qe}),j=Te(i,g),F=(U,_)=>j.slice(_,_+U),w=p.useMemo(()=>F(h,(l-1)*h),[i,j,l,h]),S=()=>{n([])},I=()=>{y("Add new user",e.jsx(V,{}))};return!i&&u?e.jsx(N,{}):!i&&(!d||d.data.results.length===0)?e.jsx(pe,{title:"No users found",body:"Add new users by clicking the button below.",icon:"connected",cta:[e.jsx(o.Button,{type:"button",appearance:"positive",onClick:I,children:"Add user"},"empty-state-add-new-user")]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{selected:s,handleClearSelection:S,users:w}),d&&d.data.count>A&&e.jsx(o.Notification,{severity:"caution",title:`Fetched ${A} out of ${d.data.count} users`,children:e.jsxs("span",{children:["The number of requested users is too high. Please"," ",e.jsx(he,{to:ye.external.support(),children:"contact our support team."})]})}),e.jsx(Qe,{selected:s,setSelected:U=>{n(U)},users:w}),e.jsx(ge,{handleClearSelection:S,totalItems:j.length,currentItemCount:w.length})]})},Xe=Object.freeze(Object.defineProperty({__proto__:null,default:$e},Symbol.toStringTag,{value:"Module"}));export{Pe as U,Xe as i,Q as u};
