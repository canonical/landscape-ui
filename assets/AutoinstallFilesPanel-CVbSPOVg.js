import{b as v,e as F,f as I,i as p,p as Y,q as C,n as x,s as z,j as e,d as o,t as S,a0 as Q,w as A,v as T,I as h,B as g,D as y,P as E,av as K,aI as W,al as J,aJ as X,aw as Z,h as ee,E as te,aB as se,_ as ae}from"./index-D5hCAEXL.js";import{u as D}from"./useGetAutoinstallFiles-By3vCl_7.js";import{r as N,A as w,b as ne,a as ie,g as le}from"./helpers-B4nWsGMV.js";import"./index-CHr_lV9Y.js";import{V as oe,D as re,u as ce,A as ue,a as P,C as de}from"./AutoinstallFileVersionHistory-BdMwf7Te.js";import{H as me}from"./HeaderWithSearch-cawzUFjI.js";import{C as pe}from"./CodeEditor-B3fPJpJg.js";import{S as fe}from"./SidePanelFormButtons-CPNoBpWE.js";import"./SidePanelTablePagination-DUDSBiUc.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";const k=()=>{const t=v(),s=F(),{isPending:n,mutateAsync:a}=I({mutationFn:async i=>t.post("autoinstall",i),onSuccess:async()=>s.invalidateQueries({queryKey:["autoinstallFiles"]})});return{isAutoinstallFileAdding:n,addAutoinstallFile:a}},he=()=>{const t=v(),s=F(),{isPending:n,mutateAsync:a}=I({mutationFn:async({id:i})=>t.delete(`autoinstall/${i}`),onSuccess:async()=>s.invalidateQueries({queryKey:["autoinstallFiles"]})});return{deleteAutoinstallFile:a,isAutoinstallFileUpdating:n}},O=()=>{const t=v(),s=F(),{isPending:n,mutateAsync:a}=I({mutationFn:async({id:i,...l})=>t.patch(`autoinstall/${i}`,l),onSuccess:async()=>{await s.invalidateQueries({queryKey:["autoinstallFiles"]})}});return{isAutoinstallFileUpdating:n,updateAutoinstallFile:a}},Ae="_form_1dly8_1",xe="_inputContainer_1dly8_7",_e="_input_1dly8_7",be="_inputDescription_1dly8_16",b={form:Ae,inputContainer:xe,input:_e,inputDescription:be},je=(t,s)=>t===s,$=({buttonText:t,description:s,initialFile:n=re,notification:a,onSubmit:i})=>{const l=t==="Add",r=p.useRef(null),u=Y(),{notify:m}=C(),{closeSidePanel:j}=x(),c=z({initialValues:{contents:n.contents,is_default:n.is_default,filename:N(n.filename)},validationSchema:oe,onSubmit:async d=>{const f=`${d.filename}${w}`;try{await i({contents:d.contents,is_default:d.is_default,filename:f}),j(),m.success({message:`The autoinstall file ${f} ${a.message}`,title:`${a.title} ${f}`})}catch(_){u(_)}}}),q=async({target:{files:d}})=>{if(!d)return;const[f]=d,_=c.setFieldValue("contents",await f.text());if(c.values.filename){await _;return}await Promise.all([c.setFieldValue("filename",N(f.name)),_])},G=async d=>{await c.setFieldValue("contents",d)},H=()=>{r.current?.click()};return e.jsxs(o.Form,{className:b.form,noValidate:!0,onSubmit:c.handleSubmit,children:[e.jsx("span",{children:s}),e.jsxs("div",{className:b.inputContainer,children:[e.jsx(o.Input,{wrapperClassName:b.input,type:"text",label:"File name",...c.getFieldProps("filename"),error:S(c,"filename"),disabled:!!n.filename,required:!0}),e.jsx("span",{className:b.inputDescription,children:w})]}),l&&e.jsx(o.Input,{type:"checkbox",label:"Default",...c.getFieldProps("is_default"),help:"This file will be used to configure newly registered instances. Only one default file can be set at a time."}),e.jsx("input",{ref:r,className:"u-hide",type:"file",accept:ne.map(d=>`.${d}`).join(","),onChange:q}),e.jsx(pe,{label:"Code",value:c.values.contents,onChange:G,error:S(c,"contents"),required:!0,language:ie,headerContent:e.jsxs(o.Button,{className:"u-no-margin--bottom",appearance:"base",hasIcon:!0,onClick:H,type:"button",children:[e.jsx(o.Icon,{name:"upload"}),e.jsx("span",{children:"Populate from file"})]})}),e.jsx(fe,{submitButtonDisabled:je(c.values.contents,n.contents)||c.isSubmitting,submitButtonText:t})]})},ge="_container_fgz2s_1",ye={container:ge},M=({openAddForm:t})=>e.jsxs(e.Fragment,{children:[e.jsx(me,{actions:e.jsx("div",{className:ye.container,children:e.jsxs(o.Button,{type:"button",className:"u-no-margin",hasIcon:!0,onClick:t,children:[e.jsx(o.Icon,{name:"plus"}),e.jsx("span",{children:"Add new"})]})})}),e.jsx(Q,{filtersToDisplay:["search"]})]}),ve={message:"has been edited and all the changes made have been saved successfully.",title:"You have successfully saved changes for"},Fe=({autoinstallFile:t})=>{const{autoinstallFile:s,isAutoinstallFileLoading:n}=ce({id:t.id,with_metadata:!0}),{updateAutoinstallFile:a}=O();return n||!s?e.jsx(A,{}):e.jsxs(e.Fragment,{children:[s.metadata.max_versions<=s.version&&e.jsx(o.Notification,{inline:!0,title:"Edit history limit reached:",severity:"caution",children:e.jsxs("p",{children:["You've reached the limit of"," ",s.metadata.max_versions," saved"," ",T(s.metadata.max_versions,"edit"),". To save your new change, the oldest version will be automatically removed, keeping the most recent"," ",s.metadata.max_versions," ",T(s.metadata.max_versions,"version")," ","in history."]})}),e.jsx($,{buttonText:"Save changes",description:`The duplicated ${s.filename} will be assigned to the same user groups in the identity provider as the original file.`,initialFile:s,notification:ve,onSubmit:async({contents:i,is_default:l})=>{await a({id:s.id,contents:i,is_default:l})}})]})},V=({autoinstallFile:t,close:s})=>{const{notify:n}=C(),{closeSidePanel:a}=x(),{deleteAutoinstallFile:i}=he(),l=async()=>{await i({id:t.id}),s(),a(),n.success({message:`The autoinstall file ${t.filename} has been permanently removed. All Employee accounts previously relying on it through identity provider group assignments will now fall back to the default autoinstall file.`,title:`You have successfully removed ${t.filename} autoinstall file.`})};return e.jsx(o.ConfirmationModal,{close:s,confirmButtonAppearance:"negative",confirmButtonLabel:"Remove",onConfirm:l,title:`Remove ${t.filename}, autoinstall file`,children:e.jsxs("p",{children:["You are about to remove ",t.filename,", an autoinstall file. This action is irreversible. All Employee accounts previously assigned this file via identity provider will instead use the default autoinstall file."]})})},Ie=({file:t})=>e.jsxs(h,{children:[e.jsx(h.Item,{label:"Name",value:t.filename}),e.jsx(h.Item,{label:"Version",value:t.version}),e.jsx(h.Item,{label:"Last modified",value:g(t.last_modified_at).format(y)}),e.jsx(h.Item,{label:"Date created",value:g(t.created_at).format(y)})]}),Ce="_tabs_1ks86_1",Se={tabs:Ce},Te=[{id:"info",label:"Info"},{id:"version-history",label:"Version history"}],Ne=({file:t,viewVersionHistory:s,initialTabId:n="info"})=>{const[a,i]=p.useState(n),l=Te.map(({label:r,id:u})=>({label:r,active:u===a,role:"tab",onClick:()=>{i(u)}}));return e.jsxs(e.Fragment,{children:[e.jsx(o.Tabs,{listClassName:Se.tabs,links:l}),a==="info"&&e.jsx(Ie,{file:t}),a==="version-history"&&e.jsx(ue,{file:t,viewVersionHistory:s})]})},we=({autoinstallFile:t,initialTabId:s})=>{const{value:n,setTrue:a,setFalse:i}=E(),{openAutoinstallFileDetails:l,openAutoinstallFileEditForm:r,setAutoinstallFileAsDefault:u}=R(t),m=()=>{l("version-history")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button",onClick:r,hasIcon:!0,children:[e.jsx(o.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button",onClick:u,disabled:t.is_default,hasIcon:!0,children:[e.jsx(o.Icon,{name:"starred"}),e.jsx("span",{children:"Set as default"})]}),e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button",onClick:a,disabled:t.is_default,hasIcon:!0,children:[e.jsx(o.Icon,{name:o.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]})}),e.jsx(Ne,{initialTabId:s,file:t,viewVersionHistory:m}),n&&e.jsx(V,{autoinstallFile:t,close:i})]})},B=()=>{const{setSidePanelContent:t}=x();return(s,n)=>{t(e.jsx(P,{file:s}),e.jsx(p.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(we,{initialTabId:n,autoinstallFile:s})}))}},R=t=>{const{notify:s}=C(),{closeSidePanel:n,setSidePanelContent:a}=x(),{updateAutoinstallFile:i}=O(),l=B();return{openAutoinstallFileDetails:r=>{l(t,r)},openAutoinstallFileEditForm:()=>{a(e.jsx(P,{file:t,title:"Edit"}),e.jsx(p.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(Fe,{autoinstallFile:t})}))},setAutoinstallFileAsDefault:async()=>{await i({id:t.id,is_default:!0}),n(),s.success({message:"Employee accounts without a specific autoinstall file assigned via the identity provider will now inherit this default file.",title:`You have successfully set ${t.filename} as the default autoinstall file`})}}},Le=({autoinstallFile:t})=>{const{value:s,setTrue:n,setFalse:a}=E(),{openAutoinstallFileDetails:i,openAutoinstallFileEditForm:l,setAutoinstallFileAsDefault:r}=R(t),u=()=>{i()},m=[{icon:"show",label:"View details","aria-label":`View ${t.filename} details`,onClick:u},{icon:"edit",label:"Edit","aria-label":`Edit ${t.filename}`,onClick:l},{icon:"starred",label:"Set as default","aria-label":`Set ${t.filename} as default`,onClick:r,disabled:t.is_default}],j=[{icon:"delete",label:"Remove","aria-label":`Remove ${t.filename}`,onClick:n,disabled:t.is_default}];return e.jsxs(e.Fragment,{children:[e.jsx(K,{toggleAriaLabel:`${t.filename} actions`,actions:m,destructiveActions:j}),s&&e.jsx(V,{autoinstallFile:t,close:a})]})},Ee="_container_56wd4_1",De="_header_56wd4_6",L={container:Ee,header:De},Pe=({column:t})=>{{const s={};switch(t.id){case"filename":s.role="rowheader";break;case"last_modified_at":s["aria-label"]="last modified at";break}return s}},ke=()=>({}),U=({autoinstallFiles:t})=>{const s=B(),n=p.useMemo(()=>[{...W,accessor:"filename",Header:e.jsxs("div",{className:L.header,children:["Name",e.jsx("span",{className:"u-text--muted",children:"Version"})]}),Cell:({row:{original:a}})=>e.jsxs(X,{children:[e.jsxs("div",{className:L.container,children:[e.jsx(o.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top u-align-text--left",onClick:()=>{s(a)},children:a.filename}),a.is_default&&e.jsx(de,{value:"Default"})]}),e.jsxs("span",{className:"u-text--muted",children:["Version ",a.version]})]})},{accessor:"last_modified_at",Header:"Last edited",Cell:({row:{original:{last_modified_at:a}}})=>e.jsx("div",{className:"font-monospace",children:g(a).format(y)})},{...J,Cell:({row:{original:a}})=>e.jsx(Le,{autoinstallFile:a})}],[]);return e.jsx(Z,{columns:n,data:t,emptyMsg:"No autoinstall files found according to your search parameters.",getCellProps:Pe,getRowProps:ke})},Oe=Object.freeze(Object.defineProperty({__proto__:null,AutoinstallFileForm:$,AutoinstallFilesHeader:M,AutoinstallFilesList:U,getAutoinstallFileOptions:le,useAddAutoinstallFile:k,useGetAutoinstallFiles:D},Symbol.toStringTag,{value:"Module"})),$e={message:"is now available and can be assigned to identity provider user groups.",title:"You have successfully added"},Me=p.lazy(async()=>ae(()=>Promise.resolve().then(()=>Oe),void 0).then(t=>({default:t.AutoinstallFileForm}))),Ke=()=>{const{currentPage:t,pageSize:s,search:n}=ee(),{setSidePanelContent:a}=x(),{addAutoinstallFile:i}=k(),{autoinstallFiles:l,autoinstallFilesCount:r,isAutoinstallFilesLoading:u}=D({limit:s,offset:(t-1)*s,with_groups:!0,search:n}),m=()=>{a("Add new autoinstall file",e.jsxs(p.Suspense,{fallback:e.jsx(A,{}),children:[e.jsx(Me,{buttonText:"Add",description:"Add autoinstall file. It can be applied during the initial setup of associated instances.",notification:$e,onSubmit:i}),","]}))};return!l.length&&!n&&!u?e.jsx(te,{icon:"file",title:"No autoinstall files found",body:e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any autoinstall files yet."}),cta:[e.jsx(o.Button,{appearance:"positive",onClick:m,className:"u-no-margin--right",children:"Add autoinstall file"},"add-autoinstall-file")]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{openAddForm:m}),u?e.jsx(A,{}):e.jsx(U,{autoinstallFiles:l}),e.jsx(se,{currentItemCount:l.length,totalItems:r})]})};export{Ke as default};
