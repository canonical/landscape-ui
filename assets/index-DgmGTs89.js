import{d as A,i as R,k as S,y as I,z as w,C as k,F as x,q as B,G as C,p as j,s as E,H as F,t as T,j as e,e as s}from"./index-D0eLLMjG.js";import{u as U}from"./index-BXr5gxj1.js";import{U as D}from"./constants-Dwl1JGyb.js";import{D as L}from"./DeliveryBlock-M4D4XzXl.js";import{R as P}from"./RandomizationBlock-Zv04cjec.js";import"./PageMain-CkxG3P6U.js";import"./useGetInstance-COqCPOZA.js";import"./useUsns-DB1dB2EQ.js";import"./constants-D7yXN3Pr.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./RadioGroup-D1ClNkCN.js";const V=()=>{const r=A(),n=R(),{isPending:o,mutateAsync:d}=S({mutationFn:async({id:c,...i})=>r.post(`computers/${c}/restart`,i),onSuccess:async()=>n.invalidateQueries({queryKey:["instances"]})});return{restartInstance:d,isRestartingInstance:o}},N=I().shape({...x,...k,upgrade_and_restart:w()}),q={deliver_immediately:!0,randomize_delivery:!1,deliver_delay_window:0,deliver_after:"",upgrade_and_restart:!1},M="To save patches, upgrade your kernel and then Restart. If you Restart without upgrading, you will lose patches until Livepatch automatically applies them again.",Z=({showNotification:r,instanceName:n,newKernelVersionId:o})=>{const d=B(),{instanceId:c}=C(),{closeSidePanel:i}=j(),{notify:u}=E(),{upgradeKernelQuery:y}=U(),{openActivityDetails:m}=F(),{restartInstance:h,isRestartingInstance:p}=V(),{mutateAsync:f,isPending:g}=y,_=async()=>{const{data:t}=await f({id:Number(c),kernel_package_id:Number(o),reboot_after:!0});i(),u.success({title:`You queued kernel upgrade for "${n}"`,message:D,actions:[{label:"View details",onClick:()=>{m(t)}}]})},b=async t=>{const{data:l}=await h({id:Number(c),deliver_after:t.deliver_after,deliver_delay_window:t.deliver_delay_window});i(),u.success({title:`You queued "${n}" to be restarted.`,message:`Instance "${n}" will be restarted and is queued in Activities`,actions:[{label:"View details",onClick:()=>{m(l)}}]})},a=T({initialValues:q,validationSchema:N,onSubmit:async t=>{try{t.upgrade_and_restart?await _():await b(t)}catch(l){d(l)}}}),v=async()=>{await a.setFieldValue("upgrade_and_restart",!0),a.handleSubmit()};return e.jsxs(s.Form,{onSubmit:a.handleSubmit,noValidate:!0,children:[r&&e.jsx(s.Notification,{title:"Restart recommended",severity:"caution",children:M}),e.jsx(L,{formik:a}),e.jsx(P,{formik:a}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(s.Button,{type:"button",appearance:"base",onClick:i,children:"Cancel"}),r&&o&&e.jsx(s.ConfirmationButton,{type:"button",confirmationModalProps:{title:"Upgrading kernel and restarting instance",children:e.jsx("p",{children:"Are you sure? This action will upgrade the kernel and restart the instance."}),confirmButtonLabel:"Upgrade and Restart",confirmButtonAppearance:"negative",confirmButtonLoading:g,confirmButtonDisabled:g,onConfirm:v},children:"Upgrade and Restart"}),e.jsx(s.ConfirmationButton,{type:"button",appearance:"negative",confirmationModalProps:{title:"Restarting instance",children:e.jsx("p",{children:"Are you sure? This action will restart the instance."}),confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonLoading:p,confirmButtonDisabled:p,onConfirm:()=>{a.handleSubmit()}},children:"Restart"})]})]})};export{Z as default};
