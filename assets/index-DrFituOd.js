import{p as M,q as Y,n as q,a6 as E,j as t,v as A,d as i,I as o,a7 as U,a8 as b,A as p,D as v}from"./index-CAxb-9CO.js";import{u as $}from"./useGetInstance-CjbtfCLR.js";const F="_statusIcon_1efxa_1",k="_output_1efxa_5",g={statusIcon:F,output:k},V=({activityId:x})=>{const c=M(),{notify:r}=Y(),{closeSidePanel:l}=q(),{approveActivitiesQuery:j,cancelActivitiesQuery:_,getSingleActivityQuery:C,redoActivitiesQuery:B,undoActivitiesQuery:L}=E(),{mutateAsync:I,isPending:d}=j,{mutateAsync:w,isPending:u}=_,{mutateAsync:S,isPending:m}=B,{mutateAsync:D,isPending:y}=L,{data:P,isLoading:h}=C({activityId:x}),e=P?.data,f=e?.computer_id!==void 0,{instance:a,isGettingInstance:N}=$({instanceId:e?.computer_id},{enabled:f});if(f&&N)return t.jsx(A,{});const T=async n=>{try{await I({query:`id:${n.id}`}),l(),r.success({title:"You have successfully approved an activity.",message:"This activity will be delivered the next time the Landscape server connects with the client."})}catch(s){c(s)}},R=async n=>{try{await w({query:`id:${n.id}`}),l(),r.success({title:"You have successfully canceled an activity.",message:"This activity won't be delivered to the client and will not run."})}catch(s){c(s)}},z=async n=>{try{await S({activity_ids:[n.id]}),l(),r.success({title:"You have successfully redone an activity.",message:"An activity has been queued to re-run this activity."})}catch(s){c(s)}},Q=async n=>{try{await D({activity_ids:[n.id]}),l(),r.success({title:"You have successfully undone an activity.",message:"An activity has been queued to revert the changes delivered by this activity."})}catch(s){c(s)}};return t.jsxs(t.Fragment,{children:[h&&t.jsx(A,{}),!h&&e&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[e.actions?.approvable&&t.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:d,confirmationModalProps:{title:"Approve activity",children:t.jsxs("p",{children:["Are you sure you want to approve ",e.summary," ","activity?"]}),confirmButtonLabel:"Approve",confirmButtonAppearance:"positive",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:async()=>T(e)},children:"Approve"}),e.actions?.cancelable&&t.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:u,confirmationModalProps:{title:"Cancel activity",children:t.jsxs("p",{children:["Are you sure you want to cancel ",e.summary," ","activity?"]}),confirmButtonLabel:"Apply",confirmButtonAppearance:"positive",confirmButtonDisabled:u,confirmButtonLoading:u,onConfirm:async()=>R(e)},children:!e.actions?.approvable&&!e.actions?.reappliable&&!e.actions?.revertable?"Cancel activity":"Cancel"}),e.actions?.revertable&&t.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:y,confirmationModalProps:{title:"Undo activity",children:t.jsxs("p",{children:["Are you sure you want to undo ",e.summary," ","activity?"]}),confirmButtonLabel:"Undo",confirmButtonAppearance:"positive",confirmButtonDisabled:y,confirmButtonLoading:y,onConfirm:async()=>Q(e)},children:"Undo"}),e.actions?.reappliable&&t.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:m,confirmationModalProps:{title:"Redo activity",children:t.jsxs("p",{children:["Are you sure you want to redo ",e.summary," ","activity?"]}),confirmButtonLabel:"Redo",confirmButtonAppearance:"positive",confirmButtonDisabled:m,confirmButtonLoading:m,onConfirm:async()=>z(e)},children:"Redo"})]})},"buttons"),t.jsxs(i.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(i.Col,{size:12,children:t.jsx(o,{label:"Description",value:e.summary})}),a&&t.jsx(i.Col,{size:12,children:t.jsx(o,{label:"Instance",value:t.jsx(U,{to:`/instances/${a.parent?`${a.parent.id}/${a.id}`:a.id}`,children:a.title})})}),t.jsx(i.Col,{size:6,children:t.jsx(o,{label:"Status",value:t.jsxs(t.Fragment,{children:[t.jsx(i.Icon,{name:b[e.activity_status].icon,className:g.statusIcon}),t.jsx("span",{children:b[e.activity_status].label})]})})}),t.jsx(i.Col,{size:6,children:t.jsx(o,{label:"Created at",value:p(e.creation_time).format(v)})}),typeof e.delivery_time=="string"&&t.jsx(i.Col,{size:6,children:t.jsx(o,{label:"Delivered at",value:p(e.delivery_time).format(v)})}),e.completion_time&&t.jsx(i.Col,{size:6,children:t.jsx(o,{label:"Completed at",value:p(e.completion_time).format(v)})}),e.result_text&&t.jsx(i.Col,{size:12,children:t.jsx(i.CodeSnippet,{className:g.output,blocks:[{title:"Output",code:e.result_text}]})})]})]})]})};export{V as default};
