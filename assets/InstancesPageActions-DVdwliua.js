const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CeMdwE1w.js","assets/index-CXNm0bld.js","assets/index-zKdb8HNb.css","assets/useInstances-Hh-vze1_.js","assets/useRoles-CfHGITs1.js","assets/index-CfXqLKNo.css","assets/index-C5FDQaEX.js","assets/ScriptsTabs-CavO-EiT.js","assets/HeaderWithSearch-BngRzBTL.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-BKX7OTKC.js","assets/useExpandableRow-DgvgvamA.js","assets/ScriptsTabs-DN44MVZt.css","assets/SidePanelFormButtons-ByCHTjrf.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/DeliveryBlock-CmC0EPyw.js","assets/DeliveryBlock-VExRkUer.css","assets/ScriptDropdown-DXtDcfqQ.js","assets/downshift.esm-CCyN-rn8.js","assets/ScriptDropdown-B5XgtP-0.css","assets/index-iVWmIwU4.js","assets/CodeEditor-DpwNwNxE.js","assets/CodeEditor-CwlLRp3p.css","assets/ScriptFormAttachments-Bun8cXKX.js","assets/AttachmentFile-CLKhUdP4.js","assets/AttachmentFile-Br6SRBhg.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-BfOTFgFX.js","assets/ResponsiveButtons-D8N5ZFCe.js","assets/ResponsiveButtons-C56n2q_V.css","assets/useUsns-CfKD-Teg.js","assets/useUsns-DQKyxlHf.css","assets/index-BYPXWBfP.js","assets/index-CK6sL0Ld.css","assets/index-uiQJLZSe.js","assets/index-qDPvkCs2.js","assets/useTaggedSecurityProfiles-GYrprjpz.js"])))=>i.map(i=>d[i]);
import{j as e,n as c,N as m,r as u,c as z,o as Q,L as Y,w as x,D as U,k as I,x as _,p as f,a0 as h,A as W,B as J,a1 as K,aA as X}from"./index-CXNm0bld.js";import{d as Z,h as G,a as ee,R as te,c as j,b as ae}from"./ResponsiveButtons-D8N5ZFCe.js";import{u as N}from"./useInstances-Hh-vze1_.js";const ne="_rowHeader_spblf_5",re="_nested_spblf_8",le="_statusListItem_spblf_20",oe="_statusContainer_spblf_24",C={rowHeader:ne,nested:re,statusListItem:le,statusContainer:oe},se=r=>r.map(({accessor:a,canBeHidden:t,optionLabel:i})=>({canBeHidden:t,label:i,value:a})),R=({groupBy:r,instance:a,selectedInstances:t})=>{const i=t.map(({id:s})=>s);return r==="parent"&&!a.is_wsl_instance&&a.children.length>0?a.children.every(({id:s})=>i.includes(s))?"checked":a.children.some(({id:s})=>i.includes(s))?"indeterminate":"unchecked":i.includes(a.id)?"checked":"unchecked"},ie=({groupBy:r,instance:a,selectedInstances:t,setSelectedInstances:i})=>{if(r==="parent"&&a.children.length>0){const s=a.children.map(({id:p})=>p);t.some(({id:p})=>s.includes(p))?i(t.filter(({id:p})=>!s.includes(p))):i([...t,...a.children.map(p=>({...p,parent:a,children:[]}))])}else t.some(({id:s})=>s===a.id)?i(t.filter(({id:s})=>s!==a.id)):i([...t,a])},O=r=>{if(r.archived)return{icon:"archive",label:"Archived"};const a=((r==null?void 0:r.alerts)??[]).filter(({type:t})=>!["PackageUpgradesAlert","SecurityUpgradesAlert"].includes(t));return a.length===0?{icon:`${d.Online.icon.color}`,label:d.Online.alternateLabel??d.Online.label}:a.length===1?{icon:`${d[a[0].type].icon.color??d.Unknown.icon.color}`,label:e.jsx(e.Fragment,{children:a[0].summary})}:{label:e.jsx("span",{className:C.statusContainer,children:a.map(({type:t,summary:i})=>{var s;return e.jsx("span",{className:C.statusListItem,children:e.jsx(c.Tooltip,{message:i,children:e.jsx(c.Icon,{className:"u-no-margin--left",name:`${((s=d[t])==null?void 0:s.icon.color)??d.Unknown.icon.color}`})})},t)})})}},ce=r=>({regular:ee(r)?{icon:d.PackageUpgradesAlert.icon.color??"",label:d.PackageUpgradesAlert.label}:!1,security:G(r)?{icon:d.SecurityUpgradesAlert.icon.color??"",label:d.SecurityUpgradesAlert.label}:!1}),D=r=>{if(!Z("ubuntu",r))return{icon:"",label:e.jsx(m,{})};const{regular:a,security:t}=ce(r.alerts);return a&&t?{icon:t.icon,label:`${a.label}, ${t.label.toLowerCase()}`}:a?{icon:a.icon,label:a.label}:t?{icon:t.icon,label:t.label}:{icon:d.UpToDate.icon.color,label:d.UpToDate.label}},ue=({id:r})=>{const a={};return r==="title"&&(a["aria-labelledby"]="column-1-label"),a},_e=u.memo(function({instances:a,selectedInstances:t,setColumnFilterOptions:i,setSelectedInstances:s}){const{disabledColumns:p,groupBy:g,...v}=z(),y=Object.values(v).some(n=>{if(typeof n=="string")return n.length>0;if(Array.isArray(n))return n.length>0}),k=()=>{s(t.length!==0?[]:a)},A=u.useMemo(()=>g==="parent"?a.map(n=>({...n,subRows:n.children.map(l=>({...l,parent:n,children:[]}))})):a,[a,g]),b=u.useMemo(()=>[{accessor:"title",canBeHidden:!1,optionLabel:"Instance name",Header:e.jsxs(e.Fragment,{children:[e.jsx(c.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,onChange:k,disabled:a.length===0,checked:t.length===a.length&&a.length!==0,indeterminate:t.length!==0&&t.length<a.length}),e.jsx("span",{id:"column-1-label",children:"Name"})]}),Cell:({row:n})=>e.jsxs("div",{className:Q(C.rowHeader,{[C.nested]:n.depth>0}),children:[e.jsx(c.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:n.original.title}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:R({groupBy:g,instance:n.original,selectedInstances:t})==="checked",indeterminate:R({groupBy:g,instance:n.original,selectedInstances:t})==="indeterminate",onChange:()=>{ie({groupBy:g,instance:n.original,selectedInstances:t,setSelectedInstances:s})}}),e.jsx(Y,{to:n.original.parent?`/instances/${n.original.parent.id}/${n.original.id}`:`/instances/${n.original.id}`,children:n.original.title})]})},{accessor:"status",canBeHidden:!0,optionLabel:"Status",Header:"Status",Cell:({row:{original:n}})=>{const{label:l}=O(n);return l},getCellIcon:({row:{original:n}})=>{const{icon:l}=O(n);return l}},{accessor:"upgrades",canBeHidden:!0,optionLabel:"Upgrades",Header:"Upgrades",Cell:({row:{original:n}})=>{const{label:l}=D(n);return l},getCellIcon:({row:{original:n}})=>{const{icon:l}=D(n);return l}},{accessor:"os",canBeHidden:!0,optionLabel:"OS",Header:"OS",Cell:({row:{original:n}})=>{var l;return e.jsx(e.Fragment,{children:((l=n.distribution_info)==null?void 0:l.description)??e.jsx(m,{})})}},{accessor:"availability_zone",canBeHidden:!0,optionLabel:"Availability zone",Header:"Availability zone",Cell:({row:{original:n}})=>{var l;return e.jsx(e.Fragment,{children:((l=n.cloud_init)==null?void 0:l.availability_zone)??e.jsx(m,{})})}},{accessor:"ubuntu_pro",canBeHidden:!0,optionLabel:"Ubuntu pro",Header:"Ubuntu pro expiration",Cell:({row:n})=>{var l;return((l=n.original.ubuntu_pro_info)==null?void 0:l.result)==="success"&&x(n.original.ubuntu_pro_info.expires).isValid()?e.jsx("span",{className:"font-monospace",children:x(n.original.ubuntu_pro_info.expires).format(U)}):e.jsx(m,{})}},{accessor:"last_ping",canBeHidden:!0,optionLabel:"Last ping",Header:"Last ping time",Cell:({row:n})=>e.jsx(e.Fragment,{children:x(n.original.last_ping_time).isValid()?e.jsx("span",{className:"font-monospace",children:x(n.original.last_ping_time).format(U)}):e.jsx(m,{})})}],[t.length,a,g]);u.useEffect(()=>{i(se(b))},[]);const P=u.useMemo(()=>b.filter(({accessor:n})=>typeof n=="string"&&!p.includes(n)),[p.length,b]);return e.jsx(c.ModularTable,{emptyMsg:y?"No instances found according to your search parameters.":"No instances found",columns:P,data:A,getHeaderProps:ue})}),d={Online:{alertType:"ComputerOnlineAlert",label:"Computers online",alternateLabel:"Online",filterValue:"computer-online",query:"NOT alert:computer-offline",icon:{gray:"connected",color:"connected-color"}},ComputerDuplicateAlert:{alertType:"ComputerDuplicateAlert",label:"Computer duplicates",alternateLabel:"Duplicate",filterValue:"computer-duplicates",query:"alert:computer-duplicates",icon:{gray:"canvas",color:"canvas-color"}},ComputerOfflineAlert:{alertType:"ComputerOfflineAlert",label:"Computers offline",alternateLabel:"Offline",filterValue:"computer-offline",query:"alert:computer-offline",icon:{gray:"disconnect",color:"disconnect-color"}},ComputerRebootAlert:{alertType:"ComputerRebootAlert",label:"Computer reboot",alternateLabel:"Reboot required",filterValue:"computer-reboot",query:"alert:computer-reboot",icon:{gray:"power-off",color:"power-off-color"}},EsmDisabledAlert:{alertType:"EsmDisabledAlert",label:"ESM disabled",alternateLabel:"ESM updates are disabled",filterValue:"esm-disabled",query:"alert:esm-disabled",icon:{gray:"computer-esm-disabled-alert",color:"computer-esm-disabled-alert-color"}},PackageProfilesAlert:{alertType:"PackageProfilesAlert",label:"Package profiles",filterValue:"package-profiles",query:"alert:package-profiles",icon:{color:"package-profiles-alert"}},PackageReporterAlert:{alertType:"PackageReporterAlert",label:"Package reporter",filterValue:"package-reporter",query:"alert:package-reporter",icon:{color:"package-reporter-alert"}},PackageUpgradesAlert:{alertType:"PackageUpgradesAlert",label:"Package upgrades",alternateLabel:"Regular",filterValue:"package-upgrades",query:"alert:package-upgrades",icon:{color:"regular-upgrades"}},SecurityUpgradesAlert:{alertType:"SecurityUpgradesAlert",label:"Security upgrades",alternateLabel:"Security",filterValue:"security-upgrades",query:"alert:security-upgrades",icon:{color:"security-upgrades"}},UnapprovedActivitiesAlert:{alertType:"UnapprovedActivitiesAlert",label:"Unapproved activities",filterValue:"unapproved-activities",query:"alert:unapproved-activities",icon:{gray:"status-queued"}},UpToDate:{alertType:"UpToDate",label:"Up to date",alternateLabel:"Up to date",filterValue:"up-to-date",query:"NOT alert:package-upgrades",icon:{color:"up-to-date"}},PendingComputersAlert:{alertType:"PendingComputersAlert",label:"Pending",alternateLabel:"Pending",filterValue:"",query:"",icon:{gray:"pause",color:"pause-color"}},ChildInstanceProfileAlert:{alertType:"ChildInstanceProfileAlert",label:"Child instance profiles",alternateLabel:"Child instance profiles",filterValue:"child-instance-profiles",query:"alert:child-instance-profiles",icon:{gray:"machines"}},Unknown:{alertType:"",label:"-",alternateLabel:"-",filterValue:"",query:"",icon:{color:"package-profiles-alert"}}},S=["UpToDate","PackageUpgradesAlert","SecurityUpgradesAlert","PackageProfilesAlert","PackageReporterAlert","EsmDisabledAlert","ComputerOfflineAlert","ComputerOnlineAlert","ComputerRebootAlert","ComputerDuplicateAlert","UnapprovedActivitiesAlert","ChildInstanceProfileAlert"],de={label:"Archived",value:"archived"},Ce={os:{type:"select",options:[{label:"All",value:"",query:""},{label:"Ubuntu",value:"ubuntu",query:"NOT distribution:windows"},{label:"Windows",value:"windows",query:"distribution:windows"}]},groupBy:{options:[{label:"None",value:""},{label:"Parent",value:"parent"}]},status:{type:"select",options:[{label:"All",value:"",query:""},...Object.values(d).filter(({alertType:r})=>S.includes(r)).sort((r,a)=>S.indexOf(r.alertType)-S.indexOf(a.alertType)).map(({label:r,filterValue:a,query:t})=>({label:r,value:a,query:t})),de]}},pe=u.lazy(async()=>h(()=>import("./index-CeMdwE1w.js"),__vite__mapDeps([0,1,2,3,4,5]))),ve=()=>{const{setSidePanelContent:r}=I(),{getPendingInstancesQuery:a}=N(),{data:t}=a();if(!t||!t.data.length)return null;const i=()=>{r("Review Pending Instances",e.jsx(u.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(pe,{instances:t.data})}),"large")};return e.jsxs(c.Notification,{severity:"information",title:"Pending instances",children:[e.jsx("span",{children:`You currently have ${t.data.length} pending
          	${_(t.data.length,"instance")}
          	awaiting your review and approval. `}),e.jsx(c.Button,{type:"button",appearance:"link",onClick:i,children:"Review Pending Instances"})]})},E=({action:r,onDetailsClick:a,selected:t})=>({title:`Selected ${t.length>1?"instances have":"instance has"} been queued for ${r}.`,message:`${t.length>1?`${t.length} instances have`:`"${t[0].title}" instance has`} been queued in Activities for ${r}.`,actions:[{label:"View details",onClick:a}]}),ge="_warning_16r8d_1",he={warning:ge},be=u.lazy(async()=>h(()=>import("./index-C5FDQaEX.js"),__vite__mapDeps([6,7,1,2,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29])).then(r=>({default:r.RunInstanceScriptForm}))),me=u.lazy(async()=>h(()=>import("./index-BfOTFgFX.js"),__vite__mapDeps([30,1,2,15,16,17,31,32,33,34,3])).then(r=>({default:r.Upgrades})));u.lazy(async()=>h(()=>import("./index-BYPXWBfP.js"),__vite__mapDeps([35,1,2,15,16,17,36])));const fe=u.lazy(async()=>h(()=>import("./index-uiQJLZSe.js"),__vite__mapDeps([37,1,2,15,16,17,4]))),ye=u.lazy(async()=>h(()=>import("./index-qDPvkCs2.js"),__vite__mapDeps([38,1,2,15,16,17,3,39,31,32]))),ke=u.memo(function({isGettingInstances:a,selectedInstances:t}){const i=W(),{notify:s}=J(),{openActivityDetails:p}=K(),{setSidePanelContent:g}=I(),[v,y]=u.useState(!1),[k,A]=u.useState(!1),{rebootInstancesQuery:b,shutdownInstancesQuery:P}=N(),{mutateAsync:n,isPending:l}=b,{mutateAsync:B,isPending:L}=P,w=o=>e.jsxs(e.Fragment,{children:[e.jsx("b",{children:o.length})," ",_(o.length,"instance")]}),V=async()=>{g("Run script",e.jsxs(u.Suspense,{fallback:e.jsx(f,{}),children:[t.some(o=>!j("runScripts",o))?e.jsxs("div",{className:he.warning,children:[e.jsxs("p",{children:["You selected ",t.length," instances. This script will:"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:["run on"," ",w(t.filter(o=>j("runScripts",o)))]}),e.jsxs("li",{children:["not run on"," ",w(t.filter(o=>!j("runScripts",o)))]})]})]}):null,e.jsx(be,{query:t.map(({id:o})=>`id:${o}`).join(" OR ")})]}))},q=async()=>{try{const{data:o}=await B({computer_ids:t.map(({id:T})=>T)});s.success(E({action:"shutdown",onDetailsClick:()=>{p(o)},selected:t}))}catch(o){i(o)}},H=async()=>{try{const{data:o}=await n({computer_ids:t.map(({id:T})=>T)});s.success(E({action:"reboot",onDetailsClick:()=>{p(o)},selected:t}))}catch(o){i(o)}},F=()=>{g("Upgrades",e.jsx(u.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(me,{selectedInstances:t})}),"large")},$=()=>{g("Assign access group",e.jsx(u.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(fe,{selected:t})}))},M=()=>{g("Assign tags",e.jsx(u.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(ye,{selected:t})}))};return e.jsxs(e.Fragment,{children:[e.jsx(te,{collapseFrom:"xl",buttons:[e.jsxs(c.Button,{className:"has-icon",type:"button",disabled:L||t.length===0||a,onClick:()=>{A(!0)},children:[e.jsx(c.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]},"shutdown-instances"),e.jsxs(c.Button,{hasIcon:!0,type:"button",disabled:l||t.length===0||a,onClick:()=>{y(!0)},children:[e.jsx(c.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]},"reboot-instances"),X,e.jsxs(c.Button,{type:"button",hasIcon:!0,onClick:V,disabled:t.every(o=>!j("runScripts",o))||a,children:[e.jsx(c.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]},"run-script"),e.jsxs(c.Button,{type:"button",hasIcon:!0,onClick:F,disabled:t.every(o=>!ae(o.alerts))||a,children:[e.jsx(c.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]},"upgrade-instances")]}),e.jsx(c.ContextualMenu,{hasToggleIcon:!0,links:[{children:"Access group",onClick:$},{children:"Tags",onClick:M}],position:"right",toggleLabel:e.jsxs(e.Fragment,{children:[e.jsx(c.Icon,{name:"plus"}),e.jsx("span",{children:"Assign"})]}),toggleClassName:"u-no-margin--bottom",toggleDisabled:t.length===0,dropdownProps:{style:{zIndex:10}}}),v&&e.jsx(c.ConfirmationModal,{close:()=>{y(!1)},title:"Restarting selected instances",confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonLoading:l,confirmButtonDisabled:l,onConfirm:H,children:e.jsxs("p",{children:["Are you sure you want to restart ",t.length,_(t.length,"instance"),"?"]})}),k&&e.jsx(c.ConfirmationModal,{close:()=>{A(!1)},title:"Shutting down selected instances",confirmButtonLabel:"Shutdown",confirmButtonAppearance:"negative",confirmButtonLoading:L,confirmButtonDisabled:L,onConfirm:q,children:e.jsxs("p",{children:["Are you sure you want to shutdown ",t.length,_(t.length,"instance"),"?"]})})]})});export{Ce as F,_e as I,ve as P,d as S,ke as a,O as g};
