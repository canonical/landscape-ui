import{r as p,j as n,e as i}from"./index-8m1ayHDq.js";import{C}from"./CellInput-CYOZzbI-.js";import{c as l,T as h,C as g,a as N,E as w}from"./index-CIts1nhm.js";const b=async(s,e,t,o)=>{await s.setFieldValue(`constraints[${e}]${[t]}`,o),await s.setFieldTouched(`constraints[${e}]${[t]}`,!0),["rule","version"].includes(t)&&(o!==""?await s.setFieldValue(`constraints[${e}].notAnyVersion`,!0):s.values.constraints[e][t==="rule"?"version":"rule"]===""&&await s.setFieldValue(`constraints[${e}].notAnyVersion`,!1))},v=(s,e,t)=>{var c,u,d;if(!((c=s.errors.constraints)!=null&&c[e])||!((d=(u=s.touched.constraints)==null?void 0:u[e])!=null&&d[t]))return;const o=s.errors.constraints[e];return typeof o!="string"?o[t]:void 0},P=async(s,e)=>{await s.setFieldValue("constraints",s.values.constraints.filter((t,o)=>o!==e)),s.touched.constraints&&(s.touched.constraints.splice(e,1),await s.setTouched({...s.touched,constraints:s.touched.constraints}))},j=s=>({handleConstraintPropChange:async(e,t,o)=>{await b(s,e,t,o)},handleConstraintRowDelete:async e=>{await P(s,e)},getConstraintsErrorByIndex:(e,t)=>v(s,e,t)}),T=({column:s})=>{const e={};return e.className=l.cell,s.id==="package_name"?e.role="rowheader":s.id==="action"?e["aria-label"]="Action":s.id==="constraint"?e["aria-label"]="Constraint":s.id==="version"?e["aria-label"]="Version":s.id==="rule"&&(e["aria-label"]="Rule"),e},R=({formik:s})=>{p.useEffect(()=>{s.submitCount!==0&&(async()=>await s.setTouched({...s.touched,constraints:new Array(s.values.constraints.length).fill(h)}))()},[s.submitCount]);const e=p.useMemo(()=>s.values.constraints,[s.values.constraints]),{handleConstraintPropChange:t,handleConstraintRowDelete:o,getConstraintsErrorByIndex:c}=j(s),u=p.useMemo(()=>[{accessor:"constraint",Header:"Constraint",Cell:({row:{index:a}})=>n.jsx(i.Select,{label:"Constraint",labelClassName:"u-off-screen",className:l.input,wrapperClassName:l.inputWrapper,options:g,...s.getFieldProps(`constraints[${a}].constraint`),onChange:r=>t(a,"constraint",r.target.value),error:c(a,"constraint")})},{accessor:"package",Header:"Package",Cell:({row:{index:a}})=>n.jsx(C,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:l.input,wrapperClassName:l.inputWrapper,...s.getFieldProps(`constraints[${a}].package`),onChange:r=>t(a,"package",r),error:c(a,"package")})},{accessor:"rule",Header:"Rule",Cell:({row:{index:a}})=>n.jsx(i.Select,{label:"Rule",labelClassName:"u-off-screen",className:l.input,wrapperClassName:l.inputWrapper,...s.getFieldProps(`constraints[${a}].rule`),options:N,onChange:r=>t(a,"rule",r.target.value),error:c(a,"rule")})},{accessor:"version",Header:"Version",Cell:({row:{index:a}})=>n.jsx(C,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:l.input,wrapperClassName:l.inputWrapper,...s.getFieldProps(`constraints[${a}].version`),onChange:r=>t(a,"version",r),error:c(a,"version")})},{accessor:"action",className:l.action,Cell:({row:a})=>n.jsx(i.Button,{type:"button",hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding","aria-label":"Delete constraint row",onClick:()=>o(a.index),children:n.jsx(i.Icon,{name:"delete",className:"u-no-margin--left u-no-margin--right"})})}],[e,s.errors.constraints,s.touched.constraints]),d=async()=>{if(await s.setFieldValue("constraints",[w,...s.values.constraints]),s.touched.constraints){const a=[];for(let r=s.values.constraints.length;r>0;r--)s.touched.constraints[r-1]&&(a[r]=s.touched.constraints[r-1]);await s.setTouched({constraints:a})}};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"u-align-text--right",children:n.jsxs(i.Button,{type:"button",hasIcon:!0,onClick:d,children:[n.jsx(i.Icon,{name:"plus",className:"u-no-margin--left"}),n.jsx("span",{children:"Add new constraint"})]})}),n.jsx(i.ModularTable,{columns:u,data:e,getCellProps:T,emptyMsg:"No constraints added yet.",className:"u-no-margin--bottom"}),s.touched.constraints&&typeof s.errors.constraints=="string"&&n.jsx("div",{className:"is-error",children:n.jsxs("p",{className:"p-form-validation__message u-no-margin--top",children:[n.jsx("strong",{children:"Error: "}),n.jsx("span",{children:s.errors.constraints})]})})]})};export{R as P};
