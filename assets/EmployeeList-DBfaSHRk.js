const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dzdv1qjW.js","assets/index-TxmzAx1n.js","assets/index-BRwMPVz9.css","assets/helpers-Bqn2jtb9.js","assets/helpers-DBR6uSgW.js","assets/InstancesPageActions-CxuB12ie.js","assets/useInstances-lQt7962R.js","assets/InstancesPageActions-CswnIe9I.css","assets/helpers-1SmgROkh.css","assets/TruncatedCell-DeREExeb.js","assets/TruncatedCell-CoXbu3VM.css","assets/index-Cacomp35.css"])))=>i.map(i=>d[i]);
import{i as v,f as _,g as w,h as z,z as T,j as t,m as c,J as I,r as d,l as E,o as L,_ as F,ao as P,L as x,N as y}from"./index-TxmzAx1n.js";import{T as b}from"./TruncatedCell-DeREExeb.js";const C=()=>{const e=v(),s=_(),{mutateAsync:n,isPending:i}=w({mutationKey:["employee","patch"],mutationFn:async({id:r,...a})=>e.patch(`employees/${r}`,a),onSuccess:async()=>s.invalidateQueries({queryKey:["employee"]})});return{patchEmployee:n,isPending:i}},ce=(e={},s={})=>{var u,p;const n=v(),{data:i,isPending:r,isFetching:a}=z({queryKey:["employees",e],queryFn:async()=>n.get("employees",{params:e}),...s});return{employees:((u=i==null?void 0:i.data)==null?void 0:u.results)||[],isPending:r,isFetching:a,count:(p=i==null?void 0:i.data)==null?void 0:p.count}},A=()=>{const e=v(),s=_(),{mutateAsync:n,isPending:i}=w({mutationKey:["employee","patch"],mutationFn:async({id:r,...a})=>e.post(`employees/${r}/offboard`,a),onSuccess:async()=>s.invalidateQueries({queryKey:["employee"]})});return{deactivateEmployee:n,isDeactivating:i}},D=({employee:e,handleClose:s})=>{const{notify:n}=T(),{patchEmployee:i,isPending:r}=C(),a=async()=>{await i({id:e.id,is_active:!0}),n.success({title:`You have successfully activated ${e.name}`,message:`${e.name} will be able to log in to Landscape and register new instances with their account.`}),s()};return t.jsx(c.ConfirmationModal,{confirmButtonLabel:"Activate",onConfirm:a,confirmButtonAppearance:"positive",title:`Activate ${e.name}`,close:s,confirmButtonDisabled:r,confirmButtonLoading:r,children:t.jsxs("p",{children:["This will allow ",e.name," to log in to Landscape and register new instances with their account."]})})},M="Irreversibly deletes all data on disks of associated instances. Proceed with caution",S="This will remove all instances associated with this Employee from Landscape.",$={sanitizationConfirmationText:"",sanitizeInstances:!1,removeFromLandscapeConfirmationText:"",removeFromLandscape:!1},N="_title_1azx9_1",R="_tooltipPositionElement_1azx9_5",k="_additionalActionContainer_1azx9_9",g={title:N,tooltipPositionElement:R,additionalActionContainer:k},B=(e,s)=>s.removeFromLandscape&&s.sanitizeInstances?`Off-board ${e}`:`Deactivate ${e}`,O=e=>e.removeFromLandscape&&e.sanitizeInstances?"Off-board":e.removeFromLandscape?"Deactivate and remove":e.sanitizeInstances?"Deactivate and sanitize":"Deactivate",q=e=>!!(e.sanitizeInstances&&e.sanitizationConfirmationText!=="sanitize instances"||e.removeFromLandscape&&e.removeFromLandscapeConfirmationText!=="remove instances"||e.sanitizeInstances&&e.removeFromLandscape&&e.sanitizationConfirmationText!=="sanitize instances"&&e.removeFromLandscapeConfirmationText!=="remove instances"),H=(e,s,n)=>s&&n?{notificationTitle:`You have successfully deactivated ${e} and initiated both Sanitization and Removal of their instances`,notificationMessage:"Sanitization and removal of this employee’s instances have been queued. The data will be permanently irrecoverable once complete. To manage the instances again, they will need to be re-registered in Landscape."}:s?{notificationTitle:`You have successfully deactivated ${e} and initiated sanitization of their instances`,notificationMessage:`Sanitization of the ${e}’s instances has been queued in Activities. The data will be permanently irrecoverable once complete.`}:n?{notificationTitle:`You have successfully deactivated ${e} and initiated the Removal of their instances`,notificationMessage:"The removal of this employee’s instances has been queued. This process will delete all stored data. To manage them again, they will need to be re-registered in Landscape."}:{notificationTitle:`You have successfully deactivated ${e}`,notificationMessage:"This employee won’t be able to log in to Landscape or register new instances with their account."},V=({employee:e,handleClose:s})=>{const{notify:n}=T(),{deactivateEmployee:i,isDeactivating:r}=A(),a=I({initialValues:$,enableReinitialize:!0,onSubmit:async()=>{await i({id:e.id,remove_instances:a.values.removeFromLandscape,sanitize_instances:a.values.sanitizeInstances}),a.resetForm(),s();const{notificationMessage:u,notificationTitle:p}=H(e.name,a.values.sanitizeInstances,a.values.removeFromLandscape);n.success({title:p,message:u})}});return t.jsx(c.ConfirmationModal,{title:B(e.name,a.values),confirmButtonLabel:O(a.values),confirmButtonProps:{type:"submit"},onConfirm:()=>{a.handleSubmit()},close:s,confirmButtonDisabled:q(a.values)||r,confirmButtonLoading:r,children:t.jsxs(c.Form,{noValidate:!0,onSubmit:a.handleSubmit,children:[t.jsxs("p",{children:["This will prevent ",e.name," from logging in to Landscape and from registering any new instances with their account"]}),t.jsx("b",{children:"Additional actions"}),t.jsxs("div",{children:[t.jsx(c.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:g.title,children:"Sanitize associated instances"}),t.jsxs(c.Tooltip,{position:"top-center",message:M,positionElementClassName:g.tooltipPositionElement,children:[t.jsx(c.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...a.getFieldProps("sanitizeInstances"),onChange:async u=>{a.getFieldProps("sanitizeInstances").onChange(u),await a.setFieldValue("sanitizationConfirmationText","")}}),a.values.sanitizeInstances&&t.jsxs("div",{className:g.additionalActionContainer,children:[t.jsx("p",{children:"Sanitization will permanently delete the encryption keys for associated instances, making its data completely irrecoverable. This action cannot be undone. Please confirm you wish to proceed."}),t.jsx(c.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"sanitize instances"})," to confirm"]}),"aria-label":"Sanitization confirmation text",type:"text",...a.getFieldProps("sanitizationConfirmationText")},"sanitizationConfirmationText")]}),t.jsx(c.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:g.title,children:"Remove associated instances from Landscape"}),t.jsxs(c.Tooltip,{position:"top-center",message:S,positionElementClassName:g.tooltipPositionElement,children:[t.jsx(c.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...a.getFieldProps("removeFromLandscape"),onChange:async u=>{a.getFieldProps("removeFromLandscape").onChange(u),await a.setFieldValue("removeFromLandscapeConfirmationText","")}}),a.values.removeFromLandscape&&t.jsxs("div",{className:g.additionalActionContainer,children:[t.jsx("p",{children:"This will remove all associated instances from Landscape, along with their stored data. To manage them again, you would need to re-register them in Landscape."}),t.jsx(c.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"remove instances"})," to confirm."]}),"aria-label":"Remove from Landscape confirmation text",type:"text",...a.getFieldProps("removeFromLandscapeConfirmationText")},"removeFromLandscapeConfirmationText")]})]})]})})},K=e=>e.employee.is_active?t.jsx(V,{...e}):t.jsx(D,{...e}),Y="_toggleButton_bnzrt_1",G="_menu_bnzrt_6",j={toggleButton:Y,menu:G},Q=d.lazy(async()=>F(()=>import("./index-Dzdv1qjW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),J=({employee:e})=>{const[s,n]=d.useState(!1),{setSidePanelContent:i}=E(),r=()=>{n(!0)},a=d.useCallback(()=>{n(!1)},[]),u=()=>{i("Employee details",t.jsx(d.Suspense,{fallback:t.jsx(L,{}),children:t.jsx(Q,{employee:e})}),"medium")},p=[{children:t.jsxs(t.Fragment,{children:[t.jsx(c.Icon,{name:"file"}),t.jsx("span",{children:"View details"})]}),"aria-label":`View ${e.name} employee details`,hasIcon:!0,onClick:u},{children:t.jsxs(t.Fragment,{children:[t.jsx(c.Icon,{name:e.is_active?"pause":"play"}),t.jsx("span",{children:e.is_active?"Deactivate":"Activate"})]}),"aria-label":`${e.is_active?"Deactivate":"Activate"} ${e.name}`,hasIcon:!0,onClick:r}];return t.jsxs(t.Fragment,{children:[t.jsx(c.ContextualMenu,{position:"left",className:j.menu,toggleClassName:j.toggleButton,toggleAppearance:"base",toggleLabel:t.jsx(c.Icon,{name:"contextual-menu","aria-hidden":!0}),toggleProps:{"aria-label":`${e.name} actions`},links:p}),s&&t.jsx(K,{employee:e,handleClose:a})]})},U="_expandedCell_6nnqy_1",Z="_expandedRow_6nnqy_6",W="_truncatedItem_6nnqy_11",X="_actions_6nnqy_18",ee="_autoinstallFileHeaderTitle_6nnqy_26",h={expandedCell:U,expandedRow:Z,truncatedItem:W,actions:X,autoinstallFileHeaderTitle:ee},te=e=>({index:s})=>{const n={};return((e==null?void 0:e.column)==="computers"||(e==null?void 0:e.column)==="groups")&&e.row===s&&(n.className=h.expandedRow),n},ne=e=>({column:s,row:{index:n}})=>{const i={};return s.id==="computers"?(i["aria-label"]="Associated instances",(e==null?void 0:e.column)===s.id&&e.row===n&&(i.className=h.expandedCell)):s.id==="groups"?(i["aria-label"]="Employee group",(e==null?void 0:e.column)===s.id&&e.row===n&&(i.className=h.expandedCell)):s.id==="name"?i.role="rowheader":s.id==="email"?i["aria-label"]="Email":s.id==="status"?i["aria-label"]="Status":s.id==="autoinstall_file"?i["aria-label"]="Assigned autoinstall file":s.id==="actions"&&(i["aria-label"]="Actions"),i},se=e=>s=>{s&&(e.current=[...s.querySelectorAll("tbody tr")])},ae=d.lazy(async()=>F(()=>import("./index-Dzdv1qjW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),re=({employees:e})=>{const{setSidePanelContent:s}=E(),[n,i]=d.useState(null),r=d.useRef([]);P((n==null?void 0:n.column)==="computers"||(n==null?void 0:n.column)==="groups"?{current:r.current[n.row]}:[],o=>{o.target instanceof Element&&!o.target.closest(`.${h.truncatedItem}`)&&i(null)});const a=(o,m)=>{i(l=>(l==null?void 0:l.column)===o&&l.row===m?null:{column:o,row:l&&["computers","groups"].includes(l.column)&&l.row<m?m-1:m})},u=o=>{s("Employee details",t.jsx(d.Suspense,{fallback:t.jsx(L,{}),children:t.jsx(ae,{employee:o})}),"medium")},p=d.useMemo(()=>[{accessor:"name",Header:"name",Cell:({row:{original:o}})=>t.jsx(c.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{u(o)},"aria-label":`Show details of user ${o.name}`,children:o.name})},{accessor:"email",Header:"email"},{accessor:"groups",Header:"employee group",Cell:({row:{original:o,index:m}})=>{const l=o.groups;return l?t.jsx(b,{content:l.map(f=>t.jsx(x,{to:`/settings/employees?tab=employee-groups&search=${f.name}`,className:h.truncatedItem,children:f.name},f.group_id)),isExpanded:(n==null?void 0:n.column)==="groups"&&n.row===m,onExpand:()=>{a("groups",m)}}):t.jsx(y,{})}},{accessor:"autoinstall_file",Header:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:h.autoinstallFileHeaderTitle,children:"assigned autoinstall file"}),t.jsx(c.Tooltip,{message:"This configuration file is assigned based on the highest-priority group the user belongs to.",children:t.jsx(c.Icon,{name:"help"})})]}),Cell:({row:{original:o}})=>{var m,l;return(m=o.autoinstall_file)!=null&&m.filename?t.jsx("span",{children:(l=o.autoinstall_file)==null?void 0:l.filename}):t.jsx(y,{})}},{accessor:"status",Header:"status",Cell:({row:{original:o}})=>t.jsx("span",{children:o.is_active?"active":"inactive"}),getCellIcon:({row:{original:{is_active:o}}})=>o?"status-succeeded-small":"status-failed-small"},{accessor:"computers",Header:"associated instances",Cell:({row:{original:o,index:m}})=>{var l;return o.computers?t.jsx(b,{content:(l=o.computers)==null?void 0:l.map(f=>t.jsx(x,{className:h.truncatedItem,to:`/instances/${f.id}`,children:f.title},f.id)),isExpanded:(n==null?void 0:n.column)==="computers"&&n.row===m,onExpand:()=>{a("computers",m)}}):t.jsx(y,{})}},{accessor:"actions",className:h.actions,Header:"actions",Cell:({row:{original:o}})=>t.jsx(J,{employee:o})}],[e,n]);return t.jsx("div",{ref:se(r),children:t.jsx(c.ModularTable,{columns:p,data:e,getCellProps:ne(n),getRowProps:te(n),emptyMsg:"No employees found according to your search parameters."})})};export{re as E,K as a,ce as u};
