const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DmBBP3aS.js","assets/index-CmmfIHlE.js","assets/index-mAgDtnB8.css","assets/AssociationBlock-B74y9iIC.js","assets/MultiSelectField-C_l77q69.js","assets/MultiSelectField-GyNA33om.css","assets/useGetTags-CChW5X3w.js","assets/AssociationBlock-vsPH8fvb.css","assets/SidePanelFormButtons-DmuqWUSv.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useRoles-Csuu2CdA.js","assets/RandomizationBlock-Cai5f0B7.js","assets/RadioGroup-BCxqBwme.js","assets/RadioGroup-WBbAFTwm.css","assets/PageMain-Cm2imCsJ.js","assets/PageMain-C_v2-kHh.css","assets/HeaderWithSearch-CXndOB4F.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/constants-B3UTGQVM.js","assets/TextConfirmationModal-DDnptHCt.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/table-CdFwMAPu.js","assets/index-LhlFy-U_.css"])))=>i.map(i=>d[i]);
import{d as x,m as v,k as _,l as S,j as e,aA as R,S as C,J as L,R as E,s as A,t as T,n as f,av as w,a2 as D,a8 as O,aI as F,o as p,e as P,aJ as $,x as k,U as M,aE as I,a as N,E as H,p as B,ag as m,a0 as h}from"./index-CmmfIHlE.js";import{P as Q,a as z,b as q}from"./PageMain-Cm2imCsJ.js";import{H as G}from"./HeaderWithSearch-CXndOB4F.js";import{L as V}from"./constants-B3UTGQVM.js";import{u as K}from"./useRoles-Csuu2CdA.js";import{T as U}from"./TextConfirmationModal-DDnptHCt.js";import{c as J}from"./table-CdFwMAPu.js";function Y(t={}){const s=x(),a=()=>v({queryKey:["rebootprofiles"],queryFn:async({signal:l})=>s.get("rebootprofiles",{signal:l}),...t}),{data:r,isPending:i,error:n}=a();return{rebootProfiles:r?.data.results||[],isPending:i,rebootProfilesError:n}}function W(){const t=x(),s=_(),a=S({mutationKey:["rebootprofiles","remove"],mutationFn:async n=>t.delete(`rebootprofiles/${n.id}`),onSuccess:async()=>s.invalidateQueries({queryKey:["rebootprofiles"]})}),{mutateAsync:r,isPending:i}=a;return{removeRebootProfile:r,isRemovingRebootProfile:i}}const X=({rebootProfile:t})=>!t.tags.length&&!t.all_computers?e.jsx(R,{}):t.num_computers?e.jsxs(C,{to:E.instances.root({query:`profile:reboot:${t.id}`}),children:[t.num_computers," ",L(t.num_computers,"instance")]}):"0 instances",Z=({close:t,opened:s,rebootProfile:a})=>{const r=A(),{notify:i}=T(),{setPageParams:n}=f(),{removeRebootProfile:l,isRemovingRebootProfile:c}=W(),d=async()=>{try{await l({id:a.id}),n({sidePath:[],profile:""}),i.success({title:"Reboot profile removed",message:`Reboot profile ${a.title} has been removed`})}catch(b){r(b)}finally{t()}};return e.jsx(U,{isOpen:s,title:"Remove reboot profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",onConfirm:d,confirmButtonDisabled:c,confirmButtonLoading:c,close:t,confirmationText:`remove ${a.title}`,children:e.jsxs("p",{children:['Are you sure you want to remove "',a.title,'" reboot profile? The removal of "',a.title,'" reboot profile is irreversible and might adversely affect your system.']})})},ee=()=>e.jsxs(e.Fragment,{children:[e.jsx(G,{}),e.jsx(w,{filtersToDisplay:["search"]})]}),te=({profile:t})=>{const{setPageParams:s}=f(),{value:a,setTrue:r,setFalse:i}=D(),n=()=>{s({sidePath:["edit"],profile:t.id.toString()})},l=()=>{s({sidePath:["duplicate"],profile:t.id.toString()})},c=[{icon:"edit",label:"Edit","aria-label":`Edit "${t.title}" profile`,onClick:n},{icon:"canvas",label:"Duplicate","aria-label":`Duplicate "${t.title}" profile`,onClick:l}],d=[{icon:"delete",label:"Remove","aria-label":`Remove "${t.title}" profile`,onClick:r}];return e.jsxs(e.Fragment,{children:[e.jsx(O,{toggleAriaLabel:`${t.title} profile actions`,actions:c,destructiveActions:d}),e.jsx(Z,{close:i,opened:a,rebootProfile:t})]})},{getCellProps:oe,getRowProps:se}=J({headerColumnId:"title",itemTypeName:"reboot profile"}),ae=({profiles:t})=>{const{search:s,setPageParams:a}=f(),{getAccessGroupQuery:r}=K(),{expandedRowIndex:i,handleExpand:n,getTableRowsRef:l}=F(),{data:c}=r(),d=c?.data.map(({name:o,title:u})=>({label:u,value:o}))??[],b=p.useMemo(()=>s?t.filter(o=>o.title.toLowerCase().includes(s.toLowerCase())):t,[t,s]),y=o=>{a({sidePath:["view"],profile:o.id.toString()})},j=p.useMemo(()=>[{accessor:"title",Header:"Title",id:"title",meta:{ariaLabel:({original:o})=>`${o.title} profile title`},Cell:({row:{original:o}})=>e.jsx(P.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{y(o)},children:o.title})},{accessor:"access_group",Header:"access group",meta:{ariaLabel:({original:o})=>`${o.title} profile access group`},Cell:({row:{original:o}})=>e.jsx(e.Fragment,{children:d.find(({value:u})=>u===o.access_group)?.label??o.access_group})},{accessor:"tags",Header:"Tags",meta:{ariaLabel:({original:o})=>`${o.title} profile tags`},Cell:({row:{original:o,index:u}})=>o.tags.length>0?e.jsx($,{content:o.tags.map(g=>e.jsx("span",{className:"truncatedItem",children:g},g)),isExpanded:u==i,onExpand:()=>{n(u)},showCount:!0}):e.jsx(R,{})},{accessor:"associated",Header:"associated",meta:{ariaLabel:({original:o})=>`${o.title} profile associated instances`},Cell:({row:{original:o}})=>e.jsx(X,{rebootProfile:o})},{accessor:"scheduled_reboot",Header:"scheduled reboot",meta:{ariaLabel:({original:o})=>`${o.title} profile next scheduled reboot`},className:"date-cell",Cell:({row:o})=>e.jsx("span",{className:"font-monospace",children:k(o.original.next_run).format(M)})},{...V,meta:{ariaLabel:({original:o})=>`${o.title} profile actions`},Cell:({row:o})=>e.jsx(te,{profile:o.original})}],[d.length,i]);return e.jsx("div",{ref:l,children:e.jsx(I,{columns:j,data:b,emptyMsg:`No profiles found with the search: "${s}"`,getCellProps:oe(i),getRowProps:se(i)})})},ie=()=>{const{rebootProfiles:t,isPending:s}=Y(),{search:a,setPageParams:r}=f(),i=()=>{r({sidePath:["add"],profile:""})};return e.jsxs(e.Fragment,{children:[s&&e.jsx(N,{}),!s&&t.length===0&&!a&&e.jsx(H,{title:"You don't have any Reboot profiles yet",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"Regular reboots keep your system healthy and secure by applying the latest updates. They also help maintain Livepatch coverage. Add a reboot profile to automate this process for your instances."}),e.jsx("a",{href:"https://ubuntu.com/security/livepatch/docs",target:"_blank",rel:"nofollow noopener noreferrer",children:"Learn more about Livepatch."})]}),cta:[e.jsx(P.Button,{appearance:"positive",onClick:i,type:"button",children:"Add reboot profile"},"table-add-new-profile")]}),!s&&t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsx(ae,{profiles:t})]})]})},re=p.lazy(async()=>h(()=>import("./index-DmBBP3aS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(t=>({default:t.RebootProfileAddSidePanel}))),ne=p.lazy(async()=>h(()=>import("./index-DmBBP3aS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(t=>({default:t.RebootProfileDetailsSidePanel}))),le=p.lazy(async()=>h(()=>import("./index-DmBBP3aS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(t=>({default:t.RebootProfileDuplicateSidePanel}))),ce=p.lazy(async()=>h(()=>import("./index-DmBBP3aS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(t=>({default:t.RebootProfileEditSidePanel}))),de=()=>{const{sidePath:t,lastSidePathSegment:s,setPageParams:a}=f();B("sidePath",["add","duplicate","edit","view"]);const r=()=>{a({sidePath:["add"],profile:""})};return e.jsxs(Q,{children:[e.jsx(z,{title:"Reboot profiles",actions:[e.jsx(P.Button,{appearance:"positive",onClick:r,type:"button",children:"Add reboot profile"},"new-key-button")]}),e.jsx(q,{children:e.jsx(ie,{})}),e.jsxs(m,{onClose:()=>{a({sidePath:[],profile:""})},isOpen:!!t.length,children:[s==="add"&&e.jsx(m.Suspense,{children:e.jsx(re,{})},"add"),s==="duplicate"&&e.jsx(m.Suspense,{children:e.jsx(le,{})},"duplicate"),s==="edit"&&e.jsx(m.Suspense,{children:e.jsx(ce,{})},"edit"),s==="view"&&e.jsx(m.Suspense,{children:e.jsx(ne,{})},"view")]},"add")]})},ge=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"}));export{X as R,Z as a,ie as b,ee as c,ae as d,ge as i};
