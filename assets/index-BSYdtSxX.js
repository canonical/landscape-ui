import{b,B as y,C as w,F as x,ad as f,j as e,d as a,G as g,q as j,E as k}from"./index-DdDZs9iJ.js";import{P as C,a as F,b as S}from"./PageMain-B3ytKPSD.js";import{b as E}from"./SidePanelFormButtons.module-BuIu-Bem.js";import{u as p}from"./useOrgSettings-t_5QNLn6.js";const N="_registrationContainer_16f29_1",O="_buttons_16f29_9",d={registrationContainer:N,buttons:O},P=({organisationPreferences:r})=>{const{setUser:o,user:i}=b(),c=y(),{notify:n}=w(),{changeOrganisationPreferences:u}=p(),{mutateAsync:_}=u,m={title:r.title,use_registration_key:!!r.registration_password,registration_password:r.registration_password||"",auto_register_new_computers:r.auto_register_new_computers},t=x({initialValues:m,validationSchema:f,onSubmit:async s=>{try{if(!i)return;await _({title:s.title,registration_password:s.registration_password,auto_register_new_computers:s.auto_register_new_computers}),s.title!==r.title&&o({...i,current_account:s.title,accounts:i.accounts.map(l=>l.title===r.title?{...l,title:s.title}:l)}),t.resetForm({values:{auto_register_new_computers:s.auto_register_new_computers,registration_password:s.registration_password,title:s.title,use_registration_key:s.use_registration_key}}),n.success({title:"Your changes have been saved",message:`Changes made to organization settings for ${s.title} have been successfully saved.`})}catch(l){c(l)}}}),h=s=>{t.getFieldProps("registration_password").onChange(s),t.setFieldValue("registration_password",""),t.setFieldTouched("registration_password",!1),t.setFieldError("registration_password",void 0),t.setFieldValue("auto_register_new_computers",!1)};return e.jsxs(a.Form,{noValidate:!0,onSubmit:t.handleSubmit,children:[e.jsx(a.Input,{label:"Organization's name",type:"text",help:"Visible to others in organization",error:g(t,"title"),...t.getFieldProps("title")}),e.jsx(a.Input,{label:"Use registration key",type:"checkbox",checked:t.values.use_registration_key,...t.getFieldProps("use_registration_key"),onChange:h}),t.values.use_registration_key&&e.jsxs("div",{className:d.registrationContainer,children:[e.jsx(a.Input,{labelClassName:"u-off-screen",label:"Registration key","aria-label":"Registration key",type:"text",error:g(t,"registration_password"),...t.getFieldProps("registration_password")}),e.jsx(a.Input,{label:"Auto register new computers",type:"checkbox",checked:t.values.auto_register_new_computers,help:"This will automatically accept new instances that register to your organization.",...t.getFieldProps("auto_register_new_computers")})]}),e.jsx("p",{className:"p-form-help-text",children:"When this feature is enabled, new computers must be enrolled using the key that's defined in the field."}),e.jsx("div",{className:`${E.buttons} ${d.buttons}`,children:e.jsx(a.Button,{className:"u-no-margin--bottom",appearance:"positive",type:"submit",disabled:t.isSubmitting||!t.dirty,children:"Save changes"})})]})},R=()=>{const{getOrganisationPreferences:r}=p(),{data:o,isLoading:i,refetch:c}=r(),n=o==null?void 0:o.data,u=()=>{c()};return e.jsxs(C,{children:[e.jsx(F,{title:"General"}),e.jsxs(S,{container:"medium",children:[i&&e.jsx(j,{}),!i&&!n&&e.jsx(k,{title:"Could not load general information",icon:"connected",cta:[e.jsx(a.Button,{type:"button",appearance:"positive",onClick:u,children:"Try again"},"refetch")]}),n&&!i&&e.jsx(P,{organisationPreferences:n})]})]})};export{R as default};
