const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CjpNJedk.js","assets/index-AQFe3UL3.js","assets/index-D9DLLBWL.css","assets/SidePanelFormButtons-BGGfnbip.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/AssociationBlock-B6LG_66w.js","assets/MultiSelectField-BxMq1xld.js","assets/MultiSelectField-GyNA33om.css","assets/useInstances-D7RFoCga.js","assets/AssociationBlock-DQBJa-xL.css","assets/useAPTSources-CKDqLPxv.js","assets/useRoles-BuxefHIC.js","assets/constants-ZzmQ3SEy.js","assets/constants-DhXkDRlN.css","assets/tests-DFnZqbNV.js","assets/index-BimGfo9_.css"])))=>i.map(i=>d[i]);
import{f as S,i as A,e as M,g as m,h as E,r as u,y as w,l as j,j as e,m as l,o as g,_ as P,c as L,N as Q,ag as T,E as B}from"./index-AQFe3UL3.js";import{P as O,a as D,b as N}from"./PageMain-DSc7t8nW.js";import"./constants-ZzmQ3SEy.js";import{u as k}from"./useRoles-BuxefHIC.js";import{H}from"./HeaderWithSearch-B55YHt2j.js";function _(){const o=S(),s=A(),a=M(),r=(t={},i={})=>E({queryKey:["repositoryProfiles",t],queryFn:async()=>s.get("repositoryprofiles",{params:t}),...i}),n=m({mutationFn:async t=>s.post("repositoryprofiles",t),onSuccess:async()=>o.invalidateQueries({queryKey:["repositoryProfiles"]})}),c=m({mutationFn:async({name:t,...i})=>s.put(`repositoryprofiles/${t}`,i),onSuccess:async()=>o.invalidateQueries({queryKey:["repositoryProfiles"]})}),p=m({mutationKey:["repositoryProfiles"],mutationFn:async t=>a.get("RemoveRepositoryProfile",{params:t}),onSuccess:async()=>o.invalidateQueries({queryKey:["repositoryProfiles"]})});return{getRepositoryProfilesQuery:r,createRepositoryProfileQuery:n,editRepositoryProfileQuery:c,removeRepositoryProfileQuery:p}}const I="_toggleButton_bnzrt_1",$="_menu_bnzrt_6",x={toggleButton:I,menu:$},q=u.lazy(async()=>P(()=>import("./index-CjpNJedk.js").then(o=>o.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),z=({profile:o})=>{const[s,a]=u.useState(!1),[r,n]=u.useState(""),c=w(),{setSidePanelContent:p}=j(),{removeRepositoryProfileQuery:t}=_(),{mutateAsync:i,isPending:d}=t,b=()=>{p(`Edit ${o.title}`,e.jsx(u.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(q,{action:"edit",profile:o})}))},v=()=>{a(!0)},h=()=>{a(!1),n("")},C=async()=>{try{await i({name:o.name})}catch(y){c(y)}finally{h()}},R=y=>{n(y.target.value)},F=[{children:e.jsxs(e.Fragment,{children:[e.jsx(l.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),"aria-label":`Edit "${o.title}" profile`,hasIcon:!0,onClick:b},{children:e.jsxs(e.Fragment,{children:[e.jsx(l.Icon,{name:l.ICONS.delete}),e.jsx("span",{children:"Remove"})]}),"aria-label":`Remove "${o.title}" repository profile`,hasIcon:!0,onClick:v}];return e.jsxs(e.Fragment,{children:[e.jsx(l.ContextualMenu,{position:"left",className:x.menu,toggleClassName:x.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(l.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${o.title} profile actions`},links:F}),s&&e.jsxs(l.ConfirmationModal,{title:"Remove repository profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:d||r!==`remove ${o.name}`,confirmButtonLoading:d,onConfirm:C,close:h,children:[e.jsxs("p",{children:['This will remove "',o.title,'" profile. This action is irreversible.']}),"Type ",e.jsxs("b",{children:["remove ",o.name]})," to confirm.",e.jsx(l.Input,{type:"text",value:r,onChange:R})]})]})},G=({column:o})=>{const s={};return o.id==="title"?s.role="rowheader":o.id==="description"?s["aria-label"]="Description":o.id==="access_group"?s["aria-label"]="Access group":o.id==="id"&&(s["aria-label"]="Actions"),s},K="_accessGroup_1qgn5_1",V="_description_1qgn5_5",W="_actions_1qgn5_9",f={accessGroup:K,description:V,actions:W},Y=({repositoryProfiles:o})=>{const{search:s}=L(),{getAccessGroupQuery:a}=k(),{data:r}=a(),n=((r==null?void 0:r.data)??[]).map(({name:t,title:i})=>({label:i,value:t})),c=u.useMemo(()=>s?o.filter(t=>t.title.toLowerCase().includes(s.toLowerCase())):o,[o,s]),p=u.useMemo(()=>[{accessor:"title",Header:"Title"},{accessor:"description",Header:"Description",className:f.description,Cell:({row:t})=>t.original.description||e.jsx(Q,{})},{accessor:"access_group",Header:"Access group",className:f.accessGroup,Cell:({row:{original:t}})=>{var i;return((i=n.find(({value:d})=>t.access_group===d))==null?void 0:i.label)??t.access_group}},{accessor:"id",className:f.actions,Header:"Actions",Cell:({row:t})=>e.jsx(z,{profile:t.original})}],[c,n]);return e.jsx(l.ModularTable,{columns:p,data:c,getCellProps:G,emptyMsg:`No repository profiles found with the search "${s}"`})},J=()=>e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsx(T,{filtersToDisplay:["search"]})]}),U=u.lazy(()=>P(()=>import("./index-CjpNJedk.js").then(o=>o.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(o=>({default:o.RepositoryProfileForm}))),X=()=>{const{setSidePanelContent:o}=j(),{getRepositoryProfilesQuery:s}=_(),{data:a,isLoading:r}=s(),n=(a==null?void 0:a.data.results)??[],c=()=>{o("Add repository profile",e.jsx(u.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(U,{action:"add"})}))};return e.jsxs(O,{children:[e.jsx(D,{title:"Repository profiles",actions:[e.jsx(l.Button,{appearance:"positive",onClick:c,type:"button",children:"Add repository profile"},"new-key-button")]}),e.jsxs(N,{children:[r&&e.jsx(g,{}),!r&&n.length===0&&e.jsx(B,{title:"No repository profiles found",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You havenâ€™t added any repository profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/manage-repositories-web-portal",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage repositories in Landscape"})]}),cta:[e.jsx(l.Button,{appearance:"positive",onClick:c,type:"button",children:"Add repository profile"},"table-add-new-profile")]}),!r&&n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(J,{}),e.jsx(Y,{repositoryProfiles:n})]})]})]})},re=Object.freeze(Object.defineProperty({__proto__:null,default:X},Symbol.toStringTag,{value:"Module"}));export{Y as R,J as a,re as i,_ as u};
