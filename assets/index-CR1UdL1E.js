const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DqHkQy24.js","assets/index-2fzpjuii.js","assets/index-DBjrXwEZ.css","assets/index-C-Cemkxt.css"])))=>i.map(i=>d[i]);
import{l as h,j as e,m as s,r as c,o as P,_ as S,C as k,G as o,F as w,y as q,W as F,A}from"./index-2fzpjuii.js";const B="_container_18vdw_1",N="_backButton_18vdw_14",E="_chevronIcon_18vdw_19",l={container:B,backButton:N,chevronIcon:E},T=c.lazy(()=>S(()=>import("./index-DqHkQy24.js"),__vite__mapDeps([0,1,2,3]))),V=({action:n})=>{const{closeSidePanel:r,setSidePanelContent:i}=h(),u=()=>{i("Choose an identity provider",e.jsx(c.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(T,{})}))};return e.jsxs("div",{className:l.container,children:[n==="add"&&e.jsxs(s.Button,{type:"button",hasIcon:!0,onClick:u,className:l.backButton,children:[e.jsx(s.Icon,{name:"chevron-up",className:l.chevronIcon}),e.jsx("span",{children:"Back"})]}),e.jsx(s.Button,{type:"button",onClick:r,appearance:"base",className:"u-no-margin--bottom",children:"Cancel"}),e.jsx(s.Button,{type:"submit",appearance:"positive",className:"u-no-margin--bottom",children:n==="edit"?"Save changes":"Add ID provider"})]})},L={client_id:"",client_secret:"",enabled:!1,issuer:"",name:""},D=n=>k().shape({client_id:(n==null?void 0:n.provider)==="ubuntu-one"?o():o().required("This field is required"),client_secret:(n==null?void 0:n.provider)==="ubuntu-one"?o():o().required("This field is required"),enabled:w(),issuer:(n==null?void 0:n.provider)==="ubuntu-one"?o():o().url().required("This field is required"),name:(n==null?void 0:n.provider)==="ubuntu-one"?o():o().required("This field is required")}),$="_urlContainer_3ww2d_1",U="_url_3ww2d_1",_={urlContainer:$,url:U},G=n=>{const{action:r,provider:i}=n,u=q(),{closeSidePanel:p}=h(),{getSingleProviderQuery:f,addProviderQuery:x,updateProviderQuery:g,toggleUbuntuOneQuery:j}=F(),{data:a}=f({providerId:r==="edit"?i.id:0},{enabled:r==="edit"&&i.provider!=="ubuntu-one"}),{mutateAsync:v}=x,{mutateAsync:I}=g,{mutateAsync:y}=j,t=A({initialValues:L,onSubmit:async d=>{const b={configuration:{issuer:d.issuer,client_id:d.client_id,client_secret:d.client_secret,name:d.name,provider:r==="add"?i.provider_slug:i.provider},enabled:d.enabled};try{r==="add"?await v(b):i.provider==="ubuntu-one"?await y({ubuntu_one:d.enabled}):await I({...b,providerId:i.id}),p()}catch(C){u(C)}},validationSchema:D(r==="edit"?i:null)});c.useEffect(()=>{r!=="edit"||i.provider!=="ubuntu-one"||t.setFieldValue("enabled",i.enabled)},[r,i]),c.useEffect(()=>{a&&t.setValues({client_id:a.data.configuration.client_id,client_secret:a.data.configuration.client_secret,enabled:a.data.enabled,issuer:a.data.configuration.issuer,name:a.data.configuration.name})},[a]);const m=r==="edit"&&!n.canBeDisabled&&(a==null?void 0:a.data.enabled);return e.jsxs(s.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[(r!=="edit"||i.provider!=="ubuntu-one")&&e.jsxs("div",{className:_.urlContainer,children:[e.jsx("span",{children:"Redirect URL "}),e.jsx(s.Icon,{name:"information"}),e.jsx("code",{className:_.url,children:r==="add"?i.redirect_uri:a==null?void 0:a.data.redirect_uri}),e.jsx("p",{className:"p-text--small u-text--muted u-no-margin--bottom",children:"You will need to set this in the configuration of your identity provider."})]}),e.jsx(s.Tooltip,{message:m&&"At least one identity provider must be active on the Landscape account.",children:e.jsx(s.Input,{type:"checkbox",label:"Enabled",...t.getFieldProps("enabled"),checked:t.values.enabled,disabled:m,help:`If checked the identity provider will be enabled ${r==="add"?"when it is created.":"for logging in."}`})}),(r!=="edit"||i.provider!=="ubuntu-one")&&e.jsxs(e.Fragment,{children:[e.jsx(s.Input,{type:"text",label:"Name",required:!0,...t.getFieldProps("name"),autoComplete:"off",error:t.touched.name&&t.errors.name?t.errors.name:void 0}),e.jsx(s.Input,{type:"text",label:"Client ID",required:!0,...t.getFieldProps("client_id"),autoComplete:"off",error:t.touched.client_id&&t.errors.client_id?t.errors.client_id:void 0}),e.jsx(s.Input,{type:"text",label:"Client Secret",required:!0,...t.getFieldProps("client_secret"),autoComplete:"off",error:t.touched.client_secret&&t.errors.client_secret?t.errors.client_secret:void 0}),e.jsx(s.Input,{type:"url",label:"Issuer",required:!0,...t.getFieldProps("issuer"),autoComplete:"off",error:t.touched.issuer&&t.errors.issuer?t.errors.issuer:void 0})]}),e.jsx(V,{action:r})]})};export{G as default};
