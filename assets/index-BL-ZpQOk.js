import{r as i,z as ae,j as e,h as I,g as n,o as H,e as J,B as oe,_ as X,a as re,l as ie,f as le,R as W}from"./index-CreLYkd7.js";import{a as ee,u as ce}from"./useOnClickOutside-C2HBgAKD.js";import{u as L}from"./useInstances-iMsrO7Mz.js";import{a as te,c as de,d as ue}from"./index.esm-Co3jed-Q.js";import{I as me}from"./InfoItem-DVjSC8Rv.js";import{u as pe}from"./WslInstanceList.module-KT1Qwmbp.js";import{u as he}from"./useConfirm-Bodc886s.js";import{u as fe}from"./useRoles-CxXXNTjd.js";import{u as _e}from"./formik.esm-C2DYiXJC.js";import{h as U}from"./moment-Cl4UOzQZ.js";import{m as Z}from"./moment-CZq-kU5w.js";import{N as v}from"./NoData-DSmFbKcn.js";import"./useFetchOld-DGjYaeEJ.js";import"./useMutation-CvjNgrEE.js";import"./useQuery-TlFJgfqc.js";import"./InfoItem.module-BZ3tYMsb.js";import"./EmptyState-DAULjSZb.js";const ge=typeof window>"u";function xe(t={}){let{initializeWithValue:s=!0}=t;ge&&(s=!1);const[o,l]=i.useState(()=>{if(s)return{width:window.innerWidth,height:window.innerHeight}}),c=()=>{l({width:window.innerWidth,height:window.innerHeight})};return ee("resize",c),ae(()=>{c()},[]),o}const je="_infoContainer_1ca11_1",be="_amount_1ca11_9",Y={infoContainer:je,amount:be},ve=({isExpanded:t,overflowingChipsAmount:s})=>s>0&&!t&&e.jsx("div",{className:Y.infoContainer,children:e.jsx("span",{className:I("u-text--muted",Y.amount),children:`+${s}`})}),Ie=({containerRef:t,onDismiss:s,onOverflowingItemsAmountChange:o,tagData:l})=>{const c=()=>{if(!t.current)return;const r=t.current.querySelectorAll("span.p-chip");o(Array.from(r).filter(({offsetHeight:p,offsetTop:m})=>m>p).length)};return ee("resize",c),i.useEffect(()=>{c()},[l.length]),l.map(r=>e.jsx(n.Chip,{value:r,onDismiss:()=>s(r)},r))},we="_container_1f6mu_1",ye="_list_1f6mu_6",Ce="_listItem_1f6mu_11",Se="_search_1f6mu_17",D={container:we,list:ye,listItem:Ce,search:Se},Ne=({onTagClick:t,tags:s})=>s.length?e.jsxs("div",{className:D.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Tags"}),e.jsx("ul",{className:I("p-list--divided u-no-margin--bottom",D.list),children:s.map(o=>e.jsx("li",{children:e.jsx("div",{className:D.listItem,children:e.jsx(n.Button,{appearance:"base",className:D.search,onClick:()=>t(o),children:o})})},o))})]}):null,Re="_container_fqj7b_1",Ae="_prompt_fqj7b_10",Te="_saveButton_fqj7b_17",F={container:Re,prompt:Ae,saveButton:Te},Ee=({onTagAdd:t,search:s})=>e.jsx(e.Fragment,{children:s&&e.jsxs("div",{className:F.container,children:[e.jsxs("span",{className:F.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:s}),e.jsx("span",{children:"..."})]}),e.jsx(n.Button,{type:"button",appearance:"link",onClick:t,className:F.saveButton,children:"Add tag"})]})}),K=te().matches(/^[a-zA-Z]/,{message:"Tag must starts with a letter",excludeEmptyString:!0}).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,{message:"Tag can only contain letters, numbers, hyphens, and underscores",excludeEmptyString:!0}),De="_searchContainer_pn88d_1",ke="_box_pn88d_5",Le="_inputContainer_pn88d_10",ze="_inputError_pn88d_15",k={searchContainer:De,box:ke,inputContainer:Le,inputError:ze},Be=({onTagsChange:t,tags:s,label:o,labelClassName:l,required:c})=>{var Q;const[r,p]=i.useState(""),[m,f]=i.useState(""),[d,x]=i.useState(!1),[j,S]=i.useState(""),[g,w]=i.useState(!1),[z,B]=i.useState(0),{height:y}=xe(),[$,N]=i.useState({top:"100%",bottom:"auto"}),{getAllInstanceTagsQuery:O}=L(),R=i.useRef(null),h=i.useRef(null);i.useEffect(()=>{if(!h.current)return;const a=h.current.querySelector("input");a&&S(a.id)},[h.current]),i.useEffect(()=>{!g||!h.current||P()},[y,g,h.current,(Q=h.current)==null?void 0:Q.clientHeight]);const P=()=>{if(!h.current)return;const{top:a,height:_}=h.current.getBoundingClientRect();a+_+379<y?N({top:"100%",bottom:"auto"}):N({top:"auto",bottom:"100%"})},A=()=>{w(!1)};ce(R,A);const V=a=>{t(s.filter(_=>_!==a))},{data:C,isLoading:T}=O(),u=i.useMemo(()=>C?!r&&!s.length?C.data.results:C.data.results.filter(a=>!s.includes(a)).filter(a=>a.toLowerCase().includes(r.trim().toLowerCase())):[],[C,r,s]),E=a=>{t([...s,a])},M=()=>{if(r.trim())try{const a=K.validateSync(r.trim())??"";E(a),p(""),f(""),x(!1)}catch(a){a instanceof Error&&(f(a.message),x(!0))}},se=a=>{if(p(a.target.value),d)try{K.validateSync(a.target.value),f("")}catch(_){_ instanceof Error&&f(_.message)}},ne=a=>{const{key:_}=a;g?(_==="Escape"&&A(),_==="Enter"&&M()):_==="Enter"&&w(!0)};return e.jsxs("div",{children:[e.jsx("label",{className:I("p-form__label",{"is-required":c},l),htmlFor:j,children:o||"Tags"}),e.jsxs("div",{className:"p-search-and-filter",ref:R,children:[e.jsxs("div",{className:I("p-search-and-filter__search-container",k.searchContainer),"aria-expanded":g,ref:h,onClick:()=>w(!0),children:[e.jsx(Ie,{containerRef:h,onDismiss:V,onOverflowingItemsAmountChange:a=>B(a),tagData:s}),e.jsx("div",{className:I("p-search-and-filter__box",k.box),children:e.jsx("div",{className:k.inputContainer,children:e.jsx(n.Input,{type:"text",autoComplete:"off",value:r,onChange:se,placeholder:"Add tags",className:"u-no-margin--bottom",onClick:()=>w(!0),onKeyUp:ne,wrapperClassName:m?"is-error":"","aria-errormessage":m?`${j}-error`:void 0,"aria-invalid":!!m})})}),m&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:I("p-form-validation__message",k.inputError),id:`${j}-error`,children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:m})]})}),e.jsx(ve,{isExpanded:g,overflowingChipsAmount:z})]}),g&&T&&e.jsx(H,{}),g&&!T&&e.jsxs("div",{className:"p-search-and-filter__panel",style:$,children:[e.jsx(Ee,{onTagAdd:M,search:r}),e.jsx(Ne,{onTagClick:E,tags:u})]})]})]})},$e={deliver_after:"",deliverImmediately:!0},Oe=de().shape({deliver_after:te().when("deliverImmediately",{is:!1,then:t=>t.required("This field is required").test({message:"Invalid date",test:s=>U(s).isValid()}).test({message:"Date must be in the future",test:s=>U(s).isAfter()})}),deliverImmediately:ue()}),q={shutdown:{ctaLabel:"Shutdown",getDescription:t=>`This will shut down "${t}" instance.`,title:"Shut down instance"},reboot:{ctaLabel:"Restart",getDescription:t=>`This will restart "${t}" instance.`,title:"Restart instance"}},Pe="_wrapper_30z1x_1",Ve="_input_30z1x_5",G={wrapper:Pe,input:Ve},Fe=({action:t,instance:s,onClose:o})=>{const l=J(),{rebootInstancesQuery:c,shutdownInstancesQuery:r}=L(),{mutateAsync:p}=c,{mutateAsync:m}=r,d=_e({initialValues:$e,onSubmit:async x=>{const j={computer_ids:[s.id],deliver_after:x.deliverImmediately?void 0:`${x.deliver_after}:00Z`};try{t==="reboot"?await p(j):await m(j)}catch(S){l(S)}finally{o()}},validationSchema:Oe});return e.jsx(n.Form,{onSubmit:d.handleSubmit,noValidate:!0,children:e.jsx(n.Modal,{title:q[t].title,close:o,buttonRow:e.jsx(n.Button,{type:"submit",appearance:"negative",disabled:d.isSubmitting,children:q[t].ctaLabel}),children:e.jsxs("div",{className:G.wrapper,children:[e.jsx(n.CheckboxInput,{label:"Deliver as soon as possible",...d.getFieldProps("deliverImmediately"),checked:d.values.deliverImmediately}),e.jsx(n.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:G.input,placeholder:"Scheduled time",...d.getFieldProps("deliver_after"),disabled:d.values.deliverImmediately,error:d.touched.deliver_after&&d.errors.deliver_after?d.errors.deliver_after:void 0}),e.jsx("p",{children:q[t].getDescription(s.title)})]})})})},qe=t=>{var o;const s=(o=t.grouped_hardware)==null?void 0:o.network;return!Array.isArray(s)||s.length===0?e.jsx(v,{}):s.filter(({ip:l})=>l!=="Not available").map(({ip:l})=>l).join(", ")||e.jsx(v,{})},He=(t,s)=>{var o,l,c;return[{label:"instance ID",value:t.id},{label:"Hostname",value:t.hostname},{label:"IP Address",value:qe(t)},{label:"Serial number",value:((o=t.grouped_hardware)==null?void 0:o.system.serial)??e.jsx(v,{})},{label:"Product identifier",value:((l=t.grouped_hardware)==null?void 0:l.system.model)??e.jsx(v,{})},{label:"Distribution",value:t.distribution??"Unknown"},{label:"Access group",value:((c=s.find(({value:r})=>r===t.access_group))==null?void 0:c.label)||t.access_group},{label:"Last ping time",value:t.last_ping_time&&Z(t.last_ping_time).isValid()?Z(t.last_ping_time).format(oe):e.jsx(v,{})},{label:"Annotations",value:t.annotations?Object.entries(t.annotations).map(([r,p],m,f)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:`${r}: ${p}`}),m<f.length-1&&e.jsx("br",{})]})):e.jsx(v,{})},{label:"Comment",value:t.comment||e.jsx(v,{})}]},Me="_titleRow_fznp8_1",Qe="_flexContainer_fznp8_6",We="_italic_fznp8_11",Ue="_infoRow_fznp8_15",Ze="_tagSection_fznp8_20",Ye="_tagsRow_fznp8_25",Ke="_tagsButton_fznp8_33",b={titleRow:Me,flexContainer:Qe,italic:We,infoRow:Ue,tagSection:Ze,tagsRow:Ye,tagsButton:Ke},Ge=i.lazy(()=>X(()=>import("./index-CgP21l74.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),Je=i.lazy(()=>X(()=>import("./index-DhNT5Jn_.js").then(t=>t.i),__vite__mapDeps([13,1,2,3,9,10,11,14,5,6,7,15,16,12,17,8,18])).then(t=>({default:t.RunInstanceScriptForm}))),Xe=({instance:t})=>{const[s,o]=i.useState(null),[l,c]=i.useState(t.tags),r=re(),p=J(),{notify:m}=ie(),{confirmModal:f,closeConfirmModal:d}=he(),{setSidePanelContent:x}=le(),{removeInstancesQuery:j}=L(),{getAccessGroupQuery:S}=fe(),{deleteChildInstancesQuery:g}=pe(),{editInstanceQuery:w}=L(),{mutateAsync:z}=w,B=async()=>{try{await z({instanceId:t.id,tags:l}),m.success({title:"Tags updated",message:`"${t.title}" instance tags have been updated successfully`})}catch(u){p(u)}},{data:y}=S(),$=(y==null?void 0:y.data.map(({name:u,title:E})=>({label:E,value:u})))??[],{mutateAsync:N,isLoading:O}=j,R=async()=>{try{await N({computer_ids:[t.id]}),r(`${W}instances`,{replace:!0})}catch(u){p(u)}finally{d()}},h=()=>{f({title:"Remove instance from Landscape",body:e.jsxs("p",{children:["This will remove the instance ",e.jsx("b",{children:t.title})," from Landscape.",e.jsx("br",{}),e.jsx("br",{}),"It will remain on the parent machine. You can re-register it to Landscape at any time."]}),buttons:[e.jsx(n.Button,{appearance:"negative",onClick:R,children:"Remove"},"remove")]})},P=()=>{x("Edit Instance",e.jsx(i.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(Ge,{instance:t})}))},A=()=>{x("Run script",e.jsx(i.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(Je,{query:`id:${t.id}`})}))},{mutateAsync:V}=g,C=async()=>{try{await V({computer_ids:[t.id]}),r(`${W}instances`,{replace:!0})}catch(u){p(u)}finally{d()}},T=async()=>{f({title:"Delete instance",body:e.jsxs("p",{children:["This will permanently delete the instance ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),buttons:[e.jsx(n.Button,{appearance:"negative",onClick:C,children:"Delete"},"delete")]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:b.titleRow,children:[e.jsxs("div",{className:b.flexContainer,children:[e.jsx("p",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:t.title}),t.is_wsl_instance&&e.jsx("p",{className:I("u-text--muted u-no-margin--bottom",b.italic),children:"WSL Instance"})]}),e.jsxs("div",{className:b.flexContainer,children:[t.is_wsl_instance&&e.jsx(n.Button,{type:"button",className:"u-no-margin--bottom u-no-margin--right",onClick:T,children:"Delete instance"}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:P,children:[e.jsx(n.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:A,children:[e.jsx(n.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:h,disabled:O,children:[e.jsx(n.Icon,{name:"delete"}),e.jsx("span",{children:"Remove from Landscape"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:()=>o("reboot"),children:[e.jsx(n.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:()=>o("shutdown"),children:[e.jsx(n.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]})]})},"buttons")]})]}),e.jsx("div",{className:b.infoRow,children:e.jsx(n.Row,{className:"u-no-padding--left u-no-padding--right u-no-max-width",children:He(t,$).map(u=>e.jsx(n.Col,{size:4,children:e.jsx(me,{...u})},u.label))})}),e.jsx("div",{className:b.tagSection,children:e.jsxs(n.Row,{className:b.tagsRow,children:[e.jsx(n.Col,{size:4,children:e.jsx(Be,{labelClassName:"p-text--small p-text--small-caps u-text--muted",onTagsChange:u=>c(u),tags:l})}),e.jsx(n.Col,{size:2,className:b.tagsButton,children:e.jsx(n.Button,{type:"button",className:"u-no-margin--bottom",onClick:B,children:"Update"})})]})}),s&&e.jsx(Fe,{action:s,instance:t,onClose:()=>o(null)})]})},xt=Xe;export{xt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-CgP21l74.js","assets/index-CreLYkd7.js","assets/index-DzLy8aaC.css","assets/formik.esm-C2DYiXJC.js","assets/useInstances-iMsrO7Mz.js","assets/useFetchOld-DGjYaeEJ.js","assets/useMutation-CvjNgrEE.js","assets/useQuery-TlFJgfqc.js","assets/index.esm-Co3jed-Q.js","assets/SidePanelFormButtons-CfVlXCl-.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/useRoles-CxXXNTjd.js","assets/index-DhNT5Jn_.js","assets/useConfirm-Bodc886s.js","assets/EmptyState-DAULjSZb.js","assets/EmptyState-BNXajmMK.css","assets/moment-Cl4UOzQZ.js","assets/index-CnWz5K0S.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
