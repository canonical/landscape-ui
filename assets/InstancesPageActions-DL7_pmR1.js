const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DVWhmIgc.js","assets/index-CNSDWj8Q.js","assets/index-CoB-_C5O.css","assets/formikErrors-Bw8iTXYS.js","assets/CodeEditor-DBPYuwcp.js","assets/index-CySvbr4l.js","assets/CodeEditor-KxSGUzo3.css","assets/SidePanelFormButtons-DIizKTix.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useInstanceSearchHelpTerms-Djw2vq_i.js","assets/index-D-YBZSy_.js","assets/NoData-6ZK9sV5u.js","assets/TablePagination-CFXNvqsZ.js","assets/TableFilterChips-06YfpJdc.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-CLgA9gvz.css","assets/useFetchOld-BAAs34Op.js","assets/PageParamFilter-ChSwlZqZ.js","assets/TableFilter-2AKF5NjJ.js","assets/TableFilter-B85Stwni.css","assets/ResponsiveTable-BXalKviy.js","assets/ResponsiveTable-DsN8RVSX.css","assets/index-B1ULwG00.css","assets/ListTitle-BUruUKn1.js","assets/ListTitle-CxCHkD9o.css","assets/StaticLink-BEYCGcPv.js","assets/TruncatedCell-BMum6DLZ.js","assets/Truncated-Dtg97i8C.js","assets/Truncated-uqJp6ujM.css","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-B4jhRgod.js","assets/TextConfirmationModal-q88mH05g.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/InfoGrid-3w5mqARw.js","assets/InfoItem-Bt7JBIPo.js","assets/InfoItem-D8nPzgUA.css","assets/InfoGrid-D3QqOHFx.css","assets/index-afg1azeC.js","assets/useRoles-DYJzr0u4.js","assets/index-CfXqLKNo.css","assets/index-BjyGSZCB.js","assets/constants-2LnjKhHT.js","assets/useGetInstances-rIFBd_bT.js","assets/index-CJeGUPJ1.js","assets/index-DMJKUZPM.js","assets/ScriptsTabs-DfoExKFg.js","assets/helpers-kPKhnyjI.js","assets/constants-CDnVvJTb.js","assets/HeaderWithSearch-D2tNhOlz.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/ScriptsTabs-DN44MVZt.css","assets/useRunScript-Djv9SBc3.js","assets/DeliveryBlock-B3k_IVND.js","assets/RadioGroup-BVZkBsDq.js","assets/RadioGroup-WBbAFTwm.css","assets/ScriptDropdown-BDpvNfnn.js","assets/downshift.esm-DADdD-V8.js","assets/ScriptDropdown-DGqiHs-J.css","assets/index-D8g_Dy3D.js","assets/ScriptFormAttachments-1fibiNNB.js","assets/AttachmentFile-CcsxK_w8.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-DKbxphRT.js","assets/useUsns-dCIdMk13.js","assets/useUsns-BR-xUdoS.css","assets/index-dkgvsX2Y.js","assets/index-BlL8HijK.css","assets/index-Cjfz2f8B.js","assets/index-BrWa2GHD.js","assets/TagsAddConfirmationModal-B9Kwth0Z.js","assets/ModalTablePagination-Bllm121J.js","assets/ModalTablePagination-HDr0Q-Wm.css","assets/useGetTags-B_HL7bdb.js","assets/index-BEr-Qotk.js","assets/UbuntuProList-BZXPmBGO.js","assets/UbuntuProList-D3Pk1SjQ.css"])))=>i.map(i=>d[i]);
import{c as me,t as B,v as q,j as e,d,r,q as be,R as ye,o as $,J as Z,U as re,p as fe,as as _e,G as L,z as H,y as z,x as U,e as R,_ as T,k as xe,h as ve,w,a3 as je,aG as Ae,aI as Ce,f as ke,E as Ee,aJ as Se,C as Te,u as ie,aK as Pe}from"./index-CNSDWj8Q.js";import{u as le}from"./index-D-YBZSy_.js";import{u as V}from"./useFetchOld-BAAs34Op.js";import{L as Re}from"./ListTitle-BUruUKn1.js";import{N}from"./NoData-6ZK9sV5u.js";import{R as we}from"./ResponsiveTable-BXalKviy.js";import{S as Le}from"./StaticLink-BEYCGcPv.js";import{T as Ne}from"./TruncatedCell-BMum6DLZ.js";import{u as Oe}from"./useExpandableRow-B4jhRgod.js";import"./index-CySvbr4l.js";import{T as Ie}from"./TextConfirmationModal-q88mH05g.js";import"./InfoGrid-3w5mqARw.js";const Ue=(t,s)=>{const n=V(),{data:a,isPending:i,error:h}=me({queryKey:["pendingInstances"],queryFn:async()=>n.get("GetPendingComputers"),...s});return{pendingInstances:a?.data??[],isGettingPendingInstances:i,pendingInstancesError:h}},De=()=>{const t=V(),s=B(),{isPending:n,mutateAsync:a}=q({mutationFn:async i=>t.get("RebootComputers",{params:i}),onSuccess:async()=>s.invalidateQueries({queryKey:["instances"]})});return{restartInstances:a,isRestartingInstances:n}},Fe=()=>{const t=V(),s=B(),{isPending:n,mutateAsync:a}=q({mutationFn:async i=>t.get("ShutdownComputers",{params:i}),onSuccess:async()=>s.invalidateQueries({queryKey:["instances"]})});return{shutDownInstances:a,isShuttingDownInstances:n}},J={Online:{alertType:"ComputerOnlineAlert",label:"Online instances",alternateLabel:"Online",filterValue:"computer-online",query:"NOT alert:computer-offline",icon:{gray:"connected",color:"connected-color"}},ComputerDuplicateAlert:{alertType:"ComputerDuplicateAlert",label:"Duplicate instances",alternateLabel:"Duplicate",filterValue:"computer-duplicates",query:"alert:computer-duplicates",icon:{gray:"canvas",color:"canvas-color"}},ComputerOfflineAlert:{alertType:"ComputerOfflineAlert",label:"Offline instances",alternateLabel:"Offline",filterValue:"computer-offline",query:"alert:computer-offline",icon:{gray:"disconnect",color:"disconnect-color"}},ComputerRebootAlert:{alertType:"ComputerRebootAlert",label:"Needs reboot",alternateLabel:"Needs reboot",filterValue:"computer-reboot",query:"alert:computer-reboot",icon:{gray:"power-off",color:"power-off-color"}},EsmDisabledAlert:{alertType:"EsmDisabledAlert",label:"ESM disabled",alternateLabel:"ESM updates are disabled",filterValue:"esm-disabled",query:"alert:esm-disabled",icon:{gray:"computer-esm-disabled-alert",color:"computer-esm-disabled-alert-color"}},PackageProfilesAlert:{alertType:"PackageProfilesAlert",label:"Package profile alert",filterValue:"package-profiles",query:"alert:package-profiles",icon:{color:"package-profiles-alert"}},PackageReporterAlert:{alertType:"PackageReporterAlert",label:"Package reporter alert",filterValue:"package-reporter",query:"alert:package-reporter",icon:{color:"package-reporter-alert"}},PackageUpgradesAlert:{alertType:"PackageUpgradesAlert",label:"Package upgrades alert",alternateLabel:"Regular",filterValue:"package-upgrades",query:"alert:package-upgrades",icon:{color:"regular-upgrades"}},SecurityUpgradesAlert:{alertType:"SecurityUpgradesAlert",label:"Security upgrades alert",alternateLabel:"Security",filterValue:"security-upgrades",query:"alert:security-upgrades",icon:{color:"security-upgrades"}},UnapprovedActivitiesAlert:{alertType:"UnapprovedActivitiesAlert",label:"Unapproved activities alert",filterValue:"unapproved-activities",query:"alert:unapproved-activities",icon:{gray:"status-queued"}},UpToDate:{alertType:"UpToDate",label:"Packages up to date",alternateLabel:"Up to date",filterValue:"up-to-date",query:"NOT alert:package-upgrades",icon:{color:"up-to-date"}},ChildInstanceProfileAlert:{alertType:"ChildInstanceProfileAlert",label:"WSL profile alert",alternateLabel:"WSL profile alert",filterValue:"child-instance-profiles",query:"alert:child-instance-profiles",icon:{gray:"machines"}}},v={...J,PendingComputersAlert:{alertType:"PendingComputersAlert",label:"Pending acceptance",alternateLabel:"Pending",filterValue:"",query:"",icon:{gray:"pause",color:"pause-color"}},UbuntuProContractExpirationAlert:{alertType:"UbuntuProContractExpirationAlert",label:"Ubuntu Pro contract expiring",alternateLabel:"Ubuntu Pro expiring",filterValue:"90",query:"contract-expires-within-days:90",icon:{color:"contract-expiration-alert"}},Unknown:{alertType:"",label:"-",alternateLabel:"-",filterValue:"",query:"",icon:{color:"package-profiles-alert"}}},Be={label:"Archived",value:"archived"},Yt={os:{type:"select",options:[{label:"All",value:"",query:""},{label:"Ubuntu",value:"ubuntu",query:"NOT distribution:windows"},{label:"Windows",value:"windows",query:"distribution:windows"}]},groupBy:{options:[{label:"None",value:""},{label:"Parent",value:"parent"}]},status:{type:"select",options:[{label:"All",value:"",query:""},...Object.values(J).sort((t,s)=>t.label.localeCompare(s.label)).map(({label:t,filterValue:s,query:n})=>({label:t,value:s,query:n})),Be]},wsl:{options:[{label:"Parent",value:"parent",query:"wsl:parent"},{label:"Child",value:"child",query:"wsl:child"}]},contractExpiryDays:{type:"select",options:[{label:"All",value:"",query:""},{label:"90 days",value:"90",query:"contract-expires-within-days:90"},{label:"60 days",value:"60",query:"contract-expires-within-days:60"},{label:"30 days",value:"30",query:"contract-expires-within-days:30"},{label:"7 days",value:"7",query:"contract-expires-within-days:7"}]}};function F(t){const s=t.distribution_info?.distributor==="Ubuntu",n=t.distribution_info?.distributor==="Ubuntu Core",a=t.distribution_info?.distributor==="Microsoft",i=!a&&!!t.distribution_info?.distributor;return{employees:s,hardware:i,packages:s,power:i,pro:!(i&&!s&&!n),processes:i,sanitization:i&&!n&&!t.is_wsl_instance,scripts:i,snaps:i,users:i&&!n,uninstallation:t.is_wsl_instance,usg:s,wsl:a}}const ce=t=>!!t?.some(({type:s})=>s==="PackageUpgradesAlert"),ue=t=>!!t?.some(({type:s})=>s==="SecurityUpgradesAlert"),qe=t=>ce(t)||ue(t),Ve="_rowHeader_5hcyq_5",Me="_statusListItem_5hcyq_17",$e="_statusContainer_5hcyq_21",X={rowHeader:Ve,statusListItem:Me,statusContainer:$e},He=t=>t.map(({accessor:s,canBeHidden:n,optionLabel:a})=>({canBeHidden:n,label:a,value:s})),ze=({instance:t,selectedInstances:s})=>s.map(({id:a})=>a).includes(t.id)?"checked":"unchecked",Ge=({instance:t,selectedInstances:s,setSelectedInstances:n})=>{s.some(({id:a})=>a===t.id)?n(s.filter(({id:a})=>a!==t.id)):n([...s,t])},ee=t=>{if(t.archived)return{icon:"archive",label:"Archived"};const s=(t.alerts??[]).filter(({type:n})=>!["PackageUpgradesAlert","SecurityUpgradesAlert"].includes(n));return s.length===0?{icon:`${v.Online.icon.color}`,label:v.Online.alternateLabel??v.Online.label}:s.length===1?{icon:`${v[s[0].type].icon.color??v.Unknown.icon.color}`,label:e.jsx(e.Fragment,{children:v[s[0].type].alternateLabel??v[s[0].type].label??s[0].summary})}:{label:e.jsx("span",{className:X.statusContainer,children:s.map(({type:n,summary:a})=>e.jsx("span",{className:X.statusListItem,children:e.jsx(d.Tooltip,{message:v[n].alternateLabel??v[n].label??a,children:e.jsx(d.Icon,{className:"u-no-margin--left",name:`${v[n]?.icon.color??v.Unknown.icon.color}`})})},n))})}},Ke=t=>({regular:ce(t)?{icon:v.PackageUpgradesAlert.icon.color??"",label:v.PackageUpgradesAlert.label}:!1,security:ue(t)?{icon:v.SecurityUpgradesAlert.icon.color??"",label:v.SecurityUpgradesAlert.label}:!1}),te=t=>{if(!F(t).packages)return{icon:"",label:e.jsx(N,{})};const{regular:s,security:n}=Ke(t.alerts);return s&&n?{icon:n.icon,label:`${s.label}, ${n.label.toLowerCase()}`}:s?{icon:s.icon,label:s.label}:n?{icon:n.icon,label:n.label}:{icon:v.UpToDate.icon.color,label:v.UpToDate.label}},Qe=({id:t})=>{const s={};return t==="title"&&(s["aria-labelledby"]="column-1-label"),s},Xe=t=>({column:s,row:{index:n}})=>{const a={};switch(s.id){case"title":a.role="rowheader";break;case"status":a["aria-label"]="Status";break;case"upgrades":a["aria-label"]="Upgrades";break;case"os":a["aria-label"]="Operating system";break;case"tags":a["aria-label"]="Tags",t===n&&(a.className="expandedCell");break;case"availability_zone":a["aria-label"]="Availability zone";break;case"ubuntu_pro":a["aria-label"]="Ubuntu Pro expiration date";break;case"last_ping":a["aria-label"]="Last ping";break;case"actions":a["aria-label"]="Actions";break}return a},We=t=>({index:s,original:n})=>{const a={};return t===s&&(a.className="expandedRow"),a["aria-label"]=`${n.title} instance row`,a},Jt=r.memo(function({instances:s,selectedInstances:n,setColumnFilterOptions:a,setSelectedInstances:i}){const{disabledColumns:h,...b}=be(),{expandedRowIndex:u,getTableRowsRef:p,handleExpand:f}=Oe(),_=Object.values(b).some(o=>typeof o=="string"||Array.isArray(o)?o.length>0:!1),c=()=>{i(n.length!==0?[]:s)},l=r.useMemo(()=>[{accessor:"title",canBeHidden:!1,optionLabel:"Instance name",Header:e.jsxs(e.Fragment,{children:[e.jsx(d.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,onChange:c,disabled:s.length===0,checked:n.length===s.length&&s.length!==0,indeterminate:n.length!==0&&n.length<s.length}),e.jsx("span",{id:"column-1-label",children:"Name"})]}),Cell:({row:o})=>e.jsxs("div",{className:X.rowHeader,children:[e.jsx(d.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:o.original.title}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:ze({instance:o.original,selectedInstances:n})==="checked",onChange:()=>{Ge({instance:o.original,selectedInstances:n,setSelectedInstances:i})}}),e.jsxs(Re,{children:[e.jsx(Le,{to:ye.instances.details.fromInstance(o.original),children:o.original.title}),e.jsx("span",{className:"u-text--muted",children:o.original.hostname||e.jsx(N,{})})]})]})},{accessor:"status",canBeHidden:!0,optionLabel:"Status",Header:"Status",Cell:({row:{original:o}})=>{const{label:y}=ee(o);return y},getCellIcon:({row:{original:o}})=>{const{icon:y}=ee(o);return y}},{accessor:"upgrades",canBeHidden:!0,optionLabel:"Upgrades",Header:"Upgrades",Cell:({row:{original:o}})=>{const{label:y}=te(o);return y},getCellIcon:({row:{original:o}})=>{const{icon:y}=te(o);return y}},{accessor:"os",canBeHidden:!0,optionLabel:"OS",Header:"OS",Cell:({row:{original:o}})=>e.jsx(e.Fragment,{children:o.distribution_info?.description??e.jsx(N,{})})},{accessor:"tags",canBeHidden:!0,optionLabel:"Tags",Header:"Tags",Cell:({row:{original:o,index:y}})=>{if(!o.tags.length)return e.jsx(N,{});const x=()=>{f(y)};return e.jsx(Ne,{content:o.tags.map(C=>e.jsx("span",{className:"truncatedItem",children:C},C)),isExpanded:y===u,onExpand:x,showCount:!0})}},{accessor:"availability_zone",canBeHidden:!0,optionLabel:"Availability zone",Header:"Availability zone",Cell:({row:{original:o}})=>e.jsx(e.Fragment,{children:o.cloud_init?.availability_zone??e.jsx(N,{})})},{accessor:"ubuntu_pro",canBeHidden:!0,optionLabel:"Ubuntu pro",Header:"Ubuntu pro expiration",className:"date-cell",Cell:({row:o})=>o.original.ubuntu_pro_info?.attached&&$(o.original.ubuntu_pro_info.expires).isValid()?e.jsx("span",{className:"font-monospace",children:$(o.original.ubuntu_pro_info.expires).format(Z)}):e.jsx(N,{})},{accessor:"last_ping",canBeHidden:!0,optionLabel:"Last ping",Header:"Last ping time",className:"date-cell",Cell:({row:o})=>e.jsx(e.Fragment,{children:$(o.original.last_ping_time).isValid()?e.jsx("span",{className:"font-monospace",children:$(o.original.last_ping_time).format(Z)}):e.jsx(N,{})})}],[n.length,s,u]);r.useEffect(()=>{a(He(l))},[]);const m=r.useMemo(()=>l.filter(({accessor:o})=>typeof o=="string"&&!h.includes(o)),[h.length,l]);return e.jsx("div",{ref:p,children:e.jsx(we,{emptyMsg:_?"No instances found according to your search parameters.":"No instances found",columns:m,data:s,getHeaderProps:Qe,getRowProps:We(u),getCellProps:Xe(u),minWidth:1400})})}),Ye="_root_p3ak9_1",Je="_label_p3ak9_5",Ze="_text_p3ak9_16",et="_icon_p3ak9_20",tt="_content_p3ak9_24",nt="_isOpen_p3ak9_31",O={root:Ye,label:Je,text:Ze,icon:et,content:tt,isOpen:nt},st=({el:t,label:s,disabled:n=!1,onMenuClose:a})=>{const{value:i,setFalse:h,toggle:b}=re(),u=r.useRef(null);fe(u,h);const p=s||(r.isValidElement(t)&&typeof t.props=="object"&&t.props!==null&&"label"in t.props?t.props.label:null),f=r.isValidElement(t)&&typeof t.props=="object"&&t.props!==null&&t.type!==_e.Fragment?r.cloneElement(t,{inline:!0}):t;return e.jsxs("div",{ref:u,className:O.root,children:[e.jsxs(d.Button,{type:"button",appearance:"base",className:L(O.label,{[O.isOpen]:i}),onClick:b,disabled:n,children:[e.jsx(d.Icon,{name:"chevron-down",className:O.icon}),e.jsx("span",{className:O.text,children:p})]}),i&&e.jsx("div",{className:L(O.content,"p-contextual-menu__dropdown"),onClick:()=>{a&&a()},children:f})]})},at=()=>{const t=V(),s=B(),{mutateAsync:n,isPending:a}=q({mutationKey:["savedSearches","create"],mutationFn:async i=>t.get("CreateSavedSearch",{params:i}),onSuccess:async()=>s.invalidateQueries({queryKey:["savedSearches"]})});return{createSavedSearch:n,isCreatingSavedSearch:a}},ot=()=>{const t=V(),s=B(),{mutateAsync:n,isPending:a}=q({mutationKey:["savedSearches","edit"],mutationFn:async i=>t.get("EditSavedSearch",{params:i}),onSuccess:async()=>s.invalidateQueries({queryKey:["savedSearches"]})});return{editSavedSearch:n,isEditingSavedSearch:a}},de="medium",rt=r.lazy(async()=>T(()=>import("./index-DVWhmIgc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]))),Zt=({afterCreate:t,appearance:s="secondary",buttonLabel:n="Add saved search",search:a="",className:i,onBackButtonPress:h})=>{const{createSavedSearch:b}=at(),{notify:u}=H(),p=z(),{setSidePanelContent:f,closeSidePanel:_}=U(),c=!!h,l=async o=>{try{await b({title:o.title,search:o.search}),_(),t&&t(),u.success({title:"Saved search created",message:`The saved search "${o.title}" has been created successfully.`})}catch(y){p(y)}},m=()=>{const o=h&&de;f("Add saved search",e.jsx(r.Suspense,{fallback:e.jsx(R,{}),children:e.jsx(rt,{mode:"create",initialValues:{title:"",search:a},onSubmit:l,onBackButtonPress:h})}),o)};return e.jsxs(d.Button,{type:"button",appearance:s,onClick:m,className:i,hasIcon:c,children:[c&&e.jsx(d.Icon,{name:"plus",light:!0}),e.jsx("span",{children:n})]})},it=r.lazy(async()=>T(()=>import("./index-DVWhmIgc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]))),en=({savedSearch:t,onBackButtonPress:s})=>{const{editSavedSearch:n}=ot(),{notify:a}=H(),i=z(),{setSidePanelContent:h,closeSidePanel:b}=U(),u=async f=>{try{await n({name:t.name,title:t.title,search:f.search}),b(),a.success({title:"Saved search updated",message:`The saved search "${f.title}" has been updated successfully.`})}catch(_){i(_)}},p=()=>{const f=s&&de;h(`Edit "${t.title}" saved search`,e.jsx(r.Suspense,{fallback:e.jsx(R,{}),children:e.jsx(it,{mode:"edit",initialValues:{title:t.title,search:t.search},onSubmit:u,onBackButtonPress:s})}),f)};return e.jsx(d.Button,{type:"button",title:"Edit",appearance:"base","aria-label":`Edit ${t.title} saved search`,onClick:p,className:"has-icon u-no-margin--bottom u-no-margin--right",children:e.jsx(d.Icon,{name:"edit"})})},tn=xe().shape({title:ve().required("This field is required.")}),nn=Object.values(J).map(t=>t.filterValue),sn=["tag","distribution","hostname","title","alert","access-group","id","mac","ip","needs","license-id","annotation","profile","license-type","contract","contract-expires-within-days","license-expires-within-days","has-pro-management"],an=["security","wsl","script","repository","package","upgrade","reboot","removal"],on=["pass","fail","in-progress"],rn=["compliant","noncompliant"],ln=["unlicensed","pro","free_pro","legacy"],cn=["true","false","1","0"],un=["AND","OR","NOT"],dn=/^\d+$/,pn=/\s$/,hn=/(?:[^\s"]+|"[^"]*")+/g,gn=/([^\s]+)$/,mn=/"/g,bn=/\s+/,yn=/\b(AND|NOT)\b/,fn=/[0-9]+(?=:)/,_n=/[a-zA-Z0-9_-]+(?=:)/,xn=/".*?"/,vn=/[0-9]+/,jn=/:/,lt="_notification_xylkl_1",ct={notification:lt},ut=r.lazy(async()=>T(()=>import("./index-afg1azeC.js"),__vite__mapDeps([38,1,2,17,5,39,12,11,13,14,15,16,18,19,20,3,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,40]))),An=()=>{const{setSidePanelContent:t}=U(),{pendingInstances:s}=Ue();if(!s.length)return null;const n=()=>{t("Review Pending Instances",e.jsx(r.Suspense,{fallback:e.jsx(R,{}),children:e.jsx(ut,{instances:s})}),"large")};return e.jsxs(d.Notification,{severity:"information",title:"Pending instances",className:ct.notification,children:[e.jsx("span",{children:`You currently have ${s.length} pending
          	${w(s.length,"instance")}
          	awaiting your review and approval. `}),e.jsx(d.Button,{type:"button",appearance:"link",onClick:n,children:"Review Pending Instances"})]})},dt=t=>{const s=n=>typeof n=="string"?[n]:Array.isArray(n)?n.flatMap(s):r.isValidElement(n)?s(n.props.children):[];return s(t).join(" ").trim()},Q=(t,s,n)=>{if(r.isValidElement(t)){const a=t;return r.cloneElement(a,{key:a.key??s,className:L(n,a.props.className)})}return t},ne=t=>r.isValidElement(t)?(t.type?.displayName||t.type?.name||"").includes("ContextualMenu"):!1,pt=t=>r.isValidElement(t)?t.props:null,ht="_grouped_1pmej_1",gt={grouped:ht},mt=({buttons:t,collapseFrom:s="md",alwaysVisible:n=0,menuLabel:a="Actions",className:i,menuPosition:h="right",grouped:b=!0})=>{const u=je(`(min-width: ${Ae[s]}px)`),{visibleButtons:p,collapsedItems:f}=r.useMemo(()=>{const c=u?t:t.slice(0,n),l=[];return t.slice(u?0:n).forEach((m,o)=>{const y=u?o:o+n;if(ne(m)&&!c.includes(m)){const x=pt(m);if(x){const C=e.jsx(e.Fragment,{children:x.links?.map((E,D)=>typeof E=="string"||Array.isArray(E)?null:e.jsx(d.Button,{type:"button",className:"p-contextual-menu__link",onClick:k=>{E.onClick&&E.onClick(k)},disabled:E.disabled,children:E.children},D))});l.push({key:`contextual-menu-${y}`,label:x.toggleLabel,content:C,disabled:x.toggleDisabled})}return}if(r.isValidElement(m)&&(m.props.onClick||m.props.confirmationModalProps)&&!c.includes(m)){const x=m;l.push({key:`action-${y}`,children:dt(x)||`Action ${y+1}`,onClick:x.props.onClick,disabled:x.props.disabled});return}c.includes(m)||c.push(m)}),{visibleButtons:c,collapsedItems:l}},[t,n,u]),_=b&&p.length>1?e.jsx("div",{className:"p-segmented-control",children:e.jsx("div",{className:"p-segmented-control__list",children:p.map((c,l)=>ne(c)?Q(c,l,"u-no-margin--bottom"):Q(c,l,"p-segmented-control__button u-no-margin--bottom"))})}):e.jsx(e.Fragment,{children:p.map((c,l)=>Q(c,l,"u-no-margin--bottom"))});return e.jsxs("div",{className:L(i,{[gt.grouped]:b}),children:[p.length>0&&_,f.length>0&&e.jsx(d.ContextualMenu,{position:h,hasToggleIcon:!0,toggleLabel:a,toggleClassName:"u-no-margin--bottom",children:c=>e.jsx(e.Fragment,{children:f.map(l=>"content"in l&&"label"in l?e.jsx(st,{el:l.content,label:l.label,disabled:l.disabled,onMenuClose:c},l.key):typeof l!="string"&&"onClick"in l?e.jsx(d.Button,{type:"button",className:"p-contextual-menu__link",onClick:m=>{c(),l.onClick&&l.onClick(m)},disabled:l.disabled,children:l.children},l.key):null)})})]})},se=({action:t,onDetailsClick:s,selected:n})=>({title:`Selected ${w(n.length,"instance has","instances have")} been queued for ${t}.`,message:`${w(n.length,`"${n[0]?.title??""}" instance has`,`${n.length} instances have`)} been queued in Activities for ${t}.`,actions:[{label:"View details",onClick:s}]}),bt="_warning_16r8d_1",yt={warning:bt};var W=Ce();const ft=t=>{const{instanceId:s,childInstanceId:n}=t;return n?[Number(n)]:s?[Number(s)]:[]},Cn=t=>{const s=t.filter(a=>a.ubuntu_pro_info?.result==="success"&&a.ubuntu_pro_info.attached).length,n=t.length-s;return{withToken:s,withoutToken:n}};function _t(){const t=ke(),s=B(),n=q({mutationKey:["token","detach"],mutationFn:async h=>t.post("detach-token",h),onSuccess:async()=>s.invalidateQueries({queryKey:["instances"]})}),{mutateAsync:a,isPending:i}=n;return{detachToken:a,isDetachingToken:i}}const pe=({isOpen:t,onClose:s,computerIds:n,instanceTitle:a,instanceCount:i})=>{const{notify:h}=H(),b=z(),{openActivityDetails:u}=le(),{detachToken:p,isDetachingToken:f}=_t(),_=i??n.length,c=_>1,l=async()=>{try{const{data:{activity:o}}=await p({computer_ids:n}),y=a?`You queued detachment of Ubuntu Pro token for instance ${a}.`:`You queued detachment of Ubuntu Pro token for ${_} ${w(_,"instance")}.`,x=c?`This will disconnect the ${w(_,"instance from its","instances from their")} subscription and pause any enabled Pro services.`:"This will disconnect the instance from its subscription and pause any enabled Pro services.";h.success({title:y,message:x,actions:[{label:"View details",onClick:()=>{u(o)}}]}),s()}catch(o){b(o)}finally{s()}};if(!t)return null;const m=c?e.jsxs("p",{children:["Detaching the Ubuntu Pro token will disconnect ",_," ",w(_,"instance from its ","instances from their "),"subscription and pause any enabled Pro services."]}):e.jsx("p",{children:"Detaching the Ubuntu Pro token will disconnect this instance from its subscription and pause any enabled Pro services."});return W.createPortal(e.jsx(Ie,{isOpen:t,title:"Detach Ubuntu Pro token",onConfirm:l,close:s,confirmButtonLabel:"Detach",confirmButtonAppearance:"negative",confirmButtonLoading:f,confirmButtonDisabled:f,confirmationText:"detach ubuntu pro token",children:m}),document.body)},xt=r.lazy(async()=>T(()=>import("./index-BjyGSZCB.js"),__vite__mapDeps([41,1,2,42,7,8,9,11,12,13,14,15,16,17,18,19,20,3,21,22,23,43,5,24,25,26,27,28,29,30,31,32,33,34,35,36,37]))),kn=({instance:t})=>{const{setSidePanelContent:s}=U(),n=()=>{s("Attach Ubuntu Pro token",e.jsx(r.Suspense,{fallback:e.jsx(R,{}),children:e.jsx(xt,{selectedInstances:[t]})}))};return e.jsx(Ee,{title:"No Ubuntu Pro entitlement",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This computer is not currently attached to an Ubuntu Pro entitlement, which provides additional security updates and other benefits from Canonical."}),e.jsx("a",{href:"https://ubuntu.com/pro",target:"_blank",rel:"nofollow noopener noreferrer",children:"Learn more about Ubuntu Pro"})]}),cta:[e.jsx(d.Button,{appearance:"positive",type:"button",onClick:n,children:"Attach Ubuntu Pro"},"attach-ubuntu-pro")]})},vt="_container_dj78y_1",jt="_wrapped_dj78y_8",At="_innerContainer_dj78y_13",Ct="_button_dj78y_17",kt="_titleRow_dj78y_21",I={container:vt,wrapped:jt,innerContainer:At,button:Ct,titleRow:kt},ae=t=>t.filter(s=>!s.excluded),oe=(t,s)=>[...t,...s],Et=(t,s)=>t.label===s.label&&t.icon===s.icon&&!!t.disabled==!!s.disabled,Y=(t,s)=>t.length===s.length&&t.every((n,a)=>Et(n,s[a])),he=t=>t.destructive.length+t.nondestructive.length>0,St=(t,s)=>Y(t.destructive,s.destructive)&&Y(t.nondestructive,s.nondestructive),Tt=(t,s)=>{const n=a=>a.filter(i=>i.collapsed).length;return n(t)+n(s)},Pt=(t,s,n,a)=>{const i=t.getBoundingClientRect().right,h=[],b={nondestructive:[],destructive:[]};s.forEach((p,f)=>{const _=t.children[f];let c=!1;const l=p.collapsed&&a;let m=0;_?(m=_.getBoundingClientRect().right,c=m>i+1):c=!0,c||l?b.nondestructive.push(p):h.push(p)}),n.forEach((p,f)=>{const _=s.length+f,c=t.children[_];let l=!1;const m=p.collapsed&&a;let o=0;c?(o=c.getBoundingClientRect().right,l=o>i+1):l=!0,l||m?b.destructive.push(p):h.push(p)});const u=he(b)||a;return{visible:h,collapsed:b,showCollapsedMenu:u}},Rt=({actions:{destructive:t=[],nondestructive:s=[]},title:n})=>{const a=r.useMemo(()=>ae(s),[s]),i=r.useMemo(()=>ae(t),[t]),h=r.useMemo(()=>oe(a,i),[a,i]),[b,u]=r.useState(h),[p,f]=r.useState({nondestructive:[],destructive:[]}),[_,c]=r.useState(!1),[l,m]=r.useState(0),o=r.useMemo(()=>Tt(a,i)>1,[a,i]),y=r.useRef(null),x=r.useRef(!1),C=r.useCallback(k=>{const{visible:P,collapsed:j,showCollapsedMenu:S}=Pt(k,a,i,o);c(A=>A===S?A:S),u(A=>Y(A,P)?A:P),f(A=>St(A,j)?A:j)},[a,i,o]),E=r.useCallback((k,P)=>{const{width:j}=k.getBoundingClientRect();if(j===l)return;const S=j>l;m(j);const A=he(p);if(S&&A&&!x.current){x.current=!0,c(!1);const G=oe(a,i);u(G),f({nondestructive:[],destructive:[]});return}C(P)},[l,p,a,i,C]),D=r.useCallback(k=>{if(y.current&&(y.current.disconnect(),y.current=null),!k)return;const P=k,j=P.parentElement?.parentElement;if(!j)return;C(P),x.current=!1;const S=new ResizeObserver(()=>{E(j,P)});S.observe(j),y.current=S},[C,E]);return e.jsxs("div",{className:L(I.titleRow,{[I.wrapped]:!b.length}),children:[n,e.jsxs("div",{className:L(I.container,{[I.wrapped]:!b.length}),children:[e.jsx("div",{className:L(I.innerContainer,"p-segmented-control"),children:e.jsx("div",{ref:D,className:"p-segmented-control__list",children:b.map(({collapsed:k,excluded:P,icon:j,label:S,...A})=>e.jsxs(d.Button,{className:L(I.button,"u-no-margin--bottom p-segmented-control__button"),...A,children:[e.jsx(d.Icon,{name:j}),e.jsx("span",{children:S})]},S))})}),_&&e.jsx(Se,{hasToggleIcon:!0,toggleLabel:b.length?"More actions":"Actions",toggleClassName:"u-no-margin--bottom",toggleDisabled:[...i,...a].every(k=>k.disabled),actions:p.nondestructive,destructiveActions:p.destructive})]})]})},wt=r.lazy(()=>T(()=>import("./index-CJeGUPJ1.js"),__vite__mapDeps([44,1,2,42,7,8,9,11,12,13,14,15,16,17,18,19,20,3,21,22,23,43,5,24,25,26,27,28,29,30,31,32,33,34,35,36,37]))),En=({instance:t})=>{const{instanceId:s,childInstanceId:n}=Te(),{isFeatureEnabled:a}=ie(),{setSidePanelContent:i}=U(),{value:h,setTrue:b,setFalse:u}=re(!1),p=()=>{i("Replace Ubuntu Pro Token",e.jsx(r.Suspense,{fallback:e.jsx(R,{}),children:e.jsx(wt,{selectedInstances:[t]})}))};return e.jsxs(e.Fragment,{children:[e.jsx(Rt,{title:e.jsxs("div",{children:[e.jsx("span",{className:"p-heading--5 u-no-margin--bottom",children:"Account information"})," ",e.jsxs("span",{style:{display:"inline"},children:[e.jsx("span",{className:"u-text--muted",children:"listed from "}),e.jsx("a",{href:"https://ubuntu.com/pro/dashboard",target:"_blank",rel:"nofollow noopener noreferrer",children:"Ubuntu Pro Dashboard"})]})]}),actions:{nondestructive:[{icon:"edit",label:"Edit token",onClick:p}],destructive:[{icon:"delete",label:"Detach token",onClick:b,excluded:!a("ubuntu_pro_licensing")}]}}),e.jsx(pe,{isOpen:h,onClose:u,computerIds:ft({instanceId:s,childInstanceId:n}),instanceTitle:t.title})]})},Lt=r.lazy(async()=>T(()=>import("./index-DMJKUZPM.js"),__vite__mapDeps([45,46,1,2,13,14,15,16,47,48,12,21,22,26,27,28,29,30,31,39,17,32,33,18,19,20,49,50,51,52,5,53,7,8,9,54,3,55,56,57,58,59,60,61,4,6,62,63,64,65])).then(t=>({default:t.RunInstanceScriptForm}))),Nt=r.lazy(async()=>T(()=>import("./index-DKbxphRT.js"),__vite__mapDeps([66,1,2,7,8,9,5,67,48,17,68,11,12,13,14,15,16,18,19,20,3,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37])).then(t=>({default:t.Upgrades})));r.lazy(async()=>T(()=>import("./index-dkgvsX2Y.js"),__vite__mapDeps([69,1,2,17,7,8,9,3,70])));const Ot=r.lazy(async()=>T(()=>import("./index-Cjfz2f8B.js"),__vite__mapDeps([71,1,2,7,8,9,39,17,3]))),It=r.lazy(async()=>T(()=>import("./index-BrWa2GHD.js"),__vite__mapDeps([72,1,2,7,8,9,73,74,75,76,17]))),Ut=r.lazy(async()=>T(()=>import("./index-BEr-Qotk.js"),__vite__mapDeps([77,41,1,2,42,7,8,9,11,12,13,14,15,16,17,18,19,20,3,21,22,23,43,5,24,25,26,27,28,29,30,31,32,33,34,35,36,37,44,78,79])).then(t=>({default:t.AttachTokenForm}))),Dt=r.lazy(async()=>T(()=>import("./index-BEr-Qotk.js"),__vite__mapDeps([77,41,1,2,42,7,8,9,11,12,13,14,15,16,17,18,19,20,3,21,22,23,43,5,24,25,26,27,28,29,30,31,32,33,34,35,36,37,44,78,79])).then(t=>({default:t.ReplaceTokenForm}))),Sn=r.memo(function({isGettingInstances:s,selectedInstances:n}){const a=z(),{isFeatureEnabled:i}=ie(),{notify:h}=H(),{openActivityDetails:b}=le(),{setSidePanelContent:u}=U(),[p,f]=r.useState(!1),[_,c]=r.useState(!1),[l,m]=r.useState(!1),{restartInstances:o,isRestartingInstances:y}=De(),{shutDownInstances:x,isShuttingDownInstances:C}=Fe(),E=g=>e.jsxs(e.Fragment,{children:[e.jsx("b",{children:g.length})," ",w(g.length,"instance")]}),D=async()=>{u("Run script",e.jsxs(r.Suspense,{fallback:e.jsx(R,{}),children:[n.some(g=>!F(g).scripts)?e.jsxs("div",{className:yt.warning,children:[e.jsxs("p",{children:["You selected ",n.length," instances. This script will:"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:["run on"," ",E(n.filter(g=>F(g).scripts))]}),e.jsxs("li",{children:["not run on"," ",E(n.filter(g=>!F(g).scripts))]})]})]}):null,e.jsx(Lt,{query:n.map(({id:g})=>`id:${g}`).join(" OR ")})]}))},k=async()=>{try{const{data:g}=await x({computer_ids:n.map(({id:K})=>K)});h.success(se({action:"shutdown",onDetailsClick:()=>{b(g)},selected:n}))}catch(g){a(g)}},P=async()=>{try{const{data:g}=await o({computer_ids:n.map(({id:K})=>K)});h.success(se({action:"reboot",onDetailsClick:()=>{b(g)},selected:n}))}catch(g){a(g)}},j=()=>{u("Upgrades",e.jsx(r.Suspense,{fallback:e.jsx(R,{}),children:e.jsx(Nt,{selectedInstances:n})}),"large")},S=()=>{u("Assign access group",e.jsx(r.Suspense,{fallback:e.jsx(R,{}),children:e.jsx(Ot,{selected:n})}))},A=()=>{u("Assign tags",e.jsx(r.Suspense,{fallback:e.jsx(R,{}),children:e.jsx(It,{selected:n})}))},G=()=>{u(`Attach Ubuntu Pro token to ${n.length} ${w(n.length,"instance")}`,e.jsx(r.Suspense,{fallback:e.jsx(R,{}),children:e.jsx(Ut,{selectedInstances:n})}))},ge=()=>{u(`Replace Ubuntu Pro token for ${n.length} ${w(n.length,"instance")}`,e.jsx(r.Suspense,{fallback:e.jsx(R,{}),children:e.jsx(Dt,{selectedInstances:n})}))},M=[n.every(g=>g.ubuntu_pro_info?.result==="success"&&g.ubuntu_pro_info.attached)?{children:e.jsx("span",{children:"Replace token"}),onClick:ge}:{children:e.jsx("span",{children:"Attach token"}),onClick:G},i("ubuntu_pro_licensing")?{children:e.jsx("span",{children:"Detach token"}),onClick:()=>{m(!0)}}:{}].filter(g=>g.children);return e.jsxs(e.Fragment,{children:[e.jsx(mt,{collapseFrom:"xl",buttons:[e.jsxs(d.Button,{className:"has-icon",type:"button",disabled:C||n.length===0||s,onClick:()=>{c(!0)},children:[e.jsx(d.Icon,{name:"power-off"}),e.jsx("span",{children:"Shut down"})]},"shutdown-instances"),e.jsxs(d.Button,{hasIcon:!0,type:"button",disabled:y||n.length===0||s,onClick:()=>{f(!0)},children:[e.jsx(d.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]},"reboot-instances"),M.length===1?e.jsx(d.Button,{type:"button",className:"u-no-margin--bottom",onClick:M[0].onClick,disabled:n.length===0,children:M[0].children},"pro-services"):e.jsx(d.ContextualMenu,{hasToggleIcon:!0,links:M,position:"right",toggleLabel:e.jsx("span",{children:"Pro services"}),toggleClassName:"u-no-margin--bottom",toggleDisabled:n.length===0,dropdownProps:{style:{zIndex:10}}},"pro-services"),Pe,e.jsxs(d.Button,{type:"button",hasIcon:!0,onClick:D,disabled:n.every(g=>!F(g).scripts)||s,children:[e.jsx(d.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]},"run-script"),e.jsxs(d.Button,{type:"button",hasIcon:!0,onClick:j,disabled:n.every(g=>!qe(g.alerts))||s,children:[e.jsx(d.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]},"upgrade-instances")]}),e.jsx(d.ContextualMenu,{hasToggleIcon:!0,links:[{children:"Access group",onClick:S},{children:"Tags",onClick:A}],position:"right",toggleLabel:e.jsxs(e.Fragment,{children:[e.jsx(d.Icon,{name:"plus"}),e.jsx("span",{children:"Assign"})]}),toggleClassName:"u-no-margin--bottom",toggleDisabled:n.length===0,dropdownProps:{style:{zIndex:10}}}),p&&W.createPortal(e.jsx(d.ConfirmationModal,{close:()=>{f(!1)},title:"Restarting selected instances",confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonLoading:y,confirmButtonDisabled:y,onConfirm:P,children:e.jsxs("p",{children:["Are you sure you want to restart ",n.length,w(n.length,"instance"),"?"]})}),document.body),_&&W.createPortal(e.jsx(d.ConfirmationModal,{close:()=>{c(!1)},title:"Shutting down selected instances",confirmButtonLabel:"Shut down",confirmButtonAppearance:"negative",confirmButtonLoading:C,confirmButtonDisabled:C,onConfirm:k,children:e.jsxs("p",{children:["Are you sure you want to shut down ",n.length," ",w(n.length,"instance"),"?"]})}),document.body),l&&e.jsx(pe,{isOpen:l,onClose:()=>{m(!1)},computerIds:n.map(({id:g})=>g)})]})});export{nn as A,cn as B,jn as C,pe as D,en as E,Yt as F,Jt as G,Rt as H,dn as I,Sn as J,_n as K,un as L,fn as N,an as P,hn as Q,mt as R,J as S,pn as T,kn as U,sn as V,rn as W,En as a,mn as b,Cn as c,on as d,ln as e,bn as f,ft as g,yn as h,xn as i,vn as j,gn as k,tn as l,ue as m,ce as n,qe as o,v as p,Ue as q,F as r,De as s,Fe as t,_t as u,ee as v,st as w,de as x,Zt as y,An as z};
