import{u as E}from"./useAddAutoinstallFile-C-XY52I9.js";import{c as w,i as D,k as L,r as p,B as q,C as v,m as A,F as z,j as e,d as l,G as C,aq as Y,q as j,y as N,I as x,x as b,D as y,an as P,ar as Q,aj as W,p as K,N as X,aB as J,as as Z,f as ee,E as se,ax as te,a1 as ae}from"./index-DHd_VY7f.js";import{V as ne,r as I,D as ie,A as S,f as le,a as oe,u as re,h as ce,i as k,b as $,g as ue}from"./EmployeeGroupIdentityIssuerList-Cbyj8V2Y.js";import"./index-Das6rBfU.js";import{H as de}from"./HeaderWithSearch-CdaIvHfM.js";import{g as me,E as pe}from"./helpers-Js6uIGS6.js";import{u as he}from"./useGetEmployeeGroups-xvA52FBT.js";import{u as fe}from"./useExpandableRow-Bp8Nn4kz.js";import{C as xe}from"./CodeEditor-BiQw3TxG.js";import{S as je}from"./SidePanelFormButtons-CzXdW2Nh.js";import"./SidePanelTablePagination-mVTM6XzY.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";const Ae=()=>{const s=w(),t=D(),{isPending:a,mutateAsync:n}=L({mutationFn:async({id:o})=>s.delete(`autoinstall/${o}`),onSuccess:async()=>t.invalidateQueries({queryKey:["autoinstallFiles"]})});return{deleteAutoinstallFile:n,isAutoinstallFileUpdating:a}},O=()=>{const s=w(),t=D(),{isPending:a,mutateAsync:n}=L({mutationFn:async({id:o,...r})=>s.patch(`autoinstall/${o}`,r),onSuccess:async()=>{await t.invalidateQueries({queryKey:["autoinstallFiles"]})}});return{isAutoinstallFileUpdating:a,updateAutoinstallFile:n}},ge="_form_1dly8_1",_e="_inputContainer_1dly8_7",be="_input_1dly8_7",ye="_inputDescription_1dly8_16",_={form:ge,inputContainer:_e,input:be,inputDescription:ye},R=({buttonText:s,description:t,initialFile:a=ie,notification:n,onSubmit:o})=>{const r=p.useRef(null),i=q(),{notify:u}=v(),{closeSidePanel:m}=A(),c=z({initialValues:{...a,filename:I(a.filename)},validationSchema:ne,onSubmit:async d=>{const h=`${d.filename}${S}`;try{await o({...d,filename:h}),m(),u.success({message:`${h} ${n.message}`,title:`${n.title} ${h}`})}catch(g){i(g)}}}),f=async({target:{files:d}})=>{if(!d)return;const[h]=d,g=c.setFieldValue("contents",await h.text());if(c.values.filename){await g;return}await Promise.all([c.setFieldValue("filename",I(h.name)),g])},F=async d=>{await c.setFieldValue("contents",d)},H=()=>{var d;(d=r.current)==null||d.click()};return e.jsxs(l.Form,{className:_.form,noValidate:!0,onSubmit:c.handleSubmit,children:[e.jsx("span",{children:t}),e.jsxs("div",{className:_.inputContainer,children:[e.jsx(l.Input,{wrapperClassName:_.input,type:"text",label:"File name",...c.getFieldProps("filename"),error:C(c,"filename"),disabled:!!a.filename,required:!0}),e.jsx("span",{className:_.inputDescription,children:S})]}),e.jsx("input",{ref:r,className:"u-hide",type:"file",accept:le.map(d=>`.${d}`).join(","),onChange:f}),e.jsx(xe,{label:"Code",value:c.values.contents,onChange:F,error:C(c,"contents"),required:!0,language:oe,headerContent:e.jsxs(l.Button,{className:"u-no-margin--bottom",appearance:"base",hasIcon:!0,onClick:H,type:"button",children:[e.jsx(l.Icon,{name:"upload"}),e.jsx("span",{children:"Populate from file"})]})}),e.jsx(je,{submitButtonDisabled:c.isSubmitting,submitButtonText:s})]})},Fe="_container_pnq0d_1",ve={container:Fe},M=({openAddForm:s})=>{const{employeeGroups:t}=he({},{listenToUrlParams:!1}),a=p.useMemo(()=>me(t),[t]);return e.jsxs(e.Fragment,{children:[e.jsx(de,{actions:e.jsxs("div",{className:ve.container,children:[e.jsx(pe,{options:a}),e.jsxs(l.Button,{type:"button",className:"u-no-margin",hasIcon:!0,onClick:s,children:[e.jsx(l.Icon,{name:"plus"}),e.jsx("span",{children:"Add new"})]})]})}),e.jsx(Y,{filtersToDisplay:["search","employeeGroups"],employeeGroupOptions:a})]})},Ce={message:"has been edited and all the changes made have been saved successfully.",title:"You have successfully saved changes for"},Ne=({autoinstallFile:s})=>{const{autoinstallFile:t,isAutoinstallFileLoading:a}=re({id:s.id,with_metadata:!0}),{updateAutoinstallFile:n}=O();return a||!t?e.jsx(j,{}):e.jsxs(e.Fragment,{children:[t.metadata.max_versions<=t.version&&e.jsx(l.Notification,{inline:!0,title:"Edit history limit reached:",severity:"caution",children:e.jsxs("p",{children:["You've reached the limit of"," ",t.metadata.max_versions," saved"," ",N(t.metadata.max_versions,"edit"),". To save your new change, the oldest version will be automatically removed, keeping the most recent"," ",t.metadata.max_versions," ",N(t.metadata.max_versions,"version")," ","in history."]})}),e.jsx(R,{buttonText:"Save changes",description:`The duplicated ${t.filename} will inherit the employee group assignments of the original file.`,initialFile:t,notification:Ce,onSubmit:async({contents:o})=>{await n({id:t.id,contents:o})}})]})},G=({autoinstallFile:s,close:t})=>{const{notify:a}=v(),{closeSidePanel:n}=A(),{deleteAutoinstallFile:o}=Ae(),r=async()=>{await o({id:s.id}),t(),n(),a.success({message:`The ${s.filename} autoinstall file has been permanently removed. All employee groups associated with this file are now using the default autoinstall file.`,title:`You have successfully removed ${s.filename} autoinstall file.`})};return e.jsx(l.ConfirmationModal,{close:t,confirmButtonAppearance:"negative",confirmButtonLabel:"Remove",onConfirm:r,title:`Remove ${s.filename}, autoinstall file`,children:e.jsxs("p",{children:["You are about to remove ",s.filename,", an autoinstall file. This action is irreversible. All employee groups this file is associated with, will have the default autoinstall file associated instead."]})})},Ie=({file:s})=>e.jsxs(e.Fragment,{children:[e.jsxs(l.Row,{className:"u-no-padding",children:[e.jsx(l.Col,{size:6,children:e.jsx(x,{label:"Name",value:s.filename})}),e.jsx(l.Col,{size:6,children:e.jsx(x,{label:"Version",value:s.version})})]}),e.jsxs(l.Row,{className:"u-no-padding",children:[e.jsx(l.Col,{size:6,children:e.jsx(x,{label:"Last modified",value:b(s.last_modified_at).format(y)})}),e.jsx(l.Col,{size:6,children:e.jsx(x,{label:"Date created",value:b(s.created_at).format(y)})})]}),e.jsx(x,{label:"Employee groups associated",value:s.groups.map(t=>t.name).join(", ")})]}),Se=[{id:"info",label:"Info"},{id:"version-history",label:"Version history"}],Te=({file:s,viewVersionHistory:t,initialTabId:a="info"})=>{const[n,o]=p.useState(a),r=Se.map(({label:i,id:u})=>({label:i,active:u===n,role:"tab",onClick:()=>{o(u)}}));return e.jsxs(e.Fragment,{children:[e.jsx(l.Tabs,{links:r}),n==="info"&&e.jsx(Ie,{file:s}),n==="version-history"&&e.jsx(ce,{file:s,viewVersionHistory:t})]})},Ee=({autoinstallFile:s,initialTabId:t})=>{const{value:a,setTrue:n,setFalse:o}=P(),{openAutoinstallFileDetails:r,openAutoinstallFileEditForm:i,setAutoinstallFileAsDefault:u}=V(s),m=()=>{r("version-history")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(l.Button,{type:"button",className:"p-segmented-control__button",onClick:i,hasIcon:!0,children:[e.jsx(l.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(l.Button,{type:"button",className:"p-segmented-control__button",onClick:u,disabled:s.is_default,hasIcon:!0,children:[e.jsx(l.Icon,{name:"starred"}),e.jsx("span",{children:"Set as default"})]}),e.jsxs(l.Button,{type:"button",className:"p-segmented-control__button",onClick:n,disabled:s.is_default,hasIcon:!0,children:[e.jsx(l.Icon,{name:l.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]})}),e.jsx(Te,{initialTabId:t,file:s,viewVersionHistory:m}),a&&e.jsx(G,{autoinstallFile:s,close:o})]})},B=()=>{const{setSidePanelContent:s}=A();return(t,a)=>{s(e.jsx(k,{file:t}),e.jsx(p.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(Ee,{initialTabId:a,autoinstallFile:t})}))}},V=s=>{const{notify:t}=v(),{closeSidePanel:a,setSidePanelContent:n}=A(),{updateAutoinstallFile:o}=O(),r=B();return{openAutoinstallFileDetails:i=>{r(s,i)},openAutoinstallFileEditForm:()=>{n(e.jsx(k,{file:s,title:"Edit"}),e.jsx(p.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(Ne,{autoinstallFile:s})}))},setAutoinstallFileAsDefault:async()=>{await o({id:s.id,is_default:!0}),a(),t.success({message:"Employee groups without an autoinstall file assigned will inherit this default file.",title:`You have successfully set ${s.filename} as the default autoinstall file`})}}},we=({autoinstallFile:s})=>{const{value:t,setTrue:a,setFalse:n}=P(),{openAutoinstallFileDetails:o,openAutoinstallFileEditForm:r,setAutoinstallFileAsDefault:i}=V(s),u=()=>{o()},m=[{icon:"topic",label:"View details","aria-label":`View ${s.filename} details`,onClick:u},{icon:"edit",label:"Edit","aria-label":`Edit ${s.filename}`,onClick:r},{icon:"starred",label:"Set as default","aria-label":`Set ${s.filename} as default`,onClick:i,disabled:s.is_default}],c=[{icon:"delete",label:"Remove","aria-label":`Remove ${s.filename}`,onClick:a,disabled:s.is_default}];return e.jsxs(e.Fragment,{children:[e.jsx(Q,{toggleAriaLabel:`${s.filename} actions`,actions:m,destructiveActions:c}),t&&e.jsx(G,{autoinstallFile:s,close:n})]})},De="_chip_kt4xa_1",Le="_container_kt4xa_5",T={chip:De,container:Le},Pe=s=>({column:t,row:{index:a}})=>{const n={};switch(t.id){case"filename":n.role="rowheader";break;case"groups":n["aria-label"]="employee groups",s===a&&(n.className="expandedCell");break;case"last_modified_at":n["aria-label"]="last modified at";break;case"created_at":n["aria-label"]="created at";break}return n},ke=s=>({index:t})=>{const a={};return s===t&&(a.className="expandedRow"),a},U=({autoinstallFiles:s})=>{const{expandedRowIndex:t,getTableRowsRef:a,handleExpand:n}=fe(),o=B(),r=p.useMemo(()=>[{accessor:"filename",Header:"Name",Cell:({row:{original:i}})=>e.jsxs("div",{className:T.container,children:[e.jsx(l.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top",onClick:()=>{o(i)},children:`${i.filename}, v${i.version}`}),i.is_default&&e.jsx("span",{className:K("p-chip is-dense u-no-margin--bottom",T.chip),children:e.jsx("span",{className:"p-chip__value",children:"default"})})]})},{accessor:"groups",Header:"Employee Groups Associated",Cell:({row:{original:{groups:i},index:u}})=>{if(!i||i.length===0)return e.jsx(X,{});const[m,...c]=i.map(f=>f.name);return e.jsx(J,{content:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:m}),c.map((f,F)=>e.jsxs("span",{children:[", ",f]},F))]}),isExpanded:u==t,onExpand:()=>{n(u)},showCount:!0})}},{accessor:"last_modified_at",Header:"Last modified",Cell:({row:{original:{last_modified_at:i}}})=>e.jsx("div",{className:"font-monospace",children:b(i).format(y)})},{accessor:"created_at",Header:"Date created",Cell:({row:{original:{created_at:i}}})=>e.jsx("div",{className:"font-monospace",children:b(i).format(y)})},{...W,Cell:({row:{original:i}})=>e.jsx(we,{autoinstallFile:i})}],[t]);return e.jsx("div",{ref:a,children:e.jsx(Z,{columns:r,data:s,emptyMsg:"No autoinstall files found according to your search parameters.",getCellProps:Pe(t),getRowProps:ke(t)})})},$e=Object.freeze(Object.defineProperty({__proto__:null,AutoinstallFileForm:R,AutoinstallFilesHeader:M,AutoinstallFilesList:U,getAutoinstallFileOptions:ue,useAddAutoinstallFile:E,useGetAutoinstallFiles:$},Symbol.toStringTag,{value:"Module"})),Oe={message:"can now be assigned to employee groups.",title:"You have successfully added"},Re=p.lazy(async()=>ae(()=>Promise.resolve().then(()=>$e),void 0).then(s=>({default:s.AutoinstallFileForm}))),Xe=()=>{const{currentPage:s,employeeGroups:t,pageSize:a,search:n}=ee(),{setSidePanelContent:o}=A(),{addAutoinstallFile:r}=E(),{autoinstallFiles:i,autoinstallFilesCount:u,isAutoinstallFilesLoading:m}=$({limit:a,offset:(s-1)*a,with_groups:!0,employee_group_ids:t.length>0?t.map(Number):void 0,search:n}),c=()=>{o("Add new autoinstall file",e.jsxs(p.Suspense,{fallback:e.jsx(j,{}),children:[e.jsx(Re,{buttonText:"Add",description:"Add autoinstall file. It can be applied during the initial setup of associated instances.",notification:Oe,onSubmit:r}),","]}))};return!i.length&&!n&&t.length===0&&!m?e.jsx(se,{icon:"file",title:"No autoinstall files found",body:e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any autoinstall files yet."}),cta:[e.jsx(l.Button,{appearance:"positive",onClick:c,className:"u-no-margin--right",children:"Add autoinstall file"},"add-autoinstall-file")]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{openAddForm:c}),m?e.jsx(j,{}):e.jsx(U,{autoinstallFiles:i}),e.jsx(te,{currentItemCount:i.length,totalItems:u})]})};export{Xe as default};
