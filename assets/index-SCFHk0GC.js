const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B0u69EJk.js","assets/index-CNSDWj8Q.js","assets/index-CoB-_C5O.css","assets/SidePanelFormButtons-DIizKTix.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useGPGKeys-D3i7Rbv2.js","assets/useFetchOld-BAAs34Op.js","assets/tests-DFnZqbNV.js","assets/formikErrors-Bw8iTXYS.js","assets/useRoles-DYJzr0u4.js","assets/useAPTSources-Cd783Zop.js","assets/PageMain-C8MVZwda.js","assets/PageMain-C_v2-kHh.css","assets/constants-CDnVvJTb.js","assets/TextConfirmationModal-q88mH05g.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/RepositoryProfileListActions-V0nMOMqZ.js","assets/ModalTablePagination-Bllm121J.js","assets/ModalTablePagination-HDr0Q-Wm.css","assets/constants-DvWgdSYC.js","assets/NoData-6ZK9sV5u.js","assets/index-D-YBZSy_.js","assets/TablePagination-CFXNvqsZ.js","assets/TableFilterChips-06YfpJdc.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-CLgA9gvz.css","assets/PageParamFilter-ChSwlZqZ.js","assets/TableFilter-2AKF5NjJ.js","assets/TableFilter-B85Stwni.css","assets/ResponsiveTable-BXalKviy.js","assets/ResponsiveTable-DsN8RVSX.css","assets/index-B1ULwG00.css","assets/constants-BnrFFkRy.css","assets/index-Cz9CfuJq.css"])))=>i.map(i=>d[i]);
import{f as P,c as b,t as y,v as j,r as i,j as e,e as u,d as c,a7 as d,y as v,z as _,a6 as S,U as M,a4 as L,x as N,E as C,_ as w}from"./index-CNSDWj8Q.js";import{P as R,a as F,b as O}from"./PageMain-C8MVZwda.js";import{L as k}from"./constants-CDnVvJTb.js";import{T as D}from"./TextConfirmationModal-q88mH05g.js";import{u as E}from"./RepositoryProfileListActions-V0nMOMqZ.js";import{M as I}from"./ModalTablePagination-Bllm121J.js";import"./constants-DvWgdSYC.js";import{R as G}from"./ResponsiveTable-BXalKviy.js";const B=s=>{const o=P(),{data:t,isPending:r}=b({queryKey:["aptSources",s],queryFn:()=>o.get("repository/apt-source",{params:s})});return{aptSources:t?.data.results??[],isGettingAPTSources:r}},H=()=>{const s=P(),o=y(),{mutateAsync:t,isPending:r}=j({mutationKey:["aptSources","remove"],mutationFn:({id:n,...a})=>s.delete(`repository/apt-source/${n}`,{params:a}),onSuccess:()=>o.invalidateQueries({queryKey:["aptSources"]})});return{removeAPTSource:t,isRemovingAPTSource:r}},$=({repositoryProfilesResult:{isPending:s,data:o,error:t},goToNextPage:r,goToPreviousPage:n,pageNumber:a})=>{const l=i.useMemo(()=>[{Header:"Repository profile",accessor:"title"}],[]);return s?e.jsx(u,{}):o?e.jsxs(e.Fragment,{children:[e.jsx(c.ModularTable,{columns:l,data:o.data.results}),e.jsx(I,{current:a,max:Math.ceil(o.data.count/d),onNext:r,onPrev:n})]}):e.jsxs(c.Notification,{severity:"negative",children:['The associated repository profiles could not be loaded due to an unexpected error: "',t.message,'"']})},q=({aptSource:s,close:o,opened:t})=>{const{removeAPTSource:r,isRemovingAPTSource:n}=H(),{getRepositoryProfilesQuery:a}=E(),l=v(),{notify:f}=_(),{count:m,decrement:h,increment:A}=S(1),p=a({limit:d,offset:(m-1)*d,search:s.profiles},{enabled:!!s.profiles.length&&t}),T=async()=>{try{await r({id:s.id,disassociate_profiles:!0}),f.success({title:`You have successfully deleted the ${s.name} APT source.`,message:s.profiles.length?"It will no longer be available and it has been removed from its associated profiles.":"It will no longer be available to include in repository profiles."})}catch(x){l(x)}finally{o()}};return e.jsx(D,{className:"is-narrow",close:o,title:`Deleting ${s.name} APT source`,confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonLoading:n,confirmButtonDisabled:!!s.profiles.length&&p.isPending,onConfirm:T,isOpen:t,confirmationText:`delete ${s.name}`,children:s.profiles.length?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This APT source belongs to the following repository profiles."}),e.jsxs("p",{children:["If this source is deleted, it will no longer be included in its profiles. ",e.jsx("strong",{children:"This action is irreversible."})]}),e.jsx($,{repositoryProfilesResult:p,goToNextPage:A,goToPreviousPage:h,pageNumber:m})]}):e.jsxs("p",{children:["If this APT source is deleted, it will no longer be available to include in repository profiles."," ",e.jsx("strong",{children:"This action is irreversible."})]})})},Q=({aptSource:s})=>{const{value:o,setTrue:t,setFalse:r}=M();return e.jsxs(e.Fragment,{children:[e.jsx(L,{toggleAriaLabel:`${s.name} APT source actions`,destructiveActions:[{icon:c.ICONS.delete,label:"Delete","aria-label":`Remove ${s.name} APT source`,onClick:t}]}),e.jsx(q,{aptSource:s,close:r,opened:o})]})},z="_line_1odl9_1",K="_accessGroup_1odl9_10",g={line:z,accessGroup:K},U=s=>{const o={};switch(s.column.id){case"name":o.role="rowheader";break;case"access_group":o["aria-label"]="Access group";break;case"line":o["aria-label"]="Line";break;case"id":o["aria-label"]="Actions";break}return o},Y=({items:s})=>{const o=i.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"access_group",Header:"Access group",className:g.accessGroup},{accessor:"line",Header:"Line",className:g.line},{...k,Cell:({row:t})=>e.jsx(Q,{aptSource:t.original})}],[]);return e.jsx(G,{columns:o,data:i.useMemo(()=>s,[s.length]),emptyMsg:"No APT sources yet.",getCellProps:U})},V=i.lazy(async()=>w(()=>import("./index-B0u69EJk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34])).then(s=>({default:s.NewAPTSourceForm}))),Z=()=>{const{setSidePanelContent:s}=N(),{aptSources:o,isGettingAPTSources:t}=B(),r=()=>{s("Add APT source",e.jsx(i.Suspense,{fallback:e.jsx(u,{}),children:e.jsx(V,{})}))};return e.jsxs(R,{children:[e.jsx(F,{title:"APT sources",actions:[e.jsx(c.Button,{appearance:"positive",onClick:r,type:"button",children:"Add APT source"},"new-key-button")]}),e.jsxs(O,{children:[t&&e.jsx(u,{}),!t&&o.length===0&&e.jsx(C,{title:"No APT sources found",icon:"connected",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You havenâ€™t added any APT sources yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage APT sources in Landscape"})]}),cta:[e.jsx(c.Button,{appearance:"positive",onClick:r,type:"button",children:"Add APT source"},"table-add-new-mirror")]}),!t&&o.length>0&&e.jsx(Y,{items:o})]})]})},ne=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));export{Y as A,H as a,ne as i,B as u};
