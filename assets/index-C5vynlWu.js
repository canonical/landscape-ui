const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-dNxYUV5O.js","assets/index-D2k2h3rl.js","assets/index-DQXBeV4P.css","assets/SidePanelFormButtons-BuRhTPfw.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/useRoles-D5dQGJ_L.js","assets/useFetchOld-u8CFTbAp.js"])))=>i.map(i=>d[i]);
import{k as f,n as h,t as N,j as e,d as i,L as S,R as T,q as L,r as d,_ as j,i as _,o as g,E as w}from"./index-D2k2h3rl.js";import{P as F,a as G,b as $}from"./PageMain-D6Zii094.js";import{u as b}from"./useRoles-D5dQGJ_L.js";import{G as E}from"./GroupFilter-aNkCX6O6.js";import{u as C}from"./usePageParams-CF9qKZgS.js";import{a as I}from"./TableFilterChips-DvQnBNIX.js";import{F as D}from"./InstancesPageActions-C7275-qZ.js";import"./moment-C5S46NFB.js";import{N as B}from"./NoData-N6VAhUVA.js";import{u as H}from"./useInstances-C8qOtNZd.js";const he={title:"",parent:""},ge=f().shape({title:h().required("This field is required"),parent:h().required("This field is required")}),R="_container_vxbz8_1",M="_searchContainer_vxbz8_11",x={container:R,searchContainer:M},O=()=>{const{search:a,setPageParams:n}=C(),s=()=>{n({search:c.values.searchText})},o=()=>{n({search:""})},c=N({initialValues:{searchText:a},enableReinitialize:!0,validationSchema:f().shape({search:h()}),onSubmit:s}),u=D.groupBy.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:x.container,children:[e.jsx("div",{className:x.searchContainer,children:e.jsx(i.Form,{onSubmit:c.handleSubmit,noValidate:!0,children:e.jsx(i.SearchBox,{autocomplete:"off",externallyControlled:!0,value:c.values.searchText,onChange:async p=>await c.setFieldValue("searchText",p),placeholder:"Search",onSearch:s,onClear:o})})}),e.jsx(E,{options:u},"group-by-filter")]}),e.jsx(I,{filtersToDisplay:["search"]})]})},V="_link_1wvsk_1",q={link:V},z=({accessGroup:a})=>{const{getInstancesQuery:n}=H(),{data:s,isPending:o}=n({query:`access-group: ${a.name}`,root_only:!1,with_alerts:!0,with_upgrades:!0,limit:1});return s!=null&&s.data&&a.instancesCount!==s.data.count&&(a.instancesCount=s.data.count||0),o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"u-off-screen",children:"Loading..."}),e.jsx(i.Spinner,{"aria-hidden":!0})]}):s!=null&&s.data.count?e.jsx(S,{className:q.link,to:`${T}instances?accessGroups=${a.name}`,children:s.data.count}):e.jsx(e.Fragment,{children:"0"})},U="_actions_1hh74_1",Y="_link_1hh74_5",J="_instanceCount_1hh74_9",K={actions:U,link:Y,instanceCount:J},Q=a=>{const n={};switch(a.column.id){case"title":n.role="rowheader";break;case"name":n["aria-label"]="Name";break;case"instancesCount":n["aria-label"]="Instances count";break;case"parent":n["aria-label"]="Parent";break;case"id":n["aria-label"]="Actions";break}return n},A=(a,n)=>{const s=n.find(o=>o.name===a);return s&&s.parent?[s,...A(s.parent,n)]:s?[s]:[]},y=(a,n)=>n.filter(s=>s.parent===a).map(s=>({...s,instancesCount:0,subRows:y(s.name,n)})),W=({accessGroups:a})=>{const{groupBy:n,search:s}=C(),{removeAccessGroupQuery:o}=b(),c=L(),{mutateAsync:u,isPending:p}=o,v=d.useMemo(()=>{const t=s?a.filter(r=>r.name.toLowerCase().includes(s.toLowerCase())||r.title.toLowerCase().includes(s.toLowerCase())):a;if(n!=="parent")return t.map(r=>({...r,instancesCount:0}));const l=Array.from(new Set([...t,...t.flatMap(r=>A(r.parent||"",a))])),m=new Set(l.filter(r=>r.parent).map(r=>r.name));return l.filter(r=>!m.has(r.name)).map(r=>({...r,instancesCount:0,subRows:y(r.name,l)}))},[a,s,n]),P=async t=>{try{await u({name:t})}catch(l){c(l)}},k=d.useMemo(()=>[{accessor:"title",Header:"title",Cell:({row:t})=>e.jsx("div",{style:{paddingLeft:`${t.depth*1.25}rem`},children:e.jsx("span",{children:t.original.title})})},{accessor:"name",Header:"name"},{accessor:"instancesCount",Header:"affected instances",sortType:(t,l)=>t.original.instancesCount-l.original.instancesCount,Cell:({row:t})=>e.jsx(z,{accessGroup:t.original})},{accessor:"parent",Header:"parent",Cell:({row:{original:t}})=>{var m;return((m=a.find(r=>r.name===t.parent))==null?void 0:m.title)||e.jsx(B,{})}},{accessor:"id",className:K.actions,Cell:({row:t})=>t.original.name==="global"?null:e.jsx("div",{className:"divided-blocks",children:e.jsx("div",{className:"divided-blocks__item",children:e.jsx(i.ConfirmationButton,{className:"u-no-margin--bottom u-no-padding--left is-small has-icon",type:"button",appearance:"base","aria-label":`Remove ${t.original.name} access group`,confirmationModalProps:{title:`Deleting ${t.original.name} access group`,children:e.jsx("p",{children:"Are you sure?"}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:p,confirmButtonLoading:p,onConfirm:()=>P(t.original.name)},children:e.jsx(i.Tooltip,{position:"btm-center",message:"Delete",children:e.jsx(i.Icon,{name:i.ICONS.delete})})})})})}],[n,a]);return e.jsx(i.ModularTable,{columns:k,data:v,sortable:!0,getCellProps:Q,emptyMsg:"No access groups found according to your search parameters."})},X=d.lazy(()=>j(()=>import("./index-dNxYUV5O.js").then(a=>a.i),__vite__mapDeps([0,1,2,3,4,5,6,7]))),Z=()=>{const{getAccessGroupQuery:a}=b(),{setSidePanelContent:n}=_(),{data:s,isPending:o}=a(),c=(s==null?void 0:s.data)||[],u=()=>{n("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(X,{})}))};return e.jsxs(e.Fragment,{children:[o&&e.jsx(g,{}),!o&&c.length===0&&e.jsx(w,{title:"No access groups found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any access groups yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/access-groups",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage access groups in Landscape"})]}),cta:[e.jsx(i.Button,{appearance:"positive",onClick:u,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),!o&&c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(O,{}),e.jsx(W,{accessGroups:c})]})]})},ee="_header_116wp_1",se={header:ee},ae=d.lazy(()=>j(()=>import("./index-dNxYUV5O.js").then(a=>a.a),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(a=>({default:a.NewAccessGroupForm}))),ne=()=>{const{setSidePanelContent:a}=_(),n=()=>{a("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(ae,{})}))};return e.jsxs(F,{children:[e.jsx(G,{className:se.header,title:"Access groups",actions:[e.jsx(i.Button,{appearance:"positive",onClick:n,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),e.jsx($,{children:e.jsx(Z,{})})]})},xe=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"}));export{Z as A,he as I,ge as V,xe as i};
