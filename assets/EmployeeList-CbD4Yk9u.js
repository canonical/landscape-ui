const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DI4CS8sY.js","assets/index-C40vj3jc.js","assets/index-DBjrXwEZ.css","assets/helpers-BcOwy06v.js","assets/helpers-BCOHq6Ei.js","assets/InstancesPageActions-oeVMOh1O.js","assets/useInstances-C3cp7Emr.js","assets/InstancesPageActions-CswnIe9I.css","assets/helpers-1SmgROkh.css","assets/TruncatedCell-DnFZliDQ.js","assets/TruncatedCell-CoXbu3VM.css","assets/index-Cacomp35.css"])))=>i.map(i=>d[i]);
import{i as v,f as T,g as E,c as A,h as D,z as F,j as t,m as r,A as S,r as p,l as L,o as z,_ as P,ap as M,L as b,N as y}from"./index-C40vj3jc.js";import{T as j}from"./TruncatedCell-DnFZliDQ.js";const $=()=>{const e=v(),n=T(),{mutateAsync:s,isPending:o}=E({mutationKey:["employee","patch"],mutationFn:async({id:l,...a})=>e.patch(`employees/${l}`,a),onSuccess:async()=>n.invalidateQueries({queryKey:["employee"]})});return{patchEmployee:s,isPending:o}},N={listenToUrlParams:!0},R=e=>{switch(e){case"active":return!0;case"inactive":return!1;default:return}},he=(e,n,s={})=>{var x,_;const o=v(),{autoinstallFiles:l,currentPage:a,employeeGroups:m,pageSize:h,search:i,status:u}=A();e={...N,...e};const c={...e.listenToUrlParams?{with_autoinstall_file:!0,with_computers:!0,with_groups:!0,is_active:R(u),employee_group_ids:m.length>0?m:void 0,autoinstall_file_ids:l.length>0?l:void 0,limit:h,offset:(a-1)*h,search:i??void 0}:n},{data:d,isPending:I,isFetching:C}=D({queryKey:["employees",c,e],queryFn:async()=>o.get("employees",{params:c}),...s});return{employees:((x=d==null?void 0:d.data)==null?void 0:x.results)||[],isPending:I,isFetching:C,count:(_=d==null?void 0:d.data)==null?void 0:_.count}},k=()=>{const e=v(),n=T(),{mutateAsync:s,isPending:o}=E({mutationKey:["employee","patch"],mutationFn:async({id:l,...a})=>e.post(`employees/${l}/offboard`,a),onSuccess:async()=>n.invalidateQueries({queryKey:["employee"]})});return{deactivateEmployee:s,isDeactivating:o}},O=({employee:e,handleClose:n})=>{const{notify:s}=F(),{patchEmployee:o,isPending:l}=$(),a=async()=>{await o({id:e.id,is_active:!0}),s.success({title:`You have successfully activated ${e.name}`,message:`${e.name} will be able to log in to Landscape and register new instances with their account.`}),n()};return t.jsx(r.ConfirmationModal,{confirmButtonLabel:"Activate",onConfirm:a,confirmButtonAppearance:"positive",title:`Activate ${e.name}`,close:n,confirmButtonDisabled:l,confirmButtonLoading:l,children:t.jsxs("p",{children:["This will allow ",e.name," to log in to Landscape and register new instances with their account."]})})},q="Irreversibly deletes all data on disks of associated instances. Proceed with caution",B="This will remove all instances associated with this Employee from Landscape.",H={sanitizationConfirmationText:"",sanitizeInstances:!1,removeFromLandscapeConfirmationText:"",removeFromLandscape:!1},V="_title_1azx9_1",G="_tooltipPositionElement_1azx9_5",K="_additionalActionContainer_1azx9_9",g={title:V,tooltipPositionElement:G,additionalActionContainer:K},Y=(e,n)=>n.removeFromLandscape&&n.sanitizeInstances?`Off-board ${e}`:`Deactivate ${e}`,Q=e=>e.removeFromLandscape&&e.sanitizeInstances?"Off-board":e.removeFromLandscape?"Deactivate and remove":e.sanitizeInstances?"Deactivate and sanitize":"Deactivate",U=e=>!!(e.sanitizeInstances&&e.sanitizationConfirmationText!=="sanitize instances"||e.removeFromLandscape&&e.removeFromLandscapeConfirmationText!=="remove instances"||e.sanitizeInstances&&e.removeFromLandscape&&e.sanitizationConfirmationText!=="sanitize instances"&&e.removeFromLandscapeConfirmationText!=="remove instances"),W=(e,n,s)=>n&&s?{notificationTitle:`You have successfully deactivated ${e} and initiated both Sanitization and Removal of their instances`,notificationMessage:"Sanitization and removal of this employee’s instances have been queued. The data will be permanently irrecoverable once complete. To manage the instances again, they will need to be re-registered in Landscape."}:n?{notificationTitle:`You have successfully deactivated ${e} and initiated sanitization of their instances`,notificationMessage:`Sanitization of the ${e}’s instances has been queued in Activities. The data will be permanently irrecoverable once complete.`}:s?{notificationTitle:`You have successfully deactivated ${e} and initiated the Removal of their instances`,notificationMessage:"The removal of this employee’s instances has been queued. This process will delete all stored data. To manage them again, they will need to be re-registered in Landscape."}:{notificationTitle:`You have successfully deactivated ${e}`,notificationMessage:"This employee won’t be able to log in to Landscape or register new instances with their account."},Z=({employee:e,handleClose:n})=>{const{notify:s}=F(),{deactivateEmployee:o,isDeactivating:l}=k(),a=S({initialValues:H,enableReinitialize:!0,onSubmit:async m=>{if(m.sanitizeInstances&&m.sanitizationConfirmationText!=="sanitize instances"||m.removeFromLandscape&&m.removeFromLandscapeConfirmationText!=="remove instances")return;await o({id:e.id,remove_instances:a.values.removeFromLandscape,sanitize_instances:a.values.sanitizeInstances}),a.resetForm(),n();const{notificationMessage:h,notificationTitle:i}=W(e.name,a.values.sanitizeInstances,a.values.removeFromLandscape);s.success({title:i,message:h})}});return t.jsx(r.ConfirmationModal,{title:Y(e.name,a.values),confirmButtonLabel:Q(a.values),confirmButtonProps:{type:"submit"},onConfirm:()=>{a.handleSubmit()},close:n,confirmButtonDisabled:U(a.values)||l,confirmButtonLoading:l,children:t.jsxs(r.Form,{noValidate:!0,onSubmit:m=>{m.preventDefault(),a.handleSubmit()},children:[t.jsxs("p",{children:["This will prevent ",e.name," from logging in to Landscape and from registering any new instances with their account"]}),t.jsx("b",{children:"Additional actions"}),t.jsxs("div",{children:[t.jsx(r.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:g.title,children:"Sanitize associated instances"}),t.jsxs(r.Tooltip,{position:"top-center",message:q,positionElementClassName:g.tooltipPositionElement,children:[t.jsx(r.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...a.getFieldProps("sanitizeInstances"),onChange:async m=>{a.getFieldProps("sanitizeInstances").onChange(m),await a.setFieldValue("sanitizationConfirmationText","")}}),a.values.sanitizeInstances&&t.jsxs("div",{className:g.additionalActionContainer,children:[t.jsx("p",{children:"Sanitization will permanently delete the encryption keys for associated instances, making its data completely irrecoverable. This action cannot be undone. Please confirm you wish to proceed."}),t.jsx(r.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"sanitize instances"})," to confirm"]}),"aria-label":"Sanitization confirmation text",placeholder:"sanitize instances",autoComplete:"off",type:"text",...a.getFieldProps("sanitizationConfirmationText")},"sanitizationConfirmationText")]}),t.jsx(r.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:g.title,children:"Remove associated instances from Landscape"}),t.jsxs(r.Tooltip,{position:"top-center",message:B,positionElementClassName:g.tooltipPositionElement,children:[t.jsx(r.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...a.getFieldProps("removeFromLandscape"),onChange:async m=>{a.getFieldProps("removeFromLandscape").onChange(m),await a.setFieldValue("removeFromLandscapeConfirmationText","")}}),a.values.removeFromLandscape&&t.jsxs("div",{className:g.additionalActionContainer,children:[t.jsx("p",{children:"This will remove all associated instances from Landscape, along with their stored data. To manage them again, you would need to re-register them in Landscape."}),t.jsx(r.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"remove instances"})," to confirm."]}),placeholder:"remove instances",autoComplete:"off","aria-label":"Remove from Landscape confirmation text",type:"text",...a.getFieldProps("removeFromLandscapeConfirmationText")},"removeFromLandscapeConfirmationText")]})]})]})})},J=e=>e.employee.is_active?t.jsx(Z,{...e}):t.jsx(O,{...e}),X="_toggleButton_bnzrt_1",ee="_menu_bnzrt_6",w={toggleButton:X,menu:ee},te=p.lazy(async()=>P(()=>import("./index-DI4CS8sY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),se=({employee:e})=>{const[n,s]=p.useState(!1),{setSidePanelContent:o}=L(),l=()=>{s(!0)},a=p.useCallback(()=>{s(!1)},[]),m=()=>{o("Employee details",t.jsx(p.Suspense,{fallback:t.jsx(z,{}),children:t.jsx(te,{employee:e})}),"medium")},h=[{children:t.jsxs(t.Fragment,{children:[t.jsx(r.Icon,{name:"file"}),t.jsx("span",{children:"View details"})]}),"aria-label":`View ${e.name} employee details`,hasIcon:!0,onClick:m},{children:t.jsxs(t.Fragment,{children:[t.jsx(r.Icon,{name:e.is_active?"pause":"play"}),t.jsx("span",{children:e.is_active?"Deactivate":"Activate"})]}),"aria-label":`${e.is_active?"Deactivate":"Activate"} ${e.name}`,hasIcon:!0,onClick:l}];return t.jsxs(t.Fragment,{children:[t.jsx(r.ContextualMenu,{position:"left",className:w.menu,toggleClassName:w.toggleButton,toggleAppearance:"base",toggleLabel:t.jsx(r.Icon,{name:"contextual-menu","aria-hidden":!0}),toggleProps:{"aria-label":`${e.name} actions`},links:h}),n&&t.jsx(J,{employee:e,handleClose:a})]})},ne="_expandedCell_6nnqy_1",ae="_expandedRow_6nnqy_6",ie="_truncatedItem_6nnqy_11",oe="_actions_6nnqy_18",ce="_autoinstallFileHeaderTitle_6nnqy_26",f={expandedCell:ne,expandedRow:ae,truncatedItem:ie,actions:oe,autoinstallFileHeaderTitle:ce},re=e=>({index:n})=>{const s={};return((e==null?void 0:e.column)==="computers"||(e==null?void 0:e.column)==="groups")&&e.row===n&&(s.className=f.expandedRow),s},le=e=>({column:n,row:{index:s}})=>{const o={};return n.id==="computers"?(o["aria-label"]="Associated instances",(e==null?void 0:e.column)===n.id&&e.row===s&&(o.className=f.expandedCell)):n.id==="groups"?(o["aria-label"]="Employee group",(e==null?void 0:e.column)===n.id&&e.row===s&&(o.className=f.expandedCell)):n.id==="name"?o.role="rowheader":n.id==="email"?o["aria-label"]="Email":n.id==="status"?o["aria-label"]="Status":n.id==="autoinstall_file"?o["aria-label"]="Assigned autoinstall file":n.id==="actions"&&(o["aria-label"]="Actions"),o},me=e=>n=>{n&&(e.current=[...n.querySelectorAll("tbody tr")])},ue=p.lazy(async()=>P(()=>import("./index-DI4CS8sY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),fe=({employees:e})=>{const{setSidePanelContent:n}=L(),[s,o]=p.useState(null),l=p.useRef([]);M((s==null?void 0:s.column)==="computers"||(s==null?void 0:s.column)==="groups"?{current:l.current[s.row]}:[],i=>{i.target instanceof Element&&!i.target.closest(`.${f.truncatedItem}`)&&o(null)});const a=(i,u)=>{o(c=>(c==null?void 0:c.column)===i&&c.row===u?null:{column:i,row:c&&["computers","groups"].includes(c.column)&&c.row<u?u-1:u})},m=i=>{n("Employee details",t.jsx(p.Suspense,{fallback:t.jsx(z,{}),children:t.jsx(ue,{employee:i})}),"medium")},h=p.useMemo(()=>[{accessor:"name",Header:"name",Cell:({row:{original:i}})=>t.jsx(r.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{m(i)},"aria-label":`Show details of user ${i.name}`,children:i.name})},{accessor:"email",Header:"email"},{accessor:"groups",Header:"employee group",Cell:({row:{original:i,index:u}})=>i.groups&&i.groups.length>0?t.jsx(j,{content:i.groups.map(c=>t.jsx(b,{to:`/settings/employees?tab=employee-groups&search=${c.name}`,className:f.truncatedItem,children:c.name},c.group_id)),isExpanded:(s==null?void 0:s.column)==="groups"&&s.row===u,onExpand:()=>{a("groups",u)}}):t.jsx(y,{})},{accessor:"autoinstall_file",Header:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:f.autoinstallFileHeaderTitle,children:"assigned autoinstall file"}),t.jsx(r.Tooltip,{message:"This configuration file is assigned based on the highest-priority group the user belongs to.",children:t.jsx(r.Icon,{name:"help"})})]}),Cell:({row:{original:i}})=>{var u,c;return(u=i.autoinstall_file)!=null&&u.filename?t.jsx("span",{children:(c=i.autoinstall_file)==null?void 0:c.filename}):t.jsx(y,{})}},{accessor:"status",Header:"status",Cell:({row:{original:i}})=>t.jsx("span",{children:i.is_active?"active":"inactive"}),getCellIcon:({row:{original:{is_active:i}}})=>i?"status-succeeded-small":"status-failed-small"},{accessor:"computers",Header:"associated instances",Cell:({row:{original:i,index:u}})=>{var c;return i.computers&&i.computers.length>0?t.jsx(j,{content:(c=i.computers)==null?void 0:c.map(d=>t.jsx(b,{className:f.truncatedItem,to:`/instances/${d.id}`,children:d.title},d.id)),isExpanded:(s==null?void 0:s.column)==="computers"&&s.row===u,onExpand:()=>{a("computers",u)}}):t.jsx(y,{})}},{accessor:"actions",className:f.actions,Header:"actions",Cell:({row:{original:i}})=>t.jsx(se,{employee:i})}],[e,s]);return t.jsx("div",{ref:me(l),children:t.jsx(r.ModularTable,{columns:h,data:e,getCellProps:le(s),getRowProps:re(s),emptyMsg:"No employees found according to your search parameters."})})};export{fe as E,J as a,he as u};
