const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BZbXIrNG.js","assets/index-CDk-Jgvr.js","assets/index-B4xaleMR.css","assets/AssociationBlock-CvS248qk.js","assets/MultiSelectField-U-nhLr2F.js","assets/MultiSelectField-CD3NDVCz.css","assets/useGetTags-B8yNd7a1.js","assets/AssociationBlock-vsPH8fvb.css","assets/SidePanelFormButtons-CsUGQk2E.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/useRoles-BvJMVkR7.js","assets/FileInput-BSqQmDBz.js","assets/useGetInstances-B7Kg5hSx.js","assets/HeaderWithSearch-lC_PsP2p.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SidePanelTablePagination-ByE4BkY1.js","assets/TextConfirmationModal-BxLh3OQM.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/PageMain-Docc5lp9.js","assets/PageMain-CIunaku7.css","assets/constants-DRKgEQ0k.js","assets/constants-BR1biRXO.js","assets/index-fxcmzX1J.css"])))=>i.map(i=>d[i]);
import{g as N,b as $,f as D,h as p,i as b,v as h,a5 as I,x as i,I as C,y as E,w as m,ak as F,j as a,au as w,S as Q,C as q,am as V,o as M,p as H,k as j,Z as K,ap as U,aA as z,l as u,ay as B,d as P,aB as W,aq as G,E as Y,A as Z,m as J,a7 as g,_}from"./index-CDk-Jgvr.js";import{P as X,a as ee,b as ae}from"./PageMain-Docc5lp9.js";import{H as se}from"./HeaderWithSearch-lC_PsP2p.js";import{L as te}from"./constants-DRKgEQ0k.js";import{L as ne}from"./constants-BR1biRXO.js";import{u as ie}from"./useRoles-BvJMVkR7.js";import{T as re}from"./TextConfirmationModal-BxLh3OQM.js";function O(){const e=N(),s=$(),c=D(),r=(t={},o={})=>b({queryKey:["packageProfiles",t],queryFn:async({signal:l})=>s.get("packageprofiles",{params:t,signal:l}),...o}),d=p({mutationFn:async t=>s.post("packageprofiles",t),onSuccess:async()=>e.invalidateQueries({queryKey:["packageProfiles"]})}),v=p({mutationFn:async t=>s.post("packageprofiles",t),onSuccess:async()=>e.invalidateQueries({queryKey:["packageProfiles"]})}),x=p({mutationFn:async t=>c.get("RemovePackageProfile",{params:t}),onSuccess:async()=>e.invalidateQueries({queryKey:["packageProfiles"]})}),f=p({mutationFn:async({name:t,...o})=>s.put(`packageprofiles/${t}`,o),onSuccess:async()=>e.invalidateQueries({queryKey:["packageProfiles"]})}),y=({instanceId:t,...o},l={})=>b({queryKey:["instancePackageProfiles",{instanceId:t,...o}],queryFn:async()=>s.get(`computers/${t}/packages/profile`,{params:o}),...l}),k=({name:t,...o},l={})=>b({queryKey:["packageProfileConstraints",{name:t,...o}],queryFn:async()=>s.get(`packageprofiles/${t}/constraints`,{params:o}),...l}),A=p({mutationFn:async({name:t,...o})=>s.post(`packageprofiles/${t}/constraints`,o),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["packageProfiles"]}),e.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),T=p({mutationFn:async({id:t,name:o,...l})=>s.put(`packageprofiles/${o}/constraints/${t}`,l),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["packageProfiles"]}),e.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),n=p({mutationFn:async({name:t,...o})=>s.delete(`packageprofiles/${t}/constraints`,{params:o}),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["packageProfiles"]}),e.invalidateQueries({queryKey:["packageProfileConstraints"]})])});return{addPackageProfileConstraintsQuery:A,copyPackageProfileQuery:d,createPackageProfileQuery:v,editPackageProfileConstraintQuery:T,editPackageProfileQuery:f,getInstancePackageProfileQuery:y,getPackageProfileConstraintsQuery:k,getPackageProfilesQuery:r,removePackageProfileConstraintsQuery:n,removePackageProfileQuery:x}}const R={constraint:"",notAnyVersion:!1,package:"",rule:"",version:""},Re=Object.fromEntries(Object.keys(R).map(e=>[e,!0])),Le={constraint:"",id:0,package:"loading",rule:"",version:"",notAnyVersion:!1},Ne=[{label:"Any",value:""},{label:"Newer or equal to",value:">="},{label:"Newer than",value:">"},{label:"Equal to",value:"="},{label:"Older than",value:"<"},{label:"Older or equal to",value:"<="}],$e=[{label:"Select",value:""},{label:"Conflicts with",value:"conflicts"},{label:"Depends on",value:"depends"}],De={access_group:I,all_computers:!1,constraints:[R],constraintsType:"",csvFile:null,description:"",isCsvFileParsed:!1,material:"",source_computer_id:0,tags:[],title:""},Fe=h().shape({access_group:i(),all_computers:m(),constraints:C().when("constraintsType",{is:"manual",then:e=>e.of(h().shape({constraint:i().required("Required."),notAnyVersion:m(),package:i().required("Required."),rule:i().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")}),version:i().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")})})).min(1,"Package profiles must have at least one package constraint.")}),constraintsType:i().required("This field is required."),csvFile:F().nullable().test({name:"mime-type",message:"Invalid file type.",test:e=>!e||e.type==="text/csv"}).when("constraintsType",{is:"material",then:e=>e.required("This field is required.")}),description:i().required("This field is required."),isCsvFileParsed:m(),material:i().when("constraintsType",{is:"material",then:e=>e.required("The file cannot be empty.")}),source_computer_id:E().when("constraintsType",{is:"instance",then:e=>e.min(1,"This field is required.")}),tags:C().of(i()),title:i().required("This field is required.")}),Qe=h().shape({constraints:C().of(h().shape({constraint:i().required("Required."),notAnyVersion:m(),package:i().required("Required."),rule:i().when("notAnyVersion",{is:!0,then:e=>e.required("Required.")}),version:i().when("notAnyVersion",{is:!0,then:e=>e.required("Required.")})})).min(1,"Package profiles must have at least one package constraint.")}),Ve={constraint:"",id:0,notAnyVersion:!1,package:"",rule:"",version:""},Me=h().shape({constraint:i().required("Required."),id:E(),notAnyVersion:m(),package:i().required("Required."),rule:i().when("notAnyVersion",{is:!0,then:e=>e.required("Required.")}),version:i().when("notAnyVersion",(e,s)=>e[0]?s.required("Required."):s)}),oe=({packageProfile:e})=>!e.tags.length&&!e.all_computers?a.jsx(w,{}):e.computers.constrained.length?a.jsxs(Q,{to:{pathname:"/instances",search:`query=${encodeURIComponent(`profile:package:${e.id}`)}`},children:[e.computers.constrained.length," ",q(e.computers.constrained.length,"instance")]}):"0 instances",He={access_group:I,all_computers:!1,description:"",tags:[],title:""},Ke=h().shape({access_group:i(),all_computers:m(),description:i(),tags:C().of(i()),title:i()}),Ue=h().shape({all_computers:m(),description:i(),tags:C().of(i()),title:i().required("This field is required")}),ce=()=>a.jsxs(a.Fragment,{children:[a.jsx(se,{}),a.jsx(V,{filtersToDisplay:["search"]})]}),le=({profile:e})=>{const s=M(),{notify:c}=H(),{setPageParams:r}=j(),{removePackageProfileQuery:d}=O(),{value:v,setTrue:x,setFalse:f}=K(),{mutateAsync:y,isPending:k}=d,A=()=>{r({sidePath:["edit-constraints"],profile:e.name})},T=()=>{r({sidePath:["edit"],profile:e.name})},n=()=>{r({sidePath:["duplicate"],profile:e.name})},t=async()=>{try{await y({name:e.name}),c.success({message:`Package profile "${e.title}" removed successfully`,title:"Package profile removed"})}catch(L){s(L)}finally{f()}},o=[{icon:"edit",label:"Edit","aria-label":`Edit ${e.title} profile`,onClick:T},{icon:"applications",label:"Change package constraints","aria-label":`Change ${e.title} package constraints`,onClick:A},{icon:"canvas",label:"Duplicate","aria-label":`Duplicate ${e.title} profile`,onClick:n}],l=[{icon:"delete",label:"Remove","aria-label":`Remove ${e.title} profile`,onClick:x}];return a.jsxs(a.Fragment,{children:[a.jsx(U,{toggleAriaLabel:`${e.title} profile actions`,actions:o,destructiveActions:l}),a.jsx(re,{isOpen:v,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:k,confirmButtonDisabled:k,close:f,confirmationText:`remove ${e.title}`,onConfirm:t,children:a.jsxs("p",{children:['This will remove "',e.title,'" profile. This action is'," ",a.jsx("b",{children:"irreversible"}),"."]})})]})},de=`These instances are not compliant
with the profile. They do not have a
pending activity to become compliant.`,ue=`These instances are not compliant
with the profile. They do have a
pending activity to apply its
constraints.`,pe=e=>({column:s,row:{index:c}})=>{const r={};switch(s.id){case"title":r.role="rowheader";break;case"description":r["aria-label"]="Description";break;case"access_group":r["aria-label"]="Access group";break;case"tags":r["aria-label"]="Tags",e===c&&(r.className="expandedCell");break;case"computers['non-compliant']":r["aria-label"]="Not compliant instances";break;case"computers['pending']":r["aria-label"]="Pending instances";break;case"computers['constrained']":r["aria-label"]="Associated instances";break;case"actions":r["aria-label"]="Actions";break}return r},ge=e=>({index:s,original:c})=>{const r={};return e===s&&(r.className="expandedRow"),r["aria-label"]=`${c.title} package profile row`,r},Pe="_description_y3fly_1",me="_noWrap_y3fly_2",S={description:Pe,noWrap:me},he=({packageProfiles:e})=>{const{search:s,setPageParams:c}=j(),{getAccessGroupQuery:r}=ie(),{expandedRowIndex:d,handleExpand:v,getTableRowsRef:x}=z(),{data:f}=r(),y=f?.data.map(({name:n,title:t})=>({label:t,value:n}))??[],k=n=>{c({sidePath:["view"],profile:n.name})},A=u.useMemo(()=>s?e.filter(n=>n.title.toLowerCase().includes(s.toLowerCase())):e,[e,s]),T=u.useMemo(()=>[{...ne,Cell:({row:{original:n}})=>a.jsxs(B,{children:[a.jsx(P.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{k(n)},children:n.title}),a.jsx("span",{className:"u-text--muted",children:n.name})]})},{accessor:"description",className:S.description,Header:"Description"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:{access_group:n}}})=>y.find(({value:t})=>t===n)?.label??n},{accessor:"tags",Header:"Tags",Cell:({row:{original:{tags:n},index:t}})=>n.length>0?a.jsx(W,{content:n.map(o=>a.jsx("span",{className:"truncatedItem",children:o},o)),isExpanded:t==d,onExpand:()=>{v(t)},showCount:!0}):a.jsx(w,{})},{accessor:"computers['non-compliant']",Header:a.jsxs("div",{className:S.noWrap,children:[a.jsx("span",{children:"Not compliant "}),a.jsx(P.Tooltip,{position:"btm-left",message:de,children:a.jsx(P.Icon,{name:"help"})})]}),Cell:({row:{original:n}})=>a.jsx(a.Fragment,{children:`${n.computers["non-compliant"].length} ${q(n.computers["non-compliant"].length,"instance")}`})},{accessor:"computers['pending']",Header:a.jsxs("div",{className:S.noWrap,children:[a.jsx("span",{children:"Pending "}),a.jsx(P.Tooltip,{position:"btm-left",message:ue,children:a.jsx(P.Icon,{name:"help"})})]}),Cell:({row:{original:n}})=>a.jsx(a.Fragment,{children:`${n.computers.pending?.length??0} ${q(n.computers.pending.length,"instance")}`})},{accessor:"computers['constrained']",Header:"Associated",Cell:({row:{original:n}})=>a.jsx(oe,{packageProfile:n})},{...te,Cell:({row:{original:n}})=>a.jsx(le,{profile:n})}],[y.length,d]);return a.jsx("div",{ref:x,children:a.jsx(G,{columns:T,data:A,emptyMsg:`No package profiles found with the search "${s}"`,getCellProps:pe(d),getRowProps:ge(d),minWidth:1200})})},fe=()=>{const{setPageParams:e}=j(),s=()=>{e({sidePath:["add"]})};return a.jsx(Y,{body:a.jsxs(a.Fragment,{children:[a.jsx("p",{children:"You haven’t added any package profiles yet."}),a.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-packages",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage packages in Landscape"})]}),cta:[a.jsx(P.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add")],title:"No package profiles found"})},ye=({packageProfiles:e=[]})=>a.jsxs(a.Fragment,{children:[a.jsx(ce,{}),a.jsx(he,{packageProfiles:e})]}),ke=()=>{const{getPackageProfilesQuery:e}=O(),{data:s,isLoading:c}=e();return a.jsxs(a.Fragment,{children:[c&&a.jsx(Z,{}),!c&&(!s||s.data.result.length===0)&&a.jsx(fe,{}),!c&&s&&s.data.result.length>0&&a.jsx(ye,{packageProfiles:s?.data.result})]})},_e=u.lazy(async()=>_(()=>import("./index-BZbXIrNG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(e=>({default:e.PackageProfileAddSidePanel}))),ve=u.lazy(async()=>_(()=>import("./index-BZbXIrNG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(e=>({default:e.PackageProfileConstraintsAddSidePanel}))),xe=u.lazy(async()=>_(()=>import("./index-BZbXIrNG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(e=>({default:e.PackageProfileConstraintsEditSidePanel}))),Ae=u.lazy(async()=>_(()=>import("./index-BZbXIrNG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(e=>({default:e.PackageProfileDetailsSidePanel}))),Te=u.lazy(async()=>_(()=>import("./index-BZbXIrNG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(e=>({default:e.PackageProfileDuplicateSidePanel}))),Ce=u.lazy(async()=>_(()=>import("./index-BZbXIrNG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(e=>({default:e.PackageProfileEditSidePanel}))),je=()=>{const{sidePath:e,lastSidePathSegment:s,setPageParams:c}=j();J("sidePath",["add","add-constraints","duplicate","edit","edit-constraints","view"]);const r=()=>{c({sidePath:["add"],profile:""})};return a.jsxs(X,{children:[a.jsx(ee,{title:"Package profiles",actions:[a.jsx(P.Button,{type:"button",appearance:"positive",onClick:r,children:"Add package profile"},"add-package-profile")]}),a.jsx(ae,{children:a.jsx(ke,{})}),a.jsxs(g,{onClose:()=>{c({sidePath:[],profile:""})},isOpen:!!e.length,size:["add","add-constraints","edit-constraints","view"].includes(s)?"medium":void 0,children:[s==="add"&&a.jsx(g.Suspense,{children:a.jsx(_e,{})},"add"),s==="add-constraints"&&a.jsx(g.Suspense,{children:a.jsx(ve,{})},"add-constraints"),s==="duplicate"&&a.jsx(g.Suspense,{children:a.jsx(Te,{})},"duplicate"),s==="edit"&&a.jsx(g.Suspense,{children:a.jsx(Ce,{})},"edit"),s==="edit-constraints"&&a.jsx(g.Suspense,{children:a.jsx(xe,{})},"edit-constraints"),s==="view"&&a.jsx(g.Suspense,{children:a.jsx(Ae,{})},"view")]})]})},ze=Object.freeze(Object.defineProperty({__proto__:null,default:je},Symbol.toStringTag,{value:"Module"}));export{$e as C,R as E,De as I,Le as L,oe as P,Re as T,Fe as V,Ne as a,Qe as b,Me as c,Ve as d,Ke as e,He as f,Ue as g,ce as h,he as i,fe as j,ze as k,O as u};
