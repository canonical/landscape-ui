import{A as B,B as $,k as F,r as u,j as a,n as c,p as D,x as E}from"./index-CXV5jfcW.js";import{S as N}from"./SidePanelFormButtons-DZdKjurL.js";import{u as O}from"./useInstances-BTl_86ur.js";import{u as V,T as W}from"./useTaggedSecurityProfiles-CF22WUco.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./ResponsiveButtons-CK5Ccpgm.js";const J=({selected:e})=>{const x=B(),{notify:p}=$(),{closeSidePanel:T}=F(),{addTagsToInstancesQuery:b,getAllInstanceTagsQuery:j}=O(),{mutateAsync:C,isPending:g}=b,{data:d,isLoading:S}=j(),[v,m]=u.useState(!1),[r,w]=u.useState(""),[t,l]=u.useState([]),{securityProfiles:f,isSecurityProfilesLoading:L}=V(t,e),h=async()=>{var s;try{await C({query:e.map(({id:n})=>`id:${n}`).join(" OR "),tags:t}),T(),p.success({title:"Tags assigned",message:`Tags successfully assigned to ${E(e.length,`"${((s=e[0])==null?void 0:s.title)??""}" instance`,`${e.length} instances`)}`})}catch(n){x(n)}},A=async()=>{f.length?m(!0):await h()},o=(d==null?void 0:d.data.results.filter(s=>s.toLowerCase().includes(r.toLowerCase())))??[],I=()=>{o.every(s=>t.includes(s))?l([]):l(o)},M=u.useMemo(()=>[{accessor:"value",Header:a.jsxs(a.Fragment,{children:[a.jsx(c.CheckboxInput,{inline:!0,label:null,disabled:o.every(s=>e.every(n=>n.tags.includes(s))),checked:o.every(s=>t.includes(s)||e.every(n=>n.tags.includes(s))),indeterminate:o.some(s=>e.some(n=>!n.tags.includes(s)))&&o.some(s=>e.some(n=>n.tags.includes(s))),onChange:I}),"Name"]}),Cell:({row:{original:{value:s},index:n}})=>{const k=()=>{if(t.includes(s)){l(t.toSpliced(t.findIndex(i=>i==s),1));return}e.every(i=>i.tags.includes(s))||l([...t,s])};return a.jsx(c.CheckboxInput,{inline:!0,label:s,disabled:e.every(i=>i.tags.includes(s)),name:`tag-${n}`,checked:t.includes(s)||e.every(i=>i.tags.includes(s)),indeterminate:!t.includes(s)&&e.some(i=>i.tags.includes(s))&&e.some(i=>!i.tags.includes(s)),onChange:k})}}],[t,o]);if(S)return a.jsx(D,{});const y=o.map(s=>({value:s})),P=()=>{m(!1)};return a.jsxs(a.Fragment,{children:[a.jsx("p",{children:"Adding tags will associate the instance with the profiles that tag is linked to. This may change configurations on your instance."}),a.jsx(c.SearchBox,{value:r,onChange:s=>{w(s)}}),a.jsx(c.ModularTable,{emptyMsg:"No tags found",columns:M,data:[...y.filter(({value:s})=>s.toLowerCase().startsWith(r.toLowerCase())),...y.filter(({value:s})=>!s.toLowerCase().startsWith(r.toLowerCase()))]}),a.jsx(N,{onSubmit:A,submitButtonDisabled:!t.length||g||L,submitButtonText:"Assign"}),v&&a.jsx(W,{instances:e,securityProfiles:f,tags:t,onConfirm:h,confirmButtonDisabled:g,close:P})]})};export{J as default};
