import{j as e,N as A,as as S,D as E,r as g,d as r,B as M,b as R,C as z,o as Y,L as F,y as l}from"./index-DdDZs9iJ.js";import{u as O}from"./useInstances-xzL-A-Ng.js";import{u as U}from"./useRoles-BNFkLHId.js";const G=({column:{id:a},row:{original:o}})=>{const s={};return a==="title"?s.role="rowheader":a==="checkbox"?s["aria-label"]=`Toggle ${o.title} instance`:a==="hostname"?s["aria-label"]="Hostname":a==="access_group"?s["aria-label"]="Access group":a==="client_tags"?s["aria-label"]="Tags":a==="creation_time"&&(s["aria-label"]="Creation time"),s},Q=(a,o)=>{var s;return o?((s=a.find(({value:c})=>c===o))==null?void 0:s.label)??o:e.jsx(A,{})},k=a=>S(a).utc().calendar({sameElse:`${E} [UTC]`,lastWeek:"[Last] dddd, HH:mm [UTC]",sameDay:"[Today], HH:mm [UTC]",lastDay:"[Yesterday], HH:mm [UTC]"}),W="_checkbox_1jtck_1",q="_truncate_1jtck_5",j={checkbox:W,truncate:q},J=({accessGroupOptions:a,instances:o,onSelectedIdsChange:s,selectedIds:c})=>{const p=g.useMemo(()=>o,[o]),n=g.useMemo(()=>[{accessor:"checkbox",className:j.checkbox,Header:()=>e.jsx(r.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,checked:c.length===p.length,indeterminate:c.length>0&&c.length<p.length,onChange:()=>s(c.length>0?[]:p.map(({id:t})=>t))}),Cell:({row:{original:t}})=>e.jsx(r.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${t.title} instance`}),inline:!0,checked:c.includes(t.id),onChange:()=>s(c.includes(t.id)?c.filter(d=>d!==t.id):[...c,t.id])})},{accessor:"title",Header:"name"},{accessor:"hostname",Header:"Hostname"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:t}})=>Q(a,t.access_group)},{accessor:"client_tags",Header:"Tags",Cell:({row:{original:t}})=>t.client_tags.length?e.jsx(r.Tooltip,{message:t.client_tags.join(", "),positionElementClassName:j.truncate,children:t.client_tags.join(", ")}):e.jsx(A,{})},{accessor:"creation_time",Header:"Pending since",Cell:({row:{original:t}})=>e.jsx(r.Tooltip,{message:k(t.creation_time),positionElementClassName:j.truncate,children:k(t.creation_time)})}],[p,c.length]);return e.jsx(r.ModularTable,{columns:n,data:p,getCellProps:G})},K="_help_h15yn_1",V={help:K},ne=({instances:a})=>{var v;const[o,s]=g.useState(!1),[c,p]=g.useState(""),[n,t]=g.useState([]),d=M(),{user:u}=R(),{notify:b}=z(),{closeSidePanel:m,changeSidePanelSize:x}=Y(),{getAccessGroupQuery:P}=U(),{acceptPendingInstancesQuery:T,rejectPendingInstancesQuery:B}=O(),h=(v=u==null?void 0:u.accounts.find(i=>i.name===(u==null?void 0:u.current_account)))==null?void 0:v.title,$=()=>{s(!0),x("small")},H=()=>{s(!1),x("large")},{mutateAsync:I,isPending:_}=T,{mutateAsync:w,isPending:y}=B,L=async()=>{try{await w({computer_ids:n}),m(),b.success({message:`${n.length} pending ${l(n.length,"instance")} ${l(n.length,"has","have")} been rejected to add to your ${h} organization.`,title:`You have rejected ${n.length} pending ${l(n.length,"instance")}`})}catch(i){d(i)}},N=async()=>{try{await I({access_group:c,computer_ids:n}),m(),b.success({message:`${n.length} pending ${l(n.length,"instance")} ${l(n.length,"has","have")} been successfully added to your ${h} organization.`,title:`You have approved ${n.length} pending ${l(n.length,"instance")}`})}catch(i){d(i)}},{data:f}=P(),C=(f==null?void 0:f.data.map(({name:i,title:D})=>({label:D,value:i})))??[];return e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:V.help,children:[e.jsxs("span",{children:["You can automatically register new Landscape Client Instances when theyâ€™re configured using a registration key. This eliminates the need for manual approval of each computer. You can enable this feature in the"," "]}),e.jsx(F,{to:"/settings/general",children:"Org. settings"}),e.jsx("span",{children:" or "}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"learn more"})]}),o&&e.jsx(r.Select,{label:"Access group",options:C,name:"access_group",value:c,onChange:i=>{p(i.target.value)}}),!o&&e.jsx(J,{accessGroupOptions:C,instances:a,onSelectedIdsChange:i=>{t(i)},selectedIds:n}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(r.Button,{type:"button",appearance:"base",onClick:m,children:"Cancel"}),o&&e.jsxs(e.Fragment,{children:[e.jsx(r.Button,{type:"button",onClick:H,children:"Back"}),e.jsx(r.ConfirmationButton,{type:"button",appearance:"positive",disabled:n.length===0,confirmationModalProps:{title:"Approve pending instances",children:e.jsxs("p",{children:["This will approve ",n.length," selected"," ",l(n.length,"instance")," to add to your"," ",h," organization."]}),confirmButtonLabel:"Approve",confirmButtonAppearance:"positive",confirmButtonLoading:_,confirmButtonDisabled:_,onConfirm:N},children:"Approve"})]}),!o&&e.jsxs(e.Fragment,{children:[e.jsx(r.ConfirmationButton,{type:"button",appearance:"negative",disabled:n.length===0,confirmationModalProps:{title:"Reject pending instances",children:e.jsxs("p",{children:["This will reject ",n.length," selected"," ",l(n.length,"instance")," to add to your"," ",h," organization."]}),confirmButtonLabel:"Reject",confirmButtonAppearance:"negative",confirmButtonLoading:y,confirmButtonDisabled:y,onConfirm:L},children:"Reject"}),e.jsx(r.Button,{type:"button",appearance:"positive",disabled:n.length===0,onClick:$,children:"Approve"})]})]})]})};export{ne as default};
