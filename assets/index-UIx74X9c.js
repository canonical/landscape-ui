const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B7N3rgVD.js","assets/index-BMhnQnvO.js","assets/index-BPqj2aAr.css","assets/moment-C5S46NFB.js","assets/InfoItem-B9r-ZevM.js","assets/InfoItem-BbayMzTk.css","assets/useConfirm-DBWWlNvT.js","assets/useInstances-CmnK8qSQ.js","assets/useFetchOld-Cff5y19B.js","assets/useMutation-Diy-BhWO.js","assets/useQuery-Dxk6aJEc.js","assets/moment-BcE1DmV8.js","assets/TablePagination-BdWPaBG6.js","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/usePageParams-C2gko9oh.js","assets/EmptyState-ClMN1u86.js","assets/EmptyState-BNXajmMK.css","assets/SearchHelpPopup-ufAPkkhr.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/NoData-D_FYardG.js","assets/index-4jXkfcLF.css"])))=>i.map(i=>d[i]);
import{j as e,g as s,h as D,r as u,_ as F,d as Z,c as ee,f as q,k as S,J as te,e as ie,B as ne}from"./index-BMhnQnvO.js";import{m as ae}from"./moment-BcE1DmV8.js";import{T as oe}from"./TablePagination-BdWPaBG6.js";import{E as se}from"./EmptyState-ClMN1u86.js";import{S as ce}from"./SearchHelpPopup-ufAPkkhr.js";import{u as re}from"./useFetchOld-Cff5y19B.js";import{u as C}from"./useMutation-Diy-BhWO.js";import{u as w}from"./useQuery-Dxk6aJEc.js";import{u as le}from"./useConfirm-DBWWlNvT.js";import{u as R}from"./usePageParams-C2gko9oh.js";import{N as ue}from"./NoData-D_FYardG.js";const de=()=>e.jsx(se,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no activities yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage computers in Landscape"})]}),icon:"switcher-environments",title:"No activities found"}),pe="_wrapper_1qrua_1",he="_search_1qrua_9",me="_buttonContainer_1qrua_13",ve="_button_1qrua_13",ge="_icon_1qrua_43",A={wrapper:pe,search:he,buttonContainer:me,button:ve,icon:ge},ye=({inputValue:a,onDescriptionClick:t,onInputChange:c,onSearchClick:g,onClear:h})=>e.jsxs("div",{className:A.wrapper,children:[e.jsx(s.SearchBox,{autocomplete:"off",shouldRefocusAfterReset:!0,externallyControlled:!0,value:a,onChange:c,onSearch:g,onClear:h,className:D("u-no-margin--bottom",A.search)}),e.jsx("div",{className:A.buttonContainer,children:e.jsx("button",{type:"button",onClick:t,className:A.button,children:e.jsx("i",{className:D("p-icon--help",A.icon)})})})]}),_e=u.lazy(()=>F(()=>import("./index-B7N3rgVD.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])));function P(){const a=re(),t=Z(),c=ee(),{setSidePanelContent:g}=q(),h=(i={},l={})=>w({queryKey:["activities",i],queryFn:()=>t.get("activities",{params:i}),...l}),d=({activityId:i,...l},p={})=>w({queryKey:["activities",{activityId:i,...l}],queryFn:()=>t.get(`activities/${i}`,{params:l}),...p}),r=(i={},l={})=>w({queryKey:["activityTypes"],queryFn:()=>a.get("GetActivityTypes",{params:i}),...l}),y=C({mutationKey:["activities","cancel"],mutationFn:i=>a.get("CancelActivities",{params:i}),onSuccess:()=>c.invalidateQueries(["activities"])}),b=C({mutationKey:["activities","approve"],mutationFn:i=>a.get("ApproveActivities",{params:i}),onSuccess:()=>c.invalidateQueries(["activities"])}),v=C({mutationFn:i=>t.post("activities/reapply",i),onSuccess:()=>c.invalidateQueries(["activities"])}),_=C({mutationFn:i=>t.post("activities/revert",i),onSuccess:()=>c.invalidateQueries(["activities"])});return{getActivitiesQuery:h,getSingleActivityQuery:d,getActivityTypesQuery:r,cancelActivitiesQuery:y,approveActivitiesQuery:b,redoActivitiesQuery:v,undoActivitiesQuery:_,openActivityDetails:i=>{g(i.summary,e.jsx(u.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(_e,{activityId:i.id})}))}}}function be(a){const{state:t}=te(),c=t==null?void 0:t.activity;u.useEffect(()=>{t!=null&&t.activity&&(a(t.activity),window.history.replaceState({},""))},[c])}const fe="_container_honpf_1",Ae="_searchContainer_honpf_8",xe="_select_honpf_12",Ce="_cta_honpf_17",j={container:fe,searchContainer:Ae,select:xe,cta:Ce},je="_iconError_j51du_1",Se="_iconWarning_j51du_5",Te="_iconWarningRed_j51du_9",$={iconError:je,iconWarning:Se,iconWarningRed:Te},E={succeeded:{icon:"success",label:"Succeeded"},scheduled:{icon:"spinner",label:"Scheduled"},waiting:{icon:"status-waiting",label:"Waiting"},undelivered:{icon:"status-queued",label:"Queued"},delivered:{icon:"status-in-progress",label:"In progress"},blocked:{icon:`warning-grey ${$.iconWarningRed}`,label:"Blocked"},unapproved:{icon:`warning-grey ${$.iconWarning}`,label:"Unapproved"},canceled:{icon:"error-grey",label:"Cancelled"},failed:{icon:`error-grey ${$.iconError}`,label:"Failed"}},ke=[{term:"id:<activity_id>",description:"Search for activities with a specific ID."},{term:"parent-id:<parent_id>",description:"Search for children activities of a specific ID."},{term:"created-after:<date>",description:e.jsxs("span",{children:["Search for activities created after a specific date or time, specified with the ISO-8601 format. The precision depends on how far you specify, for example ",e.jsx("code",{children:"2011-01"}),", ",e.jsx("code",{children:"2011-01-01"}),","," ",e.jsx("code",{children:"2011-01-01T10:30"})," are valid values."]})},{term:"created-before:<date>",description:"Search for activities created before a specific date or time. The format is the same as created-after."},{term:"creator:<email>",description:"Search for activities created by a particular person (specified by email address)."},{term:"computer:<criteria>",description:"Search for activities related to the given instances. The criteria is itself another query argument to search instances. See Instance Queries for details."},{term:"type:<type>",description:"Search for activities of a specific type."}],Ne=[{label:"All",value:""},...Object.entries(E).filter(([a])=>a!=="unapproved").map(([a,{label:t}])=>({label:t,value:a}))],we=({resetSelectedIds:a,selectedIds:t})=>{const{search:c,status:g,setPageParams:h}=R(),d=ie(),{confirmModal:r,closeConfirmModal:y}=le(),{approveActivitiesQuery:b,cancelActivitiesQuery:v,redoActivitiesQuery:_,undoActivitiesQuery:f}=P(),[i,l]=u.useState(c),[p,x]=u.useState(!1),{mutateAsync:T,isLoading:k}=b,{mutateAsync:n,isLoading:m}=v,{mutateAsync:N,isLoading:B}=_,{mutateAsync:O,isLoading:H}=f,Q=()=>{h({search:i,status:g}),a()},M=o=>{h({status:o})},W=()=>{h({search:""})},I=o=>{o.preventDefault(),Q()},U=async()=>{try{await T({query:`id:${t.join(" OR id:")}`})}catch(o){d(o)}finally{y()}},V=()=>{r({title:`Approve ${t.length===1?"activity":"activities"}`,body:`Are you sure you want to approve selected ${t.length===1?"activity":"activities"}?`,buttons:[e.jsx(s.Button,{appearance:"positive",onClick:U,children:"Approve"},"approve")]})},z=async()=>{try{await n({query:`id:${t.join(" OR id:")}`})}catch(o){d(o)}finally{y()}},K=()=>{r({title:`Cancel ${t.length===1?"activity":"activities"}`,body:`Are you sure you want to cancel selected ${t.length===1?"activity":"activities"}?`,buttons:[e.jsx(s.Button,{appearance:"positive",onClick:z,children:"Apply"},"cancel")]})},Y=async()=>{try{await N({activity_ids:t})}catch(o){d(o)}finally{y()}},G=()=>{r({title:`Redo ${t.length===1?"activity":"activities"}`,body:`Are you sure you want to redo selected ${t.length===1?"activity":"activities"}?`,buttons:[e.jsx(s.Button,{appearance:"positive",onClick:Y,children:"Redo"},"redo")]})},J=async()=>{try{await O({activity_ids:t})}catch(o){d(o)}finally{y()}},X=()=>{r({title:`Undo ${t.length===1?"activity":"activities"}`,body:`Are you sure you want to undo selected ${t.length===1?"activity":"activities"}?`,buttons:[e.jsx(s.Button,{appearance:"positive",onClick:J,children:"Undo"},"undo")]})};return e.jsxs("div",{className:j.container,children:[e.jsxs("div",{className:j.searchContainer,children:[e.jsx(s.Form,{onSubmit:I,noValidate:!0,children:e.jsx(ye,{inputValue:i,onInputChange:o=>{l(o)},onSearchClick:Q,onDescriptionClick:()=>x(!0),onClear:W})}),e.jsx(ce,{open:p,onClose:()=>{x(!1)},data:ke})]}),e.jsx(s.Select,{label:"Status",labelClassName:"u-no-margin--bottom",wrapperClassName:j.select,className:"u-no-margin--bottom",options:Ne,onChange:o=>M(o.target.value),value:g}),e.jsx("div",{className:D("p-segmented-control",j.cta),children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsx(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:V,disabled:t.length===0||k,children:"Approve"}),e.jsx(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:K,disabled:t.length===0||m,children:"Cancel"}),e.jsx(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:X,disabled:t.length===0||H,children:"Undo"}),e.jsx(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:G,disabled:t.length===0||B,children:"Redo"})]})},"buttons")]})},$e="_checkbox_15zhq_1",De="_description_15zhq_5",L={checkbox:$e,description:De},Ee=u.lazy(()=>F(()=>import("./index-B7N3rgVD.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]))),Ue=({instanceId:a})=>{const[t,c]=u.useState([]),{search:g,status:h,currentPage:d,pageSize:r}=R(),{setSidePanelContent:y}=q(),{getActivitiesQuery:b}=P(),v=`${g}${h?` status:${h}`:""}`,_=n=>{y(n.summary,e.jsx(u.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Ee,{activityId:n.id})}))};be(_);const f=()=>{c([])},{data:i,isLoading:l}=b({query:`${a?`computer:id:${a}`:""} ${v??""}`.trim(),limit:r,offset:(d-1)*r}),p=u.useMemo(()=>(i==null?void 0:i.data.results)??[],[i]),x=()=>{c(n=>n.length?[]:p.map(({id:m})=>m))},T=n=>{c(m=>m.includes(n)?m.filter(N=>N!==n):[...m,n])},k=u.useMemo(()=>[{accessor:"checkbox",className:L.checkbox,Header:e.jsx(s.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:x,checked:p.length>0&&t.length===p.length,indeterminate:t.length>0&&t.length<p.length}),Cell:({row:n})=>e.jsx(s.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:n.original.summary}),inline:!0,labelClassName:"u-no-margin--bottom u-no-padding--top",checked:t.includes(n.original.id),onChange:()=>{T(n.original.id)}})},{accessor:"summary",className:L.description,Header:"Description",Cell:({row:n})=>e.jsx(s.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>_(n.original),children:n.original.summary})},{accessor:"activity_status",Header:"Status",Cell:({row:{original:{activity_status:n}}})=>E[n].label,getCellIcon:({row:{original:{activity_status:n}}})=>E[n].icon},{accessor:"creation_time",Header:"Created at",Cell:({row:n})=>e.jsx(e.Fragment,{children:ae(n.original.creation_time).format(ne)})},{accessor:"creator.name",Header:"Creator",Cell:({row:n})=>{var m;return e.jsx(e.Fragment,{children:((m=n.original.creator)==null?void 0:m.name)??e.jsx(ue,{})})}}],[p,t]);return e.jsxs(e.Fragment,{children:[!v&&d===1&&r===50&&l&&e.jsx(S,{}),!v&&d===1&&r===50&&!l&&(!i||!i.data.count)&&e.jsx(de,{}),(!!v||d!==1||r!==50||!l&&i&&i.data.count>0)&&e.jsxs(e.Fragment,{children:[e.jsx(we,{resetSelectedIds:f,selectedIds:t}),e.jsx(s.ModularTable,{emptyMsg:`No activities found with the search ${v}`,columns:k,data:p}),e.jsx(oe,{totalItems:i==null?void 0:i.data.count,currentItemCount:p.length,handleClearSelection:f})]})]})},Fe=u.lazy(()=>F(()=>import("./index-B7N3rgVD.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]))),Ve=a=>e.jsx(u.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Fe,{...a})});export{Ue as A,E as a,Ve as b,P as u};
