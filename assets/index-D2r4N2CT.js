import{z as A,q as L,r as N,j as s,N as j,h as o,g as h,o as P}from"./index-ChL2S0eU.js";import{P as I,a as k,b as C}from"./PageMain-DrEayV7B.js";import{d as M,s as p}from"./constants-DWkEqbMP.js";import"./moment-C5S46NFB.js";import{u as v}from"./EditUserForm-DqIzYohU.js";import{I as f}from"./InfoItem-B_e41MQz.js";import"./useFetchOld-DIiLQM9i.js";import"./NoData-9Q0i8yik.js";import"./index-CFnR-9aM.js";import"./moment-BLNajCvU.js";import"./TablePagination-DNBQxF-y.js";import"./TablePagination.module-CgQ3jx4B.js";import"./usePageParams-BCQ4b1Cy.js";import"./SearchHelpPopup-DQ_hKs0k.js";import"./SidePanelFormButtons.module-yv6Qz3cN.js";const w="_tableWrapper_1vlsl_1",B="_apiCredentials_1vlsl_10",y={"u-off-screen":"_u-off-screen_1vlsl_1",tableWrapper:w,apiCredentials:B},E=({user:i,credentials:d})=>{const t=A("(min-width: 620px)"),g=L(),{generateApiCredentials:l}=v(),{mutateAsync:u,isPending:r}=l,c=async a=>{try{await u({account:a})}catch(e){g(e)}},b=N.useMemo(()=>[{Header:"Label",accessor:"label"},{Header:"Value",accessor:"value",Cell:({value:a})=>a}],[i,d]);return i.accounts.map(a=>{const e=d.find(m=>m.account_name===a.name),x=[{label:"Name",value:e==null?void 0:e.account_name},{label:"Title",value:e==null?void 0:e.account_title},{label:"Identity",value:s.jsx("code",{children:i.identity})},{label:"Endpoint",value:s.jsx("code",{children:e==null?void 0:e.endpoint})},{label:"Access Key",value:e!=null&&e.access_key?s.jsx("code",{children:e.access_key}):j},{label:"Secret Key",value:e!=null&&e.secret_key?s.jsx("code",{children:e.secret_key}):j},{label:"Roles",value:a.roles.join(", ")}],n=e!=null&&e.secret_key||e!=null&&e.access_key?"Regenerate":"Generate";return s.jsx("div",{className:M.item,children:s.jsxs("div",{className:p.card,children:[s.jsxs("div",{className:p.header,children:[s.jsx("p",{className:p.title,children:a.title}),s.jsxs(o.ConfirmationButton,{className:h("u-no-margin--bottom",{"is-small":t}),type:"button",confirmationModalProps:{title:`${n} API credentials for ${a.title}`,children:s.jsxs("p",{children:[n==="Regenerate"?`${n.slice(0,-1)}ing your API credentials will make your previously used credentials obsolete and deauthenticate any clients using them. `:"","This action will create new credentials for integrating with the ",a.title," organisation"]}),confirmButtonLabel:`${n} API credentials`,confirmButtonDisabled:r,confirmButtonLoading:r,onConfirm:()=>c(a.name)},children:[n," API credentials"]})]}),s.jsx("div",{className:h(p.content,y.tableWrapper),children:t?s.jsx(o.ModularTable,{columns:b,data:x,emptyMsg:"No data available"}):x.map((m,_)=>s.jsxs(o.Row,{className:h("u-no-padding--left u-no-padding--right",y.apiCredentials),children:[s.jsx(o.Col,{size:2,small:2,children:s.jsx(f,{label:"",value:m.label})}),s.jsx(o.Col,{size:2,small:2,children:s.jsx(f,{label:"",value:m.value})})]},_))})]})},a.title)})},F=()=>{var e;const{getUserDetails:i,getUserApiCredentials:d}=v(),{data:t,isLoading:g}=i(),{data:l,isLoading:u}=d(),r=t==null?void 0:t.data,c=(e=l==null?void 0:l.data)==null?void 0:e.credentials,b=r&&c,a=g||u;return s.jsxs(I,{children:[s.jsx(k,{title:"API credentials"}),s.jsxs(C,{children:[a&&s.jsx(P,{}),b&&s.jsx(E,{user:r,credentials:c})]})]})};export{F as default};
