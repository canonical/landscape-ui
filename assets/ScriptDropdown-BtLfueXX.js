import{j as e,l as p,o as G,af as H,F as l,d as u,A as v}from"./index-CYddq1Dt.js";import{b as K,u as V}from"./ScriptsTabs-D11am1mG.js";import"./index-B5TEWRbk.js";import{D as P}from"./downshift.esm-DfWau1lZ.js";const Y="_container_he86t_1",$="_suggestionsContainer_he86t_6",z="_pointer_he86t_13",J="_highlighted_he86t_18",M="_selectedScript__container_he86t_22",Q="_selectedScript__name_he86t_29",W="_selectedScript__button_he86t_34",X="_selectedScript__icon_he86t_43",Z="_marginTop_he86t_47",o={container:Y,suggestionsContainer:$,pointer:z,highlighted:J,selectedScript__container:M,selectedScript__name:Q,selectedScript__button:W,selectedScript__icon:X,marginTop:Z},I=200,ee=(s,r)=>{const n=s.toLowerCase(),i=r.toLowerCase(),c=n.indexOf(i);return c>=0?e.jsxs(e.Fragment,{children:[s.substring(0,c),e.jsx("strong",{children:s.substring(c,c+r.length)}),s.substring(c+r.length)]}):s},ce=({script:s,setScript:r,existingScriptId:n,errorMessage:i,parentAccessGroup:c})=>{const[a,S]=p.useState(""),[h,d]=p.useState(!1),[_,b]=p.useState(""),{script:m,isScriptLoading:w}=K(n||0,{enabled:!!n});p.useEffect(()=>{n&&s?.id!==m?.id&&r(m)},[m]);const E=G(),{scripts:x,isScriptsLoading:g}=V({listenToUrlParams:!1},{search:a,script_type:"active",limit:20,offset:0,parent_access_group:c},{enabled:a.length>2}),y=t=>s?.id!==t.id,j=x.filter(y),L=()=>{r(null)},O=()=>{d(!1)},N=()=>{b(""),S("")},C=()=>{_.length>2?d(!0):d(!1)},B=t=>{b(t),t.length>2&&S(t)},A=H(()=>{try{C()}catch(t){E(t)}},I),F=t=>{t&&(r(t),d(!1),N())},R=t=>{t.key==="Escape"?t.currentTarget.blur():A()},T=_.length<3?"Min 3. characters":x.length===0&&a&&!g?`No scripts found by "${a}"`:n?"Scripts can't be replaced after the profile has been created.":null;return e.jsxs("div",{className:l(o.container,"p-form__group p-form-validation"),children:[e.jsx("label",{className:"is-required p-form__label",htmlFor:n?"script-selected":"script-search",children:"Script"}),!n&&e.jsx(P,{onSelect:F,itemToString:()=>"",isOpen:h,children:({getInputProps:t,getItemProps:U,getMenuProps:k,highlightedIndex:q})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(u.SearchBox,{...t(),id:n?void 0:"script-search",placeholder:"Search for scripts",required:!0,className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:_,onChange:B,onClear:N,onBlur:O,onFocus:C,onKeyUp:R}),T?e.jsx("span",{className:"p-form-help-text",children:T}):null,i&&!h?e.jsx("div",{className:"is-error",children:e.jsx("span",{className:"p-form-validation__message",id:"script-error",children:e.jsx("span",{children:i})})}):null,h&&(j.length>0||g)?e.jsx("ul",{className:l("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",o.suggestionsContainer),...k(),children:g?e.jsx(v,{}):j.map((f,D)=>e.jsx("li",{className:l("p-list__item",o.pointer,{[o.highlighted]:q===D}),...U({item:f,index:D}),children:e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:ee(f.title,a)})},f.id))}):null]})}),w?e.jsx(v,{}):null,s&&e.jsxs("div",{id:"script-selected",className:l("p-autocomplete__result p-list__item p-card u-no-margin--bottom",o.selectedScript__container,{[o.marginTop]:!n}),children:[e.jsx("span",{className:o.selectedScript__name,children:e.jsx("b",{children:s.title})}),n?null:e.jsx(u.Button,{type:"button",title:"Remove",appearance:"base",className:l(o.selectedScript__button,"u-no-margin--bottom u-no-margin--right"),onClick:L,children:e.jsx(u.Icon,{name:u.ICONS.delete,className:o.selectedScript__icon})})]},s.id)]})};export{ce as S};
