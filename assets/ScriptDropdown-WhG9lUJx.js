import{j as e,i as u,p as q,ao as G,o as i,d as c,v as D}from"./index-CNysL-N9.js";import{b as H,u as K}from"./ScriptsTabs-Bh6lIh7z.js";import"./index-DFOXV98U.js";import{D as V}from"./downshift.esm-NCfJqLaf.js";const Y="_container_h0o6i_1",$="_suggestionsContainer_h0o6i_6",z="_pointer_h0o6i_13",J="_highlighted_h0o6i_18",M="_selectedContainer_h0o6i_22",Q="_marginTop_h0o6i_30",W="_extraPadding_h0o6i_34",X="_removeButton_h0o6i_44",Z="_icon_h0o6i_48",o={container:Y,suggestionsContainer:$,pointer:z,highlighted:J,selectedContainer:M,marginTop:Q,extraPadding:W,removeButton:X,icon:Z},I=200,ee=(n,r)=>{const s=n.toLowerCase(),d=r.toLowerCase(),a=s.indexOf(d);return a>=0?e.jsxs(e.Fragment,{children:[n.substring(0,a),e.jsx("strong",{children:n.substring(a,a+r.length)}),n.substring(a+r.length)]}):n},ae=({script:n,setScript:r,existingScriptId:s,errorMessage:d,parentAccessGroup:a})=>{const[l,x]=u.useState(""),[p,h]=u.useState(!1),[g,b]=u.useState(""),{script:m,isScriptLoading:w}=H(s||0,{enabled:!!s});u.useEffect(()=>{s&&n?.id!==m?.id&&r(m)},[m]);const B=q(),{scripts:j,isScriptsLoading:_}=K({listenToUrlParams:!1},{search:l,script_type:"active",limit:20,offset:0,parent_access_group:a},{enabled:l.length>2}),E=t=>n?.id!==t.id,C=j.filter(E),y=()=>{r(null)},L=()=>{h(!1)},S=()=>{b(""),x("")},N=()=>{g.length>2?h(!0):h(!1)},O=t=>{b(t),t.length>2&&x(t)},P=G(()=>{try{N()}catch(t){B(t)}},I),R=t=>{t&&(r(t),h(!1),S())},U=t=>{t.key==="Escape"?t.currentTarget.blur():P()},v=g.length<3?"Min 3. characters":j.length===0&&l&&!_?`No scripts found by "${l}"`:s?"Scripts can't be replaced after the profile has been created.":null;return e.jsxs("div",{className:i(o.container,"p-form__group p-form-validation"),children:[e.jsx("label",{className:"is-required p-form__label",htmlFor:s?"script-selected":"script-search",children:"Script"}),!s&&e.jsx(V,{onSelect:R,itemToString:()=>"",isOpen:p,children:({getInputProps:t,getItemProps:k,getMenuProps:A,highlightedIndex:F})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(c.SearchBox,{...t(),id:s?void 0:"script-search",placeholder:"Search for scripts",required:!0,className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:g,onChange:O,onClear:S,onBlur:L,onFocus:N,onKeyUp:U}),v?e.jsx("span",{className:"p-form-help-text",children:v}):null,d&&!p?e.jsx("div",{className:"is-error",children:e.jsx("span",{className:"p-form-validation__message",id:"script-error",children:e.jsx("span",{children:d})})}):null,p&&(C.length>0||_)?e.jsx("ul",{className:i("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",o.suggestionsContainer),...A(),children:_?e.jsx(D,{}):C.map((f,T)=>e.jsx("li",{className:i("p-list__item",o.pointer,{[o.highlighted]:F===T}),...k({item:f,index:T}),children:e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:ee(f.title,l)})},f.id))}):null]})}),w?e.jsx(D,{}):null,n&&e.jsxs("div",{id:"script-selected",className:i("p-autocomplete__result p-list__item p-card u-no-margin--bottom",o.selectedContainer,{[o.marginTop]:!s,[o.extraPadding]:s}),children:[e.jsx("span",{children:e.jsx("b",{children:n.title})}),s?null:e.jsx(c.Button,{type:"button",appearance:"base",className:i(o.removeButton,"u-no-margin--bottom u-no-margin--right"),onClick:y,children:e.jsx(c.Tooltip,{message:"Remove",children:e.jsx(c.Icon,{name:c.ICONS.delete,className:o.icon})})})]},n.id)]})};export{ae as S};
