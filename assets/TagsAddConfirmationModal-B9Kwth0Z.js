import{f as m,c as P,a6 as C,r as x,w as r,j as n,d as s,e as w,a7 as c}from"./index-CNSDWj8Q.js";import{M as $}from"./ModalTablePagination-Bllm121J.js";const _=(t,i)=>{const g=m(),{data:o,isFetching:d,isPending:h,refetch:l}=P({queryKey:["profileChanges",t],queryFn:async()=>g.get("tags/profile-diff",{params:t}),...i});return{isFetchingProfileChanges:d,isPendingProfileChanges:h,profileChanges:o?.data.results??[],profileChangesCount:o?.data.count??0,refetchProfileChanges:l}},j=t=>{const i={};return i["aria-label"]=`${t.original.profile.name} profile change row`,i},b=({instances:t,tags:i,...g})=>{const{count:o,decrement:d,increment:h}=C(1),{isPendingProfileChanges:l,profileChanges:u,profileChangesCount:a}=_({instance_ids:t.map(e=>e.id),tags:i,limit:c,offset:(o-1)*c}),p=x.useMemo(()=>[i.length>1?{Header:"Tag",Cell:({row:{original:e}})=>e.tag}:null,{Header:"Active profiles",Cell:({row:{original:e}})=>e.profile.name},{Header:"Profile type",Cell:({row:{original:e}})=>({ChildInstanceProfile:"WSL",PackageProfile:"Package",RebootProfile:"Reboot",RemovalProfile:"Removal",RepositoryProfile:"Repository",ScriptProfile:"Script",UpgradeProfile:"Upgrade",UsgProfile:"Security"})[e.profile.profile_type]},{Header:"Associated instances",Cell:({row:{original:e}})=>{const f=`${e.profile.current_associated_instances} ${r(e.profile.current_associated_instances,"instance")}`;return e.profile.will_exceed_limit?n.jsxs(s.Tooltip,{message:`Adding ${r(t.length,"this instance","these instances")} will exceed the instance limit.`,children:[n.jsx(s.Icon,{name:"warning"}),f]}):f},getCellIcon:({row:{original:e}})=>e.profile.will_exceed_limit?"":null}].filter(e=>e!=null),[]);return n.jsxs(s.ConfirmationModal,{title:`Add ${r(i.length,`"${i[0]}" tag`,`${i.length} tags`)} to ${r(t.length,`"${t[0].title}"`,`${t.length} instances`)}`,confirmButtonLabel:"Add tags",...g,children:[n.jsx("p",{children:"Adding tags could trigger irreversible changes to your instances."}),n.jsxs("p",{children:["Adding"," ",r(i.length,`the ${i[0]} tag`,`these ${i.length} tags`)," ","to"," ",r(t.length,`the ${t[0].title} instance`,`${t.length} instances`)," ","will associate the ",r(t.length,"instance")," with the following profiles."]}),n.jsx("p",{children:"Some instances might not be associated with certain profiles due to restrictions."}),l&&n.jsx(w,{}),!l&&a>0&&n.jsxs(n.Fragment,{children:[n.jsx(s.ModularTable,{className:"u-no-margin--bottom",columns:p,data:u,getRowProps:j}),a>Math.ceil(a/c)&&n.jsx($,{max:Math.ceil(a/c),current:o,onPrev:d,onNext:h})]})]})};export{b as T,_ as u};
