import{r as l,_ as f,d as D,N as Z,E as J,j as e,g as k,e as r,x as b,f as q,c as F,D as X,t as ee}from"./index-DoU7Rqsb.js";import{u as A,P as te,a as se,b as ne}from"./PageMain-BPmAIdVO.js";import{u as V}from"./useDistributions-CQ_fSy6L.js";import{I as Q}from"./InfoItem-CJkV3SxW.js";import{h as H}from"./moment-Cl4UOzQZ.js";import{ACTIVITY_STATUSES as U}from"./index-QIgr8aeB.js";import{u as I}from"./useConfirm-_4TVG935.js";import{u as W}from"./useFetchOld-BmpLm9Xc.js";import{u as y}from"./useMutation-BBuufY01.js";import{u as M}from"./useQuery-BiLCfR8g.js";import{s as w,d as B}from"./DistributionCard.module-CdGw1YvC.js";import{E as ae}from"./EmptyState-CYOTcwI0.js";const oe=t=>!t||t==="synced"||t==="in progress"?"":U[t==="queued"?"undelivered":t].icon,ie="_progressContainer_qt3iv_1",re="_progress_qt3iv_1",ce="_progressBarContainer_qt3iv_11",le="_progressBar_qt3iv_11",de="_iconContainer_qt3iv_27",N={progressContainer:ie,progress:re,progressBarContainer:ce,progressBar:le,iconContainer:de},ue=l.lazy(()=>f(()=>import("./index-QIgr8aeB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20])).then(t=>({default:t.ActivityDetails}))),K=({pocket:t,syncPocketRefAdd:s,syncPocketRefs:n})=>{const p=A("(min-width: 620px)"),{setSidePanelContent:i}=D();if(l.useEffect(()=>{t.mode!=="mirror"&&t.mode!=="pull"||!t.last_sync_status||t.last_sync_status!=="in progress"||n.find(({distributionName:d})=>d===t.distribution.name)||s({distributionName:t.distribution.name,seriesName:t.series.name,pocketName:t.name})},[t,n]),t.mode==="upload")return Z;if(!t.last_sync_status)return"---";if(t.last_sync_status==="synced")return H(t.last_sync_time).format(J);if(t.last_sync_status==="in progress")return e.jsxs("div",{className:N.progressContainer,children:[p&&e.jsx("div",{className:N.progressBarContainer,children:e.jsx("div",{className:N.progressBar,style:{width:`${t.last_sync_activity.progress}%`}})}),e.jsx("span",{className:N.progress,children:`${t.last_sync_activity.progress}%`})]});const g=t.last_sync_status==="queued"?"undelivered":t.last_sync_status,u=()=>{i(t.last_sync_activity.summary,e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(ue,{activityId:t.last_sync_activity.id})}))};return e.jsxs("div",{className:k("p-table__cell--icon-placeholder",N.iconContainer),children:[e.jsx(r.Icon,{name:oe(t.last_sync_status)}),e.jsx(r.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:u,children:U[g].label})]})},me=l.lazy(()=>f(()=>import("./index-R4FX4ws0.js"),__vite__mapDeps([21,1,2,9,22,12,13,23,24,25,6,7,8,4,5,3,0,10,11,14,15,16,17,18,19,20,26,27,28]))),z=({distributionName:t,pocket:s,seriesName:n})=>{const{setSidePanelContent:p}=D(),i=()=>{p(`${n} ${s.name}`,e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(me,{distributionName:t,pocket:s,seriesName:n})}))};return e.jsxs(e.Fragment,{children:[e.jsx(r.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:i,"aria-label":`List ${s.name} pocket of ${t}/${n}`,children:s.name}),s.mode==="pull"&&e.jsx("p",{className:"p-text--small u-text--muted u-no-margin--bottom",children:`pulling from ${s.pull_pocket}`})]})};function pe(){const t=q(),s=W(),n=F(),p=y({mutationKey:["pockets","create"],mutationFn:o=>s.get("CreatePocket",{params:o}),onSuccess:()=>{t.invalidateQueries(["distributions"]).catch(n)}}),i=y({mutationKey:["pockets","edit"],mutationFn:o=>s.get("EditPocket",{params:o}),onSuccess:()=>{t.invalidateQueries(["distributions"]).catch(n)}}),g=y({mutationKey:["pockets","remove"],mutationFn:o=>s.get("RemovePocket",{params:o}),onSuccess:()=>{t.invalidateQueries(["distributions"]).catch(n)}}),u=y({mutationKey:["pocketPackages","sync"],mutationFn:o=>s.get("SyncMirrorPocket",{params:o}),onSuccess:(o,c)=>Promise.all([t.invalidateQueries(["pocketPackages",{...c}]),t.invalidateQueries(["distributions"])])}),a=y({mutationKey:["pocketPackages","pull"],mutationFn:o=>s.get("PullPackagesToPocket",{params:o}),onSuccess:(o,c)=>Promise.all([t.invalidateQueries(["pocketPackages",{...c}]),t.invalidateQueries(["distributions"])])}),d=y({mutationKey:["pocketPackages","remove"],mutationFn:o=>s.get("RemovePackagesFromPocket",{params:o}),onSuccess:(o,c)=>{t.invalidateQueries(["pocketPackages",{...c},"list"]).catch(n)}}),h=(o,c={})=>M({queryKey:["pocketPackages",{...o},"difference"],queryFn:()=>s.get("DiffPullPocket",{params:o}),...c}),j=(o,c={})=>M({queryKey:["pocketPackages",{...o},"list"],queryFn:()=>s.get("ListPocket",{params:o}),...c}),_=y({mutationKey:["packageFilters","add"],mutationFn:o=>s.get("AddPackageFiltersToPocket",{params:o}),onSuccess:(o,c)=>{t.invalidateQueries(["distributions"]).catch(n),t.invalidateQueries(["pocketPackages",{...c}]).catch(n)}}),x=y({mutationKey:["packageFilters","remove"],mutationFn:o=>s.get("RemovePackageFiltersFromPocket",{params:o}),onSuccess:(o,c)=>{t.invalidateQueries(["distributions"]).catch(n),t.invalidateQueries(["pocketPackages",{...c}]).catch(n)}}),P=y({mutationKey:["uploaderGPGKeys","add"],mutationFn:o=>s.get("AddUploaderGPGKeysToPocket",{params:o}),onSuccess:(o,c)=>{t.invalidateQueries(["distributions"]).catch(n),t.invalidateQueries(["pocketPackages",{...c}]).catch(n)}}),S=y({mutationKey:["uploaderGPGKeys","remove"],mutationFn:o=>s.get("RemoveUploaderGPGKeysFromPocket",{params:o}),onSuccess:(o,c)=>{t.invalidateQueries(["distributions"]).catch(n),t.invalidateQueries(["pocketPackages",{...c}]).catch(n)}});return{createPocketQuery:p,editPocketQuery:i,syncMirrorPocketQuery:u,pullPackagesToPocketQuery:a,diffPullPocketQuery:h,removePocketQuery:g,listPocketQuery:j,removePackagesFromPocketQuery:d,addPackageFiltersToPocketQuery:_,removePackageFiltersFromPocketQuery:x,addUploaderGPGKeysToPocketQuery:P,removeUploaderGPGKeysFromPocketQuery:S}}const ge=l.lazy(()=>f(()=>import("./EditPocketForm-DJxC9ByP.js"),__vite__mapDeps([29,1,2,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,6,7,8,23,24,25,4,5,3,0,9,10,11,12,13,14,15,16,17,18,19,20,26,27]))),O=({distributionName:t,pocket:s,seriesName:n,syncPocketRefs:p})=>{const i=A("(min-width: 620px)"),g=F(),{confirmModal:u,closeConfirmModal:a}=I(),{setSidePanelContent:d}=D(),{removePocketQuery:h,syncMirrorPocketQuery:j,pullPackagesToPocketQuery:_}=pe(),{mutateAsync:x,isLoading:P}=h,S=m=>{u({body:`Do you really want to delete ${m.name} pocket from ${n} series of ${t} distribution?`,title:"Deleting pocket",buttons:[e.jsx(r.Button,{appearance:"negative",disabled:P,onClick:async()=>{try{await x({distribution:t,series:n,name:m.name})}catch(L){g(L)}finally{a()}},"aria-label":`Delete ${m.name} pocket of ${t}/${n}`,children:"Delete"},`delete-${m.name}-pocket`)]})},{mutateAsync:o,isLoading:c}=j,{mutateAsync:C,isLoading:E}=_,R=async()=>{try{await o({name:s.name,series:n,distribution:t})}catch(m){g(m)}finally{a()}},v=async()=>{try{await C({name:s.name,series:n,distribution:t})}catch(m){g(m)}finally{a()}},$=m=>{m.mode==="mirror"?u({title:`Synchronizing ${m.name} pocket`,body:"Do you want to synchronize packages?",buttons:[e.jsx(r.Button,{appearance:"positive",onClick:R,disabled:c,"aria-label":`Synchronize ${m.name} pocket of ${t}/${n}`,children:"Sync"},m.name)]}):m.mode==="pull"&&u({title:`Pulling packages to ${m.name} pocket`,body:`Do you want to pull packages from ${m.pull_pocket}?`,buttons:[e.jsx(r.Button,{appearance:"positive",onClick:v,disabled:E,"aria-label":`Pull packages to ${m.name} pocket of ${t}/${n}`,children:"Pull"},m.name)]})},Y=(m,L)=>{m.currentTarget.blur(),d(`Edit ${L.name} pocket`,e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(ge,{pocket:L,distributionName:t,seriesName:n})}))};return e.jsxs("div",{className:"divided-blocks",children:[(s.mode=="mirror"||s.mode=="pull")&&e.jsx("div",{className:"divided-blocks__item",children:e.jsx(r.Tooltip,{message:s.mode==="mirror"?"Sync":"Pull",position:"btm-center",children:e.jsx(r.Button,{small:i,hasIcon:!0,appearance:i?"base":"",className:k("u-no-margin--bottom",{"u-no-padding--right":i}),"aria-label":s.mode==="mirror"?`Synchronize ${s.name} pocket of ${t}/${n}`:`Pull packages to ${s.name} pocket of ${t}/${n}`,onClick:()=>$(s),disabled:p.some(m=>m.distributionName===t),children:e.jsx("i",{className:k("p-icon--change-version",{"u-no-margin--right":i})})})})}),e.jsx("div",{className:"divided-blocks__item",children:e.jsx(r.Tooltip,{message:"Edit",position:"btm-center",children:e.jsx(r.Button,{small:i,hasIcon:!0,appearance:i?"base":"",className:k("u-no-margin--bottom",{"u-no-padding--right":i}),"aria-label":`Edit ${s.name} pocket of ${t}/${n}`,onClick:m=>Y(m,s),disabled:p.some(m=>m.distributionName===t),children:e.jsx("i",{className:k("p-icon--edit",{"u-no-margin--right":i})})})})}),e.jsx("div",{className:"divided-blocks__item",children:e.jsx(r.Tooltip,{message:"Delete",position:"btm-center",children:e.jsx(r.Button,{small:i,hasIcon:!0,appearance:i?"base":"",className:k("u-no-margin--bottom",{"u-no-padding--right":i}),"aria-label":`Remove ${s.name} pocket of ${t}/${n}`,onClick:()=>S(s),disabled:p.some(m=>m.distributionName===t),children:e.jsx("i",{className:k("p-icon--delete",{"u-no-margin--right":i})})})})})]})},he=({column:t})=>{const s={};return t.id==="name"?s.role="rowheader":t.id==="mode"?s["aria-label"]="Mode":t.id==="last_sync"?s["aria-label"]="Last synced":t.id==="package_count"?s["aria-label"]="Content":t.id==="actions"&&(s["aria-label"]="Actions"),s},xe="_pocketWrapper_17dw4_1",_e="_ctaRow_17dw4_9",G={pocketWrapper:xe,ctaRow:_e},ye=({distributionName:t,series:s,syncPocketRefAdd:n,syncPocketRefs:p})=>{const i=A("(min-width: 620px)"),g=l.useMemo(()=>s.pockets,[s.pockets]),u=l.useMemo(()=>[{accessor:"name",Header:"Pocket",Cell:({row:{original:a}})=>e.jsx(z,{distributionName:t,pocket:a,seriesName:s.name})},{accessor:"mode",Header:"Mode"},{accessor:"last_sync",Header:"Last synced",Cell:({row:{original:a}})=>e.jsx(K,{pocket:a,syncPocketRefAdd:n,syncPocketRefs:p})},{accessor:"package_count",Header:"Content",Cell:({row:{original:a}})=>e.jsx(e.Fragment,{children:`${a.package_count} ${a.package_count===1?"package":"packages"}`})},{accessor:"actions",Cell:({row:{original:a}})=>e.jsx(O,{distributionName:t,pocket:a,seriesName:s.name,syncPocketRefs:p})}],[g,p]);return i?e.jsx(r.ModularTable,{columns:u,data:g,getCellProps:he,emptyMsg:"No pockets yet"}):s.pockets.map((a,d)=>e.jsxs(r.Row,{className:k("u-no-padding--left u-no-padding--right",G.pocketWrapper),children:[e.jsx(r.Col,{size:2,small:2,children:e.jsx(Q,{label:"Pocket",value:e.jsx(z,{distributionName:t,pocket:a,seriesName:s.name})})}),e.jsx(r.Col,{size:2,small:2,children:e.jsx(Q,{label:"Last synced",value:e.jsx(K,{pocket:a,syncPocketRefAdd:n,syncPocketRefs:p})})}),e.jsx(r.Col,{size:2,small:2,children:e.jsx(Q,{label:"Mode",value:a.mode})}),e.jsx(r.Col,{size:2,small:2,children:e.jsx(Q,{label:"Content",value:e.jsx(e.Fragment,{children:`${a.package_count} ${a.package_count===1?"package":"packages"}`})})}),e.jsx("div",{className:G.ctaRow,children:e.jsx(O,{distributionName:t,pocket:a,seriesName:s.name,syncPocketRefs:p})})]},d))};function je(){const t=q(),s=W(),n=F(),p=y({mutationKey:["series","new"],mutationFn:a=>s.get("CreateSeries",{params:a}),onSuccess:()=>{t.invalidateQueries(["distributions"]).catch(n)}}),i=y({mutationKey:["series","derive"],mutationFn:a=>s.get("DeriveSeries",{params:a}),onSuccess:()=>{t.invalidateQueries(["distributions"]).catch(n)}}),g=y({mutationKey:["series","remove"],mutationFn:a=>s.get("RemoveSeries",{params:a}),onSuccess:()=>{t.invalidateQueries(["distributions"]).catch(n)}});return{createSeriesQuery:p,removeSeriesQuery:g,deriveSeriesQuery:i,getRepoInfo:(a,d={})=>M({queryKey:["repoInfo",{queryParams:a}],queryFn:()=>s.get("GetRepoInfo",{params:a}),...d})}}const ke=l.lazy(()=>f(()=>import("./NewPocketForm-DBa8le9g.js"),__vite__mapDeps([45,1,2,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,6,7,8,46,23,24,25,4,5,3,0,9,10,11,12,13,14,15,16,17,18,19,20,26,27]))),ve=l.lazy(()=>f(()=>import("./DeriveSeriesForm-0jhrmYBV.js"),__vite__mapDeps([47,1,2,30,31,46,39,40,41,23,24,25,6,7,8,4,5,3,0,9,10,11,12,13,14,15,16,17,18,19,20,26,27]))),be=({distribution:t,series:s,syncPocketRefAdd:n,syncPocketRefs:p})=>{const[i,g]=l.useState(!1),[u,a]=l.useState("");l.useEffect(()=>{!s||!s.pockets.length||s.pockets[0].mode!=="mirror"||!s.pockets[0].mirror_uri.startsWith(X)||a(s.pockets[0].mirror_uri.replace(/^.*\/(\d{8})T\d{6}Z$/,"$1"))},[s]);const d=A("(min-width: 620px)"),{confirmModal:h,closeConfirmModal:j}=I(),{setSidePanelContent:_}=D(),{removeSeriesQuery:x}=je(),P=F(),{mutateAsync:S,isLoading:o}=x,c=async()=>{h({title:"Remove series",body:"Are you sure? This action cannot be undone.",buttons:[e.jsxs(r.Button,{appearance:"negative",hasIcon:!0,onClick:async()=>{try{await S({name:s.name,distribution:t.name})}catch(v){P(v)}finally{j()}},"aria-label":`Remove ${s.name} from ${t.name}`,children:[o&&e.jsx(r.Spinner,{}),"Remove"]},`delete-${s.name}`)]})},C=({className:v})=>e.jsx(r.Button,{onClick:()=>{_("Derive series",e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(ve,{distribution:t,origin:s.name})}))},onMouseDown:$=>{$.preventDefault()},"aria-label":`Derive series ${t.name}/${s.name}`,className:v??"is-small",children:"Derive series"}),E=({className:v})=>e.jsx(r.Button,{onClick:()=>{_(`New pocket for ${s.name}`,e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(ke,{distribution:t,series:s})}))},onMouseDown:$=>{$.preventDefault()},"aria-label":`Add new pocket for ${t.name}/${s.name}`,className:v??"is-small",children:"New pocket"}),R=({className:v})=>e.jsx(r.Button,{onClick:c,onMouseDown:$=>{$.preventDefault()},disabled:o,"aria-label":`Remove ${t.name}/${s.name}`,className:v??"is-small",children:"Remove"});return e.jsxs("div",{className:w.card,children:[e.jsxs("div",{className:w.header,children:[e.jsx("h3",{className:w.title,children:s.name}),!!u&&e.jsx("span",{className:k("u-text--muted",w.snapshot),children:`Snapshot from ${H(u).format(ee)}`}),d?e.jsxs("div",{className:w.cta,children:[!u&&e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsx(E,{})]}),e.jsx(R,{})]}):e.jsxs("span",{className:"p-contextual-menu",children:[e.jsx(r.Button,{className:"p-contextual-menu__toggle u-no-margin--bottom","aria-controls":"series-cta","aria-expanded":i,"aria-haspopup":"true",onClick:()=>{g(v=>!v)},onBlur:()=>{g(!1)},children:"Actions"}),e.jsxs("span",{className:"p-contextual-menu__dropdown",id:"series-cta","aria-hidden":!i,children:[!u&&e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"p-contextual-menu__link"}),e.jsx(E,{className:"p-contextual-menu__link"})]}),e.jsx(R,{className:"p-contextual-menu__link"})]})]})]}),e.jsx("div",{className:w.content,children:e.jsx(ye,{distributionName:t.name,series:s,syncPocketRefAdd:n,syncPocketRefs:p})})]})},fe="_card_3dgbp_1",Pe="_header_3dgbp_5",Se="_title_3dgbp_11",Ce="_content_3dgbp_20",T={card:fe,header:Pe,title:Se,content:Ce},De=l.lazy(()=>f(()=>import("./index-DuuwSVOO.js"),__vite__mapDeps([48,1,2,30,3,31,32,33,39,40,41,42,43,25,6,7,8,44,46,23,24,4,5,0,9,10,11,12,13,14,15,16,17,18,19,20,26,27]))),$e=({distribution:t})=>{const{setSidePanelContent:s}=D();return e.jsxs("div",{className:T.card,children:[e.jsx("div",{className:T.header,children:e.jsx("h3",{className:T.title,children:"No series have been added yet"})}),e.jsxs("div",{className:T.content,children:[e.jsx("p",{className:"u-no-margin--bottom",children:"Add a new mirror or series to get started"}),e.jsx("p",{className:"u-no-margin--top",children:e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage repositories in Landscape"})}),e.jsx(r.Button,{appearance:"positive",className:"u-no-margin--bottom",onClick:()=>{s(`Add mirror for ${t.name}`,e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(De,{distribution:t})}))},"aria-label":`Add mirror for ${t.name}`,children:"Add mirror"})]})]})},we=l.lazy(()=>f(()=>import("./index-DuuwSVOO.js"),__vite__mapDeps([48,1,2,30,3,31,32,33,39,40,41,42,43,25,6,7,8,44,46,23,24,4,5,0,9,10,11,12,13,14,15,16,17,18,19,20,26,27]))),Ae=({distribution:t,syncPocketRefAdd:s,syncPocketRefs:n})=>{const[p,i]=l.useState(!1),g=A("(min-width: 620px)"),{confirmModal:u,closeConfirmModal:a}=I(),{setSidePanelContent:d}=D(),{removeDistributionQuery:h}=V(),{mutateAsync:j,isLoading:_}=h,x=F(),P=async()=>{u({title:`Removing ${t.name} distribution`,body:"Are you sure? This action cannot be undone.",buttons:[e.jsxs(r.Button,{appearance:"negative",hasIcon:!0,"aria-label":`Remove ${t.name} distribution`,onClick:async()=>{try{await j({name:t.name})}catch(c){x(c)}finally{a()}},children:[_&&e.jsx(r.Spinner,{}),"Remove"]},`delete-${t.name}`)]})},S=({className:c})=>e.jsx(r.Button,{onClick:()=>{d(`Add series to ${t.name}`,e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(we,{distribution:t,ctaText:"Add series"})}))},onMouseDown:C=>{C.preventDefault()},"aria-label":`Add series to ${t.name}`,className:c??"is-small",children:"Add series"}),o=({className:c})=>e.jsx(r.Button,{onClick:P,onMouseDown:C=>{C.preventDefault()},"aria-label":`Remove ${t.name} distribution`,disabled:_,className:c??"is-small",children:"Remove distribution"});return e.jsxs("div",{className:B.item,children:[e.jsxs("div",{className:B.titleGroup,children:[e.jsx("h2",{className:k("p-heading--4 u-no-margin--bottom u-no-padding--top",B.title),children:t.name}),g?e.jsxs("div",{children:[e.jsx(S,{}),e.jsx(o,{})]}):e.jsxs("span",{className:"p-contextual-menu--left",children:[e.jsx(r.Button,{className:"p-contextual-menu__toggle","aria-controls":"distribution-cta","aria-expanded":p,"aria-haspopup":"true",onClick:()=>{i(c=>!c)},onBlur:()=>{i(!1)},children:"Actions"}),e.jsxs("span",{className:"p-contextual-menu__dropdown",id:"distribution-cta","aria-hidden":!p,children:[e.jsx(S,{className:"p-contextual-menu__link"}),e.jsx(o,{className:"p-contextual-menu__link"})]})]})]}),t.series.length===0&&e.jsx($e,{distribution:t}),t.series.length>0&&t.series.map(c=>e.jsx(be,{distribution:t,series:c,syncPocketRefAdd:s,syncPocketRefs:n},c.name))]})},Ne=l.lazy(()=>f(()=>import("./NewDistributionForm-CDrhgoxd.js"),__vite__mapDeps([49,1,2,30,31,25,6,7,8,50,46,39,40,41]))),Fe=()=>{const{setSidePanelContent:t}=D(),s=()=>{t("Add distribution",e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(Ne,{})}))};return e.jsx(ae,{title:"No mirrors have been added yet",icon:"containers",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"To add a new mirror you must first add a distribution"}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage repositories in Landscape"})]}),cta:[e.jsx(r.Button,{onClick:s,type:"button",children:"Add distribution"},"add-distribution")]})},Ee=({onDistributionsLengthChange:t})=>{const[s,n]=l.useState([]),{getDistributionsQuery:p}=V(),{data:i,isLoading:g}=p({include_latest_sync:!0},{refetchInterval:s.length?1e3:void 0}),u=(i==null?void 0:i.data)??[];l.useEffect(()=>{t(u.length)},[u.length]),l.useEffect(()=>{var d,h;if(s.length)for(const j of s){const _=(h=(d=u.find(({name:x})=>x===j.distributionName))==null?void 0:d.series.find(({name:x})=>x===j.seriesName))==null?void 0:h.pockets.find(({name:x})=>x===j.pocketName);!_||_.mode!=="mirror"&&_.mode!=="pull"||_.last_sync_status==="in progress"||n(x=>x.filter(({distributionName:P})=>P!==j.distributionName))}},[u]);const a=d=>{n(h=>[...h,d])};return e.jsxs(e.Fragment,{children:[g&&e.jsx(b,{}),!g&&u.length===0&&e.jsx(Fe,{}),!g&&u.length>0&&u.map(d=>e.jsx(Ae,{distribution:d,syncPocketRefAdd:a,syncPocketRefs:s},d.name))]})},Re=l.lazy(()=>f(()=>import("./NewDistributionForm-CDrhgoxd.js"),__vite__mapDeps([49,1,2,30,31,25,6,7,8,50,46,39,40,41]))),Le=l.lazy(()=>f(()=>import("./index-DuuwSVOO.js"),__vite__mapDeps([48,1,2,30,3,31,32,33,39,40,41,42,43,25,6,7,8,44,46,23,24,4,5,0,9,10,11,12,13,14,15,16,17,18,19,20,26,27]))),Qe=()=>{const[t,s]=l.useState(0),[n,p]=l.useState(!1),i=A("(min-width: 620px)"),{setSidePanelContent:g}=D(),u=({className:d})=>e.jsx(r.Button,{onClick:()=>{g("Add distribution",e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(Re,{})}))},onMouseDown:h=>{h.preventDefault()},type:"button",className:k("u-no-margin--right",d),children:"Add distribution"}),a=({className:d})=>e.jsx(r.Button,{appearance:"positive",onClick:()=>{g("Add new mirror",e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(Le,{})}))},onMouseDown:h=>{h.preventDefault()},type:"button",className:k("u-no-margin--right",d),disabled:t===0,children:"Add mirror"});return e.jsxs(te,{children:[e.jsx(se,{title:"Repository Mirrors",actions:i?[e.jsx(u,{},"add-distribution-button"),e.jsx(a,{},"add-mirror-button")]:[e.jsxs("span",{className:"p-contextual-menu",children:[e.jsx(r.Button,{className:"p-contextual-menu__toggle u-no-margin--bottom","aria-controls":"menu","aria-expanded":n,"aria-haspopup":"true",onClick:()=>{p(d=>!d)},onBlur:()=>{p(!1)},children:"Actions"}),e.jsxs("span",{className:"p-contextual-menu__dropdown",id:"menu","aria-hidden":!n,children:[e.jsx(u,{className:"p-contextual-menu__link"}),e.jsx(a,{className:"p-contextual-menu__link"})]})]},"menu")]}),e.jsx(ne,{children:e.jsx(Ee,{onDistributionsLengthChange:d=>s(d)})})]})},Te=Qe,Ye=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{pe as a,Ye as i,je as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-QIgr8aeB.js","assets/index-DoU7Rqsb.js","assets/index-57O3pXzM.css","assets/moment-Cl4UOzQZ.js","assets/InfoItem-CJkV3SxW.js","assets/InfoItem-BbayMzTk.css","assets/useFetchOld-BmpLm9Xc.js","assets/useMutation-BBuufY01.js","assets/useQuery-BiLCfR8g.js","assets/useConfirm-_4TVG935.js","assets/useInstances-DXIHt5sk.js","assets/moment-CCQDuzMq.js","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/TablePagination-CStPGsWU.js","assets/usePageParams-D-S-g6d_.js","assets/EmptyState-CYOTcwI0.js","assets/EmptyState-BNXajmMK.css","assets/SearchHelpPopup-DMy7Nwrm.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/index-DtS1HTPP.css","assets/index-R4FX4ws0.js","assets/SidePanelTablePagination-BHYpoT3S.js","assets/PageMain-BPmAIdVO.js","assets/PageMain-DtiowUD8.css","assets/useDistributions-CQ_fSy6L.js","assets/DistributionCard.module-CdGw1YvC.js","assets/DistributionCard-CcioRwqI.css","assets/index-BqjlXzq9.css","assets/EditPocketForm-DJxC9ByP.js","assets/formik.esm-BnMMHjVz.js","assets/index.esm-DZ6m6u_n.js","assets/CheckboxGroup-D95HxDqJ.js","assets/CheckboxGroup-B4JHQ1cp.css","assets/debug-FuNUFHwH.js","assets/debug-B7PvC2lz.css","assets/MultiSelectField-DmZazCq0.js","assets/MultiSelectField.module-D1r8qo_i.js","assets/MultiSelectField-B2rqRhX9.css","assets/SidePanelFormButtons-Mpz29jd4.js","assets/SidePanelFormButtons.module-CoxOjuX8.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/series-BUQ7KWzb.js","assets/series-DISXSvXQ.css","assets/useGPGKeys-M_NASec5.js","assets/NewPocketForm-DBa8le9g.js","assets/tests-DFnZqbNV.js","assets/DeriveSeriesForm-0jhrmYBV.js","assets/index-DuuwSVOO.js","assets/NewDistributionForm-CDrhgoxd.js","assets/useRoles-Bz2LFhzg.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
