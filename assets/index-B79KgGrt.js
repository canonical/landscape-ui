import{e as y,b as f,c as b,d as w,h as x,i as d,k as g,x as k,p as j,q as F,s as C,j as s,g as o,n as I,E as S}from"./index-_k3Mqmx0.js";import{P as E,a as T,b as O}from"./PageMain-CO5O-h8M.js";import{b as q}from"./SidePanelFormButtons.module-tJTvEwdD.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},i=new t.Error().stack;i&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[i]="ff05a4c2-d105-4dbf-a5f9-3c6a0115134d",t._sentryDebugIdIdentifier="sentry-dbid-ff05a4c2-d105-4dbf-a5f9-3c6a0115134d")}catch{}const P="_registrationContainer_1mmbg_1",R={registrationContainer:P};function p(){const t=y(),i=f(),a=(n,u={})=>w({queryKey:["preferences"],queryFn:()=>t.get("preferences"),...u}),c=b({mutationKey:["preferences","change"],mutationFn:n=>t.patch("preferences",n),onSuccess:()=>i.invalidateQueries({queryKey:["preferences"]})});return{getOrganisationPreferences:a,changeOrganisationPreferences:c}}const v=/^(?!.*[;#])(?!.*\s$).+$/,N=x().shape({title:g().required("This field is required"),use_registration_key:d(),registration_password:g().when("use_registration_key",{is:!0,then:t=>t.required("This field is required").min(3,"Registration key must be at least 3 characters").matches(v,"The key cannot contain trailing spaces or ; or # symbols")}),auto_register_new_computers:d()}),A=({organisationPreferences:t})=>{const{setUser:i,user:a}=k(),c=j(),{notify:n}=F(),{changeOrganisationPreferences:u}=p(),{mutateAsync:_}=u,h={title:t.title,use_registration_key:!!t.registration_password,registration_password:t.registration_password||"",auto_register_new_computers:t.auto_register_new_computers},e=C({initialValues:h,validationSchema:N,onSubmit:async r=>{try{if(!a)return;await _({title:r.title,registration_password:r.registration_password,auto_register_new_computers:r.auto_register_new_computers}),r.title!==t.title&&i({...a,current_account:r.title,accounts:a.accounts.map(l=>l.title===t.title?{...l,title:r.title}:l)}),e.resetForm({values:{auto_register_new_computers:r.auto_register_new_computers,registration_password:r.registration_password,title:r.title,use_registration_key:r.use_registration_key}}),n.success({title:"Your changes have been saved",message:`Changes made to organisation settings for ${r.title} have been successfully saved.`})}catch(l){c(l)}}}),m=r=>{e.getFieldProps("registration_password").onChange(r),e.setFieldValue("registration_password",""),e.setFieldTouched("registration_password",!1),e.setFieldError("registration_password",void 0),e.setFieldValue("auto_register_new_computers",!1)};return s.jsxs(o.Form,{noValidate:!0,onSubmit:e.handleSubmit,children:[s.jsx(o.Input,{label:"Organisation's name",type:"text",help:"Visible to others in organisation",error:e.touched.title&&e.errors.title?e.errors.title:void 0,...e.getFieldProps("title")}),s.jsx(o.Input,{label:"Use registration key",type:"checkbox",checked:e.values.use_registration_key,...e.getFieldProps("use_registration_key"),onChange:m}),e.values.use_registration_key&&s.jsxs("div",{className:R.registrationContainer,children:[s.jsx(o.Input,{labelClassName:"u-off-screen",label:"Registration key","aria-label":"Registration key",type:"text",error:e.touched.registration_password&&e.errors.registration_password?e.errors.registration_password:void 0,...e.getFieldProps("registration_password")}),s.jsx(o.Input,{label:"Auto register new computers",type:"checkbox",checked:e.values.auto_register_new_computers,help:"This will automatically accept new instances that register to your organisation.",...e.getFieldProps("auto_register_new_computers")})]}),s.jsx("p",{className:"p-form-help-text",children:"When this feature is enabled, new computers must be enrolled using the key that's defined in the field."}),s.jsx("div",{className:q.buttons,children:s.jsx(o.Button,{className:"u-no-margin--bottom",appearance:"positive",type:"submit",disabled:e.isSubmitting||!e.dirty,children:"Save changes"})})]})},K=()=>{const{getOrganisationPreferences:t}=p(),{data:i,isLoading:a,refetch:c}=t(),n=i==null?void 0:i.data,u=()=>{c()};return s.jsxs(E,{children:[s.jsx(T,{title:"General"}),s.jsxs(O,{container:"medium",children:[a&&s.jsx(I,{}),!a&&!n&&s.jsx(S,{title:"Could not load general information",icon:"connected",cta:[s.jsx(o.Button,{type:"button",appearance:"positive",onClick:u,children:"Try again"},"refetch")]}),n&&!a&&s.jsx(A,{organisationPreferences:n})]})]})};export{K as default};
