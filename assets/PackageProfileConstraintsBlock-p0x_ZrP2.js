import{r as d,j as n,d as l}from"./index-CSSscRtK.js";import{C}from"./CellInput-hgWSIdhU.js";import{T as h,C as g,a as N,E as w}from"./index-CzClEgfs.js";const j="_action_fofcj_1",b="_cell_fofcj_7",_="_input_fofcj_18",v="_inputWrapper_fofcj_26",c={action:j,cell:b,input:_,inputWrapper:v},P=async(s,e,a,o)=>{await s.setFieldValue(`constraints[${e}]${[a]}`,o),await s.setFieldTouched(`constraints[${e}]${[a]}`,!0),["rule","version"].includes(a)&&(o!==""?await s.setFieldValue(`constraints[${e}].notAnyVersion`,!0):s.values.constraints[e][a==="rule"?"version":"rule"]===""&&await s.setFieldValue(`constraints[${e}].notAnyVersion`,!1))},T=(s,e,a)=>{var i,u,p;if(!((i=s.errors.constraints)!=null&&i[e])||!((p=(u=s.touched.constraints)==null?void 0:u[e])!=null&&p[a]))return;const o=s.errors.constraints[e];return typeof o!="string"?o[a]:void 0},y=async(s,e)=>{await s.setFieldValue("constraints",s.values.constraints.filter((a,o)=>o!==e)),s.touched.constraints&&(s.touched.constraints.splice(e,1),await s.setTouched({...s.touched,constraints:s.touched.constraints}))},I=s=>({handleConstraintPropChange:async(e,a,o)=>{await P(s,e,a,o)},handleConstraintRowDelete:async e=>{await y(s,e)},getConstraintsErrorByIndex:(e,a)=>T(s,e,a)}),E=({column:s})=>{const e={};return e.className=c.cell,s.id==="package_name"?e.role="rowheader":s.id==="action"?e["aria-label"]="Action":s.id==="constraint"?e["aria-label"]="Constraint":s.id==="version"?e["aria-label"]="Version":s.id==="rule"&&(e["aria-label"]="Rule"),e},O=({formik:s})=>{d.useEffect(()=>{s.submitCount!==0&&(async()=>await s.setTouched({...s.touched,constraints:new Array(s.values.constraints.length).fill(h)}))()},[s.submitCount]);const e=d.useMemo(()=>s.values.constraints,[s.values.constraints]),{handleConstraintPropChange:a,handleConstraintRowDelete:o,getConstraintsErrorByIndex:i}=I(s),u=d.useMemo(()=>[{accessor:"constraint",Header:"Constraint",Cell:({row:{index:t}})=>n.jsx(l.Select,{label:"Constraint",labelClassName:"u-off-screen",className:c.input,wrapperClassName:c.inputWrapper,options:g,...s.getFieldProps(`constraints[${t}].constraint`),onChange:r=>a(t,"constraint",r.target.value),error:i(t,"constraint")})},{accessor:"package",Header:"Package",Cell:({row:{index:t}})=>n.jsx(C,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:c.input,wrapperClassName:c.inputWrapper,...s.getFieldProps(`constraints[${t}].package`),onChange:r=>a(t,"package",r),error:i(t,"package")})},{accessor:"rule",Header:"Rule",Cell:({row:{index:t}})=>n.jsx(l.Select,{label:"Rule",labelClassName:"u-off-screen",className:c.input,wrapperClassName:c.inputWrapper,...s.getFieldProps(`constraints[${t}].rule`),options:N,onChange:r=>a(t,"rule",r.target.value),error:i(t,"rule")})},{accessor:"version",Header:"Version",Cell:({row:{index:t}})=>n.jsx(C,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:c.input,wrapperClassName:c.inputWrapper,...s.getFieldProps(`constraints[${t}].version`),onChange:r=>a(t,"version",r),error:i(t,"version")})},{accessor:"action",className:c.action,Cell:({row:t})=>n.jsx(l.Button,{type:"button",hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding","aria-label":"Delete constraint row",onClick:()=>o(t.index),children:n.jsx(l.Icon,{name:l.ICONS.delete,className:"u-no-margin--left u-no-margin--right"})})}],[e,s.errors.constraints,s.touched.constraints]),p=async()=>{if(await s.setFieldValue("constraints",[w,...s.values.constraints]),s.touched.constraints){const t=[];for(let r=s.values.constraints.length;r>0;r--)s.touched.constraints[r-1]&&(t[r]=s.touched.constraints[r-1]);await s.setTouched({constraints:t})}};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"u-align-text--right",children:n.jsxs(l.Button,{type:"button",hasIcon:!0,onClick:p,children:[n.jsx(l.Icon,{name:l.ICONS.plus,className:"u-no-margin--left"}),n.jsx("span",{children:"Add new constraint"})]})}),n.jsx(l.ModularTable,{columns:u,data:e,getCellProps:E,emptyMsg:"No constraints added yet.",className:"u-no-margin--bottom"}),s.touched.constraints&&typeof s.errors.constraints=="string"&&n.jsx("div",{className:"is-error",children:n.jsxs("p",{className:"p-form-validation__message u-no-margin--top",children:[n.jsx("strong",{children:"Error: "}),n.jsx("span",{children:s.errors.constraints})]})})]})};export{O as P};
