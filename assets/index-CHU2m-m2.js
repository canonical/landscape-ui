import{r as p,b as y,y as _,j as e,h as r,k as O,x as U,a as A,l as T,m as k,n as j,p as R,R as S,s as N}from"./index-B7TA2mEJ.js";import{A as $}from"./AuthTemplate-BEtd_0cP.js";import{S as I}from"./constants-BLCEp6T8.js";const E=o=>{window.location.assign(o)},F="_list_1ltfk_1",q="_button_1ltfk_17",P={list:F,button:q},B=({isUbuntuOneEnabled:o,oidcProviders:u,onInvitation:m})=>{const[t,n]=p.useState(0),[s]=y(),{getOidcUrlQuery:l,getUbuntuOneUrlQuery:d,getInvitationSummaryQuery:a}=_(),c=s.get("redirect-to"),i=s.get("invitation_id"),b=s.has("external"),{data:f}=a({invitationId:i??""},{enabled:!!i});p.useEffect(()=>{f&&m(f.data.account_title)},[f]);const h={id:t};c&&(h.return_to=c),i&&(h.invitation_id=i),b&&(h.external=!0);const{data:g}=l(h,{enabled:t>0});p.useEffect(()=>{g&&E(g.data.location)},[g]);const x={};c&&(x.return_to=`${window.origin}${c}`),i&&(x.invitation_id=i),b&&(x.external=!0);const{data:v}=d(x,{enabled:t===-1});return p.useEffect(()=>{v&&E(v.data.location)},[v]),e.jsxs("ul",{className:P.list,children:[o&&e.jsx("li",{className:"p-list__item",children:e.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:()=>n(-1),className:P.button,children:[e.jsx(r.Icon,{name:I["ubuntu-one"].icon}),e.jsx("span",{children:"Sign in with Ubuntu One"})]})}),u.map(w=>e.jsx("li",{className:"p-list__item",children:e.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:()=>n(w.id),className:P.button,children:[e.jsx(r.Icon,{name:I[w.provider].icon}),e.jsx("span",{children:`Sign in with ${w.name}`})]})},w.id))]})},C="_buttonRow_46ihv_1",D={buttonRow:C},H=()=>{const[o]=y(),u=O(),{signInWithEmailAndPasswordQuery:m}=_(),{setUser:t}=U(),n=A(),s=o.get("redirect-to"),l=o.has("external"),{mutateAsync:d}=m,a=T({initialValues:{email:"",password:"",remember:!1},validationSchema:k().shape({email:j().email("Please provide a valid email address").required("This field is required"),password:j().required("This field is required"),remember:R()}),onSubmit:async c=>{try{const{data:i}=await d({email:c.email,password:c.password});if(l)window.location.replace(s??S);else{t(i,c.remember);const b=new URL(s??S,location.origin);n(b.toString().replace(b.origin,""),{replace:!0})}}catch(i){u(i)}}});return e.jsxs(r.Form,{onSubmit:a.handleSubmit,children:[e.jsx(r.Input,{type:"text",label:"Email",error:a.touched.email&&a.errors.email?a.errors.email:void 0,...a.getFieldProps("email"),"data-testid":"email"}),e.jsx(r.PasswordToggle,{id:"password",label:"Password",error:a.touched.password&&a.errors.password?a.errors.password:void 0,...a.getFieldProps("password"),"data-testid":"password"}),e.jsx(r.CheckboxInput,{label:"Remember this device",...a.getFieldProps("remember")}),e.jsx("div",{className:D.buttonRow,children:e.jsx(r.Button,{type:"submit",appearance:"positive",disabled:a.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},Q=()=>{const[o,u]=p.useState(""),{getLoginMethodsQuery:m}=_(),{data:t,isLoading:n}=m(),s=t!=null&&t.data.oidc.available?t==null?void 0:t.data.oidc.configurations.filter(({enabled:a})=>a):[],l=!!(t!=null&&t.data.ubuntu_one.available&&t.data.ubuntu_one.enabled),d=!!(t!=null&&t.data.password.available&&t.data.password.enabled);return e.jsxs($,{invitationAccount:o,title:"Sign in to Landscape",children:[n&&e.jsx(N,{}),!n&&d&&e.jsx(H,{}),!n&&(l||s.length>0)&&e.jsx(B,{isUbuntuOneEnabled:l,oidcProviders:s,onInvitation:a=>u(a)}),!n&&!d&&!l&&!s.length&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})};export{Q as default};
