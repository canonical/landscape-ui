import{j as e,n as x,G as P,q as w,al as K,e as m,K as k,a as Q,s as U,p as V,H as Y,J as C}from"./index-DjXnPsWV.js";import{S as z}from"./SidePanelFormButtons-oHcEekp6.js";import{a as A}from"./useUsns-BPzHZfYd.js";import{D as G}from"./downshift.esm-DtDnRlY7.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./constants-CFW2eS4m.js";const J=200,M=(s,o)=>{const a=s.toLowerCase(),c=o.toLowerCase(),n=a.indexOf(c);return n>=0?e.jsxs(e.Fragment,{children:[s.substring(0,n),e.jsx("strong",{children:s.substring(n,n+o.length)}),s.substring(n+o.length)]}):s},W="_container_1orjt_1",X="_suggestionsContainer_1orjt_5",Z="_pointer_1orjt_12",ee="_highlighted_1orjt_17",te="_selectedContainer_1orjt_21",d={container:W,suggestionsContainer:X,pointer:Z,highlighted:ee,selectedContainer:te},se=({selectedItems:s,setSelectedItems:o})=>{const[a,c]=x.useState(""),[n,i]=x.useState(!1),[r,g]=x.useState(""),{instanceId:b}=P(),f=w(),{getInstancePackagesQuery:_}=A(),j=Number(b),{data:S,isFetching:l}=_({instance_id:j,available:!0,installed:!1,upgrade:!1,held:!1,limit:50,search:a},{enabled:a.length>2}),h=S?.data?.results??[],B=t=>!s.map(u=>u.name).includes(t.name),N=h.filter(B),E=t=>{o(s.filter(u=>u.name!==t))},T=()=>{i(!1)},y=()=>{g(""),c("")},v=()=>{r.length>2?i(!0):i(!1)},$=t=>{g(t),t.length>2&&c(t)},F=K(()=>{try{v()}catch(t){f(t)}},J),O=t=>{o([...s,t]),y()},L=t=>{t&&(O(t),i(!1))},R=t=>{t.key==="Escape"?t.currentTarget.blur():F()},I=!n&&r.length<3?"Min 3. characters":h.length===0&&a&&!l?`No packages found by "${a}"`:null;return e.jsxs("div",{className:d.container,children:[e.jsx(G,{onSelect:L,itemToString:()=>"",isOpen:n,children:({getInputProps:t,getItemProps:u,getMenuProps:q,highlightedIndex:H})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(m.SearchBox,{...t(),placeholder:"Search for available packages",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:r,onChange:$,onClear:y,onBlur:T,onFocus:v,onKeyUp:R}),I?e.jsx("span",{className:"p-form-help-text",children:I}):null,n&&(N.length>0||l)?e.jsx("ul",{className:k("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",d.suggestionsContainer),...q(),children:l?e.jsx(Q,{}):N.map((p,D)=>e.jsxs("li",{className:k("p-list__item",d.pointer,{[d.highlighted]:H===D}),...u({item:p,index:D}),children:[e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:M(p.name,a)}),e.jsx("div",{children:e.jsx("small",{className:"u-text-muted",children:p.available_version})})]},p.name))}):null]})}),e.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:s.length?s.map(t=>e.jsxs("li",{className:k("p-autocomplete__result p-list__item p-card u-no-margin--bottom",d.selectedContainer),children:[e.jsxs("div",{children:[e.jsx("div",{children:t.name}),e.jsx("small",{className:"u-text--muted p-text--small",children:t.available_version})]}),e.jsx(m.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom",onClick:()=>{E(t.name)},children:e.jsx(m.Icon,{name:m.ICONS.delete})})]},t.name)):null})]})},ue=()=>{const[s,o]=x.useState([]),{instanceId:a,childInstanceId:c}=P(),n=w(),{notify:i}=U(),{packagesActionQuery:r}=A(),{closeSidePanel:g}=V(),{openActivityDetails:b}=Y(),f=Number(c??a),{mutateAsync:_,isPending:j}=r,S=async()=>{try{const{data:l}=await _({action:"install",computer_ids:[f],package_ids:s.map(({id:h})=>h)});g(),i.success({title:`You queued ${C(s.length,`package ${s[0]?.name??""}`,`${s.length} packages`)} to be installed.`,message:`${C(s.length,`${s[0]?.name??""} package`,`${s.length} selected packages`)} will be installed and ${C(s.length,"is","are")} queued in Activities.`,actions:[{label:"Details",onClick:()=>{b(l)}}]})}catch(l){n(l)}};return e.jsxs(e.Fragment,{children:[e.jsx(se,{selectedItems:s,setSelectedItems:l=>{o(l)}}),e.jsx(z,{submitButtonDisabled:j||s.length===0,submitButtonText:"Install packages",submitButtonAppearance:"positive",onSubmit:S})]})};export{ue as default};
