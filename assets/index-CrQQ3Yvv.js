const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BGNyl3Jf.js","assets/index-DYykpNVa.js","assets/index-hef1aQzf.css","assets/MultiSelectField-85mhFA5_.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-Aj5ThB2m.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useRoles-CK1OAvut.js","assets/useFetchOld-BGD2hIpr.js","assets/formikErrors-Bw8iTXYS.js","assets/PageMain-BnPck7ZK.js","assets/PageMain-30196XJe.css","assets/TablePagination-CIA4CRba.js","assets/TableFilterChips-DLH4XQ-H.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-DZURD2KR.css","assets/constants-CXofZZ4i.js","assets/InfoGrid-CVtcW3Y8.js","assets/InfoItem-DMBAN7ig.js","assets/NoData-CT6SeJUX.js","assets/Truncated-DtD6hAHP.js","assets/Truncated-uqJp6ujM.css","assets/InfoItem-D8nPzgUA.css","assets/InfoGrid-D3QqOHFx.css","assets/ResponsiveTable-C-8YbfBJ.js","assets/ResponsiveTable-Czda4kFo.css","assets/HeaderWithSearch-DH3OfcZg.js","assets/HeaderWithSearch-C2lwo0VI.css"])))=>i.map(i=>d[i]);
import{v as H,f as V,w as f,c as L,z as P,B as C,C as T,p as N,J as E,i as $,r as u,j as e,d as v,y as A,g as K,ab as Y,s as w,e as j,E as U,$ as M,o as _,N as F}from"./index-DYykpNVa.js";import{P as W,a as G,b as J}from"./PageMain-BnPck7ZK.js";import{u as X}from"./useFetchOld-BGD2hIpr.js";import{a as Z}from"./TablePagination-CIA4CRba.js";import{u as D}from"./useRoles-CK1OAvut.js";import{L as ee}from"./constants-CXofZZ4i.js";import{M as q}from"./MultiSelectField-85mhFA5_.js";import{g as z}from"./formikErrors-Bw8iTXYS.js";import{S as te}from"./SidePanelFormButtons-Aj5ThB2m.js";import{I as x}from"./InfoGrid-CVtcW3Y8.js";import{R as O}from"./ResponsiveTable-C-8YbfBJ.js";import{a as se}from"./TableFilterChips-DLH4XQ-H.js";import{H as ne}from"./HeaderWithSearch-DH3OfcZg.js";function S(){const t=H(),s=X(),i=V(),l=(a,y={})=>L({queryKey:["administrators"],queryFn:async()=>s.get("GetAdministrators"),...y}),m=f({mutationFn:async a=>s.get("InviteAdministrator",{params:a}),onSuccess:async()=>t.invalidateQueries({queryKey:["invitations"]})}),d=f({mutationFn:async a=>s.get("DisableAdministrator",{params:a}),onSuccess:async()=>t.invalidateQueries({queryKey:["administrators"]})}),g=f({mutationFn:async({id:a,...y})=>i.put(`administrators/${a}`,y),onSuccess:async()=>Promise.all([t.invalidateQueries({queryKey:["administrators"]}),t.invalidateQueries({queryKey:["roles"]})])}),o=(a,y={})=>L({queryKey:["invitations",a],queryFn:async()=>i.get("/invitations",{params:a}),...y}),r=f({mutationFn:async a=>i.delete(`/invitations/${a.id}`),onSuccess:async()=>t.invalidateQueries({queryKey:["invitations"]})}),n=f({mutationFn:async a=>i.post(`/invitations/${a.id}`),onSuccess:async()=>t.invalidateQueries({queryKey:["invitations"]})});return{getAdministratorsQuery:l,inviteAdministratorQuery:m,disableAdministratorQuery:d,editAdministratorQuery:g,getInvitationsQuery:o,revokeInvitationQuery:r,resendInvitationQuery:n}}const ae="_footer_16wo1_1",ie="_multiSelect_16wo1_7",Q={footer:ae,multiSelect:ie},oe=({administrator:t,roleOptions:s})=>{const i=P(),{notify:l}=C(),{editAdministratorQuery:m}=S(),{mutateAsync:d}=m,g=async({roles:r})=>{try{await d({id:t.id,roles:r}),l.success({title:"Permission changes have been queued",message:`You changed ${t.name}'s roles`})}catch(n){i(n)}},o=T({initialValues:{roles:[]},validationSchema:N().shape({roles:E().of($()).min(1,"At least one role is required")}),onSubmit:g});return u.useEffect(()=>{o.setValues({roles:t.roles})},[t.roles]),e.jsx(v.Form,{onSubmit:o.handleSubmit,noValidate:!0,children:e.jsx(q,{required:!0,variant:"condensed",className:Q.multiSelect,items:s,selectedItems:s.filter(({value:r})=>o.values.roles.includes(r)),onItemsUpdate:async r=>await o.setValues({roles:r.map(({value:n})=>n)}),placeholder:"Select roles",error:z(o,"roles"),dropdownFooter:e.jsxs("div",{className:Q.footer,children:[e.jsx(v.Button,{type:"button",dense:!0,small:!0,className:"u-no-margin--bottom",disabled:o.values.roles.length===t.roles.length&&t.roles.every(r=>o.values.roles.includes(r)),onClick:()=>o.setFieldValue("roles",t.roles),children:"Revert"}),e.jsx(v.Button,{type:"button",dense:!0,small:!0,appearance:"positive",className:"u-no-margin--bottom",disabled:o.values.roles.length===t.roles.length&&t.roles.every(r=>o.values.roles.includes(r)),onClick:()=>o.submitForm(),children:"Save changes"})]})})})},re=({administrator:t})=>{const[s,i]=u.useState(t);u.useEffect(()=>{i(t)},[t]);const{notify:l}=C(),m=P(),{closeSidePanel:d}=A(),{disableAdministratorQuery:g,editAdministratorQuery:o}=S(),{getRolesQuery:r}=D(),{data:n}=r(),a=n?.data.map(({name:p})=>({label:p,value:p}))??[],{mutateAsync:y}=o,{mutateAsync:R,isPending:I}=g,k=async()=>{try{await R({email:s.email}),l.success({title:"Administrator removed",message:`Administrator "${t.name}" has been removed successfully.`}),d()}catch(p){m(p)}},c=async p=>{try{await y({id:t.id,roles:p.roles}),i(b=>({...b,roles:p.roles})),l.success({title:"Permission changes have been queued",message:`You changed ${s.name}'s roles`})}catch(b){m(b)}},h=T({initialValues:{roles:[]},validationSchema:N().shape({roles:E().of($()).min(1,"At least one role is required")}),onSubmit:c});return u.useEffect(()=>{h.setValues({roles:s.roles})},[s]),e.jsxs(v.Form,{onSubmit:h.handleSubmit,noValidate:!0,children:[e.jsxs(v.ConfirmationButton,{type:"button",className:"has-icon u-no-margin",confirmationModalProps:{title:"Disable Administrator",children:e.jsx("p",{children:"This will remove the administrator from your Landscape organization."}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:I,confirmButtonLoading:I,onConfirm:k},children:[e.jsx(v.Icon,{name:v.ICONS.delete,"aria-hidden":"true"}),e.jsx("span",{children:"Remove"})]}),e.jsxs(x,{spaced:!0,children:[e.jsx(x.Item,{label:"Name",value:s.name}),e.jsx(x.Item,{label:"Email",value:s.email}),e.jsx(x.Item,{label:"Timezone",large:!0,value:null}),e.jsx(x.Item,{label:"Identity URL",large:!0,value:null})]}),e.jsx(q,{variant:"condensed",label:"Roles",items:a,selectedItems:a.filter(({value:p})=>h.values.roles.includes(p)),placeholder:"Select roles",onItemsUpdate:async p=>await h.setFieldValue("roles",p.map(({value:b})=>b)),error:z(h,"roles")}),e.jsx(te,{submitButtonDisabled:h.isSubmitting||h.values.roles.length===s.roles.length&&h.values.roles.every(p=>s.roles.includes(p)),submitButtonText:"Save changes"})]})},le=({administrator:t})=>{const s=P(),{notify:i}=C(),{disableAdministratorQuery:l}=S(),{value:m,setTrue:d,setFalse:g}=K(),{mutateAsync:o,isPending:r}=l,n=async()=>{try{await o({email:t.email}),i.success({title:`You have successfully removed ${t.name} as an administrator.`,message:"They will no longer be able to access this Landscape organization and all permissions have been revoked."})}catch(a){s(a)}finally{g()}};return e.jsxs(e.Fragment,{children:[e.jsx(Y,{toggleAriaLabel:`${t.name} administrator actions`,destructiveActions:[{icon:"delete",label:"Remove","aria-label":`Remove "${t.name}" administrator`,onClick:d}]}),m&&e.jsx(v.ConfirmationModal,{close:g,title:`Remove ${t.name}`,confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:r,confirmButtonLoading:r,onConfirm:n,children:e.jsx("p",{children:"This will remove the administrator from your Landscape organization."})})]})},ce="_roles_urg7z_1",me="_table_urg7z_11",B={roles:ce,table:me},de=t=>{const s={};return t.column.id==="name"?s.role="rowheader":t.column.id==="email"?s["aria-label"]="Email":t.column.id==="roles"?s["aria-label"]="Roles":t.column.id==="actions"&&(s["aria-label"]="Actions"),s},ue=({administrators:t,roles:s})=>{const{setSidePanelContent:i}=A(),{search:l}=w(),m=l.trim()?`No administrators found with the search: "${l.trim()}".`:"You have no administrators on your Landscape organization.",d=u.useMemo(()=>t,[t]),g=u.useMemo(()=>s.map(({name:n})=>({label:n,value:n})),[s]),o=n=>{i(n.name,e.jsx(re,{administrator:n}))},r=u.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:n})=>e.jsx(v.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{o(n.original)},children:n.original.name})},{accessor:"email",Header:"Email"},{accessor:"roles",className:B.roles,Header:"Roles",Cell:({row:n})=>e.jsx(oe,{administrator:n.original,roleOptions:g})},{...ee,Cell:({row:n})=>e.jsx(le,{administrator:n.original})}],[d,g]);return e.jsx(O,{columns:r,data:d,getCellProps:de,emptyMsg:m,className:B.table})},ge=()=>e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsx(se,{filtersToDisplay:["search"]})]}),he=({administrators:t})=>{const{search:s,pageSize:i,currentPage:l}=w(),{getRolesQuery:m}=D(),{data:d}=m(),o=(()=>{const n=s.trim().toLowerCase();return n?t.filter(a=>a.email.toLowerCase().includes(n)||a.name.toLowerCase().includes(n)||a.roles.some(y=>y.toLowerCase().includes(n))):t})(),r=o.filter((n,a)=>a>=(l-1)*i&&a<l*i)??[];return e.jsxs(e.Fragment,{children:[e.jsx(ge,{}),e.jsx(ue,{administrators:r,roles:d?.data??[]}),r.length>0&&e.jsx(Z,{totalItems:o.length,currentItemCount:r.length})]})},ve=u.lazy(()=>M(()=>import("./index-BGNyl3Jf.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]))),pe=()=>{const{setSidePanelContent:t}=A(),{getAdministratorsQuery:s}=S(),{data:i,isLoading:l}=s(),m=()=>{t("Invite administrator",e.jsx(u.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(ve,{})}))};return e.jsxs(e.Fragment,{children:[l&&e.jsx(j,{}),!l&&(!i||!i.data.length)&&e.jsx(U,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no administrators in your Landscape organization."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[e.jsx(v.Button,{type:"button",appearance:"positive",onClick:m,children:"Invite Administrator"},"invite-administrator")],icon:"user",title:"No administrators found"}),!l&&i&&i.data.length>0&&e.jsx(he,{administrators:i.data})]})},ye=t=>{const s={};return t.column.id==="name"?s.role="rowheader":t.column.id==="email"?s["aria-label"]="Email":t.column.id==="creation_time"?s["aria-label"]="Invited":t.column.id==="expiration_time"?s["aria-label"]="Expires":t.column.id==="actions"&&(s["aria-label"]="Actions"),s},be=14,fe=()=>{const t=P(),{notify:s}=C(),{getInvitationsQuery:i,revokeInvitationQuery:l,resendInvitationQuery:m}=S(),{data:d,isPending:g}=i(),o=u.useMemo(()=>d?.data.results.sort((c,h)=>_(h.creation_time).diff(_(c.creation_time)))??[],[d]),{mutateAsync:r,isPending:n}=l,{mutateAsync:a,isPending:y}=m,R=async c=>{try{await r({id:c.id}),s.success({message:`${c.name}â€™${c.name.endsWith("s")?"":"s"} invitation has been revoked`,title:"You revoked an administrator invite"})}catch(h){t(h)}},I=async c=>{try{await a({id:c.id}),s.success({message:`${c.name} will receive a new invitation email`,title:"You resent an administrator invite"})}catch(h){t(h)}},k=u.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"email",Header:"Email"},{accessor:"creation_time",Header:"Invited",Cell:({row:c})=>e.jsx("span",{className:"font-monospace",children:_(c.original.creation_time).format(F)})},{accessor:"expiration_time",Header:"Expires",Cell:({row:c})=>e.jsx("span",{className:"font-monospace",children:_(c.original.creation_time).add(be,"days").format(F)})},{accessor:"actions",Cell:({row:c})=>e.jsxs("div",{className:"u-align-text--right",children:[e.jsx(v.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Revoke invitation for ${c.original.name}`,children:e.jsxs("p",{children:["This action will prevent ",c.original.name," from joining your Landscape organization."]}),confirmButtonLabel:"Revoke invitation",confirmButtonAppearance:"negative",confirmButtonDisabled:n,confirmButtonLoading:n,onConfirm:async()=>R(c.original)},children:"Revoke"}),e.jsx(v.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Resend invitation for ${c.original.name}`,children:e.jsxs("p",{children:[c.original.name," will receive a new invitation email."]}),confirmButtonLabel:"Resend invitation",confirmButtonAppearance:"positive",confirmButtonDisabled:y,confirmButtonLoading:y,onConfirm:async()=>I(c.original)},children:"Resend"})]})}],[o]);return e.jsx(e.Fragment,{children:g?e.jsx(j,{}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-text--muted p-text--small",children:"Unclaimed invitations expire after 14 days."}),e.jsx(O,{columns:k,data:o,getCellProps:ye,emptyMsg:"You have no unclaimed invitations."})]})})},xe="_tabPanel_1p9so_1",je={tabPanel:xe},Ae=[{label:"Administrators",id:"tab-link-administrators"},{label:"Invites",id:"tab-link-invites"}],Se=()=>{const{closeSidePanel:t}=A(),[s,i]=u.useState("tab-link-administrators");return e.jsxs(e.Fragment,{children:[e.jsx(v.Tabs,{listClassName:"u-no-margin--bottom",links:Ae.map(({label:l,id:m})=>({label:l,id:m,role:"tab",active:m===s,onClick:()=>{i(m),t()}}))}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":s,className:je.tabPanel,children:e.jsxs(u.Suspense,{fallback:e.jsx(j,{}),children:[s==="tab-link-administrators"&&e.jsx(pe,{}),s==="tab-link-invites"&&e.jsx(fe,{})]})})]})},Ie=u.lazy(()=>M(()=>import("./index-BGNyl3Jf.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]))),_e=()=>{const{setSidePanelContent:t}=A(),s=()=>{t("Invite administrator",e.jsx(u.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(Ie,{})}))};return e.jsxs(W,{children:[e.jsx(G,{title:"Administrators",actions:[e.jsx(v.Button,{appearance:"positive",onClick:s,type:"button",children:"Invite administrator"},"invite-administrator")]}),e.jsx(J,{hasTable:!0,children:e.jsx(Se,{})})]})},Me=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));export{Me as i,S as u};
