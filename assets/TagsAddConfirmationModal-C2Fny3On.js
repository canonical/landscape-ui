import{b as x,i as C,j as n,d as r,ax as b,l as j,C as s,A as _}from"./index-CDk-Jgvr.js";const w=(e,o)=>{const t=x(),{data:a,isFetching:l,isPending:c,refetch:g}=C({queryKey:["profileChanges",e],queryFn:async()=>t.get("tags/profile-diff",{params:e}),...o});return{isFetchingProfileChanges:l,isPendingProfileChanges:c,profileChanges:a?.data.results??[],profileChangesCount:a?.data.count??0,refetchProfileChanges:g}},$="_pagination_1kb8s_1",y="_inner_1kb8s_10",p={pagination:$,inner:y},A=({onPrev:e,onNext:o,max:t,current:a})=>n.jsx("div",{className:p.pagination,children:n.jsxs("div",{className:p.inner,children:[n.jsx(r.Button,{className:"u-no-margin--right u-no-margin--bottom",appearance:"base",hasIcon:!0,onClick:e,disabled:a<=1,"aria-label":"Previous page",children:n.jsx(r.Icon,{name:"chevron-left"})}),n.jsxs("span",{children:["Page ",a," of ",t]}),n.jsx(r.Button,{className:"u-no-margin--bottom",appearance:"base",hasIcon:!0,onClick:o,disabled:a>=t,"aria-label":"Next page",children:n.jsx(r.Icon,{name:"chevron-right"})})]})}),d=10,v=e=>{const o={};return o["aria-label"]=`${e.original.profile.name} profile change row`,o},R=({instances:e,profileChangesCount:o,tags:t,...a})=>{const{count:l,decrement:c,increment:g}=b(1),{isPendingProfileChanges:f,profileChanges:m}=w({instance_ids:e.map(i=>i.id),tags:t,limit:d,offset:(l-1)*d}),P=j.useMemo(()=>[t.length>1?{Header:"Tag",Cell:({row:{original:i}})=>i.tag}:null,{Header:"Active profiles",Cell:({row:{original:i}})=>i.profile.name},{Header:"Profile type",Cell:({row:{original:i}})=>({ChildInstanceProfile:"WSL",PackageProfile:"Package",RebootProfile:"Reboot",RemovalProfile:"Removal",RepositoryProfile:"Repository",ScriptProfile:"Script",UpgradeProfile:"Upgrade",UsgProfile:"Security"})[i.profile.profile_type]},{Header:"Associated instances",Cell:({row:{original:i}})=>{const u=`${i.profile.current_associated_instances} ${s(i.profile.current_associated_instances,"instance")}`;return i.profile.will_exceed_limit?n.jsxs(r.Tooltip,{message:`Adding ${s(e.length,"this instance","these instances")} will exceed the instance limit.`,children:[n.jsx(r.Icon,{name:"warning"}),u]}):u},getCellIcon:({row:{original:i}})=>i.profile.will_exceed_limit?"":null}].filter(i=>i!=null),[]),h=Math.ceil(o/d);return n.jsxs(r.ConfirmationModal,{title:`Add ${s(t.length,`"${t[0]}" tag`,`${t.length} tags`)} to ${s(e.length,`"${e[0].title}"`,`${e.length} instances`)}`,confirmButtonLabel:"Add tags",...a,children:[n.jsx("p",{children:"Adding tags could trigger irreversible changes to your instances."}),n.jsxs("p",{children:["Adding"," ",s(t.length,`the ${t[0]} tag`,`these ${t.length} tags`)," ","to"," ",s(e.length,`the ${e[0].title} instance`,`${e.length} instances`)," ","will associate the ",s(e.length,"instance")," with the following profiles."]}),n.jsx("p",{children:"Some instances might not be associated with certain profiles due to restrictions."}),f?n.jsx(_,{}):n.jsx(r.ModularTable,{className:"u-no-margin--bottom",columns:P,data:m,getRowProps:v}),h>1&&n.jsx(A,{max:h,current:l,onPrev:c,onNext:g})]})};export{R as T,w as u};
