import{u as h,V as y,I as j}from"./ScriptsTabs-Bt_YU9c3.js";import{c as Y,a as Z,d as ee,S as te,b as se}from"./ScriptsTabs-Bt_YU9c3.js";import{y as F,z as I,l as v,J as C,r as P,j as t,m as r}from"./index-BLUNVNi0.js";import{S as E}from"./SidePanelFormButtons-CCa0SzC-.js";import{u as V,D as A}from"./DeliveryBlock-y5LviHk-.js";import{u as N}from"./useRoles-Dugd59w6.js";import{g as l}from"./formikErrors-Bw8iTXYS.js";import"./index-C6dMcHjK.js";import{default as ie}from"./index-B_BB_I5H.js";import"./TruncatedCell-Dck5yj2C.js";import"./HeaderWithSearch-CuoLt-7V.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./CodeEditor-CRWqmKv3.js";import"./ScriptFormAttachments-ByN7-bdo.js";import"./AttachmentFile-BJ7MVni8.js";const R=i=>{const o=(i==null?void 0:i.map(({id:a,title:c})=>({label:c,value:a})))??[];return o.unshift({label:"Select script",value:0}),o},T=(i,o)=>{var a;return{message:`"${(a=o.find(({value:c})=>c===i.script_id))==null?void 0:a.label}" script queued to execute successfully`,title:"Script execution queued"}},K=({query:i})=>{const o=F(),{notify:a}=I(),{closeSidePanel:c}=v(),{getAccessGroupQuery:S}=N(),{scripts:p}=h({listenToUrlParams:!1},{script_type:"active"}),{runScript:f}=V(),m=R(p),e=C({initialValues:j,validationSchema:y,onSubmit:async s=>{try{await f({deliver_after:s.deliverImmediately?void 0:s.deliver_after,query:i,script_id:s.script_id,username:s.username}),c(),a.success(T(s,m))}catch(n){o(n)}}}),g=async s=>{var d;const n=parseInt(s.target.value);if(await e.setFieldValue("script_id",n),!e.values.username){const x=((d=p.find(({id:_})=>_===n))==null?void 0:d.username)??"";await e.setFieldValue("username",x)}},{data:u}=S(),b=P.useMemo(()=>((u==null?void 0:u.data)??[]).map(({name:s,title:n})=>({label:n,value:s})),[u]);return t.jsxs(r.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[t.jsx(r.Select,{label:"Script",required:!0,options:m,...e.getFieldProps("script_id"),onChange:g,error:l(e,"script_id")}),t.jsx(r.Select,{label:"Access group",options:[{label:"Select access group",value:""},...b],...e.getFieldProps("in_access_group"),error:l(e,"in_access_group")}),t.jsxs(r.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(r.Col,{size:6,children:t.jsx(r.Input,{type:"text",label:"Run as user",autoComplete:"off",required:!0,...e.getFieldProps("username"),error:l(e,"username")})}),t.jsx(r.Col,{size:6,children:t.jsx(r.Input,{type:"text",label:"Time limit (seconds)",autoComplete:"off",required:!0,...e.getFieldProps("time_limit"),error:l(e,"time_limit")})})]}),t.jsx(A,{formik:e}),t.jsx(E,{submitButtonDisabled:e.isSubmitting,submitButtonText:"Run script"})]})};export{ie as CreateScriptForm,K as RunInstanceScriptForm,Y as ScriptList,Z as ScriptsContainer,ee as ScriptsEmptyState,te as ScriptsTabs,h as useGetScripts,se as useGetSingleScript};
