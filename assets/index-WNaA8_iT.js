import{j as e,r as m,y as W,m as r,c as B,L as N}from"./index-Co97hBNM.js";import{u as P,W as R,a as F}from"./WslInstancesHeader-CxAeffGi.js";import{u as H}from"./useInstances-D3zH0jqk.js";import"./HeaderWithSearch-CAYSZhuV.js";const E="_toggleButton_bnzrt_1",Q="_menu_bnzrt_6",p={toggleButton:E,menu:Q},q=(t,s)=>s==="remove"?{title:"Remove instance from Landscape",label:"Remove",appearance:"negative",body:e.jsxs("p",{children:["This will remove the instance ",e.jsx("b",{children:t.title})," from Landscape. It will remain on the parent machine. You can re-register it to Landscape at any time."]})}:s==="delete"?{title:"Delete instance",label:"Delete",appearance:"negative",body:e.jsxs("p",{children:["This will permanently delete the instance ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]})}:{title:"Set default instance",label:"Set default",appearance:"positive",body:e.jsxs("p",{children:["Are you sure you want to set ",t.title," as default instance?"]})},z=({instance:t,parentId:s})=>{const[l,i]=m.useState(null),[o,g]=m.useState(""),d=W(),{setDefaultChildInstanceQuery:n,deleteChildInstancesQuery:a}=P(),{removeInstancesQuery:u}=H(),{mutateAsync:b,isPending:C}=n,{mutateAsync:j,isPending:y}=a,{mutateAsync:I,isPending:v}=u,h=()=>{i(null)},L=async()=>{try{await b({child_id:t.id,parent_id:s})}catch(c){d(c)}finally{h()}},_=async()=>{try{await j({computer_ids:[t.id]})}catch(c){d(c)}finally{h()}},D=async()=>{try{await I({computer_ids:[t.id]})}catch(c){d(c)}finally{h()}},w=()=>{l==="setDefault"?L():l==="remove"?D():l==="delete"&&_()},k=[{children:"Set default instance","aria-label":`Set ${t.title} as default instance`,onClick:()=>{i("setDefault")}},{children:"Remove instance from Landscape","aria-label":`Remove ${t.title} instance from Landscape`,onClick:()=>{i("remove")}},{children:"Delete instance","aria-label":`Delete ${t.title} instance`,onClick:()=>{i("delete")}}].filter(c=>c.children==="Set default instance"?!t.is_default_child:!0),{body:S,appearance:A,title:$,label:M}=q(t,l),f=C||v||y,T=l==="remove"&&o!==`remove ${t.title}`;return e.jsxs(e.Fragment,{children:[e.jsx(r.ContextualMenu,{position:"left",className:p.menu,toggleClassName:p.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(r.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${t.title} instance actions`},links:k}),l&&e.jsxs(r.ConfirmationModal,{title:$,confirmButtonLabel:M,confirmButtonAppearance:A,confirmButtonDisabled:f||T,confirmButtonLoading:f,onConfirm:w,close:h,children:[S,l==="remove"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Type ",e.jsx("b",{children:`remove ${t.title}`})," to confirm."]}),e.jsx(r.Input,{type:"text",value:o,onChange:c=>{g(c.target.value)}})]})]})]})},U="_title_s8qem_1",Y="_actions_s8qem_5",x={title:U,actions:Y},O=({instance:t})=>{const[s,l]=m.useState([]),{search:i}=B(),o=m.useMemo(()=>i?t.children.filter(({title:n,hostname:a})=>n.toLowerCase().includes(i.toLowerCase())||(a==null?void 0:a.toLowerCase().includes(i.toLowerCase()))):t.children,[t,i]),g=n=>{l(a=>a.some(({id:u})=>u===n.id)?a.filter(({id:u})=>u!==n.id):[...a,n])},d=m.useMemo(()=>[{accessor:"title",Header:e.jsxs(e.Fragment,{children:[e.jsx(r.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),checked:o.length>0&&s.length===o.length,indeterminate:s.length>0&&s.length<o.length,onChange:()=>{l(s.length>0?[]:o)}}),e.jsx("span",{children:"Title"})]}),Cell:({row:n})=>e.jsxs("div",{className:x.title,children:[e.jsx(r.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${n.original.title} instance`}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:s.some(({id:a})=>a===n.original.id),onChange:()=>g(n.original)}),e.jsx(N,{to:`/instances/${t.id}/${n.original.id}`,children:n.original.title})]})},{accessor:"distribution",Header:"OS",Cell:({row:{original:n}})=>n.distribution?`UbuntuÂ ${n.distribution}`:"Unknown"},{accessor:"default",Header:"Default",Cell:({row:{original:n}})=>e.jsx(e.Fragment,{children:n.is_default_child?"Yes":"No"})},{accessor:"actions",className:x.actions,Header:"Actions",Cell:({row:{original:n}})=>e.jsx(z,{instance:n,parentId:t.id})}],[o,s]);return e.jsxs(e.Fragment,{children:[e.jsx(R,{selectedInstances:s}),e.jsx(r.ModularTable,{columns:d,data:o,emptyMsg:"No WSL instances found"})]})},X=({instance:t})=>t.children.length!==0?e.jsx(O,{instance:t}):e.jsx(F,{});export{X as default};
