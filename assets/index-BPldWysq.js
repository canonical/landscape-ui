import{d as ge,c as _e,e as D,j as e,k as E,l as ee,f as q,r as b,g as o,h as F,o as U,B as ne}from"./index-CreLYkd7.js";import{u as xe}from"./useMutation-CvjNgrEE.js";import{u as O}from"./useQuery-TlFJgfqc.js";import{E as fe}from"./EmptyState-DAULjSZb.js";import"./TablePagination.module-DLVph1Z1.js";import{T as be}from"./TablePagination-Zw7WkUG8.js";import{I as B}from"./InfoItem-DVjSC8Rv.js";import{u as je}from"./formik.esm-C2DYiXJC.js";import{h as $}from"./moment-Cl4UOzQZ.js";import{a as I,f as ve,c as Ce}from"./index.esm-Co3jed-Q.js";import{S as ae}from"./SidePanelFormButtons-CfVlXCl-.js";import{f as X}from"./helpers-Cjr4pgyV.js";import{u as Se,D as Ne}from"./downshift.esm-CNa_fOan.js";import{u as se}from"./usePageParams-MY5k-CLu.js";import"./InfoItem.module-BZ3tYMsb.js";import"./SidePanelFormButtons.module-DyBJG5lm.js";const P=()=>{const n=ge(),a=_e(),u=D(),g=(c,p={})=>{const{instance_id:s,...t}=c;return O({queryKey:["snaps",{...c}],queryFn:()=>n.get(`computers/${s}/snaps/installed`,{params:t}),...p})},i=(c,p={})=>O({queryKey:["snaps",{...c}],queryFn:()=>n.get(`computers/${c.instance_id}/snaps/available?name_startswith=${c.query}`),...p}),f=(c,p={})=>O({queryKey:["snaps",{...c}],queryFn:()=>n.get(`computers/${c.instance_id}/snaps/${c.name}/info`),...p}),_=xe({mutationKey:["snaps","action"],mutationFn:c=>n.post("snaps",c),onSuccess:()=>{a.invalidateQueries(["snaps"]).catch(u)}});return{getSnapsQuery:g,getAvailableSnapInfo:f,getAvailableSnaps:i,snapsActionQuery:_}},ye="_bold_c3q8d_1",we="_radioGroup_c3q8d_5",$e="_marginTop_c3q8d_10",w={bold:ye,radioGroup:we,marginTop:$e};var r=(n=>(n.Switch="Switch",n.Refresh="Refresh",n.Uninstall="Uninstall",n.Hold="Hold",n.Unhold="Unhold",n))(r||{});const te=n=>n.reduce((a,u)=>(u.held_until!==null?a.held++:a.unheld++,a),{held:0,unheld:0}),le=(n,a)=>n.filter(u=>a.includes(u.snap.id)),R={deliver_immediately:I(),randomize_delivery:I(),deliver_delay_window:ve().min(0,"Delivery delay must be greater than or equal to 0"),deliver_after:I().test({test:n=>n?$(n).isValid():!0,message:"You have to enter a valid date and time"})},Be=n=>{switch(n){case r.Switch:return{...R,release:I().required("Release is required")};case r.Hold:return{...R,hold:I(),hold_until:I().test({test:a=>a?$(a).isValid():!0,message:"You have to enter a valid date and time"})};default:return{...R}}},Fe={single:{[r.Refresh]:"This will update {snapName} to the latest version available. Automatic updates will resume, and {snapName} will be upgraded based on the regular refresh schedule.",[r.Uninstall]:"This will remove the Snap from your system",[r.Hold]:"This will pause automatic updates for that particular snap. {snapName} will maintain the current version",[r.Unhold]:"This will resume automatic updates for that particular Snap. {snapName} will be eligible for the latest version upgrades based on the regular refresh schedule."},multiple:{[r.Refresh]:"This will update the selected snaps to the latest version available. Automatic updates will resume, and the snaps will be upgraded based on the regular refresh schedule.",[r.Uninstall]:"This will remove the selected snaps from your system",[r.Hold]:"Holding a Snap will pause automatic updates for that particular snap.",[r.Unhold]:"Unholding a Snap will resume automatic updates for that particular snap."}},Ie=(n,a)=>{if(n===r.Switch)return null;const{held:u,unheld:g}=te(a),i=Fe[a.length===1?"single":"multiple"][n].replaceAll("{snapName}",a[0].snap.name);return n===r.Refresh||n===r.Uninstall||a.length===1||u===0||g===0?e.jsx("p",{children:i}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:i}),e.jsxs("span",{children:["You selected ",a.length," snaps. This will:"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:[n===r.Hold?"hold":"unhold"," ",X({count:n===r.Hold?g:u,singular:"snap"})]}),e.jsxs("li",{children:["leave"," ",X({count:n===r.Hold?u:g,singular:"snap"})," ",n===r.Hold?"held":"unheld"]})]})]})},Te=({installedSnaps:n,type:a})=>{const{instanceId:u}=E(),g=D(),{notify:i}=ee(),{closeSidePanel:f}=q(),{snapsActionQuery:_,getAvailableSnapInfo:c}=P(),p=Number(u),{mutateAsync:s,isLoading:t}=_,{data:h}=c({instance_id:p,name:n[0].snap.name},{enabled:a===r.Switch}),v=b.useMemo(()=>(h==null?void 0:h.data["channel-map"].sort((x,N)=>x.channel.architecture.localeCompare(N.channel.architecture)).map(x=>({label:`${x.channel.name} - ${x.channel.architecture}`,value:`${x.channel.name} - ${x.channel.architecture}`})))??[],[h==null?void 0:h.data]),d=Be(a),j=n.length===1?n[0]:null,C=j?h==null?void 0:h.data["channel-map"][0]:null,l=je({initialValues:{release:void 0,hold:a===r.Hold?"forever":void 0,hold_until:a===r.Hold?"":void 0,deliver_immediately:!0,randomize_delivery:!1,deliver_delay_window:0,deliver_after:""},validationSchema:Ce().shape(d),onSubmit:async x=>{try{s({computer_ids:[p],action:a===r.Uninstall?"remove":a===r.Switch?"refresh":a.toLowerCase(),snaps:n.map(M=>{var k,V;return{name:M.snap.name,channel:x.release?(k=h==null?void 0:h.data["channel-map"].find(y=>`${y.channel.name} - ${y.channel.architecture}`===x.release))==null?void 0:k.channel.name:void 0,revision:(V=h==null?void 0:h.data["channel-map"].find(y=>`${y.channel.name} - ${y.channel.architecture}`===x.release))==null?void 0:V.revision.toString(),time:x.hold==="forever"?"forever":x.hold_until?$(x.hold_until).format():void 0}}),deliver_after:x.deliver_immediately?void 0:x.deliver_after?$(x.deliver_after).format():void 0,deliver_after_window:x.randomize_delivery?x.deliver_delay_window:void 0}),f();const N=a===r.Hold?"held":a===r.Unhold?"unheld":`${a.toLowerCase()}ed`;i.success({message:`You queued ${j?j.snap.name:`${n.length} snaps`} to be ${N}.`})}catch(N){g(N)}}});b.useEffect(()=>{C&&a===r.Switch&&!l.values.release&&l.setFieldValue("release",`${C.channel.name} - ${C.channel.architecture}`)},[C]);const S=x=>{l.setFieldValue("hold",x.currentTarget.value),x.currentTarget.value==="date"&&l.setFieldValue("hold_until",$().toISOString().slice(0,16))},T=x=>{const N=x.currentTarget.value==="true";l.setFieldValue("deliver_immediately",N),N||l.setFieldValue("deliver_after",$().toISOString().slice(0,16))};return e.jsxs(o.Form,{onSubmit:l.handleSubmit,noValidate:!0,children:[Ie(a,n),a===r.Switch&&e.jsx(o.Select,{label:"release",labelClassName:"p-text--small p-text--small-caps",options:v,disabled:v.length===0,...l.getFieldProps("release")}),a===r.Hold&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:w.bold,children:"Hold"}),e.jsxs("div",{className:w.radioGroup,children:[e.jsx(o.Input,{type:"radio",label:"Indefinitely",...l.getFieldProps("hold"),onChange:S,checked:l.values.hold==="forever",value:"forever"}),e.jsx(o.Input,{type:"radio",label:"Select date",...l.getFieldProps("hold"),onChange:S,checked:l.values.hold==="date",value:"date"})]}),l.values.hold==="date"&&e.jsx(o.Input,{type:"datetime-local",error:l.touched.hold_until&&l.errors.hold_until?l.errors.hold_until:void 0,...l.getFieldProps("hold_until")})]}),e.jsx("span",{className:F(w.bold,w.marginTop),children:"Delivery time"}),e.jsxs("div",{className:w.radioGroup,children:[e.jsx(o.Input,{type:"radio",label:"As soon as possible",name:"deliver_immediately",value:"true",onChange:T,checked:l.values.deliver_immediately}),e.jsx(o.Input,{type:"radio",label:"Scheduled",name:"deliver_immediately",value:"false",onChange:T,checked:!l.values.deliver_immediately})]}),!l.values.deliver_immediately&&e.jsx(o.Input,{type:"datetime-local",label:"Deliver after",labelClassName:"u-off-screen",...l.getFieldProps("deliver_after"),error:l.touched.deliver_after&&l.errors.deliver_after}),e.jsx("span",{className:F(w.bold,w.marginTop),children:"Randomise delivery over a time window"}),e.jsxs("div",{className:w.radioGroup,children:[e.jsx(o.Input,{type:"radio",label:"No",...l.getFieldProps("randomize_delivery"),onChange:async()=>{await l.setFieldValue("randomize_delivery",!1),await l.setFieldValue("deliver_delay_window",0)},checked:!l.values.randomize_delivery}),e.jsx(o.Input,{type:"radio",label:"Yes",...l.getFieldProps("randomize_delivery"),onChange:()=>l.setFieldValue("randomize_delivery",!0),checked:l.values.randomize_delivery})]}),l.values.randomize_delivery&&e.jsx(o.Input,{type:"number",inputMode:"numeric",min:0,label:"Delivery delay window",labelClassName:"u-off-screen",help:"Time in minutes",...l.getFieldProps("deliver_delay_window"),error:l.touched.deliver_delay_window&&l.errors.deliver_delay_window?l.errors.deliver_delay_window:void 0}),e.jsx(ae,{submitButtonText:a,submitButtonAppearance:a===r.Uninstall?"negative":"positive",submitButtonDisabled:t})]})},ke="_container_1nwlw_1",Ae="_noWrap_1nwlw_5",Y={container:ke,noWrap:Ae},He="_toBeConfirmedCard_t8sqm_1",qe="_toBeConfirmedCard__buttons_t8sqm_6",Ue="_toBeConfirmedCard__confirmButton_t8sqm_11",Pe="_bold_t8sqm_16",L={toBeConfirmedCard:He,toBeConfirmedCard__buttons:qe,toBeConfirmedCard__confirmButton:Ue,bold:Pe},Ve=({name:n,handleDeleteToBeConfirmedItem:a,handleAddToSelectedItems:u,instanceId:g})=>{var v;const[i,f]=b.useState(""),{getAvailableSnapInfo:_}=P(),{data:c,isLoading:p}=_({instance_id:g,name:n}),s=c==null?void 0:c.data,t=b.useMemo(()=>s?s["channel-map"].sort((d,j)=>d.channel.architecture.localeCompare(j.channel.architecture)).map(d=>({label:`${d.channel.name} - ${d.channel.architecture}`,value:`${d.channel.name} - ${d.channel.architecture}`})):[],[s]),h=d=>{f(d)};return b.useEffect(()=>{t.length>0&&f(t[0].value)},[t]),e.jsxs(e.Fragment,{children:[p&&e.jsx(U,{}),s&&e.jsx(o.Form,{name:"add-snap",onSubmit:d=>{d.preventDefault(),u({"snap-id":s["snap-id"],name:s.name,snap:s.snap,revision:s["channel-map"].find(j=>`${j.channel.name} - ${j.channel.architecture}`===i).revision.toString(),channel:s["channel-map"].find(j=>`${j.channel.name} - ${j.channel.architecture}`===i).channel.name})},children:e.jsxs("li",{className:F("p-autocomplete__result p-list__item p-card u-no-margin--bottom u-no-padding--bottom",L.toBeConfirmedCard),children:[e.jsx("div",{className:L.bold,children:s.name}),e.jsx("span",{children:e.jsx("small",{className:"u-text--muted p-text--small",children:s.snap.publisher["display-name"]})}),e.jsx(o.Select,{label:e.jsx("span",{className:"u-text--muted p-text--small",children:"Release"}),required:!0,value:i,options:t,onChange:d=>h(d.currentTarget.value),help:((v=s["channel-map"].find(d=>`${d.channel.name} - ${d.channel.architecture}`===i))==null?void 0:v.confinement)==="classic"?e.jsxs("span",{children:[e.jsx("i",{className:"p-icon--warning"}),"This release requires classic permission."," ",e.jsxs("a",{href:"https://snapcraft.io/docs",target:"_blank",rel:"noreferrer",children:["Learn more",e.jsx("i",{className:"p-icon--external-link"})]})]}):void 0}),e.jsxs("div",{className:L.toBeConfirmedCard__buttons,children:[e.jsx(o.Button,{small:!0,className:L.toBeConfirmedCard__confirmButton,type:"submit",appearance:"positive",children:"Add"}),e.jsx(o.Button,{small:!0,type:"button",appearance:"base",onClick:()=>a(),children:"Cancel"})]})]})})]})},ze="_container_1d6qb_1",Le="_suggestionsContainer_1d6qb_5",De="_pointer_1d6qb_12",Ee="_highlighted_1d6qb_17",Me="_selectedContainer_1d6qb_21",H={container:ze,suggestionsContainer:Le,pointer:De,highlighted:Ee,selectedContainer:Me},Oe=200,Re=(n,a)=>{const u=n.toLowerCase(),g=a.toLowerCase(),i=u.indexOf(g);return i>=0?e.jsxs(e.Fragment,{children:[n.substring(0,i),e.jsx("strong",{children:n.substring(i,i+a.length)}),n.substring(i+a.length)]}):n},Ye=({selectedItems:n,setSelectedItems:a,setConfirming:u})=>{var Q;const{instanceId:g}=E(),i=D(),{getAvailableSnaps:f}=P(),[_,c]=b.useState(""),[p,s]=b.useState(!1),[t,h]=b.useState(),[v,d]=b.useState(""),j=b.useRef(null),C=Number(g),{data:l,isFetching:S}=f({instance_id:C,query:_},{enabled:_.length>2}),T=((Q=l==null?void 0:l.data)==null?void 0:Q.results)??[],x=m=>!n.map(A=>A.name).includes(m),N=T.filter(m=>x(m.name));b.useEffect(()=>{var m;t||(m=j.current)==null||m.focus()},[t]);const M=m=>{a(n.filter(A=>A.name!==m))},k=()=>{h(null),u&&u(!1)},V=()=>{t||s(!1)},y=()=>{d(""),c("")},K=()=>{v.length>2?s(!0):s(!1)},re=m=>{d(m),m.length>2&&c(m)},ce=Se(()=>{try{K()}catch(m){i(m)}},Oe),de=m=>{a([...n,m]),y(),k()},ue=m=>{m&&(u(!0),h(m))},he=m=>{m.key==="Escape"?m.currentTarget.blur():ce()},W=!p&&v.length<3?"Min 3. characters":T.length===0&&_&&!S?`No snaps found by "${_}"`:null;return e.jsxs("div",{className:H.container,children:[e.jsx(Ne,{onSelect:ue,itemToString:()=>"",isOpen:p,children:({getInputProps:m,getItemProps:A,getMenuProps:me,highlightedIndex:pe})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(o.SearchBox,{...m(),placeholder:"Search for available snaps",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:v,ref:j,disabled:!!t,onChange:re,onClear:y,onBlur:V,onFocus:K,onKeyUp:he}),W?e.jsx("span",{className:"p-form-help-text",children:W}):null,p&&(N.length>0||S)?e.jsx("ul",{className:F("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",H.suggestionsContainer),...me(),children:t&&C?e.jsx(Ve,{handleAddToSelectedItems:de,handleDeleteToBeConfirmedItem:k,name:t.name,instanceId:C},t["snap-id"]):S?e.jsx(U,{}):N.map((z,J)=>e.jsxs("li",{className:F("p-list__item",H.pointer,{[H.highlighted]:pe===J}),...A({item:z,index:J}),children:[e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:Re(z.name,_)}),e.jsx("div",{children:e.jsx("small",{className:"u-text-muted",children:z.snap.publisher["display-name"]})})]},z["snap-id"]))}):null]})}),e.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:n.length?n.map(m=>e.jsxs("li",{className:F("p-autocomplete__result p-list__item p-card u-no-margin--bottom",H.selectedContainer),children:[e.jsxs("div",{children:[e.jsx("div",{children:m.name}),e.jsx("span",{children:e.jsx("small",{className:"u-text--muted p-text--small",children:`${m.snap.publisher["display-name"]} | ${m.channel}`})})]}),e.jsx(o.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>M(m.name),children:e.jsx("i",{className:"p-icon--delete"})})]},m["snap-id"])):null})]})},ie=()=>{const[n,a]=b.useState([]),[u,g]=b.useState(!1),i=D(),{notify:f}=ee(),{closeSidePanel:_}=q(),{snapsActionQuery:c}=P(),{instanceId:p}=E(),s=Number(p),{mutateAsync:t,isLoading:h}=c,v=async()=>{try{await t({computer_ids:[s],snaps:n.map(d=>({name:d.name,channel:d.channel,revision:d.revision})),action:"install"}),_(),f.success({message:`You queued ${n.length===1?`snap ${n[0].name}`:`${n.length} snaps`} to be installed.`}),a([])}catch(d){i(d)}};return e.jsxs(e.Fragment,{children:[e.jsx(Ye,{selectedItems:n,setSelectedItems:d=>a(d),setConfirming:d=>g(d)}),e.jsx(ae,{submitButtonDisabled:n.length===0||u||h,cancelButtonDisabled:h,submitButtonText:"Install snaps",submitButtonAppearance:"positive",onSubmit:v})]})},oe=({selectedSnapIds:n,installedSnaps:a,sidePanel:u=!1})=>{const{setSidePanelContent:g}=q(),i=a.length===1?a[0]:null,f=le(a,n),{held:_,unheld:c}=te(f),p=t=>{const h=t===r.Unhold?_:t===r.Hold?c:n.length,v=i?`${t} ${i.snap.name}${t===r.Switch?"'s channel":""}`:`${t} ${h} ${h===1?"snap":"snaps"}`;g(v,e.jsx(b.Suspense,{fallback:e.jsx(U,{}),children:e.jsx(Te,{installedSnaps:f,type:t})}))},s=()=>{g("Install snap",e.jsx(ie,{}))};return e.jsxs("div",{className:Y.container,children:[!u&&e.jsxs(o.Button,{type:"button",onClick:s,hasIcon:!0,className:Y.noWrap,children:[e.jsx("i",{className:"p-icon--plus"}),e.jsx("span",{children:"Install"})]}),e.jsxs("div",{className:F("p-segmented-control is-small",Y.noWrap),children:[i&&u&&e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:n.length===0,onClick:()=>p(r.Switch),children:[e.jsx("i",{className:"p-icon--fork"}),e.jsx("span",{children:"Switch channel"})]}),e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:n.length===0,onClick:()=>{p(r.Uninstall)},children:[e.jsx("i",{className:"p-icon--delete"}),e.jsx("span",{children:"Uninstall"})]}),((i==null?void 0:i.held_until)===null||!u)&&e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:c===0,onClick:()=>{p(r.Hold)},children:[e.jsx("i",{className:"p-icon--pause"}),e.jsx("span",{children:"Hold"})]}),((i==null?void 0:i.held_until)!==null||!u)&&e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:_===0,onClick:()=>{p(r.Unhold)},children:[e.jsx("i",{className:"p-icon--play"}),e.jsx("span",{children:"Unhold"})]}),e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:n.length===0,onClick:()=>{p(r.Refresh)},children:[e.jsx("i",{className:"p-icon--change-version"}),e.jsx("span",{children:"Refresh"})]})]},"buttons")]})},Ge=({installedSnap:n})=>e.jsxs(e.Fragment,{children:[e.jsx(oe,{selectedSnapIds:[n.snap.id],installedSnaps:[n],sidePanel:!0}),e.jsxs(o.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(o.Col,{size:12,children:e.jsx(B,{label:"snap name",value:n.snap.name})}),e.jsx(o.Col,{size:6,children:e.jsx(B,{label:"channel",value:n.tracking_channel})}),e.jsx(o.Col,{size:6,children:e.jsx(B,{label:"version",value:n.version})}),e.jsx(o.Col,{size:6,children:e.jsx(B,{label:"confinement",value:n.confinement})}),e.jsx(o.Col,{size:6,children:e.jsx(B,{label:"held until",value:n.held_until?$(n.held_until).format(ne):"-"})}),e.jsx(o.Col,{size:12,children:e.jsx(B,{label:"summary",value:n.snap.summary??"-"})}),e.jsx(o.Col,{size:12,children:e.jsx(B,{label:"publisher",value:n.snap.publisher.username})})]})]}),Ke="_details_9i6m6_1",We="_pause_9i6m6_5",Z={details:Ke,pause:We},Qe=({installedSnaps:n,selectedSnapIds:a,isSnapsLoading:u,setSelectedSnapIds:g})=>{const{setSidePanelContent:i}=q(),f=s=>{a.includes(s.original.snap.id)?g(a.filter(t=>t!==s.original.snap.id)):g([...a,s.original.snap.id])},_=()=>{g(a.length!==0?[]:n.map(({snap:s})=>s.id))},c=s=>{i(`${s.snap.name} details`,e.jsx(b.Suspense,{fallback:e.jsx(U,{}),children:e.jsx(Ge,{installedSnap:s})}))},p=b.useMemo(()=>[{Header:e.jsxs(e.Fragment,{children:[e.jsx(o.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:_,checked:a.length===n.length&&n.length!==0,indeterminate:a.length!==0&&a.length<n.length}),e.jsx("span",{children:"Name"})]}),accessor:"name",Cell:({row:s})=>e.jsxs(e.Fragment,{children:[e.jsx(o.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:s.original.snap.name}),inline:!0,checked:a.includes(s.original.snap.id),onChange:()=>{f(s)}}),e.jsx(o.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{c(s.original)},"aria-label":`Show details of snap ${s.original.snap.name}`,children:s.original.snap.name})]})},{Header:"Channel",accessor:"channel",Cell:({row:s})=>e.jsx(e.Fragment,{children:s.original.tracking_channel})},{Header:"Held until",accessor:"held_until",Cell:({row:s})=>e.jsx(e.Fragment,{children:s.original.held_until?$(s.original.held_until).format(ne):"-"})},{Header:"Version",accessor:"version",Cell:({row:s})=>e.jsx(e.Fragment,{children:s.original.held_until?e.jsx(o.Tooltip,{message:"This snap is held",children:s.original.version}):s.original.version}),getCellIcon:({row:s})=>s.original.held_until?`pause ${Z.pause}`:null},{Header:"Summary",accessor:"summary",className:Z.details,Cell:({row:s})=>e.jsx(e.Fragment,{children:s.original.snap.summary})}],[a,n]);return e.jsx(e.Fragment,{children:e.jsx(o.ModularTable,{columns:p,data:n,emptyMsg:u?"Loading...":"No snaps found from the search"})})},Je="_container_1qwn6_1",Xe="_searchContainer_1qwn6_6",Ze="_selectContainer_1qwn6_10",en="_cta_1qwn6_15",G={container:Je,searchContainer:Xe,selectContainer:Ze,cta:en},nn=({handleClearSelection:n,selectedSnapIds:a,installedSnaps:u})=>{const{search:g,setPageParams:i}=se(),[f,_]=b.useState(g),c=()=>{i({search:f}),n()},p=()=>{i({search:""})},s=t=>{t.preventDefault(),c()};return e.jsxs("div",{className:G.container,children:[e.jsx("div",{className:G.searchContainer,children:e.jsx(o.Form,{onSubmit:s,noValidate:!0,children:e.jsx(o.SearchBox,{shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:f,"aria-label":"Snap search",onChange:t=>_(t),onSearch:c,onClear:p})})}),e.jsx("div",{className:G.cta,children:e.jsx(oe,{selectedSnapIds:a,installedSnaps:le(u,a)})})]})},an=()=>{var C,l;const[n,a]=b.useState([]),{instanceId:u,childInstanceId:g}=E(),{search:i,currentPage:f,pageSize:_}=se(),{getSnapsQuery:c}=P(),{setSidePanelContent:p}=q(),s=Number(g??u),{data:t,isLoading:h}=c({instance_id:s,limit:_,offset:(f-1)*_,search:i}),v=()=>{p("Install snap",e.jsx(ie,{}))},d=b.useMemo(()=>{var S;return((S=t==null?void 0:t.data)==null?void 0:S.results)??[]},[t]),j=()=>{a([])};return e.jsxs(e.Fragment,{children:[!i&&h&&f===1&&_===20&&e.jsx(U,{}),!h&&!i&&(!t||t.data.results.length===0)&&e.jsx(fe,{title:"You haven't installed any snaps yet",body:e.jsx("p",{className:"u-no-margin--bottom",children:"Install Snaps by clicking the button below."}),cta:[e.jsx(o.Button,{appearance:"positive",onClick:v,children:"Install Snap"},"empty-state-install-snap")]}),(i||f!==1||_!==20||t&&(t==null?void 0:t.data.results.length)>0)&&e.jsxs(e.Fragment,{children:[e.jsx(nn,{selectedSnapIds:n,installedSnaps:d,handleClearSelection:j}),e.jsx(Qe,{selectedSnapIds:n,setSelectedSnapIds:S=>a(S),installedSnaps:d,isSnapsLoading:h})]}),e.jsx(be,{handleClearSelection:j,totalItems:(C=t==null?void 0:t.data)==null?void 0:C.count,currentItemCount:(l=t==null?void 0:t.data)==null?void 0:l.results.length})]})},vn=an;export{vn as default};
