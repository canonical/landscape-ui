const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CzTI9yrc.js","assets/index-AuWFo_8-.js","assets/index-B4xaleMR.css","assets/CodeEditor-BTM0Ao0y.js","assets/index-CKtcXk6O.js","assets/CodeEditor-KxSGUzo3.css","assets/SidePanelFormButtons-ChyPpboq.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/HeaderWithSearch-PmKm4WqR.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/Chip-DZwzWul0.js","assets/Chip-R6WqXyae.css","assets/constants-BV2N5vIK.js","assets/SidePanelTablePagination-Yx0-Y3JN.js","assets/constants-WSiD7ELM.js","assets/index-ZQQe9POB.css"])))=>i.map(i=>d[i]);
import{b as y,g as I,h as T,i as M,v as ee,w as te,x as w,l as d,o as se,p as N,n as A,q as ne,j as e,d as o,s as E,am as ae,A as f,C as D,K as g,z as F,N as v,_ as q,Z as B,ap as ie,ay as le,aq as oe,k as re,E as ce,an as ue}from"./index-AuWFo_8-.js";import"./index-CKtcXk6O.js";import{H as de}from"./HeaderWithSearch-PmKm4WqR.js";import{C as R}from"./Chip-DZwzWul0.js";import{L as me}from"./constants-BV2N5vIK.js";import{C as pe}from"./CodeEditor-BTM0Ao0y.js";import{S as he}from"./SidePanelFormButtons-ChyPpboq.js";import{S as fe}from"./SidePanelTablePagination-Yx0-Y3JN.js";import{L as xe}from"./constants-WSiD7ELM.js";const U=()=>{const t=y(),s=I(),{isPending:a,mutateAsync:n}=T({mutationFn:async i=>t.post("autoinstall",i),onSuccess:async()=>s.invalidateQueries({queryKey:["autoinstallFiles"]})});return{isAutoinstallFileAdding:a,addAutoinstallFile:n}},_e=()=>{const t=y(),s=I(),{isPending:a,mutateAsync:n}=T({mutationFn:async({id:i})=>t.delete(`autoinstall/${i}`),onSuccess:async()=>s.invalidateQueries({queryKey:["autoinstallFiles"]})});return{deleteAutoinstallFile:n,isAutoinstallFileUpdating:a}},z=({id:t,...s})=>{const a=y(),{data:n,isLoading:i}=M({queryKey:["autoinstallFiles",t,{...s}],queryFn:async()=>a.get(`autoinstall/${t}`,{params:s})});return{autoinstallFile:n?.data,isAutoinstallFileLoading:i}},H=(t,s={})=>{const a=y(),{data:n,isLoading:i,isFetching:l}=M({queryKey:["autoinstallFiles",t],queryFn:async()=>a.get("autoinstall",{params:t}),...s});return{autoinstallFiles:n?.data.results??[],autoinstallFilesCount:n?.data.count,isAutoinstallFilesLoading:i,isFetching:l}},G=()=>{const t=y(),s=I(),{isPending:a,mutateAsync:n}=T({mutationFn:async({id:i,...l})=>t.patch(`autoinstall/${i}`,l),onSuccess:async()=>{await s.invalidateQueries({queryKey:["autoinstallFiles"]})}});return{isAutoinstallFileUpdating:a,updateAutoinstallFile:n}},L="yaml",k=`.${L}`,Y=[L,"yml"],$=t=>t.replace(new RegExp(`\\.(${Y.join("|")})$`),""),Ae="_form_1dly8_1",ge="_inputContainer_1dly8_7",ye="_input_1dly8_7",je="_inputDescription_1dly8_16",b={form:Ae,inputContainer:ge,input:ye,inputDescription:je},be=ee().shape({contents:w().required("This field is required"),filename:w().required("This field is required"),is_default:te()}),Fe={contents:"",filename:"",is_default:!1},ve=(t,s)=>t===s,K=({buttonText:t,description:s,initialFile:a=Fe,notification:n,onSubmit:i})=>{const l=t==="Add",c=d.useRef(null),u=se(),{notify:m}=N(),{closeSidePanel:x}=A(),r=ne({initialValues:{contents:a.contents,is_default:a.is_default,filename:$(a.filename)},validationSchema:be,onSubmit:async p=>{const _=`${p.filename}${k}`;try{await i({contents:p.contents,is_default:p.is_default,filename:_}),x(),m.success({message:`The autoinstall file ${_} ${n.message}`,title:`${n.title} ${_}`})}catch(j){u(j)}}}),C=async({target:{files:p}})=>{if(!p)return;const[_]=p,j=r.setFieldValue("contents",await _.text());if(r.values.filename){await j;return}await Promise.all([r.setFieldValue("filename",$(_.name)),j])},h=async p=>{await r.setFieldValue("contents",p)},S=()=>{c.current?.click()};return e.jsxs(o.Form,{className:b.form,noValidate:!0,onSubmit:r.handleSubmit,children:[e.jsx("span",{children:s}),e.jsxs("div",{className:b.inputContainer,children:[e.jsx(o.Input,{wrapperClassName:b.input,type:"text",label:"File name",...r.getFieldProps("filename"),error:E(r,"filename"),disabled:!!a.filename,required:!0}),e.jsx("span",{className:b.inputDescription,children:k})]}),l&&e.jsx(o.Input,{type:"checkbox",label:"Default",...r.getFieldProps("is_default"),help:"This file will be used to configure newly registered instances. Only one default file can be set at a time."}),e.jsx("input",{ref:c,className:"u-hide",type:"file",accept:Y.map(p=>`.${p}`).join(","),onChange:C}),e.jsx(pe,{label:"Code",value:r.values.contents,onChange:h,error:E(r,"contents"),required:!0,language:L,headerContent:e.jsxs(o.Button,{className:"u-no-margin--bottom",appearance:"base",hasIcon:!0,onClick:S,type:"button",children:[e.jsx(o.Icon,{name:"upload"}),e.jsx("span",{children:"Populate from file"})]})}),e.jsx(he,{submitButtonDisabled:ve(r.values.contents,a.contents)||r.isSubmitting,submitButtonText:t})]})},Ce="_container_fgz2s_1",Se={container:Ce},Q=({openAddForm:t})=>e.jsxs(e.Fragment,{children:[e.jsx(de,{actions:e.jsx("div",{className:Se.container,children:e.jsxs(o.Button,{type:"button",className:"u-no-margin",hasIcon:!0,onClick:t,children:[e.jsx(o.Icon,{name:"plus"}),e.jsx("span",{children:"Add new"})]})})}),e.jsx(ae,{filtersToDisplay:["search"]})]}),Ie={message:"has been edited and all the changes made have been saved successfully.",title:"You have successfully saved changes for"},Te=({autoinstallFile:t})=>{const{autoinstallFile:s,isAutoinstallFileLoading:a}=z({id:t.id,with_metadata:!0}),{updateAutoinstallFile:n}=G();return a||!s?e.jsx(f,{}):e.jsxs(e.Fragment,{children:[s.metadata.max_versions<=s.version&&e.jsx(o.Notification,{inline:!0,title:"Edit history limit reached:",severity:"caution",children:e.jsxs("p",{children:["You've reached the limit of"," ",s.metadata.max_versions," saved"," ",D(s.metadata.max_versions,"edit"),". To save your new change, the oldest version will be automatically removed, keeping the most recent"," ",s.metadata.max_versions," ",D(s.metadata.max_versions,"version")," ","in history."]})}),e.jsx(K,{buttonText:"Save changes",description:`The duplicated ${s.filename} will be assigned to the same user groups in the identity provider as the original file.`,initialFile:s,notification:Ie,onSubmit:async({contents:i,is_default:l})=>{await n({id:s.id,contents:i,is_default:l})}})]})},Ne="_chip_1aiey_1",Le="_container_1aiey_6",O={chip:Ne,container:Le},P=({file:t,title:s,version:a=t.version})=>e.jsxs("div",{className:O.container,children:[!!s&&`${s} `,t.filename,", v",a,t.is_default&&e.jsx(R,{className:O.chip,value:"Default"})]}),W=({autoinstallFile:t,close:s})=>{const{notify:a}=N(),{closeSidePanel:n}=A(),{deleteAutoinstallFile:i}=_e(),l=async()=>{await i({id:t.id}),s(),n(),a.success({message:`The autoinstall file ${t.filename} has been permanently removed. All Employee accounts previously relying on it through identity provider group assignments will now fall back to the default autoinstall file.`,title:`You have successfully removed ${t.filename} autoinstall file.`})};return e.jsx(o.ConfirmationModal,{close:s,confirmButtonAppearance:"negative",confirmButtonLabel:"Remove",onConfirm:l,title:`Remove ${t.filename}, autoinstall file`,children:e.jsxs("p",{children:["You are about to remove ",t.filename,", an autoinstall file. This action is irreversible. All Employee accounts previously assigned this file via identity provider will instead use the default autoinstall file."]})})},Pe=({file:t})=>e.jsxs(g,{children:[e.jsx(g.Item,{label:"Name",value:t.filename}),e.jsx(g.Item,{label:"Version",value:t.version}),e.jsx(g.Item,{label:"Last modified",value:F(t.last_modified_at).format(v)}),e.jsx(g.Item,{label:"Date created",value:F(t.created_at).format(v)})]}),we=d.lazy(async()=>q(()=>import("./index-CzTI9yrc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),Ee=({file:t,viewVersionHistory:s})=>{const{setSidePanelContent:a}=A(),{autoinstallFile:n,isAutoinstallFileLoading:i}=z({id:t.id,with_metadata:!0}),[l,c]=d.useState(1),[u,m]=d.useState(20),x=n?n.metadata.versions:[],r=x.slice(l-1,l*u),C=d.useMemo(()=>[{accessor:"version",Header:"Version",Cell:({row:{original:h}})=>{const S=()=>{a(e.jsx(P,{file:t,version:h.version}),e.jsx(d.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(we,{file:t,goBack:s,versionInfo:h})}))};return e.jsxs(o.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:S,children:["Version ",h.version]})}},{accessor:"created_at",Header:"Created at",Cell:({row:{original:{created_at:h}}})=>e.jsx("div",{className:"font-monospace",children:F(h).format(v)})}],[]);return i?e.jsx(f,{}):e.jsxs(e.Fragment,{children:[e.jsx(o.ModularTable,{columns:C,data:r}),e.jsx(fe,{currentItemCount:r.length,currentPage:l,pageSize:u,paginate:c,setPageSize:m,totalItems:x.length})]})},De="_tabs_1ks86_1",ke={tabs:De},$e=[{id:"info",label:"Info"},{id:"version-history",label:"Version history"}],Oe=({file:t,viewVersionHistory:s,initialTabId:a="info"})=>{const[n,i]=d.useState(a),l=$e.map(({label:c,id:u})=>({label:c,active:u===n,role:"tab",onClick:()=>{i(u)}}));return e.jsxs(e.Fragment,{children:[e.jsx(o.Tabs,{listClassName:ke.tabs,links:l}),n==="info"&&e.jsx(Pe,{file:t}),n==="version-history"&&e.jsx(Ee,{file:t,viewVersionHistory:s})]})},Ve=({autoinstallFile:t,initialTabId:s})=>{const{value:a,setTrue:n,setFalse:i}=B(),{openAutoinstallFileDetails:l,openAutoinstallFileEditForm:c,setAutoinstallFileAsDefault:u}=Z(t),m=()=>{l("version-history")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button",onClick:c,hasIcon:!0,children:[e.jsx(o.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button",onClick:u,disabled:t.is_default,hasIcon:!0,children:[e.jsx(o.Icon,{name:"starred"}),e.jsx("span",{children:"Set as default"})]}),e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button",onClick:n,disabled:t.is_default,hasIcon:!0,children:[e.jsx(o.Icon,{name:o.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]})}),e.jsx(Oe,{initialTabId:s,file:t,viewVersionHistory:m}),a&&e.jsx(W,{autoinstallFile:t,close:i})]})},X=()=>{const{setSidePanelContent:t}=A();return(s,a)=>{t(e.jsx(P,{file:s}),e.jsx(d.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(Ve,{initialTabId:a,autoinstallFile:s})}))}},Z=t=>{const{notify:s}=N(),{closeSidePanel:a,setSidePanelContent:n}=A(),{updateAutoinstallFile:i}=G(),l=X();return{openAutoinstallFileDetails:c=>{l(t,c)},openAutoinstallFileEditForm:()=>{n(e.jsx(P,{file:t,title:"Edit"}),e.jsx(d.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(Te,{autoinstallFile:t})}))},setAutoinstallFileAsDefault:async()=>{await i({id:t.id,is_default:!0}),a(),s.success({message:"Employee accounts without a specific autoinstall file assigned via the identity provider will now inherit this default file.",title:`You have successfully set ${t.filename} as the default autoinstall file`})}}},Me=({autoinstallFile:t})=>{const{value:s,setTrue:a,setFalse:n}=B(),{openAutoinstallFileDetails:i,openAutoinstallFileEditForm:l,setAutoinstallFileAsDefault:c}=Z(t),u=()=>{i()},m=[{icon:"show",label:"View details","aria-label":`View ${t.filename} details`,onClick:u},{icon:"edit",label:"Edit","aria-label":`Edit ${t.filename}`,onClick:l},{icon:"starred",label:"Set as default","aria-label":`Set ${t.filename} as default`,onClick:c,disabled:t.is_default}],x=[{icon:"delete",label:"Remove","aria-label":`Remove ${t.filename}`,onClick:a,disabled:t.is_default}];return e.jsxs(e.Fragment,{children:[e.jsx(ie,{toggleAriaLabel:`${t.filename} actions`,actions:m,destructiveActions:x}),s&&e.jsx(W,{autoinstallFile:t,close:n})]})},qe="_container_56wd4_1",Be="_header_56wd4_6",V={container:qe,header:Be},Re=({column:t})=>{{const s={};switch(t.id){case"filename":s.role="rowheader";break;case"last_modified_at":s["aria-label"]="last modified at";break}return s}},Ue=()=>({}),J=({autoinstallFiles:t})=>{const s=X(),a=d.useMemo(()=>[{...xe,accessor:"filename",Header:e.jsxs("div",{className:V.header,children:["Name",e.jsx("span",{className:"u-text--muted",children:"Version"})]}),Cell:({row:{original:n}})=>e.jsxs(le,{children:[e.jsxs("div",{className:V.container,children:[e.jsx(o.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top u-align-text--left",onClick:()=>{s(n)},children:n.filename}),n.is_default&&e.jsx(R,{value:"Default"})]}),e.jsxs("span",{className:"u-text--muted",children:["Version ",n.version]})]})},{accessor:"last_modified_at",Header:"Last edited",Cell:({row:{original:{last_modified_at:n}}})=>e.jsx("div",{className:"font-monospace",children:F(n).format(v)})},{...me,Cell:({row:{original:n}})=>e.jsx(Me,{autoinstallFile:n})}],[]);return e.jsx(oe,{columns:a,data:t,emptyMsg:"No autoinstall files found according to your search parameters.",getCellProps:Re,getRowProps:Ue})},ze=Object.freeze(Object.defineProperty({__proto__:null,AutoinstallFileForm:K,AutoinstallFilesHeader:Q,AutoinstallFilesList:J,useAddAutoinstallFile:U,useGetAutoinstallFiles:H},Symbol.toStringTag,{value:"Module"})),He={message:"is now available and can be assigned to identity provider user groups.",title:"You have successfully added"},Ge=d.lazy(async()=>q(()=>Promise.resolve().then(()=>ze),void 0).then(t=>({default:t.AutoinstallFileForm}))),Ye=()=>{const{currentPage:t,pageSize:s,search:a}=re(),{setSidePanelContent:n}=A(),{addAutoinstallFile:i}=U(),{autoinstallFiles:l,autoinstallFilesCount:c,isAutoinstallFilesLoading:u}=H({limit:s,offset:(t-1)*s,search:a}),m=()=>{n("Add new autoinstall file",e.jsxs(d.Suspense,{fallback:e.jsx(f,{}),children:[e.jsx(Ge,{buttonText:"Add",description:"Add autoinstall file. It can be applied during the initial setup of associated instances.",notification:He,onSubmit:i}),","]}))};return!l.length&&!a&&!u?e.jsx(ce,{icon:"file",title:"No autoinstall files found",body:e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any autoinstall files yet."}),cta:[e.jsx(o.Button,{appearance:"positive",onClick:m,className:"u-no-margin--right",children:"Add autoinstall file"},"add-autoinstall-file")]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{openAddForm:m}),u?e.jsx(f,{}):e.jsx(J,{autoinstallFiles:l}),e.jsx(ue,{currentItemCount:l.length,totalItems:c})]})},nt=Object.freeze(Object.defineProperty({__proto__:null,default:Ye},Symbol.toStringTag,{value:"Module"}));export{k as A,L as a,nt as b,$ as r,z as u};
