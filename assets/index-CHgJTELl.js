const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-YP0uxprF.js","assets/index-2fzpjuii.js","assets/index-DBjrXwEZ.css","assets/EmployeeGroupIdentityIssuerList-CJir__7d.js","assets/HeaderWithSearch-BIg5d4wD.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/index-0zPblRXu.js","assets/TruncatedCell-CgdNfcLB.js","assets/TruncatedCell-CoXbu3VM.css","assets/EmployeeGroupIdentityIssuerList-DJkUyphv.css"])))=>i.map(i=>d[i]);
import{f as M,i as I,g as C,r,y as P,h as $,j as e,m as d,am as z,l as D,z as R,o as j,E as q,an as Q,_ as H}from"./index-2fzpjuii.js";import{S as K}from"./SidePanelFormButtons-DAl7F5tV.js";import"./EmployeeGroupIdentityIssuerList-CJir__7d.js";import{u as E}from"./useGetEmployeeGroups-DPKkjeTb.js";import{I as G,S as V}from"./SidePanelDescription-f11hpB5b.js";import{S as Y}from"./SidePanelTablePagination-BzWZrZMh.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./HeaderWithSearch-BIg5d4wD.js";import"./index-0zPblRXu.js";import"./TruncatedCell-CgdNfcLB.js";const U=()=>{const a=M(),i=I(),{mutateAsync:m,isPending:s}=C({mutationFn:async({staged_oidc_group_ids:c,import_all:n})=>i.post("/employee_groups",{staged_oidc_group_ids:c,import_all:n}),onSuccess:async()=>a.invalidateQueries({queryKey:["employeeGroups"]})});return{importEmployeeGroups:m,isEmployeeGroupsImporting:s}},W=({issuerId:a,pageSize:i,currentPage:m,search:s})=>{const{employeeGroupsCount:c}=E(),[n,x]=r.useState(null),g=I(),S=P(),h={import_session_id:n==null?void 0:n.id,exclude_imported:c&&c>0,offset:(m-1)*i,limit:i,search:s},{mutateAsync:b,isPending:f}=C({mutationFn:async({issuer_id:p})=>g.post("/oidc/groups/import_session",{issuer_id:p})});r.useEffect(()=>{b({issuer_id:a}).then(({data:p})=>{x(p)}).catch(S)},[]);const{data:u,isLoading:l}=$({queryKey:["stagedOidcGroups",h],queryFn:async()=>g.get("/oidc/groups/staged",{params:h}),enabled:n!==null});return{stagedOidcGroups:(u==null?void 0:u.data.results)??[],stagedOidcGroupsCount:(u==null?void 0:u.data.count)??0,isStagedOidcGroupsLoading:f||l}},Z=()=>{const{employeeGroupsCount:a}=E();return a&&a<=G?null:e.jsx("div",{children:e.jsx(d.Notification,{severity:"negative",title:"Group limit reached",children:`You've reached the limit of ${G.toLocaleString()} groups. Remove excess groups to proceed.`})})},J="_checkbox_1ksvx_1",_={checkbox:J},X=r.lazy(async()=>H(()=>import("./index-YP0uxprF.js").then(a=>a.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),le=({issuer:a})=>{const[i,m]=r.useState(""),[s,c]=r.useState([]),[n,x]=r.useState(!0),[g,S]=r.useState(1),[h,b]=r.useState(z[0].value),{setSidePanelContent:f,closeSidePanel:u}=D(),{stagedOidcGroups:l,stagedOidcGroupsCount:p,isStagedOidcGroupsLoading:y}=W({issuerId:a.id,pageSize:h,currentPage:g,search:i}),k=P(),{notify:v}=R(),{importEmployeeGroups:N,isEmployeeGroupsImporting:O}=U(),F=t=>{c([]),S(t)},L=t=>{c([]),b(t)},B=async t=>{t.preventDefault();try{const{data:{count:o}}=await N({staged_oidc_group_ids:s,import_all:n});u(),v.success({title:`Youâ€™ve successfully Imported ${o} Employee ${o>1?"groups":"group"}.`,message:"Newly added Employee groups can now be managed within Landscape."})}catch(o){k(o)}},T=t=>{c(s.includes(t)?s.filter(o=>o!==t):[...s,t])},w=()=>{f("Choose an identity issuer",e.jsx(r.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(X,{})}))},A=r.useMemo(()=>{const t={accessor:"name",Header:"name",Cell:({row:{original:{name:o}}})=>e.jsx(e.Fragment,{children:e.jsx("span",{children:o})})};return n?[t]:[{accessor:"id",className:"checkbox-column",Header:()=>e.jsx(d.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all employee groups"}),disabled:l.length===0||y,indeterminate:s.length>0&&s.length<l.length,checked:s.length>0&&s.length===l.length,onChange:()=>{c(s.length>0?[]:l.map(({id:o})=>o))}}),Cell:({row:{original:o}})=>e.jsx(d.CheckboxInput,{labelClassName:"u-no-margin--bottom u-no-padding--top",label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${o.name}`}),disabled:y,name:"employee-group-checkbox",checked:s.includes(o.id),onChange:()=>{T(o.id)}})},t]},[s,y,l,n]);return y&&!i?e.jsx(j,{}):!p&&!i?e.jsx(q,{title:"No employee groups found",body:e.jsx("p",{className:"u-no-margin--bottom",children:`Seems like there are no employee groups to import from ${a.provider.provider_label}.`})}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsx(V,{children:"Choose employee groups to import into Landscape. Once imported, you can set their priority, assign Autoinstall files, and manage associated employees."}),e.jsx("div",{className:_.checkbox,children:e.jsx(d.CheckboxInput,{label:"Import all groups",onChange:()=>{x(t=>!t)},checked:n})}),e.jsx(Q,{onSearch:t=>{m(t)}}),y?e.jsx(j,{}):e.jsxs(d.Form,{noValidate:!0,onSubmit:B,children:[e.jsx(d.ModularTable,{data:l,columns:A,emptyMsg:`No employee groups found with the search: "${i}"`}),e.jsx(Y,{currentPage:g,pageSize:h,paginate:F,setPageSize:L,totalItems:p,className:_.pagination}),e.jsx(K,{hasBackButton:!0,onBackButtonPress:w,submitButtonText:"Import",submitButtonDisabled:!n&&s.length===0||O})]})]})};export{le as default};
