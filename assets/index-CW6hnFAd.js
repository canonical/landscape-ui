const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CMHp3xPb.js","assets/index-D2k2h3rl.js","assets/index-DQXBeV4P.css","assets/moment-C5S46NFB.js","assets/useInstances-C8qOtNZd.js","assets/useFetchOld-u8CFTbAp.js","assets/moment-C95_Hi5e.js","assets/TablePagination-aO94DQrL.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-CF9qKZgS.js","assets/TableFilterChips-DvQnBNIX.js","assets/TableFilterChips-Bkpu0rSB.css","assets/NoData-N6VAhUVA.js","assets/index-4jXkfcLF.css"])))=>i.map(i=>d[i]);
import{j as e,E as z,d as o,c as O,r as l,_ as Q,h as U,e as G,i as M,f as N,g as $,o as S,T as J,t as X,k as Z,n as H,p as ee,L as te,R as se,D as ae}from"./index-D2k2h3rl.js";import{m as ie}from"./moment-C95_Hi5e.js";import{T as ne}from"./TablePagination-aO94DQrL.js";import{u as C}from"./usePageParams-CF9qKZgS.js";import{T as V,t as b,a as re}from"./TableFilterChips-DvQnBNIX.js";import{u as oe}from"./useFetchOld-u8CFTbAp.js";import{N as q}from"./NoData-N6VAhUVA.js";const ce=()=>e.jsx(z,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no activities yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage computers in Landscape"})]}),icon:"switcher-environments",title:"No activities found"}),le="_wrapper_1avtj_1",ue="_search_1avtj_9",de="_buttonContainer_1avtj_13",pe="_button_1avtj_13",me="_icon_1avtj_43",j={wrapper:le,search:ue,buttonContainer:de,button:pe,icon:me},he=({inputValue:s,onDescriptionClick:t,onInputChange:i,onSearchClick:c,onClear:r})=>e.jsxs("div",{className:j.wrapper,children:[e.jsx(o.SearchBox,{autocomplete:"off",shouldRefocusAfterReset:!0,externallyControlled:!0,value:s,onChange:i,onSearch:c,onClear:r,className:O("u-no-margin--bottom",j.search)}),e.jsx("div",{className:j.buttonContainer,children:e.jsx(o.Button,{type:"button",onClick:t,className:j.button,children:e.jsx(o.Icon,{name:o.ICONS.help,className:j.icon})})})]}),ge="_term_1p61y_1",ye={term:ge},fe=({open:s,onClose:t,data:i})=>{const c=[{Header:"Term",accessor:"term",className:ye.term,Cell:({value:r})=>typeof r=="string"?e.jsx("code",{children:r}):null},{Header:"Description",accessor:"description",Cell:({value:r})=>typeof r=="string"||l.isValidElement(r)?e.jsx("span",{className:"u-text--muted",children:r}):null}];return s&&e.jsxs(o.Modal,{title:"Search help",close:t,children:[e.jsx("p",{children:"Available search terms for use in the search box. If multiple search terms are separated by OR, any of the conditions will match. Otherwise, all conditions must be met for a instance to match. When a term is preceded by NOT, the condition must not match. If the searched value contains spaces or non-ASCII characters, it must be quoted."}),e.jsx(o.ModularTable,{className:"u-no-margin--bottom",columns:l.useMemo(()=>c,[]),data:l.useMemo(()=>i,[])})]})},xe="_container_1le1l_1",_e="_sticky_1le1l_9",ve="_searchContainer_1le1l_15",be="_filters_1le1l_19",F={container:xe,sticky:_e,searchContainer:ve,filters:be},je="_iconError_xphpu_1",Se="_iconWarning_xphpu_5",Ce="_iconWarningRed_xphpu_9",P={iconError:je,iconWarning:Se,iconWarningRed:Ce},E={succeeded:{icon:"success",label:"Succeeded"},scheduled:{icon:"spinner",label:"Scheduled"},waiting:{icon:"status-waiting",label:"Waiting"},undelivered:{icon:"status-queued",label:"Queued"},delivered:{icon:"status-in-progress",label:"In progress"},blocked:{icon:`warning-grey ${P.iconWarningRed}`,label:"Blocked"},unapproved:{icon:`warning-grey ${P.iconWarning}`,label:"Unapproved"},canceled:{icon:"error-grey",label:"Cancelled"},failed:{icon:`error-grey ${P.iconError}`,label:"Failed"}},Te=[{term:"id:<activity_id>",description:"Search for activities with a specific ID."},{term:"parent-id:<parent_id>",description:"Search for children activities of a specific ID."},{term:"created-after:<date>",description:e.jsxs("span",{children:["Search for activities created after a specific date or time, specified with the ISO-8601 format. The precision depends on how far you specify, for example ",e.jsx("code",{children:"2011-01"}),", ",e.jsx("code",{children:"2011-01-01"}),","," ",e.jsx("code",{children:"2011-01-01T10:30"})," are valid values."]})},{term:"created-before:<date>",description:"Search for activities created before a specific date or time. The format is the same as created-after."},{term:"creator:<email>",description:"Search for activities created by a particular person (specified by email address)."},{term:"computer:<criteria>",description:"Search for activities related to the given instances. The criteria is itself another query argument to search instances. See Instance Queries for details."},{term:"type:<type>",description:"Search for activities of a specific type."}],R=[{label:"All",value:""},...Object.entries(E).filter(([s])=>s!=="unapproved").map(([s,{label:t}])=>({label:t,value:s}))],Ae=({options:s})=>{const{setPageParams:t,status:i}=C();return e.jsx(V,{multiple:!1,label:"Status",hasToggleIcon:!0,hasBadge:!0,options:s,onItemSelect:c=>t({status:c}),selectedItem:i})},De=({options:s})=>{const[t,i]=l.useState(""),{setPageParams:c,type:r}=C(),u=s.filter(d=>d.label.toLowerCase().includes(t.toLowerCase()));return e.jsx(V,{multiple:!1,label:"Type",hasToggleIcon:!0,hasBadge:!0,onSearch:d=>i(d),options:u,onItemSelect:d=>c({type:d}),selectedItem:r})},ke=l.lazy(()=>Q(()=>import("./index-CMHp3xPb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])));function B(){const s=oe(),t=U(),i=G(),{setSidePanelContent:c}=M(),r=(n={},h={})=>$({queryKey:["activities",n],queryFn:()=>t.get("activities",{params:n}),...h}),u=({activityId:n,...h},x={})=>$({queryKey:["activities",{activityId:n,...h}],queryFn:()=>t.get(`activities/${n}`,{params:h}),...x}),d=(n={},h={})=>$({queryKey:["activityTypes"],queryFn:()=>s.get("GetActivityTypes",{params:n}),...h}),v=N({mutationKey:["activities","cancel"],mutationFn:n=>s.get("CancelActivities",{params:n}),onSuccess:()=>i.invalidateQueries({queryKey:["activities"]})}),g=N({mutationKey:["activities","approve"],mutationFn:n=>s.get("ApproveActivities",{params:n}),onSuccess:()=>i.invalidateQueries({queryKey:["activities"]})}),p=N({mutationFn:n=>t.post("activities/reapply",n),onSuccess:()=>i.invalidateQueries({queryKey:["activities"]})}),T=N({mutationFn:n=>t.post("activities/revert",n),onSuccess:()=>i.invalidateQueries({queryKey:["activities"]})});return{getActivitiesQuery:r,getSingleActivityQuery:u,getActivityTypesQuery:d,cancelActivitiesQuery:v,approveActivitiesQuery:g,redoActivitiesQuery:p,undoActivitiesQuery:T,openActivityDetails:n=>{c(n.summary,e.jsx(l.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(ke,{activityId:n.id})}))}}}function Ie(s){const{state:t}=J(),i=t==null?void 0:t.activity;l.useEffect(()=>{t!=null&&t.activity&&(s(t.activity),window.history.replaceState({},""))},[i])}const Ne="_container_1r60q_1",Fe="_buttons_1r60q_6",L={container:Ne,buttons:Fe},$e=()=>{const[s,t]=l.useState(!1),{setPageParams:i,fromDate:c,toDate:r}=C(),u=X({initialValues:{fromDate:c||"",toDate:r||""},enableReinitialize:!0,validationSchema:Z().shape({fromDate:H(),toDate:H()}),onSubmit:d=>{i({fromDate:d.fromDate,toDate:d.toDate}),t(!1)}});return e.jsx(o.ContextualMenu,{visible:s,autoAdjust:!0,toggleAppearance:"base",toggleLabel:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Date range"}),e.jsx("span",{className:O(b.badgeContainer),children:c||r?e.jsx(o.Badge,{value:c&&r?2:1,className:b.badge}):null})]}),toggleClassName:b.toggle,toggleProps:{onClick:()=>{t(!s)}},hasToggleIcon:!0,dropdownClassName:b.dropdown,position:"left",children:e.jsxs(o.Form,{onSubmit:u.handleSubmit,noValidate:!0,className:L.container,children:[e.jsxs("div",{className:b.container,children:[e.jsx(o.Input,{type:"datetime-local",label:"From",...u.getFieldProps("fromDate")}),e.jsx(o.Input,{type:"datetime-local",label:"To",...u.getFieldProps("toDate")})]}),e.jsxs("div",{className:L.buttons,children:[e.jsx(o.Button,{small:!0,type:"button",appearance:"base",onClick:()=>{t(!1),u.resetForm()},children:"Cancel"}),e.jsx(o.Button,{small:!0,type:"submit",appearance:"positive",children:"Add"})]})]})})},Pe=({resetSelectedIds:s})=>{const{search:t,setPageParams:i}=C(),{instanceId:c}=ee(),{getActivityTypesQuery:r}=B(),[u,d]=l.useState(""),[v,g]=l.useState(!1),{data:p}=r(),A=((p==null?void 0:p.data)??[]).map(y=>({label:y,value:y})),n=[{label:"All",value:""},...A],h=!!c,x=()=>{u&&(i({search:t?`${t},${u}`:`${u}`}),d(""),s())},_=()=>{i({search:""})},D=y=>{y.preventDefault(),x()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:O(F.container,{[F.sticky]:!h}),children:[e.jsx("div",{className:F.searchContainer,children:e.jsx(o.Form,{onSubmit:D,noValidate:!0,children:e.jsx(he,{inputValue:u,onInputChange:y=>{d(y)},onSearchClick:x,onDescriptionClick:()=>g(!0),onClear:_})})}),e.jsxs("div",{className:F.filters,children:[e.jsx(Ae,{options:R}),e.jsx(De,{options:n}),e.jsx($e,{})]})]}),e.jsx(fe,{open:v,data:Te,onClose:()=>g(!1)}),e.jsx(re,{filtersToDisplay:["search","status","type","fromDate","toDate"],statusOptions:R,typeOptions:n,useSearchAsQuery:!0})]})},we="_checkbox_19yw3_1",Ee="_description_19yw3_5",Oe="_link_19yw3_9",w={checkbox:we,description:Ee,link:Oe},Qe=(s,t)=>s&&t?` created-after:${s} created-before:${t}`:s?` created-after:${s}`:t?` created-before:${t}`:"",He=s=>s?` type:${s}`:"",qe=s=>s?` status:${s}`:"",Re=l.lazy(()=>Q(()=>import("./index-CMHp3xPb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),Ue=({instanceId:s,selectedIds:t,setSelectedIds:i})=>{const{search:c,status:r,fromDate:u,toDate:d,type:v,currentPage:g,pageSize:p}=C(),{setSidePanelContent:T}=M(),{getActivitiesQuery:A}=B(),n=Qe(u,d),h=He(v),x=qe(r),_=`${c}${x}${n}${h}`,D=a=>{T(a.summary,e.jsx(l.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Re,{activityId:a.id})}))};Ie(D);const y=()=>{i([])},{data:m,isPending:k}=A({query:`${s?`computer:id:${s}`:""} ${_??""}`.trim(),limit:p,offset:(g-1)*p}),f=l.useMemo(()=>(m==null?void 0:m.data.results)??[],[m]),W=()=>{i(t.length!==0?[]:f.map(({id:a})=>a))},K=a=>{i(t.includes(a)?t.filter(I=>I!==a):[...t,a])},Y=l.useMemo(()=>[{accessor:"checkbox",className:w.checkbox,Header:e.jsx(o.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:W,checked:f.length>0&&t.length===f.length,indeterminate:t.length>0&&t.length<f.length}),Cell:({row:a})=>e.jsx(o.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:a.original.summary}),inline:!0,labelClassName:"u-no-margin--bottom u-no-padding--top",checked:t.includes(a.original.id),onChange:()=>{K(a.original.id)}})},{accessor:"summary",className:w.description,Header:"Description",Cell:({row:a})=>e.jsx(o.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>D(a.original),children:a.original.summary})},{accessor:"activity_status",Header:"Status",Cell:({row:{original:{activity_status:a}}})=>E[a].label,getCellIcon:({row:{original:{activity_status:a}}})=>E[a].icon},{accessor:"computer_id",Header:"Instance",Cell:({row:a})=>a.original.computer_id?e.jsxs(te,{className:w.link,to:`${se}instances/${a.original.computer_id}`,children:["ID: ",a.original.computer_id]}):e.jsx(q,{})},{accessor:"creation_time",Header:"Created at",Cell:({row:a})=>e.jsx(e.Fragment,{children:ie(a.original.creation_time).format(ae)})},{accessor:"creator.name",Header:"Creator",Cell:({row:a})=>{var I;return e.jsx(e.Fragment,{children:((I=a.original.creator)==null?void 0:I.name)??e.jsx(q,{})})}}].filter(a=>!s||a.accessor!=="computer_id"),[f,t]);return e.jsxs(e.Fragment,{children:[!_&&g===1&&p===20&&k&&e.jsx(S,{}),!_&&g===1&&p===20&&!k&&(!m||!m.data.count)&&e.jsx(ce,{}),(!!_||g!==1||p!==20||!k&&m&&m.data.count>0)&&e.jsxs(e.Fragment,{children:[e.jsx(Pe,{resetSelectedIds:y}),k?e.jsx(S,{}):e.jsx(o.ModularTable,{emptyMsg:"No activities found according to your search parameters.",columns:Y,data:f}),e.jsx(ne,{totalItems:m==null?void 0:m.data.count,currentItemCount:f.length,handleClearSelection:y})]})]})},Le=l.lazy(()=>Q(()=>import("./index-CMHp3xPb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),Ge=s=>e.jsx(l.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Le,{...s})});export{Ue as A,Ae as S,E as a,Ge as b,fe as c,B as u};
