import{z as v,O as S,y as x,B as D,P as k,C as j,j as e,d as i,Q as s}from"./index-BniO5lih.js";import{K as A}from"./constants-bN1oMdO7.js";import{u as E}from"./index-D7_1vBum.js";import{D as N}from"./DeliveryBlock-DRG9B7L0.js";import{R as B}from"./RandomizationBlock-cuENj1Cm.js";import"./PageMain-DMSiaUeu.js";import"./useGetInstance-BmxNJ1NH.js";import"./useUsns-r5HiN7yD.js";import"./constants-HWGNn3R9.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./RadioGroup-RQ17m8oI.js";const R="The kernel will be downgraded and the instance will restart afterwards to apply the change.",I="The kernel will be downgraded. You'll need to restart the instance to apply this change.",O="Downgrading the kernel will expose your system to known security vulnerabilities AND reduce your Livepatch coverage.",Y=({currentKernelVersion:d,downgradeKernelVersions:o,instanceName:c})=>{const m=v(),{instanceId:u}=S(),{closeSidePanel:l}=x(),{notify:p}=D(),{downgradeKernelQuery:_}=E(),{openActivityDetails:f}=k(),{mutateAsync:g,isPending:r}=_,h=[{label:"Select",value:""},...o.map(t=>({label:t.version_rounded,value:t.id.toString()}))],w={deliver_immediately:!0,randomize_delivery:!1,deliver_delay_window:0,deliver_after:"",new_kernel_version_id:o.length===1?o[0].id.toString():"",reboot_after:!1},n=j({initialValues:w,validationSchema:A,onSubmit:async t=>{try{const{data:a}=await g({id:Number(u),kernel_package_id:Number(t.new_kernel_version_id),reboot_after:t.reboot_after,deliver_after:t.deliver_immediately?void 0:t.deliver_after,deliver_delay_window:t.randomize_delivery?t.deliver_delay_window:void 0});l();const y=t.reboot_after?R:I;p.success({title:`You queued kernel downgrade for instance "${c}"`,message:y,actions:[{label:"View details",onClick:()=>{f(a)}}]})}catch(a){m(a)}}}),b=async()=>{await n.setFieldValue("reboot_after",!0),n.handleSubmit()};return e.jsxs(i.Form,{onSubmit:n.handleSubmit,children:[e.jsx(i.Notification,{severity:"caution",title:"Security warning",children:e.jsx("span",{children:O})}),e.jsxs(s,{spaced:!0,children:[e.jsx(s.Item,{label:"Current version",value:d}),e.jsx(s.Item,{label:"Kernel version",value:o.length===1?e.jsx("span",{children:o[0].version_rounded}):e.jsx(i.Select,{options:h,...n.getFieldProps("new_kernel_version_id")})})]}),e.jsx(N,{formik:n}),e.jsx(B,{formik:n}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(i.Button,{type:"button",appearance:"base",onClick:l,children:"Cancel"}),e.jsx(i.ConfirmationButton,{type:"button",confirmationModalProps:{title:"Downgrading kernel and restarting instance",children:e.jsx("p",{children:"Are you sure? This action will downgrade the kernel and restart the instance."}),confirmButtonLabel:"Downgrade and Restart",confirmButtonAppearance:"negative",confirmButtonLoading:r,confirmButtonDisabled:r,onConfirm:b},children:"Downgrade and Restart"}),e.jsx(i.ConfirmationButton,{type:"button",appearance:"negative",confirmationModalProps:{title:"Downgrading kernel",children:e.jsx("p",{children:"Are you sure? This action will downgrade the kernel."}),confirmButtonLabel:"Downgrade",confirmButtonAppearance:"negative",confirmButtonLoading:r,confirmButtonDisabled:r,onConfirm:()=>{n.handleSubmit()}},children:"Downgrade kernel"})]})]})};export{Y as default};
