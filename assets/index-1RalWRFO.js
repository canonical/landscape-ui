const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DoUy4w4Y.js","assets/index-B1w7_YBY.js","assets/index-Dkc_mJ0y.css","assets/useInstances-jgfOrcKU.js","assets/SidePanelFormButtons-C2zp_f8i.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/useRoles-DjJbg7E6.js","assets/index-mOP8NYd6.js","assets/ScriptsTabs-BOW7CO03.js","assets/HeaderWithSearch-ChRiJ5L0.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-DWU9a5N7.js","assets/useExpandableRow-uWqRZtmI.js","assets/ScriptsTabs-DN44MVZt.css","assets/DeliveryBlock-DZBaJL90.js","assets/DeliveryBlock-VExRkUer.css","assets/ScriptDropdown-CKghFVLG.js","assets/downshift.esm-BJ-Eto29.js","assets/ScriptDropdown-B5XgtP-0.css","assets/index-B-9CjpSo.js","assets/CodeEditor-DNjyY52_.js","assets/CodeEditor-CwlLRp3p.css","assets/ScriptFormAttachments-95A4bRxv.js","assets/AttachmentFile-DKxkcfFA.js","assets/AttachmentFile-Br6SRBhg.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-BSaZ0Hls.js","assets/EmployeeGroupIdentityIssuerList-CAg3281E.js","assets/SidePanelTablePagination-JsaCwssU.js","assets/EmployeeGroupIdentityIssuerList-D8n3an0y.css","assets/EmployeeList-CHXNjsUR.js","assets/EmployeeList-Cz5TezYS.css","assets/index-CbvjFctk.css"])))=>i.map(i=>d[i]);
import{j as e,o as j,aR as je,r as o,n as s,M as de,aS as ve,l as ye,p as Q,J as Ie,ae as Ce,K as we,w as ae,as as ie,N as y,D as Se,a as Ae,A as Te,a1 as Ne,B as ke,k as Be,b as Re,C as Ee,I as De,a7 as oe,F as re,a0 as te}from"./index-B1w7_YBY.js";import{u as ee}from"./useInstances-jgfOrcKU.js";import"./InstancesPageActions-Dv5a7mOF.js";import{R as ze,c as Le}from"./ResponsiveButtons-BiNDbyNl.js";import{u as Pe}from"./useRoles-DjJbg7E6.js";import{u as $e,T as Oe}from"./useTaggedSecurityProfiles-B1XLtRCS.js";import{u as qe}from"./WslInstancesHeader-BaG0dZC0.js";import"./HeaderWithSearch-ChRiJ5L0.js";const Fe="_infoContainer_1ca11_1",Me="_amount_1ca11_9",le={infoContainer:Fe,amount:Me},Ve=({isExpanded:t,overflowingChipsAmount:n})=>n>0&&!t&&e.jsx("div",{className:le.infoContainer,children:e.jsx("span",{className:j("u-text--muted",le.amount),children:`+${n}`})}),Qe=({containerRef:t,onDismiss:n,onOverflowingItemsAmountChange:l,tagData:c})=>{const u=()=>{if(!t.current)return;const r=t.current.querySelectorAll("span.p-chip");l(Array.from(r).filter(({offsetHeight:x,offsetTop:f})=>f>x).length)};return je("resize",u),o.useEffect(()=>{u()},[c.length]),c.map(r=>e.jsx(s.Chip,{value:r,onDismiss:()=>{n(r)}},r))},He="_container_1f6mu_1",Ue="_list_1f6mu_6",We="_listItem_1f6mu_11",Ze="_search_1f6mu_17",V={container:He,list:Ue,listItem:We,search:Ze},Ke=({onTagClick:t,tags:n})=>n.length?e.jsxs("div",{className:V.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Tags"}),e.jsx("ul",{className:j("p-list--divided u-no-margin--bottom",V.list),children:n.map(l=>e.jsx("li",{children:e.jsx("div",{className:V.listItem,children:e.jsx(s.Button,{type:"button",appearance:"base",className:V.search,onClick:()=>t(l),children:l})})},l))})]}):null,Ye="_container_fqj7b_1",Ge="_prompt_fqj7b_10",Je="_saveButton_fqj7b_17",X={container:Ye,prompt:Ge,saveButton:Je},Xe=({onTagAdd:t,search:n})=>e.jsx(e.Fragment,{children:n&&e.jsxs("div",{className:X.container,children:[e.jsxs("span",{className:X.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:n}),e.jsx("span",{children:"..."})]}),e.jsx(s.Button,{type:"button",appearance:"link",onClick:t,className:X.saveButton,children:"Add tag"})]})}),ce=de().matches(/^[a-zA-Z]/,{message:"Tag must starts with a letter",excludeEmptyString:!0}).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,{message:"Tag can only contain letters, numbers, hyphens, and underscores",excludeEmptyString:!0}),et="_searchContainer_zkd2s_1",tt="_box_zkd2s_9",st="_inputContainer_zkd2s_14",nt="_inputError_zkd2s_19",at="_input_zkd2s_14",k={searchContainer:et,box:tt,inputContainer:st,inputError:nt,input:at},it=({onTagsChange:t,tags:n,label:l,labelClassName:c,required:u})=>{var q;const[r,x]=o.useState(""),[f,_]=o.useState(""),[B,w]=o.useState(!1),[S,R]=o.useState(""),[d,v]=o.useState(!1),[A,T]=o.useState(0),{height:E}=ve(),[H,D]=o.useState({top:"100%",bottom:"auto"}),{getAllInstanceTagsQuery:U}=ee(),z=o.useRef(null),m=o.useRef(null);o.useEffect(()=>{if(!m.current)return;const i=m.current.querySelector("input");i&&R(i.id)},[m.current]);const W=()=>{if(!m.current)return;const{top:i,height:p}=m.current.getBoundingClientRect();i+p+379<E?D({top:"100%",bottom:"auto"}):D({top:"auto",bottom:"100%"})};o.useEffect(()=>{!d||!m.current||W()},[E,d,m.current,(q=m.current)==null?void 0:q.clientHeight]);const L=()=>{v(!1)};ye(z,L);const N=i=>{t(n.filter(p=>p!==i))},{data:I,isLoading:P}=U(),Z=o.useMemo(()=>I?!r&&!n.length?I.data.results:I.data.results.filter(i=>!n.includes(i)).filter(i=>i.toLowerCase().includes(r.trim().toLowerCase())):[],[I,r,n]),$=i=>{t([...n,i])},b=()=>{if(r.trim())try{const i=ce.validateSync(r.trim())??"";$(i),x(""),_(""),w(!1)}catch(i){i instanceof Error&&(_(i.message),w(!0))}},K=i=>{if(x(i.target.value),B)try{ce.validateSync(i.target.value),_("")}catch(p){p instanceof Error&&_(p.message)}},O=i=>{const{key:p}=i;d?(p==="Escape"&&L(),p==="Enter"&&b()):p==="Enter"&&v(!0)};return e.jsxs("div",{children:[e.jsx("label",{className:j("p-form__label",{"is-required":u},c),htmlFor:S,children:l||"Tags"}),e.jsxs("div",{className:"p-search-and-filter",ref:z,children:[e.jsxs("div",{className:j("p-search-and-filter__search-container",k.searchContainer),"aria-expanded":d,ref:m,onClick:()=>{v(!0)},children:[e.jsx(Qe,{containerRef:m,onDismiss:N,onOverflowingItemsAmountChange:i=>{T(i)},tagData:n}),e.jsx("div",{className:j("p-search-and-filter__box",k.box),children:e.jsx("div",{className:k.inputContainer,children:e.jsx(s.Input,{type:"text",autoComplete:"off",value:r,onChange:K,placeholder:"Add tags",className:j("u-no-margin--bottom",k.input),onClick:()=>{v(!0)},onKeyUp:O,wrapperClassName:f?"is-error":"","aria-errormessage":f?`${S}-error`:void 0,"aria-invalid":!!f})})}),f&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:j("p-form-validation__message",k.inputError),id:`${S}-error`,children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:f})]})}),e.jsx(Ve,{isExpanded:d,overflowingChipsAmount:A})]}),d&&P&&e.jsx(Q,{}),d&&!P&&e.jsxs("div",{className:"p-search-and-filter__panel",style:H,children:[e.jsx(Xe,{onTagAdd:b,search:r}),e.jsx(Ke,{onTagClick:$,tags:Z})]})]})]})},ot={deliver_after:"",deliverImmediately:!0,action:null},rt=Ie().shape({deliver_after:de().when("deliverImmediately",{is:!1,then:t=>t.required("This field is required").test({message:"Invalid date",test:n=>ae(n).isValid()}).test({message:"Date must be in the future",test:n=>ae(n).isAfter()})}),deliverImmediately:we(),action:Ce().oneOf(["shutdown","reboot"]).required()}),lt=t=>{var l;const n=(l=t.grouped_hardware)==null?void 0:l.network;return!Array.isArray(n)||n.length===0?e.jsx(y,{}):n.filter(({ip:c})=>c!=="Not available").map(({ip:c})=>c).join(", ")||e.jsx(y,{})},ct=(t,n)=>{var l,c,u;return[{label:"instance ID",value:t.id},{label:"Hostname",value:t.hostname},{label:"IP Address",value:lt(t)},{label:"Serial number",value:((l=t.grouped_hardware)==null?void 0:l.system.serial)??e.jsx(y,{})},{label:"Product identifier",value:((c=t.grouped_hardware)==null?void 0:c.system.model)??e.jsx(y,{})},{label:"Distribution",value:t.distribution??"Unknown"},{label:"Access group",value:((u=n.find(({value:r})=>r===t.access_group))==null?void 0:u.label)||t.access_group},{label:"Last ping time",value:t.last_ping_time&&ie(t.last_ping_time).isValid()?ie(t.last_ping_time).format(Se):e.jsx(y,{})},{label:"Annotations",value:t.annotations?Object.entries(t.annotations).map(([r,x],f,_)=>e.jsxs(o.Fragment,{children:[e.jsx("span",{children:`${r}: ${x}`}),f<_.length-1&&e.jsx("br",{})]},r)):e.jsx(y,{})},{label:"Comment",value:t.comment||e.jsx(y,{})}]},dt="_titleRow_oxqvk_1",ut="_flexContainer_oxqvk_6",mt="_italic_oxqvk_11",pt="_infoRow_oxqvk_15",ht="_tagSection_oxqvk_20",ft="_tagsRow_oxqvk_25",gt="_tagsButton_oxqvk_34",g={titleRow:dt,flexContainer:ut,italic:mt,infoRow:pt,tagSection:ht,tagsRow:ft,tagsButton:gt},xt=o.lazy(async()=>te(()=>import("./index-DoUy4w4Y.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),_t=o.lazy(async()=>te(()=>import("./index-mOP8NYd6.js"),__vite__mapDeps([8,9,1,2,7,10,11,12,13,14,15,16,4,5,6,17,18,19,20,21,22,23,24,25,26,27,28])).then(t=>({default:t.RunInstanceScriptForm}))),bt=o.lazy(async()=>te(()=>import("./index-BSaZ0Hls.js"),__vite__mapDeps([29,1,2,4,5,6,14,30,10,11,31,32,33,34,20,35]))),Nt=({instance:t})=>{const[n,l]=o.useState([...t.tags]),[c,u]=o.useState(""),[r,x]=o.useState(!1),[f,_]=o.useState(!1),B=n.filter(a=>!t.tags.includes(a)),{securityProfiles:w,isSecurityProfilesLoading:S}=$e(B,[t]),R=Ae(),d=Te(),{openActivityDetails:v}=Ne(),{notify:A}=ke(),{setSidePanelContent:T}=Be(),{getAccessGroupQuery:E}=Pe(),{removeInstancesQuery:H,rebootInstancesQuery:D,sanitizeInstanceQuery:U,shutdownInstancesQuery:z}=ee(),{deleteChildInstancesQuery:m}=qe(),{editInstanceQuery:W}=ee(),{isFeatureEnabled:L}=Re();o.useEffect(()=>{l([...t.tags])},[t.tags]);const{data:N}=E(),I=(N==null?void 0:N.data.map(({name:a,title:M})=>({label:M,value:a})))??[],{mutateAsync:P,isPending:Z}=W,{mutateAsync:$,isPending:b}=H,{mutateAsync:K,isPending:O}=D,{mutateAsync:q,isPending:i}=z,{mutateAsync:p,isPending:Y}=m,{mutateAsync:ue,isPending:G}=U,me=n.length!==t.tags.length||n.some(a=>!t.tags.includes(a))||t.tags.some(a=>!n.includes(a)),h=Ee({initialValues:ot,validationSchema:rt,onSubmit:async a=>{if(!a.action)return;const M={computer_ids:[t.id],deliver_after:a.deliverImmediately?void 0:`${a.deliver_after}:00Z`};try{const{data:J}=a.action==="reboot"?await K(M):await q(M),ne=a.action==="reboot"?"restarted":"shut down";A.success({title:`You queued "${t.title}" to be ${ne}`,message:`Instance "${t.title}" will be ${ne} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{v(J)}}]})}catch(J){d(J)}}}),C=()=>{u("")},pe=async()=>{try{await $({computer_ids:[t.id]}),R("/instances",{replace:!0})}catch(a){d(a)}finally{C()}},he=async()=>{try{const{data:a}=await ue({computer_id:t.id,computer_title:t.title});A.success({title:`You have successfully initiated Sanitization for ${t.title}`,message:`Sanitizing for ${t.title} has been queued in Activities. The data will be permanently irrecoverable once complete.`,actions:[{label:"View details",onClick:()=>{v(a)}}]})}catch(a){d(a)}finally{C()}},se=async()=>{try{await P({instanceId:t.id,tags:n}),A.success({title:"Tags updated",message:`"${t.title}" instance tags have been updated successfully`})}catch(a){d(a)}finally{C()}},fe=async()=>{w.length?u("securityProfilesTags"):se()},ge=()=>{T("Edit Instance",e.jsx(o.Suspense,{fallback:e.jsx(Q,{}),children:e.jsx(xt,{instance:t})}))},xe=()=>{T("Run script",e.jsx(o.Suspense,{fallback:e.jsx(Q,{}),children:e.jsx(_t,{parentAccessGroup:t.access_group,query:`id:${t.id}`})}))},_e=()=>{T(`Associate employee with ${t.title}`,e.jsx(o.Suspense,{fallback:e.jsx(Q,{}),children:e.jsx(bt,{instanceTitle:t.title,employeeId:t.employee_id})}))},be=async()=>{try{await p({computer_ids:[t.id]}),R("/instances",{replace:!0})}catch(a){d(a)}},F=async a=>{await h.setFieldValue("action",a),h.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:g.titleRow,children:[e.jsxs("div",{className:g.flexContainer,children:[e.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:t.title}),t.is_wsl_instance&&e.jsx("p",{className:j("u-text--muted u-no-margin--bottom",g.italic),children:"WSL Instance"})]}),e.jsxs("div",{className:g.flexContainer,children:[t.is_wsl_instance&&e.jsx(s.ConfirmationButton,{className:"u-no-margin--bottom u-no-margin--right",type:"button",confirmationModalProps:{title:"Delete instance",children:e.jsxs("p",{children:["This will permanently delete the instance"," ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:Y,confirmButtonLoading:Y,onConfirm:be},children:"Delete instance"}),e.jsx(ze,{collapseFrom:"xxl",buttons:[e.jsxs(s.Button,{type:"button",onClick:ge,hasIcon:!0,children:[e.jsx(s.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]},"edit-instance"),Le("runScripts",t)&&e.jsxs(s.Button,{type:"button",onClick:xe,hasIcon:!0,children:[e.jsx(s.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]},"run-script"),e.jsxs(s.Button,{hasIcon:!0,type:"button",disabled:b,onClick:()=>{u("remove")},"aria-label":`Remove ${t.title} instance`,children:[e.jsx(s.Icon,{name:s.ICONS.delete}),e.jsx("span",{children:"Remove from Landscape"})]},"remove-instance"),e.jsxs(s.Button,{hasIcon:!0,type:"button",disabled:G,onClick:()=>{u("sanitize")},"aria-label":`Sanitize ${t.title} instance`,children:[e.jsx(s.Icon,{name:"tidy"}),e.jsx("span",{children:"Sanitize"})]},"sanitize-instance"),e.jsxs(s.Button,{hasIcon:!0,type:"button",disabled:b,onClick:()=>{x(!0)},children:[e.jsx(s.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]},"reboot-instance"),L("employee-management")&&e.jsxs(s.Button,{type:"button",hasIcon:!0,onClick:_e,children:[e.jsx(s.Icon,{name:s.ICONS.user}),e.jsx("span",{children:"Associate employee"})]},"associate-employee"),e.jsxs(s.Button,{hasIcon:!0,type:"button",disabled:b,onClick:()=>{_(!0)},children:[e.jsx(s.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]},"shutdown-instance")]})]})]}),e.jsx("div",{className:g.infoRow,children:e.jsx(s.Row,{className:"u-no-padding--left u-no-padding--right u-no-max-width",children:ct(t,I).map(a=>e.jsx(s.Col,{size:4,children:e.jsx(De,{...a})},a.label))})}),e.jsx("div",{className:g.tagSection,children:e.jsxs(s.Row,{className:g.tagsRow,children:[e.jsx(s.Col,{size:4,children:e.jsx(it,{labelClassName:"p-text--small p-text--small-caps u-text--muted",onTagsChange:a=>{l(a)},tags:n})}),e.jsx(s.Col,{size:2,className:g.tagsButton,children:e.jsx(s.Button,{type:"button",className:"u-no-margin--bottom",onClick:fe,disabled:S||!me,children:"Update"})})]})}),c==="securityProfilesTags"&&e.jsx(Oe,{instances:[t],securityProfiles:w,tags:B,onConfirm:se,confirmButtonDisabled:Z,close:C}),e.jsx(oe,{isOpen:c==="remove",title:"Remove instance from Landscape",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:b,confirmButtonLoading:b,onConfirm:pe,close:C,confirmationText:`remove ${t.title}`,children:e.jsxs("p",{children:["Removing this ",t.title," will delete all associated data and free up one license slot for another computer to be registered."]})}),e.jsx(oe,{isOpen:c==="sanitize",confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:G,confirmButtonLoading:G,onConfirm:he,close:C,confirmationText:`sanitize ${t.title}`,title:"Sanitize instance",children:e.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",t.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})}),r&&e.jsx(s.ConfirmationModal,{close:()=>{x(!1)},title:"Restart instance",confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonDisabled:O,confirmButtonLoading:O,onConfirm:async()=>F("reboot"),children:e.jsxs(s.Form,{onSubmit:async()=>F("reboot"),noValidate:!0,children:[e.jsx(s.CheckboxInput,{label:"Deliver as soon as possible",...h.getFieldProps("deliverImmediately"),checked:h.values.deliverImmediately}),e.jsx(s.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:g.input,placeholder:"Scheduled time",...h.getFieldProps("deliver_after"),disabled:h.values.deliverImmediately,error:re(h,"deliver_after")}),e.jsxs("p",{children:['This will restart "',t.title,'" instance.']})]})}),f&&e.jsx(s.ConfirmationModal,{close:()=>{_(!1)},title:"Shut down instance",confirmButtonLabel:"Shutdown",confirmButtonAppearance:"negative",confirmButtonDisabled:i,confirmButtonLoading:i,onConfirm:async()=>F("shutdown"),children:e.jsxs(s.Form,{onSubmit:async()=>F("shutdown"),noValidate:!0,children:[e.jsx(s.CheckboxInput,{label:"Deliver as soon as possible",...h.getFieldProps("deliverImmediately"),checked:h.values.deliverImmediately}),e.jsx(s.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:g.input,placeholder:"Scheduled time",...h.getFieldProps("deliver_after"),disabled:h.values.deliverImmediately,error:re(h,"deliver_after")}),e.jsxs("p",{children:['This will shut down "',t.title,'" instance.']})]})})]})};export{Nt as default};
