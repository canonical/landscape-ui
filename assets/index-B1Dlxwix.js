const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C40XLYa9.js","assets/index-B7TA2mEJ.js","assets/index-DM5072WT.css","assets/useRoles-CM-oV7aq.js","assets/useFetchOld-CJ7nhgRY.js","assets/AccessGroupBlock-BPAYzyNQ.js","assets/AccessGroupBlock-BBu3FI5L.css","assets/SidePanelFormButtons-XYVE_s1x.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/PageMain-FFmGKqeV.js","assets/PageMain-BIuYvhUI.css","assets/TruncatedCell-BSQwlRaR.js","assets/TruncatedCell-Wu3cG5-r.css","assets/index-CNXBvbLC.js"])))=>i.map(i=>d[i]);
import{r as u,_ as g,k as R,i as f,C as y,j as t,h as m,s as h,W as P,E as A}from"./index-B7TA2mEJ.js";import{P as C,a as E,b as I}from"./PageMain-FFmGKqeV.js";import{u as x}from"./useRoles-CM-oV7aq.js";import{T as j}from"./TruncatedCell-BSQwlRaR.js";const D="_bold_nffzr_1",T={bold:D},S=u.lazy(()=>g(()=>import("./index-C40XLYa9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),O=({role:n})=>{const e=R(),{setSidePanelContent:s}=f(),{closeConfirmModal:o,confirmModal:r}=y(),{removeRoleQuery:a}=x(),{mutateAsync:i}=a,l=async c=>{try{await i({name:c})}catch(_){e(_)}finally{o()}},p=c=>{r({title:`Remove '${c.name}' role`,body:t.jsxs("p",{children:[t.jsx("span",{children:`This will remove '${c.name}' role.`}),c.persons.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),t.jsx("span",{className:T.bold,children:`This will affect ${c.persons.length} administrator${c.persons.length===1?"":"s"}`})]})]}),buttons:[t.jsx(m.Button,{type:"button",appearance:"negative",onClick:()=>l(c.name),children:"Remove"},"remove")]})},d=c=>{s(`Edit "${c.name}" role`,t.jsx(u.Suspense,{fallback:t.jsx(h,{}),children:t.jsx(S,{role:c})}))};return t.jsxs("div",{className:"divided-blocks",children:[t.jsx("div",{className:"divided-blocks__item",children:t.jsx(m.Tooltip,{message:"Edit",position:"top-center",children:t.jsx(m.Button,{small:!0,hasIcon:!0,type:"button",appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Edit ${n.name} role`,onClick:()=>d(n),children:t.jsx(m.Icon,{name:"edit",className:"u-no-margin--left"})})})}),t.jsx("div",{className:"divided-blocks__item",children:t.jsx(m.Tooltip,{message:"Delete",position:"top-center",children:t.jsx(m.Button,{small:!0,hasIcon:!0,type:"button",appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Delete ${n.name} role`,onClick:()=>p(n),children:t.jsx(m.Icon,{name:"delete",className:"u-no-margin--left"})})})})]})},k=n=>n.reduce((e,{global:s,name:o,title:r})=>{if(o==="RemoveComputerFromAccessGroup")return e;const a=/view/i.test(o)?"view":"manage",i=o==="AddComputerToAccessGroup"?"access group":r.replace(/(view|manage) /i,"").replace(/computer/i,"instance"),l=e.find(({label:p})=>p===i)||{global:s,label:i,values:{manage:"",view:""}};return l.values[a]=o,[...e.filter(({label:p})=>p!==i),l]},[]),J=n=>{const e={maxDepth:0,options:n.filter(s=>s.parent==="").map(({name:s,title:o})=>({children:[],depth:0,label:o,parents:[],value:s}))};for(;e.maxDepth>=0;){const s=e.options.filter(({depth:r})=>r===e.maxDepth);e.maxDepth++;const o=n.filter(({parent:r})=>s.some(({value:a})=>a===r));if(o.length===0)break;for(const{name:r,parent:a,title:i}of o){const l=s.find(({value:d})=>d===a);if(!l)continue;const p=[a,...l.parents];e.options.push({children:[],depth:e.maxDepth,label:i,parents:p,value:r});for(const d of p)e.options.filter(({value:c})=>c===d)[0].children.push(r)}}return e.options},v=(n,e,s)=>s.filter(o=>o.depth===e).filter(({value:o})=>n.includes(o))[0].value,K=n=>n.sort((e,s)=>{if(e.children.includes(s.value))return-1;if(s.children.includes(e.value))return 1;for(let o=0;o<Math.min(e.depth,s.depth);o++){const r=v(e.parents,o,n),a=v(s.parents,o,n);if(r!==a)return r.localeCompare(a)}return e.value.localeCompare(s.value)}),X=(n,e)=>{const s=Math.max(...e.map(({depth:r})=>r)),o=n;if(n.length>0)for(let r=0;r<s;r++){const a=e.filter(({depth:i})=>i===r).filter(({value:i})=>n.includes(i));for(const i of a)if(i.children.every(l=>n.includes(l))){const l=n.filter(p=>!i.children.includes(p));n.splice(0,n.length,...l)}}return o},N="_actions_109z2_1",L="_expandedRow_109z2_5",M="_expandedCell_109z2_10",b={actions:N,expandedRow:L,expandedCell:M},w=(n,e,s)=>{const o=n.global_permissions?[...n.permissions,...n.global_permissions]:n.permissions,r=[...new Set(o.filter(a=>s==="manage"?!/(view|remove)/i.test(a):!/(remove)/i.test(a)&&!e.find(({values:i})=>i.manage===a&&!i.view)).map(a=>{var i;return((i=e.find(({values:l})=>s==="manage"?l.manage===a:l.view===a||l.manage===a))==null?void 0:i.label)??""}))];return r.length===0?"":r.length!==e.filter(({values:a})=>!!a[s]).length?r.map((a,i)=>i>0?a:a.replace(/^\w/,l=>l.toUpperCase())).join(", "):"All properties"},$=n=>({column:e,row:{index:s}})=>{const o={};return(n==null?void 0:n.rowIndex)===s&&n.columnId===e.id&&(o.className=b.expandedCell),e.id==="name"?o.role="rowheader":e.id==="persons"?o["aria-label"]="Administrators":e.id==="view"?o["aria-label"]="View permissions":e.id==="manage"?o["aria-label"]="Manage permissions":e.id==="actions"&&(o["aria-label"]="Actions"),o},z=n=>({index:e})=>{const s={};return n===e&&(s.className=b.expandedRow),s},B=n=>e=>{e&&(n.current=[...e.querySelectorAll("tbody tr")])},F=({roleList:n})=>{const[e,s]=u.useState(null),{getPermissionsQuery:o}=x(),r=u.useRef([]);P({current:e?r.current[e.rowIndex]:null},()=>s(null));const{data:a}=o(),i=a?k(a.data):[],l=u.useMemo(()=>n,[n]),p=u.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"persons",Header:"Administrators",Cell:({row:d})=>d.original.persons.length},{accessor:"view",Header:"View",Cell:({row:{original:d,index:c}})=>t.jsx(j,{content:w(d,i,"view"),isExpanded:(e==null?void 0:e.rowIndex)===c&&e.columnId==="view",onExpand:()=>s({rowIndex:c,columnId:"view"})})},{accessor:"manage",Header:"Manage",Cell:({row:{original:d,index:c}})=>t.jsx(j,{content:w(d,i,"manage"),isExpanded:(e==null?void 0:e.rowIndex)===c&&e.columnId==="manage",onExpand:()=>s({rowIndex:c,columnId:"manage"})})},{accessor:"actions",className:b.actions,Cell:({row:{original:d}})=>d.name!=="GlobalAdmin"?t.jsx(O,{role:d}):null}],[l,a,e]);return t.jsx("div",{ref:B(r),children:t.jsx(m.ModularTable,{columns:p,data:l,getCellProps:$(e),getRowProps:z(e==null?void 0:e.rowIndex)})})},H=u.lazy(()=>g(()=>import("./index-CNXBvbLC.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,8,9,10,11,12,13]))),Q=()=>{const{setSidePanelContent:n}=f(),{getRolesQuery:e}=x(),{data:s,isLoading:o}=e();return t.jsxs(t.Fragment,{children:[o&&t.jsx(h,{}),!o&&(!s||!s.data.length)&&t.jsx(A,{title:"No roles found",body:t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"u-no-margin--bottom",children:"You havenâ€™t added any roles yet."}),t.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[t.jsx(m.Button,{appearance:"positive",onClick:()=>n("Add role",t.jsx(u.Suspense,{fallback:t.jsx(h,{}),children:t.jsx(H,{})})),children:"Add role"},"add")]}),!o&&s&&s.data.length>0&&t.jsx(F,{roleList:s.data})]})},V=u.lazy(()=>g(()=>import("./index-CNXBvbLC.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,8,9,10,11,12,13]))),G=()=>{const{setSidePanelContent:n}=f(),e=()=>{n("Add Role",t.jsx(u.Suspense,{fallback:t.jsx(h,{}),children:t.jsx(V,{})}))};return t.jsxs(C,{children:[t.jsx(E,{title:"Roles",actions:[t.jsx(m.Button,{type:"button",onClick:e,appearance:"positive",children:"Add role"},"add-role")]}),t.jsx(I,{children:t.jsx(Q,{})})]})},Z=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"}));export{k as a,K as b,J as c,X as g,Z as i};
