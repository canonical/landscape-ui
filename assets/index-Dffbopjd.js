const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BxtmUmdS.js","assets/index-DAg1o-hl.js","assets/index-_cqP-NZ4.css","assets/SidePanelFormButtons-DpWiVTI8.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/MultiSelectField-CBtdVeym.js","assets/MultiSelectField-DOBW8uWL.css","assets/TablePagination-DarOwDdU.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-DGfmjBId.js","assets/helpers-LtkTZImA.js","assets/HeaderWithSearch-Cj6UX8NR.js","assets/HeaderWithSearch-DQybm8h_.css","assets/NoData-DSLoqvtK.js","assets/index-Bj7T2Pqr.js"])))=>i.map(i=>d[i]);
import{h as Y,e as X,f as y,g as F,p as v,q,i as N,t as J,k as Z,n as x,v as ee,j as e,d as o,r as f,_ as A,s as se,c as ne,o as I,E as re}from"./index-DAg1o-hl.js";import{T as te}from"./TablePagination-DarOwDdU.js";import{S as oe}from"./SidePanelFormButtons-DpWiVTI8.js";import{g as ae,r as D,U as $,a as ie}from"./helpers-LtkTZImA.js";import{u as M}from"./usePageParams-DGfmjBId.js";import{H as ue}from"./HeaderWithSearch-Cj6UX8NR.js";import{N as ce}from"./NoData-DSLoqvtK.js";function B(){const r=Y(),t=X(),i=(s,p={})=>F({queryKey:["users",{...s}],queryFn:()=>r.get("users",{params:s}),...p}),c=y({mutationKey:["users","new"],mutationFn:s=>r.post("users",s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),l=y({mutationKey:["users","edit"],mutationFn:s=>r.put("users",s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),d=y({mutationKey:["users","remove"],mutationFn:s=>r.delete("users",{params:s}),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),h=y({mutationKey:["users","lock"],mutationFn:s=>r.post("users/lock",s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),g=y({mutationKey:["users","unlock"],mutationFn:s=>r.post("users/unlock",s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),b=(s,p={})=>F({queryKey:["groups",(s==null?void 0:s.computer_id)??""],queryFn:()=>{if(!s)throw new Error("Missing required parameters");return r.get(`computers/${s.computer_id}/groups`)},...p}),a=(s,p={})=>F({queryKey:["userGroups",(s==null?void 0:s.computer_id)??"",(s==null?void 0:s.username)??""],queryFn:()=>{if(!s)throw new Error("Missing required parameters");return r.get(`computers/${s.computer_id}/users/${s.username}/groups`)},...p}),m=y({mutationKey:["groups","add"],mutationFn:s=>r.post(`computers/${s.computer_id}/usergroups/update_bulk`,s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),n=y({mutationKey:["groups","remove"],mutationFn:s=>r.post(`computers/${s.computer_id}/usergroups/update_bulk`,s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})});return{getUsersQuery:i,getGroupsQuery:b,getUserGroupsQuery:a,createUserQuery:c,removeUserQuery:d,editUserQuery:l,lockUserQuery:h,unlockUserQuery:g,addUserToGroupQuery:m,removeUserFromGroupQuery:n}}const le="_actions_1l3g0_1",de={actions:le},K=()=>{const{instanceId:r}=v(),t=q(),{closeSidePanel:i}=N(),{createUserQuery:c,getGroupsQuery:l}=B(),d=Number(r),{mutateAsync:h}=c,{data:g,isLoading:b}=l({computer_id:d}),m=((g==null?void 0:g.data.groups)??[]).map(s=>({label:s.name,value:s.name})),n=J({initialValues:{name:"",username:"",password:"",confirmPassword:"",requirePasswordReset:!1,location:"",homePhoneNumber:"",workPhoneNumber:"",primaryGroupValue:""},validationSchema:Z().shape({name:x().required("This field is required"),username:x().required("This field is required"),password:x().required("This field is required"),confirmPassword:x().required("This field is required").oneOf([ee("password"),""],"Passwords must match"),location:x(),homePhoneNumber:x(),workPhoneNumber:x(),primaryGroupValue:x().required("This field is required")}),onSubmit:async s=>{try{await h({computer_ids:[d],name:s.name,username:s.username,password:s.password,require_password_reset:s.requirePasswordReset,location:s.location,home_phone:s.homePhoneNumber,work_phone:s.workPhoneNumber,primary_groupname:s.primaryGroupValue}),i()}catch(p){t(p)}}});return e.jsxs(o.Form,{noValidate:!0,onSubmit:n.handleSubmit,name:"add-new-user",children:[e.jsx(o.Input,{type:"text",label:"Username",autoComplete:"new-username",required:!0,error:n.touched.username&&n.errors.username?n.errors.username:void 0,...n.getFieldProps("username")}),e.jsx(o.Input,{type:"text",label:"Name",required:!0,error:n.touched.name&&n.errors.name?n.errors.name:void 0,...n.getFieldProps("name")}),e.jsx(o.Input,{type:"password",label:"Passphrase",autoComplete:"new-password",required:!0,error:n.touched.password&&n.errors.password?n.errors.password:void 0,...n.getFieldProps("password")}),e.jsx(o.Input,{type:"password",label:"Confirm passphrase",autoComplete:"new-password",required:!0,error:n.touched.confirmPassword&&n.errors.confirmPassword?n.errors.confirmPassword:void 0,...n.getFieldProps("confirmPassword")}),e.jsx(o.Input,{type:"checkbox",label:"Require passphrase reset",help:"User must change password at first login",...n.getFieldProps("requirePasswordReset"),checked:n.values.requirePasswordReset}),e.jsx(o.Select,{label:"Primary Group",disabled:b,options:[{label:"Select",value:""},...m],...n.getFieldProps("primaryGroupValue"),error:n.touched.primaryGroupValue&&n.errors.primaryGroupValue?n.errors.primaryGroupValue:void 0}),e.jsx(o.Input,{type:"text",label:"Location",error:n.touched.location&&n.errors.location?n.errors.location:void 0,...n.getFieldProps("location")}),e.jsx(o.Input,{type:"text",label:"Home phone",error:n.touched.homePhoneNumber&&n.errors.homePhoneNumber?n.errors.homePhoneNumber:void 0,...n.getFieldProps("homePhoneNumber")}),e.jsx(o.Input,{type:"text",label:"Work phone",error:n.touched.workPhoneNumber&&n.errors.workPhoneNumber?n.errors.workPhoneNumber:void 0,...n.getFieldProps("workPhoneNumber")}),e.jsx(oe,{submitButtonDisabled:n.isSubmitting,submitButtonText:"Add user"})]})},me=f.lazy(()=>A(()=>import("./index-BxtmUmdS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),pe=({selectedUsers:r,handleClearSelection:t,sidePanel:i=!1})=>{const[c,l]=f.useState(!1),{instanceId:d}=v(),h=q(),{notify:g}=se(),{setSidePanelContent:b,closeSidePanel:a}=N(),{removeUserQuery:m,lockUserQuery:n,unlockUserQuery:s}=B(),{mutateAsync:p,isPending:U}=m,{mutateAsync:j,isPending:_}=n,{mutateAsync:P,isPending:k}=s,S=Number(d),u=r.length===1?r[0]:void 0,{locked:Q,unlocked:E}=ae(r),C=async(w,L)=>{try{await w({computer_ids:[S],usernames:ie(r),delete_home:L==="removed"?c:void 0}),t&&t(),a(),g.success({message:`Successfully requested to be ${L}`})}catch(W){h(W)}},G=async()=>{await C(j,"locked")},V=async()=>{await C(P,"unlocked")},H=async()=>{await C(p,"removed")},R=()=>{b("Add new user",e.jsx(K,{}))},O=w=>{b("Edit user",e.jsx(f.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(me,{user:w})}))},z=()=>{l(w=>!w)};return e.jsxs("div",{className:ne("p-panel__controls u-no-padding--top",{"u-no-margin--left":i}),children:[!i&&e.jsxs(o.Button,{className:"u-no-margin--right",type:"button",hasIcon:!0,onClick:R,children:[e.jsx(o.Icon,{name:o.ICONS.plus}),e.jsx("span",{children:"Add user"})]}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[((u==null?void 0:u.enabled)||!i)&&e.jsxs(o.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:E===0,"aria-disabled":E===0,confirmationModalProps:{title:`Lock ${u?`user ${u.username}`:`${r.length} users`}`,children:D({user:u,selectedUsers:r,userAction:$.Lock}),confirmButtonLabel:"Lock",confirmButtonAppearance:"positive",confirmButtonLoading:_,confirmButtonDisabled:_,onConfirm:G},children:[e.jsx(o.Icon,{name:"lock-locked"}),e.jsx("span",{children:"Lock"})]}),(!(u!=null&&u.enabled)||!i)&&e.jsxs(o.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:Q===0,"aria-disabled":Q===0,confirmationModalProps:{title:`Unlock ${u?`user ${u.username}`:`${r.length} users`}`,children:D({user:u,selectedUsers:r,userAction:$.Unlock}),confirmButtonLabel:"Unlock",confirmButtonAppearance:"positive",confirmButtonLoading:k,confirmButtonDisabled:k,onConfirm:V},children:[e.jsx(o.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlock"})]}),i&&u&&e.jsxs(o.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>O(u),children:[e.jsx(o.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(o.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:r.length===0,"aria-disabled":r.length===0,confirmationModalProps:{title:`Delete ${u?u.username:"users"}`,children:e.jsxs("div",{children:[e.jsx("p",{className:"u-no-margin--bottom",children:u?`This will delete user ${u.username}. You can delete this user's home folders at the same time.`:"This will delete selected users. You can delete their home folders as well."}),e.jsx(o.Input,{label:"Delete the home folders as well",type:"checkbox",checked:c,onChange:z})]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonLoading:U,confirmButtonDisabled:U,onConfirm:H},children:[e.jsx(o.Icon,{name:o.ICONS.delete}),e.jsx("span",{children:"Delete"})]})]})})]})},he=(r,t)=>r.filter(i=>t.includes(i.uid)),ge=({selected:r,handleClearSelection:t,users:i})=>{const{setPageParams:c}=M(),l=d=>{c({search:d}),t()};return e.jsx(ue,{onSearch:l,actions:e.jsx("div",{className:de.actions,children:e.jsx(pe,{handleClearSelection:t,selectedUsers:he(i,r)})})})},be="_status_1or9p_1",fe="_actions_1or9p_7",T={status:be,actions:fe},xe=({column:r})=>{const t={};switch(r.id){case"username":t.role="rowheader";break;case"enabled":t["aria-label"]="Status";break;case"uid":t["aria-label"]="User id";break;case"name":t["aria-label"]="Full name";break}return t},ye=f.lazy(()=>A(()=>import("./index-BxtmUmdS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),je=f.lazy(()=>A(()=>import("./index-Bj7T2Pqr.js"),__vite__mapDeps([16,1,2,15,8,9,10,11,3,4,5,12,13,14]))),ke=({users:r,selected:t,setSelected:i})=>{const{setSidePanelContent:c}=N(),l=a=>{c("Edit user",e.jsx(f.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(ye,{user:a})}))},d=a=>{c("User details",e.jsx(f.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(je,{user:a})}))},h=()=>{i(t.length!==0?[]:r.map(({uid:a})=>a))},g=a=>{t.includes(a)?i(t.filter(m=>m!==a)):i([...t,a])},b=f.useMemo(()=>[{accessor:"username",Header:e.jsxs(e.Fragment,{children:[e.jsx(o.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:h,checked:r.length>0&&t.length===r.length,indeterminate:t.length>0&&t.length<r.length}),e.jsx("span",{children:"username"})]}),Cell:({row:a})=>e.jsxs(e.Fragment,{children:[e.jsx(o.CheckboxInput,{inline:!0,label:e.jsxs("span",{className:"u-off-screen",children:["Select user ",a.original.username]}),checked:t.includes(a.original.uid),onChange:()=>g(a.original.uid)}),e.jsx(o.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>d(a.original),"aria-label":`Show details of user ${a.original.username}`,children:a.original.username})]})},{Header:"status",accessor:"enabled",sortType:"basic",Cell:({row:a})=>e.jsx("div",{className:T.status,children:a.original.enabled?e.jsxs(e.Fragment,{children:[e.jsx(o.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlocked"})]}):e.jsxs(e.Fragment,{children:[e.jsx(o.Icon,{name:"lock-locked-active"}),e.jsx("span",{children:"Locked"})]})})},{Header:"UID",accessor:"uid",sortType:"basic"},{Header:"Full Name",accessor:"name",sortType:"basic",Cell:({row:a})=>a.original.name||e.jsx(ce,{})},{accessor:"actions",className:T.actions,Cell:({row:a})=>e.jsx(o.Tooltip,{message:"Edit",position:"btm-center",children:e.jsx(o.Button,{type:"button",small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Edit ${a.original.name} profile`,onClick:()=>l(a.original),children:e.jsx(o.Icon,{name:"edit",className:"u-no-margin--left"})})})}],[r,t]);return e.jsx(o.ModularTable,{columns:b,data:r,emptyMsg:"No users available",sortable:!0,initialSortDirection:"ascending",initialSortColumn:"username",getCellProps:xe})},_e=(r,t)=>r?t.filter(({username:i,name:c})=>{const l=c==null?void 0:c.toUpperCase().includes(r.toUpperCase()),d=i.toUpperCase().includes(r.toUpperCase());return l||d}):t,we=1e3,Ue=()=>{const[r,t]=f.useState([]),{instanceId:i,childInstanceId:c}=v(),{search:l,currentPage:d,pageSize:h}=M(),{setSidePanelContent:g}=N(),{getUsersQuery:b}=B(),a=Number(c??i),{data:m,isLoading:n}=b({computer_id:a,limit:we}),s=(m==null?void 0:m.data.results)??[],p=_e(l,s),U=(k,S)=>p.slice(S,S+k),j=f.useMemo(()=>U(h,(d-1)*h),[l,s,d,h]),_=()=>{t([])},P=()=>{g("Add new user",e.jsx(K,{}))};return e.jsxs(e.Fragment,{children:[n&&e.jsx(I,{}),!n&&(!m||m.data.results.length===0)&&e.jsx(re,{title:"No users found",body:"Add new users by clicking the button below",icon:"connected",cta:[e.jsx(o.Button,{type:"button",appearance:"positive",onClick:P,children:"Add user"},"empty-state-add-new-user")]}),(l||!n&&j.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{selected:r,handleClearSelection:_,users:j}),e.jsx(ke,{selected:r,setSelected:k=>t(k),users:j})]}),e.jsx(te,{handleClearSelection:_,totalItems:p.length,currentItemCount:j.length})]})},Ae=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));export{pe as U,Ae as i,B as u};
