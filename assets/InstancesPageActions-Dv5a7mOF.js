const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-kKLN66m1.js","assets/index-B1w7_YBY.js","assets/index-Dkc_mJ0y.css","assets/useInstances-jgfOrcKU.js","assets/useRoles-DjJbg7E6.js","assets/index-CfXqLKNo.css","assets/index-mOP8NYd6.js","assets/ScriptsTabs-BOW7CO03.js","assets/HeaderWithSearch-ChRiJ5L0.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-DWU9a5N7.js","assets/useExpandableRow-uWqRZtmI.js","assets/ScriptsTabs-DN44MVZt.css","assets/SidePanelFormButtons-C2zp_f8i.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/DeliveryBlock-DZBaJL90.js","assets/DeliveryBlock-VExRkUer.css","assets/ScriptDropdown-CKghFVLG.js","assets/downshift.esm-BJ-Eto29.js","assets/ScriptDropdown-B5XgtP-0.css","assets/index-B-9CjpSo.js","assets/CodeEditor-DNjyY52_.js","assets/CodeEditor-CwlLRp3p.css","assets/ScriptFormAttachments-95A4bRxv.js","assets/AttachmentFile-DKxkcfFA.js","assets/AttachmentFile-Br6SRBhg.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-CD7M0OSa.js","assets/ResponsiveButtons-BiNDbyNl.js","assets/ResponsiveButtons-C56n2q_V.css","assets/useUsns-DpdOVpYA.js","assets/useUsns-DQKyxlHf.css","assets/index-BRDnZsk7.js","assets/index-CK6sL0Ld.css","assets/index-DSUk8sFo.js","assets/index-D7YOg-Jc.js","assets/useTaggedSecurityProfiles-B1XLtRCS.js"])))=>i.map(i=>d[i]);
import{j as e,n as u,N as f,r as c,c as z,o as Q,L as W,w as j,D as U,aq as Y,k as N,x as h,p as y,a0 as m,A as J,B as K,a1 as X,aB as Z}from"./index-B1w7_YBY.js";import{d as G,h as ee,a as te,R as ae,c as _,b as ne}from"./ResponsiveButtons-BiNDbyNl.js";import{u as I}from"./useInstances-jgfOrcKU.js";const re="_rowHeader_spblf_5",le="_nested_spblf_8",oe="_statusListItem_spblf_20",se="_statusContainer_spblf_24",C={rowHeader:re,nested:le,statusListItem:oe,statusContainer:se},ie=r=>r.map(({accessor:a,canBeHidden:t,optionLabel:l})=>({canBeHidden:t,label:l,value:a})),R=({groupBy:r,instance:a,selectedInstances:t})=>{const l=t.map(({id:i})=>i);return r==="parent"&&!a.is_wsl_instance&&a.children.length>0?a.children.every(({id:i})=>l.includes(i))?"checked":a.children.some(({id:i})=>l.includes(i))?"indeterminate":"unchecked":l.includes(a.id)?"checked":"unchecked"},ce=({groupBy:r,instance:a,selectedInstances:t,setSelectedInstances:l})=>{if(r==="parent"&&a.children.length>0){const i=a.children.map(({id:p})=>p);t.some(({id:p})=>i.includes(p))?l(t.filter(({id:p})=>!i.includes(p))):l([...t,...a.children.map(p=>({...p,parent:a,children:[]}))])}else t.some(({id:i})=>i===a.id)?l(t.filter(({id:i})=>i!==a.id)):l([...t,a])},O=r=>{if(r.archived)return{icon:"archive",label:"Archived"};const a=((r==null?void 0:r.alerts)??[]).filter(({type:t})=>!["PackageUpgradesAlert","SecurityUpgradesAlert"].includes(t));return a.length===0?{icon:`${d.Online.icon.color}`,label:d.Online.alternateLabel??d.Online.label}:a.length===1?{icon:`${d[a[0].type].icon.color??d.Unknown.icon.color}`,label:e.jsx(e.Fragment,{children:a[0].summary})}:{label:e.jsx("span",{className:C.statusContainer,children:a.map(({type:t,summary:l})=>{var i;return e.jsx("span",{className:C.statusListItem,children:e.jsx(u.Tooltip,{message:l,children:e.jsx(u.Icon,{className:"u-no-margin--left",name:`${((i=d[t])==null?void 0:i.icon.color)??d.Unknown.icon.color}`})})},t)})})}},ue=r=>({regular:te(r)?{icon:d.PackageUpgradesAlert.icon.color??"",label:d.PackageUpgradesAlert.label}:!1,security:ee(r)?{icon:d.SecurityUpgradesAlert.icon.color??"",label:d.SecurityUpgradesAlert.label}:!1}),D=r=>{if(!G("ubuntu",r))return{icon:"",label:e.jsx(f,{})};const{regular:a,security:t}=ue(r.alerts);return a&&t?{icon:t.icon,label:`${a.label}, ${t.label.toLowerCase()}`}:a?{icon:a.icon,label:a.label}:t?{icon:t.icon,label:t.label}:{icon:d.UpToDate.icon.color,label:d.UpToDate.label}},de=({id:r})=>{const a={};return r==="title"&&(a["aria-labelledby"]="column-1-label"),a},Ce=c.memo(function({instances:a,selectedInstances:t,setColumnFilterOptions:l,setSelectedInstances:i}){const{disabledColumns:p,groupBy:g,...v}=z(),A=Object.values(v).some(n=>{if(typeof n=="string")return n.length>0;if(Array.isArray(n))return n.length>0}),k=()=>{i(t.length!==0?[]:a)},x=c.useMemo(()=>g==="parent"?a.map(n=>({...n,subRows:n.children.map(o=>({...o,parent:n,children:[]}))})):a,[a,g]),b=c.useMemo(()=>[{accessor:"title",canBeHidden:!1,optionLabel:"Instance name",Header:e.jsxs(e.Fragment,{children:[e.jsx(u.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,onChange:k,disabled:a.length===0,checked:t.length===a.length&&a.length!==0,indeterminate:t.length!==0&&t.length<a.length}),e.jsx("span",{id:"column-1-label",children:"Name"})]}),Cell:({row:n})=>e.jsxs("div",{className:Q(C.rowHeader,{[C.nested]:n.depth>0}),children:[e.jsx(u.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:n.original.title}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:R({groupBy:g,instance:n.original,selectedInstances:t})==="checked",indeterminate:R({groupBy:g,instance:n.original,selectedInstances:t})==="indeterminate",onChange:()=>{ce({groupBy:g,instance:n.original,selectedInstances:t,setSelectedInstances:i})}}),e.jsx(W,{to:n.original.parent?`/instances/${n.original.parent.id}/${n.original.id}`:`/instances/${n.original.id}`,children:n.original.title})]})},{accessor:"status",canBeHidden:!0,optionLabel:"Status",Header:"Status",Cell:({row:{original:n}})=>{const{label:o}=O(n);return o},getCellIcon:({row:{original:n}})=>{const{icon:o}=O(n);return o}},{accessor:"upgrades",canBeHidden:!0,optionLabel:"Upgrades",Header:"Upgrades",Cell:({row:{original:n}})=>{const{label:o}=D(n);return o},getCellIcon:({row:{original:n}})=>{const{icon:o}=D(n);return o}},{accessor:"os",canBeHidden:!0,optionLabel:"OS",Header:"OS",Cell:({row:{original:n}})=>{var o;return e.jsx(e.Fragment,{children:((o=n.distribution_info)==null?void 0:o.description)??e.jsx(f,{})})}},{accessor:"availability_zone",canBeHidden:!0,optionLabel:"Availability zone",Header:"Availability zone",Cell:({row:{original:n}})=>{var o;return e.jsx(e.Fragment,{children:((o=n.cloud_init)==null?void 0:o.availability_zone)??e.jsx(f,{})})}},{accessor:"ubuntu_pro",canBeHidden:!0,optionLabel:"Ubuntu pro",Header:"Ubuntu pro expiration",className:"date-cell",Cell:({row:n})=>{var o;return((o=n.original.ubuntu_pro_info)==null?void 0:o.result)==="success"&&j(n.original.ubuntu_pro_info.expires).isValid()?e.jsx("span",{className:"font-monospace",children:j(n.original.ubuntu_pro_info.expires).format(U)}):e.jsx(f,{})}},{accessor:"last_ping",canBeHidden:!0,optionLabel:"Last ping",Header:"Last ping time",className:"date-cell",Cell:({row:n})=>e.jsx(e.Fragment,{children:j(n.original.last_ping_time).isValid()?e.jsx("span",{className:"font-monospace",children:j(n.original.last_ping_time).format(U)}):e.jsx(f,{})})}],[t.length,a,g]);c.useEffect(()=>{l(ie(b))},[]);const P=c.useMemo(()=>b.filter(({accessor:n})=>typeof n=="string"&&!p.includes(n)),[p.length,b]);return e.jsx(Y,{emptyMsg:A?"No instances found according to your search parameters.":"No instances found",columns:P,data:x,getHeaderProps:de,minWidth:1400})}),d={Online:{alertType:"ComputerOnlineAlert",label:"Computers online",alternateLabel:"Online",filterValue:"computer-online",query:"NOT alert:computer-offline",icon:{gray:"connected",color:"connected-color"}},ComputerDuplicateAlert:{alertType:"ComputerDuplicateAlert",label:"Computer duplicates",alternateLabel:"Duplicate",filterValue:"computer-duplicates",query:"alert:computer-duplicates",icon:{gray:"canvas",color:"canvas-color"}},ComputerOfflineAlert:{alertType:"ComputerOfflineAlert",label:"Computers offline",alternateLabel:"Offline",filterValue:"computer-offline",query:"alert:computer-offline",icon:{gray:"disconnect",color:"disconnect-color"}},ComputerRebootAlert:{alertType:"ComputerRebootAlert",label:"Computer reboot",alternateLabel:"Reboot required",filterValue:"computer-reboot",query:"alert:computer-reboot",icon:{gray:"power-off",color:"power-off-color"}},EsmDisabledAlert:{alertType:"EsmDisabledAlert",label:"ESM disabled",alternateLabel:"ESM updates are disabled",filterValue:"esm-disabled",query:"alert:esm-disabled",icon:{gray:"computer-esm-disabled-alert",color:"computer-esm-disabled-alert-color"}},PackageProfilesAlert:{alertType:"PackageProfilesAlert",label:"Package profiles",filterValue:"package-profiles",query:"alert:package-profiles",icon:{color:"package-profiles-alert"}},PackageReporterAlert:{alertType:"PackageReporterAlert",label:"Package reporter",filterValue:"package-reporter",query:"alert:package-reporter",icon:{color:"package-reporter-alert"}},PackageUpgradesAlert:{alertType:"PackageUpgradesAlert",label:"Package upgrades",alternateLabel:"Regular",filterValue:"package-upgrades",query:"alert:package-upgrades",icon:{color:"regular-upgrades"}},SecurityUpgradesAlert:{alertType:"SecurityUpgradesAlert",label:"Security upgrades",alternateLabel:"Security",filterValue:"security-upgrades",query:"alert:security-upgrades",icon:{color:"security-upgrades"}},UnapprovedActivitiesAlert:{alertType:"UnapprovedActivitiesAlert",label:"Unapproved activities",filterValue:"unapproved-activities",query:"alert:unapproved-activities",icon:{gray:"status-queued"}},UpToDate:{alertType:"UpToDate",label:"Up to date",alternateLabel:"Up to date",filterValue:"up-to-date",query:"NOT alert:package-upgrades",icon:{color:"up-to-date"}},PendingComputersAlert:{alertType:"PendingComputersAlert",label:"Pending",alternateLabel:"Pending",filterValue:"",query:"",icon:{gray:"pause",color:"pause-color"}},ChildInstanceProfileAlert:{alertType:"ChildInstanceProfileAlert",label:"Child instance profiles",alternateLabel:"Child instance profiles",filterValue:"child-instance-profiles",query:"alert:child-instance-profiles",icon:{gray:"machines"}},Unknown:{alertType:"",label:"-",alternateLabel:"-",filterValue:"",query:"",icon:{color:"package-profiles-alert"}}},S=["UpToDate","PackageUpgradesAlert","SecurityUpgradesAlert","PackageProfilesAlert","PackageReporterAlert","EsmDisabledAlert","ComputerOfflineAlert","ComputerOnlineAlert","ComputerRebootAlert","ComputerDuplicateAlert","UnapprovedActivitiesAlert","ChildInstanceProfileAlert"],pe={label:"Archived",value:"archived"},ve={os:{type:"select",options:[{label:"All",value:"",query:""},{label:"Ubuntu",value:"ubuntu",query:"NOT distribution:windows"},{label:"Windows",value:"windows",query:"distribution:windows"}]},groupBy:{options:[{label:"None",value:""},{label:"Parent",value:"parent"}]},status:{type:"select",options:[{label:"All",value:"",query:""},...Object.values(d).filter(({alertType:r})=>S.includes(r)).sort((r,a)=>S.indexOf(r.alertType)-S.indexOf(a.alertType)).map(({label:r,filterValue:a,query:t})=>({label:r,value:a,query:t})),pe]}},ge=c.lazy(async()=>m(()=>import("./index-kKLN66m1.js"),__vite__mapDeps([0,1,2,3,4,5]))),ke=()=>{const{setSidePanelContent:r}=N(),{getPendingInstancesQuery:a}=I(),{data:t}=a();if(!t||!t.data.length)return null;const l=()=>{r("Review Pending Instances",e.jsx(c.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(ge,{instances:t.data})}),"large")};return e.jsxs(u.Notification,{severity:"information",title:"Pending instances",children:[e.jsx("span",{children:`You currently have ${t.data.length} pending
          	${h(t.data.length,"instance")}
          	awaiting your review and approval. `}),e.jsx(u.Button,{type:"button",appearance:"link",onClick:l,children:"Review Pending Instances"})]})},E=({action:r,onDetailsClick:a,selected:t})=>{var l;return{title:`Selected ${h(t.length,"instance has","instances have")} been queued for ${r}.`,message:`${h(t.length,`"${((l=t[0])==null?void 0:l.title)??""}" instance has`,`${t.length} instances have`)} been queued in Activities for ${r}.`,actions:[{label:"View details",onClick:a}]}},he="_warning_16r8d_1",me={warning:he},be=c.lazy(async()=>m(()=>import("./index-mOP8NYd6.js"),__vite__mapDeps([6,7,1,2,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29])).then(r=>({default:r.RunInstanceScriptForm}))),fe=c.lazy(async()=>m(()=>import("./index-CD7M0OSa.js"),__vite__mapDeps([30,1,2,15,16,17,31,32,33,34,3])).then(r=>({default:r.Upgrades})));c.lazy(async()=>m(()=>import("./index-BRDnZsk7.js"),__vite__mapDeps([35,1,2,15,16,17,36])));const ye=c.lazy(async()=>m(()=>import("./index-DSUk8sFo.js"),__vite__mapDeps([37,1,2,15,16,17,4]))),Ae=c.lazy(async()=>m(()=>import("./index-D7YOg-Jc.js"),__vite__mapDeps([38,1,2,15,16,17,3,39,31,32]))),Pe=c.memo(function({isGettingInstances:a,selectedInstances:t}){const l=J(),{notify:i}=K(),{openActivityDetails:p}=X(),{setSidePanelContent:g}=N(),[v,A]=c.useState(!1),[k,x]=c.useState(!1),{rebootInstancesQuery:b,shutdownInstancesQuery:P}=I(),{mutateAsync:n,isPending:o}=b,{mutateAsync:B,isPending:L}=P,w=s=>e.jsxs(e.Fragment,{children:[e.jsx("b",{children:s.length})," ",h(s.length,"instance")]}),q=async()=>{g("Run script",e.jsxs(c.Suspense,{fallback:e.jsx(y,{}),children:[t.some(s=>!_("runScripts",s))?e.jsxs("div",{className:me.warning,children:[e.jsxs("p",{children:["You selected ",t.length," instances. This script will:"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:["run on"," ",w(t.filter(s=>_("runScripts",s)))]}),e.jsxs("li",{children:["not run on"," ",w(t.filter(s=>!_("runScripts",s)))]})]})]}):null,e.jsx(be,{query:t.map(({id:s})=>`id:${s}`).join(" OR ")})]}))},V=async()=>{try{const{data:s}=await B({computer_ids:t.map(({id:T})=>T)});i.success(E({action:"shutdown",onDetailsClick:()=>{p(s)},selected:t}))}catch(s){l(s)}},H=async()=>{try{const{data:s}=await n({computer_ids:t.map(({id:T})=>T)});i.success(E({action:"reboot",onDetailsClick:()=>{p(s)},selected:t}))}catch(s){l(s)}},F=()=>{g("Upgrades",e.jsx(c.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(fe,{selectedInstances:t})}),"large")},$=()=>{g("Assign access group",e.jsx(c.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(ye,{selected:t})}))},M=()=>{g("Assign tags",e.jsx(c.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(Ae,{selected:t})}))};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{collapseFrom:"xl",buttons:[e.jsxs(u.Button,{className:"has-icon",type:"button",disabled:L||t.length===0||a,onClick:()=>{x(!0)},children:[e.jsx(u.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]},"shutdown-instances"),e.jsxs(u.Button,{hasIcon:!0,type:"button",disabled:o||t.length===0||a,onClick:()=>{A(!0)},children:[e.jsx(u.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]},"reboot-instances"),Z,e.jsxs(u.Button,{type:"button",hasIcon:!0,onClick:q,disabled:t.every(s=>!_("runScripts",s))||a,children:[e.jsx(u.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]},"run-script"),e.jsxs(u.Button,{type:"button",hasIcon:!0,onClick:F,disabled:t.every(s=>!ne(s.alerts))||a,children:[e.jsx(u.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]},"upgrade-instances")]}),e.jsx(u.ContextualMenu,{hasToggleIcon:!0,links:[{children:"Access group",onClick:$},{children:"Tags",onClick:M}],position:"right",toggleLabel:e.jsxs(e.Fragment,{children:[e.jsx(u.Icon,{name:"plus"}),e.jsx("span",{children:"Assign"})]}),toggleClassName:"u-no-margin--bottom",toggleDisabled:t.length===0,dropdownProps:{style:{zIndex:10}}}),v&&e.jsx(u.ConfirmationModal,{close:()=>{A(!1)},title:"Restarting selected instances",confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonLoading:o,confirmButtonDisabled:o,onConfirm:H,children:e.jsxs("p",{children:["Are you sure you want to restart ",t.length,h(t.length,"instance"),"?"]})}),k&&e.jsx(u.ConfirmationModal,{close:()=>{x(!1)},title:"Shutting down selected instances",confirmButtonLabel:"Shutdown",confirmButtonAppearance:"negative",confirmButtonLoading:L,confirmButtonDisabled:L,onConfirm:V,children:e.jsxs("p",{children:["Are you sure you want to shutdown ",t.length,h(t.length,"instance"),"?"]})})]})});export{ve as F,Ce as I,ke as P,d as S,Pe as a,O as g};
