const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Crgv2g7h.js","assets/index-BniO5lih.js","assets/index-zG6MToCc.css","assets/SelectAllButton-DQS6yqhs.js","assets/ExpandableTableFooter-DavPKb8s.js","assets/ExpandableTableFooter-CF0EpBAN.css","assets/useUsns-r5HiN7yD.js","assets/constants-HWGNn3R9.js","assets/useUsns-BR-xUdoS.css","assets/index-CVpc4WXo.css","assets/index-CVcRJTLU.js","assets/index-CsEBA8CB.css","assets/index-Cdh9lMIo.js","assets/UsnList-CIBCq4Ry.js","assets/UsnList-C7uwsPil.css"])))=>i.map(i=>d[i]);
import{as as j,at as I,au as m,j as e,V as T,x as r,H as h,r as d,W as o,o as b,av as L,a7 as x,z as C,B as V,y as N,C as B,d as k,aw as R,i as g}from"./index-BniO5lih.js";import{S as D}from"./SidePanelFormButtons-bG-J2X_B.js";import{a as F,u as $}from"./useUsns-r5HiN7yD.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./constants-HWGNn3R9.js";const w=({instances:t})=>{const a=t.filter(({alerts:c})=>j(c)).length,l=t.filter(({alerts:c})=>I(c)).length,s=t.filter(({alerts:c})=>!m(c)).length;return e.jsxs("div",{children:[e.jsx("span",{children:"You selected "}),e.jsx("span",{children:e.jsx("b",{children:t.length})}),e.jsx("span",{children:" instances:"}),e.jsxs("ul",{className:T({"u-no-margin--bottom":s>0}),children:[a>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Security upgrades are available for "}),e.jsx("b",{children:a}),e.jsx("span",{children:r(a,"instance")})]}),l>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Regular upgrades are available for "}),e.jsx("b",{children:l}),e.jsx("span",{children:r(l,"instance")})]})]}),s>0&&e.jsxs("p",{children:[e.jsx("span",{children:"No upgrades for "}),e.jsx("span",{children:e.jsx("b",{children:s})}),e.jsxs("span",{children:[r(s,"instance")," needed."]})]})]})},f=[{id:"tab-link-instances",label:"Instances"},{id:"tab-link-packages",label:"Packages"},{id:"tab-link-usns",label:"USNs"}],p={instances:d.lazy(()=>x(()=>import("./index-Crgv2g7h.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),packages:d.lazy(()=>x(()=>import("./index-CVcRJTLU.js"),__vite__mapDeps([10,1,2,6,7,8,3,4,5,11]))),usns:d.lazy(()=>x(()=>import("./index-Cdh9lMIo.js"),__vite__mapDeps([12,1,2,13,3,4,5,6,7,8,14])))},z=h().shape({excludedPackages:o().of(h().shape({id:L().required(),exclude_packages:o().of(b())})),excludedUsns:o().of(b())}),O=({activeTabLinkId:t,onTabLinkClick:a,withUsnsTab:l})=>f.filter(({id:s})=>l||s!=="tab-link-usns").map(({id:s,label:c})=>({id:s,label:c,active:s===t,onClick:()=>{a(s)},role:"tab"})),W=t=>({excludedPackages:t.map(({id:a})=>({id:a,exclude_packages:[]})),excludedUsns:[]}),M=({selectedInstances:t})=>{const[a,l]=d.useState(f[0].id),s=t.filter(({alerts:n})=>m(n)),c=s.filter(({alerts:n})=>j(n)),P=C(),{notify:_}=V(),{closeSidePanel:S}=N(),{upgradeInstancesPackagesQuery:U}=F(),{upgradeUsnsQuery:y}=$(),{mutateAsync:v}=U,{mutateAsync:A}=y,E=async n=>{try{a==="tab-link-usns"?await A({computers:c.map(({id:u})=>({id:u,exclude_usns:n.excludedUsns}))}):await v({computers:n.excludedPackages}),S(),_.success({title:"You queued packages to be upgraded",message:`Packages on ${t.length} ${r(t.length,"instance")} will be upgraded and are queued in Activities`})}catch(u){P(u)}},i=B({initialValues:W(s),onSubmit:E,validationSchema:z});return e.jsxs(k.Form,{onSubmit:i.handleSubmit,children:[e.jsx(w,{instances:t}),e.jsx(k.Tabs,{links:O({activeTabLinkId:a,onTabLinkClick:n=>{l(n)},withUsnsTab:c.length>0})}),e.jsx(R,{children:e.jsxs("div",{tabIndex:0,role:"tabpanel","aria-labelledby":a,children:[a==="tab-link-instances"&&e.jsx(d.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(p.instances,{excludedPackages:i.values.excludedPackages,instances:s,onExcludedPackagesChange:async n=>i.setFieldValue("excludedPackages",n)})}),a==="tab-link-packages"&&e.jsx(d.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(p.packages,{excludedPackages:i.values.excludedPackages,instances:s,onExcludedPackagesChange:async n=>i.setFieldValue("excludedPackages",n)})}),a==="tab-link-usns"&&e.jsx(d.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(p.usns,{excludedUsns:i.values.excludedUsns,instances:c,onExcludedUsnsChange:async n=>i.setFieldValue("excludedUsns",n)})})]})}),e.jsx(D,{submitButtonDisabled:i.isSubmitting,submitButtonText:"Upgrade"})]})};export{M as Upgrades};
