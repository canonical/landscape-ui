const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bi_8EXa7.js","assets/index-2fzpjuii.js","assets/index-DBjrXwEZ.css","assets/SelectAllButton-Tn0tIpY_.js","assets/ExpandableTableFooter-DCvzJtCE.js","assets/ExpandableTableFooter-DWm8zyWg.css","assets/usePackages-Dz1pfWlQ.js","assets/usePackages-D2X0CFCl.css","assets/index-opcF9JuM.css","assets/index-Bo1I37zy.js","assets/index-DXCgn1fK.css","assets/index-CasDGj9E.js","assets/UsnList-Bn5Mjoeg.js","assets/TruncatedCell-CgdNfcLB.js","assets/TruncatedCell-CoXbu3VM.css","assets/helpers-BonKpxw0.js","assets/helpers-CCHFURK6.css","assets/UsnList-B4hAwQmb.css"])))=>i.map(i=>d[i]);
import{j as e,n as v,C as p,r as d,K as u,G as x,H as E,_ as o,y as I,z as T,l as L,A as C,m as h,ag as V,o as N}from"./index-2fzpjuii.js";import{S as R}from"./SidePanelFormButtons-DAl7F5tV.js";import{h as b,a as B,d as k}from"./helpers-arjbKCLn.js";import"./InstancesPageActions-O3tu5ZlC.js";import{a as D,u as F}from"./usePackages-Dz1pfWlQ.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./useInstances-DeMDoX3c.js";const $=({instances:t})=>{const a=t.filter(({alerts:c})=>b(c)).length,l=t.filter(({alerts:c})=>B(c)).length,s=t.filter(({alerts:c})=>!k(c)).length;return e.jsxs("div",{children:[e.jsx("span",{children:"You selected "}),e.jsx("span",{children:e.jsx("b",{children:t.length})}),e.jsx("span",{children:" instances:"}),e.jsxs("ul",{className:v({"u-no-margin--bottom":s>0}),children:[a>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Security upgrades are available for "}),e.jsx("b",{children:a}),e.jsx("span",{children:a!==1?" instances":" instance"})]}),l>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Regular upgrades are available for "}),e.jsx("b",{children:l}),e.jsx("span",{children:l!==1?" instances":" instance"})]})]}),s>0&&e.jsxs("p",{children:[e.jsx("span",{children:"No upgrades for "}),e.jsx("span",{children:e.jsx("b",{children:s})}),e.jsx("span",{children:s!==1?" instances needed.":" instance needed."})]})]})},m=[{id:"tab-link-instances",label:"Instances"},{id:"tab-link-packages",label:"Packages"},{id:"tab-link-usns",label:"USNs"}],g={instances:d.lazy(()=>o(()=>import("./index-Bi_8EXa7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),packages:d.lazy(()=>o(()=>import("./index-Bo1I37zy.js"),__vite__mapDeps([9,1,2,6,7,3,4,5,10]))),usns:d.lazy(()=>o(()=>import("./index-CasDGj9E.js"),__vite__mapDeps([11,1,2,12,3,4,5,13,14,6,7,15,16,17])))},w=p().shape({excludedPackages:u().of(p().shape({id:E().required(),exclude_packages:u().of(x())})),excludedUsns:u().of(x())}),z=({activeTabLinkId:t,onTabLinkClick:a,withUsnsTab:l})=>m.filter(({id:s})=>l||s!=="tab-link-usns").map(({id:s,label:c})=>({id:s,label:c,active:s===t,onClick:()=>a(s),role:"tab"})),O=t=>({excludedPackages:t.map(({id:a})=>({id:a,exclude_packages:[]})),excludedUsns:[]}),M=({selectedInstances:t})=>{const[a,l]=d.useState(m[0].id),s=t.filter(({alerts:n})=>k(n)),c=s.filter(({alerts:n})=>b(n)),j=I(),{notify:f}=T(),{closeSidePanel:P}=L(),{upgradeInstancesPackagesQuery:_}=D(),{upgradeUsnsQuery:U}=F(),{mutateAsync:S}=_,{mutateAsync:y}=U,A=async n=>{try{a==="tab-link-usns"?await y({computers:c.map(({id:r})=>({id:r,exclude_usns:n.excludedUsns}))}):await S({computers:n.excludedPackages}),P(),f.success({title:"You queued packages to be upgraded",message:`Packages on ${t.length} ${t.length!==1?"instances":"instance"} will be upgraded and are queued in Activities`})}catch(r){j(r)}},i=C({initialValues:O(s),onSubmit:A,validationSchema:w});return e.jsxs(h.Form,{onSubmit:i.handleSubmit,children:[e.jsx($,{instances:t}),e.jsx(h.Tabs,{links:z({activeTabLinkId:a,onTabLinkClick:n=>l(n),withUsnsTab:c.length>0})}),e.jsx(V,{children:e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":a,children:e.jsxs(d.Suspense,{fallback:e.jsx(N,{}),children:[a==="tab-link-instances"&&e.jsx(g.instances,{excludedPackages:i.values.excludedPackages,instances:s,onExcludedPackagesChange:n=>i.setFieldValue("excludedPackages",n)}),a==="tab-link-packages"&&e.jsx(g.packages,{excludedPackages:i.values.excludedPackages,instances:s,onExcludedPackagesChange:n=>i.setFieldValue("excludedPackages",n)}),a==="tab-link-usns"&&e.jsx(g.usns,{excludedUsns:i.values.excludedUsns,instances:c,onExcludedUsnsChange:n=>i.setFieldValue("excludedUsns",n)})]})})}),e.jsx(R,{submitButtonDisabled:i.isSubmitting,submitButtonText:"Upgrade"})]})};export{M as Upgrades};
