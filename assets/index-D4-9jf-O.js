import{l as b,j as s,F as C,b as _,h as v,O as A,o as N,Q as F,q as P,v as w,I as E,d as y,s as O,at as S}from"./index-CDk-Jgvr.js";import{A as j}from"./AuthTemplate-DMls5jlg.js";const c=6,V="_otpContainer_m5ew4_9",T="_input_m5ew4_14",x={otpContainer:V,input:T},$=({value:n,onChange:r,error:i,onComplete:d})=>{const h=b.useRef(new Array(c).fill(null));b.useEffect(()=>{const t=n.findIndex(a=>a===""),e=t===-1?c-1:t;h.current[e]?.focus()},[n]);const p=t=>e=>{const a=e.target,l=a.value.replace(/[^A-Za-z0-9]/g,"");let f=l;if(l.length>1){const u=a.selectionStart;f=u&&u>0?l[u-1]:l.slice(-1)}const m=[...n];m[t]=f,r(m),m.every(u=>u!=="")&&setTimeout(()=>{d()},0)},o=t=>e=>{e.key==="Backspace"&&!n[t]&&t>0&&h.current[t-1]?.focus()},g=t=>e=>{e.preventDefault();const a=e.clipboardData.getData("text").replace(/[^A-Za-z0-9]/g,"");if(!a.length)return;const l=a.split(""),f=[...n.slice(0,t),...l,...n.slice(t+l.length)].slice(0,c),m=Object.assign(Array(c).fill(""),f);r(m),m.every(u=>u!=="")&&setTimeout(()=>{d()},0)};return s.jsxs("fieldset",{className:C("p-form__group p-form-validation",{"is-error":i}),role:"group","aria-labelledby":"otp-label",children:[s.jsx("legend",{id:"otp-label",children:"Code"}),s.jsx("div",{className:"p-form__control u-clearfix",children:s.jsx("div",{className:x.otpContainer,children:Array.from({length:c}).map((t,e)=>s.jsx("input",{ref:a=>{h.current[e]=a},type:"text",inputMode:"text",className:x.input,value:n[e]||"",onChange:p(e),onKeyDown:o(e),onPaste:g(e),"aria-label":`Digit ${e+1} of ${c}`},e))})}),i&&s.jsx("p",{className:"p-form-validation__message is-error",id:"otp-error",children:i})]})},k=()=>{const n=_(),{mutateAsync:r,isPending:i}=v({mutationFn:d=>n.get(`ubuntu-installer-attach-sessions/code/${d.attach_code}`)});return{verify:r,isVerifying:i}},D="_buttonContainer_1skbi_1",I={buttonContainer:D},L=()=>{const[n]=A(),r=N(),i=F(),{verify:d,isVerifying:h}=k(),p=n.get("code")||"",o=P({initialValues:{code:Object.assign(Array(c).fill(""),p?.split("")||[])},validationSchema:w().shape({code:E().test("is-complete",`Code must be ${c} characters long`,t=>t!=null&&t.every(e=>e&&e!==""))}),enableReinitialize:!0,onSubmit:async t=>{try{const e=t.code.join(""),{data:a}=await d({attach_code:e});if(!a.valid){r("The code you entered has expired and is no longer valid."),o.resetForm({values:{code:Array(c).fill("")}});return}i(`/login?code=${e}`)}catch(e){r(e)}}});b.useEffect(()=>{p&&p.length===c&&p.split("").every(e=>e&&e!=="")&&o.submitForm()},[]);const g=t=>{o.setFieldValue("code",t)};return s.jsx(j,{title:"Enter code to connect to the Ubuntu installer",children:s.jsxs(y.Form,{onSubmit:o.handleSubmit,children:[s.jsx($,{value:o.values.code,onChange:g,onComplete:o.submitForm,error:O(o,"code")}),s.jsx("div",{className:I.buttonContainer,children:s.jsx(y.Button,{className:"u-no-margin--bottom",type:"submit",appearance:"positive",disabled:o.isSubmitting||h,children:"Next"})})]})})},R=()=>s.jsx(j,{title:"Sign in successful",children:s.jsx("p",{className:"u-text--muted",children:"You can close this tab and go back to the Ubuntu installer."})}),K=()=>S().state?.success===!0?s.jsx(R,{}):s.jsx(L,{});export{K as default};
