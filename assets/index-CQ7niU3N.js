import{j as e,r as j,b as P,y as _,O as y,d as n,B as v,q as I,x as S,a as U,t as N,k as O,n as w,R as T,o as A}from"./index-BfdtIpha.js";import{u as L,A as R}from"./AuthTemplate-LBKoCJM2.js";const B=({methods:s})=>{if(!s)return null;const a=!!(s.standalone_oidc.available&&s.standalone_oidc.enabled),l=!!(s.ubuntu_one.available&&s.ubuntu_one.enabled),i=!!(s.password.available&&s.password.enabled),r=!!(s.pam.available&&s.pam.enabled),p=s.oidc.available?s.oidc.configurations.filter(({enabled:x})=>x):[],o=i||r,c=l||a||s.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[o&&e.jsx(H,{isIdentityAvailable:r}),c&&e.jsx($,{isStandaloneOidcEnabled:a,isUbuntuOneEnabled:l,oidcProviders:p}),!o&&!c&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},k="_list_9u1s7_1",q="_button_9u1s7_20",F="_icon_9u1s7_28",b={list:k,button:q,icon:F},$=({isStandaloneOidcEnabled:s,isUbuntuOneEnabled:a,oidcProviders:l})=>{const[i,r]=j.useState(0),[p]=P(),{invitationId:o}=L(),{getOidcUrlQuery:c,getUbuntuOneUrlQuery:x}=_(),g=p.get("redirect-to"),t=p.has("external"),d={};i>0&&(d.id=i),g&&(d.return_to=g),o&&(d.invitation_id=o),t&&(d.external=!0);const{data:u}=c(d,{enabled:i!==0});j.useEffect(()=>{u&&y(u.data.location)},[u]);const m={};g&&(m.return_to=`${window.origin}${g}`),o&&(m.invitation_id=o),t&&(m.external=!0);const{data:f,refetch:E}=x(m,{enabled:!1});return j.useEffect(()=>{f&&y(f.data.location)},[f]),e.jsxs("ul",{className:b.list,children:[a&&e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:E,className:b.button,children:[e.jsx(n.Icon,{name:v("ubuntu-one"),className:b.icon}),e.jsx("span",{children:"Sign in with Ubuntu One"})]})}),s&&e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:()=>r(-1),className:b.button,children:[e.jsx(n.Icon,{name:v("standalone"),className:b.icon}),e.jsx("span",{children:"Sign in with Enterprise Login"})]})}),l.map(h=>e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:()=>r(h.id),className:b.button,children:[e.jsx(n.Icon,{name:v(h.provider),className:b.icon}),e.jsx("span",{children:`Sign in with ${h.name}`})]})},h.id))]})},Q="_buttonRow_f3s21_1",C={buttonRow:Q},H=({isIdentityAvailable:s})=>{const[a]=P(),l=I(),{signInWithEmailAndPasswordQuery:i}=_(),{setUser:r,redirectToExternalUrl:p}=S(),o=U(),c=a.get("redirect-to"),x=a.has("external"),{mutateAsync:g}=i,t=N({initialValues:{email:"",password:""},validationSchema:O().shape({email:s?w().required("This field is required"):w().required("This field is required").email("Please provide a valid email address"),password:w().required("This field is required")}),onSubmit:async d=>{try{const{data:u}=await g({email:d.email,password:d.password});if(x&&c)p(c,{replace:!0});else{"current_account"in u&&r(u);const m=new URL(c??`${T}overview`,location.origin);o(m.toString().replace(m.origin,""),{replace:!0})}}catch(u){l(u)}}});return e.jsxs(n.Form,{onSubmit:t.handleSubmit,children:[e.jsx(n.Input,{type:"text",label:s?"Identity":"Email",error:t.touched.email&&t.errors.email?t.errors.email:void 0,...t.getFieldProps("email"),"data-testid":"email"}),e.jsx(n.PasswordToggle,{id:"password",label:"Password",error:t.touched.password&&t.errors.password?t.errors.password:void 0,...t.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:C.buttonRow,children:e.jsx(n.Button,{type:"submit",appearance:"positive",disabled:t.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},G=()=>{const{getLoginMethodsQuery:s}=_(),{data:a,isLoading:l,isError:i,error:r}=s();return e.jsx(R,{title:"Sign in to Landscape",children:l?e.jsx(A,{}):i?e.jsxs("div",{children:[e.jsx("h1",{children:"Error"}),e.jsx("pre",{children:JSON.stringify(r,null,2)})]}):e.jsx(B,{methods:(a==null?void 0:a.data)??null})})};export{G as default};
