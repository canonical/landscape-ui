import{j as e,r as w,w as I,y as j,T as v,g as a,A as _,p as E,x as S,a as T,s as U,h as N,k as y,n as A,C as O}from"./index-F5ixs2NP.js";import{u as L,A as k}from"./AuthTemplate-BhUeyThR.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new s.Error().stack;n&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[n]="0d9eae75-54f1-49c0-9c75-78b1da6933dd",s._sentryDebugIdIdentifier="sentry-dbid-0d9eae75-54f1-49c0-9c75-78b1da6933dd")}catch{}const R=({methods:s})=>{if(!s)return null;const n=!!(s.standalone_oidc.available&&s.standalone_oidc.enabled),l=!!(s.ubuntu_one.available&&s.ubuntu_one.enabled),i=!!(s.password.available&&s.password.enabled),c=!!(s.pam.available&&s.pam.enabled),b=s.oidc.available?s.oidc.configurations.filter(({enabled:d})=>d):[],o=i||c,m=l||n||s.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[o&&e.jsx(D,{isIdentityAvailable:c}),m&&e.jsx(C,{isStandaloneOidcEnabled:n,isUbuntuOneEnabled:l,oidcProviders:b}),!o&&!m&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},B="_list_9u1s7_1",F="_button_9u1s7_20",q="_icon_9u1s7_28",u={list:B,button:F,icon:q},C=({isStandaloneOidcEnabled:s,isUbuntuOneEnabled:n,oidcProviders:l})=>{const[i,c]=w.useState(0),[b]=I(),{invitationId:o}=L(),{getOidcUrlQuery:m,getUbuntuOneUrlQuery:d}=j(),p=b.get("redirect-to"),h=b.has("external"),t={};i>0&&(t.id=i),p&&(t.return_to=p),o&&(t.invitation_id=o),h&&(t.external=!0);const{data:g}=m(t,{enabled:i!==0});w.useEffect(()=>{g&&v(g.data.location)},[g]);const r={};p&&(r.return_to=`${window.origin}${p}`),o&&(r.invitation_id=o),h&&(r.external=!0);const{data:f,refetch:P}=d(r,{enabled:!1});return w.useEffect(()=>{f&&v(f.data.location)},[f]),e.jsxs("ul",{className:u.list,children:[n&&e.jsx("li",{className:"p-list__item",children:e.jsxs(a.Button,{type:"button",hasIcon:!0,onClick:P,className:u.button,children:[e.jsx(a.Icon,{name:_("ubuntu-one"),className:u.icon}),e.jsx("span",{children:"Sign in with Ubuntu One"})]})}),s&&e.jsx("li",{className:"p-list__item",children:e.jsxs(a.Button,{type:"button",hasIcon:!0,onClick:()=>c(-1),className:u.button,children:[e.jsx(a.Icon,{name:_("standalone"),className:u.icon}),e.jsx("span",{children:"Sign in with Enterprise Login"})]})}),l.map(x=>e.jsx("li",{className:"p-list__item",children:e.jsxs(a.Button,{type:"button",hasIcon:!0,onClick:()=>c(x.id),className:u.button,children:[e.jsx(a.Icon,{name:_(x.provider),className:u.icon}),e.jsx("span",{children:`Sign in with ${x.name}`})]})},x.id))]})},Q="_buttonRow_f3s21_1",$={buttonRow:Q},D=({isIdentityAvailable:s})=>{const[n]=I(),l=E(),{signInWithEmailAndPasswordQuery:i}=j(),{redirectToExternalUrl:c,setAuthLoading:b,setUser:o}=S(),m=T(),d=n.get("redirect-to"),p=n.has("external"),{mutateAsync:h}=i,t=U({initialValues:{email:"",password:""},validationSchema:N().shape({email:s?y().required("This field is required"):y().required("This field is required").email("Please provide a valid email address"),password:y().required("This field is required")}),onSubmit:async g=>{try{const{data:r}=await h({email:g.email,password:g.password});if(p&&d)c(d,{replace:!0});else{"current_account"in r&&(b(!0),o(r));const f=new URL(d??"/overview",location.origin);m(f.toString().replace(f.origin,""),{replace:!0})}}catch(r){l(r)}}});return e.jsxs(a.Form,{onSubmit:t.handleSubmit,children:[e.jsx(a.Input,{type:"text",label:s?"Identity":"Email",error:t.touched.email&&t.errors.email?t.errors.email:void 0,...t.getFieldProps("email"),"data-testid":"email"}),e.jsx(a.PasswordToggle,{id:"password",label:"Password",error:t.touched.password&&t.errors.password?t.errors.password:void 0,...t.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:$.buttonRow,children:e.jsx(a.Button,{type:"submit",appearance:"positive",disabled:t.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},W=()=>{const{getLoginMethodsQuery:s}=j(),{data:n,isLoading:l,isError:i}=s();return e.jsx(k,{title:"Sign in to Landscape",children:l?e.jsx(A,{}):i?e.jsx("p",{className:"u-no-margin--bottom",children:O}):e.jsx(R,{methods:(n==null?void 0:n.data)??null})})};export{W as default};
