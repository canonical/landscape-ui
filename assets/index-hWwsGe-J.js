const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CX0H2nLM.js","assets/index-u_EhbhC_.js","assets/index-DWaf_ZwL.css","assets/MultiSelectField-ehdSZtl5.js","assets/MultiSelectField-DOBW8uWL.css","assets/SidePanelFormButtons-xqQ8httV.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/useRoles-BOXb_ntO.js","assets/PageMain-CmLgxdJK.js","assets/PageMain-BIuYvhUI.css","assets/useMutation-CrcSbzv3.js","assets/useFetchOld-BBfSXCp-.js","assets/index.esm-BQnwAMDD.js","assets/EmptyState-BqInhbHc.js","assets/EmptyState-DUn4ZRie.css","assets/TablePagination-B-hCaI46.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-TkE3cuN_.js","assets/useConfirm-B8tJ1H3c.js","assets/InfoItem-DfMbt4qK.js","assets/InfoItem-C-lWh_lY.css","assets/NoData-BfY2RoAl.js","assets/moment-C5S46NFB.js"])))=>i.map(i=>d[i]);
import{c as O,d as K,r as p,n as F,e as P,g as E,j as e,h as l,f as N,_ as L,l as k,B as w}from"./index-u_EhbhC_.js";import{u as Q,P as Y,a as U,b as G}from"./PageMain-CmLgxdJK.js";import{E as W}from"./EmptyState-BqInhbHc.js";import{u as C}from"./useMutation-CrcSbzv3.js";import{u as J}from"./useFetchOld-BBfSXCp-.js";import{T as X}from"./TablePagination-B-hCaI46.js";import{u as B}from"./useRoles-BOXb_ntO.js";import{u as $}from"./useConfirm-B8tJ1H3c.js";import{c as D,b as q,a as z}from"./index.esm-BQnwAMDD.js";import{M as V}from"./MultiSelectField-ehdSZtl5.js";import{S as Z}from"./SidePanelFormButtons-xqQ8httV.js";import{I as _}from"./InfoItem-DfMbt4qK.js";import{N as M}from"./NoData-BfY2RoAl.js";import{u as H}from"./usePageParams-TkE3cuN_.js";import{h as I}from"./moment-C5S46NFB.js";function S(){const s=O(),a=J(),o=K(),d=(i,b={})=>Q({queryKey:["administrators"],queryFn:()=>a.get("GetAdministrators"),...b}),h=C({mutationFn:i=>a.get("InviteAdministrator",{params:i}),onSuccess:()=>s.invalidateQueries({queryKey:["invitations"]})}),v=C({mutationFn:i=>a.get("DisableAdministrator",{params:i}),onSuccess:()=>s.invalidateQueries({queryKey:["administrators"]})}),g=C({mutationFn:({id:i,...b})=>o.put(`administrators/${i}`,b),onSuccess:()=>Promise.all([s.invalidateQueries({queryKey:["administrators"]}),s.invalidateQueries({queryKey:["roles"]})])}),n=(i,b={})=>Q({queryKey:["invitations",i],queryFn:()=>o.get("/invitations",{params:i}),...b}),m=C({mutationFn:i=>o.delete(`/invitations/${i.id}`),onSuccess:()=>s.invalidateQueries({queryKey:["invitations"]})}),u=C({mutationFn:i=>o.post(`/invitations/${i.id}`),onSuccess:()=>s.invalidateQueries({queryKey:["invitations"]})});return{getAdministratorsQuery:d,inviteAdministratorQuery:h,disableAdministratorQuery:v,editAdministratorQuery:g,getInvitationsQuery:n,revokeInvitationQuery:m,resendInvitationQuery:u}}const ee=({administrator:s})=>{const[a,o]=p.useState(s);p.useEffect(()=>{o(s)},[s]);const{notify:d}=F(),h=P(),{confirmModal:v,closeConfirmModal:g}=$(),{disableAdministratorQuery:n,editAdministratorQuery:m}=S(),{getRolesQuery:u}=B(),{data:i}=u(),b=(i==null?void 0:i.data.map(({name:c})=>({label:c,value:c})))??[],{mutateAsync:f}=m,{mutateAsync:y}=n,x=async()=>{try{await y({email:a.email})}catch(c){h(c)}finally{g()}},j=()=>{v({title:"Disable Administrator",body:"This will remove the administrator from your Landscape organization.",buttons:[e.jsx(l.Button,{onClick:x,appearance:"negative",hasIcon:!0,"aria-label":`Remove ${a.name}`,children:"Remove"},"remove-administrator")]})},r=async c=>{try{await f({id:s.id,roles:c.roles}),o(A=>({...A,roles:c.roles})),d.success({title:"Permission changes have been queued",message:`You changed ${a.name}'s roles`})}catch(A){h(A)}},t=E({initialValues:{roles:[]},validationSchema:D().shape({roles:q().of(z()).min(1,"At least one role is required")}),onSubmit:r});return p.useEffect(()=>{t.setValues({roles:a.roles})},[a]),e.jsxs(l.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[e.jsxs(l.Button,{type:"button",hasIcon:!0,onClick:j,children:[e.jsx("i",{className:"p-icon--delete","aria-hidden":"true"}),e.jsx("span",{children:"Remove"})]}),e.jsxs(l.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(l.Col,{size:6,children:e.jsx(_,{label:"Name",value:a.name})}),e.jsx(l.Col,{size:6,children:e.jsx(_,{label:"Email",value:a.email})}),e.jsx(l.Col,{size:12,children:e.jsx(_,{label:"Timezone",value:e.jsx(M,{})})}),e.jsx(l.Col,{size:12,children:e.jsx(_,{label:"Identity URL",value:e.jsx(M,{})})})]}),e.jsx(V,{variant:"condensed",label:"Roles",items:b,selectedItems:b.filter(({value:c})=>t.values.roles.includes(c)),placeholder:"Select roles",onItemsUpdate:c=>t.setFieldValue("roles",c.map(({value:A})=>A)),error:t.touched.roles&&typeof t.errors.roles=="string"?t.errors.roles:void 0}),e.jsx(Z,{submitButtonDisabled:t.isSubmitting||t.values.roles.length===a.roles.length&&t.values.roles.every(c=>a.roles.includes(c)),submitButtonText:"Save changes"})]})},te="_footer_uzw2n_1",se="_multiSelect_uzw2n_7",T={footer:te,multiSelect:se},ae=({administrator:s,roleOptions:a})=>{const o=P(),{notify:d}=F(),{editAdministratorQuery:h}=S(),{mutateAsync:v}=h,g=async({roles:m})=>{try{await v({id:s.id,roles:m}),d.success({title:"Permission changes have been queued",message:`You changed ${s.name}'s roles`})}catch(u){o(u)}},n=E({initialValues:{roles:[]},validationSchema:D().shape({roles:q().of(z()).min(1,"At least one role is required")}),onSubmit:g});return p.useEffect(()=>{n.setValues({roles:s.roles})},[s.roles]),e.jsx(l.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:e.jsx(V,{required:!0,variant:"condensed",className:T.multiSelect,items:a,selectedItems:a.filter(({value:m})=>n.values.roles.includes(m)),onItemsUpdate:m=>n.setValues({roles:m.map(({value:u})=>u)}),placeholder:"Select roles",error:n.touched.roles&&typeof n.errors.roles=="string"?n.errors.roles:void 0,dropdownFooter:e.jsxs("div",{className:T.footer,children:[e.jsx(l.Button,{type:"button",dense:!0,small:!0,className:"u-no-margin--bottom",disabled:n.values.roles.length===s.roles.length&&s.roles.every(m=>n.values.roles.includes(m)),onClick:()=>n.setFieldValue("roles",s.roles),children:"Revert"}),e.jsx(l.Button,{type:"submit",dense:!0,small:!0,appearance:"positive",className:"u-no-margin--bottom",disabled:n.values.roles.length===s.roles.length&&s.roles.every(m=>n.values.roles.includes(m)),children:"Save changes"})]})})})},ne="_roles_1cuab_1",oe="_actions_1cuab_2",ie="_table_1cuab_6",R={roles:ne,actions:oe,table:ie},re=({administrators:s,emptyMessage:a,roles:o})=>{const d=P(),{setSidePanelContent:h}=N(),{confirmModal:v,closeConfirmModal:g}=$(),{disableAdministratorQuery:n}=S(),{mutateAsync:m}=n,u=p.useMemo(()=>s,[s]),i=p.useMemo(()=>o.map(({name:r})=>({label:r,value:r})),[o]),b=async r=>{try{await m({email:r})}catch(t){d(t)}finally{g()}},f=r=>{v({body:"This will remove the administrator from your Landscape organisation.",title:`Remove ${r.name}`,buttons:[e.jsx(l.Button,{appearance:"negative",hasIcon:!0,onClick:()=>b(r.email),"aria-label":`Remove ${r.name}`,children:e.jsx("span",{children:"Remove"})},`remove-administrator-${r.id}`)]})},y=r=>{h(r.name,e.jsx(ee,{administrator:r}))},x=p.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:r})=>e.jsx(l.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{y(r.original)},children:r.original.name})},{accessor:"email",Header:"Email"},{accessor:"roles",className:R.roles,Header:"Roles",Cell:({row:r})=>e.jsx(ae,{administrator:r.original,roleOptions:i})},{accessor:"actions",className:R.actions,Cell:({row:r})=>e.jsxs(l.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left p-tooltip--top-center","aria-label":`Remove ${r.original.name}`,onClick:()=>f(r.original),children:[e.jsx("span",{className:"p-tooltip__message",children:"Remove"}),e.jsx(l.Icon,{name:l.ICONS.delete,className:"u-no-margin--left"})]})}],[u,i]),j=r=>{const t={};return r.column.id==="name"?t.role="rowheader":r.column.id==="email"?t["aria-label"]="Email":r.column.id==="roles"?t["aria-label"]="Roles":r.column.id==="actions"&&(t["aria-label"]="Actions"),t};return e.jsx(l.ModularTable,{columns:x,data:u,getCellProps:j,emptyMsg:a,className:R.table})},le=()=>{const{search:s,setPageParams:a}=H(),[o,d]=p.useState(s),h=()=>{a({search:o})},v=()=>{a({search:""})},g=n=>{n.preventDefault(),h()};return e.jsx(l.Row,{className:"u-no-padding--left u-no-padding--right u-no-margin--left u-no-margin--right",children:e.jsx(l.Col,{size:6,children:e.jsx(l.Form,{onSubmit:g,noValidate:!0,children:e.jsx(l.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,value:o,onChange:n=>d(n),onSearch:h,onClear:v,autocomplete:"off"})})})})},ce=({administrators:s})=>{const{search:a,pageSize:o,currentPage:d}=H(),{getRolesQuery:h}=B(),{data:v}=h(),n=(()=>{const u=a.trim().toLowerCase();return u?s.filter(i=>i.email.toLowerCase().includes(u)||i.name.toLowerCase().includes(u)||i.roles.some(b=>b.toLowerCase().includes(u))):s})(),m=n.filter((u,i)=>i>=(d-1)*o&&i<d*o)??[];return e.jsxs(e.Fragment,{children:[e.jsx(le,{}),e.jsx(re,{administrators:m,emptyMessage:a.trim()?`No administrators found with the search: "${a.trim()}"`:"You have no administrators on your Landscape organisation",roles:(v==null?void 0:v.data)??[]}),m.length>0&&e.jsx(X,{totalItems:n.length,currentItemCount:m.length})]})},de=p.lazy(()=>L(()=>import("./index-CX0H2nLM.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]))),me=()=>{const{setSidePanelContent:s}=N(),{getAdministratorsQuery:a}=S(),{data:o,isLoading:d}=a(),h=()=>{s("Invite administrator",e.jsx(p.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(de,{})}))};return e.jsxs(e.Fragment,{children:[d&&e.jsx(k,{}),!d&&(!o||!o.data.length)&&e.jsx(W,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no administrators in your Landscape organization."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[e.jsx(l.Button,{type:"button",appearance:"positive",onClick:h,children:"Invite Administrator"},"invite-administrator")],icon:"user",title:"No administrators found"}),!d&&o&&o.data.length>0&&e.jsx(ce,{administrators:o.data})]})},ue=()=>{const s=P(),{notify:a}=F(),{confirmModal:o,closeConfirmModal:d}=$(),{getInvitationsQuery:h,revokeInvitationQuery:v,resendInvitationQuery:g}=S(),{data:n}=h(),m=p.useMemo(()=>(n==null?void 0:n.data.results.sort((t,c)=>I(c.creation_time).diff(I(t.creation_time))))??[],[n]),{mutateAsync:u}=v,{mutateAsync:i}=g,b=async t=>{try{await u({id:t.id}),a.success({message:`${t.name}â€™${t.name.endsWith("s")?"":"s"} invitation has been revoked`,title:"You revoked an administrator invite"})}catch(c){s(c)}finally{d()}},f=t=>{o({title:`Revoke invitation for ${t.name}`,body:`This action will prevent ${t.name} from joining your Landscape organisation.`,buttons:[e.jsx(l.Button,{appearance:"negative",onClick:()=>b(t),children:"Revoke invitation"},"revoke")]})},y=async t=>{try{await i({id:t.id}),a.success({message:`${t.name} will receive a new invitation email`,title:"You resent an administrator invite"})}catch(c){s(c)}finally{d()}},x=t=>{o({title:`Resend invitation for ${t.name}`,body:`${t.name} will receive a new invitation email`,buttons:[e.jsx(l.Button,{appearance:"positive",onClick:()=>y(t),children:"Resend invitation"},"resend")]})},j=p.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"email",Header:"Email"},{accessor:"creation_time",Header:"Invited",Cell:({row:t})=>I(t.original.creation_time).format(w)},{accessor:"expiration_time",Header:"Expires",Cell:({row:t})=>I(t.original.creation_time).add(14,"days").format(w)},{accessor:"actions",Cell:({row:t})=>e.jsxs("div",{className:"u-align-text--right",children:[e.jsx(l.Button,{dense:!0,small:!0,className:"u-no-margin--bottom",onClick:()=>f(t.original),children:"Revoke"}),e.jsx(l.Button,{dense:!0,small:!0,className:"u-no-margin--bottom",onClick:()=>x(t.original),children:"Resend"})]})}],[m]),r=t=>{const c={};return t.column.id==="name"?c.role="rowheader":t.column.id==="email"?c["aria-label"]="Email":t.column.id==="creation_time"?c["aria-label"]="Invited":t.column.id==="expiration_time"?c["aria-label"]="Expires":t.column.id==="actions"&&(c["aria-label"]="Actions"),c};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-text--muted p-text--small",children:"Unclaimed invitations expire after 14 days."}),e.jsx(l.ModularTable,{columns:j,data:m,getCellProps:r,emptyMsg:"You have no unclaimed invitations."})]})},he="_tabPanel_1n8p7_1",pe={tabPanel:he},ve=[{label:"Administrators",id:"tab-link-administrators"},{label:"Invites",id:"tab-link-invites"}],be=()=>{const[s,a]=p.useState("tab-link-administrators");return e.jsxs(e.Fragment,{children:[e.jsx(l.Tabs,{listClassName:"u-no-margin--bottom",links:ve.map(({label:o,id:d})=>({label:o,id:d,role:"tab",active:d===s,onClick:()=>a(d)}))}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":s,className:pe.tabPanel,children:e.jsxs(p.Suspense,{fallback:e.jsx(k,{}),children:[s==="tab-link-administrators"&&e.jsx(me,{}),s==="tab-link-invites"&&e.jsx(ue,{})]})})]})},ge=p.lazy(()=>L(()=>import("./index-CX0H2nLM.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]))),fe=()=>{const{setSidePanelContent:s}=N(),a=()=>{s("Invite administrator",e.jsx(p.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(ge,{})}))};return e.jsxs(Y,{children:[e.jsx(U,{title:"Administrators",actions:[e.jsx(l.Button,{type:"button",onClick:a,children:"Invite administrator"},"invite-administrator")]}),e.jsx(G,{children:e.jsx(be,{})})]})},ye=fe,Me=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"}));export{Me as i,S as u};
