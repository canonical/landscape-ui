const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C83iuTAQ.js","assets/index-2fzpjuii.js","assets/index-DBjrXwEZ.css","assets/SidePanelFormButtons-DAl7F5tV.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/AssociationBlock-DSKjNBq_.js","assets/MultiSelectField-zcRsQbOM.js","assets/MultiSelectField-GyNA33om.css","assets/useInstances-DeMDoX3c.js","assets/AssociationBlock-DQBJa-xL.css","assets/useAPTSources-70Lpy5Gl.js","assets/useRoles-Dwt5A3Uj.js","assets/constants-CPcGGlxq.js","assets/constants-DhXkDRlN.css","assets/tests-DFnZqbNV.js","assets/index-BimGfo9_.css"])))=>i.map(i=>d[i]);
import{f as C,i as F,e as S,g as y,h as A,r as p,y as M,z as E,l as x,j as e,m as c,a1 as w,o as f,_ as j,c as L,N as O,ah as Q,E as B}from"./index-2fzpjuii.js";import{P as N,a as T,b as $}from"./PageMain-B0lz2oOC.js";import"./constants-CPcGGlxq.js";import{u as k}from"./useRoles-Dwt5A3Uj.js";import{H}from"./HeaderWithSearch-BIg5d4wD.js";function P(){const s=C(),t=F(),n=S(),r=(o={},i={})=>A({queryKey:["repositoryProfiles",o],queryFn:async()=>t.get("repositoryprofiles",{params:o}),...i}),a=y({mutationFn:async o=>t.post("repositoryprofiles",o),onSuccess:async()=>s.invalidateQueries({queryKey:["repositoryProfiles"]})}),l=y({mutationFn:async({name:o,...i})=>t.put(`repositoryprofiles/${o}`,i),onSuccess:async()=>s.invalidateQueries({queryKey:["repositoryProfiles"]})}),u=y({mutationKey:["repositoryProfiles"],mutationFn:async o=>n.get("RemoveRepositoryProfile",{params:o}),onSuccess:async()=>s.invalidateQueries({queryKey:["repositoryProfiles"]})});return{getRepositoryProfilesQuery:r,createRepositoryProfileQuery:a,editRepositoryProfileQuery:l,removeRepositoryProfileQuery:u}}const q="_toggleButton_bnzrt_1",D="_menu_bnzrt_6",h={toggleButton:q,menu:D},I=p.lazy(async()=>j(()=>import("./index-C83iuTAQ.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),z=({profile:s})=>{const[t,n]=p.useState(!1),r=M(),{notify:a}=E(),{setSidePanelContent:l}=x(),{removeRepositoryProfileQuery:u}=P(),{mutateAsync:o,isPending:i}=u,d=()=>{l(`Edit ${s.title}`,e.jsx(p.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(I,{action:"edit",profile:s})}))},_=()=>{n(!0)},g=()=>{n(!1)},b=async()=>{try{await o({name:s.name}),g(),a.success({message:`Repository profile "${s.title}" removed successfully`,title:"Repository profile removed"})}catch(v){r(v)}},R=[{children:e.jsxs(e.Fragment,{children:[e.jsx(c.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),"aria-label":`Edit "${s.title}" profile`,hasIcon:!0,onClick:d},{children:e.jsxs(e.Fragment,{children:[e.jsx(c.Icon,{name:c.ICONS.delete}),e.jsx("span",{children:"Remove"})]}),"aria-label":`Remove "${s.title}" repository profile`,hasIcon:!0,onClick:_}];return e.jsxs(e.Fragment,{children:[e.jsx(c.ContextualMenu,{position:"left",className:h.menu,toggleClassName:h.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(c.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${s.title} profile actions`},links:R}),e.jsx(w,{isOpen:t,confirmationText:`remove ${s.name}`,title:"Remove repository profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:i,confirmButtonLoading:i,onConfirm:b,close:g,children:e.jsxs("p",{children:['This will remove "',s.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},G=({column:s})=>{const t={};return s.id==="title"?t.role="rowheader":s.id==="description"?t["aria-label"]="Description":s.id==="access_group"?t["aria-label"]="Access group":s.id==="id"&&(t["aria-label"]="Actions"),t},K="_accessGroup_1qgn5_1",V="_description_1qgn5_5",W="_actions_1qgn5_9",m={accessGroup:K,description:V,actions:W},Y=({repositoryProfiles:s})=>{const{search:t}=L(),{getAccessGroupQuery:n}=k(),{data:r}=n(),a=((r==null?void 0:r.data)??[]).map(({name:o,title:i})=>({label:i,value:o})),l=p.useMemo(()=>t?s.filter(o=>o.title.toLowerCase().includes(t.toLowerCase())):s,[s,t]),u=p.useMemo(()=>[{accessor:"title",Header:"Title"},{accessor:"description",Header:"Description",className:m.description,Cell:({row:o})=>o.original.description||e.jsx(O,{})},{accessor:"access_group",Header:"Access group",className:m.accessGroup,Cell:({row:{original:o}})=>{var i;return((i=a.find(({value:d})=>o.access_group===d))==null?void 0:i.label)??o.access_group}},{accessor:"id",className:m.actions,Header:"Actions",Cell:({row:o})=>e.jsx(z,{profile:o.original})}],[l,a]);return e.jsx(c.ModularTable,{columns:u,data:l,getCellProps:G,emptyMsg:`No repository profiles found with the search "${t}"`})},J=()=>e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsx(Q,{filtersToDisplay:["search"]})]}),U=p.lazy(()=>j(()=>import("./index-C83iuTAQ.js").then(s=>s.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(s=>({default:s.RepositoryProfileForm}))),X=()=>{const{setSidePanelContent:s}=x(),{getRepositoryProfilesQuery:t}=P(),{data:n,isLoading:r}=t(),a=(n==null?void 0:n.data.results)??[],l=()=>{s("Add repository profile",e.jsx(p.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(U,{action:"add"})}))};return e.jsxs(N,{children:[e.jsx(T,{title:"Repository profiles",actions:[e.jsx(c.Button,{appearance:"positive",onClick:l,type:"button",children:"Add repository profile"},"new-key-button")]}),e.jsxs($,{children:[r&&e.jsx(f,{}),!r&&a.length===0&&e.jsx(B,{title:"No repository profiles found",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You havenâ€™t added any repository profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/manage-repositories-web-portal",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage repositories in Landscape"})]}),cta:[e.jsx(c.Button,{appearance:"positive",onClick:l,type:"button",children:"Add repository profile"},"table-add-new-profile")]}),!r&&a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(J,{}),e.jsx(Y,{repositoryProfiles:a})]})]})]})},re=Object.freeze(Object.defineProperty({__proto__:null,default:X},Symbol.toStringTag,{value:"Module"}));export{Y as R,J as a,re as i,P as u};
