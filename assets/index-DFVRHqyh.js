import{r as u,f as I,j as e,g as i,p as S,q as A,a as k,s as z,X as T,L as $,E as F,I as r}from"./index-BE2TKmZA.js";import{a as N}from"./EmployeeList-q8gFzPzF.js";import"./usePageParams-CBLmn4Hi.js";import{g as x}from"./helpers-DnnXHeCa.js";import"./InstancesPageActions-DVlBZlcd.js";import{u as w}from"./index-_bFQLl8i.js";import{u as P}from"./useInstances-YTzb5XXp.js";import{N as E}from"./NoData-fdNs2T84.js";import"./TruncatedCell-BEE1raqP.js";import"./helpers-S9Qf8hll.js";import"./TablePagination-BkgYVqcD.js";import"./TablePaginationBase-ClNbvr7T.js";import"./StatusFilter-5MEPEMXj.js";import"./TableFilter-CHmfeGzi.js";import"./TableFilterChips-DLsUHLGy.js";import"./useFetchOld-BmrVnip5.js";const B=({employee:t})=>{const[a,s]=u.useState(!1),{closeSidePanel:o}=I(),c=()=>{s(!0)},d=u.useCallback(()=>{s(!1),o()},[]);return e.jsxs("div",{children:[e.jsxs(i.Button,{hasIcon:!0,onClick:c,children:[e.jsx(i.Icon,{name:t.is_active?"pause":"play"}),e.jsx("span",{children:t.is_active?"Deactivate":"Activate"})]}),a&&e.jsx(N,{employee:t,handleClose:d})]})},L="_toggleButton_gtdm0_1",M="_menu_gtdm0_6",g={toggleButton:L,menu:M},R=({instance:t})=>{const a=S(),{notify:s}=A(),o=k(),{openActivityDetails:c}=w(),{removeInstancesQuery:d,sanitizeInstanceQuery:j}=P(),{mutateAsync:v,isPending:b}=d,{mutateAsync:y,isPending:C}=j,n=z({initialValues:{confirmationText:"",selectedAction:""},onSubmit:async h=>{if(h.selectedAction==="sanitize")try{const{data:l}=await y({computer_id:t.id,computer_title:t.title});s.success({title:`You have successfully initiated Sanitization for ${t.title}`,message:`Sanitizing for ${t.title} has been queued in Activities. The data will be permanently irrecoverable once complete.`,actions:[{label:"View details",onClick:()=>{c(l)}}]}),n.resetForm()}catch(l){a(l)}else if(h.selectedAction==="remove")try{await v({computer_ids:[t.id]}),s.success({title:`You have successfully removed ${t.title}`,message:`${t.title} has been removed from Landscape. To manage it again, you will need to re-register it in Landscape.`}),n.resetForm()}catch(l){a(l)}}}),p=()=>{n.resetForm()},_=[{children:e.jsxs(e.Fragment,{children:[e.jsx(i.Icon,{name:"machines"}),e.jsx("span",{children:"View details"})]}),"aria-label":`View ${t.title} instance details`,hasIcon:!0,onClick:async()=>o(`${T}instances/${t.id}`)},{children:e.jsxs(e.Fragment,{children:[e.jsx(i.Icon,{name:"tidy"}),e.jsx("span",{children:"Sanitize"})]}),"aria-label":`Sanitize ${t.title} instance`,hasIcon:!0,onClick:async()=>n.setFieldValue("selectedAction","sanitize")},{children:e.jsxs(e.Fragment,{children:[e.jsx(i.Icon,{name:i.ICONS.delete}),e.jsx("span",{children:"Remove from Landscape"})]}),"aria-label":"Remove from Landscape",hasIcon:!0,onClick:async()=>n.setFieldValue("selectedAction","remove")}];return e.jsxs(e.Fragment,{children:[e.jsx(i.ContextualMenu,{position:"left",className:g.menu,toggleClassName:g.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(i.Icon,{name:"contextual-menu","aria-hidden":!0}),toggleProps:{"aria-label":`${t.title} profile actions`},links:_}),n.values.selectedAction==="remove"&&e.jsx(i.ConfirmationModal,{title:`Remove ${t.title} instance`,confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:b||n.values.confirmationText!==`remove ${t.title}`,onConfirm:()=>{n.handleSubmit()},close:p,children:e.jsxs(i.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:[e.jsxs("p",{children:["Removing this ",t.title," will delete all associated data and free up one license slot for another computer to be registered."]}),e.jsxs("p",{children:["Type ",e.jsxs("b",{children:["remove ",t.title]})," to confirm."]}),e.jsx(i.Input,{type:"text",...n.getFieldProps("confirmationText")})]})}),n.values.selectedAction==="sanitize"&&e.jsx(i.ConfirmationModal,{title:`Sanitize "${t.title}" instance`,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:C||n.values.confirmationText!==`sanitize ${t.title}`,onConfirm:()=>{n.handleSubmit()},close:p,children:e.jsxs(i.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:[e.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",t.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]}),e.jsxs("p",{children:["Type ",e.jsxs("b",{children:["sanitize ",t.title]})," to confirm."]}),e.jsx(i.Input,{type:"text",...n.getFieldProps("confirmationText")})]})})]})},D="_container_a5d6r_1",V="_actions_a5d6r_7",H="_link_a5d6r_15",m={container:D,actions:V,link:H},O=()=>({column:t})=>{const a={};return t.id==="name"?a.role="rowheader":t.id==="status"?a["aria-label"]="Status":t.id==="recovery_key"?a["aria-label"]="Recovery key":t.id==="actions"&&(a["aria-label"]="Actions"),a},f={title:"No instances found",body:"There are no instances associated with this employee"},Y=({instances:t})=>{const a=u.useMemo(()=>[{accessor:"name",Header:"name",Cell:({row:s})=>e.jsx($,{className:m.link,to:s.original.parent?`/instances/${s.original.parent.id}/${s.original.id}`:`/instances/${s.original.id}`,children:s.original.title})},{accessor:"status",Header:"status",Cell:({row:{original:s}})=>{const{label:o}=x(s);return o},getCellIcon:({row:{original:s}})=>{const{icon:o}=x(s);return o}},{accessor:"recovery_key",Header:"recovery key",Cell:()=>"****************"},{accessor:"actions",className:m.actions,Header:"actions",Cell:({row:{original:s}})=>e.jsx(R,{instance:s})}],[t]);return e.jsxs("div",{className:m.container,children:[e.jsx("h4",{className:"p-heading--5",children:"Instances associated"}),t&&t.length>0?e.jsx(i.ModularTable,{data:t,columns:a,getCellProps:O()}):e.jsx(F,{title:f.title,body:f.body})]})},le=({employee:t})=>{var a,s;return e.jsxs(e.Fragment,{children:[e.jsx(B,{employee:t}),e.jsxs(i.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(i.Col,{size:6,children:e.jsx(r,{label:"name",value:t.name})}),e.jsx(i.Col,{size:6,children:e.jsx(r,{label:"email",value:t.email})})]}),e.jsxs(i.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(i.Col,{size:6,children:e.jsx(r,{label:"employee groups",value:((s=(a=t.groups)==null?void 0:a.map(o=>o.name))==null?void 0:s.join(", "))||"N/A",type:"truncated"})}),e.jsx(i.Col,{size:6,children:e.jsx(r,{label:"status",value:t.is_active?"active":"inactive"})})]}),e.jsx(r,{label:"autoinstall file",value:t.autoinstall_file?`${t.autoinstall_file.filename}, v${t.autoinstall_file.version}`:e.jsx(E,{})}),e.jsx(Y,{instances:t.computers})]})};export{le as default};
