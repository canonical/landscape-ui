import{u as S}from"./useAddAutoinstallFile-CnzHidHy.js";import{b as T,e as E,f as D,i as p,p as H,q as v,n as j,s as q,j as e,d as l,t as C,a0 as z,v as A,B as I,I as x,A as _,D as y,a4 as L,au as Y,ak as Q,N as W,aF as K,av as X,h as J,E as Z,aB as ee,a2 as te}from"./index-CNysL-N9.js";import{V as se,r as N,D as ae,A as w,f as ne,a as ie,u as le,h as oe,i as P,C as re,b as k,g as ce}from"./AutoinstallFileVersionHistory-CI7mysYb.js";import"./index-DFOXV98U.js";import{H as ue}from"./HeaderWithSearch-CvedKTiw.js";import{g as de,E as me}from"./helpers-DFnjhFzB.js";import{u as pe}from"./useGetEmployeeGroups-D0ZQJ3Bu.js";import{u as fe}from"./useExpandableRow-DxiOSS1-.js";import{C as he}from"./CodeEditor-B8ypm5kk.js";import{S as xe}from"./SidePanelFormButtons-M1anpLEA.js";import"./SidePanelTablePagination-CiKesZiF.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";const Ae=()=>{const t=T(),s=E(),{isPending:a,mutateAsync:n}=D({mutationFn:async({id:o})=>t.delete(`autoinstall/${o}`),onSuccess:async()=>s.invalidateQueries({queryKey:["autoinstallFiles"]})});return{deleteAutoinstallFile:n,isAutoinstallFileUpdating:a}},$=()=>{const t=T(),s=E(),{isPending:a,mutateAsync:n}=D({mutationFn:async({id:o,...r})=>t.patch(`autoinstall/${o}`,r),onSuccess:async()=>{await s.invalidateQueries({queryKey:["autoinstallFiles"]})}});return{isAutoinstallFileUpdating:a,updateAutoinstallFile:n}},je="_form_1dly8_1",ge="_inputContainer_1dly8_7",be="_input_1dly8_7",_e="_inputDescription_1dly8_16",b={form:je,inputContainer:ge,input:be,inputDescription:_e},O=({buttonText:t,description:s,initialFile:a=ae,notification:n,onSubmit:o})=>{const r=p.useRef(null),i=H(),{notify:u}=v(),{closeSidePanel:d}=j(),c=q({initialValues:{...a,filename:N(a.filename)},validationSchema:se,onSubmit:async m=>{const f=`${m.filename}${w}`;try{await o({...m,filename:f}),d(),u.success({message:`${f} ${n.message}`,title:`${n.title} ${f}`})}catch(g){i(g)}}}),h=async({target:{files:m}})=>{if(!m)return;const[f]=m,g=c.setFieldValue("contents",await f.text());if(c.values.filename){await g;return}await Promise.all([c.setFieldValue("filename",N(f.name)),g])},F=async m=>{await c.setFieldValue("contents",m)},U=()=>{r.current?.click()};return e.jsxs(l.Form,{className:b.form,noValidate:!0,onSubmit:c.handleSubmit,children:[e.jsx("span",{children:s}),e.jsxs("div",{className:b.inputContainer,children:[e.jsx(l.Input,{wrapperClassName:b.input,type:"text",label:"File name",...c.getFieldProps("filename"),error:C(c,"filename"),disabled:!!a.filename,required:!0}),e.jsx("span",{className:b.inputDescription,children:w})]}),e.jsx("input",{ref:r,className:"u-hide",type:"file",accept:ne.map(m=>`.${m}`).join(","),onChange:h}),e.jsx(he,{label:"Code",value:c.values.contents,onChange:F,error:C(c,"contents"),required:!0,language:ie,headerContent:e.jsxs(l.Button,{className:"u-no-margin--bottom",appearance:"base",hasIcon:!0,onClick:U,type:"button",children:[e.jsx(l.Icon,{name:"upload"}),e.jsx("span",{children:"Populate from file"})]})}),e.jsx(xe,{submitButtonDisabled:c.isSubmitting,submitButtonText:t})]})},ye="_container_pnq0d_1",Fe={container:ye},R=({openAddForm:t})=>{const{employeeGroups:s}=pe({},{listenToUrlParams:!1}),a=p.useMemo(()=>de(s),[s]);return e.jsxs(e.Fragment,{children:[e.jsx(ue,{actions:e.jsxs("div",{className:Fe.container,children:[e.jsx(me,{options:a}),e.jsxs(l.Button,{type:"button",className:"u-no-margin",hasIcon:!0,onClick:t,children:[e.jsx(l.Icon,{name:"plus"}),e.jsx("span",{children:"Add new"})]})]})}),e.jsx(z,{filtersToDisplay:["search","employeeGroups"],employeeGroupOptions:a})]})},ve={message:"has been edited and all the changes made have been saved successfully.",title:"You have successfully saved changes for"},Ce=({autoinstallFile:t})=>{const{autoinstallFile:s,isAutoinstallFileLoading:a}=le({id:t.id,with_metadata:!0}),{updateAutoinstallFile:n}=$();return a||!s?e.jsx(A,{}):e.jsxs(e.Fragment,{children:[s.metadata.max_versions<=s.version&&e.jsx(l.Notification,{inline:!0,title:"Edit history limit reached:",severity:"caution",children:e.jsxs("p",{children:["You've reached the limit of"," ",s.metadata.max_versions," saved"," ",I(s.metadata.max_versions,"edit"),". To save your new change, the oldest version will be automatically removed, keeping the most recent"," ",s.metadata.max_versions," ",I(s.metadata.max_versions,"version")," ","in history."]})}),e.jsx(O,{buttonText:"Save changes",description:`The duplicated ${s.filename} will inherit the employee group assignments of the original file.`,initialFile:s,notification:ve,onSubmit:async({contents:o})=>{await n({id:s.id,contents:o})}})]})},M=({autoinstallFile:t,close:s})=>{const{notify:a}=v(),{closeSidePanel:n}=j(),{deleteAutoinstallFile:o}=Ae(),r=async()=>{await o({id:t.id}),s(),n(),a.success({message:`The ${t.filename} autoinstall file has been permanently removed. All employee groups associated with this file are now using the default autoinstall file.`,title:`You have successfully removed ${t.filename} autoinstall file.`})};return e.jsx(l.ConfirmationModal,{close:s,confirmButtonAppearance:"negative",confirmButtonLabel:"Remove",onConfirm:r,title:`Remove ${t.filename}, autoinstall file`,children:e.jsxs("p",{children:["You are about to remove ",t.filename,", an autoinstall file. This action is irreversible. All employee groups this file is associated with, will have the default autoinstall file associated instead."]})})},Ie=({file:t})=>e.jsxs(e.Fragment,{children:[e.jsxs(l.Row,{className:"u-no-padding",children:[e.jsx(l.Col,{size:6,children:e.jsx(x,{label:"Name",value:t.filename})}),e.jsx(l.Col,{size:6,children:e.jsx(x,{label:"Version",value:t.version})})]}),e.jsxs(l.Row,{className:"u-no-padding",children:[e.jsx(l.Col,{size:6,children:e.jsx(x,{label:"Last modified",value:_(t.last_modified_at).format(y)})}),e.jsx(l.Col,{size:6,children:e.jsx(x,{label:"Date created",value:_(t.created_at).format(y)})})]}),e.jsx(x,{label:"Employee groups associated",value:t.groups.map(s=>s.name).join(", ")})]}),Ne=[{id:"info",label:"Info"},{id:"version-history",label:"Version history"}],we=({file:t,viewVersionHistory:s,initialTabId:a="info"})=>{const[n,o]=p.useState(a),r=Ne.map(({label:i,id:u})=>({label:i,active:u===n,role:"tab",onClick:()=>{o(u)}}));return e.jsxs(e.Fragment,{children:[e.jsx(l.Tabs,{links:r}),n==="info"&&e.jsx(Ie,{file:t}),n==="version-history"&&e.jsx(oe,{file:t,viewVersionHistory:s})]})},Se=({autoinstallFile:t,initialTabId:s})=>{const{value:a,setTrue:n,setFalse:o}=L(),{openAutoinstallFileDetails:r,openAutoinstallFileEditForm:i,setAutoinstallFileAsDefault:u}=G(t),d=()=>{r("version-history")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(l.Button,{type:"button",className:"p-segmented-control__button",onClick:i,hasIcon:!0,children:[e.jsx(l.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(l.Button,{type:"button",className:"p-segmented-control__button",onClick:u,disabled:t.is_default,hasIcon:!0,children:[e.jsx(l.Icon,{name:"starred"}),e.jsx("span",{children:"Set as default"})]}),e.jsxs(l.Button,{type:"button",className:"p-segmented-control__button",onClick:n,disabled:t.is_default,hasIcon:!0,children:[e.jsx(l.Icon,{name:l.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]})}),e.jsx(we,{initialTabId:s,file:t,viewVersionHistory:d}),a&&e.jsx(M,{autoinstallFile:t,close:o})]})},B=()=>{const{setSidePanelContent:t}=j();return(s,a)=>{t(e.jsx(P,{file:s}),e.jsx(p.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(Se,{initialTabId:a,autoinstallFile:s})}))}},G=t=>{const{notify:s}=v(),{closeSidePanel:a,setSidePanelContent:n}=j(),{updateAutoinstallFile:o}=$(),r=B();return{openAutoinstallFileDetails:i=>{r(t,i)},openAutoinstallFileEditForm:()=>{n(e.jsx(P,{file:t,title:"Edit"}),e.jsx(p.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(Ce,{autoinstallFile:t})}))},setAutoinstallFileAsDefault:async()=>{await o({id:t.id,is_default:!0}),a(),s.success({message:"Employee groups without an autoinstall file assigned will inherit this default file.",title:`You have successfully set ${t.filename} as the default autoinstall file`})}}},Te=({autoinstallFile:t})=>{const{value:s,setTrue:a,setFalse:n}=L(),{openAutoinstallFileDetails:o,openAutoinstallFileEditForm:r,setAutoinstallFileAsDefault:i}=G(t),u=()=>{o()},d=[{icon:"show",label:"View details","aria-label":`View ${t.filename} details`,onClick:u},{icon:"edit",label:"Edit","aria-label":`Edit ${t.filename}`,onClick:r},{icon:"starred",label:"Set as default","aria-label":`Set ${t.filename} as default`,onClick:i,disabled:t.is_default}],c=[{icon:"delete",label:"Remove","aria-label":`Remove ${t.filename}`,onClick:a,disabled:t.is_default}];return e.jsxs(e.Fragment,{children:[e.jsx(Y,{toggleAriaLabel:`${t.filename} actions`,actions:d,destructiveActions:c}),s&&e.jsx(M,{autoinstallFile:t,close:n})]})},Ee="_container_1wllp_1",De={container:Ee},Le=t=>({column:s,row:{index:a}})=>{const n={};switch(s.id){case"filename":n.role="rowheader";break;case"groups":n["aria-label"]="employee groups",t===a&&(n.className="expandedCell");break;case"last_modified_at":n["aria-label"]="last modified at";break;case"created_at":n["aria-label"]="created at";break}return n},Pe=t=>({index:s})=>{const a={};return t===s&&(a.className="expandedRow"),a},V=({autoinstallFiles:t})=>{const{expandedRowIndex:s,getTableRowsRef:a,handleExpand:n}=fe(),o=B(),r=p.useMemo(()=>[{accessor:"filename",Header:"Name",Cell:({row:{original:i}})=>e.jsxs("div",{className:De.container,children:[e.jsx(l.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top",onClick:()=>{o(i)},children:`${i.filename}, v${i.version}`}),i.is_default&&e.jsx(re,{value:"Default"})]})},{accessor:"groups",Header:"Employee Groups Associated",Cell:({row:{original:{groups:i},index:u}})=>{if(!i||i.length===0)return e.jsx(W,{});const[d,...c]=i.map(h=>h.name);return e.jsx(K,{content:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:d}),c.map((h,F)=>e.jsxs("span",{children:[", ",h]},F))]}),isExpanded:u==s,onExpand:()=>{n(u)},showCount:!0})}},{accessor:"last_modified_at",Header:"Last modified",Cell:({row:{original:{last_modified_at:i}}})=>e.jsx("div",{className:"font-monospace",children:_(i).format(y)})},{accessor:"created_at",Header:"Date created",Cell:({row:{original:{created_at:i}}})=>e.jsx("div",{className:"font-monospace",children:_(i).format(y)})},{...Q,Cell:({row:{original:i}})=>e.jsx(Te,{autoinstallFile:i})}],[s]);return e.jsx("div",{ref:a,children:e.jsx(X,{columns:r,data:t,emptyMsg:"No autoinstall files found according to your search parameters.",getCellProps:Le(s),getRowProps:Pe(s)})})},ke=Object.freeze(Object.defineProperty({__proto__:null,AutoinstallFileForm:O,AutoinstallFilesHeader:R,AutoinstallFilesList:V,getAutoinstallFileOptions:ce,useAddAutoinstallFile:S,useGetAutoinstallFiles:k},Symbol.toStringTag,{value:"Module"})),$e={message:"can now be assigned to employee groups.",title:"You have successfully added"},Oe=p.lazy(async()=>te(()=>Promise.resolve().then(()=>ke),void 0).then(t=>({default:t.AutoinstallFileForm}))),Ke=()=>{const{currentPage:t,employeeGroups:s,pageSize:a,search:n}=J(),{setSidePanelContent:o}=j(),{addAutoinstallFile:r}=S(),{autoinstallFiles:i,autoinstallFilesCount:u,isAutoinstallFilesLoading:d}=k({limit:a,offset:(t-1)*a,with_groups:!0,employee_group_ids:s.length>0?s.map(Number):void 0,search:n}),c=()=>{o("Add new autoinstall file",e.jsxs(p.Suspense,{fallback:e.jsx(A,{}),children:[e.jsx(Oe,{buttonText:"Add",description:"Add autoinstall file. It can be applied during the initial setup of associated instances.",notification:$e,onSubmit:r}),","]}))};return!i.length&&!n&&s.length===0&&!d?e.jsx(Z,{icon:"file",title:"No autoinstall files found",body:e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any autoinstall files yet."}),cta:[e.jsx(l.Button,{appearance:"positive",onClick:c,className:"u-no-margin--right",children:"Add autoinstall file"},"add-autoinstall-file")]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{openAddForm:c}),d?e.jsx(A,{}):e.jsx(V,{autoinstallFiles:i}),e.jsx(ee,{currentItemCount:i.length,totalItems:u})]})};export{Ke as default};
