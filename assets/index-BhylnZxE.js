const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CjmOtSW8.js","assets/index-AQFe3UL3.js","assets/index-D9DLLBWL.css","assets/SidePanelFormButtons-BGGfnbip.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/useRoles-BuxefHIC.js"])))=>i.map(i=>d[i]);
import{B as f,F as h,c as j,J as S,j as e,m as i,ag as k,L,y as T,r as d,N as w,l as b,o as g,E as F,_ as C}from"./index-AQFe3UL3.js";import{P as G,a as E,b as I}from"./PageMain-DSc7t8nW.js";import{u as _}from"./useRoles-BuxefHIC.js";import{G as B}from"./GroupFilter-DbuxPZe4.js";import{F as D}from"./InstancesPageActions-BlF0wax9.js";import{u as $}from"./useInstances-D7RFoCga.js";const ce={title:"",parent:""},ie=f().shape({title:h().required("This field is required"),parent:h().required("This field is required")}),H="_container_vxbz8_1",M="_searchContainer_vxbz8_11",x={container:H,searchContainer:M},R=()=>{const{search:a,setPageParams:n}=j(),s=()=>{n({search:c.values.searchText})},o=()=>{n({search:""})},c=S({initialValues:{searchText:a},enableReinitialize:!0,validationSchema:f().shape({search:h()}),onSubmit:s}),u=D.groupBy.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:x.container,children:[e.jsx("div",{className:x.searchContainer,children:e.jsx(i.Form,{onSubmit:c.handleSubmit,noValidate:!0,children:e.jsx(i.SearchBox,{autocomplete:"off",externallyControlled:!0,value:c.values.searchText,onChange:async p=>await c.setFieldValue("searchText",p),placeholder:"Search",onSearch:s,onClear:o})})}),e.jsx(B,{options:u},"group-by-filter")]}),e.jsx(k,{filtersToDisplay:["search"]})]})},V="_link_1wvsk_1",O={link:V},z=({accessGroup:a})=>{const{getInstancesQuery:n}=$(),{data:s,isPending:o}=n({query:`access-group: ${a.name}`,root_only:!1,with_alerts:!0,with_upgrades:!0,limit:1});return s!=null&&s.data&&a.instancesCount!==s.data.count&&(a.instancesCount=s.data.count||0),o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"u-off-screen",children:"Loading..."}),e.jsx(i.Spinner,{"aria-hidden":!0})]}):s!=null&&s.data.count?e.jsx(L,{className:O.link,to:`/instances?accessGroups=${a.name}`,children:s.data.count}):e.jsx(e.Fragment,{children:"0"})},q="_actions_1hh74_1",J={actions:q},U=a=>{const n={};switch(a.column.id){case"title":n.role="rowheader";break;case"name":n["aria-label"]="Name";break;case"instancesCount":n["aria-label"]="Instances count";break;case"parent":n["aria-label"]="Parent";break;case"id":n["aria-label"]="Actions";break}return n},A=(a,n)=>{const s=n.find(o=>o.name===a);return s&&s.parent?[s,...A(s.parent,n)]:s?[s]:[]},y=(a,n)=>n.filter(s=>s.parent===a).map(s=>({...s,instancesCount:0,subRows:y(s.name,n)})),Y=({accessGroups:a})=>{const{groupBy:n,search:s}=j(),{removeAccessGroupQuery:o}=_(),c=T(),{mutateAsync:u,isPending:p}=o,v=d.useMemo(()=>{const t=s?a.filter(r=>r.name.toLowerCase().includes(s.toLowerCase())||r.title.toLowerCase().includes(s.toLowerCase())):a;if(n!=="parent")return t.map(r=>({...r,instancesCount:0}));const l=Array.from(new Set([...t,...t.flatMap(r=>A(r.parent||"",a))])),m=new Set(l.filter(r=>r.parent).map(r=>r.name));return l.filter(r=>!m.has(r.name)).map(r=>({...r,instancesCount:0,subRows:y(r.name,l)}))},[a,s,n]),N=async t=>{try{await u({name:t})}catch(l){c(l)}},P=d.useMemo(()=>[{accessor:"title",Header:"title",Cell:({row:t})=>e.jsx("div",{style:{paddingLeft:`${t.depth*1.25}rem`},children:e.jsx("span",{children:t.original.title})})},{accessor:"name",Header:"name"},{accessor:"instancesCount",Header:"affected instances",sortType:(t,l)=>t.original.instancesCount-l.original.instancesCount,Cell:({row:t})=>e.jsx(z,{accessGroup:t.original})},{accessor:"parent",Header:"parent",Cell:({row:{original:t}})=>{var m;return((m=a.find(r=>r.name===t.parent))==null?void 0:m.title)||e.jsx(w,{})}},{accessor:"id",className:J.actions,Cell:({row:t})=>t.original.name==="global"?null:e.jsx("div",{className:"divided-blocks",children:e.jsx("div",{className:"divided-blocks__item",children:e.jsx(i.ConfirmationButton,{className:"u-no-margin--bottom u-no-padding--left is-small has-icon",type:"button",appearance:"base","aria-label":`Remove ${t.original.name} access group`,confirmationModalProps:{title:`Deleting ${t.original.name} access group`,children:e.jsx("p",{children:"Are you sure?"}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:p,confirmButtonLoading:p,onConfirm:()=>N(t.original.name)},children:e.jsx(i.Tooltip,{position:"btm-center",message:"Delete",children:e.jsx(i.Icon,{name:i.ICONS.delete})})})})})}],[n,a]);return e.jsx(i.ModularTable,{columns:P,data:v,sortable:!0,getCellProps:U,emptyMsg:"No access groups found according to your search parameters."})},K=d.lazy(()=>C(()=>import("./index-CjmOtSW8.js").then(a=>a.i),__vite__mapDeps([0,1,2,3,4,5,6]))),Q=()=>{const{getAccessGroupQuery:a}=_(),{setSidePanelContent:n}=b(),{data:s,isPending:o}=a(),c=(s==null?void 0:s.data)||[],u=()=>{n("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(K,{})}))};return e.jsxs(e.Fragment,{children:[o&&e.jsx(g,{}),!o&&c.length===0&&e.jsx(F,{title:"No access groups found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any access groups yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/access-groups",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage access groups in Landscape"})]}),cta:[e.jsx(i.Button,{appearance:"positive",onClick:u,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),!o&&c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsx(Y,{accessGroups:c})]})]})},W="_header_116wp_1",X={header:W},Z=d.lazy(()=>C(()=>import("./index-CjmOtSW8.js").then(a=>a.a),__vite__mapDeps([0,1,2,3,4,5,6])).then(a=>({default:a.NewAccessGroupForm}))),ee=()=>{const{setSidePanelContent:a}=b(),n=()=>{a("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(Z,{})}))};return e.jsxs(G,{children:[e.jsx(E,{className:X.header,title:"Access groups",actions:[e.jsx(i.Button,{appearance:"positive",onClick:n,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),e.jsx(I,{children:e.jsx(Q,{})})]})},le=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{Q as A,ce as I,ie as V,le as i};
