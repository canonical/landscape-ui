import{h as _,e as C,f as L,g as N,z as P,q as I,r as M,j as s,N as x,d as m,c as y,I as j,o as U}from"./index-CSSscRtK.js";import{P as k,a as w,b as D}from"./PageMain-C_EL0_NR.js";import{d as K,s as g}from"./constants-B-aIeWz-.js";import"./moment-C5S46NFB.js";import{u as q}from"./EditUserForm-m7v0Sf0Z.js";import"./useFetchOld-Bg7OzTFV.js";import"./NoData-HQm8ZFJm.js";import"./index-kinc5XAu.js";import"./moment-C0lIsxcK.js";import"./TablePagination-Bk6IFP8F.js";import"./TablePagination.module-CgQ3jx4B.js";import"./usePageParams-DquXj6di.js";import"./TableFilterChips-D-0Xad7c.js";import"./SidePanelFormButtons.module-yv6Qz3cN.js";function v(){const i=_(),r=C(),n=(t={},o={})=>N({queryKey:["userDetails","getCredentials"],queryFn:()=>i.get("credentials",{params:t}),...o}),l=L({mutationKey:["userDetails","generate"],mutationFn:t=>i.post("credentials",t),onSuccess:()=>r.invalidateQueries({queryKey:["userDetails","getCredentials"]})});return{getUserApiCredentials:n,generateApiCredentials:l}}const B="_tableWrapper_1vlsl_1",E="_apiCredentials_1vlsl_10",f={"u-off-screen":"_u-off-screen_1vlsl_1",tableWrapper:B,apiCredentials:E},G=({user:i,credentials:r})=>{const n=P("(min-width: 620px)"),l=I(),{generateApiCredentials:t}=v(),{mutateAsync:o,isPending:d}=t,p=async a=>{try{await o({account:a})}catch(e){l(e)}},h=M.useMemo(()=>[{Header:"Label",accessor:"label"},{Header:"Value",accessor:"value",Cell:({value:a})=>a}],[i,r]);return i.accounts.map(a=>{const e=r.find(u=>u.account_name===a.name),b=[{label:"Name",value:e==null?void 0:e.account_name},{label:"Title",value:e==null?void 0:e.account_title},{label:"Identity",value:s.jsx("code",{children:i.identity})},{label:"Endpoint",value:s.jsx("code",{children:e==null?void 0:e.endpoint})},{label:"Access Key",value:e!=null&&e.access_key?s.jsx("code",{children:e.access_key}):x},{label:"Secret Key",value:e!=null&&e.secret_key?s.jsx("code",{children:e.secret_key}):x},{label:"Roles",value:a.roles.join(", ")}],c=e!=null&&e.secret_key||e!=null&&e.access_key?"Regenerate":"Generate";return s.jsx("div",{className:K.item,children:s.jsxs("div",{className:g.card,children:[s.jsxs("div",{className:g.header,children:[s.jsx("p",{className:g.title,children:a.title}),s.jsxs(m.ConfirmationButton,{className:y("u-no-margin--bottom",{"is-small":n}),type:"button",confirmationModalProps:{title:`${c} API credentials for ${a.title}`,children:s.jsxs("p",{children:[c==="Regenerate"?`${c.slice(0,-1)}ing your API credentials will make your previously used credentials obsolete and deauthenticate any clients using them. `:"","This action will create new credentials for integrating with the ",a.title," organisation"]}),confirmButtonLabel:`${c} API credentials`,confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:()=>p(a.name)},children:[c," API credentials"]})]}),s.jsx("div",{className:y(g.content,f.tableWrapper),children:n?s.jsx(m.ModularTable,{columns:h,data:b,emptyMsg:"No data available"}):b.map((u,A)=>s.jsxs(m.Row,{className:y("u-no-padding--left u-no-padding--right",f.apiCredentials),children:[s.jsx(m.Col,{size:2,small:2,children:s.jsx(j,{label:"",value:u.label})}),s.jsx(m.Col,{size:2,small:2,children:s.jsx(j,{label:"",value:u.value})})]},A))})]})},a.title)})},Z=()=>{var e;const{getUserDetails:i}=q(),{getUserApiCredentials:r}=v(),{data:n,isLoading:l}=i(),{data:t,isLoading:o}=r(),d=n==null?void 0:n.data,p=(e=t==null?void 0:t.data)==null?void 0:e.credentials,h=d&&p,a=l||o;return s.jsxs(k,{children:[s.jsx(w,{title:"API credentials"}),s.jsxs(D,{children:[a&&s.jsx(U,{}),h&&s.jsx(G,{user:d,credentials:p})]})]})};export{Z as default};
