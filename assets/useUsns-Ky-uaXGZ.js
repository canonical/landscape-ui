const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dj9A88bp.js","assets/index-DYykpNVa.js","assets/index-hef1aQzf.css","assets/DeliveryBlock-C-KDxUEZ.js","assets/formikErrors-Bw8iTXYS.js","assets/RadioGroup-DD61dFf3.js","assets/RadioGroup-WBbAFTwm.css","assets/RandomizationBlock-DjoHppMG.js","assets/helpers-DblkVUdf.js","assets/SidePanelFormButtons-Aj5ThB2m.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/InfoItem-DMBAN7ig.js","assets/NoData-CT6SeJUX.js","assets/Truncated-DtD6hAHP.js","assets/Truncated-uqJp6ujM.css","assets/InfoItem-D8nPzgUA.css","assets/index-C2TKYmcI.js","assets/ResponsiveTable-C-8YbfBJ.js","assets/ResponsiveTable-Czda4kFo.css","assets/TablePagination-CIA4CRba.js","assets/TableFilterChips-DLH4XQ-H.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-DZURD2KR.css","assets/useFetchOld-BGD2hIpr.js","assets/PageParamFilter-LH49uHXA.js","assets/TableFilter-C7yTBfOe.js","assets/TableFilter-B85Stwni.css","assets/index-DzMlcK9Q.css","assets/constants-CXofZZ4i.js","assets/InstancesPageActions-nbDXpXLr.js","assets/ListTitle-anvzyHx6.js","assets/ListTitle-CxCHkD9o.css","assets/StaticLink-BX9qJBBO.js","assets/TruncatedCell-DQQZxgbr.js","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-CGDZ27WS.js","assets/index-Cbj0Sz5k.js","assets/TextConfirmationModal-DuGXYB1S.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/InfoGrid-CVtcW3Y8.js","assets/InfoGrid-D3QqOHFx.css","assets/InstancesPageActions-ChZMRYY_.css","assets/index-2OT7UQXO.js","assets/index-FOzIlaji.js","assets/downshift.esm-CVSNbv_O.js","assets/index-BvQeuVyB.css"])))=>i.map(i=>d[i]);
import{y as I,j as s,ab as E,r as d,e as f,$ as C,P as K,G as $,d as g,R as q,L as O,I as R,x as D,v as F,f as L,w as b,c as x}from"./index-DYykpNVa.js";import{L as w}from"./constants-CXofZZ4i.js";import{R as A}from"./ResponsiveTable-C-8YbfBJ.js";import{R as z}from"./InstancesPageActions-nbDXpXLr.js";import{u as B}from"./useFetchOld-BGD2hIpr.js";const i={downgrade:{appearance:"positive",icon:"begin-downloading",label:"Downgrade",order:4},hold:{appearance:"positive",icon:"pause",label:"Hold",order:2},remove:{appearance:"negative",icon:"delete",label:"Uninstall",order:1},unhold:{appearance:"positive",icon:"play",label:"Unhold",order:3},upgrade:{appearance:"positive",icon:"change-version",label:"Upgrade",order:5}},H=d.lazy(async()=>C(()=>import("./index-Dj9A88bp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42]))),V=({pkg:e})=>{const{setSidePanelContent:t}=I(),a={remove:!0,hold:e.status!=="held",unhold:e.status==="held",upgrade:!!e.available_version&&e.available_version!==e.current_version,downgrade:e.status!=="held"},u=r=>{t(`${i[r].label} ${e.name}`,s.jsx(d.Suspense,{fallback:s.jsx(f,{}),children:s.jsx(H,{action:r,packages:[e]})}))},n=Object.keys(i).map(r=>r).filter(r=>a[r]&&i[r].appearance=="positive").sort((r,l)=>i[l].order-i[r].order).map(r=>({icon:i[r].icon,label:i[r].label,"aria-label":`${i[r].label} ${e.name} package`,onClick:()=>{u(r)}})),m=Object.keys(i).map(r=>r).filter(r=>a[r]&&i[r].appearance=="negative").sort((r,l)=>i[l].order-i[r].order).map(r=>({icon:i[r].icon,label:i[r].label,"aria-label":`${i[r].label} ${e.name} package`,onClick:()=>{u(r)}}));return s.jsx(E,{toggleAriaLabel:`${e.name} package actions`,actions:n,destructiveActions:m})},G=({onDismiss:e})=>{const t=K(),{instanceId:a,childInstanceId:u}=$();return s.jsxs(g.Notification,{severity:"caution",onDismiss:e,children:[s.jsx("strong",{children:"Some upgrades require Ubuntu Pro: "}),s.jsxs("span",{children:["Your current Ubuntu package upgrades are limited. To unlock full upgrades, please upgrade to Ubuntu Pro."," "]}),s.jsx(g.Button,{type:"button",appearance:"link",onClick:()=>{t(q.instances.details.fromParams({instanceId:a,childInstanceId:u},{tab:"ubuntu-pro"}))},children:"Learn more"})]})},M={available_version:null,current_version:null,id:-1,name:"loading",status:"available",summary:""},W="_checkbox_wpy2z_1",Y="_details_wpy2z_5",J="_tooltipLink_wpy2z_9",X="_hidden_wpy2z_13",j={checkbox:W,details:Y,tooltipLink:J,hidden:X},S=e=>!!e.available_version&&!!e.current_version&&e.available_version.includes("ubuntu-pro"),Q=e=>{const t={label:"Unknown",icon:""};return e.status==="available"?(t.label="Available",t.icon="status-queued-small"):e.status==="held"?(t.label="Held",t.icon="status-in-progress-small"):e.status==="security"?(t.label="Security upgrade",t.icon="status-failed-small"):e.status==="installed"&&(e.available_version&&e.available_version!==e.current_version?(t.label="Regular upgrade",t.icon="status-waiting-small"):(t.label="Installed",t.icon="status-succeeded-small")),t},Z=({column:e,row:t})=>{const a={};return t.original.name==="loading"?e.id==="name"?a.colSpan=5:(a.className=j.hidden,a["aria-hidden"]=!0):e.id==="checkbox"?a["aria-label"]=`Toggle ${t.original.name} package`:e.id==="name"?a.role="rowheader":e.id==="status"?a["aria-label"]="Status":e.id==="current_version"?a["aria-label"]="Current version":e.id==="available_version"?a["aria-label"]="Available version":e.id==="summary"&&(a["aria-label"]="Details"),a},ee=d.lazy(async()=>C(()=>import("./index-2OT7UQXO.js"),__vite__mapDeps([43,1,2,40,12,13,14,15,16,41,29,18,19,30,17,20,21,22,23,24,25,26,27,4,28,31,32,33,34,35,36,37,38,39,42]))),pe=({emptyMsg:e,onPackagesSelect:t,packages:a,packagesLoading:u,selectedPackages:n,selectAll:m})=>{const[r,l]=d.useState(!1),[p,v]=d.useState(!1),{instanceId:c,childInstanceId:y}=$(),{setSidePanelContent:_}=I(),N=d.useMemo(()=>u?[M]:a,[a,u]),P=o=>{t(n.some(({name:h})=>h===o.name)?n.filter(({name:h})=>h!==o.name):[...n,o])},k=()=>{t(n.length>0?[]:a.filter(o=>!S(o)))};d.useEffect(()=>{!m||r||!a.length||(k(),l(!0))},[m,a]);const T=o=>{_("Package details",s.jsx(d.Suspense,{fallback:s.jsx(f,{}),children:s.jsx(ee,{singlePackage:o})}))},U=d.useMemo(()=>[{accessor:"checkbox",className:j.checkbox,Header:s.jsx(g.CheckboxInput,{inline:!0,label:s.jsx("span",{className:"u-off-screen",children:"Toggle all"}),checked:n.length===a.length&&a.length>0,indeterminate:n.length<a.length&&n.length>0,disabled:a.length===0,onChange:k}),Cell:({row:o})=>S(o.original)?s.jsx(g.Tooltip,{message:s.jsxs("div",{children:[s.jsx("p",{className:"u-no-padding--top",children:"Ubuntu Pro is required"}),s.jsx(O,{to:q.instances.details.fromParams({instanceId:c,childInstanceId:y}),className:j.tooltipLink,children:"learn more"})]}),children:s.jsx(g.CheckboxInput,{inline:!0,disabled:!0,label:s.jsx("span",{className:"u-off-screen",children:`Toggle ${o.original.name}`}),checked:n.some(({name:h})=>h===o.original.name),onChange:()=>{P(o.original)}})}):s.jsx(g.CheckboxInput,{inline:!0,label:s.jsx("span",{className:"u-off-screen",children:`Toggle ${o.original.name}`}),checked:n.some(({name:h})=>h===o.original.name),onChange:()=>{P(o.original)}})},{accessor:"name",Header:"Name",Cell:({row:o})=>o.original.name==="loading"?s.jsx(f,{}):s.jsx(g.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{T(o.original)},children:o.original.name})},{accessor:"status",Header:"Status",Cell:({row:{original:o}})=>Q(o).label,getCellIcon:({row:{original:o}})=>Q(o).icon},{accessor:"current_version",Header:"Current version"},{accessor:"summary",className:j.details,Header:"Details",Cell:({row:{original:o}})=>o.available_version?s.jsxs(s.Fragment,{children:[s.jsx("span",{children:o.summary}),s.jsx("br",{}),s.jsx("span",{children:`available version: ${o.available_version}`})]}):o.summary},{...w,Cell:({row:{original:o}})=>s.jsx(V,{pkg:o})}],[a,n.length]);return s.jsxs(s.Fragment,{children:[!p&&a.some(S)&&s.jsx(G,{onDismiss:()=>{v(!0)}}),s.jsx(A,{columns:U,data:N,getCellProps:Z,emptyMsg:e})]})},se="_noWrap_o5brj_1",ae={noWrap:se},ne=d.lazy(async()=>C(()=>import("./index-FOzIlaji.js"),__vite__mapDeps([44,1,2,9,10,11,17,13,18,19,20,21,22,23,24,25,26,27,4,28,45,29,30,31,32,33,34,14,15,35,36,37,38,39,40,12,16,41,42,46]))),te=({appearance:e})=>{const{setSidePanelContent:t}=I(),a=()=>{t("Install packages",s.jsx(d.Suspense,{fallback:s.jsx(f,{}),children:s.jsx(ne,{})}))};return s.jsxs(g.Button,{type:"button",onClick:a,hasIcon:!0,className:R("u-no-margin--bottom",ae.noWrap),appearance:e,children:[s.jsx(g.Icon,{name:"plus",light:e==="positive"}),s.jsx("span",{children:"Install"})]})},re="_container_11i26_1",oe={container:re},ie=d.lazy(async()=>C(()=>import("./index-Dj9A88bp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42]))),ye=({selectedPackages:e})=>{const{setSidePanelContent:t}=I(),a=n=>{const m=D(e.length,e[0]?.name??"",`${e.length} selected packages`);t(`${i[n].label} ${m}`,s.jsx(d.Suspense,{fallback:s.jsx(f,{}),children:s.jsx(ie,{action:n,packages:e})}))},u={remove:e.length===0||e.every(n=>!n.current_version),hold:e.length===0||e.every(n=>n.status==="held"),unhold:e.length===0||e.every(n=>n.status!=="held"),upgrade:e.length===0||e.every(n=>!n.available_version)};return s.jsxs("div",{className:oe.container,children:[s.jsx(te,{}),s.jsx(z,{collapseFrom:"xl",buttons:Object.keys(i).filter(n=>n!=="downgrade").map(n=>n).sort((n,m)=>i[n].order-i[m].order).map(n=>s.jsxs(g.Button,{type:"button",className:"p-segmented-control__button has-icon u-no-margin--bottom",disabled:u[n],onClick:()=>{a(n)},children:[s.jsx(g.Icon,{name:i[n].icon}),s.jsx("span",{children:i[n].label})]},n))})]})};function ge(){const e=F(),t=B(),a=L(),u=(c,y={})=>x({queryKey:["packages",c],queryFn:async()=>a.get("packages",{params:c}),...y}),n=({instance_id:c,...y},_={})=>x({queryKey:["packages",{instance_id:c,...y}],queryFn:async()=>a.get(`computers/${c}/packages`,{params:y}),..._}),m=b({mutationFn:async c=>t.get("UpgradePackages",{params:c}),onSuccess:async()=>e.invalidateQueries({queryKey:["packages"]})}),r=b({mutationFn:async c=>a.post("/computers/upgrade-packages",c),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["packages"]}),e.invalidateQueries({queryKey:["instances"]})])}),l=({instanceId:c,packageName:y},_={})=>x({queryKey:["packageDowngradeVersion",{instanceId:c,packageName:y}],queryFn:async()=>a.get(`computers/${c}/packages/installed/${y}/downgrades`),..._}),p=b({mutationFn:async({instanceId:c,...y})=>a.post(`computers/${c}/packages/installed`,y),onSuccess:async()=>e.invalidateQueries({queryKey:["packages"]})}),v=b({mutationFn:async c=>a.post("packages",c),onSuccess:async()=>e.invalidateQueries({queryKey:["packages"]})});return{getPackagesQuery:u,getInstancePackagesQuery:n,upgradePackagesQuery:m,getDowngradePackageVersionsQuery:l,downgradePackageVersionQuery:p,packagesActionQuery:v,upgradeInstancesPackagesQuery:r}}function he(){const e=F(),t=L(),a=(l,p={})=>x({queryKey:["usns",l],queryFn:async()=>t.get("usns",{params:l}),...p}),u=({usn:l,...p},v={})=>x({queryKey:["usnPackages",{usn:l,...p}],queryFn:async()=>t.get(`usns/${l}`,{params:p}),...v}),n=b({mutationFn:async({instanceId:l,...p})=>t.post(`/computers/${l}/usns/upgrade-packages`,p),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])}),m=b({mutationFn:async({instanceId:l,...p})=>t.post(`/computers/${l}/usns/remove-packages`,p),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])}),r=b({mutationFn:async l=>t.post("/computers/usns/upgrade-packages",l),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])});return{getUsnsQuery:a,getAffectedPackagesQuery:u,upgradeInstanceUsnsQuery:n,removeUsnPackagesQuery:m,upgradeUsnsQuery:r}}export{i as I,ye as P,ge as a,te as b,pe as c,he as u};
