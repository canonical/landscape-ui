import{r as f,j as e,g as u,d as F,c as v,k as _,l as H,e as E,o as Q}from"./index-yMWucjne.js";import{E as M}from"./EmptyState-kWhHOMkp.js";import"./TablePagination.module-DLVph1Z1.js";import{T}from"./TablePagination-BR5n3pdC.js";import{u as y}from"./useMutation-zxPjmBpS.js";import{u as $}from"./useQuery-CgBhq_jS.js";import{u as b}from"./usePageParams-D8tvGGl5.js";const z=({processes:t,selectedPids:n,setSelectedPids:o})=>{const i=()=>{o(n.length===0?t.map(({pid:s})=>s):[])},r=f.useMemo(()=>[{accessor:"name",Header:e.jsxs(e.Fragment,{children:[e.jsx(u.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all processes"}),checked:n.length>0&&n.length===t.length,disabled:t.length===0,onChange:i,indeterminate:n.length>0&&n.length<t.length}),e.jsx("span",{children:"Command"})]}),Cell:({row:s})=>e.jsxs(e.Fragment,{children:[e.jsx(u.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:`Select process ${s.original.name}`}),checked:n.includes(s.original.pid),onChange:()=>{o(n.includes(s.original.pid)?n.filter(c=>c!==s.original.pid):[...n,s.original.pid])}}),e.jsx("span",{children:s.original.name})]})},{accessor:"state",Header:"State"},{accessor:"vm_size",Header:"VM size"},{accessor:"cpu_utilization",Header:"CPU (%)",Cell:({row:s})=>e.jsxs(e.Fragment,{children:[(100*s.original.cpu_utilisation).toFixed(1),"%"]})},{accessor:"pid",Header:"PID"},{accessor:"start_time",Header:"Started at"},{accessor:"gid",Header:"Group"}],[t,n]);return e.jsx(u.ModularTable,{columns:r,data:t,emptyMsg:"No processes found"})},P=()=>{const t=F(),n=v(),o=(s,c={})=>{const{computer_id:m,...d}=s;return $({queryKey:["processes",s],queryFn:()=>t.get(`/computers/${m}/processes`,{params:d}),...c})},i=y({mutationFn:s=>t.post("processes/terminate",s),onSuccess:()=>{n.invalidateQueries(["processes"])}}),r=y({mutationFn:s=>t.post("processes/kill",s),onSuccess:()=>{n.invalidateQueries(["processes"])}});return{getProcessesQuery:o,killProcessQuery:r,terminateProcessQuery:i}},A="_container_eu2va_1",B="_searchContainer_eu2va_6",C={container:A,searchContainer:B},D=({selectedPids:t,handleClearSelection:n})=>{const{instanceId:o}=_(),{search:i,setPageParams:r}=b(),{notify:s}=H(),c=E(),{killProcessQuery:m,terminateProcessQuery:d}=P(),[a,h]=f.useState(i),g=Number(o),{mutateAsync:p}=d,{mutateAsync:x}=m,j=()=>{r({search:a}),n()},S=()=>{r({search:""})},I=l=>{l.preventDefault(),j()},N=async()=>{try{await p({pids:t,computer_id:g}),s.success({message:`${t.length===1?"Process":"Processes"} successfully ended`}),n()}catch(l){c(l)}},k=async()=>{try{await x({pids:t,computer_id:g}),s.success({message:`${t.length===1?"Process":"Processes"} successfully killed`}),n()}catch(l){c(l)}};return e.jsxs("div",{className:C.container,children:[e.jsx("div",{className:C.searchContainer,children:e.jsx(u.Form,{onSubmit:I,noValidate:!0,children:e.jsx(u.SearchBox,{shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off","aria-label":"Process search",value:a,onChange:l=>h(l),onSearch:j,onClear:S})})}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsx(u.Button,{className:"p-segmented-control__button",disabled:t.length===0,onClick:N,children:"End process"}),e.jsx(u.Button,{className:"p-segmented-control__button",disabled:t.length===0,onClick:k,children:"Kill process"})]})})]})},K=()=>{const[t,n]=f.useState([]),{instanceId:o,childInstanceId:i}=_(),{search:r,currentPage:s,pageSize:c}=b(),{getProcessesQuery:m}=P(),d=Number(i??o),{data:a,isLoading:h}=m({computer_id:d,limit:c,offset:(s-1)*c,search:r}),g=(a==null?void 0:a.data.count)??0,p=f.useMemo(()=>(a==null?void 0:a.data.results)??[],[a]),x=()=>{n([])};return e.jsxs(e.Fragment,{children:[!r&&h&&e.jsx(Q,{}),!h&&!r&&(!a||a.data.results.length===0)&&e.jsx(M,{icon:"connected",title:"No processes running"}),(r||!h&&a&&a.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(D,{handleClearSelection:x,selectedPids:t}),e.jsx(z,{processes:p,setSelectedPids:j=>n(j),selectedPids:t})]}),e.jsx(T,{handleClearSelection:x,totalItems:g,currentItemCount:p.length})]})},R=K;export{R as default};
