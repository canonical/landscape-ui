const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-wM85PjTA.js","assets/index-CAxb-9CO.js","assets/index-DXB7zdRE.css","assets/constants-BjIJGPvq.js","assets/PageMain-DA-yLzkU.js","assets/PageMain-CIunaku7.css","assets/useGetInstance-CjbtfCLR.js","assets/useUsns-zVGmxBU0.js","assets/useUsns-BRJzzA4M.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-CNIav8so.css","assets/index-CvJQgo-r.js","assets/constants-Dwl1JGyb.js","assets/index-DgHoeIwv.css","assets/index-U5jKsF1E.js","assets/index-DiHE8StE.js","assets/AutoinstallFileVersionHistory-B4YYjhAs.js","assets/SidePanelTablePagination-CVHlLoEX.js","assets/AutoinstallFileVersionHistory-BUeZdID_.css","assets/InstanceRemoveFromLandscapeModal-B5TvjWmZ.js","assets/useRemoveInstancesFromLandscape-DTCxbAvZ.js","assets/useRoles-CwlY2G8P.js","assets/WslInstancesEmptyState-DGs1I9Tg.js","assets/GroupFilter-YE-Y99w2.js","assets/HeaderWithSearch-D9EWFI6l.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/TruncatedCell-D7I1Byj1.js","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-Dk4aTLgf.js","assets/WslInstancesEmptyState-CanINxhB.css","assets/index-DfA4GLZO.js","assets/EmployeeList-DKxFjLts.js","assets/EmployeeList-DRxY5zMq.css","assets/index-BGG8ELU6.css","assets/index-DcDj0Znx.js","assets/index-BzXEPdn_.css","assets/index-C-pu7fZ3.js","assets/index-B8MQ95pn.css","assets/index-DA2qCkIJ.js","assets/useSelection-C1JP7O2F.js","assets/index-B0p01W4u.css","assets/index-B0usZf7U.js","assets/useGetActivities-BxN-Udp0.js","assets/ActivitiesEmptyState-DeDMTyHq.js","assets/index-BwWlRd95.js","assets/index-CzrLW3IK.css","assets/index-4WAn5HvT.js","assets/useGetWslLimits-BLjmkt5S.js","assets/index-BfpW9K9I.css","assets/index-BLe7n-tg.js","assets/SidePanelFormButtons-THQX_GYS.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/helpers-xms8VTfd.js","assets/index-DQLukqVs.css","assets/index-CFVpg7e8.js","assets/UsnList-iDxOYCa1.js","assets/SelectAllButton-RVFiyaKp.js","assets/ExpandableTableFooter-BxdE2LmU.js","assets/ExpandableTableFooter-CF0EpBAN.css","assets/UsnList-lBcfXQ7t.css","assets/index-CsHgpdRJ.css","assets/index-CXy6kmm9.js","assets/index-B1Uu4xTW.css","assets/index-DJIJ_QS8.js","assets/downshift.esm-BaGkb_h5.js","assets/index-BcIsbW0p.css"])))=>i.map(i=>d[i]);
import{n as f,j as e,aJ as R,d as b,i as t,v as o,a3 as u,b as T,e as F,f as y,g as m,X as P,E as K,a as v,aE as x,h as Q,at as A,P as D}from"./index-CAxb-9CO.js";import{P as V,a as C,b as O}from"./PageMain-DA-yLzkU.js";import{u as z}from"./useGetInstance-CjbtfCLR.js";import{u as U,a as B}from"./useUsns-zVGmxBU0.js";import{c as N}from"./SingleInstanceTabs.module-Cm1BYFZQ.js";const q="_container_pnq0d_1",$={container:q},H=t.lazy(async()=>u(()=>import("./index-wM85PjTA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),G=t.lazy(async()=>u(()=>import("./index-CvJQgo-r.js"),__vite__mapDeps([12,1,2,13,3,4,5,6,7,8,9,10,14]))),M=t.lazy(async()=>u(()=>import("./index-U5jKsF1E.js"),__vite__mapDeps([15,1,2,13,4,5,6,7,8,9,10,14]))),we=({instanceName:n,hasTableData:s,kernelStatuses:a})=>{const{setSidePanelContent:d}=f(),p=a?.installed?.version_rounded??"",g=a?.downgrades??[],i=a?.upgrades??[],l=()=>{d("Downgrade kernel",e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(H,{instanceName:n,currentKernelVersion:p,downgradeKernelVersions:g})}))},r=()=>{d("Upgrade kernel",e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(G,{instanceName:n,currentKernelVersion:p,upgradeKernelVersions:i})}))},_=()=>{d(`Restart ${n}`,e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(M,{instanceName:n,showNotification:s,newKernelVersionId:i[0]?.id})}))};return e.jsxs("div",{className:$.container,children:[e.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:"Kernel overview"}),e.jsx(R,{collapseFrom:"lg",buttons:[e.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:_,children:[e.jsx(b.Icon,{name:"restart"}),e.jsx("span",{children:"Restart instance"})]},"restart-instance"),e.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:g.length===0,onClick:l,children:[e.jsx(b.Icon,{name:"begin-downloading"}),e.jsx("span",{children:"Downgrade kernel"})]},"downgrade-kernel"),e.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:i.length===0,onClick:r,children:[e.jsx(b.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade kernel"})]},"upgrade-kernel")]})]})};function W(){const n=T(),s=F(),a=({id:i},l={})=>m({queryKey:["kernel",i],queryFn:async()=>n.get(`computers/${i}/livepatch/kernel`),...l}),d=({id:i,...l},r={})=>m({queryKey:["kernel",{id:i,...l}],queryFn:async()=>n.get(`computers/${i}/livepatch/info`,{params:l}),...r}),p=y({mutationKey:["kernel","downgrade"],mutationFn:async({id:i,...l})=>n.post(`computers/${i}/kernel/downgrade`,l),onSuccess:async()=>s.invalidateQueries({queryKey:["kernel"]})}),g=y({mutationKey:["kernel","upgrade"],mutationFn:async({id:i,...l})=>n.post(`computers/${i}/kernel/upgrade`,l),onSuccess:async()=>s.invalidateQueries({queryKey:["kernel"]})});return{getKernelQuery:a,getLivepatchInfoQuery:d,downgradeKernelQuery:p,upgradeKernelQuery:g}}const J=({childInstanceId:n,instanceId:s})=>{const a=P();return e.jsx(K,{title:"Instance not found",icon:"connected",body:e.jsxs("p",{className:"u-no-margin--bottom",children:[e.jsx("span",{children:"Seems like the instance with id = "}),e.jsx("code",{children:s}),e.jsx("span",{children:" doesn't "}),n?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"have a child instance with id = "}),e.jsx("code",{children:n})]}):e.jsx("span",{children:"exist"}),"."]}),cta:[e.jsx(b.Button,{appearance:"positive",onClick:async()=>a("/instances",{replace:!0}),type:"button","aria-label":"Go back",children:"Back to Instances page"},"go-back-to-instances-page"),e.jsx(b.Button,{onClick:async()=>a("/",{replace:!0}),type:"button","aria-label":"Go back",children:"Home page"},"go-back-to-home-page")]})},X=({id:n,label:s,packageCount:a,packagesLoading:d,usnCount:p,usnLoading:g,kernelCount:i,kernelLoading:l})=>n==="tab-link-packages"&&d||n==="tab-link-security-issues"&&g||n==="tab-link-kernel"&&l?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Spinner,{className:"u-no-margin--bottom u-no-padding--top"})]}):n==="tab-link-packages"&&a?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Badge,{value:a})]}):n==="tab-link-security-issues"&&p?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Badge,{value:p,isNegative:!0})]}):n==="tab-link-kernel"&&i?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Badge,{value:i})]}):s,Y=({activeTabId:n,instance:s,onActiveTabChange:a,packageCount:d,packagesLoading:p,usnCount:g,usnLoading:i,kernelCount:l,kernelLoading:r})=>{const{isFeatureEnabled:_}=v();return[{label:"Info",id:"tab-link-info",included:!0},{label:"WSL",id:"tab-link-wsl",included:x(s).wsl&&_("wsl-child-instance-profiles")},{label:"Activities",id:"tab-link-activities",included:!0},{label:"Kernel",id:"tab-link-kernel",included:x(s).packages},{label:"Security issues",id:"tab-link-security-issues",included:x(s).packages},{label:"Packages",id:"tab-link-packages",included:x(s).packages},{label:"Snaps",id:"tab-link-snaps",included:x(s).snaps},{label:"Processes",id:"tab-link-processes",included:x(s).processes},{label:"Ubuntu Pro",id:"tab-link-ubuntu-pro",included:x(s).pro},{label:"Users",id:"tab-link-users",included:x(s).users},{label:"Hardware",id:"tab-link-hardware",included:x(s).hardware}].filter(h=>h.included).map(({label:h,id:k})=>({label:X({label:h,id:k,packageCount:d,packagesLoading:p,usnCount:g,usnLoading:i,kernelCount:l,kernelLoading:r}),id:k,role:"tab",active:k===n,onClick:()=>{a(k)}}))},Z=t.lazy(async()=>u(()=>import("./index-DiHE8StE.js"),__vite__mapDeps([16,1,2,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34]))),ee=t.lazy(async()=>u(()=>import("./index-DcDj0Znx.js"),__vite__mapDeps([35,1,2,25,26,36]))),ne=t.lazy(async()=>u(()=>import("./index-C-pu7fZ3.js"),__vite__mapDeps([37,1,2,38]))),se=t.lazy(async()=>u(()=>import("./index-DA2qCkIJ.js"),__vite__mapDeps([39,1,2,7,8,25,26,40,41]))),ae=t.lazy(async()=>u(()=>import("./index-B0usZf7U.js"),__vite__mapDeps([42,1,2,40,43,44]))),te=t.lazy(async()=>u(()=>import("./index-BwWlRd95.js"),__vite__mapDeps([45,1,2,4,5,6,7,8,9,10,46]))),re=t.lazy(async()=>u(()=>import("./index-4WAn5HvT.js"),__vite__mapDeps([47,1,2,48,23,24,25,26,27,28,29,22,30,40,21,49]))),ie=t.lazy(async()=>u(()=>import("./index-BLe7n-tg.js").then(n=>n.i),__vite__mapDeps([50,1,2,51,52,53,54,25,26,55]))),le=t.lazy(async()=>u(()=>import("./index-CFVpg7e8.js"),__vite__mapDeps([56,1,2,7,8,25,26,57,58,59,60,27,28,61,62]))),ce=t.lazy(async()=>u(()=>import("./index-CXy6kmm9.js"),__vite__mapDeps([63,1,2,64]))),oe=t.lazy(async()=>u(()=>import("./index-DJIJ_QS8.js"),__vite__mapDeps([65,1,2,51,52,53,66,25,26,54,67]))),ue=({instance:n,packageCount:s,packagesLoading:a,usnCount:d,usnLoading:p,kernelCount:g,kernelLoading:i})=>{const{closeSidePanel:l}=f(),{tab:r,setPageParams:_}=Q(),c=r?`tab-link-${r}`:"tab-link-info",h=Y({activeTabId:c,instance:n,onActiveTabChange:k=>{_({tab:k.replace("tab-link-","")}),l()},packageCount:s,packagesLoading:a,usnCount:d,usnLoading:p,kernelCount:g,kernelLoading:i});return e.jsxs(e.Fragment,{children:[e.jsx(b.Tabs,{listClassName:"u-no-margin--bottom",links:h}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":c,className:N.tabPanel,children:e.jsxs(A,{children:[c==="tab-link-info"&&e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(Z,{instance:n})}),c==="tab-link-wsl"&&e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(re,{instance:n})}),c==="tab-link-activities"&&e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(ae,{instanceId:n.id})}),c==="tab-link-kernel"&&e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(te,{instanceTitle:n.title})}),c==="tab-link-security-issues"&&e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(le,{instance:n})}),c==="tab-link-packages"&&e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(se,{})}),c==="tab-link-snaps"&&e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(oe,{})}),c==="tab-link-processes"&&e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(ee,{})}),c==="tab-link-ubuntu-pro"&&e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(ce,{instance:n})}),c==="tab-link-users"&&e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(ie,{})}),c==="tab-link-hardware"&&e.jsx(t.Suspense,{fallback:e.jsx(o,{}),children:e.jsx(ne,{instance:n})})]})})]})},de=n=>{if(n)return n.parent?[{label:"Instances",path:"/instances"},{label:n.parent.title,path:`/instances/${n.parent.id}`},{label:n.title,current:!0}]:[{label:"Instances",path:"/instances"},{label:n.title,current:!0}]},pe=n=>{if(!(!n||n.length===0||!n[0]?.Livepatch?.Fixes))return n[0].Livepatch.Fixes.length},be=(n,s)=>n.distribution?s:0,ge=(n,s)=>n.distribution?s:0,xe=n=>n?.title??"",ke=(n,s)=>parseInt(s||(n??"")),_e=(n,s,a)=>!!n&&(!s||s===a),he=(n,s,a)=>!!n&&x(n).packages&&(!a||n.parent?.id===parseInt(s??"")),je=(n,s,a)=>!!n&&x(n).packages&&(!a||n.parent?.id===parseInt(s??"")),ye=(n,s,a)=>!!n&&x(n).packages&&(!a||n.parent?.id===parseInt(s??"")),me=n=>n?[n.id]:[],I=n=>n?n.id:0,Ie=(n,s,a)=>n&&(!a||n.parent&&n.parent.id===parseInt(s??"")),fe=()=>{const{instanceId:n,childInstanceId:s}=D(),{user:a}=v(),d=P(),{getUsnsQuery:p}=U(),{getInstancePackagesQuery:g}=B(),{getLivepatchInfoQuery:i}=W(),l=t.useRef("");t.useEffect(()=>{a?.current_account&&(l.current||(l.current=a.current_account),l.current!==a.current_account&&d("/instances",{replace:!0}))},[a?.current_account]);const{instance:r,isGettingInstance:_}=z({instanceId:ke(n,s),with_annotations:!0,with_grouped_hardware:!0,with_profiles:!0},{enabled:_e(n,l.current,a?.current_account)}),{data:c,isLoading:h}=p({computer_ids:me(r),limit:1},{enabled:ye(r,n,s)}),{data:k,isLoading:E}=g({available:!1,upgrade:!0,instance_id:I(r),limit:1},{enabled:he(r,n,s)}),{data:L,isLoading:S}=i({id:I(r)},{enabled:je(r,n,s)}),w=pe(L?.data.livepatch_info?.json?.output?.Status),j=Ie(r,n,s);return e.jsxs(V,{children:[e.jsx(C,{title:xe(r),hideTitle:!0,breadcrumbs:de(r)}),e.jsx(O,{children:_?e.jsx(o,{}):e.jsxs(e.Fragment,{children:[!j&&e.jsx(J,{childInstanceId:s,instanceId:n}),r&&j&&e.jsx(ue,{instance:r,packageCount:be(r,Number(k?.data.count)),packagesLoading:E,usnCount:ge(r,Number(c?.data.count)),usnLoading:h,kernelCount:r.distribution?w:0,kernelLoading:S})]})})]})},Re=Object.freeze(Object.defineProperty({__proto__:null,default:fe},Symbol.toStringTag,{value:"Module"}));export{we as K,Re as i,W as u};
