import{r as x,j as e,d as r,y as k,z as T,q as N,B as I,f as te,c as ae,w as y,G as q,e as D,D as A,U as se,an as ne}from"./index-CNSDWj8Q.js";import{A as Q}from"./AssociationBlock-B4LnXWNE.js";import{S as O}from"./SidePanelFormButtons-DIizKTix.js";import{S as b,C as oe}from"./SidePanel-ChyjtMJv.js";import{u as L}from"./useRoles-DYJzr0u4.js";import{g as j}from"./formikErrors-Bw8iTXYS.js";import{T as re,C as W,a as E,E as z,u as F,V as ie,I as le,b as ce,L as U,c as ue,d as de,P as pe,e as ge,f as me}from"./index-U4RjqYcV.js";import{g as aa,h as sa,i as na}from"./index-U4RjqYcV.js";import{F as he}from"./FileInput-DsRDkpd1.js";import{u as Pe}from"./useGetInstances-rIFBd_bT.js";import"./InstancesPageActions-DL7_pmR1.js";import"./index-CySvbr4l.js";import{H as Y}from"./HeaderWithSearch-D2tNhOlz.js";import{S as K}from"./SidePanelTablePagination-CaBsUOYn.js";import{P as Ce}from"./ProfileAssociatedInstancesLink-Neer6jGU.js";import{I as v}from"./InfoGrid-3w5mqARw.js";import"./MultiSelectField-CqoYdMk0.js";import"./useGetTags-B_HL7bdb.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./useFetchOld-BAAs34Op.js";import"./PageMain-C8MVZwda.js";import"./TableFilterChips-06YfpJdc.js";import"./constants-CDnVvJTb.js";import"./constants-cpRdwKHL.js";import"./ListTitle-BUruUKn1.js";import"./NoData-6ZK9sV5u.js";import"./ResponsiveTable-BXalKviy.js";import"./TruncatedCell-BMum6DLZ.js";import"./Truncated-Dtg97i8C.js";import"./useExpandableRow-B4jhRgod.js";import"./TextConfirmationModal-q88mH05g.js";import"./table-CdFwMAPu.js";import"./index-D-YBZSy_.js";import"./TablePagination-CFXNvqsZ.js";import"./PageParamFilter-ChSwlZqZ.js";import"./TableFilter-2AKF5NjJ.js";import"./StaticLink-BEYCGcPv.js";import"./InfoItem-Bt7JBIPo.js";const R=({onChange:t,value:a,...s})=>{const[n,i]=x.useState(a);return e.jsx(r.Input,{type:"text",autoComplete:"off",...s,value:n,onChange:l=>{i(l.target.value)},onBlur:()=>t(n)})},be="_action_w93bw_1",xe="_cell_w93bw_7",fe="_input_w93bw_18",je="_inputWrapper_w93bw_26",S={action:be,cell:xe,input:fe,inputWrapper:je},Se=async(t,a,s,n)=>{await t.setFieldValue(`constraints[${a}]${[s]}`,n),await t.setFieldTouched(`constraints[${a}]${[s]}`,!0),["rule","version"].includes(s)&&(n!==""?await t.setFieldValue(`constraints[${a}].notAnyVersion`,!0):t.values.constraints[a][s==="rule"?"version":"rule"]===""&&await t.setFieldValue(`constraints[${a}].notAnyVersion`,!1))},ye=(t,a,s)=>{if(!t.errors.constraints?.[a]||!t.touched.constraints?.[a]?.[s])return;const n=t.errors.constraints[a];return typeof n!="string"?n[s]:void 0},_e=async(t,a)=>{await t.setFieldValue("constraints",t.values.constraints.filter((s,n)=>n!==a)),t.touched.constraints&&(t.touched.constraints.splice(a,1),await t.setTouched({...t.touched,constraints:t.touched.constraints}))},ve=t=>({handleConstraintPropChange:async(a,s,n)=>{await Se(t,a,s,n)},handleConstraintRowDelete:async a=>{await _e(t,a)},getConstraintsErrorByIndex:(a,s)=>ye(t,a,s)}),Ne=({column:t})=>{const a={};return a.className=S.cell,t.id==="package_name"?a.role="rowheader":t.id==="action"?a["aria-label"]="Action":t.id==="constraint"?a["aria-label"]="Constraint":t.id==="version"?a["aria-label"]="Version":t.id==="rule"&&(a["aria-label"]="Rule"),a},Z=({formik:t})=>{x.useEffect(()=>{t.submitCount!==0&&(async()=>await t.setTouched({...t.touched,constraints:new Array(t.values.constraints.length).fill(re)}))()},[t.submitCount]);const a=x.useMemo(()=>t.values.constraints,[t.values.constraints]),{handleConstraintPropChange:s,handleConstraintRowDelete:n,getConstraintsErrorByIndex:i}=ve(t),l=x.useMemo(()=>[{accessor:"constraint",Header:"Constraint",Cell:({row:{index:c}})=>e.jsx(r.Select,{label:"Constraint",labelClassName:"u-off-screen",className:S.input,wrapperClassName:S.inputWrapper,options:W,...t.getFieldProps(`constraints[${c}].constraint`),onChange:u=>s(c,"constraint",u.target.value),error:i(c,"constraint")})},{accessor:"package",Header:"Package",Cell:({row:{index:c}})=>e.jsx(R,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:S.input,wrapperClassName:S.inputWrapper,...t.getFieldProps(`constraints[${c}].package`),onChange:u=>s(c,"package",u),error:i(c,"package")})},{accessor:"rule",Header:"Rule",Cell:({row:{index:c}})=>e.jsx(r.Select,{label:"Rule",labelClassName:"u-off-screen",className:S.input,wrapperClassName:S.inputWrapper,...t.getFieldProps(`constraints[${c}].rule`),options:E,onChange:u=>s(c,"rule",u.target.value),error:i(c,"rule")})},{accessor:"version",Header:"Version",Cell:({row:{index:c}})=>e.jsx(R,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:S.input,wrapperClassName:S.inputWrapper,...t.getFieldProps(`constraints[${c}].version`),onChange:u=>s(c,"version",u),error:i(c,"version")})},{accessor:"action",className:S.action,Cell:({row:c})=>e.jsx(r.Button,{type:"button",hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding","aria-label":"Delete constraint row",onClick:()=>n(c.index),children:e.jsx(r.Icon,{name:r.ICONS.delete,className:"u-no-margin--left u-no-margin--right"})})}],[a,t.errors.constraints,t.touched.constraints]),m=async()=>{if(await t.setFieldValue("constraints",[z,...t.values.constraints]),t.touched.constraints){const c=[];for(let u=t.values.constraints.length;u>0;u--)t.touched.constraints[u-1]&&(c[u]=t.touched.constraints[u-1]);await t.setTouched({constraints:c})}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"u-align-text--right",children:e.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:m,children:[e.jsx(r.Icon,{name:r.ICONS.plus,className:"u-no-margin--left"}),e.jsx("span",{children:"Add new constraint"})]})}),e.jsx(r.ModularTable,{columns:l,data:a,getCellProps:Ne,emptyMsg:"No constraints added yet.",className:"u-no-margin--bottom"}),t.touched.constraints&&typeof t.errors.constraints=="string"&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:"p-form-validation__message u-no-margin--top",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:t.errors.constraints})]})})]})},Fe=[{label:"Select constraints type",value:""},{label:"From an instance's packages",value:"instance"},{label:"From a CSV file",value:"material"},{label:"Enter manually",value:"manual"}],Ae="_container_vi1gw_1",ke={container:Ae},Te=({formik:t})=>{const{instances:a}=Pe(),s=a.map(({id:l,title:m})=>({label:m,value:`${l}`}))??[];s.unshift({label:"Select instance",value:""});const n=async l=>{await t.setFieldValue("csvFile",l[0]);const m=await l[0].text();await t.setFieldValue("material",m)},i=async()=>{await t.setFieldValue("csvFile",null),await t.setFieldValue("material",""),await t.setFieldValue("isCsvFileParsed",!1)};return e.jsxs("div",{className:ke.container,children:[e.jsx(r.Select,{label:"Package constraints",required:!0,options:Fe,...t.getFieldProps("constraintsType"),error:j(t,"constraintsType")}),t.values.constraintsType==="instance"&&e.jsx(r.Select,{label:"Instance",required:t.values.constraintsType==="instance",options:s,...t.getFieldProps("source_computer_id"),error:j(t,"source_computer_id")}),t.values.constraintsType==="material"&&e.jsx(he,{label:"Upload constraints",accept:".csv",...t.getFieldProps("csvFile"),onFileRemove:i,onFileUpload:n,help:'File should be formatted as either a package profile CSV file or the output of running "dpkg --get-selections" on a computer with desired packages installed.',error:j(t,"csvFile")||j(t,"material")||void 0}),t.values.constraintsType==="manual"&&e.jsx(Z,{formik:t})]})},Ut=()=>{const t=k(),{notify:a}=T(),{createPageParamsSetter:s}=N(),{getAccessGroupQuery:n}=L(),{createPackageProfileQuery:i}=F(),{data:l,isPending:m}=n(),c=l?.data.map(({name:h,title:p})=>({label:p,value:h}))??[],{mutateAsync:u}=i,g=s({sidePath:[],profile:""}),d=I({initialValues:le,onSubmit:async h=>{const p={access_group:h.access_group,description:h.description,title:h.title};h.all_computers?p.all_computers=!0:h.tags.length>0&&(p.tags=h.tags),h.constraintsType==="material"?p.material=h.material:h.constraintsType==="instance"?p.source_computer_id=h.source_computer_id:p.constraints=h.constraints.map(({constraint:o,package:P,rule:w,version:G})=>({constraint:o,package:P,rule:w,version:G}));try{await u(p),g(),a.success({message:`Profile "${h.title}" added successfully`,title:"Profile added"})}catch(o){t(o)}},validationSchema:ie,validateOnMount:!0});return m?e.jsx(b.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsx(b.Header,{children:"Add package profile"}),e.jsx(b.Content,{children:e.jsxs(r.Form,{onSubmit:d.handleSubmit,noValidate:!0,children:[e.jsx(r.Input,{type:"text",label:"Title",required:!0,...d.getFieldProps("title"),error:j(d,"title")}),e.jsx(r.Input,{type:"text",label:"Description",required:!0,autoComplete:"off",...d.getFieldProps("description"),error:j(d,"description")}),e.jsx(r.Select,{label:"Access group",...d.getFieldProps("access_group"),options:c,error:j(d,"access_group")}),e.jsx(Q,{formik:d}),e.jsx(Te,{formik:d}),e.jsx(O,{submitButtonDisabled:!d.isValid,submitButtonLoading:d.isSubmitting,submitButtonText:"Add package profile",onCancel:g})]})})]})},we=t=>{const a=te(),{data:s,isPending:n,error:i}=ae({queryKey:["packageProfile",t],queryFn:async({signal:m})=>a.get("packageprofiles",{params:{names:[t]},signal:m})}),l=s?.data.result[0];return{packageProfile:l,packageProfileError:s&&!l?new Error("The package profile could not be found."):i,isGettingPackageProfile:n}},$=()=>{const{profile:t}=N(),{packageProfile:a,isGettingPackageProfile:s,packageProfileError:n}=we(t);if(n)throw n;return s?{packageProfile:void 0,isGettingPackageProfile:!0}:{packageProfile:a,isGettingPackageProfile:!1}},Ie=({profile:t})=>{const a=x.useContext(oe),s=k(),{notify:n}=T(),{sidePath:i,popSidePath:l}=N(),{addPackageProfileConstraintsQuery:m}=F(),{mutateAsync:c}=m,g=I({initialValues:{constraints:[z]},onSubmit:async({constraints:C})=>{try{await c({name:t.name,constraints:C.map(({constraint:d,package:h,rule:p,version:o})=>({constraint:d,package:h,rule:p,version:o}))}),l(),n.success({message:`${C.length} package profile ${y(C.length,"constraint")}  added successfully`,title:"Package profile constraints added"})}catch(d){s(d)}},validationSchema:ce,validateOnMount:!0});return e.jsxs(r.Form,{onSubmit:g.handleSubmit,noValidate:!0,children:[e.jsx(Z,{formik:g}),e.jsx(O,{submitButtonDisabled:!g.isValid||g.isValidating,submitButtonLoading:g.isSubmitting,submitButtonText:`Add ${y(g.values.constraints.length,"constraint")}`,submitButtonAriaLabel:`Add ${y(g.values.constraints.length,"constraint")} to "${t.title}" profile`,cancelButtonDisabled:g.isSubmitting,hasBackButton:i.length>1,onBackButtonPress:l,onCancel:a})]})},Yt=()=>{const{packageProfile:t,isGettingPackageProfile:a}=$();return a?e.jsx(b.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(b.Header,{children:['Add package constraints to "',t.title,'" profile']}),e.jsx(b.Content,{children:e.jsx(Ie,{profile:t})})]})},$e=[{label:"All",value:""},{label:"Conflicts",value:"conflicts"},{label:"Depends",value:"depends"}],Be="_container_scrq4_1",Ve={container:Be},Ee=({filter:t,formik:a,onFilterChange:s,profile:n,selectedIds:i,setSelectedIds:l})=>{const m=k(),{notify:c}=T(),{createSidePathPusher:u}=N(),{removePackageProfileConstraintsQuery:g}=F(),{mutateAsync:C,isPending:d}=g,h=async()=>{try{await C({constraint_ids:i,name:n.name}),l([]),c.success({message:`${i.length} "${n.title}" profile's ${y(i.length,"constraint")} removed successfully`,title:`Package profile ${y(i.length,"constraint")} removed`})}catch(o){m(o)}},p=u("add-constraints");return e.jsxs("div",{className:Ve.container,children:[e.jsx(r.Select,{label:"Constraint type",className:"u-no-margin--bottom",labelClassName:"u-no-padding--top",options:$e,value:t,onChange:o=>{s(o.target.value)}}),e.jsxs(r.ConfirmationButton,{className:"has-icon u-no-margin--right u-no-margin--bottom",type:"button",disabled:i.length===0||a.values.id!==0,"aria-label":`Remove selected ${y(i.length,"constraint")}`,confirmationModalProps:{title:`Remove ${y(i.length,"constraint")}`,children:e.jsxs("p",{children:["This will remove ",i.length," ",y(i.length,"constraint"),"."]}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:h},children:[e.jsx(r.Icon,{name:r.ICONS.delete}),e.jsx("span",{children:"Remove"})]}),e.jsxs(r.Button,{className:"u-no-margin--bottom",type:"button",hasIcon:!0,onClick:p,"aria-label":"Add new constraint",children:[e.jsx(r.Icon,{name:r.ICONS.plus}),e.jsx("span",{children:"Add constraints"})]})]})},Re="_actionButton_15xpu_1",De="_tooltip_15xpu_5",V={actionButton:Re,tooltip:De},Oe=({constraint:t,formik:a})=>a.values.id===t.id?e.jsxs(e.Fragment,{children:[e.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:q("u-no-margin--bottom u-no-padding",V.actionButton),onClick:()=>{a.handleSubmit()},"aria-label":`Save changes to ${t.package} constraint`,children:e.jsx(r.Tooltip,{tooltipClassName:V.tooltip,message:"Save changes",children:e.jsx(r.Icon,{name:"success-grey",className:"u-no-margin--left u-no-margin--right"})})}),e.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>{a.resetForm()},"aria-label":`Cancel editing ${t.package} constraint`,children:e.jsx(r.Tooltip,{tooltipClassName:V.tooltip,message:"Cancel",children:e.jsx(r.Icon,{name:"error-grey",className:"u-no-margin--left u-no-margin--right"})})})]}):e.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>a.setValues(t),disabled:a.values.id!==0,"aria-label":`Edit ${t.package} constraint`,children:e.jsx(r.Tooltip,{tooltipClassName:V.tooltip,message:"Edit constraint",children:e.jsx(r.Icon,{name:"edit",className:"u-no-margin--left u-no-margin--right"})})}),Le="_actionsCell_1kvjf_1",Ge="_noPadding_1kvjf_7",He="_cell_1kvjf_11",Me="_input_1kvjf_23",Qe="_inputWrapper_1kvjf_31",We="_hidden_1kvjf_37",f={actionsCell:Le,noPadding:Ge,cell:He,input:Me,inputWrapper:Qe,hidden:We},qe=async(t,a,s)=>{await t.setFieldValue(`${a}`,s),await t.setFieldTouched(`${a}`,!0),["rule","version"].includes(`${a}`)&&(s!==""?await t.setFieldValue("notAnyVersion",!0):t.values[a==="rule"?"version":"rule"]===""&&await t.setFieldValue("notAnyVersion",!1))},ze=(t,a)=>{if(!(!t.touched[a]||!t.errors[a]))return t.errors[a]},Ue=t=>({handleConstraintPropChange:(a,s)=>qe(t,a,s),getConstraintPropError:a=>ze(t,a)}),Ye=({column:t,row:a},s)=>{const n={};return n.className=q(f.cell,{[f.noPadding]:a.original.id===s}),a.original.package==="loading"?t.id==="package"?n.colSpan=5:(n.className=f.hidden,n["aria-hidden"]=!0):t.id==="package"?n.role="rowheader":t.id==="actions"?n["aria-label"]="Actions":t.id==="constraint"?n["aria-label"]="Constraint":t.id==="version"?n["aria-label"]="Version":t.id==="rule"&&(n["aria-label"]="Rule"),n},Ke=(t,a)=>{let s="No constraints found";return t&&(s+=` with the constraint type: "${t}"`,a&&(s+=" and")),a&&(s+=` with the search: "${a}"`),s},Ze=({filter:t,formik:a,isConstraintsLoading:s,onSelectedIdsChange:n,pageSize:i,profileConstraints:l,search:m,selectedIds:c})=>{const u=x.useMemo(()=>{if(s)return[U];if(!l)return[];const o=l.map(P=>({...P,notAnyVersion:!!P.version}));return a.values.id!==-1?o:[a.values,...o].slice(0,i)},[s,l,a.values,i]),g=()=>{n(c.length?[]:u.map(({id:o})=>o))},C=o=>{c.includes(o)?n(c.filter(P=>P!==o)):n([...c,o])},{handleConstraintPropChange:d,getConstraintPropError:h}=Ue(a),p=x.useMemo(()=>[{accessor:"constraint",Header:()=>e.jsxs(e.Fragment,{children:[e.jsx(r.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all constraints"}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0||u.length===0,checked:u.length>0&&u.length===c.length,indeterminate:c.length>0&&c.length<u.length,onChange:g}),e.jsx("span",{children:"Constraint"})]}),Cell:({row:{original:o}})=>a.values.id===o.id?e.jsx(r.Select,{label:"Constraint",labelClassName:"u-off-screen",className:f.input,wrapperClassName:f.inputWrapper,options:W,...a.getFieldProps("constraint"),onChange:P=>d("constraint",P.target.value),error:h("constraint")}):e.jsxs("div",{children:[e.jsx(r.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${o.package} constraint`}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0,checked:c.includes(o.id),onChange:()=>{C(o.id)}}),e.jsx("span",{children:o.constraint})]})},{accessor:"package",Header:"Package",Cell:({row:{original:o}})=>a.values.id===o.id?e.jsx(R,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:f.input,wrapperClassName:f.inputWrapper,...a.getFieldProps("package"),onChange:P=>d("package",P),error:h("package")}):o.package!=="loading"?e.jsx(e.Fragment,{children:o.package}):e.jsx(D,{})},{accessor:"rule",Header:"Rule",Cell:({row:{original:o}})=>a.values.id===o.id?e.jsx(r.Select,{label:"Rule",labelClassName:"u-off-screen",className:f.input,wrapperClassName:f.inputWrapper,options:E,...a.getFieldProps("rule"),onChange:P=>d("rule",P.target.value),error:h("rule")}):e.jsx(e.Fragment,{children:E.find(({value:P})=>P===o.rule)?.label??o.rule})},{accessor:"version",Header:"Version",Cell:({row:{original:o}})=>a.values.id===o.id?e.jsx(R,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:f.input,wrapperClassName:f.inputWrapper,...a.getFieldProps("version"),onChange:P=>d("version",P),error:h("version")}):e.jsx(e.Fragment,{children:o.version})},{accessor:"actions",className:f.actionsCell,Cell:({row:{original:o}})=>e.jsx(Oe,{constraint:o,formik:a})}],[u,c.length,a.errors,a.touched]);return e.jsx(r.ModularTable,{columns:p,data:u,getCellProps:o=>Ye(o,a.values.id),className:"u-no-margin--bottom",emptyMsg:Ke(t,m)})},Je="_pagination_15tqa_1",Xe={pagination:Je},et=({profile:t})=>{const[a,s]=x.useState([]),[n,i]=x.useState(1),[l,m]=x.useState(A),[c,u]=x.useState(""),[g,C]=x.useState(""),d=_=>{s([]),i(_)},h=_=>{s([]),m(_)},p=k(),{notify:o}=T(),{editPackageProfileConstraintQuery:P,getPackageProfileConstraintsQuery:w}=F(),{mutateAsync:G}=P,H=I({initialValues:de,onSubmit:async(_,{resetForm:X})=>{try{await G({constraint:_.constraint,id:_.id,package:_.package,rule:_.rule,version:_.version,name:t.name}),o.success({message:`"${t.title}" package profile's constraint updated successfully`,title:"Package profile constraint updated"}),X()}catch(ee){p(ee)}},validationSchema:ue}),{data:B,isLoading:M}=w({constraint_type:g||void 0,limit:l,name:t.name,offset:(n-1)*l,search:c});return e.jsxs(e.Fragment,{children:[!c&&!g&&n===1&&l===A&&M&&e.jsx(D,{}),(c||g||n!==1||l!==A||!M&&B&&B.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{actions:e.jsx(Ee,{filter:g,formik:H,onFilterChange:C,profile:t,selectedIds:a,setSelectedIds:s}),onSearch:u,disabled:H.values.id!==0}),e.jsx(Ze,{filter:g,formik:H,isConstraintsLoading:M,onSelectedIdsChange:s,pageSize:l,profileConstraints:B?.data.results,search:c,selectedIds:a}),e.jsx(K,{currentPage:n,pageSize:l,paginate:d,setPageSize:h,totalItems:B?.data.count,className:Xe.pagination})]})]})},Kt=()=>{const{packageProfile:t,isGettingPackageProfile:a}=$();return a?e.jsx(b.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(b.Header,{children:['Change "',t.title,`" profile's constraints`]}),e.jsx(b.Content,{children:e.jsx(et,{profile:t})})]})},tt="_constraint_1lz67_1",at="_hidden_1lz67_5",J={constraint:tt,hidden:at},st=({row:t,column:a})=>{const s={};return t.original.package==="loading"?a.id==="package"?s.colSpan=3:(s.className=J.hidden,s["aria-hidden"]=!0):a.id==="package"?s.role="rowheader":a.id==="constraint"?s["aria-label"]="Constraint":a.id==="rule"?s["aria-label"]="Rule":a.id==="version"&&(s["aria-label"]="Version"),s},nt=({isConstraintsLoading:t,profileConstraints:a,search:s})=>{const n=x.useMemo(()=>t?[U]:a?a.map(l=>({...l,notAnyVersion:!!l.version})):[],[t,a]),i=x.useMemo(()=>[{accessor:"constraint",className:J.constraint,Header:"Constraint",Cell:({row:{original:l}})=>W.find(({value:m})=>m===l.constraint)?.label??l.constraint},{accessor:"package",Header:"Package",Cell:({row:{original:l}})=>l.package==="loading"?e.jsx(D,{}):l.package},{accessor:"version",Header:"Version",Cell:({row:{original:l}})=>l.version?`${E.find(({value:m})=>m===l.rule)?.label} ${l.version}`:"Any"}],[n]);return e.jsx(r.ModularTable,{columns:i,data:n,getCellProps:st,emptyMsg:`No constraints found with the search: "${s}"`})},ot="_actions_nxngq_1",rt={actions:ot},it=({profile:t})=>{const[a,s]=x.useState(1),[n,i]=x.useState(A),[l,m]=x.useState(""),{createSidePathPusher:c}=N(),{getPackageProfileConstraintsQuery:u}=F(),{data:g,isLoading:C}=u({name:t.name,limit:n,offset:(a-1)*n,search:l}),d=c("edit-constraints");return e.jsxs(e.Fragment,{children:[!l&&a===1&&n===A&&C&&e.jsx(D,{}),(l||a!==1||n!==A||!C&&g&&g.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:rt.actions,onSearch:m,actions:e.jsx(r.Button,{className:"u-no-margin--bottom",type:"button",onClick:d,children:"Change package constraints"})}),e.jsx(nt,{isConstraintsLoading:C,profileConstraints:g?.data.results,search:l}),e.jsx(K,{currentPage:a,pageSize:n,paginate:s,setPageSize:i,totalItems:g?.data.count})]})]})},Zt=()=>{const{createSidePathPusher:t}=N(),{getAccessGroupQuery:a}=L(),{data:s,isPending:n}=a(),{packageProfile:i,isGettingPackageProfile:l}=$(),{value:m,setTrue:c,setFalse:u}=se();if(l||n)return e.jsx(b.LoadingState,{});const g=t("edit"),C=t("duplicate");return e.jsxs(e.Fragment,{children:[e.jsx(b.Header,{children:i.title}),e.jsxs(b.Content,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(r.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button u-no-margin",onClick:C,children:[e.jsx(r.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate profile"})]}),e.jsxs(r.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button u-no-margin",onClick:g,children:[e.jsx(r.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(r.Button,{className:"p-segmented-control__button u-no-margin",hasIcon:!0,type:"button",onClick:c,"aria-label":`Remove ${i.title} package profile`,children:[e.jsx(r.Icon,{name:r.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(v,{spaced:!0,children:[e.jsx(v.Item,{label:"Title",value:i.title}),e.jsx(v.Item,{label:"Name",value:i.name}),e.jsx(v.Item,{label:"Description",value:i.description}),e.jsx(v.Item,{label:"Access group",value:ne(i.access_group,s)}),e.jsx(v.Item,{label:"Tags",large:!0,value:i.tags.join(", "),type:"truncated"}),e.jsx(v.Item,{label:"Associated to",value:e.jsx(Ce,{profile:i,count:i.computers.constrained.length,query:`package:${i.id}`})}),e.jsx(v.Item,{label:"Pending on",value:`${i.computers.pending?.length??0} ${y(i.computers.pending.length,"instance")}`}),e.jsx(v.Item,{label:"Not compliant on",value:`${i.computers["non-compliant"].length} ${y(i.computers["non-compliant"].length,"instance")}`})]}),e.jsx(it,{profile:i})]}),e.jsx(pe,{close:u,isOpen:m,packageProfile:i})]})},lt=({profile:t})=>{const a=k(),{sidePath:s,popSidePath:n,createPageParamsSetter:i}=N(),{notify:l}=T(),{getAccessGroupQuery:m}=L(),{copyPackageProfileQuery:c}=F(),{mutateAsync:u}=c,{data:g}=m(),C=g?.data.map(({name:o,title:P})=>({label:P,value:o}))??[],d=i({sidePath:[],profile:""}),h=async o=>{const P={all_computers:o.all_computers,access_group:o.access_group,copy_from:t.name,description:o.description,title:o.title};!o.all_computers&&o.tags.length>0&&(P.tags=o.tags);try{await u(P),d(),l.success({message:`Profile "${t.title}" duplicated successfully`,title:"Profile duplicated"})}catch(w){a(w)}},p=I({initialValues:{access_group:t.access_group,all_computers:t.all_computers,description:t.description,tags:t.tags,title:`${t.title} (copy)`},onSubmit:h,validationSchema:ge});return e.jsxs(r.Form,{onSubmit:p.handleSubmit,noValidate:!0,children:[e.jsx(r.Input,{type:"text",label:"Title",required:!0,...p.getFieldProps("title"),error:j(p,"title")}),e.jsx(r.Input,{type:"text",label:"Description",required:!0,autoComplete:"off",...p.getFieldProps("description"),error:j(p,"description")}),e.jsx(r.Select,{label:"Access group",...p.getFieldProps("access_group"),options:C,error:j(p,"access_group")}),e.jsx(Q,{formik:p}),e.jsx(O,{submitButtonLoading:p.isSubmitting,submitButtonText:"Duplicate",hasBackButton:s.length>1,onBackButtonPress:n,onCancel:d})]})},Jt=()=>{const{packageProfile:t,isGettingPackageProfile:a}=$();return a?e.jsx(b.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(b.Header,{children:["Duplicate ",t.title]}),e.jsx(b.Content,{children:e.jsx(lt,{profile:t})})]})},ct=({profile:t})=>{const a=k(),{sidePath:s,popSidePath:n,createPageParamsSetter:i}=N(),{notify:l}=T(),{editPackageProfileQuery:m}=F(),{getAccessGroupQuery:c}=L(),{data:u}=c(),{mutateAsync:g}=m,C=u?.data.map(({name:o,title:P})=>({label:P,value:o}))??[],d=i({sidePath:[],profile:""}),h=async o=>{try{await g({...o,name:t.name,tags:o.all_computers?[]:o.tags}),d(),l.success({message:`Package profile "${t.title}" updated successfully`,title:"Package profile updated"})}catch(P){a(P)}},p=I({enableReinitialize:!0,initialValues:{all_computers:t.all_computers,description:t.description,tags:t.tags,title:t.title},onSubmit:h,validationSchema:me});return e.jsxs(r.Form,{onSubmit:p.handleSubmit,noValidate:!0,children:[e.jsx(r.Input,{type:"text",label:"Title",...p.getFieldProps("title"),error:j(p,"title")}),e.jsx(r.Input,{type:"text",label:"Description",...p.getFieldProps("description")}),e.jsx(r.Select,{label:"Access group",disabled:!0,options:C,value:t.access_group}),e.jsx(Q,{formik:p}),e.jsx(O,{submitButtonLoading:p.isSubmitting,submitButtonText:"Save changes",hasBackButton:s.length>1,onBackButtonPress:n,onCancel:d})]})},Xt=()=>{const{packageProfile:t,isGettingPackageProfile:a}=$();return a?e.jsx(b.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(b.Header,{children:["Edit ",t.title]}),e.jsx(b.Content,{children:e.jsx(ct,{profile:t})})]})};export{Ut as PackageProfileAddSidePanel,Yt as PackageProfileConstraintsAddSidePanel,Kt as PackageProfileConstraintsEditSidePanel,Zt as PackageProfileDetailsSidePanel,Jt as PackageProfileDuplicateSidePanel,Xt as PackageProfileEditSidePanel,aa as PackageProfileHeader,sa as PackageProfileList,na as PackageProfilesEmptyState,F as usePackageProfiles};
