import{l as b,j as e,d as i,o as A,p as k,k as _,q as $,a7 as f,s as T,b as te,i as ae,a$ as se,C as y,F as q,A as D,Z as ne,K as S}from"./index-B0Zx-d4a.js";import{A as G}from"./AssociationBlock-q8-uW6px.js";import{S as O}from"./SidePanelFormButtons-B518jwsU.js";import{u as Q}from"./useRoles-D5H1buJm.js";import{T as oe,C as W,a as R,E as z,u as N,V as re,I as ie,b as le,L as U,c as ce,d as ue,P as de,e as pe,f as ge,g as me}from"./index-B0tKnJp7.js";import{h as Bt,i as Vt,j as Et}from"./index-B0tKnJp7.js";import{F as he}from"./FileInput-BcaHzQiZ.js";import{u as Pe}from"./useGetInstances-5C2eNSck.js";import{H as Y}from"./HeaderWithSearch-BW6fwKv2.js";import{S as K}from"./SidePanelTablePagination-yaMUC4SJ.js";import{T as Ce}from"./TextConfirmationModal-DIQoKyOA.js";import"./MultiSelectField-BSnJnouo.js";import"./useGetTags-CifF6Ag6.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";import"./PageMain-CsA-pIun.js";import"./constants-T53-DHYK.js";import"./constants-BANM6X8z.js";const L=({onChange:t,value:a,...s})=>{const[n,u]=b.useState(a);return e.jsx(i.Input,{type:"text",autoComplete:"off",...s,value:n,onChange:l=>u(l.target.value),onBlur:()=>t(n)})},be="_action_w93bw_1",fe="_cell_w93bw_7",xe="_input_w93bw_18",je="_inputWrapper_w93bw_26",j={action:be,cell:fe,input:xe,inputWrapper:je},ye=async(t,a,s,n)=>{await t.setFieldValue(`constraints[${a}]${[s]}`,n),await t.setFieldTouched(`constraints[${a}]${[s]}`,!0),["rule","version"].includes(s)&&(n!==""?await t.setFieldValue(`constraints[${a}].notAnyVersion`,!0):t.values.constraints[a][s==="rule"?"version":"rule"]===""&&await t.setFieldValue(`constraints[${a}].notAnyVersion`,!1))},ve=(t,a,s)=>{if(!t.errors.constraints?.[a]||!t.touched.constraints?.[a]?.[s])return;const n=t.errors.constraints[a];return typeof n!="string"?n[s]:void 0},Se=async(t,a)=>{await t.setFieldValue("constraints",t.values.constraints.filter((s,n)=>n!==a)),t.touched.constraints&&(t.touched.constraints.splice(a,1),await t.setTouched({...t.touched,constraints:t.touched.constraints}))},_e=t=>({handleConstraintPropChange:async(a,s,n)=>{await ye(t,a,s,n)},handleConstraintRowDelete:async a=>{await Se(t,a)},getConstraintsErrorByIndex:(a,s)=>ve(t,a,s)}),Ne=({column:t})=>{const a={};return a.className=j.cell,t.id==="package_name"?a.role="rowheader":t.id==="action"?a["aria-label"]="Action":t.id==="constraint"?a["aria-label"]="Constraint":t.id==="version"?a["aria-label"]="Version":t.id==="rule"&&(a["aria-label"]="Rule"),a},Z=({formik:t})=>{b.useEffect(()=>{t.submitCount!==0&&(async()=>await t.setTouched({...t.touched,constraints:new Array(t.values.constraints.length).fill(oe)}))()},[t.submitCount]);const a=b.useMemo(()=>t.values.constraints,[t.values.constraints]),{handleConstraintPropChange:s,handleConstraintRowDelete:n,getConstraintsErrorByIndex:u}=_e(t),l=b.useMemo(()=>[{accessor:"constraint",Header:"Constraint",Cell:({row:{index:c}})=>e.jsx(i.Select,{label:"Constraint",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,options:W,...t.getFieldProps(`constraints[${c}].constraint`),onChange:o=>s(c,"constraint",o.target.value),error:u(c,"constraint")})},{accessor:"package",Header:"Package",Cell:({row:{index:c}})=>e.jsx(L,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,...t.getFieldProps(`constraints[${c}].package`),onChange:o=>s(c,"package",o),error:u(c,"package")})},{accessor:"rule",Header:"Rule",Cell:({row:{index:c}})=>e.jsx(i.Select,{label:"Rule",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,...t.getFieldProps(`constraints[${c}].rule`),options:R,onChange:o=>s(c,"rule",o.target.value),error:u(c,"rule")})},{accessor:"version",Header:"Version",Cell:({row:{index:c}})=>e.jsx(L,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,...t.getFieldProps(`constraints[${c}].version`),onChange:o=>s(c,"version",o),error:u(c,"version")})},{accessor:"action",className:j.action,Cell:({row:c})=>e.jsx(i.Button,{type:"button",hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding","aria-label":"Delete constraint row",onClick:()=>n(c.index),children:e.jsx(i.Icon,{name:i.ICONS.delete,className:"u-no-margin--left u-no-margin--right"})})}],[a,t.errors.constraints,t.touched.constraints]),m=async()=>{if(await t.setFieldValue("constraints",[z,...t.values.constraints]),t.touched.constraints){const c=[];for(let o=t.values.constraints.length;o>0;o--)t.touched.constraints[o-1]&&(c[o]=t.touched.constraints[o-1]);await t.setTouched({constraints:c})}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"u-align-text--right",children:e.jsxs(i.Button,{type:"button",hasIcon:!0,onClick:m,children:[e.jsx(i.Icon,{name:i.ICONS.plus,className:"u-no-margin--left"}),e.jsx("span",{children:"Add new constraint"})]})}),e.jsx(i.ModularTable,{columns:l,data:a,getCellProps:Ne,emptyMsg:"No constraints added yet.",className:"u-no-margin--bottom"}),t.touched.constraints&&typeof t.errors.constraints=="string"&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:"p-form-validation__message u-no-margin--top",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:t.errors.constraints})]})})]})},Fe=[{label:"Select constraints type",value:""},{label:"From an instance's packages",value:"instance"},{label:"From a CSV file",value:"material"},{label:"Enter manually",value:"manual"}],Te="_container_vi1gw_1",Ae={container:Te},ke=({formik:t})=>{const{instances:a}=Pe(),s=a.map(({id:l,title:m})=>({label:m,value:`${l}`}))??[];s.unshift({label:"Select instance",value:""});const n=async l=>{await t.setFieldValue("csvFile",l[0]);const m=await l[0].text();await t.setFieldValue("material",m)},u=async()=>{await t.setFieldValue("csvFile",null),await t.setFieldValue("material",""),await t.setFieldValue("isCsvFileParsed",!1)};return e.jsxs("div",{className:Ae.container,children:[e.jsx(i.Select,{label:"Package constraints",required:!0,options:Fe,...t.getFieldProps("constraintsType"),error:t.touched.constraintsType&&t.errors.constraintsType?t.errors.constraintsType:void 0}),t.values.constraintsType==="instance"&&e.jsx(i.Select,{label:"Instance",required:t.values.constraintsType==="instance",options:s,...t.getFieldProps("source_computer_id"),error:t.touched.source_computer_id&&t.errors.source_computer_id?t.errors.source_computer_id:void 0}),t.values.constraintsType==="material"&&e.jsx(he,{label:"Upload constraints",accept:".csv",...t.getFieldProps("csvFile"),onFileRemove:u,onFileUpload:n,help:'File should be formatted as either a package profile CSV file or the output of running "dpkg --get-selections" on a computer with desired packages installed.',error:t.touched.csvFile&&t.errors.csvFile||t.touched.material&&t.errors.material||void 0}),t.values.constraintsType==="manual"&&e.jsx(Z,{formik:t})]})},Nt=()=>{const t=A(),{notify:a}=k(),{setPageParams:s}=_(),{getAccessGroupQuery:n}=Q(),{createPackageProfileQuery:u}=N(),{data:l,isPending:m}=n(),c=l?.data.map(({name:g,title:h})=>({label:h,value:g}))??[],{mutateAsync:o}=u,p=()=>{s({sidePath:[],profile:""})},d=$({initialValues:ie,onSubmit:async g=>{const h={access_group:g.access_group,description:g.description,title:g.title};g.all_computers?h.all_computers=!0:g.tags.length>0&&(h.tags=g.tags),g.constraintsType==="material"?h.material=g.material:g.constraintsType==="instance"?h.source_computer_id=g.source_computer_id:h.constraints=g.constraints.map(({constraint:r,package:C,rule:F,version:w})=>({constraint:r,package:C,rule:F,version:w}));try{await o(h),p(),a.success({message:`Profile "${g.title}" added successfully`,title:"Profile added"})}catch(r){t(r)}},validationSchema:re,validateOnMount:!0});return m?e.jsx(f.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsx(f.Header,{children:"Add package profile"}),e.jsx(f.Content,{children:e.jsxs(i.Form,{onSubmit:d.handleSubmit,noValidate:!0,children:[e.jsx(i.Input,{type:"text",label:"Title",required:!0,...d.getFieldProps("title"),error:T(d,"title")}),e.jsx(i.Input,{type:"text",label:"Description",required:!0,autoComplete:"off",...d.getFieldProps("description"),error:T(d,"description")}),e.jsx(i.Select,{label:"Access group",...d.getFieldProps("access_group"),options:c,error:T(d,"access_group")}),e.jsx(G,{formik:d}),e.jsx(ke,{formik:d}),e.jsx(O,{submitButtonDisabled:!d.isValid,submitButtonLoading:d.isSubmitting,submitButtonText:"Add package profile",onCancel:p})]})})]})},we=t=>{const a=te(),{data:s,isPending:n,error:u}=ae({queryKey:["packageProfile",t],queryFn:async({signal:m})=>a.get("packageprofiles",{params:{names:[t]},signal:m})}),l=s?.data.result[0];return{packageProfile:l,packageProfileError:s&&!l?new Error("The package profile could not be found."):u,isGettingPackageProfile:n}},I=()=>{const{profile:t}=_(),{packageProfile:a,isGettingPackageProfile:s,packageProfileError:n}=we(t);if(n)throw n;return s?{packageProfile:void 0,isGettingPackageProfile:!0}:{packageProfile:a,isGettingPackageProfile:!1}},$e=({profile:t})=>{const a=b.useContext(se),s=A(),{notify:n}=k(),{sidePath:u,popSidePath:l}=_(),{addPackageProfileConstraintsQuery:m}=N(),{mutateAsync:c}=m,p=$({initialValues:{constraints:[z]},onSubmit:async({constraints:P})=>{try{await c({name:t.name,constraints:P.map(({constraint:d,package:g,rule:h,version:r})=>({constraint:d,package:g,rule:h,version:r}))}),l(),n.success({message:`${P.length} package profile ${y(P.length,"constraint")}  added successfully`,title:"Package profile constraints added"})}catch(d){s(d)}},validationSchema:le,validateOnMount:!0});return e.jsxs(i.Form,{onSubmit:p.handleSubmit,noValidate:!0,children:[e.jsx(Z,{formik:p}),e.jsx(O,{submitButtonDisabled:!p.isValid||p.isValidating,submitButtonLoading:p.isSubmitting,submitButtonText:`Add ${y(p.values.constraints.length,"constraint")}`,submitButtonAriaLabel:`Add ${y(p.values.constraints.length,"constraint")} to "${t.title}" profile`,cancelButtonDisabled:p.isSubmitting,hasBackButton:u.length>1,onBackButtonPress:l,onCancel:a})]})},Ft=()=>{const{packageProfile:t,isGettingPackageProfile:a}=I();return a?e.jsx(f.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(f.Header,{children:['Add package constraints to "',t.title,'" profile']}),e.jsx(f.Content,{children:e.jsx($e,{profile:t})})]})},Ie=[{label:"All",value:""},{label:"Conflicts",value:"conflicts"},{label:"Depends",value:"depends"}],Be="_container_scrq4_1",Ve={container:Be},Ee=({filter:t,formik:a,onFilterChange:s,profile:n,selectedIds:u,setSelectedIds:l})=>{const m=A(),{notify:c}=k(),{pushSidePath:o}=_(),{removePackageProfileConstraintsQuery:p}=N(),{mutateAsync:P,isPending:d}=p,g=async()=>{try{await P({constraint_ids:u,name:n.name}),l([]),c.success({message:`${u.length} "${n.title}" profile's ${y(u.length,"constraint")} removed successfully`,title:`Package profile ${y(u.length,"constraint")} removed`})}catch(r){m(r)}},h=()=>{o("add-constraints")};return e.jsxs("div",{className:Ve.container,children:[e.jsx(i.Select,{label:"Constraint type",className:"u-no-margin--bottom",labelClassName:"u-no-padding--top",options:Ie,value:t,onChange:r=>{s(r.target.value)}}),e.jsxs(i.ConfirmationButton,{className:"has-icon u-no-margin--right u-no-margin--bottom",type:"button",disabled:u.length===0||a.values.id!==0,"aria-label":`Remove selected ${y(u.length,"constraint")}`,confirmationModalProps:{title:`Remove ${y(u.length,"constraint")}`,children:e.jsxs("p",{children:["This will remove ",u.length," ",y(u.length,"constraint"),"."]}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:g},children:[e.jsx(i.Icon,{name:i.ICONS.delete}),e.jsx("span",{children:"Remove"})]}),e.jsxs(i.Button,{className:"u-no-margin--bottom",type:"button",hasIcon:!0,onClick:h,"aria-label":"Add new constraint",children:[e.jsx(i.Icon,{name:i.ICONS.plus}),e.jsx("span",{children:"Add constraints"})]})]})},Re="_actionButton_1mrgm_1",Le="_tooltip_1mrgm_5",E={actionButton:Re,tooltip:Le},De=({constraint:t,formik:a})=>a.values.id===t.id?e.jsxs(e.Fragment,{children:[e.jsx(i.Button,{type:"button",appearance:"base",hasIcon:!0,className:q("u-no-margin--bottom u-no-padding",E.actionButton),onClick:()=>{a.handleSubmit()},"aria-label":`Save changes to ${t.package} constraint`,children:e.jsx(i.Tooltip,{tooltipClassName:E.tooltip,message:"Save changes",children:e.jsx(i.Icon,{name:"success-grey",className:"u-no-margin--left u-no-margin--right"})})}),e.jsx(i.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>{a.resetForm()},"aria-label":`Cancel editing ${t.package} constraint`,children:e.jsx(i.Tooltip,{tooltipClassName:E.tooltip,message:"Cancel",children:e.jsx(i.Icon,{name:"error-grey",className:"u-no-margin--left u-no-margin--right"})})})]}):e.jsx(i.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>a.setValues(t),disabled:a.values.id!==0,"aria-label":`Edit ${t.package} constraint`,children:e.jsx(i.Tooltip,{tooltipClassName:E.tooltip,message:"Edit constraint",children:e.jsx(i.Icon,{name:"edit",className:"u-no-margin--left u-no-margin--right"})})}),Oe="_actionsCell_1kvjf_1",He="_noPadding_1kvjf_7",Me="_cell_1kvjf_11",Ge="_input_1kvjf_23",Qe="_inputWrapper_1kvjf_31",We="_hidden_1kvjf_37",x={actionsCell:Oe,noPadding:He,cell:Me,input:Ge,inputWrapper:Qe,hidden:We},qe=async(t,a,s)=>{await t.setFieldValue(`${a}`,s),await t.setFieldTouched(`${a}`,!0),["rule","version"].includes(`${a}`)&&(s!==""?await t.setFieldValue("notAnyVersion",!0):t.values[a==="rule"?"version":"rule"]===""&&await t.setFieldValue("notAnyVersion",!1))},ze=(t,a)=>{if(!(!t.touched[a]||!t.errors[a]))return t.errors[a]},Ue=t=>({handleConstraintPropChange:(a,s)=>qe(t,a,s),getConstraintPropError:a=>ze(t,a)}),Ye=({column:t,row:a},s)=>{const n={};return n.className=q(x.cell,{[x.noPadding]:a.original.id===s}),a.original.package==="loading"?t.id==="package"?n.colSpan=5:(n.className=x.hidden,n["aria-hidden"]=!0):t.id==="package"?n.role="rowheader":t.id==="actions"?n["aria-label"]="Actions":t.id==="constraint"?n["aria-label"]="Constraint":t.id==="version"?n["aria-label"]="Version":t.id==="rule"&&(n["aria-label"]="Rule"),n},Ke=(t,a)=>{let s="No constraints found";return t&&(s+=` with the constraint type: "${t}"`,a&&(s+=" and")),a&&(s+=` with the search: "${a}"`),s},Ze=({filter:t,formik:a,isConstraintsLoading:s,onSelectedIdsChange:n,pageSize:u,profileConstraints:l,search:m,selectedIds:c})=>{const o=b.useMemo(()=>{if(s)return[U];if(!l)return[];const r=l.map(C=>({...C,notAnyVersion:!!C.version}));return a.values.id!==-1?r:[a.values,...r].slice(0,u)},[s,l,a.values,u]),p=()=>{n(c.length?[]:o.map(({id:r})=>r))},P=r=>{c.includes(r)?n(c.filter(C=>C!==r)):n([...c,r])},{handleConstraintPropChange:d,getConstraintPropError:g}=Ue(a),h=b.useMemo(()=>[{accessor:"constraint",Header:()=>e.jsxs(e.Fragment,{children:[e.jsx(i.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all constraints"}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0||o.length===0,checked:o.length>0&&o.length===c.length,indeterminate:c.length>0&&c.length<o.length,onChange:p}),e.jsx("span",{children:"Constraint"})]}),Cell:({row:{original:r}})=>a.values.id===r.id?e.jsx(i.Select,{label:"Constraint",labelClassName:"u-off-screen",className:x.input,wrapperClassName:x.inputWrapper,options:W,...a.getFieldProps("constraint"),onChange:C=>d("constraint",C.target.value),error:g("constraint")}):e.jsxs("div",{className:x.checkboxContainer,children:[e.jsx(i.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${r.package} constraint`}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0,checked:c.includes(r.id),onChange:()=>P(r.id)}),e.jsx("span",{children:r.constraint})]})},{accessor:"package",Header:"Package",Cell:({row:{original:r}})=>a.values.id===r.id?e.jsx(L,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:x.input,wrapperClassName:x.inputWrapper,...a.getFieldProps("package"),onChange:C=>d("package",C),error:g("package")}):r.package!=="loading"?e.jsx(e.Fragment,{children:r.package}):e.jsx(D,{})},{accessor:"rule",Header:"Rule",Cell:({row:{original:r}})=>a.values.id===r.id?e.jsx(i.Select,{label:"Rule",labelClassName:"u-off-screen",className:x.input,wrapperClassName:x.inputWrapper,options:R,...a.getFieldProps("rule"),onChange:C=>d("rule",C.target.value),error:g("rule")}):e.jsx(e.Fragment,{children:R.find(({value:C})=>C===r.rule)?.label??r.rule})},{accessor:"version",Header:"Version",Cell:({row:{original:r}})=>a.values.id===r.id?e.jsx(L,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:x.input,wrapperClassName:x.inputWrapper,...a.getFieldProps("version"),onChange:C=>d("version",C),error:g("version")}):e.jsx(e.Fragment,{children:r.version})},{accessor:"actions",className:x.actionsCell,Cell:({row:{original:r}})=>e.jsx(De,{constraint:r,formik:a})}],[o,c.length,a.errors,a.touched]);return e.jsx(i.ModularTable,{columns:h,data:o,getCellProps:r=>Ye(r,a.values.id),className:"u-no-margin--bottom",emptyMsg:Ke(t,m)})},Je="_pagination_15tqa_1",Xe={pagination:Je},et=({profile:t})=>{const[a,s]=b.useState([]),[n,u]=b.useState(1),[l,m]=b.useState(20),[c,o]=b.useState(""),[p,P]=b.useState(""),d=v=>{s([]),u(v)},g=v=>{s([]),m(v)},h=A(),{notify:r}=k(),{editPackageProfileConstraintQuery:C,getPackageProfileConstraintsQuery:F}=N(),{mutateAsync:w}=C,H=$({initialValues:ue,onSubmit:async(v,{resetForm:X})=>{try{await w({constraint:v.constraint,id:v.id,package:v.package,rule:v.rule,version:v.version,name:t.name}),r.success({message:`"${t.title}" package profile's constraint updated successfully`,title:"Package profile constraint updated"}),X()}catch(ee){h(ee)}},validationSchema:ce}),{data:V,isLoading:M}=F({constraint_type:p||void 0,limit:l,name:t.name,offset:(n-1)*l,search:c});return e.jsxs(e.Fragment,{children:[!c&&!p&&n===1&&l===20&&M&&e.jsx(D,{}),(c||p||n!==1||l!==20||!M&&V&&V.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{actions:e.jsx(Ee,{filter:p,formik:H,onFilterChange:P,profile:t,selectedIds:a,setSelectedIds:s}),onSearch:o,disabled:H.values.id!==0}),e.jsx(Ze,{filter:p,formik:H,isConstraintsLoading:M,onSelectedIdsChange:s,pageSize:l,profileConstraints:V?.data.results,search:c,selectedIds:a}),e.jsx(K,{currentPage:n,pageSize:l,paginate:d,setPageSize:g,totalItems:V?.data.count,className:Xe.pagination})]})]})},Tt=()=>{const{packageProfile:t,isGettingPackageProfile:a}=I();return a?e.jsx(f.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(f.Header,{children:['Change "',t.title,`" profile's constraints`]}),e.jsx(f.Content,{children:e.jsx(et,{profile:t})})]})},tt="_constraint_1lz67_1",at="_hidden_1lz67_5",J={constraint:tt,hidden:at},st=({row:t,column:a})=>{const s={};return t.original.package==="loading"?a.id==="package"?s.colSpan=3:(s.className=J.hidden,s["aria-hidden"]=!0):a.id==="package"?s.role="rowheader":a.id==="constraint"?s["aria-label"]="Constraint":a.id==="rule"?s["aria-label"]="Rule":a.id==="version"&&(s["aria-label"]="Version"),s},nt=({isConstraintsLoading:t,profileConstraints:a,search:s})=>{const n=b.useMemo(()=>t?[U]:a?a.map(l=>({...l,notAnyVersion:!!l.version})):[],[t,a]),u=b.useMemo(()=>[{accessor:"constraint",className:J.constraint,Header:"Constraint",Cell:({row:{original:l}})=>W.find(({value:m})=>m===l.constraint)?.label??l.constraint},{accessor:"package",Header:"Package",Cell:({row:{original:l}})=>l.package==="loading"?e.jsx(D,{}):l.package},{accessor:"version",Header:"Version",Cell:({row:{original:l}})=>l.version?`${R.find(({value:m})=>m===l.rule)?.label} ${l.version}`:"Any"}],[n]);return e.jsx(i.ModularTable,{columns:u,data:n,getCellProps:st,emptyMsg:`No constraints found with the search: "${s}"`})},ot="_actions_nxngq_1",rt={actions:ot},it=({profile:t})=>{const[a,s]=b.useState(1),[n,u]=b.useState(20),[l,m]=b.useState(""),{pushSidePath:c}=_(),{getPackageProfileConstraintsQuery:o}=N(),{data:p,isLoading:P}=o({name:t.name,limit:n,offset:(a-1)*n,search:l}),d=()=>{c("edit-constraints")};return e.jsxs(e.Fragment,{children:[!l&&a===1&&n===20&&P&&e.jsx(D,{}),(l||a!==1||n!==20||!P&&p&&p.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:rt.actions,onSearch:m,actions:e.jsx(i.Button,{className:"u-no-margin--bottom",type:"button",onClick:d,children:"Change package constraints"})}),e.jsx(nt,{isConstraintsLoading:P,profileConstraints:p?.data.results,search:l}),e.jsx(K,{currentPage:a,pageSize:n,paginate:s,setPageSize:u,totalItems:p?.data.count})]})]})},At=()=>{const t=A(),{notify:a}=k(),{pushSidePath:s,setPageParams:n}=_(),{removePackageProfileQuery:u}=N(),{getAccessGroupQuery:l}=Q(),{data:m}=l(),c=m?.data??[],{packageProfile:o,isGettingPackageProfile:p}=I(),{mutateAsync:P,isPending:d}=u,{value:g,setTrue:h,setFalse:r}=ne();if(p)return e.jsx(f.LoadingState,{});const C=async()=>{try{await P({name:o.name}),n({sidePath:[],profile:""}),a.success({message:`Package profile "${o.name}" removed successfully.`,title:"Package profile removed"})}catch(B){t(B)}finally{r()}},F=()=>{s("edit")},w=()=>{s("duplicate")};return e.jsxs(e.Fragment,{children:[e.jsx(f.Header,{children:o.title}),e.jsxs(f.Content,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(i.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button u-no-margin",onClick:w,children:[e.jsx(i.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate profile"})]}),e.jsxs(i.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button u-no-margin",onClick:F,children:[e.jsx(i.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(i.Button,{className:"p-segmented-control__button u-no-margin",hasIcon:!0,type:"button",onClick:h,"aria-label":`Remove ${o.title} package profile`,children:[e.jsx(i.Icon,{name:i.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(S,{spaced:!0,children:[e.jsx(S.Item,{label:"Title",value:o.title}),e.jsx(S.Item,{label:"Name",value:o.name}),e.jsx(S.Item,{label:"Description",value:o.description}),e.jsx(S.Item,{label:"Access group",value:c.find(B=>B.name===o.access_group)?.title??o.access_group}),e.jsx(S.Item,{label:"Tags",large:!0,value:o.tags.join(", ")||null,type:"truncated"}),e.jsx(S.Item,{label:"Associated to",value:e.jsx(de,{packageProfile:o})}),e.jsx(S.Item,{label:"Pending on",value:`${o.computers.pending?.length??0} ${y(o.computers.pending.length,"instance")}`}),e.jsx(S.Item,{label:"Not compliant on",value:`${o.computers["non-compliant"].length} ${y(o.computers["non-compliant"].length,"instance")}`})]}),e.jsx(it,{profile:o})]}),e.jsx(Ce,{isOpen:g,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:d,confirmButtonDisabled:d,close:r,confirmationText:`remove ${o.title}`,onConfirm:C,children:e.jsxs("p",{children:['This will remove "',o.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},lt=({profile:t})=>{const a=A(),{sidePath:s,popSidePath:n,setPageParams:u}=_(),{notify:l}=k(),{getAccessGroupQuery:m}=Q(),{copyPackageProfileQuery:c}=N(),{mutateAsync:o}=c,{data:p}=m(),P=p?.data.map(({name:r,title:C})=>({label:C,value:r}))??[],d=()=>{u({sidePath:[],profile:""})},h=$({initialValues:ge,onSubmit:async r=>{const C={all_computers:r.all_computers,access_group:r.access_group,copy_from:t.name,description:r.description,title:r.title};!r.all_computers&&r.tags.length>0&&(C.tags=r.tags);try{await o(C),d(),l.success({message:`Profile "${t.title}" duplicated successfully`,title:"Profile duplicated"})}catch(F){a(F)}},validationSchema:pe});return b.useEffect(()=>{h.setValues({access_group:t.access_group,all_computers:t.all_computers,description:t.description,tags:t.tags,title:`${t.title} (copy)`})},[t]),e.jsxs(i.Form,{onSubmit:h.handleSubmit,noValidate:!0,children:[e.jsx(i.Input,{type:"text",label:"Title",required:!0,...h.getFieldProps("title"),error:T(h,"title")}),e.jsx(i.Input,{type:"text",label:"Description",required:!0,autoComplete:"off",...h.getFieldProps("description"),error:T(h,"description")}),e.jsx(i.Select,{label:"Access group",...h.getFieldProps("access_group"),options:P,error:T(h,"access_group")}),e.jsx(G,{formik:h}),e.jsx(O,{submitButtonLoading:h.isSubmitting,submitButtonText:"Duplicate",hasBackButton:s.length>1,onBackButtonPress:n,onCancel:d})]})},kt=()=>{const{packageProfile:t,isGettingPackageProfile:a}=I();return a?e.jsx(f.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(f.Header,{children:["Duplicate ",t.title]}),e.jsx(f.Content,{children:e.jsx(lt,{profile:t})})]})},ct=({profile:t})=>{const a=A(),{sidePath:s,popSidePath:n,setPageParams:u}=_(),{notify:l}=k(),{editPackageProfileQuery:m}=N(),{mutateAsync:c}=m,o=()=>{u({sidePath:[],profile:""})},p=async d=>{try{await c({...d,name:t.name,tags:d.all_computers?[]:d.tags}),o(),l.success({message:`Package profile "${t.title}" updated successfully`,title:"Package profile updated"})}catch(g){a(g)}},P=$({enableReinitialize:!0,initialValues:{all_computers:t.all_computers,description:t.description,tags:t.tags,title:t.title},onSubmit:p,validationSchema:me});return e.jsxs(i.Form,{onSubmit:P.handleSubmit,noValidate:!0,children:[e.jsx(i.Input,{type:"text",label:"Title",...P.getFieldProps("title"),error:T(P,"title")}),e.jsx(i.Input,{type:"text",label:"Description",...P.getFieldProps("description")}),e.jsx(G,{formik:P}),e.jsx(O,{submitButtonLoading:P.isSubmitting,submitButtonText:"Save changes",hasBackButton:s.length>1,onBackButtonPress:n,onCancel:o})]})},wt=()=>{const{packageProfile:t,isGettingPackageProfile:a}=I();return a?e.jsx(f.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(f.Header,{children:["Edit ",t.title]}),e.jsx(f.Content,{children:e.jsx(ct,{profile:t})})]})};export{Nt as PackageProfileAddSidePanel,Ft as PackageProfileConstraintsAddSidePanel,Tt as PackageProfileConstraintsEditSidePanel,At as PackageProfileDetailsSidePanel,kt as PackageProfileDuplicateSidePanel,wt as PackageProfileEditSidePanel,Bt as PackageProfileHeader,Vt as PackageProfileList,Et as PackageProfilesEmptyState,N as usePackageProfiles};
