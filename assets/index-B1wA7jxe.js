import{c as A,i as _,k as L,l as N,ac as P,B as D,r as I,j as e,W as x,d as u,p as h,I as C,q as k}from"./index-gkGXmHMG.js";import{P as M,a as q,b as w}from"./PageMain-DCE0dr6h.js";import{d as B,s as g}from"./constants-Ch1f50o8.js";import{u as K}from"./EditUserForm-BT04NUoL.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";function f(){const t=A(),i=_(),l=(n={},c={})=>N({queryKey:["userDetails","getCredentials"],queryFn:async()=>t.get("credentials",{params:n}),...c}),r=L({mutationKey:["userDetails","generate"],mutationFn:async n=>t.post("credentials",n),onSuccess:async()=>i.invalidateQueries({queryKey:["userDetails","getCredentials"]})});return{fetchUserApiCredentials:l,generateApiCredentials:r}}const E="_tableWrapper_13q9l_1",G="_apiCredentials_13q9l_11",j={tableWrapper:E,apiCredentials:G},R=({user:t,credentials:i})=>{const l=P("(min-width: 620px)"),r=D(),{generateApiCredentials:n}=f(),{mutateAsync:c,isPending:o}=n,m=async a=>{try{await c({account:a})}catch(s){r(s)}},y=I.useMemo(()=>[{Header:"Label",accessor:"label"},{Header:"Value",accessor:"value",Cell:({value:a})=>a}],[t,i]);return t.accounts.map(a=>{const s=i.find(p=>p.account_name===a.name),b=[{label:"Name",value:s?.account_name},{label:"Title",value:s?.account_title},{label:"Identity",value:e.jsx("code",{children:t.identity})},{label:"Endpoint",value:e.jsx("code",{children:s?.endpoint})},{label:"Access Key",value:s?.access_key?e.jsx("code",{children:s.access_key}):x},{label:"Secret Key",value:s?.secret_key?e.jsx("code",{children:s.secret_key}):x},{label:"Roles",value:a.roles.join(", ")}],d=s?.secret_key||s?.access_key?"Regenerate":"Generate";return e.jsx("div",{className:B.item,children:e.jsxs("div",{className:g.card,children:[e.jsxs("div",{className:g.header,children:[e.jsx("p",{className:g.title,children:a.title}),e.jsxs(u.ConfirmationButton,{className:h("u-no-margin--bottom",{"is-small":l}),type:"button",confirmationModalProps:{title:`${d} API credentials for ${a.title}`,children:e.jsxs("p",{children:[d==="Regenerate"?`${d.slice(0,-1)}ing your API credentials will make your previously used credentials obsolete and deauthenticate any clients using them. `:"","This action will create new credentials for integrating with the ",a.title," organization"]}),confirmButtonLabel:`${d} API credentials`,confirmButtonDisabled:o,confirmButtonLoading:o,onConfirm:async()=>m(a.name)},children:[d," API credentials"]})]}),e.jsx("div",{className:h(g.content,j.tableWrapper),children:l?e.jsx(u.ModularTable,{columns:y,data:b,emptyMsg:"No data available"}):b.map((p,v)=>e.jsxs(u.Row,{className:h("u-no-padding--left u-no-padding--right",j.apiCredentials),children:[e.jsx(u.Col,{size:2,small:2,children:e.jsx(C,{label:"",value:p.label})}),e.jsx(u.Col,{size:2,small:2,children:e.jsx(C,{label:"",value:p.value})})]},v))})]})},a.title)})},Q=()=>{const{getUserDetails:t}=K(),{fetchUserApiCredentials:i}=f(),{data:l,isLoading:r}=t(),{data:n,isLoading:c}=i(),o=l?.data,m=n?.data?.credentials,y=o&&m,a=r||c;return e.jsxs(M,{children:[e.jsx(q,{title:"API credentials"}),e.jsxs(w,{children:[a&&e.jsx(k,{}),y&&e.jsx(R,{user:o,credentials:m})]})]})};export{Q as default};
