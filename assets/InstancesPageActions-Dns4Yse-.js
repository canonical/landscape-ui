const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-kjPNtJgo.js","assets/index-Dfc97QGW.js","assets/index-CBwtg6kZ.css","assets/useFetchOld-BgGVMMmJ.js","assets/index-DiSNWm9B.js","assets/useRoles-TXLG25Jr.js","assets/NoData-DMN9LLPq.js","assets/index-S_kjB96R.js","assets/ResponsiveTable-ViIMTRR6.js","assets/ResponsiveTable-Czda4kFo.css","assets/TablePagination-B0v8QAQr.js","assets/TableFilterChips-DXWGZ6VK.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-DZURD2KR.css","assets/PageParamFilter-C5PJgjVf.js","assets/TableFilter-BmLRyeMD.js","assets/TableFilter-B85Stwni.css","assets/formikErrors-Bw8iTXYS.js","assets/index-DzMlcK9Q.css","assets/ListTitle-DsIgCqjQ.js","assets/ListTitle-CxCHkD9o.css","assets/StaticLink-BNg3qc2M.js","assets/TruncatedCell-Cf7_euhM.js","assets/Truncated-D8EZCoK1.js","assets/Truncated-uqJp6ujM.css","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-DYtdXwcw.js","assets/TextConfirmationModal-O9rtHEfo.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/InfoGrid-CrJbMYy5.js","assets/InfoItem-DImpX37B.js","assets/InfoItem-D8nPzgUA.css","assets/InfoGrid-D3QqOHFx.css","assets/index-CfXqLKNo.css","assets/index-DPZv1Zf6.js","assets/CodeEditor-HNBBpJH4.js","assets/CodeEditor-KxSGUzo3.css","assets/SidePanelFormButtons-BdOP5SSP.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useInstanceSearchHelpTerms-CQVimD-E.js","assets/index-CrnP6dc4.js","assets/constants-BcfEh3I-.js","assets/useGetInstances-Ccq0NH3v.js","assets/index-fyA16G2D.js","assets/index-Cq7IpJb0.js","assets/ScriptsTabs-BSK7sb4n.js","assets/helpers-BbXQOWxJ.js","assets/constants-BTpoIHxf.js","assets/HeaderWithSearch-cCuZhEhs.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-DvhuGYYD.js","assets/SingleInstanceTabs-S4NROY16.css","assets/ScriptsTabs-DN44MVZt.css","assets/ScriptDropdown-DJ8TKgp3.js","assets/useInfiniteQuery-Dl6Bz4vo.js","assets/downshift.esm-DGSOz4JI.js","assets/ScriptDropdown-rmGnZk9-.css","assets/useRunScript-Yt_xBd8E.js","assets/DeliveryBlock-FX2F7SvQ.js","assets/RadioGroup-DkbRD5zc.js","assets/RadioGroup-WBbAFTwm.css","assets/index-hYwEtP4E.js","assets/ScriptFormAttachments-8WXYDIyH.js","assets/AttachmentFile-DaL_KzgH.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-CIbLM8fR.js","assets/useUsns-DqfdHX4t.js","assets/useUsns-BR-xUdoS.css","assets/index-B0iimqzw.js","assets/index-DzFJsfGG.css","assets/index-CweI51H2.js","assets/index-BU5AeVyY.js","assets/TagsAddConfirmationModal-BowokFtK.js","assets/ModalTablePagination-B1QODcj8.js","assets/ModalTablePagination-HDr0Q-Wm.css","assets/useGetTags-oA_gPXb8.js","assets/index-B_Crukah.js","assets/UbuntuProList-CyUET89S.js","assets/UbuntuProList-D3Pk1SjQ.css"])))=>i.map(i=>d[i]);
import{c as xe,v as F,w as q,aI as ve,y as O,j as e,d,x as T,L as je,I as L,R as ue,r,e as P,$ as k,H as de,s as Ce,o as $,N as te,g as ee,q as Ae,aB as ke,B as G,z as K,p as Ee,i as Se,X as Pe,Y as Te,aS as Re,f as we,E as Le,aT as Ie,G as Ne,u as pe,aU as Oe}from"./index-Dfc97QGW.js";import{u as he}from"./index-S_kjB96R.js";import{u as V}from"./useFetchOld-BgGVMMmJ.js";import{L as ne}from"./ListTitle-DsIgCqjQ.js";import{N}from"./NoData-DMN9LLPq.js";import{R as Ue}from"./ResponsiveTable-ViIMTRR6.js";import{S as De}from"./StaticLink-BNg3qc2M.js";import{T as Be}from"./TruncatedCell-Cf7_euhM.js";import{u as Fe}from"./useExpandableRow-DYtdXwcw.js";import"./index-DiSNWm9B.js";import{T as qe}from"./TextConfirmationModal-O9rtHEfo.js";import"./InfoGrid-CrJbMYy5.js";const Ve=(t,n)=>{const s=V(),{data:a,isPending:o,error:p}=xe({queryKey:["pendingInstances"],queryFn:async()=>s.get("GetPendingComputers"),...n});return{pendingInstances:a?.data??[],isGettingPendingInstances:o,pendingInstancesError:p}},Me=()=>{const t=V(),n=F(),{isPending:s,mutateAsync:a}=q({mutationFn:async o=>t.get("RebootComputers",{params:o}),onSuccess:async()=>n.invalidateQueries({queryKey:["instances"]})});return{restartInstances:a,isRestartingInstances:s}},$e=()=>{const t=V(),n=F(),{isPending:s,mutateAsync:a}=q({mutationFn:async o=>t.get("ShutdownComputers",{params:o}),onSuccess:async()=>n.invalidateQueries({queryKey:["instances"]})});return{shutDownInstances:a,isShuttingDownInstances:s}},He="_listItem_upezw_1",ze="_listItem__link_upezw_9",se={listItem:He,listItem__link:ze},H=t=>ve(R,t)?R[t]:R.Unknown,Ge=t=>{const n=H(t.alert_type),s=t.alert_type in W;return t.alert_type==="UbuntuProContractExpirationAlert"?{contractExpiryDays:n.filterValue}:s?{status:n.filterValue}:{query:n.query}},Ke=r.lazy(()=>k(()=>import("./index-kjPNtJgo.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]))),cn=({alerts:t,pendingInstances:n})=>{const{setSidePanelContent:s}=O(),a=()=>{s("Review Pending Instances",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ke,{instances:n})}),"large")},o=t.map((p,m)=>{const u=H(p.alert_type),h=Ge(p);return e.jsxs("div",{className:se.listItem,children:[e.jsx(d.Icon,{name:`${u.icon.color??u.icon.gray}`}),u.alertType==="PendingComputersAlert"?e.jsxs(d.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding",onClick:a,children:[`${n.length} pending `,T(n.length,"computer needs","computers need")," ","authorization"]}):e.jsx(je,{to:ue.instances.root(h),className:L("u-no-margin u-no-padding",se.listItem__link),children:p.summary})]},u.alertType||m)});return e.jsx(d.List,{items:o})},W={Online:{alertType:"ComputerOnlineAlert",label:"Online instances",alternateLabel:"Online",filterValue:"computer-online",query:"NOT alert:computer-offline",icon:{gray:"connected",color:"connected-color"}},ComputerDuplicateAlert:{alertType:"ComputerDuplicateAlert",label:"Duplicate instances",alternateLabel:"Duplicate",filterValue:"computer-duplicates",query:"alert:computer-duplicates",icon:{gray:"canvas",color:"canvas-color"}},ComputerOfflineAlert:{alertType:"ComputerOfflineAlert",label:"Offline instances",alternateLabel:"Offline",filterValue:"computer-offline",query:"alert:computer-offline",icon:{gray:"disconnect",color:"disconnect-color"}},ComputerRebootAlert:{alertType:"ComputerRebootAlert",label:"Needs reboot",alternateLabel:"Needs reboot",filterValue:"computer-reboot",query:"alert:computer-reboot",icon:{gray:"power-off",color:"power-off-color"}},EsmDisabledAlert:{alertType:"EsmDisabledAlert",label:"ESM disabled",alternateLabel:"ESM updates are disabled",filterValue:"esm-disabled",query:"alert:esm-disabled",icon:{gray:"computer-esm-disabled-alert",color:"computer-esm-disabled-alert-color"}},PackageProfilesAlert:{alertType:"PackageProfilesAlert",label:"Package profile alert",alternateLabel:void 0,filterValue:"package-profiles",query:"alert:package-profiles",icon:{gray:void 0,color:"package-profiles-alert"}},PackageReporterAlert:{alertType:"PackageReporterAlert",label:"Package reporter alert",alternateLabel:void 0,filterValue:"package-reporter",query:"alert:package-reporter",icon:{gray:void 0,color:"package-reporter-alert"}},PackageUpgradesAlert:{alertType:"PackageUpgradesAlert",label:"Package upgrades alert",alternateLabel:"Regular",filterValue:"package-upgrades",query:"alert:package-upgrades",icon:{gray:void 0,color:"regular-upgrades"}},SecurityUpgradesAlert:{alertType:"SecurityUpgradesAlert",label:"Security upgrades alert",alternateLabel:"Security",filterValue:"security-upgrades",query:"alert:security-upgrades",icon:{gray:void 0,color:"security-upgrades"}},UnapprovedActivitiesAlert:{alertType:"UnapprovedActivitiesAlert",label:"Unapproved activities alert",alternateLabel:void 0,filterValue:"unapproved-activities",query:"alert:unapproved-activities",icon:{gray:"status-queued",color:"package-profiles-alert"}},UpToDate:{alertType:"UpToDate",label:"Packages up to date",alternateLabel:"Up to date",filterValue:"up-to-date",query:"NOT alert:package-upgrades",icon:{gray:void 0,color:"up-to-date"}},ChildInstanceProfileAlert:{alertType:"ChildInstanceProfileAlert",label:"WSL profile alert",alternateLabel:"WSL profile alert",filterValue:"child-instance-profiles",query:"alert:child-instance-profiles",icon:{gray:"machines",color:"package-profiles-alert"}}},R={...W,PendingComputersAlert:{alertType:"PendingComputersAlert",label:"Pending acceptance",alternateLabel:"Pending",filterValue:"",query:"",icon:{gray:"pause",color:"pause-color"}},UbuntuProContractExpirationAlert:{alertType:"UbuntuProContractExpirationAlert",label:"Ubuntu Pro contract expiring",alternateLabel:"Ubuntu Pro expiring",filterValue:"90",query:"contract-expires-within-days:90",icon:{gray:void 0,color:"contract-expiration-alert"}},Unknown:{alertType:"",label:"-",alternateLabel:"-",filterValue:"",query:"",icon:{gray:void 0,color:"package-profiles-alert"}}},We={label:"Archived",value:"archived"},un={os:{type:"select",options:[{label:"All",value:"",query:""},{label:"Ubuntu",value:"ubuntu",query:"NOT distribution:windows"},{label:"Windows",value:"windows",query:"distribution:windows"}]},groupBy:{options:[{label:"None",value:""},{label:"Parent",value:"parent"}]},status:{type:"select",options:[{label:"All",value:"",query:""},...Object.values(W).sort((t,n)=>t.label.localeCompare(n.label)).map(({label:t,filterValue:n,query:s})=>({label:t,value:n,query:s})),We]},wsl:{options:[{label:"Parent",value:"parent",query:"wsl:parent"},{label:"Child",value:"child",query:"wsl:child"}]},contractExpiryDays:{type:"select",options:[{label:"All",value:"",query:""},{label:"90 days",value:"90",query:"contract-expires-within-days:90"},{label:"60 days",value:"60",query:"contract-expires-within-days:60"},{label:"30 days",value:"30",query:"contract-expires-within-days:30"},{label:"7 days",value:"7",query:"contract-expires-within-days:7"}]}};function B(t){const n=t.distribution_info?.distributor==="Ubuntu",s=t.distribution_info?.distributor==="Ubuntu Core",a=t.distribution_info?.distributor==="Microsoft",o=!a&&!!t.distribution_info?.distributor;return{employees:n,hardware:o,packages:n,power:o,pro:!(o&&!n&&!s),processes:o,sanitization:o&&!s&&!t.is_wsl_instance,scripts:o,snaps:o,users:o&&!s,uninstallation:t.is_wsl_instance,usg:n,wsl:a}}const ge=t=>!!t?.some(({type:n})=>n==="PackageUpgradesAlert"),me=t=>!!t?.some(({type:n})=>n==="SecurityUpgradesAlert"),Xe=t=>ge(t)||me(t),dn=t=>{const n=["package","reboot","removal","repository"];return t.isScriptProfilesEnabled&&n.push("script"),t.isUsgProfilesEnabled&&n.push("security"),n.push("upgrade"),t.isWslProfilesEnabled&&n.push("wsl"),n},Qe="_rowHeader_5hcyq_5",Ye="_statusListItem_5hcyq_17",Ze="_statusContainer_5hcyq_21",z={rowHeader:Qe,statusListItem:Ye,statusContainer:Ze},Je=t=>t.map(({accessor:n,canBeHidden:s,optionLabel:a})=>({canBeHidden:s,label:a,value:n})),et=({instance:t,selectedInstances:n})=>n.map(({id:a})=>a).includes(t.id)?"checked":"unchecked",tt=({instance:t,selectedInstances:n,setSelectedInstances:s})=>{n.some(({id:a})=>a===t.id)?s(n.filter(({id:a})=>a!==t.id)):s([...n,t])},ae=t=>{if(t.archived)return{icon:"archive",label:"Archived"};const n=(t.alerts??[]).filter(({type:s})=>!["PackageUpgradesAlert","SecurityUpgradesAlert"].includes(s));return n.length===0?{icon:`${R.Online.icon.color}`,label:R.Online.alternateLabel??R.Online.label}:de(n)?{icon:H(n[0].type).icon.color,label:e.jsx(e.Fragment,{children:n[0].summary})}:{label:e.jsx("span",{className:z.statusContainer,children:n.map(({type:s,summary:a})=>{const o=H(s);return e.jsx("span",{className:z.statusListItem,children:e.jsx(d.Tooltip,{message:a,children:e.jsx(d.Icon,{className:"u-no-margin--left",name:o.icon.color??o.icon.gray})})},s)})})}},nt=t=>({regular:ge(t)?{icon:R.PackageUpgradesAlert.icon.color??"",label:R.PackageUpgradesAlert.label}:!1,security:me(t)?{icon:R.SecurityUpgradesAlert.icon.color??"",label:R.SecurityUpgradesAlert.label}:!1}),oe=t=>{if(!B(t).packages)return{icon:"",label:e.jsx(N,{})};const{regular:n,security:s}=nt(t.alerts);return n&&s?{icon:s.icon,label:`${n.label}, ${s.label.toLowerCase()}`}:n?{icon:n.icon,label:n.label}:s?{icon:s.icon,label:s.label}:{icon:R.UpToDate.icon.color,label:R.UpToDate.label}},st=t=>({id:n})=>{const s={};return n==="title"&&(s["aria-labelledby"]=t),s},at=t=>({column:n,row:{index:s}})=>{const a={};switch(n.id){case"title":a.role="rowheader";break;case"status":a["aria-label"]="Status";break;case"upgrades":a["aria-label"]="Upgrades";break;case"os":a["aria-label"]="Operating system";break;case"tags":a["aria-label"]="Tags",t===s&&(a.className="expandedCell");break;case"availability_zone":a["aria-label"]="Availability zone";break;case"ubuntu_pro":a["aria-label"]="Ubuntu Pro expiration date";break;case"last_ping":a["aria-label"]="Last ping";break;case"actions":a["aria-label"]="Actions";break}return a},ot=t=>({index:n,original:s})=>{const a={};return t===n&&(a.className="expandedRow"),a["aria-label"]=`${s.title} instance row`,a},pn=r.memo(function({instances:n,selectedInstances:s,setColumnFilterOptions:a,setSelectedInstances:o}){const{disabledColumns:p,...m}=Ce(),{expandedRowIndex:u,getTableRowsRef:h,handleExpand:f}=Fe(),_=r.useId(),c=Object.values(m).some(i=>typeof i=="string"||Array.isArray(i)?i.length>0:!1),l=()=>{o(s.length!==0?[]:n)},g=r.useMemo(()=>[{accessor:"title",canBeHidden:!1,optionLabel:"Instance name",Header:e.jsxs("div",{className:z.rowHeader,children:[e.jsx(d.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,onChange:l,disabled:n.length===0,checked:s.length===n.length&&n.length!==0,indeterminate:s.length!==0&&s.length<n.length}),e.jsxs(ne,{children:[e.jsx("span",{id:_,children:"Title"}),e.jsx("span",{className:"u-text--muted",children:"Hostname"})]})]}),Cell:({row:i})=>e.jsxs("div",{className:z.rowHeader,children:[e.jsx(d.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:i.original.title}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:et({instance:i.original,selectedInstances:s})==="checked",onChange:()=>{tt({instance:i.original,selectedInstances:s,setSelectedInstances:o})}}),e.jsxs(ne,{children:[e.jsx(De,{to:ue.instances.details.fromInstance(i.original),children:i.original.title}),e.jsx("span",{className:"u-text--muted",children:i.original.hostname||e.jsx(N,{})})]})]})},{accessor:"status",canBeHidden:!0,optionLabel:"Status",Header:"Status",Cell:({row:{original:i}})=>{const{label:b}=ae(i);return b},getCellIcon:({row:{original:i}})=>{const{icon:b}=ae(i);return b}},{accessor:"upgrades",canBeHidden:!0,optionLabel:"Upgrades",Header:"Upgrades",Cell:({row:{original:i}})=>{const{label:b}=oe(i);return b},getCellIcon:({row:{original:i}})=>{const{icon:b}=oe(i);return b}},{accessor:"os",canBeHidden:!0,optionLabel:"OS",Header:"OS",Cell:({row:{original:i}})=>e.jsx(e.Fragment,{children:i.distribution_info?.description??e.jsx(N,{})})},{accessor:"tags",canBeHidden:!0,optionLabel:"Tags",Header:"Tags",Cell:({row:{original:i,index:b}})=>{if(!i.tags.length)return e.jsx(N,{});const E=()=>{f(b)};return e.jsx(Be,{content:i.tags.map(v=>e.jsx("span",{className:"truncatedItem",children:v},v)),isExpanded:b===u,onExpand:E,showCount:!0})}},{accessor:"availability_zone",canBeHidden:!0,optionLabel:"Availability zone",Header:"Availability zone",Cell:({row:{original:i}})=>e.jsx(e.Fragment,{children:i.cloud_init?.availability_zone??e.jsx(N,{})})},{accessor:"ubuntu_pro",canBeHidden:!0,optionLabel:"Ubuntu pro",Header:"Ubuntu pro expiration",className:"date-cell",Cell:({row:i})=>i.original.ubuntu_pro_info?.attached&&$(i.original.ubuntu_pro_info.expires).isValid()?e.jsx("span",{className:"font-monospace",children:$(i.original.ubuntu_pro_info.expires).format(te)}):e.jsx(N,{})},{accessor:"last_ping",canBeHidden:!0,optionLabel:"Last ping",Header:"Last ping time",className:"date-cell",Cell:({row:i})=>e.jsx(e.Fragment,{children:$(i.original.last_ping_time).isValid()?e.jsx("span",{className:"font-monospace",children:$(i.original.last_ping_time).format(te)}):e.jsx(N,{})})}],[s.length,n,u]);r.useEffect(()=>{a(Je(g))},[]);const x=r.useMemo(()=>g.filter(({accessor:i})=>typeof i=="string"&&!p.includes(i)),[p.length,g]);return e.jsx(Ue,{emptyMsg:c?"No instances found according to your search parameters.":"No instances found",ref:h,columns:x,data:n,getHeaderProps:st(_),getRowProps:ot(u),getCellProps:at(u),minWidth:1400})}),rt="_root_1b7s1_1",it="_label_1b7s1_5",lt="_text_1b7s1_15",ct="_icon_1b7s1_19",ut="_content_1b7s1_23",dt="_alignLeft_1b7s1_29",pt="_alignRight_1b7s1_34",ht="_isOpen_1b7s1_39",I={root:rt,label:it,text:lt,icon:ct,content:ut,alignLeft:dt,alignRight:pt,isOpen:ht},gt=({el:t,label:n,disabled:s=!1,onMenuClose:a,className:o,position:p="left"})=>{const{value:m,setFalse:u,toggle:h}=ee(),f=r.useRef(null);Ae(f,u);const _=n||(r.isValidElement(t)&&typeof t.props=="object"&&t.props!==null&&"label"in t.props?t.props.label:null),c=r.isValidElement(t)&&typeof t.props=="object"&&t.props!==null&&t.type!==ke.Fragment?r.cloneElement(t,{inline:!0}):t,g={left:I.alignLeft,center:void 0,right:I.alignRight}[p];return e.jsxs("div",{ref:f,className:L(I.root,g,o),children:[e.jsxs(d.Button,{type:"button",appearance:"base",className:L(I.label,{[I.isOpen]:m}),onClick:h,disabled:s,children:[e.jsx("span",{className:I.text,children:_}),e.jsx(d.Icon,{name:"chevron-down",className:I.icon})]}),m&&e.jsx("div",{className:L(I.content,"p-contextual-menu__dropdown"),onClick:()=>{a&&a()},children:c})]})},mt=()=>{const t=V(),n=F(),{mutateAsync:s,isPending:a}=q({mutationKey:["savedSearches","create"],mutationFn:async o=>t.get("CreateSavedSearch",{params:o}),onSuccess:async()=>n.invalidateQueries({queryKey:["savedSearches"]})});return{createSavedSearch:s,isCreatingSavedSearch:a}},bt=()=>{const t=V(),n=F(),{mutateAsync:s,isPending:a}=q({mutationKey:["savedSearches","edit"],mutationFn:async o=>t.get("EditSavedSearch",{params:o}),onSuccess:async()=>n.invalidateQueries({queryKey:["savedSearches"]})});return{editSavedSearch:s,isEditingSavedSearch:a}},be="medium",yt=r.lazy(async()=>k(()=>import("./index-DPZv1Zf6.js"),__vite__mapDeps([34,1,2,35,4,36,37,38,39,17,40,7,6,8,9,10,11,12,13,3,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]))),hn=({afterCreate:t,appearance:n="secondary",buttonLabel:s="Add saved search",search:a="",className:o,onBackButtonPress:p})=>{const{createSavedSearch:m}=mt(),{notify:u}=G(),h=K(),{setSidePanelContent:f,closeSidePanel:_}=O(),c=!!p,l=async x=>{try{await m({title:x.title,search:x.search}),_(),t&&t(),u.success({title:"Saved search created",message:`The saved search "${x.title}" has been created successfully.`})}catch(i){h(i)}},g=()=>{const x=p&&be;f("Add saved search",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(yt,{mode:"create",initialValues:{title:"",search:a},onSubmit:l,onBackButtonPress:p})}),x)};return e.jsxs(d.Button,{type:"button",appearance:n,onClick:g,className:o,hasIcon:c,children:[c&&e.jsx(d.Icon,{name:"plus"}),e.jsx("span",{children:s})]})},ft=r.lazy(async()=>k(()=>import("./index-DPZv1Zf6.js"),__vite__mapDeps([34,1,2,35,4,36,37,38,39,17,40,7,6,8,9,10,11,12,13,3,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]))),gn=({savedSearch:t,onBackButtonPress:n})=>{const{editSavedSearch:s}=bt(),{notify:a}=G(),o=K(),{setSidePanelContent:p,closeSidePanel:m}=O(),u=async f=>{try{await s({name:t.name,title:t.title,search:f.search}),m(),a.success({title:"Saved search updated",message:`The saved search "${f.title}" has been updated successfully.`})}catch(_){o(_)}},h=()=>{const f=n&&be;p(`Edit "${t.title}" saved search`,e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ft,{mode:"edit",initialValues:{title:t.title,search:t.search},onSubmit:u,onBackButtonPress:n})}),f)};return e.jsx(d.Button,{type:"button",title:"Edit",appearance:"base","aria-label":`Edit ${t.title} saved search`,onClick:h,className:"has-icon u-no-margin--bottom u-no-margin--right",children:e.jsx(d.Icon,{name:"edit"})})},mn=Object.values(W).map(t=>t.filterValue),bn=["tag","distribution","hostname","title","alert","access-group","upgrade-profile","removal-profile","id","mac","ip","needs","license-id","annotation","profile","license-type","contract","contract-expires-within-days","license-expires-within-days","has-pro-management"],yn=["security","wsl","script","repository","package","upgrade","reboot","removal"],fn=["pass","fail","in-progress"],_n=["compliant","noncompliant"],xn=["unlicensed","pro","free_pro","legacy"],vn=["true","false","1","0"],jn=["AND","OR","NOT"],Cn=/^\d+$/,An=/\s$/,kn=/(?:[^\s"]+|"[^"]*")+/g,En=/([^\s]+)$/,Sn=/"/g,Pn=/\s+/,Tn=/\b(AND|NOT)\b/,Rn=/[0-9]+(?=:)/,wn=/[a-zA-Z0-9_-]+(?=:)/,Ln=/".*?"/,In=/[0-9]+/,Nn=/:/,On=Ee().shape({title:Se().required("This field is required.")}),_t="_notification_xylkl_1",xt={notification:_t},vt=r.lazy(async()=>k(()=>import("./index-kjPNtJgo.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]))),Un=()=>{const{setSidePanelContent:t}=O(),{pendingInstances:n}=Ve(),{value:s,setTrue:a}=ee();if(!n.length||s)return null;const o=()=>{t("Review Pending Instances",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(vt,{instances:n})}),"large")};return e.jsxs(d.Notification,{severity:"information",title:"Pending instances",className:xt.notification,onDismiss:a,children:[e.jsx("span",{children:`You currently have ${n.length} pending
          	${T(n.length,"instance")}
          	awaiting your review and approval. `}),e.jsx(d.Button,{type:"button",appearance:"link",onClick:o,children:"Review Pending Instances"})]})},jt=t=>{const n=s=>typeof s=="string"?[s]:Array.isArray(s)?s.flatMap(n):r.isValidElement(s)?n(s.props.children):[];return n(t).join(" ").trim()},Y=(t,n,s)=>{if(r.isValidElement(t)){const a=t;return r.cloneElement(a,{key:a.key??n,className:L(s,a.props.className)})}return t},re=t=>r.isValidElement(t)?(t.type?.displayName||t.type?.name||"").includes("ContextualMenu"):!1,Ct=t=>r.isValidElement(t)?t.props:null,At="_grouped_1pmej_1",kt={grouped:At},Et=({buttons:t,collapseFrom:n="md",alwaysVisible:s=0,menuLabel:a="Actions",className:o,menuPosition:p="right",grouped:m=!0})=>{const u=Pe(`(min-width: ${Te[n]}px)`),{visibleButtons:h,collapsedItems:f}=r.useMemo(()=>{const c=u?t:t.slice(0,s),l=[];return t.slice(u?0:s).forEach((g,x)=>{const i=u?x:x+s;if(re(g)&&!c.includes(g)){const b=Ct(g);if(b){const E=e.jsx(e.Fragment,{children:b.links?.map((v,D)=>typeof v=="string"||Array.isArray(v)?null:e.jsx(d.Button,{type:"button",className:"p-contextual-menu__link",onClick:A=>{v.onClick&&v.onClick(A)},disabled:v.disabled,children:v.children},D))});l.push({key:`contextual-menu-${i}`,label:b.toggleLabel,content:E,disabled:b.toggleDisabled,className:b.className,position:b.position})}return}if(r.isValidElement(g)&&(g.props.onClick||g.props.confirmationModalProps)&&!c.includes(g)){const b=g;l.push({key:`action-${i}`,children:jt(b)||`Action ${i+1}`,onClick:b.props.onClick,disabled:b.props.disabled});return}c.includes(g)||c.push(g)}),{visibleButtons:c,collapsedItems:l}},[t,s,u]),_=m&&h.length>1?e.jsx("div",{className:"p-segmented-control",children:e.jsx("div",{className:"p-segmented-control__list",children:h.map((c,l)=>re(c)?Y(c,l,"u-no-margin--bottom"):Y(c,l,"p-segmented-control__button u-no-margin--bottom"))})}):e.jsx(e.Fragment,{children:h.map((c,l)=>Y(c,l,"u-no-margin--bottom"))});return e.jsxs("div",{className:L(o,{[kt.grouped]:m}),children:[h.length>0&&_,f.length>0&&e.jsx(d.ContextualMenu,{position:p,hasToggleIcon:!0,toggleLabel:a,toggleClassName:"u-no-margin--bottom",children:c=>e.jsx(e.Fragment,{children:f.map(l=>"content"in l&&"label"in l?e.jsx(gt,{el:l.content,label:l.label,disabled:l.disabled,className:l.className,position:l.position,onMenuClose:c},l.key):typeof l!="string"&&"onClick"in l?e.jsx(d.Button,{type:"button",className:"p-contextual-menu__link",onClick:g=>{c(),l.onClick&&l.onClick(g)},disabled:l.disabled,children:l.children},l.key):null)})})]})},St=t=>{const{instanceId:n,childInstanceId:s}=t;return s?[Number(s)]:n?[Number(n)]:[]},Dn=t=>{const n=t.filter(a=>a.ubuntu_pro_info?.result==="success"&&a.ubuntu_pro_info.attached).length,s=t.length-n;return{withToken:n,withoutToken:s}};var Z=Re();function Pt(){const t=we(),n=F(),s=q({mutationKey:["token","detach"],mutationFn:async p=>t.post("detach-token",p),onSuccess:async()=>n.invalidateQueries({queryKey:["instances"]})}),{mutateAsync:a,isPending:o}=s;return{detachToken:a,isDetachingToken:o}}const ye=({isOpen:t,onClose:n,computerIds:s,instanceTitle:a,instanceCount:o})=>{const{notify:p}=G(),m=K(),{openActivityDetails:u}=he(),{detachToken:h,isDetachingToken:f}=Pt(),_=o??s.length,c=_>1,l=async()=>{try{const{data:{activity:x}}=await h({computer_ids:s}),i=a?`You queued detachment of Ubuntu Pro token for instance ${a}.`:`You queued detachment of Ubuntu Pro token for ${_} ${T(_,"instance")}.`,b=c?`This will disconnect the ${T(_,"instance from its","instances from their")} subscription and pause any enabled Pro services.`:"This will disconnect the instance from its subscription and pause any enabled Pro services.";p.success({title:i,message:b,actions:[{label:"View details",onClick:()=>{u(x)}}]}),n()}catch(x){m(x)}finally{n()}};if(!t)return null;const g=c?e.jsxs("p",{children:["Detaching the Ubuntu Pro token will disconnect ",_," ",T(_,"instance from its ","instances from their "),"subscription and pause any enabled Pro services."]}):e.jsx("p",{children:"Detaching the Ubuntu Pro token will disconnect this instance from its subscription and pause any enabled Pro services."});return Z.createPortal(e.jsx(qe,{isOpen:t,title:"Detach Ubuntu Pro token",onConfirm:l,close:n,confirmButtonLabel:"Detach",confirmButtonAppearance:"negative",confirmButtonLoading:f,confirmButtonDisabled:f,confirmationText:"detach ubuntu pro token",children:g}),document.body)},Tt=r.lazy(async()=>k(()=>import("./index-CrnP6dc4.js"),__vite__mapDeps([41,1,2,42,37,38,39,7,6,8,9,10,11,12,13,3,14,15,16,17,18,43,4,19,20,21,22,23,24,25,26,27,28,29,30,31,32]))),Bn=({instance:t})=>{const{setSidePanelContent:n}=O(),s=()=>{n("Attach Ubuntu Pro token",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Tt,{selectedInstances:[t]})}))};return e.jsx(Le,{title:"No Ubuntu Pro entitlement",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This computer is not currently attached to an Ubuntu Pro entitlement, which provides additional security updates and other benefits from Canonical."}),e.jsx("a",{href:"https://ubuntu.com/pro",target:"_blank",rel:"nofollow noopener noreferrer",children:"Learn more about Ubuntu Pro"})]}),cta:[e.jsx(d.Button,{appearance:"positive",type:"button",onClick:s,children:"Attach Ubuntu Pro"},"attach-ubuntu-pro")]})},Rt="_container_dj78y_1",wt="_wrapped_dj78y_8",Lt="_innerContainer_dj78y_13",It="_button_dj78y_17",Nt="_titleRow_dj78y_21",U={container:Rt,wrapped:wt,innerContainer:Lt,button:It,titleRow:Nt},ie=t=>t.filter(n=>!n.excluded),le=(t,n)=>[...t,...n],Ot=(t,n)=>t.label===n.label&&t.icon===n.icon&&!!t.disabled==!!n.disabled,J=(t,n)=>t.length!==n.length?!1:t.every((s,a)=>{const o=n[a];return o===void 0?!1:Ot(s,o)}),fe=t=>t.destructive.length+t.nondestructive.length>0,Ut=(t,n)=>J(t.destructive,n.destructive)&&J(t.nondestructive,n.nondestructive),Dt=(t,n)=>{const s=a=>a.filter(o=>o.collapsed).length;return s(t)+s(n)},Bt=(t,n,s,a)=>{const o=t.getBoundingClientRect().right,p=[],m={nondestructive:[],destructive:[]};n.forEach((h,f)=>{const _=t.children[f];let c=!1;const l=h.collapsed&&a;let g=0;_?(g=_.getBoundingClientRect().right,c=g>o+1):c=!0,c||l?m.nondestructive.push(h):p.push(h)}),s.forEach((h,f)=>{const _=n.length+f,c=t.children[_];let l=!1;const g=h.collapsed&&a;let x=0;c?(x=c.getBoundingClientRect().right,l=x>o+1):l=!0,l||g?m.destructive.push(h):p.push(h)});const u=fe(m)||a;return{visible:p,collapsed:m,showCollapsedMenu:u}},Ft=({actions:{destructive:t=[],nondestructive:n=[]},title:s})=>{const a=r.useMemo(()=>ie(n),[n]),o=r.useMemo(()=>ie(t),[t]),p=r.useMemo(()=>le(a,o),[a,o]),[m,u]=r.useState(p),[h,f]=r.useState({nondestructive:[],destructive:[]}),[_,c]=r.useState(!1),[l,g]=r.useState(0),x=r.useMemo(()=>Dt(a,o)>1,[a,o]),i=r.useRef(null),b=r.useRef(!1),E=r.useCallback(A=>{const{visible:w,collapsed:j,showCollapsedMenu:S}=Bt(A,a,o,x);c(C=>C===S?C:S),u(C=>J(C,w)?C:w),f(C=>Ut(C,j)?C:j)},[a,o,x]),v=r.useCallback((A,w)=>{const{width:j}=A.getBoundingClientRect();if(j===l)return;const S=j>l;g(j);const C=fe(h);if(S&&C&&!b.current){b.current=!0,c(!1);const X=le(a,o);u(X),f({nondestructive:[],destructive:[]});return}E(w)},[l,h,a,o,E]),D=r.useCallback(A=>{if(i.current&&(i.current.disconnect(),i.current=null),!A)return;const w=A,j=w.parentElement?.parentElement;if(!j)return;E(w),b.current=!1;const S=new ResizeObserver(()=>{v(j,w)});S.observe(j),i.current=S},[E,v]);return e.jsxs("div",{className:L(U.titleRow,{[U.wrapped]:!m.length}),children:[s,e.jsxs("div",{className:L(U.container,{[U.wrapped]:!m.length}),children:[e.jsx("div",{className:L(U.innerContainer,"p-segmented-control"),children:e.jsx("div",{ref:D,className:"p-segmented-control__list",children:m.map(({collapsed:A,excluded:w,icon:j,label:S,...C})=>e.jsxs(d.Button,{className:L(U.button,"u-no-margin--bottom p-segmented-control__button"),...C,children:[e.jsx(d.Icon,{name:j}),e.jsx("span",{children:S})]},S))})}),_&&e.jsx(Ie,{hasToggleIcon:!0,toggleLabel:m.length?"More actions":"Actions",toggleClassName:"u-no-margin--bottom",toggleDisabled:[...o,...a].every(A=>A.disabled),actions:h.nondestructive,destructiveActions:h.destructive})]})]})},qt=r.lazy(()=>k(()=>import("./index-fyA16G2D.js"),__vite__mapDeps([44,1,2,42,37,38,39,7,6,8,9,10,11,12,13,3,14,15,16,17,18,43,4,19,20,21,22,23,24,25,26,27,28,29,30,31,32]))),Fn=({instance:t})=>{const{instanceId:n,childInstanceId:s}=Ne(),{isFeatureEnabled:a}=pe(),{setSidePanelContent:o}=O(),{value:p,setTrue:m,setFalse:u}=ee(!1),h=()=>{o("Replace Ubuntu Pro Token",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(qt,{selectedInstances:[t]})}))};return e.jsxs(e.Fragment,{children:[e.jsx(Ft,{title:e.jsxs("div",{children:[e.jsx("span",{className:"p-heading--5 u-no-margin--bottom",children:"Account information"})," ",e.jsxs("span",{style:{display:"inline"},children:[e.jsx("span",{className:"u-text--muted",children:"listed from "}),e.jsx("a",{href:"https://ubuntu.com/pro/dashboard",target:"_blank",rel:"nofollow noopener noreferrer",children:"Ubuntu Pro Dashboard"})]})]}),actions:{nondestructive:[{icon:"edit",label:"Edit token",onClick:h}],destructive:[{icon:"delete",label:"Detach token",onClick:m,excluded:!a("ubuntu_pro_licensing")}]}}),e.jsx(ye,{isOpen:p,onClose:u,computerIds:St({instanceId:n,childInstanceId:s}),instanceTitle:t.title})]})},ce=({action:t,onDetailsClick:n,selected:s})=>({title:`Selected ${T(s.length,"instance has","instances have")} been queued for ${t}.`,message:`${T(s.length,`"${s[0]?.title??""}" instance has`,`${s.length} instances have`)} been queued in Activities for ${t}.`,actions:[{label:"View details",onClick:n}]}),Vt="_warning_16r8d_1",Mt={warning:Vt},$t=r.lazy(async()=>k(()=>import("./index-Cq7IpJb0.js"),__vite__mapDeps([45,46,1,2,10,11,12,13,47,48,6,8,9,21,22,23,24,25,26,5,3,27,28,14,15,16,49,50,51,52,4,53,54,55,56,57,37,38,39,58,17,59,60,61,62,35,36,63,64,65,66])).then(t=>({default:t.RunInstanceScriptForm}))),Ht=r.lazy(async()=>k(()=>import("./index-CIbLM8fR.js"),__vite__mapDeps([67,1,2,37,38,39,4,68,48,8,9,3,69,7,6,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32])).then(t=>({default:t.Upgrades})));r.lazy(async()=>k(()=>import("./index-B0iimqzw.js"),__vite__mapDeps([70,1,2,37,38,39,3,17,71])));const zt=r.lazy(async()=>k(()=>import("./index-CweI51H2.js"),__vite__mapDeps([72,1,2,37,38,39,5,3,17]))),Gt=r.lazy(async()=>k(()=>import("./index-BU5AeVyY.js"),__vite__mapDeps([73,1,2,37,38,39,74,75,76,77,3]))),Kt=r.lazy(async()=>k(()=>import("./index-B_Crukah.js"),__vite__mapDeps([78,41,1,2,42,37,38,39,7,6,8,9,10,11,12,13,3,14,15,16,17,18,43,4,19,20,21,22,23,24,25,26,27,28,29,30,31,32,44,79,80])).then(t=>({default:t.AttachTokenForm}))),Wt=r.lazy(async()=>k(()=>import("./index-B_Crukah.js"),__vite__mapDeps([78,41,1,2,42,37,38,39,7,6,8,9,10,11,12,13,3,14,15,16,17,18,43,4,19,20,21,22,23,24,25,26,27,28,29,30,31,32,44,79,80])).then(t=>({default:t.ReplaceTokenForm}))),qn=r.memo(function({isGettingInstances:n,selectedInstances:s}){const a=K(),{isFeatureEnabled:o}=pe(),{notify:p}=G(),{openActivityDetails:m}=he(),{setSidePanelContent:u}=O(),[h,f]=r.useState(!1),[_,c]=r.useState(!1),[l,g]=r.useState(!1),{restartInstances:x,isRestartingInstances:i}=Me(),{shutDownInstances:b,isShuttingDownInstances:E}=$e(),v=y=>e.jsxs(e.Fragment,{children:[e.jsx("b",{children:y.length})," ",T(y.length,"instance")]}),D=async()=>{u("Run script",e.jsxs(r.Suspense,{fallback:e.jsx(P,{}),children:[s.some(y=>!B(y).scripts)?e.jsxs("div",{className:Mt.warning,children:[e.jsxs("p",{children:["You selected ",s.length," instances. This script will:"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:["run on"," ",v(s.filter(y=>B(y).scripts))]}),e.jsxs("li",{children:["not run on"," ",v(s.filter(y=>!B(y).scripts))]})]})]}):null,e.jsx($t,{query:s.map(({id:y})=>`id:${y}`).join(" OR ")})]}))},A=async()=>{try{const{data:y}=await b({computer_ids:s.map(({id:Q})=>Q)});p.success(ce({action:"shutdown",onDetailsClick:()=>{m(y)},selected:s}))}catch(y){a(y)}},w=async()=>{try{const{data:y}=await x({computer_ids:s.map(({id:Q})=>Q)});p.success(ce({action:"reboot",onDetailsClick:()=>{m(y)},selected:s}))}catch(y){a(y)}},j=()=>{u("Upgrades",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ht,{selectedInstances:s})}),"large")},S=()=>{u("Assign access group",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(zt,{selected:s})}))},C=()=>{u("Assign tags",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Gt,{selected:s})}))},X=()=>{u(`Attach Ubuntu Pro token to ${s.length} ${T(s.length,"instance")}`,e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Kt,{selectedInstances:s})}))},_e=()=>{u(`Replace Ubuntu Pro token for ${s.length} ${T(s.length,"instance")}`,e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Wt,{selectedInstances:s})}))},M=[s.every(y=>y.ubuntu_pro_info?.result==="success"&&y.ubuntu_pro_info.attached)?{children:e.jsx("span",{children:"Replace token"}),onClick:_e}:{children:e.jsx("span",{children:"Attach token"}),onClick:X},o("ubuntu_pro_licensing")?{children:e.jsx("span",{children:"Detach token"}),onClick:()=>{g(!0)}}:{}].filter(y=>y.children);return e.jsxs(e.Fragment,{children:[e.jsx(Et,{collapseFrom:"xl",buttons:[e.jsxs(d.Button,{className:"has-icon",type:"button",disabled:E||s.length===0||n,onClick:()=>{c(!0)},children:[e.jsx(d.Icon,{name:"power-off"}),e.jsx("span",{children:"Shut down"})]},"shutdown-instances"),e.jsxs(d.Button,{hasIcon:!0,type:"button",disabled:i||s.length===0||n,onClick:()=>{f(!0)},children:[e.jsx(d.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]},"reboot-instances"),de(M)?e.jsx(d.Button,{type:"button",className:"u-no-margin--bottom",onClick:M[0].onClick,disabled:s.length===0,children:M[0].children},"pro-services"):e.jsx(d.ContextualMenu,{position:"left",hasToggleIcon:!0,links:M,toggleLabel:e.jsx("span",{children:"Pro services"}),toggleClassName:"u-no-margin--bottom",toggleDisabled:s.length===0,dropdownProps:{style:{zIndex:10}}},"pro-services"),Oe,e.jsxs(d.Button,{type:"button",hasIcon:!0,onClick:D,disabled:s.every(y=>!B(y).scripts)||n,children:[e.jsx(d.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]},"run-script"),e.jsxs(d.Button,{type:"button",hasIcon:!0,onClick:j,disabled:s.every(y=>!Xe(y.alerts))||n,children:[e.jsx(d.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]},"upgrade-instances")]}),e.jsx(d.ContextualMenu,{hasToggleIcon:!0,links:[{children:"Access group",onClick:S},{children:"Tags",onClick:C}],position:"right",toggleLabel:e.jsxs(e.Fragment,{children:[e.jsx(d.Icon,{name:"plus"}),e.jsx("span",{children:"Assign"})]}),toggleClassName:"u-no-margin--bottom",toggleDisabled:s.length===0,dropdownProps:{style:{zIndex:10}}}),h&&Z.createPortal(e.jsx(d.ConfirmationModal,{close:()=>{f(!1)},title:"Restarting selected instances",confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonLoading:i,confirmButtonDisabled:i,onConfirm:w,children:e.jsxs("p",{children:["Are you sure you want to restart ",s.length,T(s.length,"instance"),"?"]})}),document.body),_&&Z.createPortal(e.jsx(d.ConfirmationModal,{close:()=>{c(!1)},title:"Shutting down selected instances",confirmButtonLabel:"Shut down",confirmButtonAppearance:"negative",confirmButtonLoading:E,confirmButtonDisabled:E,onConfirm:A,children:e.jsxs("p",{children:["Are you sure you want to shut down ",s.length," ",T(s.length,"instance"),"?"]})}),document.body),l&&e.jsx(ye,{isOpen:l,onClose:()=>{g(!1)},computerIds:s.map(({id:y})=>y)})]})});export{cn as A,vn as B,Nn as C,ye as D,gn as E,un as F,Un as G,Ft as H,Cn as I,pn as J,wn as K,Tn as L,qn as M,Rn as N,yn as P,Ln as Q,Et as R,be as S,An as T,Bn as U,bn as V,Pn as W,Fn as a,dn as b,Ve as c,Dn as d,In as e,En as f,St as g,jn as h,xn as i,mn as j,kn as k,Sn as l,fn as m,_n as n,On as o,me as p,ge as q,Xe as r,B as s,Me as t,Pt as u,$e as v,ae as w,R as x,gt as y,hn as z};
