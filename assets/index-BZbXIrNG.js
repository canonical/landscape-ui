import{l as f,j as t,d as r,o as A,p as k,k as _,q as w,a7 as x,s as T,b as te,i as ae,C as S,F as q,A as D,Z as se,K as v}from"./index-CDk-Jgvr.js";import{A as M}from"./AssociationBlock-CvS248qk.js";import{S as L}from"./SidePanelFormButtons-CsUGQk2E.js";import{u as Q}from"./useRoles-BvJMVkR7.js";import{T as ne,C as W,a as E,E as z,u as N,V as oe,I as re,b as ie,L as U,c as le,d as ce,P as ue,e as de,f as pe,g as ge}from"./index-R0rBKgF3.js";import{h as $t,i as Bt,j as Vt}from"./index-R0rBKgF3.js";import{F as me}from"./FileInput-BSqQmDBz.js";import{u as he}from"./useGetInstances-B7Kg5hSx.js";import{H as Y}from"./HeaderWithSearch-lC_PsP2p.js";import{S as K}from"./SidePanelTablePagination-ByE4BkY1.js";import{T as Pe}from"./TextConfirmationModal-BxLh3OQM.js";import"./MultiSelectField-U-nhLr2F.js";import"./useGetTags-B8yNd7a1.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";import"./PageMain-Docc5lp9.js";import"./constants-DRKgEQ0k.js";import"./constants-BR1biRXO.js";const R=({onChange:e,value:a,...s})=>{const[n,u]=f.useState(a);return t.jsx(r.Input,{type:"text",autoComplete:"off",...s,value:n,onChange:i=>u(i.target.value),onBlur:()=>e(n)})},Ce="_action_w93bw_1",be="_cell_w93bw_7",fe="_input_w93bw_18",xe="_inputWrapper_w93bw_26",y={action:Ce,cell:be,input:fe,inputWrapper:xe},je=async(e,a,s,n)=>{await e.setFieldValue(`constraints[${a}]${[s]}`,n),await e.setFieldTouched(`constraints[${a}]${[s]}`,!0),["rule","version"].includes(s)&&(n!==""?await e.setFieldValue(`constraints[${a}].notAnyVersion`,!0):e.values.constraints[a][s==="rule"?"version":"rule"]===""&&await e.setFieldValue(`constraints[${a}].notAnyVersion`,!1))},ye=(e,a,s)=>{if(!e.errors.constraints?.[a]||!e.touched.constraints?.[a]?.[s])return;const n=e.errors.constraints[a];return typeof n!="string"?n[s]:void 0},Se=async(e,a)=>{await e.setFieldValue("constraints",e.values.constraints.filter((s,n)=>n!==a)),e.touched.constraints&&(e.touched.constraints.splice(a,1),await e.setTouched({...e.touched,constraints:e.touched.constraints}))},ve=e=>({handleConstraintPropChange:async(a,s,n)=>{await je(e,a,s,n)},handleConstraintRowDelete:async a=>{await Se(e,a)},getConstraintsErrorByIndex:(a,s)=>ye(e,a,s)}),_e=({column:e})=>{const a={};return a.className=y.cell,e.id==="package_name"?a.role="rowheader":e.id==="action"?a["aria-label"]="Action":e.id==="constraint"?a["aria-label"]="Constraint":e.id==="version"?a["aria-label"]="Version":e.id==="rule"&&(a["aria-label"]="Rule"),a},Z=({formik:e})=>{f.useEffect(()=>{e.submitCount!==0&&(async()=>await e.setTouched({...e.touched,constraints:new Array(e.values.constraints.length).fill(ne)}))()},[e.submitCount]);const a=f.useMemo(()=>e.values.constraints,[e.values.constraints]),{handleConstraintPropChange:s,handleConstraintRowDelete:n,getConstraintsErrorByIndex:u}=ve(e),i=f.useMemo(()=>[{accessor:"constraint",Header:"Constraint",Cell:({row:{index:c}})=>t.jsx(r.Select,{label:"Constraint",labelClassName:"u-off-screen",className:y.input,wrapperClassName:y.inputWrapper,options:W,...e.getFieldProps(`constraints[${c}].constraint`),onChange:o=>s(c,"constraint",o.target.value),error:u(c,"constraint")})},{accessor:"package",Header:"Package",Cell:({row:{index:c}})=>t.jsx(R,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:y.input,wrapperClassName:y.inputWrapper,...e.getFieldProps(`constraints[${c}].package`),onChange:o=>s(c,"package",o),error:u(c,"package")})},{accessor:"rule",Header:"Rule",Cell:({row:{index:c}})=>t.jsx(r.Select,{label:"Rule",labelClassName:"u-off-screen",className:y.input,wrapperClassName:y.inputWrapper,...e.getFieldProps(`constraints[${c}].rule`),options:E,onChange:o=>s(c,"rule",o.target.value),error:u(c,"rule")})},{accessor:"version",Header:"Version",Cell:({row:{index:c}})=>t.jsx(R,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:y.input,wrapperClassName:y.inputWrapper,...e.getFieldProps(`constraints[${c}].version`),onChange:o=>s(c,"version",o),error:u(c,"version")})},{accessor:"action",className:y.action,Cell:({row:c})=>t.jsx(r.Button,{type:"button",hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding","aria-label":"Delete constraint row",onClick:()=>n(c.index),children:t.jsx(r.Icon,{name:r.ICONS.delete,className:"u-no-margin--left u-no-margin--right"})})}],[a,e.errors.constraints,e.touched.constraints]),m=async()=>{if(await e.setFieldValue("constraints",[z,...e.values.constraints]),e.touched.constraints){const c=[];for(let o=e.values.constraints.length;o>0;o--)e.touched.constraints[o-1]&&(c[o]=e.touched.constraints[o-1]);await e.setTouched({constraints:c})}};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"u-align-text--right",children:t.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:m,children:[t.jsx(r.Icon,{name:r.ICONS.plus,className:"u-no-margin--left"}),t.jsx("span",{children:"Add new constraint"})]})}),t.jsx(r.ModularTable,{columns:i,data:a,getCellProps:_e,emptyMsg:"No constraints added yet.",className:"u-no-margin--bottom"}),e.touched.constraints&&typeof e.errors.constraints=="string"&&t.jsx("div",{className:"is-error",children:t.jsxs("p",{className:"p-form-validation__message u-no-margin--top",children:[t.jsx("strong",{children:"Error: "}),t.jsx("span",{children:e.errors.constraints})]})})]})},Ne=[{label:"Select constraints type",value:""},{label:"From an instance's packages",value:"instance"},{label:"From a CSV file",value:"material"},{label:"Enter manually",value:"manual"}],Fe="_container_vi1gw_1",Te={container:Fe},Ae=({formik:e})=>{const{instances:a}=he(),s=a.map(({id:i,title:m})=>({label:m,value:`${i}`}))??[];s.unshift({label:"Select instance",value:""});const n=async i=>{await e.setFieldValue("csvFile",i[0]);const m=await i[0].text();await e.setFieldValue("material",m)},u=async()=>{await e.setFieldValue("csvFile",null),await e.setFieldValue("material",""),await e.setFieldValue("isCsvFileParsed",!1)};return t.jsxs("div",{className:Te.container,children:[t.jsx(r.Select,{label:"Package constraints",required:!0,options:Ne,...e.getFieldProps("constraintsType"),error:e.touched.constraintsType&&e.errors.constraintsType?e.errors.constraintsType:void 0}),e.values.constraintsType==="instance"&&t.jsx(r.Select,{label:"Instance",required:e.values.constraintsType==="instance",options:s,...e.getFieldProps("source_computer_id"),error:e.touched.source_computer_id&&e.errors.source_computer_id?e.errors.source_computer_id:void 0}),e.values.constraintsType==="material"&&t.jsx(me,{label:"Upload constraints",accept:".csv",...e.getFieldProps("csvFile"),onFileRemove:u,onFileUpload:n,help:'File should be formatted as either a package profile CSV file or the output of running "dpkg --get-selections" on a computer with desired packages installed.',error:e.touched.csvFile&&e.errors.csvFile||e.touched.material&&e.errors.material||void 0}),e.values.constraintsType==="manual"&&t.jsx(Z,{formik:e})]})},_t=()=>{const e=A(),{notify:a}=k(),{setPageParams:s}=_(),{getAccessGroupQuery:n}=Q(),{createPackageProfileQuery:u}=N(),{data:i}=n(),m=i?.data.map(({name:d,title:g})=>({label:g,value:d}))??[],{mutateAsync:c}=u,o=()=>{s({sidePath:[],profile:""})},p=w({initialValues:re,onSubmit:async d=>{const g={access_group:d.access_group,description:d.description,title:d.title};d.all_computers?g.all_computers=!0:d.tags.length>0&&(g.tags=d.tags),d.constraintsType==="material"?g.material=d.material:d.constraintsType==="instance"?g.source_computer_id=d.source_computer_id:g.constraints=d.constraints.map(({constraint:C,package:l,rule:P,version:F})=>({constraint:C,package:l,rule:P,version:F}));try{await c(g),o(),a.success({message:`Profile "${d.title}" added successfully`,title:"Profile added"})}catch(C){e(C)}},validationSchema:oe});return t.jsxs(t.Fragment,{children:[t.jsx(x.Header,{children:"Add package profile"}),t.jsx(x.Content,{children:t.jsxs(r.Form,{onSubmit:p.handleSubmit,noValidate:!0,children:[t.jsx(r.Input,{type:"text",label:"Title",required:!0,...p.getFieldProps("title"),error:T(p,"title")}),t.jsx(r.Input,{type:"text",label:"Description",required:!0,autoComplete:"off",...p.getFieldProps("description"),error:T(p,"description")}),t.jsx(r.Select,{label:"Access group",...p.getFieldProps("access_group"),options:m,error:T(p,"access_group")}),t.jsx(M,{formik:p}),t.jsx(Ae,{formik:p}),t.jsx(L,{submitButtonDisabled:p.isSubmitting,submitButtonText:"Add package profile",onCancel:o})]})})]})},ke=e=>{const a=te(),{data:s,isPending:n,error:u}=ae({queryKey:["packageProfile",e],queryFn:async({signal:m})=>a.get("packageprofiles",{params:{names:[e]},signal:m})}),i=s?.data.result[0];return{packageProfile:i,packageProfileError:s&&!i?new Error("The package profile could not be found."):u,isGettingPackageProfile:n}},I=()=>{const{profile:e}=_(),{packageProfile:a,isGettingPackageProfile:s,packageProfileError:n}=ke(e);if(n)throw n;return s?{packageProfile:void 0,isGettingPackageProfile:!0}:{packageProfile:a,isGettingPackageProfile:!1}},we=({profile:e})=>{const a=A(),{notify:s}=k(),{sidePath:n,popSidePath:u,setPageParams:i}=_(),{addPackageProfileConstraintsQuery:m}=N(),{mutateAsync:c}=m,h=w({initialValues:{constraints:[z]},onSubmit:async({constraints:p})=>{try{await c({name:e.name,constraints:p.map(({constraint:d,package:g,rule:C,version:l})=>({constraint:d,package:g,rule:C,version:l}))}),u(),s.success({message:`${p.length} package profile ${S(p.length,"constraint")}  added successfully`,title:"Package profile constraints added"})}catch(d){a(d)}},validationSchema:ie});return t.jsxs(r.Form,{onSubmit:h.handleSubmit,noValidate:!0,children:[t.jsx(Z,{formik:h}),t.jsx(L,{submitButtonLoading:h.isSubmitting,submitButtonText:`Add ${S(h.values.constraints.length,"constraint")}`,submitButtonAriaLabel:`Add ${S(h.values.constraints.length,"constraint")} to "${e.title}" profile`,cancelButtonDisabled:h.isSubmitting,hasBackButton:n.length>1,onBackButtonPress:u,onCancel:()=>{i({sidePath:[],profile:""})}})]})},Nt=()=>{const{packageProfile:e,isGettingPackageProfile:a}=I();return a?t.jsx(x.LoadingState,{}):t.jsxs(t.Fragment,{children:[t.jsxs(x.Header,{children:['Add package constraints to "',e.title,'" profile']}),t.jsx(x.Content,{children:t.jsx(we,{profile:e})})]})},Ie=[{label:"All",value:""},{label:"Conflicts",value:"conflicts"},{label:"Depends",value:"depends"}],$e="_container_scrq4_1",Be={container:$e},Ve=({filter:e,formik:a,onFilterChange:s,profile:n,selectedIds:u,setSelectedIds:i})=>{const m=A(),{notify:c}=k(),{pushSidePath:o}=_(),{removePackageProfileConstraintsQuery:h}=N(),{mutateAsync:p,isPending:d}=h,g=async()=>{try{await p({constraint_ids:u,name:n.name}),i([]),c.success({message:`${u.length} "${n.title}" profile's ${S(u.length,"constraint")} removed successfully`,title:`Package profile ${S(u.length,"constraint")} removed`})}catch(l){m(l)}},C=()=>{o("add-constraints")};return t.jsxs("div",{className:Be.container,children:[t.jsx(r.Select,{label:"Constraint type",className:"u-no-margin--bottom",labelClassName:"u-no-padding--top",options:Ie,value:e,onChange:l=>{s(l.target.value)}}),t.jsxs(r.ConfirmationButton,{className:"has-icon u-no-margin--right u-no-margin--bottom",type:"button",disabled:u.length===0||a.values.id!==0,"aria-label":`Remove selected ${S(u.length,"constraint")}`,confirmationModalProps:{title:`Remove ${S(u.length,"constraint")}`,children:t.jsxs("p",{children:["This will remove ",u.length," ",S(u.length,"constraint"),"."]}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:g},children:[t.jsx(r.Icon,{name:r.ICONS.delete}),t.jsx("span",{children:"Remove"})]}),t.jsxs(r.Button,{className:"u-no-margin--bottom",type:"button",hasIcon:!0,onClick:C,"aria-label":"Add new constraint",children:[t.jsx(r.Icon,{name:r.ICONS.plus}),t.jsx("span",{children:"Add constraints"})]})]})},Ee="_actionButton_1mrgm_1",Re="_tooltip_1mrgm_5",V={actionButton:Ee,tooltip:Re},De=({constraint:e,formik:a})=>a.values.id===e.id?t.jsxs(t.Fragment,{children:[t.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:q("u-no-margin--bottom u-no-padding",V.actionButton),onClick:()=>a.handleSubmit(),children:t.jsx(r.Tooltip,{tooltipClassName:V.tooltip,message:"Save changes",children:t.jsx(r.Icon,{name:"success-grey",className:"u-no-margin--left u-no-margin--right"})})}),t.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>a.resetForm(),"aria-label":`Cancel editing ${e.package} constraint`,children:t.jsx(r.Tooltip,{tooltipClassName:V.tooltip,message:"Cancel",children:t.jsx(r.Icon,{name:"error-grey",className:"u-no-margin--left u-no-margin--right"})})})]}):t.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>a.setValues(e),disabled:a.values.id!==0,"aria-label":`Edit ${e.package} constraint`,children:t.jsx(r.Tooltip,{tooltipClassName:V.tooltip,message:"Edit constraint",children:t.jsx(r.Icon,{name:"edit",className:"u-no-margin--left u-no-margin--right"})})}),Le="_actionsCell_1kvjf_1",Oe="_noPadding_1kvjf_7",He="_cell_1kvjf_11",Ge="_input_1kvjf_23",Me="_inputWrapper_1kvjf_31",Qe="_hidden_1kvjf_37",j={actionsCell:Le,noPadding:Oe,cell:He,input:Ge,inputWrapper:Me,hidden:Qe},We=async(e,a,s)=>{await e.setFieldValue(`${a}`,s),await e.setFieldTouched(`${a}`,!0),["rule","version"].includes(`${a}`)&&(s!==""?await e.setFieldValue("notAnyVersion",!0):e.values[a==="rule"?"version":"rule"]===""&&await e.setFieldValue("notAnyVersion",!1))},qe=(e,a)=>{if(!(!e.touched[a]||!e.errors[a]))return e.errors[a]},ze=e=>({handleConstraintPropChange:(a,s)=>We(e,a,s),getConstraintPropError:a=>qe(e,a)}),Ue=({column:e,row:a},s)=>{const n={};return n.className=q(j.cell,{[j.noPadding]:a.original.id===s}),a.original.package==="loading"?e.id==="package"?n.colSpan=5:(n.className=j.hidden,n["aria-hidden"]=!0):e.id==="package"?n.role="rowheader":e.id==="actions"?n["aria-label"]="Actions":e.id==="constraint"?n["aria-label"]="Constraint":e.id==="version"?n["aria-label"]="Version":e.id==="rule"&&(n["aria-label"]="Rule"),n},Ye=(e,a)=>{let s="No constraints found";return e&&(s+=` with the constraint type: "${e}"`,a&&(s+=" and")),a&&(s+=` with the search: "${a}"`),s},Ke=({filter:e,formik:a,isConstraintsLoading:s,onSelectedIdsChange:n,pageSize:u,profileConstraints:i,search:m,selectedIds:c})=>{const o=f.useMemo(()=>{if(s)return[U];if(!i)return[];const l=i.map(P=>({...P,notAnyVersion:!!P.version}));return a.values.id!==-1?l:[a.values,...l].slice(0,u)},[s,i,a.values,u]),h=()=>{n(c.length?[]:o.map(({id:l})=>l))},p=l=>{c.includes(l)?n(c.filter(P=>P!==l)):n([...c,l])},{handleConstraintPropChange:d,getConstraintPropError:g}=ze(a),C=f.useMemo(()=>[{accessor:"constraint",Header:()=>t.jsxs(t.Fragment,{children:[t.jsx(r.CheckboxInput,{inline:!0,label:t.jsx("span",{className:"u-off-screen",children:"Toggle all constraints"}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0||o.length===0,checked:o.length>0&&o.length===c.length,indeterminate:c.length>0&&c.length<o.length,onChange:h}),t.jsx("span",{children:"Constraint"})]}),Cell:({row:{original:l}})=>a.values.id===l.id?t.jsx(r.Select,{label:"Constraint",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,options:W,...a.getFieldProps("constraint"),onChange:P=>d("constraint",P.target.value),error:g("constraint")}):t.jsxs("div",{className:j.checkboxContainer,children:[t.jsx(r.CheckboxInput,{inline:!0,label:t.jsx("span",{className:"u-off-screen",children:`Toggle ${l.package} constraint`}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0,checked:c.includes(l.id),onChange:()=>p(l.id)}),t.jsx("span",{children:l.constraint})]})},{accessor:"package",Header:"Package",Cell:({row:{original:l}})=>a.values.id===l.id?t.jsx(R,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,...a.getFieldProps("package"),onChange:P=>d("package",P),error:g("package")}):l.package!=="loading"?t.jsx(t.Fragment,{children:l.package}):t.jsx(D,{})},{accessor:"rule",Header:"Rule",Cell:({row:{original:l}})=>a.values.id===l.id?t.jsx(r.Select,{label:"Rule",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,options:E,...a.getFieldProps("rule"),onChange:P=>d("rule",P.target.value),error:g("rule")}):t.jsx(t.Fragment,{children:E.find(({value:P})=>P===l.rule)?.label??l.rule})},{accessor:"version",Header:"Version",Cell:({row:{original:l}})=>a.values.id===l.id?t.jsx(R,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,...a.getFieldProps("version"),onChange:P=>d("version",P),error:g("version")}):t.jsx(t.Fragment,{children:l.version})},{accessor:"actions",className:j.actionsCell,Cell:({row:{original:l}})=>t.jsx(De,{constraint:l,formik:a})}],[o,c.length,a.errors,a.touched]);return t.jsx(r.ModularTable,{columns:C,data:o,getCellProps:l=>Ue(l,a.values.id),className:"u-no-margin--bottom",emptyMsg:Ye(e,m)})},Ze="_pagination_15tqa_1",Je={pagination:Ze},Xe=({profile:e})=>{const[a,s]=f.useState([]),[n,u]=f.useState(1),[i,m]=f.useState(20),[c,o]=f.useState(""),[h,p]=f.useState(""),d=b=>{s([]),u(b)},g=b=>{s([]),m(b)},C=A(),{notify:l}=k(),{editPackageProfileConstraintQuery:P,getPackageProfileConstraintsQuery:F}=N(),{mutateAsync:O}=P,H=w({initialValues:ce,onSubmit:async(b,{resetForm:X})=>{try{await O({constraint:b.constraint,id:b.id,package:b.package,rule:b.rule,version:b.version,name:e.name}),l.success({message:`"${e.title}" package profile's constraint updated successfully`,title:"Package profile constraint updated"}),X()}catch(ee){C(ee)}},validationSchema:le}),{data:B,isLoading:G}=F({constraint_type:h||void 0,limit:i,name:e.name,offset:(n-1)*i,search:c});return t.jsxs(t.Fragment,{children:[!c&&!h&&n===1&&i===20&&G&&t.jsx(D,{}),(c||h||n!==1||i!==20||!G&&B&&B.data.results.length>0)&&t.jsxs(t.Fragment,{children:[t.jsx(Y,{actions:t.jsx(Ve,{filter:h,formik:H,onFilterChange:b=>{p(b)},profile:e,selectedIds:a,setSelectedIds:b=>{s(b)}}),onSearch:b=>{o(b)},disabled:H.values.id!==0}),t.jsx(Ke,{filter:h,formik:H,isConstraintsLoading:G,onSelectedIdsChange:b=>{s(b)},pageSize:i,profileConstraints:B?.data.results,search:c,selectedIds:a}),t.jsx(K,{currentPage:n,pageSize:i,paginate:d,setPageSize:g,totalItems:B?.data.count,className:Je.pagination})]})]})},Ft=()=>{const{packageProfile:e,isGettingPackageProfile:a}=I();return a?t.jsx(x.LoadingState,{}):t.jsxs(t.Fragment,{children:[t.jsxs(x.Header,{children:['Change "',e.title,`" profile's constraints`]}),t.jsx(x.Content,{children:t.jsx(Xe,{profile:e})})]})},et="_constraint_1lz67_1",tt="_hidden_1lz67_5",J={constraint:et,hidden:tt},at=({row:e,column:a})=>{const s={};return e.original.package==="loading"?a.id==="package"?s.colSpan=3:(s.className=J.hidden,s["aria-hidden"]=!0):a.id==="package"?s.role="rowheader":a.id==="constraint"?s["aria-label"]="Constraint":a.id==="rule"?s["aria-label"]="Rule":a.id==="version"&&(s["aria-label"]="Version"),s},st=({isConstraintsLoading:e,profileConstraints:a,search:s})=>{const n=f.useMemo(()=>e?[U]:a?a.map(i=>({...i,notAnyVersion:!!i.version})):[],[e,a]),u=f.useMemo(()=>[{accessor:"constraint",className:J.constraint,Header:"Constraint",Cell:({row:{original:i}})=>W.find(({value:m})=>m===i.constraint)?.label??i.constraint},{accessor:"package",Header:"Package",Cell:({row:{original:i}})=>i.package==="loading"?t.jsx(D,{}):i.package},{accessor:"version",Header:"Version",Cell:({row:{original:i}})=>i.version?`${E.find(({value:m})=>m===i.rule)?.label} ${i.version}`:"Any"}],[n]);return t.jsx(r.ModularTable,{columns:u,data:n,getCellProps:at,emptyMsg:`No constraints found with the search: "${s}"`})},nt="_actions_nxngq_1",ot={actions:nt},rt=({profile:e})=>{const[a,s]=f.useState(1),[n,u]=f.useState(20),[i,m]=f.useState(""),{pushSidePath:c}=_(),{getPackageProfileConstraintsQuery:o}=N(),{data:h,isLoading:p}=o({name:e.name,limit:n,offset:(a-1)*n,search:i}),d=()=>{c("edit-constraints")};return t.jsxs(t.Fragment,{children:[!i&&a===1&&n===20&&p&&t.jsx(D,{}),(i||a!==1||n!==20||!p&&h&&h.data.results.length>0)&&t.jsxs(t.Fragment,{children:[t.jsx(Y,{className:ot.actions,onSearch:g=>{m(g)},actions:t.jsx(r.Button,{className:"u-no-margin--bottom",type:"button",onClick:d,children:"Change package constraints"})}),t.jsx(st,{isConstraintsLoading:p,profileConstraints:h?.data.results,search:i}),t.jsx(K,{currentPage:a,pageSize:n,paginate:g=>{s(g)},setPageSize:g=>{u(g)},totalItems:h?.data.count})]})]})},Tt=()=>{const e=A(),{notify:a}=k(),{pushSidePath:s,setPageParams:n}=_(),{removePackageProfileQuery:u}=N(),{getAccessGroupQuery:i}=Q(),{data:m}=i(),c=m?.data??[],{packageProfile:o,isGettingPackageProfile:h}=I(),{mutateAsync:p,isPending:d}=u,{value:g,setTrue:C,setFalse:l}=se();if(h)return t.jsx(x.LoadingState,{});const P=async()=>{try{await p({name:o.name}),n({sidePath:[],profile:""}),a.success({message:`Package profile "${o.name}" removed successfully.`,title:"Package profile removed"})}catch($){e($)}finally{l()}},F=()=>{s("edit")},O=()=>{s("duplicate")};return t.jsxs(t.Fragment,{children:[t.jsx(x.Header,{children:o.title}),t.jsxs(x.Content,{children:[t.jsxs("div",{className:"p-segmented-control",children:[t.jsxs(r.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button u-no-margin",onClick:O,children:[t.jsx(r.Icon,{name:"canvas"}),t.jsx("span",{children:"Duplicate profile"})]}),t.jsxs(r.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button u-no-margin",onClick:F,children:[t.jsx(r.Icon,{name:"edit"}),t.jsx("span",{children:"Edit"})]}),t.jsxs(r.Button,{className:"p-segmented-control__button u-no-margin",hasIcon:!0,type:"button",onClick:C,"aria-label":`Remove ${o.title} package profile`,children:[t.jsx(r.Icon,{name:r.ICONS.delete}),t.jsx("span",{children:"Remove"})]})]}),t.jsxs(v,{spaced:!0,children:[t.jsx(v.Item,{label:"Title",value:o.title}),t.jsx(v.Item,{label:"Name",value:o.name}),t.jsx(v.Item,{label:"Description",value:o.description}),t.jsx(v.Item,{label:"Access group",value:c.find($=>$.name===o.access_group)?.title??o.access_group}),t.jsx(v.Item,{label:"Tags",large:!0,value:o.tags.join(", ")||null,type:"truncated"}),t.jsx(v.Item,{label:"Associated to",value:t.jsx(ue,{packageProfile:o})}),t.jsx(v.Item,{label:"Pending on",value:`${o.computers.pending?.length??0} ${S(o.computers.pending.length,"instance")}`}),t.jsx(v.Item,{label:"Not compliant on",value:`${o.computers["non-compliant"].length} ${S(o.computers["non-compliant"].length,"instance")}`})]}),t.jsx(rt,{profile:o})]}),t.jsx(Pe,{isOpen:g,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:d,confirmButtonDisabled:d,close:l,confirmationText:`remove ${o.title}`,onConfirm:P,children:t.jsxs("p",{children:['This will remove "',o.title,'" profile. This action is'," ",t.jsx("b",{children:"irreversible"}),"."]})})]})},it=({profile:e})=>{const a=A(),{sidePath:s,popSidePath:n,setPageParams:u}=_(),{notify:i}=k(),{getAccessGroupQuery:m}=Q(),{copyPackageProfileQuery:c}=N(),{mutateAsync:o}=c,{data:h}=m(),p=h?.data.map(({name:l,title:P})=>({label:P,value:l}))??[],d=()=>{u({sidePath:[],profile:""})},C=w({initialValues:pe,onSubmit:async l=>{const P={all_computers:l.all_computers,access_group:l.access_group,copy_from:e.name,description:l.description,title:l.title};!l.all_computers&&l.tags.length>0&&(P.tags=l.tags);try{await o(P),d(),i.success({message:`Profile "${e.title}" duplicated successfully`,title:"Profile duplicated"})}catch(F){a(F)}},validationSchema:de});return f.useEffect(()=>{e&&C.setValues({access_group:e.access_group,all_computers:e.all_computers,description:e.description,tags:e.tags,title:`${e.title} (copy)`})},[e]),t.jsxs(r.Form,{onSubmit:C.handleSubmit,noValidate:!0,children:[t.jsx(r.Input,{type:"text",label:"Title",required:!0,...C.getFieldProps("title"),error:T(C,"title")}),t.jsx(r.Input,{type:"text",label:"Description",required:!0,autoComplete:"off",...C.getFieldProps("description"),error:T(C,"description")}),t.jsx(r.Select,{label:"Access group",...C.getFieldProps("access_group"),options:p,error:T(C,"access_group")}),t.jsx(M,{formik:C}),t.jsx(L,{submitButtonLoading:C.isSubmitting,submitButtonText:"Duplicate",hasBackButton:s.length>1,onBackButtonPress:n,onCancel:d})]})},At=()=>{const{packageProfile:e,isGettingPackageProfile:a}=I();return a?t.jsx(x.LoadingState,{}):t.jsxs(t.Fragment,{children:[t.jsxs(x.Header,{children:["Duplicate ",e.title]}),t.jsx(x.Content,{children:t.jsx(it,{profile:e})})]})},lt=({profile:e})=>{const a=A(),{sidePath:s,popSidePath:n,setPageParams:u}=_(),{notify:i}=k(),{editPackageProfileQuery:m}=N(),{mutateAsync:c}=m,o=()=>{u({sidePath:[],profile:""})},h=async d=>{try{await c({...d,name:e.name,tags:d.all_computers?[]:d.tags}),o(),i.success({message:`Package profile "${e.title}" updated successfully`,title:"Package profile updated"})}catch(g){a(g)}},p=w({enableReinitialize:!0,initialValues:{all_computers:e.all_computers,description:e.description,tags:e.tags,title:e.title},onSubmit:h,validationSchema:ge});return t.jsxs(r.Form,{onSubmit:p.handleSubmit,noValidate:!0,children:[t.jsx(r.Input,{type:"text",label:"Title",...p.getFieldProps("title"),error:T(p,"title")}),t.jsx(r.Input,{type:"text",label:"Description",...p.getFieldProps("description")}),t.jsx(M,{formik:p}),t.jsx(L,{submitButtonLoading:p.isSubmitting,submitButtonText:"Save changes",hasBackButton:s.length>1,onBackButtonPress:n,onCancel:o})]})},kt=()=>{const{packageProfile:e,isGettingPackageProfile:a}=I();return a?t.jsx(x.LoadingState,{}):t.jsxs(t.Fragment,{children:[t.jsxs(x.Header,{children:["Edit ",e.title]}),t.jsx(x.Content,{children:t.jsx(lt,{profile:e})})]})};export{_t as PackageProfileAddSidePanel,Nt as PackageProfileConstraintsAddSidePanel,Ft as PackageProfileConstraintsEditSidePanel,Tt as PackageProfileDetailsSidePanel,At as PackageProfileDuplicateSidePanel,kt as PackageProfileEditSidePanel,$t as PackageProfileHeader,Bt as PackageProfileList,Vt as PackageProfilesEmptyState,N as usePackageProfiles};
