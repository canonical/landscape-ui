import{A as F,B as $,n as R,k as c,G as E,j as a,d as u,p as N,x as Q}from"./index-ClG4AO4X.js";import{S as D}from"./SidePanelFormButtons-BitiQJ8Y.js";import{u as G,T as O}from"./TagsAddConfirmationModal-7Ju_QsGR.js";import{u as W}from"./useInstances-BPK1gQa7.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";const J=({selected:e})=>{const d=F(),{notify:h}=$(),{closeSidePanel:p}=R(),{addTagsToInstancesQuery:y,getAllInstanceTagsQuery:x}=W(),[n,r]=c.useState([]),{isFetchingProfileChanges:T,profileChangesCount:C,refetchProfileChanges:b}=G({instance_ids:e.map(s=>s.id),tags:n,limit:10},{enabled:!1}),{value:j,setFalse:v,setTrue:w}=E(),[l,S]=c.useState(""),{mutateAsync:L,isPending:g}=y,{data:A,isLoading:B}=x(),m=async()=>{try{await L({query:e.map(({id:s})=>`id:${s}`).join(" OR "),tags:n}),p(),h.success({title:"Tags assigned",message:`Tags successfully assigned to ${Q(e.length,`"${e[0]?.title??""}" instance`,`${e.length} instances`)}`})}catch(s){d(s)}},I=async()=>{const s=await b();if(!s.isSuccess){d(s.error);return}s.data.data.count?w():await m()},o=A?.data.results.filter(s=>s.toLowerCase().includes(l.toLowerCase()))??[],P=()=>{o.every(s=>n.includes(s))?r([]):r(o)},M=c.useMemo(()=>[{accessor:"value",Header:a.jsxs(a.Fragment,{children:[a.jsx(u.CheckboxInput,{inline:!0,label:null,disabled:o.every(s=>e.every(i=>i.tags.includes(s))),checked:o.every(s=>n.includes(s)||e.every(i=>i.tags.includes(s))),indeterminate:o.some(s=>e.some(i=>!i.tags.includes(s)))&&o.some(s=>e.some(i=>i.tags.includes(s))),onChange:P}),"Name"]}),Cell:({row:{original:{value:s},index:i}})=>{const k=()=>{if(n.includes(s)){r(n.toSpliced(n.findIndex(t=>t==s),1));return}e.every(t=>t.tags.includes(s))||r([...n,s])};return a.jsx(u.CheckboxInput,{inline:!0,label:s,disabled:e.every(t=>t.tags.includes(s)),name:`tag-${i}`,checked:n.includes(s)||e.every(t=>t.tags.includes(s)),indeterminate:!n.includes(s)&&e.some(t=>t.tags.includes(s))&&e.some(t=>!t.tags.includes(s)),onChange:k})}}],[n,o]);if(B)return a.jsx(N,{});const f=o.map(s=>({value:s}));return a.jsxs(a.Fragment,{children:[a.jsx("p",{children:"Adding tags will associate the instance with the profiles that tag is linked to. This may change configurations on your instance."}),a.jsx(u.SearchBox,{value:l,onChange:s=>{S(s)}}),a.jsx(u.ModularTable,{emptyMsg:"No tags found",columns:M,data:[...f.filter(({value:s})=>s.toLowerCase().startsWith(l.toLowerCase())),...f.filter(({value:s})=>!s.toLowerCase().startsWith(l.toLowerCase()))]}),a.jsx(D,{onSubmit:I,submitButtonDisabled:!n.length,submitButtonLoading:g||T,submitButtonText:"Assign"}),j&&a.jsx(O,{instances:e,tags:n,onConfirm:m,confirmButtonLoading:g,close:v,profileChangesCount:C})]})};export{J as default};
