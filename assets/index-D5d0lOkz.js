import{e as he,u as me,b as D,j as e,i as X,c as q,r as j,d as i,f as B,t as U,y as Z}from"./index-CQs3wXys.js";import{u as pe}from"./useMutation-D9dT1mhA.js";import{u as I}from"./useQuery-DrwXjJzc.js";import{E as ge}from"./EmptyState-DNkTeHW1.js";import{T as _e}from"./TablePagination-DIiSuGph.js";import{I as F}from"./InfoItem-BtzYmEJw.js";import{u as xe}from"./formik.esm-C_3GEhhV.js";import{h as $}from"./moment-Cl4UOzQZ.js";import{a as T,f as fe,c as be}from"./index.esm-85kEx3I1.js";import{S as ee}from"./SidePanelFormButtons-CTKwSU1t.js";import{f as Q}from"./helpers-BS8e34QL.js";import{u as je,D as ve}from"./downshift.esm-DQPiC2RL.js";import"./SidePanelFormButtons.module-CoxOjuX8.js";const z=()=>{const a=he(),n=me(),t=D(),u=(r,_={})=>{const{instance_id:h,...s}=r;return I({queryKey:["snaps",{...r}],queryFn:()=>a.get(`computers/${h}/snaps/installed`,{params:s}),..._})},o=(r,_={})=>I({queryKey:["snaps",{...r}],queryFn:()=>a.get(`computers/${r.instance_id}/snaps/available?name_startswith=${r.query}`),..._}),p=(r,_={})=>I({queryKey:["snaps",{...r}],queryFn:()=>a.get(`computers/${r.instance_id}/snaps/${r.name}/info`),..._}),v=pe({mutationKey:["snaps","action"],mutationFn:r=>a.post("snaps",r),onSuccess:()=>{n.invalidateQueries(["snaps"]).catch(t)}});return{getSnapsQuery:u,getAvailableSnapInfo:p,getAvailableSnaps:o,snapsActionQuery:v}},Ce="_bold_c3q8d_1",Se="_radioGroup_c3q8d_5",ye="_marginTop_c3q8d_10",w={bold:Ce,radioGroup:Se,marginTop:ye};var c=(a=>(a.Switch="Switch",a.Refresh="Refresh",a.Uninstall="Uninstall",a.Hold="Hold",a.Unhold="Unhold",a))(c||{});const ne=a=>a.reduce((n,t)=>(t.held_until!==null?n.held++:n.unheld++,n),{held:0,unheld:0}),ae=(a,n)=>a.filter(t=>n.includes(t.snap.id)),M={deliver_immediately:T(),randomize_delivery:T(),deliver_delay_window:fe().min(0,"Delivery delay must be greater than or equal to 0"),deliver_after:T().test({test:a=>a?$(a).isValid():!0,message:"You have to enter a valid date and time"})},Ne=a=>{switch(a){case c.Switch:return{...M,release:T().required("Release is required")};case c.Hold:return{...M,hold:T(),hold_until:T().test({test:n=>n?$(n).isValid():!0,message:"You have to enter a valid date and time"})};default:return{...M}}},we={single:{[c.Refresh]:"This will update {snapName} to the latest version available. Automatic updates will resume, and {snapName} will be upgraded based on the regular refresh schedule.",[c.Uninstall]:"This will remove the Snap from your system",[c.Hold]:"This will pause automatic updates for that particular snap. {snapName} will maintain the current version",[c.Unhold]:"This will resume automatic updates for that particular Snap. {snapName} will be eligible for the latest version upgrades based on the regular refresh schedule."},multiple:{[c.Refresh]:"This will update the selected snaps to the latest version available. Automatic updates will resume, and the snaps will be upgraded based on the regular refresh schedule.",[c.Uninstall]:"This will remove the selected snaps from your system",[c.Hold]:"Holding a Snap will pause automatic updates for that particular snap.",[c.Unhold]:"Unholding a Snap will resume automatic updates for that particular snap."}},$e=(a,n)=>{if(a===c.Switch)return null;const{held:t,unheld:u}=ne(n),o=we[n.length===1?"single":"multiple"][a].replaceAll("{snapName}",n[0].snap.name);return a===c.Refresh||a===c.Uninstall||n.length===1||t===0||u===0?e.jsx("p",{children:o}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:o}),e.jsxs("span",{children:["You selected ",n.length," snaps. This will:"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:[a===c.Hold?"hold":"unhold"," ",Q({count:a===c.Hold?u:t,singular:"snap"})]}),e.jsxs("li",{children:["leave"," ",Q({count:a===c.Hold?t:u,singular:"snap"})," ",a===c.Hold?"held":"unheld"]})]})]})},Fe=({installedSnaps:a,type:n,instanceId:t})=>{const u=D(),{notify:o}=X(),{closeSidePanel:p}=q(),{snapsActionQuery:v,getAvailableSnapInfo:r}=z(),{mutateAsync:_,isLoading:h}=v,{data:s}=r({instance_id:t,name:a[0].snap.name},{enabled:n===c.Switch}),d=j.useMemo(()=>(s==null?void 0:s.data["channel-map"].sort((g,b)=>g.channel.architecture.localeCompare(b.channel.architecture)).map(g=>({label:`${g.channel.name} - ${g.channel.architecture}`,value:`${g.channel.name} - ${g.channel.architecture}`})))??[],[s==null?void 0:s.data]),f=Ne(n),x=a.length===1?a[0]:null,C=x?s==null?void 0:s.data["channel-map"][0]:null,l=xe({initialValues:{release:void 0,hold:n===c.Hold?"forever":void 0,hold_until:n===c.Hold?"":void 0,deliver_immediately:!0,randomize_delivery:!1,deliver_delay_window:0,deliver_after:""},validationSchema:be().shape(f),onSubmit:async g=>{try{_({computer_ids:[t],action:n===c.Uninstall?"remove":n===c.Switch?"refresh":n.toLowerCase(),snaps:a.map(E=>{var k,P;return{name:E.snap.name,channel:g.release?(k=s==null?void 0:s.data["channel-map"].find(N=>`${N.channel.name} - ${N.channel.architecture}`===g.release))==null?void 0:k.channel.name:void 0,revision:(P=s==null?void 0:s.data["channel-map"].find(N=>`${N.channel.name} - ${N.channel.architecture}`===g.release))==null?void 0:P.revision.toString(),time:g.hold==="forever"?"forever":g.hold_until?$(g.hold_until).format():void 0}}),deliver_after:g.deliver_immediately?void 0:g.deliver_after?$(g.deliver_after).format():void 0,deliver_after_window:g.randomize_delivery?g.deliver_delay_window:void 0}),p();const b=n===c.Hold?"held":n===c.Unhold?"unheld":`${n.toLowerCase()}ed`;o.success({message:`You queued ${x?x.snap.name:`${a.length} snaps`} to be ${b}.`})}catch(b){u(b)}}});j.useEffect(()=>{C&&n===c.Switch&&!l.values.release&&l.setFieldValue("release",`${C.channel.name} - ${C.channel.architecture}`)},[C]);const S=g=>{l.setFieldValue("hold",g.currentTarget.value),g.currentTarget.value==="date"&&l.setFieldValue("hold_until",$().toISOString().slice(0,16))},y=g=>{const b=g.currentTarget.value==="true";l.setFieldValue("deliver_immediately",b),b||l.setFieldValue("deliver_after",$().toISOString().slice(0,16))};return e.jsxs(i.Form,{onSubmit:l.handleSubmit,noValidate:!0,children:[$e(n,a),n===c.Switch&&e.jsx(i.Select,{label:"release",labelClassName:"p-text--small p-text--small-caps",options:d,disabled:d.length===0,...l.getFieldProps("release")}),n===c.Hold&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:w.bold,children:"Hold"}),e.jsxs("div",{className:w.radioGroup,children:[e.jsx(i.Input,{type:"radio",label:"Indefinitely",...l.getFieldProps("hold"),onChange:S,checked:l.values.hold==="forever",value:"forever"}),e.jsx(i.Input,{type:"radio",label:"Select date",...l.getFieldProps("hold"),onChange:S,checked:l.values.hold==="date",value:"date"})]}),l.values.hold==="date"&&e.jsx(i.Input,{type:"datetime-local",error:l.touched.hold_until&&l.errors.hold_until?l.errors.hold_until:void 0,...l.getFieldProps("hold_until")})]}),e.jsx("span",{className:B(w.bold,w.marginTop),children:"Delivery time"}),e.jsxs("div",{className:w.radioGroup,children:[e.jsx(i.Input,{type:"radio",label:"As soon as possible",name:"deliver_immediately",value:"true",onChange:y,checked:l.values.deliver_immediately}),e.jsx(i.Input,{type:"radio",label:"Scheduled",name:"deliver_immediately",value:"false",onChange:y,checked:!l.values.deliver_immediately})]}),!l.values.deliver_immediately&&e.jsx(i.Input,{type:"datetime-local",label:"Deliver after",labelClassName:"u-off-screen",...l.getFieldProps("deliver_after"),error:l.touched.deliver_after&&l.errors.deliver_after}),e.jsx("span",{className:B(w.bold,w.marginTop),children:"Randomise delivery over a time window"}),e.jsxs("div",{className:w.radioGroup,children:[e.jsx(i.Input,{type:"radio",label:"No",...l.getFieldProps("randomize_delivery"),onChange:async()=>{await l.setFieldValue("randomize_delivery",!1),await l.setFieldValue("deliver_delay_window",0)},checked:!l.values.randomize_delivery}),e.jsx(i.Input,{type:"radio",label:"Yes",...l.getFieldProps("randomize_delivery"),onChange:()=>l.setFieldValue("randomize_delivery",!0),checked:l.values.randomize_delivery})]}),l.values.randomize_delivery&&e.jsx(i.Input,{type:"number",inputMode:"numeric",min:0,label:"Delivery delay window",labelClassName:"u-off-screen",help:"Time in minutes",...l.getFieldProps("deliver_delay_window"),error:l.touched.deliver_delay_window&&l.errors.deliver_delay_window?l.errors.deliver_delay_window:void 0}),e.jsx(ee,{submitButtonText:n,submitButtonAppearance:n===c.Uninstall?"negative":"positive",submitButtonDisabled:h})]})},Be="_container_1nwlw_1",Te="_noWrap_1nwlw_5",O={container:Be,noWrap:Te},ke="_toBeConfirmedCard_t8sqm_1",Ae="_toBeConfirmedCard__buttons_t8sqm_6",He="_toBeConfirmedCard__confirmButton_t8sqm_11",qe="_bold_t8sqm_16",L={toBeConfirmedCard:ke,toBeConfirmedCard__buttons:Ae,toBeConfirmedCard__confirmButton:He,bold:qe},Ue=({name:a,handleDeleteToBeConfirmedItem:n,handleAddToSelectedItems:t,instanceId:u})=>{var f;const[o,p]=j.useState(""),{getAvailableSnapInfo:v}=z(),{data:r,isLoading:_}=v({instance_id:u,name:a}),h=r==null?void 0:r.data,s=j.useMemo(()=>h?h["channel-map"].sort((x,C)=>x.channel.architecture.localeCompare(C.channel.architecture)).map(x=>({label:`${x.channel.name} - ${x.channel.architecture}`,value:`${x.channel.name} - ${x.channel.architecture}`})):[],[h]),d=x=>{p(x)};return j.useEffect(()=>{s.length>0&&p(s[0].value)},[s]),e.jsxs(e.Fragment,{children:[_&&e.jsx(U,{}),h&&e.jsx(i.Form,{name:"add-snap",onSubmit:x=>{x.preventDefault(),t({"snap-id":h["snap-id"],name:h.name,snap:h.snap,revision:h["channel-map"].find(C=>`${C.channel.name} - ${C.channel.architecture}`===o).revision.toString(),channel:h["channel-map"].find(C=>`${C.channel.name} - ${C.channel.architecture}`===o).channel.name})},children:e.jsxs("li",{className:B("p-autocomplete__result p-list__item p-card u-no-margin--bottom u-no-padding--bottom",L.toBeConfirmedCard),children:[e.jsx("div",{className:L.bold,children:h.name}),e.jsx("span",{children:e.jsx("small",{className:"u-text--muted p-text--small",children:h.snap.publisher["display-name"]})}),e.jsx(i.Select,{label:e.jsx("span",{className:"u-text--muted p-text--small",children:"Release"}),required:!0,value:o,options:s,onChange:x=>d(x.currentTarget.value),help:((f=h["channel-map"].find(x=>`${x.channel.name} - ${x.channel.architecture}`===o))==null?void 0:f.confinement)==="classic"?e.jsxs("span",{children:[e.jsx("i",{className:"p-icon--warning"}),"This release requires classic permission."," ",e.jsxs("a",{href:"https://snapcraft.io/docs",target:"_blank",rel:"noreferrer",children:["Learn more",e.jsx("i",{className:"p-icon--external-link"})]})]}):void 0}),e.jsxs("div",{className:L.toBeConfirmedCard__buttons,children:[e.jsx(i.Button,{small:!0,className:L.toBeConfirmedCard__confirmButton,type:"submit",appearance:"positive",children:"Add"}),e.jsx(i.Button,{small:!0,type:"button",appearance:"base",onClick:()=>n(),children:"Cancel"})]})]})})]})},ze="_container_1d6qb_1",Pe="_suggestionsContainer_1d6qb_5",Ve="_pointer_1d6qb_12",Le="_highlighted_1d6qb_17",De="_selectedContainer_1d6qb_21",H={container:ze,suggestionsContainer:Pe,pointer:Ve,highlighted:Le,selectedContainer:De},Ee=200,Ie=(a,n)=>{const t=a.toLowerCase(),u=n.toLowerCase(),o=t.indexOf(u);return o>=0?e.jsxs(e.Fragment,{children:[a.substring(0,o),e.jsx("strong",{children:a.substring(o,o+n.length)}),a.substring(o+n.length)]}):a},Me=({instanceId:a,selectedItems:n,setSelectedItems:t,setConfirming:u})=>{var K;const[o,p]=j.useState(""),[v,r]=j.useState(!1),[_,h]=j.useState(),[s,d]=j.useState(""),f=j.useRef(null),x=D(),{getAvailableSnaps:C}=z(),{data:l,isFetching:S}=C({instance_id:a,query:o},{enabled:o.length>2}),y=((K=l==null?void 0:l.data)==null?void 0:K.results)??[],g=m=>!n.map(A=>A.name).includes(m),b=y.filter(m=>g(m.name));j.useEffect(()=>{var m;_||(m=f.current)==null||m.focus()},[_]);const E=m=>{t(n.filter(A=>A.name!==m))},k=()=>{h(null),u&&u(!1)},P=()=>{_||r(!1)},N=()=>{d(""),p("")},Y=()=>{s.length>2?r(!0):r(!1)},le=m=>{d(m),m.length>2&&p(m)},ie=je(()=>{try{Y()}catch(m){x(m)}},Ee),oe=m=>{t([...n,m]),N(),k()},re=m=>{m&&(u(!0),h(m))},ce=m=>{m.key==="Escape"?m.currentTarget.blur():ie()},G=!v&&s.length<3?"Min 3. characters":y.length===0&&o&&!S?`No snaps found by "${o}"`:null;return e.jsxs("div",{className:H.container,children:[e.jsx(ve,{onSelect:re,itemToString:()=>"",isOpen:v,children:({getInputProps:m,getItemProps:A,getMenuProps:de,highlightedIndex:ue})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(i.SearchBox,{...m(),placeholder:"Search for available snaps",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:s,ref:f,disabled:!!_,onChange:le,onClear:N,onBlur:P,onFocus:Y,onKeyUp:ce}),G?e.jsx("span",{className:"p-form-help-text",children:G}):null,v&&(b.length>0||S)?e.jsx("ul",{className:B("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",H.suggestionsContainer),...de(),children:_&&a?e.jsx(Ue,{handleAddToSelectedItems:oe,handleDeleteToBeConfirmedItem:k,name:_.name,instanceId:a},_["snap-id"]):S?e.jsx(U,{}):b.map((V,W)=>e.jsxs("li",{className:B("p-list__item",H.pointer,{[H.highlighted]:ue===W}),...A({item:V,index:W}),children:[e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:Ie(V.name,o)}),e.jsx("div",{children:e.jsx("small",{className:"u-text-muted",children:V.snap.publisher["display-name"]})})]},V["snap-id"]))}):null]})}),e.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:n.length?n.map(m=>e.jsxs("li",{className:B("p-autocomplete__result p-list__item p-card u-no-margin--bottom",H.selectedContainer),children:[e.jsxs("div",{children:[e.jsx("div",{children:m.name}),e.jsx("span",{children:e.jsx("small",{className:"u-text--muted p-text--small",children:`${m.snap.publisher["display-name"]} | ${m.channel}`})})]}),e.jsx(i.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>E(m.name),children:e.jsx("i",{className:"p-icon--delete"})})]},m["snap-id"])):null})]})},se=({instanceId:a})=>{const[n,t]=j.useState([]),[u,o]=j.useState(!1),p=D(),{notify:v}=X(),{closeSidePanel:r}=q(),{snapsActionQuery:_}=z(),{mutateAsync:h,isLoading:s}=_,d=async()=>{try{await h({computer_ids:[a],snaps:n.map(f=>({name:f.name,channel:f.channel,revision:f.revision})),action:"install"}),r(),v.success({message:`You queued ${n.length===1?`snap ${n[0].name}`:`${n.length} snaps`} to be installed.`}),t([])}catch(f){p(f)}};return e.jsxs(e.Fragment,{children:[e.jsx(Me,{instanceId:a,selectedItems:n,setSelectedItems:f=>t(f),setConfirming:f=>o(f)}),e.jsx(ee,{submitButtonDisabled:n.length===0||u||s,cancelButtonDisabled:s,submitButtonText:"Install snaps",submitButtonAppearance:"positive",onSubmit:d})]})},te=({instanceId:a,selectedSnapIds:n,installedSnaps:t,sidePanel:u=!1})=>{const{setSidePanelContent:o}=q(),p=t.length===1?t[0]:null,v=ae(t,n),{held:r,unheld:_}=ne(v),h=d=>{const f=d===c.Unhold?r:d===c.Hold?_:n.length,x=p?`${d} ${p.snap.name}${d===c.Switch?"'s channel":""}`:`${d} ${f} ${f===1?"snap":"snaps"}`;o(x,e.jsx(j.Suspense,{fallback:e.jsx(U,{}),children:e.jsx(Fe,{instanceId:a,installedSnaps:v,type:d})}))},s=()=>{o("Install snap",e.jsx(se,{instanceId:a}))};return e.jsxs("div",{className:O.container,children:[!u&&e.jsxs(i.Button,{type:"button",onClick:s,hasIcon:!0,className:O.noWrap,children:[e.jsx("i",{className:"p-icon--plus"}),e.jsx("span",{children:"Install"})]}),e.jsxs("div",{className:B("p-segmented-control is-small",O.noWrap),children:[p&&u&&e.jsxs(i.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:n.length===0,onClick:()=>h(c.Switch),children:[e.jsx("i",{className:"p-icon--fork"}),e.jsx("span",{children:"Switch channel"})]}),e.jsxs(i.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:n.length===0,onClick:()=>{h(c.Uninstall)},children:[e.jsx("i",{className:"p-icon--delete"}),e.jsx("span",{children:"Uninstall"})]}),((p==null?void 0:p.held_until)===null||!u)&&e.jsxs(i.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:_===0,onClick:()=>{h(c.Hold)},children:[e.jsx("i",{className:"p-icon--pause"}),e.jsx("span",{children:"Hold"})]}),((p==null?void 0:p.held_until)!==null||!u)&&e.jsxs(i.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:r===0,onClick:()=>{h(c.Unhold)},children:[e.jsx("i",{className:"p-icon--play"}),e.jsx("span",{children:"Unhold"})]}),e.jsxs(i.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:n.length===0,onClick:()=>{h(c.Refresh)},children:[e.jsx("i",{className:"p-icon--change-version"}),e.jsx("span",{children:"Refresh"})]})]},"buttons")]})},Oe=({instanceId:a,installedSnap:n})=>e.jsxs(e.Fragment,{children:[e.jsx(te,{instanceId:a,selectedSnapIds:[n.snap.id],installedSnaps:[n],sidePanel:!0}),e.jsxs(i.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(i.Col,{size:12,children:e.jsx(F,{label:"snap name",value:n.snap.name})}),e.jsx(i.Col,{size:6,children:e.jsx(F,{label:"channel",value:n.tracking_channel})}),e.jsx(i.Col,{size:6,children:e.jsx(F,{label:"version",value:n.version})}),e.jsx(i.Col,{size:6,children:e.jsx(F,{label:"confinement",value:n.confinement})}),e.jsx(i.Col,{size:6,children:e.jsx(F,{label:"held until",value:n.held_until?$(n.held_until).format(Z):"-"})}),e.jsx(i.Col,{size:12,children:e.jsx(F,{label:"summary",value:n.snap.summary??"-"})}),e.jsx(i.Col,{size:12,children:e.jsx(F,{label:"publisher",value:n.snap.publisher.username})})]})]}),Re="_details_9i6m6_1",Ye="_pause_9i6m6_5",J={details:Re,pause:Ye},Ge=({instanceId:a,installedSnaps:n,selectedSnapIds:t,isSnapsLoading:u,setSelectedSnapIds:o})=>{const{setSidePanelContent:p}=q(),v=s=>{t.includes(s.original.snap.id)?o(t.filter(d=>d!==s.original.snap.id)):o([...t,s.original.snap.id])},r=()=>{o(t.length!==0?[]:n.map(({snap:s})=>s.id))},_=s=>{p(`${s.snap.name} details`,e.jsx(j.Suspense,{fallback:e.jsx(U,{}),children:e.jsx(Oe,{instanceId:a,installedSnap:s})}))},h=j.useMemo(()=>[{Header:e.jsxs(e.Fragment,{children:[e.jsx(i.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:r,checked:t.length===n.length&&n.length!==0,indeterminate:t.length!==0&&t.length<n.length}),e.jsx("span",{children:"Name"})]}),accessor:"name",Cell:({row:s})=>e.jsxs(e.Fragment,{children:[e.jsx(i.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:s.original.snap.name}),inline:!0,checked:t.includes(s.original.snap.id),onChange:()=>{v(s)}}),e.jsx(i.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{_(s.original)},"aria-label":`Show details of snap ${s.original.snap.name}`,children:s.original.snap.name})]})},{Header:"Channel",accessor:"channel",Cell:({row:s})=>e.jsx(e.Fragment,{children:s.original.tracking_channel})},{Header:"Held until",accessor:"held_until",Cell:({row:s})=>e.jsx(e.Fragment,{children:s.original.held_until?$(s.original.held_until).format(Z):"-"})},{Header:"Version",accessor:"version",Cell:({row:s})=>e.jsx(e.Fragment,{children:s.original.held_until?e.jsx(i.Tooltip,{message:"This snap is held",children:s.original.version}):s.original.version}),getCellIcon:({row:s})=>s.original.held_until?`pause ${J.pause}`:null},{Header:"Summary",accessor:"summary",className:J.details,Cell:({row:s})=>e.jsx(e.Fragment,{children:s.original.snap.summary})}],[t,n]);return e.jsx(e.Fragment,{children:e.jsx(i.ModularTable,{columns:h,data:n,emptyMsg:u?"Loading...":"No snaps found from the search"})})},Ke="_container_1qwn6_1",We="_searchContainer_1qwn6_6",Qe="_selectContainer_1qwn6_10",Je="_cta_1qwn6_15",R={container:Ke,searchContainer:We,selectContainer:Qe,cta:Je},Xe=({instanceId:a,onSnapsSearchChange:n,selectedSnapIds:t,installedSnaps:u})=>{const[o,p]=j.useState(""),v=r=>{r.preventDefault(),n(o)};return e.jsxs("div",{className:R.container,children:[e.jsx("div",{className:R.searchContainer,children:e.jsx(i.Form,{onSubmit:v,noValidate:!0,children:e.jsx(i.SearchBox,{shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:o,"aria-label":"Snap search",onChange:r=>p(r),onSearch:()=>n(o),onClear:()=>{p(""),n("")}})})}),e.jsx("div",{className:R.cta,children:e.jsx(te,{instanceId:a,selectedSnapIds:t,installedSnaps:ae(u,t)})})]})},Ze=({instanceId:a})=>{var y,g;const[n,t]=j.useState(1),[u,o]=j.useState(20),[p,v]=j.useState([]),[r,_]=j.useState(""),{getSnapsQuery:h}=z(),{setSidePanelContent:s}=q(),{data:d,isLoading:f}=h({instance_id:a,limit:u,offset:(n-1)*u,search:r}),x=b=>{_(b),t(1),v([])},C=b=>{o(b),t(1)},l=()=>{s("Install snap",e.jsx(se,{instanceId:a}))},S=j.useMemo(()=>{var b;return((b=d==null?void 0:d.data)==null?void 0:b.results)??[]},[d]);return e.jsxs(e.Fragment,{children:[!r&&f&&n===1&&u===20&&e.jsx(U,{}),!f&&!r&&(!d||d.data.results.length===0)&&e.jsx(ge,{title:"You haven't installed any snaps yet",body:e.jsx("p",{className:"u-no-margin--bottom",children:"Install Snaps by clicking the button below."}),cta:[e.jsx(i.Button,{appearance:"positive",onClick:l,children:"Install Snap"},"empty-state-install-snap")]}),(r||n!==1||u!==20||d&&(d==null?void 0:d.data.results.length)>0)&&e.jsxs(e.Fragment,{children:[e.jsx(Xe,{instanceId:a,selectedSnapIds:p,onSnapsSearchChange:x,installedSnaps:S}),e.jsx(Ge,{instanceId:a,selectedSnapIds:p,setSelectedSnapIds:b=>v(b),installedSnaps:S,isSnapsLoading:f})]}),e.jsx(_e,{currentPage:n,totalItems:(y=d==null?void 0:d.data)==null?void 0:y.count,paginate:b=>{t(b)},pageSize:u,setPageSize:C,currentItemCount:(g=d==null?void 0:d.data)==null?void 0:g.results.length})]})},gn=Ze;export{gn as default};
