import{b,g as I,i as m,j as t,a7 as p,L as j,B as g,D as x,d as c,w as v,E as _,I as a}from"./index-DZF0LgVk.js";import{S as y}from"./SidePanelTablePagination-D1S1a3Fs.js";import{B as d}from"./Blocks-7Yxu9fHE.js";import{b as S}from"./ScriptsTabs-5PdPkC8i.js";import"./index-CMS_kIg5.js";import{u as f}from"./useRoles-DlzB6KGu.js";import{g as A,a as T,S as P}from"./index-CuEOaEax.js";import"./TruncatedCell-BR0xotE4.js";import"./HeaderWithSearch-BW1L9XJe.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./useExpandableRow-XVaXaj3C.js";const C=({id:e,...s})=>{const i=b(),{data:r,isLoading:o}=I({queryKey:["scriptProfileActivities",{id:e,...s}],queryFn:async()=>i.get(`script-profiles/${e}/activities`,{params:s})});return{activities:r?.data.results??[],activitiesCount:r?.data.count,isGettingActivities:o}},L=({activities:e})=>{const s=m.useMemo(()=>[{Header:"Run",accessor:"creation_time",Cell:({row:{original:i}})=>t.jsx(j,{className:"font-monospace",to:`/activities?query=parent-id%3A${i.id}`,children:g(i.creation_time).utc().format(x)})},{Header:"Status",accessor:"activity_status",Cell:({row:{original:i}})=>p[i.activity_status].label,getCellIcon:({row:{original:i}})=>p[i.activity_status].icon}],[e]);return t.jsx(c.ModularTable,{columns:s,data:e})},k=({profile:e})=>{const[s,i]=m.useState(1),[r,o]=m.useState(20),{activities:l,activitiesCount:u,isGettingActivities:n}=C({id:e.id,limit:r,offset:(s-1)*r});return n?t.jsx(v,{}):l.length?t.jsxs(t.Fragment,{children:[t.jsx(L,{activities:l}),t.jsx(y,{currentPage:s,pageSize:r,paginate:i,setPageSize:o,totalItems:u})]}):t.jsx(_,{title:"No runs found",body:"The profile has not run yet."})},E=({actions:e,profile:s})=>s.archived?t.jsxs(c.Notification,{inline:!0,title:"Profile archived:",severity:"caution",children:["The profile was archived on"," ",g(s.last_edited_at).format(x),"."]}):t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[t.jsxs(c.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:e.edit,children:[t.jsx(c.Icon,{name:"edit"}),t.jsx("span",{children:"Edit"})]}),t.jsxs(c.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:e.archive,children:[t.jsx(c.Icon,{name:"archive"}),t.jsx("span",{children:"Archive"})]})]})}),G=({profile:e})=>{const{script:s,isScriptLoading:i}=S(e.script_id),{getAccessGroupQuery:r}=f(),{data:o,isLoading:l}=r();if(i||l)return t.jsx(v,{});const u=o?.data.find(h=>h.name==e.access_group)?.title||e.access_group,n=e.activities.last_activity;return t.jsxs(d,{children:[t.jsx(d.Item,{children:t.jsxs(a,{children:[t.jsx(a.Item,{label:"Title",value:e.title}),t.jsx(a.Item,{label:"Status",value:A(e)}),t.jsx(a.Item,{label:"Script",value:s?t.jsx(j,{to:"/scripts?tab=scripts",state:{scriptId:s.id},children:s.title}):null}),t.jsx(a.Item,{label:"Access group",value:u}),t.jsx(a.Item,{label:"Run as user",value:e.username}),t.jsx(a.Item,{label:"Time limit",value:`${e.time_limit}s`})]})}),t.jsx(d.Item,{children:t.jsxs(a,{children:[t.jsx(a.Item,{label:"Trigger",large:!0,value:T(e)||null}),e.trigger.trigger_type!=="event"&&t.jsx(a.Item,{label:"Next run",value:e.trigger.next_run?`${g(e.trigger.next_run).utc().format(x)}`:null}),t.jsx(a.Item,{label:"Last run",value:n?t.jsx(j,{to:`/activities?query=parent-id%3A${n.id}`,children:g(n.creation_time).utc().format(x)}):null})]})}),t.jsx(d.Item,{title:"Association",children:t.jsxs(a,{children:[t.jsx(a.Item,{label:"Associated instances",large:!0,value:t.jsx(P,{scriptProfile:e})}),t.jsx(a.Item,{label:"Tags",large:!0,value:e.all_computers?"All instances":e.tags.join(", ")||null,type:"truncated"})]})})]})},N="_tabs_1ks86_1",F={tabs:N},K=({actions:e,profile:s})=>{const[i,r]=m.useState("info"),l=[{label:"Info",id:"info"},{label:"Activity history",id:"activity-history"}].map(({label:u,id:n})=>({label:u,active:i==n,onClick:()=>{r(n)}}));return t.jsxs(t.Fragment,{children:[t.jsx(E,{actions:e,profile:s}),t.jsx(c.Tabs,{listClassName:F.tabs,links:l}),i=="info"&&t.jsx(G,{profile:s}),i=="activity-history"&&t.jsx(k,{profile:s})]})};export{K as default};
