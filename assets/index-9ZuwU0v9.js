const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B_mlG8Ip.js","assets/index-BWFRbB2q.js","assets/index-wy2-Usix.css","assets/MultiSelectField-C9fu80fm.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-DXt9vdwe.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/useRoles-DQwpURfB.js","assets/PageMain-Bc83aYWg.js","assets/PageMain--v5xNZ5p.css","assets/HeaderWithSearch-D_aOWktC.js","assets/HeaderWithSearch-C2lwo0VI.css"])))=>i.map(i=>d[i]);
import{f as q,e as H,i as z,g as j,h as B,r as g,z as k,y as I,J as Q,B as T,K as E,F as M,j as e,m as d,I as _,N as L,l as F,af as V,c as O,ag as K,o as S,E as Y,_ as D,v as C,D as N}from"./index-BWFRbB2q.js";import{P as U,a as W,b as G}from"./PageMain-Bc83aYWg.js";import{u as $}from"./useRoles-DQwpURfB.js";import{M as w}from"./MultiSelectField-C9fu80fm.js";import{S as J}from"./SidePanelFormButtons-DXt9vdwe.js";import{H as X}from"./HeaderWithSearch-D_aOWktC.js";function A(){const s=q(),n=H(),o=z(),m=(a,b={})=>B({queryKey:["administrators"],queryFn:async()=>n.get("GetAdministrators"),...b}),v=j({mutationFn:async a=>n.get("InviteAdministrator",{params:a}),onSuccess:async()=>s.invalidateQueries({queryKey:["invitations"]})}),h=j({mutationFn:async a=>n.get("DisableAdministrator",{params:a}),onSuccess:async()=>s.invalidateQueries({queryKey:["administrators"]})}),p=j({mutationFn:async({id:a,...b})=>o.put(`administrators/${a}`,b),onSuccess:async()=>Promise.all([s.invalidateQueries({queryKey:["administrators"]}),s.invalidateQueries({queryKey:["roles"]})])}),c=(a,b={})=>B({queryKey:["invitations",a],queryFn:async()=>o.get("/invitations",{params:a}),...b}),r=j({mutationFn:async a=>o.delete(`/invitations/${a.id}`),onSuccess:async()=>s.invalidateQueries({queryKey:["invitations"]})}),u=j({mutationFn:async a=>o.post(`/invitations/${a.id}`),onSuccess:async()=>s.invalidateQueries({queryKey:["invitations"]})});return{getAdministratorsQuery:m,inviteAdministratorQuery:v,disableAdministratorQuery:h,editAdministratorQuery:p,getInvitationsQuery:c,revokeInvitationQuery:r,resendInvitationQuery:u}}const Z=({administrator:s})=>{const[n,o]=g.useState(s);g.useEffect(()=>{o(s)},[s]);const{notify:m}=k(),v=I(),{disableAdministratorQuery:h,editAdministratorQuery:p}=A(),{getRolesQuery:c}=$(),{data:r}=c(),u=(r==null?void 0:r.data.map(({name:i})=>({label:i,value:i})))??[],{mutateAsync:a}=p,{mutateAsync:b,isPending:y}=h,f=async()=>{try{await b({email:n.email})}catch(i){v(i)}},l=async i=>{try{await a({id:s.id,roles:i.roles}),o(x=>({...x,roles:i.roles})),m.success({title:"Permission changes have been queued",message:`You changed ${n.name}'s roles`})}catch(x){v(x)}},t=Q({initialValues:{roles:[]},validationSchema:T().shape({roles:E().of(M()).min(1,"At least one role is required")}),onSubmit:l});return g.useEffect(()=>{t.setValues({roles:n.roles})},[n]),e.jsxs(d.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[e.jsxs(d.ConfirmationButton,{type:"button",className:"has-icon",confirmationModalProps:{title:"Disable Administrator",children:e.jsx("p",{children:"This will remove the administrator from your Landscape organisation."}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:y,confirmButtonLoading:y,onConfirm:f},children:[e.jsx(d.Icon,{name:d.ICONS.delete,"aria-hidden":"true"}),e.jsx("span",{children:"Remove"})]}),e.jsxs(d.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(d.Col,{size:6,children:e.jsx(_,{label:"Name",value:n.name})}),e.jsx(d.Col,{size:6,children:e.jsx(_,{label:"Email",value:n.email})}),e.jsx(d.Col,{size:12,children:e.jsx(_,{label:"Timezone",value:e.jsx(L,{})})}),e.jsx(d.Col,{size:12,children:e.jsx(_,{label:"Identity URL",value:e.jsx(L,{})})})]}),e.jsx(w,{variant:"condensed",label:"Roles",items:u,selectedItems:u.filter(({value:i})=>t.values.roles.includes(i)),placeholder:"Select roles",onItemsUpdate:i=>t.setFieldValue("roles",i.map(({value:x})=>x)),error:t.touched.roles&&typeof t.errors.roles=="string"?t.errors.roles:void 0}),e.jsx(J,{submitButtonDisabled:t.isSubmitting||t.values.roles.length===n.roles.length&&t.values.roles.every(i=>n.roles.includes(i)),submitButtonText:"Save changes"})]})},ee="_footer_nfyyh_1",te="_multiSelect_nfyyh_7",R={footer:ee,multiSelect:te},se=({administrator:s,roleOptions:n})=>{const o=I(),{notify:m}=k(),{editAdministratorQuery:v}=A(),{mutateAsync:h}=v,p=async({roles:r})=>{try{await h({id:s.id,roles:r}),m.success({title:"Permission changes have been queued",message:`You changed ${s.name}'s roles`})}catch(u){o(u)}},c=Q({initialValues:{roles:[]},validationSchema:T().shape({roles:E().of(M()).min(1,"At least one role is required")}),onSubmit:p});return g.useEffect(()=>{c.setValues({roles:s.roles})},[s.roles]),e.jsx(d.Form,{onSubmit:c.handleSubmit,noValidate:!0,children:e.jsx(w,{required:!0,variant:"condensed",className:R.multiSelect,items:n,selectedItems:n.filter(({value:r})=>c.values.roles.includes(r)),onItemsUpdate:r=>c.setValues({roles:r.map(({value:u})=>u)}),placeholder:"Select roles",error:c.touched.roles&&typeof c.errors.roles=="string"?c.errors.roles:void 0,dropdownFooter:e.jsxs("div",{className:R.footer,children:[e.jsx(d.Button,{type:"button",dense:!0,small:!0,className:"u-no-margin--bottom",disabled:c.values.roles.length===s.roles.length&&s.roles.every(r=>c.values.roles.includes(r)),onClick:()=>c.setFieldValue("roles",s.roles),children:"Revert"}),e.jsx(d.Button,{type:"submit",dense:!0,small:!0,appearance:"positive",className:"u-no-margin--bottom",disabled:c.values.roles.length===s.roles.length&&s.roles.every(r=>c.values.roles.includes(r)),children:"Save changes"})]})})})},ne="_roles_1cuab_1",ae="_actions_1cuab_2",ie="_table_1cuab_6",P={roles:ne,actions:ae,table:ie},oe=({administrators:s,emptyMessage:n,roles:o})=>{const m=I(),{setSidePanelContent:v}=F(),{disableAdministratorQuery:h}=A(),{mutateAsync:p,isPending:c}=h,r=g.useMemo(()=>s,[s]),u=g.useMemo(()=>o.map(({name:l})=>({label:l,value:l})),[o]),a=async l=>{try{await p({email:l})}catch(t){m(t)}},b=l=>{v(l.name,e.jsx(Z,{administrator:l}))},y=g.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:l})=>e.jsx(d.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{b(l.original)},children:l.original.name})},{accessor:"email",Header:"Email"},{accessor:"roles",className:P.roles,Header:"Roles",Cell:({row:l})=>e.jsx(se,{administrator:l.original,roleOptions:u})},{accessor:"actions",className:P.actions,Cell:({row:l})=>e.jsx(d.ConfirmationButton,{className:"u-no-margin--bottom u-no-padding--left is-small has-icon",type:"button",appearance:"base","aria-label":`Remove ${l.original.name}`,confirmationModalProps:{title:`Remove ${l.original.name}`,children:e.jsx("p",{children:"This will remove the administrator from your Landscape organisation."}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:c,confirmButtonLoading:c,onConfirm:()=>a(l.original.email)},children:e.jsx(d.Tooltip,{position:"top-center",message:"Remove",children:e.jsx(d.Icon,{name:d.ICONS.delete,className:"u-no-margin--left u-no-padding"})})})}],[r,u]),f=l=>{const t={};return l.column.id==="name"?t.role="rowheader":l.column.id==="email"?t["aria-label"]="Email":l.column.id==="roles"?t["aria-label"]="Roles":l.column.id==="actions"&&(t["aria-label"]="Actions"),t};return e.jsx(d.ModularTable,{columns:y,data:r,getCellProps:f,emptyMsg:n,className:P.table})},re=()=>e.jsxs(e.Fragment,{children:[e.jsx(X,{}),e.jsx(V,{filtersToDisplay:["search"]})]}),le=({administrators:s})=>{const{search:n,pageSize:o,currentPage:m}=O(),{getRolesQuery:v}=$(),{data:h}=v(),c=(()=>{const u=n.trim().toLowerCase();return u?s.filter(a=>a.email.toLowerCase().includes(u)||a.name.toLowerCase().includes(u)||a.roles.some(b=>b.toLowerCase().includes(u))):s})(),r=c.filter((u,a)=>a>=(m-1)*o&&a<m*o)??[];return e.jsxs(e.Fragment,{children:[e.jsx(re,{}),e.jsx(oe,{administrators:r,emptyMessage:n.trim()?`No administrators found with the search: "${n.trim()}"`:"You have no administrators on your Landscape organisation",roles:(h==null?void 0:h.data)??[]}),r.length>0&&e.jsx(K,{totalItems:c.length,currentItemCount:r.length})]})},ce=g.lazy(()=>D(()=>import("./index-B_mlG8Ip.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),de=()=>{const{setSidePanelContent:s}=F(),{getAdministratorsQuery:n}=A(),{data:o,isLoading:m}=n(),v=()=>{s("Invite administrator",e.jsx(g.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(ce,{})}))};return e.jsxs(e.Fragment,{children:[m&&e.jsx(S,{}),!m&&(!o||!o.data.length)&&e.jsx(Y,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no administrators in your Landscape organization."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[e.jsx(d.Button,{type:"button",appearance:"positive",onClick:v,children:"Invite Administrator"},"invite-administrator")],icon:"user",title:"No administrators found"}),!m&&o&&o.data.length>0&&e.jsx(le,{administrators:o.data})]})},me=()=>{const s=I(),{notify:n}=k(),{getInvitationsQuery:o,revokeInvitationQuery:m,resendInvitationQuery:v}=A(),{data:h}=o(),p=g.useMemo(()=>(h==null?void 0:h.data.results.sort((t,i)=>C(i.creation_time).diff(C(t.creation_time))))??[],[h]),{mutateAsync:c,isPending:r}=m,{mutateAsync:u,isPending:a}=v,b=async t=>{try{await c({id:t.id}),n.success({message:`${t.name}â€™${t.name.endsWith("s")?"":"s"} invitation has been revoked`,title:"You revoked an administrator invite"})}catch(i){s(i)}},y=async t=>{try{await u({id:t.id}),n.success({message:`${t.name} will receive a new invitation email`,title:"You resent an administrator invite"})}catch(i){s(i)}},f=g.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"email",Header:"Email"},{accessor:"creation_time",Header:"Invited",Cell:({row:t})=>C(t.original.creation_time).format(N)},{accessor:"expiration_time",Header:"Expires",Cell:({row:t})=>C(t.original.creation_time).add(14,"days").format(N)},{accessor:"actions",Cell:({row:t})=>e.jsxs("div",{className:"u-align-text--right",children:[e.jsx(d.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Revoke invitation for ${t.original.name}`,children:e.jsxs("p",{children:["This action will prevent ",t.original.name," from joining your Landscape organisation."]}),confirmButtonLabel:"Revoke invitation",confirmButtonAppearance:"negative",confirmButtonDisabled:r,confirmButtonLoading:r,onConfirm:()=>b(t.original)},children:"Revoke"}),e.jsx(d.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Resend invitation for ${t.original.name}`,children:e.jsxs("p",{children:[t.original.name," will receive a new invitation email."]}),confirmButtonLabel:"Resend invitation",confirmButtonAppearance:"positive",confirmButtonDisabled:a,confirmButtonLoading:a,onConfirm:()=>y(t.original)},children:"Resend"})]})}],[p]),l=t=>{const i={};return t.column.id==="name"?i.role="rowheader":t.column.id==="email"?i["aria-label"]="Email":t.column.id==="creation_time"?i["aria-label"]="Invited":t.column.id==="expiration_time"?i["aria-label"]="Expires":t.column.id==="actions"&&(i["aria-label"]="Actions"),i};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-text--muted p-text--small",children:"Unclaimed invitations expire after 14 days."}),e.jsx(d.ModularTable,{columns:f,data:p,getCellProps:l,emptyMsg:"You have no unclaimed invitations."})]})},ue="_tabPanel_1n8p7_1",he={tabPanel:ue},ge=[{label:"Administrators",id:"tab-link-administrators"},{label:"Invites",id:"tab-link-invites"}],ve=()=>{const[s,n]=g.useState("tab-link-administrators");return e.jsxs(e.Fragment,{children:[e.jsx(d.Tabs,{listClassName:"u-no-margin--bottom",links:ge.map(({label:o,id:m})=>({label:o,id:m,role:"tab",active:m===s,onClick:()=>n(m)}))}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":s,className:he.tabPanel,children:e.jsxs(g.Suspense,{fallback:e.jsx(S,{}),children:[s==="tab-link-administrators"&&e.jsx(de,{}),s==="tab-link-invites"&&e.jsx(me,{})]})})]})},be=g.lazy(()=>D(()=>import("./index-B_mlG8Ip.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),pe=()=>{const{setSidePanelContent:s}=F(),n=()=>{s("Invite administrator",e.jsx(g.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(be,{})}))};return e.jsxs(U,{children:[e.jsx(W,{title:"Administrators",actions:[e.jsx(d.Button,{type:"button",onClick:n,children:"Invite administrator"},"invite-administrator")]}),e.jsx(G,{children:e.jsx(ve,{})})]})},Ce=Object.freeze(Object.defineProperty({__proto__:null,default:pe},Symbol.toStringTag,{value:"Module"}));export{Ce as i,A as u};
