import{r as m,l as I,j as e,m as s,y as S,z as A,a as k,V as z,J as T,ap as $,L as F,E as N,I as r,N as w}from"./index-uBNuGD_s.js";import{a as P}from"./EmployeeList-1kJudUQm.js";import{g as x}from"./helpers-BDle3XAS.js";import"./InstancesPageActions-BiTtwJ24.js";import{u as E}from"./useInstances-D8I8Bnnt.js";import"./TruncatedCell-COALXWFW.js";import"./helpers-BfQh3lw-.js";const B=({employee:t})=>{const[a,i]=m.useState(!1),{closeSidePanel:o}=I(),c=()=>{i(!0)},d=m.useCallback(()=>{i(!1),o()},[]);return e.jsxs("div",{children:[e.jsxs(s.Button,{hasIcon:!0,onClick:c,children:[e.jsx(s.Icon,{name:t.is_active?"pause":"play"}),e.jsx("span",{children:t.is_active?"Deactivate":"Activate"})]}),a&&e.jsx(P,{employee:t,handleClose:d})]})},L="_toggleButton_gtdm0_1",M="_menu_gtdm0_6",g={toggleButton:L,menu:M},R=({instance:t})=>{const a=S(),{notify:i}=A(),o=k(),{openActivityDetails:c}=z(),{removeInstancesQuery:d,sanitizeInstanceQuery:j}=E(),{mutateAsync:v,isPending:b}=d,{mutateAsync:y,isPending:C}=j,n=T({initialValues:{confirmationText:"",selectedAction:""},onSubmit:async h=>{if(h.selectedAction==="sanitize")try{const{data:l}=await y({computer_id:t.id,computer_title:t.title});i.success({title:`You have successfully initiated Sanitization for ${t.title}`,message:`Sanitizing for ${t.title} has been queued in Activities. The data will be permanently irrecoverable once complete.`,actions:[{label:"View details",onClick:()=>{c(l)}}]}),n.resetForm()}catch(l){a(l)}else if(h.selectedAction==="remove")try{await v({computer_ids:[t.id]}),i.success({title:`You have successfully removed ${t.title}`,message:`${t.title} has been removed from Landscape. To manage it again, you will need to re-register it in Landscape.`}),n.resetForm()}catch(l){a(l)}}}),p=()=>{n.resetForm()},_=[{children:e.jsxs(e.Fragment,{children:[e.jsx(s.Icon,{name:"machines"}),e.jsx("span",{children:"View details"})]}),"aria-label":`View ${t.title} instance details`,hasIcon:!0,onClick:async()=>o(`${$}instances/${t.id}`)},{children:e.jsxs(e.Fragment,{children:[e.jsx(s.Icon,{name:"tidy"}),e.jsx("span",{children:"Sanitize"})]}),"aria-label":`Sanitize ${t.title} instance`,hasIcon:!0,onClick:async()=>n.setFieldValue("selectedAction","sanitize")},{children:e.jsxs(e.Fragment,{children:[e.jsx(s.Icon,{name:s.ICONS.delete}),e.jsx("span",{children:"Remove from Landscape"})]}),"aria-label":"Remove from Landscape",hasIcon:!0,onClick:async()=>n.setFieldValue("selectedAction","remove")}];return e.jsxs(e.Fragment,{children:[e.jsx(s.ContextualMenu,{position:"left",className:g.menu,toggleClassName:g.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(s.Icon,{name:"contextual-menu","aria-hidden":!0}),toggleProps:{"aria-label":`${t.title} profile actions`},links:_}),n.values.selectedAction==="remove"&&e.jsx(s.ConfirmationModal,{title:`Remove ${t.title} instance`,confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:b||n.values.confirmationText!==`remove ${t.title}`,onConfirm:()=>{n.handleSubmit()},close:p,children:e.jsxs(s.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:[e.jsxs("p",{children:["Removing this ",t.title," will delete all associated data and free up one license slot for another computer to be registered."]}),e.jsxs("p",{children:["Type ",e.jsxs("b",{children:["remove ",t.title]})," to confirm."]}),e.jsx(s.Input,{type:"text",...n.getFieldProps("confirmationText")})]})}),n.values.selectedAction==="sanitize"&&e.jsx(s.ConfirmationModal,{title:`Sanitize "${t.title}" instance`,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:C||n.values.confirmationText!==`sanitize ${t.title}`,onConfirm:()=>{n.handleSubmit()},close:p,children:e.jsxs(s.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:[e.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",t.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]}),e.jsxs("p",{children:["Type ",e.jsxs("b",{children:["sanitize ",t.title]})," to confirm."]}),e.jsx(s.Input,{type:"text",...n.getFieldProps("confirmationText")})]})})]})},V="_container_a5d6r_1",D="_actions_a5d6r_7",H="_link_a5d6r_15",u={container:V,actions:D,link:H},O=()=>({column:t})=>{const a={};return t.id==="name"?a.role="rowheader":t.id==="status"?a["aria-label"]="Status":t.id==="recovery_key"?a["aria-label"]="Recovery key":t.id==="actions"&&(a["aria-label"]="Actions"),a},f={title:"No instances found",body:"There are no instances associated with this employee"},Y=({instances:t})=>{const a=m.useMemo(()=>[{accessor:"name",Header:"name",Cell:({row:i})=>e.jsx(F,{className:u.link,to:i.original.parent?`/instances/${i.original.parent.id}/${i.original.id}`:`/instances/${i.original.id}`,children:i.original.title})},{accessor:"status",Header:"status",Cell:({row:{original:i}})=>{const{label:o}=x(i);return o},getCellIcon:({row:{original:i}})=>{const{icon:o}=x(i);return o}},{accessor:"recovery_key",Header:"recovery key",Cell:()=>"****************"},{accessor:"actions",className:u.actions,Header:"actions",Cell:({row:{original:i}})=>e.jsx(R,{instance:i})}],[t]);return e.jsxs("div",{className:u.container,children:[e.jsx("h4",{className:"p-heading--5",children:"Instances associated"}),t&&t.length>0?e.jsx(s.ModularTable,{data:t,columns:a,getCellProps:O()}):e.jsx(N,{title:f.title,body:f.body})]})},X=({employee:t})=>{var a,i;return e.jsxs(e.Fragment,{children:[e.jsx(B,{employee:t}),e.jsxs(s.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(s.Col,{size:6,children:e.jsx(r,{label:"name",value:t.name})}),e.jsx(s.Col,{size:6,children:e.jsx(r,{label:"email",value:t.email})})]}),e.jsxs(s.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(s.Col,{size:6,children:e.jsx(r,{label:"employee groups",value:((i=(a=t.groups)==null?void 0:a.map(o=>o.name))==null?void 0:i.join(", "))||"N/A",type:"truncated"})}),e.jsx(s.Col,{size:6,children:e.jsx(r,{label:"status",value:t.is_active?"active":"inactive"})})]}),e.jsx(r,{label:"autoinstall file",value:t.autoinstall_file?`${t.autoinstall_file.filename}, v${t.autoinstall_file.version}`:e.jsx(w,{})}),e.jsx(Y,{instances:t.computers})]})};export{X as default};
