import{d as y,c as f,o as w,e as b,n as x,g as k,j as t,h as o,l as j}from"./index-BhA4J3ko.js";import{E as F}from"./EmptyState-C71tSpTG.js";import{u as C,P as S,a as E,b as O}from"./PageMain-BGNK0xG-.js";import{b as P}from"./SidePanelFormButtons.module-yv6Qz3cN.js";import{u as R}from"./useMutation-D6hW2Vr2.js";import{c as T,a as g,d}from"./index.esm-B8rBEOcC.js";const q="_registrationContainer_1mmbg_1",v={registrationContainer:q};function p(){const s=y(),n=f(),i=(a,u={})=>C({queryKey:["preferences"],queryFn:()=>s.get("preferences"),...u}),c=R({mutationKey:["preferences","change"],mutationFn:a=>s.put("preferences",a),onSuccess:()=>n.invalidateQueries({queryKey:["preferences"]})});return{getOrganisationPreferences:i,changeOrganisationPreferences:c}}const I=/^(?!.*[;#])(?!.*\s$).+$/,N=T().shape({title:g().required("This field is required"),use_registration_key:d(),registration_password:g().when("use_registration_key",{is:!0,then:s=>s.required("This field is required").min(3,"Registration key must be at least 3 characters").matches(I,"The key cannot contain trailing spaces or ; or # symbols")}),auto_register_new_computers:d()}),A=({organisationPreferences:s})=>{const{updateUser:n,user:i}=w(),c=b(),{notify:a}=x(),{changeOrganisationPreferences:u}=p(),{mutateAsync:_}=u,m={title:s.title,use_registration_key:!!s.registration_password,registration_password:s.registration_password||"",auto_register_new_computers:s.auto_register_new_computers},e=k({initialValues:m,validationSchema:N,onSubmit:async r=>{try{await _({title:r.title,registration_password:r.registration_password,auto_register_new_computers:r.auto_register_new_computers}),r.title!==s.title&&n({...i,current_account:r.title,accounts:i.accounts.map(l=>l.title===s.title?{...l,title:r.title}:l)}),e.resetForm({values:{auto_register_new_computers:r.auto_register_new_computers,registration_password:r.registration_password,title:r.title,use_registration_key:r.use_registration_key}}),a.success({title:"Your changes have been saved",message:`Changes made to organisation settings for ${r.title} have been successfully saved.`})}catch(l){c(l)}}}),h=r=>{e.getFieldProps("registration_password").onChange(r),e.setFieldValue("registration_password",""),e.setFieldTouched("registration_password",!1),e.setFieldError("registration_password",void 0),e.setFieldValue("auto_register_new_computers",!1)};return t.jsxs(o.Form,{noValidate:!0,onSubmit:e.handleSubmit,children:[t.jsx(o.Input,{label:"Organisation's name",type:"text",help:"Visible to others in organisation",error:e.touched.title&&e.errors.title?e.errors.title:void 0,...e.getFieldProps("title")}),t.jsx(o.Input,{label:"Use registration key",type:"checkbox",checked:e.values.use_registration_key,...e.getFieldProps("use_registration_key"),onChange:h}),e.values.use_registration_key&&t.jsxs("div",{className:v.registrationContainer,children:[t.jsx(o.Input,{labelClassName:"u-off-screen",label:"Registration key","aria-label":"Registration key",type:"text",error:e.touched.registration_password&&e.errors.registration_password?e.errors.registration_password:void 0,...e.getFieldProps("registration_password")}),t.jsx(o.Input,{label:"Auto register new computers",type:"checkbox",checked:e.values.auto_register_new_computers,help:"This will automatically accept new instances that register to your organisation.",...e.getFieldProps("auto_register_new_computers")})]}),t.jsx("p",{className:"p-form-help-text",children:"When this feature is enabled, new computers must be enrolled using the key that's defined in the field."}),t.jsx("div",{className:P.buttons,children:t.jsx(o.Button,{className:"u-no-margin--bottom",appearance:"positive",type:"submit",disabled:e.isSubmitting||!e.dirty,children:"Save changes"})})]})},M=()=>{const{getOrganisationPreferences:s}=p(),{data:n,isLoading:i,refetch:c}=s(),a=n==null?void 0:n.data,u=()=>{c()};return t.jsxs(S,{children:[t.jsx(E,{title:"General"}),t.jsxs(O,{container:"medium",children:[i&&t.jsx(j,{}),!i&&!a&&t.jsx(F,{title:"Could not load general information",icon:"connected",cta:[t.jsx(o.Button,{appearance:"positive",onClick:u,children:"Try again"},"refetch")]}),a&&!i&&t.jsx(A,{organisationPreferences:a})]})]})};export{M as default};
