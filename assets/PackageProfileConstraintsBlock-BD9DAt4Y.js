import{r as d,j as n,g as l}from"./index-BRihK9aF.js";import{C}from"./CellInput-D-UoOVzx.js";import{T as h,C as g,a as N,E as w}from"./index-oILi9vlb.js";const j="_action_fofcj_1",b="_cell_fofcj_7",_="_input_fofcj_18",P="_inputWrapper_fofcj_26",c={action:j,cell:b,input:_,inputWrapper:P},v=async(e,s,a,o)=>{await e.setFieldValue(`constraints[${s}]${[a]}`,o),await e.setFieldTouched(`constraints[${s}]${[a]}`,!0),["rule","version"].includes(a)&&(o!==""?await e.setFieldValue(`constraints[${s}].notAnyVersion`,!0):e.values.constraints[s][a==="rule"?"version":"rule"]===""&&await e.setFieldValue(`constraints[${s}].notAnyVersion`,!1))},T=(e,s,a)=>{var i,u,p;if(!((i=e.errors.constraints)!=null&&i[s])||!((p=(u=e.touched.constraints)==null?void 0:u[s])!=null&&p[a]))return;const o=e.errors.constraints[s];return typeof o!="string"?o[a]:void 0},y=async(e,s)=>{await e.setFieldValue("constraints",e.values.constraints.filter((a,o)=>o!==s)),e.touched.constraints&&(e.touched.constraints.splice(s,1),await e.setTouched({...e.touched,constraints:e.touched.constraints}))},I=e=>({handleConstraintPropChange:async(s,a,o)=>{await v(e,s,a,o)},handleConstraintRowDelete:async s=>{await y(e,s)},getConstraintsErrorByIndex:(s,a)=>T(e,s,a)}),E=({column:e})=>{const s={};return s.className=c.cell,e.id==="package_name"?s.role="rowheader":e.id==="action"?s["aria-label"]="Action":e.id==="constraint"?s["aria-label"]="Constraint":e.id==="version"?s["aria-label"]="Version":e.id==="rule"&&(s["aria-label"]="Rule"),s},O=({formik:e})=>{d.useEffect(()=>{e.submitCount!==0&&(async()=>await e.setTouched({...e.touched,constraints:new Array(e.values.constraints.length).fill(h)}))()},[e.submitCount]);const s=d.useMemo(()=>e.values.constraints,[e.values.constraints]),{handleConstraintPropChange:a,handleConstraintRowDelete:o,getConstraintsErrorByIndex:i}=I(e),u=d.useMemo(()=>[{accessor:"constraint",Header:"Constraint",Cell:({row:{index:t}})=>n.jsx(l.Select,{label:"Constraint",labelClassName:"u-off-screen",className:c.input,wrapperClassName:c.inputWrapper,options:g,...e.getFieldProps(`constraints[${t}].constraint`),onChange:r=>a(t,"constraint",r.target.value),error:i(t,"constraint")})},{accessor:"package",Header:"Package",Cell:({row:{index:t}})=>n.jsx(C,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:c.input,wrapperClassName:c.inputWrapper,...e.getFieldProps(`constraints[${t}].package`),onChange:r=>a(t,"package",r),error:i(t,"package")})},{accessor:"rule",Header:"Rule",Cell:({row:{index:t}})=>n.jsx(l.Select,{label:"Rule",labelClassName:"u-off-screen",className:c.input,wrapperClassName:c.inputWrapper,...e.getFieldProps(`constraints[${t}].rule`),options:N,onChange:r=>a(t,"rule",r.target.value),error:i(t,"rule")})},{accessor:"version",Header:"Version",Cell:({row:{index:t}})=>n.jsx(C,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:c.input,wrapperClassName:c.inputWrapper,...e.getFieldProps(`constraints[${t}].version`),onChange:r=>a(t,"version",r),error:i(t,"version")})},{accessor:"action",className:c.action,Cell:({row:t})=>n.jsx(l.Button,{type:"button",hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding","aria-label":"Delete constraint row",onClick:()=>o(t.index),children:n.jsx(l.Icon,{name:l.ICONS.delete,className:"u-no-margin--left u-no-margin--right"})})}],[s,e.errors.constraints,e.touched.constraints]),p=async()=>{if(await e.setFieldValue("constraints",[w,...e.values.constraints]),e.touched.constraints){const t=[];for(let r=e.values.constraints.length;r>0;r--)e.touched.constraints[r-1]&&(t[r]=e.touched.constraints[r-1]);await e.setTouched({constraints:t})}};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"u-align-text--right",children:n.jsxs(l.Button,{type:"button",hasIcon:!0,onClick:p,children:[n.jsx(l.Icon,{name:l.ICONS.plus,className:"u-no-margin--left"}),n.jsx("span",{children:"Add new constraint"})]})}),n.jsx(l.ModularTable,{columns:u,data:s,getCellProps:E,emptyMsg:"No constraints added yet.",className:"u-no-margin--bottom"}),e.touched.constraints&&typeof e.errors.constraints=="string"&&n.jsx("div",{className:"is-error",children:n.jsxs("p",{className:"p-form-validation__message u-no-margin--top",children:[n.jsx("strong",{children:"Error: "}),n.jsx("span",{children:e.errors.constraints})]})})]})};export{O as P};
