const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CrAqMr-2.js","assets/index-Cw5WBMVF.js","assets/index-CZSrOujQ.css","assets/helpers-CtDc2nrO.js","assets/helpers-BBw35fIw.js","assets/InstancesPageActions-n8_mgW7J.js","assets/useInstances-YfJMlPqN.js","assets/InstancesPageActions-CswnIe9I.css","assets/helpers-1SmgROkh.css","assets/TruncatedCell-C7F34y83.js","assets/TruncatedCell-CoXbu3VM.css","assets/index-DdrmM_Gj.css"])))=>i.map(i=>d[i]);
import{i as v,f as j,g as _,c as C,h as I,B as L,j as t,n as u,C as D,m as E,ai as T,am as S,r as h,p as F,$ as P,k as M,ae as $,L as w,N as g}from"./index-Cw5WBMVF.js";import{T as x}from"./TruncatedCell-C7F34y83.js";const N=e=>e.is_active?"Active":"Inactive",O=()=>{const e=v(),a=j(),{mutateAsync:s,isPending:o}=_({mutationKey:["employee","patch"],mutationFn:async({id:l,...n})=>e.patch(`employees/${l}`,n),onSuccess:async()=>a.invalidateQueries({queryKey:["employee"]})});return{patchEmployee:s,isPending:o}},k={listenToUrlParams:!0},R=e=>{switch(e){case"active":return!0;case"inactive":return!1;default:return}},me=(e,a,s={})=>{var y,b;const o=v(),{autoinstallFiles:l,currentPage:n,employeeGroups:m,pageSize:p,search:i,status:r}=C();e={...k,...e};const c={...e.listenToUrlParams?{with_autoinstall_file:!0,with_computers:!0,with_groups:!0,is_active:R(r),employee_group_ids:m.length>0?m:void 0,autoinstall_file_ids:l.length>0?l:void 0,limit:p,offset:(n-1)*p,search:i??void 0}:a},{data:d,isPending:A,isFetching:z}=I({queryKey:["employees",c,e],queryFn:async()=>o.get("employees",{params:c}),...s});return{employees:((y=d==null?void 0:d.data)==null?void 0:y.results)||[],isPending:A,isFetching:z,count:(b=d==null?void 0:d.data)==null?void 0:b.count}},B=()=>{const e=v(),a=j(),{mutateAsync:s,isPending:o}=_({mutationKey:["employee","patch"],mutationFn:async({id:l,...n})=>e.post(`employees/${l}/offboard`,n),onSuccess:async()=>a.invalidateQueries({queryKey:["employee"]})});return{deactivateEmployee:s,isDeactivating:o}},H=({employee:e,handleClose:a})=>{const{notify:s}=L(),{patchEmployee:o,isPending:l}=O(),n=async()=>{await o({id:e.id,is_active:!0}),s.success({title:`You have successfully activated ${e.name}`,message:`${e.name} will be able to log in to Landscape and register new instances with their account.`}),a()};return t.jsx(u.ConfirmationModal,{confirmButtonLabel:"Activate",onConfirm:n,confirmButtonAppearance:"positive",title:`Activate ${e.name}`,close:a,confirmButtonDisabled:l,confirmButtonLoading:l,children:t.jsxs("p",{children:["This will allow ",e.name," to log in to Landscape and register new instances with their account."]})})},V="Irreversibly deletes all data on disks of associated instances. Proceed with caution",q="This will remove all instances associated with this employee from Landscape.",G={sanitizationConfirmationText:"",sanitizeInstances:!1,removeFromLandscapeConfirmationText:"",removeFromLandscape:!1},K="_title_1azx9_1",U="_tooltipPositionElement_1azx9_5",Y="_additionalActionContainer_1azx9_9",f={title:K,tooltipPositionElement:U,additionalActionContainer:Y},Q=(e,a)=>a.removeFromLandscape&&a.sanitizeInstances?`Off-board ${e}`:`Deactivate ${e}`,W=e=>e.removeFromLandscape&&e.sanitizeInstances?"Off-board":e.removeFromLandscape?"Deactivate and remove":e.sanitizeInstances?"Deactivate and sanitize":"Deactivate",Z=e=>!!(e.sanitizeInstances&&e.sanitizationConfirmationText!=="sanitize instances"||e.removeFromLandscape&&e.removeFromLandscapeConfirmationText!=="remove instances"||e.sanitizeInstances&&e.removeFromLandscape&&e.sanitizationConfirmationText!=="sanitize instances"&&e.removeFromLandscapeConfirmationText!=="remove instances"),J=(e,a,s)=>a&&s?{notificationTitle:`You have successfully deactivated ${e} and initiated both Sanitization and Removal of their instances`,notificationMessage:"Sanitization and removal of this employee’s instances have been queued. The data will be permanently irrecoverable once complete. To manage the instances again, they will need to be re-registered in Landscape."}:a?{notificationTitle:`You have successfully deactivated ${e} and initiated sanitization of their instances`,notificationMessage:`Sanitization of the ${e}’s instances has been queued in Activities. The data will be permanently irrecoverable once complete.`}:s?{notificationTitle:`You have successfully deactivated ${e} and initiated the Removal of their instances`,notificationMessage:"The removal of this employee’s instances has been queued. This process will delete all stored data. To manage them again, they will need to be re-registered in Landscape."}:{notificationTitle:`You have successfully deactivated ${e}`,notificationMessage:"This employee won’t be able to log in to Landscape or register new instances with their account."},X=({employee:e,handleClose:a})=>{const{notify:s}=L(),{deactivateEmployee:o,isDeactivating:l}=B(),n=D({initialValues:G,enableReinitialize:!0,onSubmit:async m=>{if(m.sanitizeInstances&&m.sanitizationConfirmationText!=="sanitize instances"||m.removeFromLandscape&&m.removeFromLandscapeConfirmationText!=="remove instances")return;await o({id:e.id,remove_instances:n.values.removeFromLandscape,sanitize_instances:n.values.sanitizeInstances}),n.resetForm(),a();const{notificationMessage:p,notificationTitle:i}=J(e.name,n.values.sanitizeInstances,n.values.removeFromLandscape);s.success({title:i,message:p})}});return t.jsx(u.ConfirmationModal,{title:Q(e.name,n.values),confirmButtonLabel:W(n.values),confirmButtonProps:{type:"submit"},onConfirm:()=>{n.handleSubmit()},close:a,confirmButtonDisabled:Z(n.values)||l,confirmButtonLoading:l,children:t.jsxs(u.Form,{noValidate:!0,onSubmit:m=>{m.preventDefault(),n.handleSubmit()},children:[t.jsxs("p",{children:["This will prevent ",e.name," from logging in to Landscape and from registering any new instances with their account"]}),t.jsx("b",{children:"Additional actions"}),t.jsxs("div",{children:[t.jsx(u.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:f.title,children:"Sanitize associated instances"}),t.jsxs(u.Tooltip,{position:"top-center",message:V,positionElementClassName:f.tooltipPositionElement,children:[t.jsx(u.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...n.getFieldProps("sanitizeInstances"),onChange:async m=>{n.getFieldProps("sanitizeInstances").onChange(m),await n.setFieldValue("sanitizationConfirmationText","")}}),n.values.sanitizeInstances&&t.jsxs("div",{className:f.additionalActionContainer,children:[t.jsx("p",{children:"Sanitization will permanently delete the encryption keys for associated instances, making its data completely irrecoverable. This action cannot be undone. Please confirm you wish to proceed."}),t.jsx(u.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"sanitize instances"})," to confirm"]}),"aria-label":"Sanitization confirmation text",placeholder:"sanitize instances",autoComplete:"off",type:"text",...n.getFieldProps("sanitizationConfirmationText")},"sanitizationConfirmationText")]}),t.jsx(u.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:f.title,children:"Remove associated instances from Landscape"}),t.jsxs(u.Tooltip,{position:"top-center",message:q,positionElementClassName:f.tooltipPositionElement,children:[t.jsx(u.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...n.getFieldProps("removeFromLandscape"),onChange:async m=>{n.getFieldProps("removeFromLandscape").onChange(m),await n.setFieldValue("removeFromLandscapeConfirmationText","")}}),n.values.removeFromLandscape&&t.jsxs("div",{className:f.additionalActionContainer,children:[t.jsx("p",{children:"This will remove all associated instances from Landscape, along with their stored data. To manage them again, you would need to re-register them in Landscape."}),t.jsx(u.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"remove instances"})," to confirm."]}),placeholder:"remove instances",autoComplete:"off","aria-label":"Remove from Landscape confirmation text",type:"text",...n.getFieldProps("removeFromLandscapeConfirmationText")},"removeFromLandscapeConfirmationText")]})]})]})})},ee=h.lazy(async()=>P(()=>import("./index-CrAqMr-2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),te=({employee:e})=>{const{setSidePanelContent:a}=E(),{value:s,setTrue:o,setFalse:l}=T(),{value:n,setTrue:m,setFalse:p}=T(),i=()=>{a("Employee details",t.jsx(h.Suspense,{fallback:t.jsx(F,{}),children:t.jsx(ee,{employee:e})}),"medium")},r=[{icon:"file",label:"View details","aria-label":`View ${e.name} employee details`,onClick:i}],c=[];return e.is_active?c.push({icon:"pause",label:"Deactivate","aria-label":`Deactivate ${e.name}`,onClick:m}):r.push({icon:"play",label:"Activate","aria-label":`Activate ${e.name}`,onClick:o}),t.jsxs(t.Fragment,{children:[t.jsx(S,{toggleAriaLabel:`${e.name} actions`,actions:r,destructiveActions:c}),s&&t.jsx(H,{employee:e,handleClose:l}),n&&t.jsx(X,{employee:e,handleClose:p})]})},se="_autoinstallFileHeaderTitle_fd2dm_1",ae={autoinstallFileHeaderTitle:se},ie=e=>({index:a})=>{const s={};return((e==null?void 0:e.column)==="computers"||(e==null?void 0:e.column)==="groups")&&e.row===a&&(s.className="expandedRow"),s},ne=e=>({column:a,row:{index:s}})=>{const o={};return a.id==="computers"?(o["aria-label"]="Associated instances",(e==null?void 0:e.column)===a.id&&e.row===s&&(o.className="expandedCell")):a.id==="groups"?(o["aria-label"]="Employee group",(e==null?void 0:e.column)===a.id&&e.row===s&&(o.className="expandedCell")):a.id==="name"?o.role="rowheader":a.id==="email"?o["aria-label"]="Email":a.id==="status"?o["aria-label"]="Status":a.id==="autoinstall_file"?o["aria-label"]="Assigned autoinstall file":a.id==="actions"&&(o["aria-label"]="Actions"),o},oe=e=>a=>{a&&(e.current=[...a.querySelectorAll("tbody tr")])},ce=h.lazy(async()=>P(()=>import("./index-CrAqMr-2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),ue=({employees:e})=>{const{setSidePanelContent:a}=E(),[s,o]=h.useState(null),l=h.useRef([]);M((s==null?void 0:s.column)==="computers"||(s==null?void 0:s.column)==="groups"?{current:l.current[s.row]}:[],i=>{i.target instanceof Element&&!i.target.closest("truncatedItem")&&o(null)});const n=(i,r)=>{o(c=>(c==null?void 0:c.column)===i&&c.row===r?null:{column:i,row:c&&["computers","groups"].includes(c.column)&&c.row<r?r-1:r})},m=i=>{a("Employee details",t.jsx(h.Suspense,{fallback:t.jsx(F,{}),children:t.jsx(ce,{employee:i})}),"medium")},p=h.useMemo(()=>[{accessor:"name",Header:"name",Cell:({row:{original:i}})=>t.jsx(u.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{m(i)},"aria-label":`Show details of user ${i.name}`,children:i.name})},{accessor:"email",Header:"email"},{accessor:"groups",Header:"employee group",Cell:({row:{original:i,index:r}})=>i.groups&&i.groups.length>0?t.jsx(x,{content:i.groups.map(c=>t.jsx(w,{to:`/settings/employees?tab=employee-groups&search=${c.name}`,className:"truncatedItem",children:c.name},c.group_id)),isExpanded:(s==null?void 0:s.column)==="groups"&&s.row===r,onExpand:()=>{n("groups",r)}}):t.jsx(g,{})},{accessor:"autoinstall_file",Header:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:ae.autoinstallFileHeaderTitle,children:"assigned autoinstall file"}),t.jsx(u.Tooltip,{message:"This configuration file is assigned based on the highest-priority group the user belongs to.",children:t.jsx(u.Icon,{name:"help"})})]}),Cell:({row:{original:i}})=>{var r,c;return(r=i.autoinstall_file)!=null&&r.filename?t.jsx("span",{children:(c=i.autoinstall_file)==null?void 0:c.filename}):t.jsx(g,{})}},{accessor:"status",Header:"status",Cell:({row:{original:i}})=>t.jsx("span",{children:N(i)}),getCellIcon:({row:{original:{is_active:i}}})=>i?"status-succeeded-small":"status-failed-small"},{accessor:"computers",Header:"associated instances",Cell:({row:{original:i,index:r}})=>{var c;return i.computers&&i.computers.length>0?t.jsx(x,{content:(c=i.computers)==null?void 0:c.map(d=>t.jsx(w,{className:"truncatedItem",to:`/instances/${d.id}`,children:d.title},d.id)),isExpanded:(s==null?void 0:s.column)==="computers"&&s.row===r,onExpand:()=>{n("computers",r)}}):t.jsx(g,{})}},{...$,Cell:({row:{original:i}})=>t.jsx(te,{employee:i})}],[e,s]);return t.jsx("div",{ref:oe(l),children:t.jsx(u.ModularTable,{columns:p,data:e,getCellProps:ne(s),getRowProps:ie(s),emptyMsg:"No employees found according to your search parameters."})})};export{H as A,X as D,ue as E,N as g,me as u};
