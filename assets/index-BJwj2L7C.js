const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D92ZgXL4.js","assets/index-b6eKq6Xg.js","assets/index-zG6MToCc.css","assets/SidePanelFormButtons-C4SuT2k4.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useGPGKeys-DpCmf5y1.js","assets/tests-DFnZqbNV.js","assets/useRoles-BzOqBiws.js","assets/useAPTSources-D3RPVD1z.js","assets/PageMain-Bm9Hd8Wp.js","assets/PageMain-C_v2-kHh.css","assets/constants-CbZfQ6VI.js","assets/RepositoryProfileListActions-CSUALknm.js","assets/ModalTablePagination-BgmGSj31.js","assets/ModalTablePagination-HDr0Q-Wm.css","assets/constants-DPpj5EsU.js","assets/constants-BnrFFkRy.css","assets/index-Cz9CfuJq.css"])))=>i.map(i=>d[i]);
import{m as P,f as x,t as y,v as j,r as i,j as e,i as u,d as c,ai as d,z as v,B as _,ah as S,a9 as M,a4 as L,ad as N,aM as C,y as w,E as F,a7 as R}from"./index-b6eKq6Xg.js";import{P as O,a as k,b as D}from"./PageMain-Bm9Hd8Wp.js";import{L as E}from"./constants-CbZfQ6VI.js";import{u as I}from"./RepositoryProfileListActions-CSUALknm.js";import{M as B}from"./ModalTablePagination-BgmGSj31.js";import"./constants-DPpj5EsU.js";const G=s=>{const o=P(),{data:t,isPending:r}=x({queryKey:["aptSources",s],queryFn:()=>o.get("repository/apt-source",{params:s})});return{aptSources:t?.data.results??[],isGettingAPTSources:r}},H=()=>{const s=P(),o=y(),{mutateAsync:t,isPending:r}=j({mutationKey:["aptSources","remove"],mutationFn:({id:n,...a})=>s.delete(`repository/apt-source/${n}`,{params:a}),onSuccess:()=>o.invalidateQueries({queryKey:["aptSources"]})});return{removeAPTSource:t,isRemovingAPTSource:r}},$=({repositoryProfilesResult:{isPending:s,data:o,error:t},goToNextPage:r,goToPreviousPage:n,pageNumber:a})=>{const l=i.useMemo(()=>[{Header:"Repository profile",accessor:"title"}],[]);return s?e.jsx(u,{}):o?e.jsxs(e.Fragment,{children:[e.jsx(c.ModularTable,{columns:l,data:o.data.results}),e.jsx(B,{current:a,max:Math.ceil(o.data.count/d),onNext:r,onPrev:n})]}):e.jsxs(c.Notification,{severity:"negative",children:['The associated repository profiles could not be loaded due to an unexpected error: "',t.message,'"']})},q=({aptSource:s,close:o,opened:t})=>{const{removeAPTSource:r,isRemovingAPTSource:n}=H(),{getRepositoryProfilesQuery:a}=I(),l=v(),{notify:f}=_(),{count:p,decrement:h,increment:A}=S(1),m=a({limit:d,offset:(p-1)*d,search:s.profiles},{enabled:!!s.profiles.length&&t}),T=async()=>{try{await r({id:s.id,disassociate_profiles:!0}),f.success({title:`You have successfully deleted the ${s.name} APT source.`,message:s.profiles.length?"It will no longer be available and it has been removed from its associated profiles.":"It will no longer be available to include in repository profiles."})}catch(b){l(b)}finally{o()}};return e.jsx(M,{className:"is-narrow",close:o,title:`Deleting ${s.name} APT source`,confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonLoading:n,confirmButtonDisabled:!!s.profiles.length&&m.isPending,onConfirm:T,isOpen:t,confirmationText:`delete ${s.name}`,children:s.profiles.length?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This APT source belongs to the following repository profiles."}),e.jsxs("p",{children:["If this source is deleted, it will no longer be included in its profiles. ",e.jsx("strong",{children:"This action is irreversible."})]}),e.jsx($,{repositoryProfilesResult:m,goToNextPage:A,goToPreviousPage:h,pageNumber:p})]}):e.jsxs("p",{children:["If this APT source is deleted, it will no longer be available to include in repository profiles."," ",e.jsx("strong",{children:"This action is irreversible."})]})})},Q=({aptSource:s})=>{const{value:o,setTrue:t,setFalse:r}=L();return e.jsxs(e.Fragment,{children:[e.jsx(N,{toggleAriaLabel:`${s.name} APT source actions`,destructiveActions:[{icon:c.ICONS.delete,label:"Delete","aria-label":`Remove ${s.name} APT source`,onClick:t}]}),e.jsx(q,{aptSource:s,close:r,opened:o})]})},z="_line_1odl9_1",K="_accessGroup_1odl9_10",g={line:z,accessGroup:K},U=s=>{const o={};switch(s.column.id){case"name":o.role="rowheader";break;case"access_group":o["aria-label"]="Access group";break;case"line":o["aria-label"]="Line";break;case"id":o["aria-label"]="Actions";break}return o},Y=({items:s})=>{const o=i.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"access_group",Header:"Access group",className:g.accessGroup},{accessor:"line",Header:"Line",className:g.line},{...E,Cell:({row:t})=>e.jsx(Q,{aptSource:t.original})}],[]);return e.jsx(C,{columns:o,data:i.useMemo(()=>s,[s.length]),emptyMsg:"No APT sources yet.",getCellProps:U})},V=i.lazy(async()=>R(()=>import("./index-D92ZgXL4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18])).then(s=>({default:s.NewAPTSourceForm}))),Z=()=>{const{setSidePanelContent:s}=w(),{aptSources:o,isGettingAPTSources:t}=G(),r=()=>{s("Add APT source",e.jsx(i.Suspense,{fallback:e.jsx(u,{}),children:e.jsx(V,{})}))};return e.jsxs(O,{children:[e.jsx(k,{title:"APT sources",actions:[e.jsx(c.Button,{appearance:"positive",onClick:r,type:"button",children:"Add APT source"},"new-key-button")]}),e.jsxs(D,{children:[t&&e.jsx(u,{}),!t&&o.length===0&&e.jsx(F,{title:"No APT sources found",icon:"connected",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You havenâ€™t added any APT sources yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage APT sources in Landscape"})]}),cta:[e.jsx(c.Button,{appearance:"positive",onClick:r,type:"button",children:"Add APT source"},"table-add-new-mirror")]}),!t&&o.length>0&&e.jsx(Y,{items:o})]})]})},te=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));export{Y as A,H as a,te as i,G as u};
