const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BKWzs0J_.js","assets/index-Pot9RTJb.js","assets/index-BMslluac.css","assets/MultiSelectField-BF9Hmpyh.js","assets/MultiSelectField-DOBW8uWL.css","assets/SidePanelFormButtons-DiyndOGQ.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/useRoles-BWOxuqdp.js","assets/useFetchOld-DEx3a7Yl.js","assets/PageMain-Dxe9_-sH.js","assets/PageMain-CaUGLZRc.css","assets/TablePagination-BekGHOy7.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-CfJzviMV.js","assets/NoData-BDvtfiNH.js","assets/moment-C5S46NFB.js"])))=>i.map(i=>d[i]);
import{e as V,h as z,f as j,g as F,r as p,s as k,q as I,t as Q,k as T,w as E,n as M,j as e,d as o,I as S,i as B,_ as D,o as _,E as H,D as L}from"./index-Pot9RTJb.js";import{P as O,a as K,b as Y}from"./PageMain-Dxe9_-sH.js";import{u as U}from"./useFetchOld-DEx3a7Yl.js";import{T as G}from"./TablePagination-BekGHOy7.js";import{u as $}from"./useRoles-BWOxuqdp.js";import{M as w}from"./MultiSelectField-BF9Hmpyh.js";import{S as W}from"./SidePanelFormButtons-DiyndOGQ.js";import{N}from"./NoData-BDvtfiNH.js";import{u as q}from"./usePageParams-CfJzviMV.js";import{h as C}from"./moment-C5S46NFB.js";function A(){const n=V(),s=U(),a=z(),m=(r,b={})=>F({queryKey:["administrators"],queryFn:()=>s.get("GetAdministrators"),...b}),g=j({mutationFn:r=>s.get("InviteAdministrator",{params:r}),onSuccess:()=>n.invalidateQueries({queryKey:["invitations"]})}),h=j({mutationFn:r=>s.get("DisableAdministrator",{params:r}),onSuccess:()=>n.invalidateQueries({queryKey:["administrators"]})}),v=j({mutationFn:({id:r,...b})=>a.put(`administrators/${r}`,b),onSuccess:()=>Promise.all([n.invalidateQueries({queryKey:["administrators"]}),n.invalidateQueries({queryKey:["roles"]})])}),i=(r,b={})=>F({queryKey:["invitations",r],queryFn:()=>a.get("/invitations",{params:r}),...b}),c=j({mutationFn:r=>a.delete(`/invitations/${r.id}`),onSuccess:()=>n.invalidateQueries({queryKey:["invitations"]})}),u=j({mutationFn:r=>a.post(`/invitations/${r.id}`),onSuccess:()=>n.invalidateQueries({queryKey:["invitations"]})});return{getAdministratorsQuery:m,inviteAdministratorQuery:g,disableAdministratorQuery:h,editAdministratorQuery:v,getInvitationsQuery:i,revokeInvitationQuery:c,resendInvitationQuery:u}}const J=({administrator:n})=>{const[s,a]=p.useState(n);p.useEffect(()=>{a(n)},[n]);const{notify:m}=k(),g=I(),{disableAdministratorQuery:h,editAdministratorQuery:v}=A(),{getRolesQuery:i}=$(),{data:c}=i(),u=(c==null?void 0:c.data.map(({name:l})=>({label:l,value:l})))??[],{mutateAsync:r}=v,{mutateAsync:b,isPending:f}=h,y=async()=>{try{await b({email:s.email})}catch(l){g(l)}},d=async l=>{try{await r({id:n.id,roles:l.roles}),a(x=>({...x,roles:l.roles})),m.success({title:"Permission changes have been queued",message:`You changed ${s.name}'s roles`})}catch(x){g(x)}},t=Q({initialValues:{roles:[]},validationSchema:T().shape({roles:E().of(M()).min(1,"At least one role is required")}),onSubmit:d});return p.useEffect(()=>{t.setValues({roles:s.roles})},[s]),e.jsxs(o.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[e.jsxs(o.ConfirmationButton,{type:"button",className:"has-icon",confirmationModalProps:{title:"Disable Administrator",children:e.jsx("p",{children:"This will remove the administrator from your Landscape organisation."}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:f,confirmButtonLoading:f,onConfirm:y},children:[e.jsx(o.Icon,{name:o.ICONS.delete,"aria-hidden":"true"}),e.jsx("span",{children:"Remove"})]}),e.jsxs(o.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(o.Col,{size:6,children:e.jsx(S,{label:"Name",value:s.name})}),e.jsx(o.Col,{size:6,children:e.jsx(S,{label:"Email",value:s.email})}),e.jsx(o.Col,{size:12,children:e.jsx(S,{label:"Timezone",value:e.jsx(N,{})})}),e.jsx(o.Col,{size:12,children:e.jsx(S,{label:"Identity URL",value:e.jsx(N,{})})})]}),e.jsx(w,{variant:"condensed",label:"Roles",items:u,selectedItems:u.filter(({value:l})=>t.values.roles.includes(l)),placeholder:"Select roles",onItemsUpdate:l=>t.setFieldValue("roles",l.map(({value:x})=>x)),error:t.touched.roles&&typeof t.errors.roles=="string"?t.errors.roles:void 0}),e.jsx(W,{submitButtonDisabled:t.isSubmitting||t.values.roles.length===s.roles.length&&t.values.roles.every(l=>s.roles.includes(l)),submitButtonText:"Save changes"})]})},X="_footer_nfyyh_1",Z="_multiSelect_nfyyh_7",R={footer:X,multiSelect:Z},ee=({administrator:n,roleOptions:s})=>{const a=I(),{notify:m}=k(),{editAdministratorQuery:g}=A(),{mutateAsync:h}=g,v=async({roles:c})=>{try{await h({id:n.id,roles:c}),m.success({title:"Permission changes have been queued",message:`You changed ${n.name}'s roles`})}catch(u){a(u)}},i=Q({initialValues:{roles:[]},validationSchema:T().shape({roles:E().of(M()).min(1,"At least one role is required")}),onSubmit:v});return p.useEffect(()=>{i.setValues({roles:n.roles})},[n.roles]),e.jsx(o.Form,{onSubmit:i.handleSubmit,noValidate:!0,children:e.jsx(w,{required:!0,variant:"condensed",className:R.multiSelect,items:s,selectedItems:s.filter(({value:c})=>i.values.roles.includes(c)),onItemsUpdate:c=>i.setValues({roles:c.map(({value:u})=>u)}),placeholder:"Select roles",error:i.touched.roles&&typeof i.errors.roles=="string"?i.errors.roles:void 0,dropdownFooter:e.jsxs("div",{className:R.footer,children:[e.jsx(o.Button,{type:"button",dense:!0,small:!0,className:"u-no-margin--bottom",disabled:i.values.roles.length===n.roles.length&&n.roles.every(c=>i.values.roles.includes(c)),onClick:()=>i.setFieldValue("roles",n.roles),children:"Revert"}),e.jsx(o.Button,{type:"submit",dense:!0,small:!0,appearance:"positive",className:"u-no-margin--bottom",disabled:i.values.roles.length===n.roles.length&&n.roles.every(c=>i.values.roles.includes(c)),children:"Save changes"})]})})})},te="_roles_1cuab_1",ne="_actions_1cuab_2",se="_table_1cuab_6",P={roles:te,actions:ne,table:se},ae=({administrators:n,emptyMessage:s,roles:a})=>{const m=I(),{setSidePanelContent:g}=B(),{disableAdministratorQuery:h}=A(),{mutateAsync:v,isPending:i}=h,c=p.useMemo(()=>n,[n]),u=p.useMemo(()=>a.map(({name:d})=>({label:d,value:d})),[a]),r=async d=>{try{await v({email:d})}catch(t){m(t)}},b=d=>{g(d.name,e.jsx(J,{administrator:d}))},f=p.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:d})=>e.jsx(o.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{b(d.original)},children:d.original.name})},{accessor:"email",Header:"Email"},{accessor:"roles",className:P.roles,Header:"Roles",Cell:({row:d})=>e.jsx(ee,{administrator:d.original,roleOptions:u})},{accessor:"actions",className:P.actions,Cell:({row:d})=>e.jsx(o.ConfirmationButton,{className:"u-no-margin--bottom u-no-padding--left is-small has-icon",type:"button",appearance:"base","aria-label":`Remove ${d.original.name}`,confirmationModalProps:{title:`Remove ${d.original.name}`,children:e.jsx("p",{children:"This will remove the administrator from your Landscape organisation."}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:i,confirmButtonLoading:i,onConfirm:()=>r(d.original.email)},children:e.jsx(o.Tooltip,{position:"top-center",message:"Remove",children:e.jsx(o.Icon,{name:o.ICONS.delete,className:"u-no-margin--left u-no-padding"})})})}],[c,u]),y=d=>{const t={};return d.column.id==="name"?t.role="rowheader":d.column.id==="email"?t["aria-label"]="Email":d.column.id==="roles"?t["aria-label"]="Roles":d.column.id==="actions"&&(t["aria-label"]="Actions"),t};return e.jsx(o.ModularTable,{columns:f,data:c,getCellProps:y,emptyMsg:s,className:P.table})},ie=()=>{const{search:n,setPageParams:s}=q(),[a,m]=p.useState(n),g=()=>{s({search:a})},h=()=>{s({search:""})},v=i=>{i.preventDefault(),g()};return e.jsx(o.Row,{className:"u-no-padding--left u-no-padding--right u-no-margin--left u-no-margin--right",children:e.jsx(o.Col,{size:6,children:e.jsx(o.Form,{onSubmit:v,noValidate:!0,children:e.jsx(o.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,value:a,onChange:i=>m(i),onSearch:g,onClear:h,autocomplete:"off"})})})})},oe=({administrators:n})=>{const{search:s,pageSize:a,currentPage:m}=q(),{getRolesQuery:g}=$(),{data:h}=g(),i=(()=>{const u=s.trim().toLowerCase();return u?n.filter(r=>r.email.toLowerCase().includes(u)||r.name.toLowerCase().includes(u)||r.roles.some(b=>b.toLowerCase().includes(u))):n})(),c=i.filter((u,r)=>r>=(m-1)*a&&r<m*a)??[];return e.jsxs(e.Fragment,{children:[e.jsx(ie,{}),e.jsx(ae,{administrators:c,emptyMessage:s.trim()?`No administrators found with the search: "${s.trim()}"`:"You have no administrators on your Landscape organisation",roles:(h==null?void 0:h.data)??[]}),c.length>0&&e.jsx(G,{totalItems:i.length,currentItemCount:c.length})]})},re=p.lazy(()=>D(()=>import("./index-BKWzs0J_.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))),le=()=>{const{setSidePanelContent:n}=B(),{getAdministratorsQuery:s}=A(),{data:a,isLoading:m}=s(),g=()=>{n("Invite administrator",e.jsx(p.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(re,{})}))};return e.jsxs(e.Fragment,{children:[m&&e.jsx(_,{}),!m&&(!a||!a.data.length)&&e.jsx(H,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no administrators in your Landscape organization."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[e.jsx(o.Button,{type:"button",appearance:"positive",onClick:g,children:"Invite Administrator"},"invite-administrator")],icon:"user",title:"No administrators found"}),!m&&a&&a.data.length>0&&e.jsx(oe,{administrators:a.data})]})},ce=()=>{const n=I(),{notify:s}=k(),{getInvitationsQuery:a,revokeInvitationQuery:m,resendInvitationQuery:g}=A(),{data:h}=a(),v=p.useMemo(()=>(h==null?void 0:h.data.results.sort((t,l)=>C(l.creation_time).diff(C(t.creation_time))))??[],[h]),{mutateAsync:i,isPending:c}=m,{mutateAsync:u,isPending:r}=g,b=async t=>{try{await i({id:t.id}),s.success({message:`${t.name}’${t.name.endsWith("s")?"":"s"} invitation has been revoked`,title:"You revoked an administrator invite"})}catch(l){n(l)}},f=async t=>{try{await u({id:t.id}),s.success({message:`${t.name} will receive a new invitation email`,title:"You resent an administrator invite"})}catch(l){n(l)}},y=p.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"email",Header:"Email"},{accessor:"creation_time",Header:"Invited",Cell:({row:t})=>C(t.original.creation_time).format(L)},{accessor:"expiration_time",Header:"Expires",Cell:({row:t})=>C(t.original.creation_time).add(14,"days").format(L)},{accessor:"actions",Cell:({row:t})=>e.jsxs("div",{className:"u-align-text--right",children:[e.jsx(o.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Revoke invitation for ${t.original.name}`,children:e.jsxs("p",{children:["This action will prevent ",t.original.name," from joining your Landscape organisation."]}),confirmButtonLabel:"Revoke invitation",confirmButtonAppearance:"negative",confirmButtonDisabled:c,confirmButtonLoading:c,onConfirm:()=>b(t.original)},children:"Revoke"}),e.jsx(o.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Resend invitation for ${t.original.name}`,children:e.jsxs("p",{children:[t.original.name," will receive a new invitation email."]}),confirmButtonLabel:"Resend invitation",confirmButtonAppearance:"positive",confirmButtonDisabled:r,confirmButtonLoading:r,onConfirm:()=>f(t.original)},children:"Resend"})]})}],[v]),d=t=>{const l={};return t.column.id==="name"?l.role="rowheader":t.column.id==="email"?l["aria-label"]="Email":t.column.id==="creation_time"?l["aria-label"]="Invited":t.column.id==="expiration_time"?l["aria-label"]="Expires":t.column.id==="actions"&&(l["aria-label"]="Actions"),l};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-text--muted p-text--small",children:"Unclaimed invitations expire after 14 days."}),e.jsx(o.ModularTable,{columns:y,data:v,getCellProps:d,emptyMsg:"You have no unclaimed invitations."})]})},de="_tabPanel_1n8p7_1",me={tabPanel:de},ue=[{label:"Administrators",id:"tab-link-administrators"},{label:"Invites",id:"tab-link-invites"}],he=()=>{const[n,s]=p.useState("tab-link-administrators");return e.jsxs(e.Fragment,{children:[e.jsx(o.Tabs,{listClassName:"u-no-margin--bottom",links:ue.map(({label:a,id:m})=>({label:a,id:m,role:"tab",active:m===n,onClick:()=>s(m)}))}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":n,className:me.tabPanel,children:e.jsxs(p.Suspense,{fallback:e.jsx(_,{}),children:[n==="tab-link-administrators"&&e.jsx(le,{}),n==="tab-link-invites"&&e.jsx(ce,{})]})})]})},ge=p.lazy(()=>D(()=>import("./index-BKWzs0J_.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))),pe=()=>{const{setSidePanelContent:n}=B(),s=()=>{n("Invite administrator",e.jsx(p.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(ge,{})}))};return e.jsxs(O,{children:[e.jsx(K,{title:"Administrators",actions:[e.jsx(o.Button,{type:"button",onClick:s,children:"Invite administrator"},"invite-administrator")]}),e.jsx(Y,{children:e.jsx(he,{})})]})},Ie=Object.freeze(Object.defineProperty({__proto__:null,default:pe},Symbol.toStringTag,{value:"Module"}));export{Ie as i,A as u};
