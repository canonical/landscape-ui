import{y as S,C as x,x as j,z as A,B as E,j as e,d as r}from"./index-CNSDWj8Q.js";import{I as s}from"./InfoGrid-3w5mqARw.js";import{u as k}from"./index-D-YBZSy_.js";import{K as B}from"./constants-CnStqPYr.js";import{u as N}from"./index-C1mVTQqL.js";import{U as w,a as I,N as R}from"./constants-Dwl1JGyb.js";import{D as C}from"./DeliveryBlock-B3k_IVND.js";import{R as O}from"./RandomizationBlock-DfhzodqZ.js";import"./helpers-kPKhnyjI.js";import"./InfoItem-Bt7JBIPo.js";import"./NoData-6ZK9sV5u.js";import"./Truncated-Dtg97i8C.js";import"./TablePagination-CFXNvqsZ.js";import"./TableFilterChips-06YfpJdc.js";import"./useFetchOld-BAAs34Op.js";import"./PageParamFilter-ChSwlZqZ.js";import"./TableFilter-2AKF5NjJ.js";import"./formikErrors-Bw8iTXYS.js";import"./ResponsiveTable-BXalKviy.js";import"./PageMain-C8MVZwda.js";import"./useGetInstance-BgZN2sNQ.js";import"./InstancesPageActions-DL7_pmR1.js";import"./ListTitle-BUruUKn1.js";import"./StaticLink-BEYCGcPv.js";import"./TruncatedCell-BMum6DLZ.js";import"./useExpandableRow-B4jhRgod.js";import"./index-CySvbr4l.js";import"./TextConfirmationModal-q88mH05g.js";import"./useUsns-dCIdMk13.js";import"./constants-CDnVvJTb.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./RadioGroup-BVZkBsDq.js";const pe=({currentKernelVersion:l,upgradeKernelVersions:o,instanceName:m})=>{const c=S(),{instanceId:p}=x(),{closeSidePanel:d}=j(),{notify:u}=A(),{upgradeKernelQuery:f}=N(),{openActivityDetails:_}=k(),{mutateAsync:b,isPending:n}=f,g=[{label:"Select",value:""},...o.map(t=>({label:t.version_rounded,value:t.id.toString()}))],v={deliver_immediately:!0,randomize_delivery:!1,deliver_delay_window:0,deliver_after:"",new_kernel_version_id:o.length===1?o[0].id.toString():"",reboot_after:!1},i=E({initialValues:v,validationSchema:B,onSubmit:async t=>{try{const{data:a}=await b({id:Number(p),kernel_package_id:Number(t.new_kernel_version_id),reboot_after:t.reboot_after,deliver_after:t.deliver_immediately?void 0:t.deliver_after,deliver_delay_window:t.randomize_delivery?t.deliver_delay_window:void 0});d();const y=t.reboot_after?w:I;u.success({title:`You queued kernel upgrade for "${m}"`,message:y,actions:[{label:"View details",onClick:()=>{_(a)}}]})}catch(a){c(a)}}}),h=async()=>{await i.setFieldValue("reboot_after",!0),i.handleSubmit()};return e.jsxs(r.Form,{onSubmit:i.handleSubmit,children:[e.jsx(r.Notification,{severity:"information",title:"Restart recommended",children:e.jsx("span",{children:R})}),e.jsxs(s,{spaced:!0,children:[e.jsx(s.Item,{label:"Current version",value:l}),e.jsx(s.Item,{label:"New version",value:o.length===1?e.jsx("span",{children:o[0].version_rounded}):e.jsx(r.Select,{options:g,...i.getFieldProps("new_kernel_version")})})]}),e.jsx(C,{formik:i}),e.jsx(O,{formik:i}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(r.Button,{type:"button",appearance:"base",onClick:d,children:"Cancel"}),e.jsx(r.ConfirmationButton,{type:"button",confirmationModalProps:{title:"Upgrading kernel and restarting instance",children:e.jsx("p",{children:"Are you sure? This action will upgrade the kernel and restart the instance."}),confirmButtonLabel:"Upgrade and Restart",confirmButtonAppearance:"positive",confirmButtonLoading:n,confirmButtonDisabled:n,onConfirm:h},children:"Upgrade and Restart"}),e.jsx(r.ConfirmationButton,{type:"button",appearance:"positive",confirmationModalProps:{title:"Upgrading kernel",children:e.jsx("p",{children:"Are you sure? This action will upgrade the kernel."}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:n,confirmButtonDisabled:n,type:"submit",onConfirm:()=>{i.handleSubmit()}},children:"Upgrade kernel"})]})]})};export{pe as default};
