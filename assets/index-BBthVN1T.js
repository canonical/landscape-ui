import{i as b,j as s,o as _,b as v,f as N,V as C,q as P,p as A,X as w,s as F,G as S,Q as V,d as y,t as E}from"./index-BCIQRWZN.js";import{A as j}from"./useInvitation-B5aCO9Ff.js";const c=6,O="_otpContainer_m5ew4_9",T="_input_m5ew4_14",x={otpContainer:O,input:T},k=({value:n,onChange:l,error:i,onComplete:d})=>{const f=b.useRef(new Array(c).fill(null));b.useEffect(()=>{const a=n.findIndex(t=>t===""),e=a===-1?c-1:a;f.current[e]?.focus()},[n]);const g=a=>e=>{const t=e.target,r=t.value.replace(/[^A-Za-z0-9]/g,"");let h=r;if(r.length>1){const u=t.selectionStart;h=u&&u>0?r[u-1]:r.slice(-1)}const p=[...n];p[a]=h,l(p),p.every(u=>u!=="")&&setTimeout(()=>{d()},0)},m=a=>e=>{e.key==="Backspace"&&!n[a]&&a>0&&f.current[a-1]?.focus()},o=a=>e=>{e.preventDefault();const t=e.clipboardData.getData("text").replace(/[^A-Za-z0-9]/g,"");if(!t.length)return;const r=t.split(""),h=[...n.slice(0,a),...r,...n.slice(a+r.length)].slice(0,c),p=Object.assign(Array(c).fill(""),h);l(p),p.every(u=>u!=="")&&setTimeout(()=>{d()},0)};return s.jsxs("fieldset",{className:_("p-form__group p-form-validation",{"is-error":i}),role:"group","aria-labelledby":"otp-label",children:[s.jsx("legend",{id:"otp-label",children:"Code"}),s.jsx("div",{className:"p-form__control u-clearfix",children:s.jsx("div",{className:x.otpContainer,children:Array.from({length:c}).map((a,e)=>s.jsx("input",{ref:t=>{f.current[e]=t},type:"text",inputMode:"text",className:x.input,value:n[e]||"",onChange:g(e),onKeyDown:m(e),onPaste:o(e),"aria-label":`Digit ${e+1} of ${c}`},e))})}),i&&s.jsx("p",{className:"p-form-validation__message is-error",id:"otp-error",children:i})]})},D=()=>{const n=v(),{mutateAsync:l,isPending:i}=N({mutationFn:d=>n.get(`ubuntu-installer-attach-sessions/code/${d.attach_code}`)});return{verify:l,isVerifying:i}},I="_buttonContainer_1skbi_1",$={buttonContainer:I},R=()=>{const[n]=C(),{notify:l}=P(),i=A(),d=w(),{verify:f,isVerifying:g}=D(),m=n.get("code")||"",o=F({initialValues:{code:Object.assign(Array(c).fill(""),m?.split("")||[])},validationSchema:S().shape({code:V().test("is-complete",`Code must be ${c} characters long`,e=>e!=null&&e.every(t=>t&&t!==""))}),enableReinitialize:!0,onSubmit:async e=>{try{const t=e.code.join(""),{data:r}=await f({attach_code:t});if(!r.valid){i("Invalid OTP code"),o.resetForm({values:{code:Array(c).fill("")}});return}l.success({message:"Code is valid",title:"Success"}),d("/login",{state:{code:t}})}catch(t){i(t)}}});b.useEffect(()=>{m&&m.length===c&&m.split("").every(t=>t&&t!=="")&&o.submitForm()},[]);const a=e=>{o.setFieldValue("code",e)};return s.jsx(j,{title:"Enter code to connect to the Ubuntu installer",children:s.jsxs(y.Form,{onSubmit:o.handleSubmit,children:[s.jsx(k,{value:o.values.code,onChange:a,onComplete:o.submitForm,error:E(o,"code")}),s.jsx("div",{className:$.buttonContainer,children:s.jsx(y.Button,{className:"u-no-margin--bottom",type:"submit",appearance:"positive",disabled:o.isSubmitting||g,children:"Next"})})]})})},z=()=>s.jsx(j,{title:"Sign in successful",children:s.jsx("p",{className:"u-text--muted",children:"You can close this tab and go back to the Ubuntu installer."})}),G=()=>{const[n]=C();return n.get("success")==="true"?s.jsx(z,{}):s.jsx(R,{})};export{G as default};
