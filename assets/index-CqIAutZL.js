import{b as f,e as _,f as x,G as F,Q as I,H as P,J as c,p as T,n as j,q,s as R,j as t,d as a,t as o}from"./index-BK1uK3Dg.js";import{A as N}from"./AssociationBlock-CLIfH9Pf.js";import{S as O}from"./SidePanelFormButtons-BuwhTVVp.js";import{u as W}from"./useGetWslInstanceTypes-CyX1gUk7.js";import"./WslInstancesEmptyState-CCFSKoRj.js";import{u as k}from"./useRoles-DLeJCsKJ.js";import{C as A}from"./constants-CGmSpzVx.js";import"./MultiSelectField-CMr1UY4h.js";import"./useGetTags-CYCWQuBj.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";import"./GroupFilter-CSsjtqB7.js";import"./HeaderWithSearch-ChJZGx1J.js";import"./useExpandableRow-ClDN_xvA.js";const E=()=>{const s=f(),l=_(),{isPending:n,mutateAsync:u}=x({mutationFn:async({name:m,...d})=>s.patch(`child-instance-profiles/${m}`,d),onSuccess:async()=>l.invalidateQueries({queryKey:["wslProfiles"]})});return{editWslProfile:u,isEditingWslProfile:n}},v=()=>F().shape({title:c().required("This field is required"),description:c().required("This field is required"),access_group:c().required("This field is required"),all_computers:P(),tags:I().of(c())}),C="_block_tz139_1",G={block:C},Y=({profile:s})=>{const{getAccessGroupQuery:l}=k(),n=T(),{closeSidePanel:u}=j(),{notify:m}=q(),{editWslProfile:d}=E(),{wslInstanceTypes:p}=W(),g=p.map(({label:i,name:r})=>({label:i,value:r}))||[],b=[{label:"Select",value:""},...g,{label:"From URL",value:"custom"}],{data:y}=l(),S=y?.data.map(({name:i,title:r})=>({label:r,value:i}))??[],h=async i=>{try{await d({name:s.name,title:i.title,access_group:i.access_group,description:i.description,all_computers:i.all_computers,tags:i.tags}),u(),m.success({title:"WSL profile updated",message:`WSL profile "${s.title}" updated successfully`})}catch(r){n(r)}},e=R({initialValues:{title:s.title,access_group:s.access_group,description:s.description,instanceType:s.image_source?"custom":s.image_name,customImageName:s.image_source?s.image_name:"",rootfsImage:s.image_source||"",all_computers:s.all_computers,tags:s.tags},onSubmit:h,validationSchema:v()});return t.jsxs(a.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[t.jsx(a.Input,{type:"text",label:"Title",required:!0,...e.getFieldProps("title"),error:o(e,"title")}),t.jsx(a.Input,{type:"text",label:"Description",required:!0,...e.getFieldProps("description"),error:o(e,"description")}),t.jsx(a.Select,{label:"Access group","aria-label":"Access group",options:S,required:!0,...e.getFieldProps("access_group"),error:o(e,"access_group")}),t.jsxs("div",{className:G.block,children:[t.jsx(a.Notification,{severity:"caution",title:"Editing unavailable",children:t.jsx("span",{children:"You cannot edit RootFS image or Cloud-init file. To modify these fields, create a new profile."})}),t.jsx(a.Select,{disabled:!0,label:"RootFS image","aria-label":"RootFS image",options:b,...e.getFieldProps("instanceType"),error:o(e,"instanceType")}),e.values.instanceType==="custom"&&t.jsxs(t.Fragment,{children:[t.jsx(a.Input,{disabled:!0,label:"Image name",type:"text",required:!0,...e.getFieldProps("customImageName"),error:o(e,"customImageName")}),t.jsx(a.Input,{disabled:!0,type:"text",label:"RootFS image URL",required:!0,...e.getFieldProps("rootfsImage"),error:o(e,"rootfsImage"),help:"The file path must be reachable by the affected WSL instances."})]}),t.jsx(a.Select,{label:"Cloud-init","aria-label":"Cloud-init",options:A,disabled:!0})]}),t.jsx(N,{formik:e}),t.jsx(O,{submitButtonText:"Save changes",submitButtonDisabled:e.isSubmitting})]})};export{Y as default};
