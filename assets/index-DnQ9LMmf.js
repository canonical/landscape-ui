import{r as d,j as e,d as h,e as P,u as F,i as k,b as v,t as N}from"./index-CQs3wXys.js";import{E as H}from"./EmptyState-DNkTeHW1.js";import{T as E}from"./TablePagination-DIiSuGph.js";import{u as S}from"./useMutation-D9dT1mhA.js";import{u as Q}from"./useQuery-DrwXjJzc.js";const M=({processes:n,selectedPids:t,setSelectedPids:u})=>{const a=()=>{u(t.length===0?n.map(({pid:s})=>s):[])},m=d.useMemo(()=>[{accessor:"name",Header:e.jsxs(e.Fragment,{children:[e.jsx(h.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all processes"}),checked:t.length>0&&t.length===n.length,disabled:n.length===0,onChange:a,indeterminate:t.length>0&&t.length<n.length}),e.jsx("span",{children:"Command"})]}),Cell:({row:s})=>e.jsxs(e.Fragment,{children:[e.jsx(h.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:`Select process ${s.original.name}`}),checked:t.includes(s.original.pid),onChange:()=>{u(t.includes(s.original.pid)?t.filter(o=>o!==s.original.pid):[...t,s.original.pid])}}),e.jsx("span",{children:s.original.name})]})},{accessor:"state",Header:"State"},{accessor:"vm_size",Header:"VM size"},{accessor:"cpu_utilization",Header:"CPU (%)",Cell:({row:s})=>e.jsxs(e.Fragment,{children:[(100*s.original.cpu_utilisation).toFixed(1),"%"]})},{accessor:"pid",Header:"PID"},{accessor:"start_time",Header:"Started at"},{accessor:"gid",Header:"Group"}],[n,t]);return e.jsx(h.ModularTable,{columns:m,data:n,emptyMsg:"No processes found"})},_=()=>{const n=P(),t=F(),u=(s,o={})=>{const{computer_id:c,...g}=s;return Q({queryKey:["processes",s],queryFn:()=>n.get(`/computers/${c}/processes`,{params:g}),...o})},a=S({mutationFn:s=>n.post("processes/terminate",s),onSuccess:()=>{t.invalidateQueries(["processes"])}}),m=S({mutationFn:s=>n.post("processes/kill",s),onSuccess:()=>{t.invalidateQueries(["processes"])}});return{getProcessesQuery:u,killProcessQuery:m,terminateProcessQuery:a}},T="_container_eu2va_1",z="_searchContainer_eu2va_6",y={container:T,searchContainer:z},$=({instanceId:n,onPageChange:t,onSearch:u,selectedPids:a,setSelectedPids:m})=>{const[s,o]=d.useState(""),{notify:c}=k(),g=v(),{killProcessQuery:f,terminateProcessQuery:r}=_(),{mutateAsync:x}=r,{mutateAsync:C}=f,p=(l=s)=>{u(l),t(1)},j=()=>{o(""),p("")},i=async()=>{try{await x({pids:a,computer_id:n}),c.success({message:`${a.length===1?"Process":"Processes"} successfully ended`}),m([])}catch(l){g(l)}},b=async()=>{try{await C({pids:a,computer_id:n}),c.success({message:`${a.length===1?"Process":"Processes"} successfully killed`}),m([])}catch(l){g(l)}};return e.jsxs("div",{className:y.container,children:[e.jsx("div",{className:y.searchContainer,children:e.jsx(h.Form,{onSubmit:l=>{l.preventDefault(),p()},noValidate:!0,children:e.jsx(h.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,"aria-label":"Process search",onChange:l=>{o(l)},value:s,onSearch:p,onClear:j,autocomplete:"off"})})}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsx(h.Button,{className:"p-segmented-control__button",disabled:a.length===0,onClick:i,children:"End process"}),e.jsx(h.Button,{className:"p-segmented-control__button",disabled:a.length===0,onClick:b,children:"Kill process"})]})})]})},A=({instanceId:n})=>{const[t,u]=d.useState(1),[a,m]=d.useState(50),[s,o]=d.useState([]),[c,g]=d.useState(""),{getProcessesQuery:f}=_(),{data:r,isLoading:x}=f({computer_id:n,limit:a,offset:(t-1)*a,search:c}),C=(r==null?void 0:r.data.count)??0,p=i=>{u(i),o([])},j=d.useMemo(()=>(r==null?void 0:r.data.results)??[],[r]);return e.jsxs(e.Fragment,{children:[!c&&x&&e.jsx(N,{}),!x&&!c&&(!r||r.data.results.length===0)&&e.jsx(H,{icon:"connected",title:"No processes running"}),(c||!x&&r&&r.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx($,{instanceId:n,onPageChange:p,onSearch:i=>{g(i)},selectedPids:s,setSelectedPids:i=>o(i)}),e.jsx(M,{processes:j,setSelectedPids:i=>o(i),selectedPids:s})]}),e.jsx(E,{currentPage:t,totalItems:C,paginate:p,pageSize:a,setPageSize:m,currentItemCount:j.length})]})},q=A;export{q as default};
