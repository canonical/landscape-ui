const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Ck9C_gq5.js","assets/index-DskkQfCs.js","assets/index-Dkc_mJ0y.css","assets/SidePanelFormButtons-BslmUX5q.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/ResponsiveButtons-Z4y4F6_H.js","assets/ResponsiveButtons-C56n2q_V.css","assets/index-Ba81IojM.css","assets/index-DXgm60tN.js","assets/index--FosQFNT.js","assets/downshift.esm-C9VVFE4K.js","assets/index-QZipd6RP.css"])))=>i.map(i=>d[i]);
import{m as S,j as a,aq as K,r as p,q as f,a1 as C,a as E,Q as q,d as g,ai as D,L as O,p as w,y as A,i as F,h as R,c as N,k as b,l as x}from"./index-DskkQfCs.js";import{R as H}from"./ResponsiveButtons-Z4y4F6_H.js";const o={downgrade:{appearance:"positive",icon:"begin-downloading",label:"Downgrade",order:4},hold:{appearance:"positive",icon:"pause",label:"Hold",order:2},remove:{appearance:"negative",icon:"delete",label:"Uninstall",order:1},unhold:{appearance:"positive",icon:"play",label:"Unhold",order:3},upgrade:{appearance:"positive",icon:"change-version",label:"Upgrade",order:5}},B=p.lazy(async()=>C(()=>import("./index-Ck9C_gq5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),V=({pkg:e})=>{const{setSidePanelContent:t}=S(),s={remove:!0,hold:e.status!=="held",unhold:e.status==="held",upgrade:!!e.available_version&&e.available_version!==e.current_version,downgrade:e.status!=="held"},d=n=>{t(`${o[n].label} ${e.name}`,a.jsx(p.Suspense,{fallback:a.jsx(f,{}),children:a.jsx(B,{action:n,packages:[e]})}))},u=Object.keys(o).map(n=>n).filter(n=>s[n]&&o[n].appearance=="positive").sort((n,l)=>o[l].order-o[n].order).map(n=>({icon:o[n].icon,label:o[n].label,"aria-label":`${o[n].label} ${e.name} package`,onClick:()=>{d(n)}})),r=Object.keys(o).map(n=>n).filter(n=>s[n]&&o[n].appearance=="negative").sort((n,l)=>o[l].order-o[n].order).map(n=>({icon:o[n].icon,label:o[n].label,"aria-label":`${o[n].label} ${e.name} package`,onClick:()=>{d(n)}}));return a.jsx(K,{toggleAriaLabel:`${e.name} package actions`,actions:u,destructiveActions:r})},z=({onDismiss:e})=>{const t=E(),{instanceId:s,childInstanceId:d}=q();return a.jsxs(g.Notification,{severity:"caution",onDismiss:e,children:[a.jsx("strong",{children:"Some upgrades require Ubuntu Pro: "}),a.jsxs("span",{children:["Your current Ubuntu package upgrades are limited. To unlock full upgrades, please upgrade to Ubuntu Pro."," "]}),a.jsx(g.Button,{type:"button",appearance:"link",onClick:()=>{t(`/instances/${d?`${s}/${d}`:s}`,{state:{tab:"ubuntu-pro"}})},children:"Learn more"})]})},M={available_version:null,current_version:null,id:-1,name:"loading",status:"available",summary:""},W="_checkbox_p36ti_1",G="_details_p36ti_5",Y="_tooltipLink_p36ti_9",J="_hidden_p36ti_13",j={checkbox:W,details:G,tooltipLink:Y,hidden:J},I=e=>!!e.available_version&&!!e.current_version&&e.available_version.includes("ubuntu-pro"),k=e=>{const t={label:"Unknown",icon:""};return e.status==="available"?(t.label="Available",t.icon="status-queued-small"):e.status==="held"?(t.label="Held",t.icon="status-in-progress-small"):e.status==="security"?(t.label="Security upgrade",t.icon="status-failed-small"):e.status==="installed"&&(e.available_version!==e.current_version?(t.label="Regular upgrade",t.icon="status-waiting-small"):(t.label="Installed",t.icon="status-succeeded-small")),t},X=({column:e,row:t})=>{const s={};return t.original.name==="loading"?e.id==="name"?s.colSpan=5:(s.className=j.hidden,s["aria-hidden"]=!0):e.id==="checkbox"?s["aria-label"]=`Toggle ${t.original.name} package`:e.id==="name"?s.role="rowheader":e.id==="status"?s["aria-label"]="Status":e.id==="current_version"?s["aria-label"]="Current version":e.id==="available_version"?s["aria-label"]="Available version":e.id==="summary"&&(s["aria-label"]="Details"),s},Z=p.lazy(async()=>C(()=>import("./index-DXgm60tN.js"),__vite__mapDeps([9,1,2,6,7]))),ie=({emptyMsg:e,onPackagesSelect:t,packages:s,packagesLoading:d,selectedPackages:u,selectAll:r})=>{const[n,l]=p.useState(!1),[m,v]=p.useState(!1),{instanceId:c,childInstanceId:y}=q(),{setSidePanelContent:_}=S(),L=p.useMemo(()=>d?[M]:s,[s,d]),P=i=>{t(u.some(({name:h})=>h===i.name)?u.filter(({name:h})=>h!==i.name):[...u,i])},$=()=>{t(u.length>0?[]:s.filter(i=>!I(i)))};p.useEffect(()=>{!r||n||!s.length||($(),l(!0))},[r,s]);const T=i=>{_("Package details",a.jsx(p.Suspense,{fallback:a.jsx(f,{}),children:a.jsx(Z,{singlePackage:i})}))},U=p.useMemo(()=>[{accessor:"checkbox",className:j.checkbox,Header:a.jsx(g.CheckboxInput,{inline:!0,label:a.jsx("span",{className:"u-off-screen",children:"Toggle all"}),checked:u.length===s.length&&s.length>0,indeterminate:u.length<s.length&&u.length>0,disabled:s.length===0,onChange:$}),Cell:({row:i})=>I(i.original)?a.jsx(g.Tooltip,{message:a.jsxs("div",{children:[a.jsx("p",{className:"u-no-padding--top",children:"Ubuntu Pro is required"}),a.jsx(O,{to:`/instances/${y?`${c}/${y}`:`${c}`}`,state:{tab:"ubuntu-pro"},className:j.tooltipLink,children:"learn more"})]}),children:a.jsx(g.CheckboxInput,{inline:!0,disabled:!0,label:a.jsx("span",{className:"u-off-screen",children:`Toggle ${i.original.name}`}),checked:u.some(({name:h})=>h===i.original.name),onChange:()=>{P(i.original)}})}):a.jsx(g.CheckboxInput,{inline:!0,label:a.jsx("span",{className:"u-off-screen",children:`Toggle ${i.original.name}`}),checked:u.some(({name:h})=>h===i.original.name),onChange:()=>{P(i.original)}})},{accessor:"name",Header:"Name",Cell:({row:i})=>i.original.name==="loading"?a.jsx(f,{}):a.jsx(g.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{T(i.original)},children:i.original.name})},{accessor:"status",Header:"Status",Cell:({row:{original:i}})=>k(i).label,getCellIcon:({row:{original:i}})=>k(i).icon},{accessor:"current_version",Header:"Current version"},{accessor:"summary",className:j.details,Header:"Details",Cell:({row:{original:i}})=>i.available_version?a.jsxs(a.Fragment,{children:[a.jsx("span",{children:i.summary}),a.jsx("br",{}),a.jsx("span",{children:`available version: ${i.available_version}`})]}):i.summary},{...D,Cell:({row:{original:i}})=>a.jsx(V,{pkg:i})}],[s,u.length]);return a.jsxs(a.Fragment,{children:[!m&&s.some(I)&&a.jsx(z,{onDismiss:()=>{v(!0)}}),a.jsx(g.ModularTable,{columns:U,data:L,getCellProps:X,emptyMsg:e})]})},ee="_container_1nwlw_1",ae="_noWrap_1nwlw_5",Q={container:ee,noWrap:ae},se=p.lazy(async()=>C(()=>import("./index-Ck9C_gq5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),ne=p.lazy(async()=>C(()=>import("./index--FosQFNT.js"),__vite__mapDeps([10,1,2,3,4,5,11,6,7,12]))),le=({selectedPackages:e})=>{const{setSidePanelContent:t}=S(),s=r=>{var l;const n=A(e.length,((l=e[0])==null?void 0:l.name)??"",`${e.length} selected packages`);t(`${o[r].label} ${n}`,a.jsx(p.Suspense,{fallback:a.jsx(f,{}),children:a.jsx(se,{action:r,packages:e})}))},d={remove:e.length===0||e.every(r=>!r.current_version),hold:e.length===0||e.every(r=>r.status==="held"),unhold:e.length===0||e.every(r=>r.status!=="held"),upgrade:e.length===0||e.every(r=>!r.available_version)},u=()=>{t("Install packages",a.jsx(p.Suspense,{fallback:a.jsx(f,{}),children:a.jsx(ne,{})}))};return a.jsxs("div",{className:Q.container,children:[a.jsxs(g.Button,{type:"button",onClick:u,hasIcon:!0,className:w("u-no-margin--bottom",Q.noWrap),children:[a.jsx("i",{className:"p-icon--plus"}),a.jsx("span",{children:"Install"})]}),a.jsx(H,{collapseFrom:"lg",buttons:Object.keys(o).filter(r=>r!=="downgrade").map(r=>r).sort((r,n)=>o[r].order-o[n].order).map(r=>a.jsxs(g.Button,{type:"button",className:"p-segmented-control__button has-icon u-no-margin--bottom",disabled:d[r],onClick:()=>{s(r)},children:[a.jsx(g.Icon,{name:o[r].icon}),a.jsx("span",{children:o[r].label})]},r))})]})};function oe(){const e=F(),t=R(),s=N(),d=(c,y={})=>x({queryKey:["packages",c],queryFn:async()=>s.get("packages",{params:c}),...y}),u=({instance_id:c,...y},_={})=>x({queryKey:["packages",{instance_id:c,...y}],queryFn:async()=>s.get(`computers/${c}/packages`,{params:y}),..._}),r=b({mutationFn:async c=>t.get("UpgradePackages",{params:c}),onSuccess:async()=>e.invalidateQueries({queryKey:["packages"]})}),n=b({mutationFn:async c=>s.post("/computers/upgrade-packages",c),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["packages"]}),e.invalidateQueries({queryKey:["instances"]})])}),l=({instanceId:c,packageName:y},_={})=>x({queryKey:["packageDowngradeVersion",{instanceId:c,packageName:y}],queryFn:async()=>s.get(`computers/${c}/packages/installed/${y}/downgrades`),..._}),m=b({mutationFn:async({instanceId:c,...y})=>s.post(`computers/${c}/packages/installed`,y),onSuccess:async()=>e.invalidateQueries({queryKey:["packages"]})}),v=b({mutationFn:async c=>s.post("packages",c),onSuccess:async()=>e.invalidateQueries({queryKey:["packages"]})});return{getPackagesQuery:d,getInstancePackagesQuery:u,upgradePackagesQuery:r,getDowngradePackageVersionsQuery:l,downgradePackageVersionQuery:m,packagesActionQuery:v,upgradeInstancesPackagesQuery:n}}function ce(){const e=F(),t=N(),s=(l,m={})=>x({queryKey:["usns",l],queryFn:async()=>t.get("usns",{params:l}),...m}),d=({usn:l,...m},v={})=>x({queryKey:["usnPackages",{usn:l,...m}],queryFn:async()=>t.get(`usns/${l}`,{params:m}),...v}),u=b({mutationFn:async({instanceId:l,...m})=>t.post(`/computers/${l}/usns/upgrade-packages`,m),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])}),r=b({mutationFn:async({instanceId:l,...m})=>t.post(`/computers/${l}/usns/remove-packages`,m),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])}),n=b({mutationFn:async l=>t.post("/computers/usns/upgrade-packages",l),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])});return{getUsnsQuery:s,getAffectedPackagesQuery:d,upgradeInstanceUsnsQuery:u,removeUsnPackagesQuery:r,upgradeUsnsQuery:n}}export{o as I,le as P,oe as a,ie as b,ce as u};
