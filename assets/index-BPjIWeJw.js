import{r as x,k as y,a as S,e as _,l as $,j as e,g as m,h as N,R as L,o as T}from"./index-DXs1haZl.js";import{E as w}from"./EmptyState-BYL1pVz2.js";import{u as I}from"./useUsns-B3b7Nlk8.js";import"./TablePagination.module-DLVph1Z1.js";import{T as A}from"./TablePagination-DZ07rvb4.js";import{u as q}from"./useConfirm-C9Ai5vPv.js";import{u as f}from"./usePageParams-BJqFm8Ol.js";import{U as E}from"./UsnList-CVWiDSUl.js";import"./helpers-BfuBH7Ij.js";import"./useFetchOld-DWTVWZGf.js";import"./useMutation-CoMMCR6r.js";import"./useQuery-DPA9mHwu.js";import"./moment-BF0UQeMK.js";import"./NoData-BmTO_w1O.js";import"./TruncatedCell-Dx_NjREl.js";import"./ExpandableTableFooter-BvE1KnQN.js";import"./ExpandableTableFooter.module-C3W6TVe_.js";import"./useOnClickOutside-C-WOPQdE.js";const D="_container_viyqm_1",B="_searchContainer_viyqm_5",F="_cta_viyqm_9",h={container:D,searchContainer:B,cta:F},V=({onSearch:o,usns:t})=>{const[r,a]=x.useState(""),{instanceId:l,childInstanceId:c}=y(),{setPageParams:d}=f(),u=S(),s=_(),{notify:n}=$(),{confirmModal:i,closeConfirmModal:j}=q(),{upgradeUsnPackagesQuery:b}=I(),p=Number(l),{mutateAsync:P,isLoading:C}=b,U=()=>{u(`${L}instances/${c?`${p}/${c}`:`${p}`}`),d({tab:"activities"}),n.clear()},k=async()=>{try{await P({instanceId:p,usns:t}),n.success({title:"You queued packages to be upgraded",message:`Affected packages for ${t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:U}]})}catch(g){s(g)}finally{j()}},v=()=>{i({title:"Upgrade affected packages",body:`This will upgrade affected packages for ${t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`}.`,buttons:[e.jsx(m.Button,{appearance:"positive",onClick:k,disabled:C,"aria-label":"Upgrade selected packages",children:"Upgrade"},"upgrade")]})};return e.jsxs("div",{className:h.container,children:[e.jsx("div",{className:h.searchContainer,children:e.jsx(m.Form,{onSubmit:g=>{g.preventDefault(),o(r)},noValidate:!0,children:e.jsx(m.SearchBox,{shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:r,onChange:g=>a(g),onSearch:()=>o(r),onClear:()=>{a(""),o("")}})})}),e.jsx("div",{className:N("p-segmented-control",h.cta),children:e.jsxs(m.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:v,disabled:t.length===0,children:[e.jsx(m.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]})})]})},H=({instanceTitle:o,isUsnsLoading:t,totalUsnCount:r,usns:a})=>{const[l,c]=x.useState([]),{search:d,setPageParams:u}=f(),s=()=>{c([])},n=i=>{u({search:i}),s()};return e.jsxs(e.Fragment,{children:[e.jsx(V,{onSearch:n,usns:l.map(({usn:i})=>i)}),e.jsx(E,{tableType:"paginated",instanceTitle:o,isUsnsLoading:t,onSelectedUsnsChange:i=>c(i),search:d,selectedUsns:l,usns:a}),a.length>0&&e.jsx(A,{handleClearSelection:s,totalItems:r,currentItemCount:a.length})]})},M=({instanceTitle:o})=>{const{instanceId:t,childInstanceId:r}=y(),{search:a,currentPage:l,pageSize:c}=f(),{getUsnsQuery:d}=I(),u=Number(r??t),{data:s,isLoading:n}=d({computer_ids:[u],limit:c,offset:(l-1)*c,search:a,show_packages:!1});return e.jsxs(e.Fragment,{children:[!a&&n&&e.jsx(T,{}),!a&&!n&&(!s||s.data.results.length===0)&&e.jsx(w,{icon:"inspector-debug",title:"No security issues found"}),(a||!n&&s&&s.data.results.length>0)&&e.jsx(H,{instanceTitle:o,isUsnsLoading:n,totalUsnCount:(s==null?void 0:s.data.count)??0,usns:(s==null?void 0:s.data.results)??[]})]})},re=M;export{re as default};
