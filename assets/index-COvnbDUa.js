import{r as C,_ as I,e as F,l as k,f as q,j as e,g as r,p as A,h as w}from"./index-Wf16gVie.js";import{u as B}from"./formik.esm-N0UfY0_B.js";import{u as E,L,C as H,a as T,H as M}from"./index-Cq79M4Ix.js";import{u as W}from"./useConfirm-wp7RgHXG.js";import{C as $}from"./CellInput-BBP_aQ2s.js";import{c as D,a as j,f as z,d as U}from"./index.esm-DpPOvp4P.js";import{S as G}from"./SidePanelTablePagination-DgsI6xXy.js";import"./TablePagination.module-DLVph1Z1.js";import"./PageMain-D6uzwJCK.js";import"./useFetchOld-B5P01kwg.js";import"./useMutation-DhQdCJ2X.js";import"./useQuery-CfvGuDxZ.js";import"./MultiSelectField.module-D1r8qo_i.js";import"./AssociationBlock.module-BSYf3X0u.js";import"./SidePanelFormButtons.module-DyBJG5lm.js";import"./InfoItem.module-BZ3tYMsb.js";import"./EmptyState-DFxj1N3o.js";import"./InfoItem-ConUpJ-V.js";import"./useRoles-D8fEPyYH.js";import"./SidePanelFormButtons-ClEUhOrz.js";import"./AssociationBlock-CuiVE9xk.js";import"./MultiSelectField-C0yji_fK.js";import"./useInstances-DlMXfcBS.js";const Q=[{label:"All",value:""},{label:"Conflicts",value:"conflicts"},{label:"Depends",value:"depends"}],Y="_container_scrq4_1",J={container:Y},K=C.lazy(()=>I(()=>import("./index-ButTRn-N.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]))),X=({filter:n,formik:a,onFilterChange:o,profile:s,selectedIds:u,setSelectedIds:p})=>{const v=F(),{notify:c}=k(),{setSidePanelContent:g}=q(),{closeConfirmModal:m,confirmModal:N}=W(),{removePackageProfileConstraintsQuery:b}=E(),{mutateAsync:x}=b,_=async()=>{try{await x({constraint_ids:u,name:s.name}),p([]),c.success({message:`${u.length} "${s.name}" profile's ${u.length===1?"constraint":"constraints"} removed successfully`,title:`Package profile ${u.length===1?"constraint":"constraints"} removed`})}catch(h){v(h)}finally{m()}},t=()=>{N({title:`Remove ${u.length===1?"constraint":"constraints"}`,body:`This will remove ${u.length} ${u.length===1?"constraint":"constraints"}`,buttons:[e.jsx(r.Button,{type:"button",appearance:"negative",onClick:()=>_(),"aria-label":`Remove ${u.length===1?"constraint":"constraints"}`,children:"Remove"},"remove")]})},i=()=>{g(`Add package constraints to "${s.name}" profile`,e.jsx(C.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(K,{profile:s})}),"medium")};return e.jsxs("div",{className:J.container,children:[e.jsx(r.Select,{label:"Constraint type",labelClassName:"u-no-padding--top",options:Q,value:n,onChange:h=>o(h.target.value)}),e.jsxs(r.Button,{type:"button",hasIcon:!0,className:"u-no-margin--right",disabled:u.length===0||a.values.id!==0,onClick:t,"aria-label":`Remove selected ${u.length===1?"constraint":"constraints"}`,children:[e.jsx(r.Icon,{name:"delete"}),e.jsx("span",{children:"Remove"})]}),e.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:i,"aria-label":"Add new constraint",children:[e.jsx(r.Icon,{name:"plus"}),e.jsx("span",{children:"Add constraints"})]})]})},Z="_actionButton_14uri_1",ee="_tooltip_14uri_5",f={actionButton:Z,tooltip:ee},ae=({constraint:n,formik:a})=>a.values.id===n.id?e.jsxs(e.Fragment,{children:[e.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:w("u-no-margin--bottom u-no-padding",f.actionButton),onClick:()=>a.handleSubmit(),children:e.jsx(r.Tooltip,{tooltipClassName:f.tooltip,message:"Save changes",children:e.jsx(r.Icon,{name:"success-grey",className:"u-no-margin--left u-no-margin--right"})})}),e.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>a.resetForm(),"aria-label":`Cancel editing ${n.package} constraint`,children:e.jsx(r.Tooltip,{tooltipClassName:f.tooltip,message:"Cancel",children:e.jsx(r.Icon,{name:"error-grey",className:"u-no-margin--left u-no-margin--right"})})})]}):e.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>a.setValues(n),disabled:a.values.id!==0,"aria-label":`Edit ${n.package} constraint`,children:e.jsx(r.Tooltip,{tooltipClassName:f.tooltip,message:"Edit constraint",children:e.jsx(r.Icon,{name:"edit",className:"u-no-margin--left u-no-margin--right"})})}),ne="_actionsCell_13s7c_1",te="_noPadding_13s7c_7",se="_cell_13s7c_11",oe="_input_13s7c_23",re="_inputWrapper_13s7c_31",ie="_checkboxContainer_13s7c_37",le="_hidden_13s7c_41",d={actionsCell:ne,noPadding:te,cell:se,input:oe,inputWrapper:re,checkboxContainer:ie,hidden:le},ce=async(n,a,o)=>{await n.setFieldValue(`${a}`,o),await n.setFieldTouched(`${a}`,!0),["rule","version"].includes(`${a}`)&&(o!==""?await n.setFieldValue("notAnyVersion",!0):n.values[a==="rule"?"version":"rule"]===""&&await n.setFieldValue("notAnyVersion",!1))},ue=(n,a)=>{if(!(!n.touched[a]||!n.errors[a]))return n.errors[a]},de=n=>({handleConstraintPropChange:(a,o)=>ce(n,a,o),getConstraintPropError:a=>ue(n,a)}),pe=({column:n,row:a},o)=>{const s={};return s.className=w(d.cell,{[d.noPadding]:a.original.id===o}),a.original.package==="loading"?n.id==="package"?s.colSpan=5:(s.className=d.hidden,s["aria-hidden"]=!0):n.id==="package"?s.role="rowheader":n.id==="actions"?s["aria-label"]="Actions":n.id==="constraint"?s["aria-label"]="Constraint":n.id==="version"?s["aria-label"]="Version":n.id==="rule"&&(s["aria-label"]="Rule"),s},ge=(n,a)=>{let o="No constraints found";return n&&(o+=` with the constraint type: "${n}"`,a&&(o+=" and")),a&&(o+=` with the search: "${a}"`),o},me=({filter:n,formik:a,isConstraintsLoading:o,onSelectedIdsChange:s,pageSize:u,profileConstraints:p,search:v,selectedIds:c})=>{const g=C.useMemo(()=>{if(o)return[L];if(!p)return[];const t=p.map(i=>({...i,notAnyVersion:!!i.version}));return a.values.id!==-1?t:[a.values,...t].slice(0,u)},[o,p,a.values,u]),m=()=>{s(c.length?[]:g.map(({id:t})=>t))},N=t=>{c.includes(t)?s(c.filter(i=>i!==t)):s([...c,t])},{handleConstraintPropChange:b,getConstraintPropError:x}=de(a),_=C.useMemo(()=>[{accessor:"constraint",Header:()=>e.jsxs("div",{className:d.checkboxContainer,children:[e.jsx(r.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all constraints"}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0||g.length===0,checked:g.length>0&&g.length===c.length,indeterminate:c.length>0&&c.length<g.length,onChange:m}),e.jsx("span",{children:"Constraint"})]}),Cell:({row:{original:t}})=>a.values.id===t.id?e.jsx(r.Select,{label:"Constraint",labelClassName:"u-off-screen",className:d.input,wrapperClassName:d.inputWrapper,options:H,...a.getFieldProps("constraint"),onChange:i=>b("constraint",i.target.value),error:x("constraint")}):e.jsxs("div",{className:d.checkboxContainer,children:[e.jsx(r.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${t.package} constraint`}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0,checked:c.includes(t.id),onChange:()=>N(t.id)}),e.jsx("span",{children:t.constraint})]})},{accessor:"package",Header:"Package",Cell:({row:{original:t}})=>a.values.id===t.id?e.jsx($,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:d.input,wrapperClassName:d.inputWrapper,...a.getFieldProps("package"),onChange:i=>b("package",i),error:x("package")}):t.package!=="loading"?e.jsx(e.Fragment,{children:t.package}):e.jsx(A,{})},{accessor:"rule",Header:"Rule",Cell:({row:{original:t}})=>{var i;return a.values.id===t.id?e.jsx(r.Select,{label:"Rule",labelClassName:"u-off-screen",className:d.input,wrapperClassName:d.inputWrapper,options:T,...a.getFieldProps("rule"),onChange:h=>b("rule",h.target.value),error:x("rule")}):e.jsx(e.Fragment,{children:((i=T.find(({value:h})=>h===t.rule))==null?void 0:i.label)??t.rule})}},{accessor:"version",Header:"Version",Cell:({row:{original:t}})=>a.values.id===t.id?e.jsx($,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:d.input,wrapperClassName:d.inputWrapper,...a.getFieldProps("version"),onChange:i=>b("version",i),error:x("version")}):e.jsx(e.Fragment,{children:t.version})},{accessor:"actions",className:d.actionsCell,Cell:({row:{original:t}})=>e.jsx(ae,{constraint:t,formik:a})}],[g,c.length,a.errors,a.touched]);return e.jsx(r.ModularTable,{columns:_,data:g,getCellProps:t=>pe(t,a.values.id),className:"u-no-margin--bottom",emptyMsg:ge(n,v)})},he={constraint:"",id:0,notAnyVersion:!1,package:"",rule:"",version:""},Ce=D().shape({constraint:j().required("Required."),id:z(),notAnyVersion:U(),package:j().required("Required."),rule:j().when("notAnyVersion",{is:!0,then:n=>n.required("Required.")}),version:j().when("notAnyVersion",(n,a)=>n[0]?a.required("Required."):a)}),be="_pagination_15tqa_1",xe={pagination:be},Pe=({profile:n})=>{const[a,o]=C.useState([]),[s,u]=C.useState(1),[p,v]=C.useState(20),[c,g]=C.useState(""),[m,N]=C.useState(""),b=l=>{o([]),u(l)},x=l=>{o([]),v(l)},_=F(),{notify:t}=k(),{editPackageProfileConstraintQuery:i,getPackageProfileConstraintsQuery:h}=E(),{mutateAsync:V}=i,y=B({initialValues:he,onSubmit:async(l,{resetForm:R})=>{try{await V({constraint:l.constraint,id:l.id,package:l.package,rule:l.rule,version:l.version,name:n.name}),t.success({message:`"${n.name}" package profile's constraint updated successfully`,title:"Package profile constraint updated"}),R()}catch(O){_(O)}},validationSchema:Ce}),{data:P,isLoading:S}=h({constraint_type:m||void 0,limit:p,name:n.name,offset:(s-1)*p,search:c});return e.jsxs(e.Fragment,{children:[!c&&!m&&s===1&&p===20&&S&&e.jsx(A,{}),(c||m||s!==1||p!==20||!S&&P&&P.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(M,{actions:e.jsx(X,{filter:m,formik:y,onFilterChange:l=>N(l),profile:n,selectedIds:a,setSelectedIds:l=>o(l)}),onSearch:l=>g(l),disabled:y.values.id!==0}),e.jsx(me,{filter:m,formik:y,isConstraintsLoading:S,onSelectedIdsChange:l=>o(l),pageSize:p,profileConstraints:P==null?void 0:P.data.results,search:c,selectedIds:a}),e.jsx(G,{currentPage:s,pageSize:p,paginate:b,setPageSize:x,totalItems:P==null?void 0:P.data.count,className:xe.pagination})]})]})},De=Pe;export{De as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-ButTRn-N.js","assets/index-Wf16gVie.js","assets/index-BAlneFez.css","assets/formik.esm-N0UfY0_B.js","assets/PackageProfileConstraintsBlock-6U2pwxXg.js","assets/CellInput-BBP_aQ2s.js","assets/index-Cq79M4Ix.js","assets/PageMain-D6uzwJCK.js","assets/PageMain-DyI__TtH.css","assets/useFetchOld-B5P01kwg.js","assets/useMutation-DhQdCJ2X.js","assets/useQuery-CfvGuDxZ.js","assets/MultiSelectField.module-D1r8qo_i.js","assets/MultiSelectField-B2rqRhX9.css","assets/AssociationBlock.module-BSYf3X0u.js","assets/AssociationBlock-Cb2Mr2ww.css","assets/index.esm-DpPOvp4P.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/InfoItem.module-BZ3tYMsb.js","assets/InfoItem-BbayMzTk.css","assets/SidePanelTablePagination-DgsI6xXy.js","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/useConfirm-wp7RgHXG.js","assets/EmptyState-DFxj1N3o.js","assets/EmptyState-BNXajmMK.css","assets/InfoItem-ConUpJ-V.js","assets/useRoles-D8fEPyYH.js","assets/SidePanelFormButtons-ClEUhOrz.js","assets/AssociationBlock-CuiVE9xk.js","assets/MultiSelectField-C0yji_fK.js","assets/useInstances-DlMXfcBS.js","assets/index-B4MoPBFn.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
