const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-UNk1hKo7.js","assets/index-BHRcNEjD.js","assets/index-D3DIubem.css","assets/UdebCheckboxInput-B8EjSE91.js","assets/UdebCheckboxInput-mCgCMP_S.css","assets/debug-CrooEktR.js","assets/useGPGKeys-CMLgde7G.js","assets/useFetchOld-CODS07ol.js","assets/debug-CHNhm1j1.css","assets/MultiSelectField-B383GC0t.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-_Uk60HOs.js","assets/SidePanelFormButtons.module-tJTvEwdD.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/formikErrors-BG1G9Awu.js","assets/constants-CJV9r-JB.js","assets/usePageParams-B-DmNT5V.js","assets/NoData-B2qyvNCr.js","assets/index-WNRGQj2L.js","assets/TablePagination-CxneRnYN.js","assets/TablePaginationBase-CWSqPLdo.js","assets/TablePaginationBase-CJl3HN1X.css","assets/StatusFilter-BSCWzphf.js","assets/TableFilter-DIAUp9UY.js","assets/TableFilter-DXBG6q86.css","assets/TableFilterChips-DnbHu6Nw.js","assets/TableFilterChips-CHqetGbX.css","assets/index-CRv_aeRB.css","assets/constants-DhXkDRlN.css"])))=>i.map(i=>d[i]);
import{r as i,j as e,g as c,B as le,p as de,f as ge,m as F,n as A,_ as ue}from"./index-BHRcNEjD.js";import{S as me}from"./SidePanelTablePagination-q_7-mboU.js";import"./usePageParams-B-DmNT5V.js";import{f as fe,p as pe}from"./constants-CJV9r-JB.js";import"./TablePaginationBase-CWSqPLdo.js";import"./useFetchOld-CODS07ol.js";import"./NoData-B2qyvNCr.js";import"./index-WNRGQj2L.js";import"./TablePagination-CxneRnYN.js";import"./StatusFilter-BSCWzphf.js";import"./TableFilter-DIAUp9UY.js";import"./TableFilterChips-DnbHu6Nw.js";try{let a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new a.Error().stack;n&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[n]="96aa6605-ab9c-4ac3-a889-f3b03153c7af",a._sentryDebugIdIdentifier="sentry-dbid-96aa6605-ab9c-4ac3-a889-f3b03153c7af")}catch{}const he="_version_sfav3_1",Pe="_content_sfav3_5",Q={version:he,content:Pe},ke=({isUpload:a,packagesToShow:n,search:s,selectedPackages:l,setSelectedPackages:m})=>{const g=i.useMemo(()=>[{accessor:"packageName",Header:({rows:t})=>a?e.jsxs(e.Fragment,{children:[e.jsx(c.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),disabled:!t.length,indeterminate:!!l.length&&l.length<t.length,checked:l.length===t.length&&!!l.length,onChange:()=>{m(d=>d.length?[]:t.map((h,x)=>x))}}),e.jsx("span",{children:"Package"})]}):"Package",Cell:({row:t})=>a?e.jsx(c.CheckboxInput,{inline:!0,label:t.original.packageName,checked:l.includes(t.index),onChange:()=>{m(d=>d.includes(t.index)?d.filter(h=>h!==t.index):[...d,t.index])}}):t.original.packageName},{accessor:"packageVersion",Header:"Version",getCellIcon:({row:t})=>t.original.difference?"warning":!1,className:Q.version,Cell:({row:t})=>t.original.difference?e.jsx(c.Tooltip,{position:"top-center",message:t.original.difference==="delete"?"Package deleted":`Version differs
from parent pocket.
Parent version:
${t.original.newVersion}`,children:e.jsx("span",{children:t.original.packageVersion})}):t.original.packageVersion}],[n,l.length]);return e.jsx(c.ModularTable,{columns:g,data:n,emptyMsg:s?`No packages found with the search: "${s}".`:void 0,className:Q.content,getCellProps:({column:t})=>{switch(t.id){case"packageName":return{role:"rowheader"};case"packageVersion":return{"aria-label":"Version"};default:return{}}}})},xe="_ctaRow_qlsck_1",be={ctaRow:xe},ye=i.lazy(async()=>ue(()=>import("./index-UNk1hKo7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]))),k=1,H=20,we=({distributionName:a,pocket:n,seriesName:s})=>{const[l,m]=i.useState(k),[g,t]=i.useState(H),[d,h]=i.useState([]),[x,O]=i.useState(!1),[j,V]=i.useState(""),[b,v]=i.useState(""),[R,U]=i.useState([]),B=le("(max-width: 619px)"),I=de(),{setSidePanelContent:q,closeSidePanel:K}=ge(),{listPocketQuery:G,diffPullPocketQuery:J,pullPackagesToPocketQuery:W,syncMirrorPocketQuery:X,removePackagesFromPocketQuery:Y,removePocketQuery:Z}=fe(),{mutate:N,isPending:T}=X,{mutate:ee,isPending:w}=W,ne=()=>{n.mode==="mirror"?N({name:n.name,series:s,distribution:a}):n.mode==="pull"&&ee({name:n.name,series:s,distribution:a})},ae=()=>{q(`Edit ${n.name} pocket`,e.jsx(i.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(ye,{pocket:n,distributionName:a,seriesName:s})}))},{mutateAsync:te,isPending:S}=Z,oe=async()=>{try{await te({distribution:a,series:s,name:n.name}),K()}catch(o){I(o)}},{mutateAsync:se,isPending:y}=Y,E=!T&&!w&&!y&&!S,{data:C,isLoading:M}=G({name:n.name,series:s,distribution:a,search:b,limit:g,offset:l*g-g},{enabled:E}),D=(C==null?void 0:C.data)??{count:0,results:[]},f=D.results.map(o=>({packageName:o.name,packageVersion:o.version})),{data:_}=J({name:n.name,series:s,distribution:a},{enabled:n.mode==="pull"&&!M&&E});i.useEffect(()=>{const o=(_==null?void 0:_.data)??{},r=[];for(const u in o){const p={add:[],update:[],delete:[],...o[u]};for(const[P,$]of p.add)r.push({packageName:P,newVersion:$,difference:"add"});(p.update.length||p.delete.length)&&O(!0);for(const[P,,$]of p.update)r.push({packageName:P,newVersion:$,difference:"update"});for(const[P]of p.delete)r.push({packageName:P,difference:"delete",newVersion:""})}U(r)},[_]);const ce=()=>x?(f.forEach((o,r)=>{const u=R.find(({packageName:p})=>o.packageName===p);u&&(f[r].difference=u.difference,u.newVersion!==""&&(f[r].newVersion=u.newVersion))}),[...f.filter(({difference:o})=>o),...f.filter(({difference:o})=>!o)]):f,z=i.useMemo(()=>ce(),[l,g,b,x,f.length,R.length]),re=async()=>{const o=z.filter((r,u)=>d.includes(u)).map(({packageName:r})=>r);try{await se({name:n.name,series:s,distribution:a,packages:o})}catch(r){I(r)}},L=!b&&l===k&&g===H&&!D.count,ie=n.mode==="upload"?{size:8,medium:4}:{size:6,medium:3};return e.jsxs(e.Fragment,{children:[e.jsxs(c.Row,{className:F("u-no-padding--left u-no-padding--right",be.ctaRow),children:[e.jsx(c.Col,{...ie,children:e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[n.mode!=="upload"&&e.jsx(c.Button,{className:"p-segmented-control__button",type:"button",onClick:ne,disabled:T&&w,"aria-label":n.mode==="mirror"?`Synchronize ${n.name} pocket of ${a}/${s}`:`Pull packages to ${n.name} pocket of ${a}/${s}`,children:n.mode==="mirror"?"Sync":"Pull"}),e.jsx(c.Button,{className:"p-segmented-control__button",type:"button",onClick:ae,"aria-label":`Edit ${n.name} pocket of ${a}/${s}`,children:"Edit"}),e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button",type:"button","aria-label":`Remove ${n.name} pocket of ${a}/${s}`,confirmationModalProps:{title:"Deleting pocket",children:e.jsxs("p",{children:["Do you really want to delete ",n.name," pocket from"," ",s," series of ",a," distribution?"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:S,confirmButtonLoading:S,onConfirm:oe},children:"Remove"}),n.mode==="upload"&&e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:!d.length||y,"aria-label":`Remove selected packages from ${n.name} pocket of ${a}/${s}`,confirmationModalProps:{title:"Deleting packages from pocket",children:e.jsxs("p",{children:["This will delete ",d.length," selected"," ",pe(d.length,"package","packages")," ","from ",n.name," pocket ",s," series of"," ",a," distribution"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:y,confirmButtonLoading:y,onConfirm:re},children:"Remove packages"})]})})}),n.mode!=="upload"&&!L&&e.jsx(c.Col,{size:6,medium:3,children:e.jsx(c.Form,{onSubmit:o=>{o.preventDefault(),v(j),m(k)},noValidate:!0,children:e.jsx(c.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,"aria-label":"Package search",onChange:o=>{V(o)},value:j,onClear:()=>{V(""),v(""),m(k)},className:F({"is-dense":!B,"u-no-margin--bottom":B}),onSearch:()=>{v(j),m(k)},autocomplete:"off"})})})]}),M?e.jsx(A,{}):L?e.jsx("p",{children:"No packages found"}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{isUpload:n.mode==="upload",packagesToShow:z,search:b,selectedPackages:d,setSelectedPackages:h}),e.jsx(me,{currentPage:l,totalItems:D.count,paginate:o=>{h([]),m(o)},pageSize:g,setPageSize:o=>{t(o)}})]})]})};export{we as default};
