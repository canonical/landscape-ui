import{r as d,X as h,j as e,D as _,h as g,f,e as j,b as E,o as C}from"./index-P3tcVer_.js";import{P as w,a as b,b as v}from"./PageMain-CufgbnAh.js";import{u as T,T as P}from"./TablePagination-9PvQlVgk.js";import{T as R}from"./TruncatedCell-D_3fzDwd.js";import{h as y,u as x,D as u}from"./usePageParams-CZXld3eS.js";import{a as L}from"./helpers-BonKpxw0.js";import{T as F}from"./TableFilterChips-HMcdOmXT.js";import{H as S}from"./HeaderWithSearch-DCz7Mge8.js";import{T as H}from"./TableFilter-DTXx6h3i.js";import"./TablePaginationBase-DrquMGK2.js";const I="_message_1po57_1",D="_expandedCell_1po57_5",M="_expandedRow_1po57_10",p={message:I,expandedCell:D,expandedRow:M},N=o=>({index:t})=>{const n={};return o===t&&(n.className=p.expandedRow),n},O=o=>({column:t,row:{index:n}})=>{const s={};return t.id==="creation_time"?s.role="rowheader":t.id==="person_name"?s["aria-label"]="username":t.id==="entity_type"?s["aria-label"]="entity type":t.id==="entity_name"?s["aria-label"]="entity name":t.id==="message"&&(s["aria-label"]="message",o===n&&(s.className=p.expandedCell)),s},Y=({eventsLog:o})=>{const[t,n]=d.useState(""),[s,l]=d.useState(-1),c=d.useRef([]);h({current:s!==-1?c.current[s]:null},()=>l(-1));const r=d.useMemo(()=>[{accessor:"creation_time",Header:"creation time",Cell:({row:a})=>e.jsx(e.Fragment,{children:y(a.original.creation_time).format(_)})},{accessor:"person_name",Header:"username",Cell:({row:a})=>e.jsx(e.Fragment,{children:a.original.person_name})},{accessor:"entity_type",Header:"entity type",Cell:({row:a})=>e.jsx(e.Fragment,{children:a.original.entity_type})},{accessor:"entity_name",Header:"entity name",Cell:({row:a})=>e.jsx(e.Fragment,{children:a.original.entity_name})},{accessor:"message",className:p.message,Header:"message",Cell:({row:{original:a,index:i}})=>e.jsx(R,{content:a.message,isExpanded:i===s,onExpand:()=>{n(""),l(t?i-1:i)}})}],[o,s]);return e.jsx("div",{ref:L(c),children:e.jsx(g.ModularTable,{getCellProps:O(s),getRowProps:N(s),columns:r,data:o,emptyMsg:"No events found according to your search parameters."})})},k=()=>{const{days:o,setPageParams:t}=x();return T("days",u.map(n=>n.value)),e.jsx(H,{multiple:!1,label:"Days",showSelectionOnToggleLabel:!0,hasToggleIcon:!0,options:u,onItemSelect:n=>t({days:n}),selectedItem:o.toString()})},A=()=>e.jsxs(e.Fragment,{children:[e.jsx(S,{actions:e.jsx(k,{})}),e.jsx(F,{filtersToDisplay:["search"]})]});function V(){const o=f();return{getEventsLog:(n,s={})=>j({queryKey:["events",n],queryFn:async()=>o.get("events",{params:n}),...s})}}const $="_header_116wp_1",B={header:$},U=(o,t)=>{const n=["creation_time","person_id","person_name","entity_type","entity_id","entity_name","message"],l=[["Creation Time","Person ID","Person Name","Entity Type","Entity ID","Entity Name","Message"].join(","),...o.map(i=>n.map(m=>i[m]).join(","))].join(`\r
`),c=new Blob([l],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(c),a=document.createElement("a");a.href=r,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)},se=()=>{const{days:o,search:t,currentPage:n,pageSize:s}=x(),{user:l}=E(),{getEventsLog:c}=V(),{data:r,isLoading:a}=c({days:Number(o),limit:s,offset:(n-1)*s,search:t}),i=d.useMemo(()=>(r==null?void 0:r.data.results.filter(m=>m.message.toLowerCase().includes(t.toLowerCase())))??[],[r,t]);return e.jsxs(w,{children:[e.jsx(b,{className:B.header,title:"Events log",actions:[e.jsx(g.Button,{type:"button",onClick:()=>U(i,`Event Log - ${l.current_account}-${y().format("YYYY-MM-DDTHH mm ss[Z]")}.csv`),children:"Download as CSV"},"download-as-cv")]}),e.jsxs(v,{children:[e.jsx(A,{}),a&&e.jsx(C,{}),!a&&i&&e.jsx(Y,{eventsLog:i}),e.jsx(P,{totalItems:r==null?void 0:r.data.count,currentItemCount:i.length})]})]})};export{se as default};
