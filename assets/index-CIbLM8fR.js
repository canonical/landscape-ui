const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cu5m8P7e.js","assets/index-Dfc97QGW.js","assets/index-CBwtg6kZ.css","assets/SelectAllButton-7i8VoFdt.js","assets/ExpandableTableFooter-DCAqkxh9.js","assets/ExpandableTableFooter-CF0EpBAN.css","assets/useUsns-DqfdHX4t.js","assets/constants-BTpoIHxf.js","assets/ResponsiveTable-ViIMTRR6.js","assets/ResponsiveTable-Czda4kFo.css","assets/InstancesPageActions-Dns4Yse-.js","assets/index-S_kjB96R.js","assets/NoData-DMN9LLPq.js","assets/TablePagination-B0v8QAQr.js","assets/TableFilterChips-DXWGZ6VK.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-DZURD2KR.css","assets/useFetchOld-BgGVMMmJ.js","assets/PageParamFilter-C5PJgjVf.js","assets/TableFilter-BmLRyeMD.js","assets/TableFilter-B85Stwni.css","assets/formikErrors-Bw8iTXYS.js","assets/index-DzMlcK9Q.css","assets/ListTitle-DsIgCqjQ.js","assets/ListTitle-CxCHkD9o.css","assets/StaticLink-BNg3qc2M.js","assets/TruncatedCell-Cf7_euhM.js","assets/Truncated-D8EZCoK1.js","assets/Truncated-uqJp6ujM.css","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-DYtdXwcw.js","assets/index-DiSNWm9B.js","assets/TextConfirmationModal-O9rtHEfo.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/InfoGrid-CrJbMYy5.js","assets/InfoItem-DImpX37B.js","assets/InfoItem-D8nPzgUA.css","assets/InfoGrid-D3QqOHFx.css","assets/InstancesPageActions-ChZMRYY_.css","assets/useUsns-BR-xUdoS.css","assets/index-BGypvokr.css","assets/index-CXDsxkBK.js","assets/index-CqC3kG2s.css","assets/index-Bxq0Adi0.js","assets/UsnList-CdV8gsGU.js","assets/UsnList-CZKN-Q3s.css"])))=>i.map(i=>d[i]);
import{j as e,x as d,I,p as m,J as u,i as h,l as T,r as l,$ as p,z as L,B as C,y as V,C as N,d as b,al as B,e as x}from"./index-Dfc97QGW.js";import{S as R}from"./SidePanelFormButtons-BdOP5SSP.js";import{p as k,q as $,r as j}from"./InstancesPageActions-Dns4Yse-.js";import"./index-DiSNWm9B.js";import{a as D,u as F}from"./useUsns-DqfdHX4t.js";import"./index-S_kjB96R.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./useFetchOld-BgGVMMmJ.js";import"./ListTitle-DsIgCqjQ.js";import"./NoData-DMN9LLPq.js";import"./ResponsiveTable-ViIMTRR6.js";import"./StaticLink-BNg3qc2M.js";import"./TruncatedCell-Cf7_euhM.js";import"./Truncated-D8EZCoK1.js";import"./useExpandableRow-DYtdXwcw.js";import"./TextConfirmationModal-O9rtHEfo.js";import"./InfoGrid-CrJbMYy5.js";import"./InfoItem-DImpX37B.js";import"./constants-BTpoIHxf.js";import"./TablePagination-B0v8QAQr.js";import"./TableFilterChips-DXWGZ6VK.js";import"./PageParamFilter-C5PJgjVf.js";import"./TableFilter-BmLRyeMD.js";import"./formikErrors-Bw8iTXYS.js";const z=({instances:t})=>{const a=t.filter(({alerts:i})=>k(i)).length,r=t.filter(({alerts:i})=>$(i)).length,s=t.filter(({alerts:i})=>!j(i)).length;return e.jsxs("div",{children:[e.jsx("span",{children:"You selected "}),e.jsx("span",{children:e.jsx("b",{children:t.length})}),e.jsx("span",{children:" instances:"}),e.jsxs("ul",{className:I({"u-no-margin--bottom":s>0}),children:[a>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Security upgrades are available for "}),e.jsx("b",{children:a}),e.jsx("span",{children:d(a,"instance")})]}),r>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Regular upgrades are available for "}),e.jsx("b",{children:r}),e.jsx("span",{children:d(r,"instance")})]})]}),s>0&&e.jsxs("p",{children:[e.jsx("span",{children:"No upgrades for "}),e.jsx("span",{children:e.jsx("b",{children:s})}),e.jsxs("span",{children:[d(s,"instance")," needed."]})]})]})},f=[{id:"tab-link-instances",label:"Instances"},{id:"tab-link-packages",label:"Packages"},{id:"tab-link-usns",label:"USNs"}],g={instances:l.lazy(()=>p(()=>import("./index-Cu5m8P7e.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40]))),packages:l.lazy(()=>p(()=>import("./index-CXDsxkBK.js"),__vite__mapDeps([41,1,2,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,3,4,5,42]))),usns:l.lazy(()=>p(()=>import("./index-Bxq0Adi0.js"),__vite__mapDeps([43,1,2,44,3,4,5,12,8,9,13,14,15,16,26,27,28,29,11,17,18,19,20,21,22,6,7,10,23,24,25,30,31,32,33,34,35,36,37,38,39,45])))},q=m().shape({excludedPackages:u().of(m().shape({id:T().required(),exclude_packages:u().of(h())})),excludedUsns:u().of(h())}),w=({activeTabLinkId:t,onTabLinkClick:a,withUsnsTab:r})=>f.filter(({id:s})=>r||s!=="tab-link-usns").map(({id:s,label:i})=>({id:s,label:i,active:s===t,onClick:()=>{a(s)},role:"tab"})),O=t=>({excludedPackages:t.map(({id:a})=>({id:a,exclude_packages:[]})),excludedUsns:[]}),ge=({selectedInstances:t})=>{const[a,r]=l.useState(f[0].id),s=t.filter(({alerts:n})=>j(n)),i=s.filter(({alerts:n})=>k(n)),P=L(),{notify:_}=C(),{closeSidePanel:S}=V(),{upgradeInstancesPackagesQuery:U}=D(),{upgradeUsnsQuery:y}=F(),{mutateAsync:v}=U,{mutateAsync:A}=y,E=async n=>{try{a==="tab-link-usns"?await A({computers:i.map(({id:o})=>({id:o,exclude_usns:n.excludedUsns}))}):await v({computers:n.excludedPackages}),S(),_.success({title:"You queued packages to be upgraded",message:`Packages on ${t.length} ${d(t.length,"instance")} will be upgraded and are queued in Activities`})}catch(o){P(o)}},c=N({initialValues:O(s),onSubmit:E,validationSchema:q});return e.jsxs(b.Form,{onSubmit:c.handleSubmit,children:[e.jsx(z,{instances:t}),e.jsx(b.Tabs,{links:w({activeTabLinkId:a,onTabLinkClick:n=>{r(n)},withUsnsTab:i.length>0})}),e.jsx(B,{children:e.jsxs("div",{tabIndex:0,role:"tabpanel","aria-labelledby":a,children:[a==="tab-link-instances"&&e.jsx(l.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(g.instances,{excludedPackages:c.values.excludedPackages,instances:s,onExcludedPackagesChange:async n=>c.setFieldValue("excludedPackages",n)})}),a==="tab-link-packages"&&e.jsx(l.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(g.packages,{excludedPackages:c.values.excludedPackages,instances:s,onExcludedPackagesChange:async n=>c.setFieldValue("excludedPackages",n)})}),a==="tab-link-usns"&&e.jsx(l.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(g.usns,{excludedUsns:c.values.excludedUsns,instances:i,onExcludedUsnsChange:async n=>c.setFieldValue("excludedUsns",n)})})]})}),e.jsx(R,{submitButtonDisabled:c.isSubmitting,submitButtonText:"Upgrade"})]})};export{ge as Upgrades};
