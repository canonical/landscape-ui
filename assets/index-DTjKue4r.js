const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CISnXQZH.js","assets/index-DdVy3CIu.js","assets/index-DCq_vsqr.css","assets/usePageParams-CcklzBaA.js","assets/useInstances-uWwQvNUT.js","assets/useFetchOld-CHfQedZ7.js","assets/TablePagination-DcRP3nto.js","assets/TablePaginationBase-ZnL0qmAy.js","assets/TablePaginationBase-CJl3HN1X.css","assets/StatusFilter-DAfk9Cb4.js","assets/TableFilter-CDgyuP9F.js","assets/TableFilter-CNw_lMaf.css","assets/TableFilterChips-3QiSvy-H.js","assets/TableFilterChips-CHqetGbX.css","assets/NoData-Chqc7NTj.js","assets/index-DlELVwax.css"])))=>i.map(i=>d[i]);
import{j as e,E as Y,g as l,m as E,r as p,e as z,b as U,f as V,c as k,d as F,n as j,_ as q,K as G,s as J,h as X,k as Q,o as Z,L as ee,D as te}from"./index-DdVy3CIu.js";import{u as D,m as se}from"./usePageParams-CcklzBaA.js";import{u as ae,T as ie}from"./TablePagination-DcRP3nto.js";import{S as ne}from"./StatusFilter-DAfk9Cb4.js";import{T as re}from"./TableFilterChips-3QiSvy-H.js";import{u as oe}from"./useFetchOld-CHfQedZ7.js";import{t as b,T as ce}from"./TableFilter-CDgyuP9F.js";import{N as H}from"./NoData-Chqc7NTj.js";const le=()=>e.jsx(Y,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no activities yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage computers in Landscape"})]}),icon:"switcher-environments",title:"No activities found"}),ue="_wrapper_ispuk_1",pe="_formContainer_ispuk_7",de="_helpButton_ispuk_11",I={wrapper:ue,formContainer:pe,helpButton:de},me=({inputValue:s,onDescriptionClick:t,onInputChange:n,onSearchClick:u,onClear:r})=>{const c=o=>{o.preventDefault(),u()};return e.jsxs("div",{className:I.wrapper,children:[e.jsx("div",{className:I.formContainer,children:e.jsx(l.Form,{onSubmit:c,noValidate:!0,children:e.jsx(l.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,className:"u-no-margin--bottom",autocomplete:"off",value:s,onChange:n,onClear:r,onSearch:u})})}),e.jsx(l.Button,{type:"button",appearance:"base",hasIcon:!0,className:E("u-no-margin--bottom",I.helpButton),onClick:t,"aria-label":"Help",children:e.jsx(l.Icon,{name:l.ICONS.help})})]})},he="_term_1p61y_1",ye={term:he},ge=({open:s,onClose:t,data:n})=>{const u=[{Header:"Term",accessor:"term",className:ye.term,Cell:({value:r})=>typeof r=="string"?e.jsx("code",{children:r}):null},{Header:"Description",accessor:"description",Cell:({value:r})=>typeof r=="string"||p.isValidElement(r)?e.jsx("span",{className:"u-text--muted",children:r}):null}];return s&&e.jsxs(l.Modal,{title:"Search help",close:t,children:[e.jsx("p",{children:"Available search terms for use in the search box. If multiple search terms are separated by OR, any of the conditions will match. Otherwise, all conditions must be met for a instance to match. When a term is preceded by NOT, the condition must not match. If the searched value contains spaces or non-ASCII characters, it must be quoted."}),e.jsx(l.ModularTable,{className:"u-no-margin--bottom",columns:p.useMemo(()=>u,[]),data:p.useMemo(()=>n,[])})]})},fe=p.lazy(async()=>q(()=>import("./index-CISnXQZH.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])));function M(){const s=oe(),t=z(),n=U(),{setSidePanelContent:u}=V(),r=(i={},h={})=>F({queryKey:["activities",i],queryFn:async()=>t.get("activities",{params:i}),...h}),c=({activityId:i,...h},_={})=>F({queryKey:["activities",{activityId:i,...h}],queryFn:async()=>t.get(`activities/${i}`,{params:h}),..._}),o=(i={},h={})=>F({queryKey:["activityTypes"],queryFn:async()=>s.get("GetActivityTypes",{params:i}),...h}),v=k({mutationKey:["activities","cancel"],mutationFn:async i=>s.get("CancelActivities",{params:i}),onSuccess:async()=>n.invalidateQueries({queryKey:["activities"]})}),y=k({mutationKey:["activities","approve"],mutationFn:async i=>s.get("ApproveActivities",{params:i}),onSuccess:async()=>n.invalidateQueries({queryKey:["activities"]})}),d=k({mutationFn:async i=>t.post("activities/reapply",i),onSuccess:async()=>n.invalidateQueries({queryKey:["activities"]})}),S=k({mutationFn:async i=>t.post("activities/revert",i),onSuccess:async()=>n.invalidateQueries({queryKey:["activities"]})});return{getActivitiesQuery:r,getSingleActivityQuery:c,getActivityTypesQuery:o,cancelActivitiesQuery:v,approveActivitiesQuery:y,redoActivitiesQuery:d,undoActivitiesQuery:S,openActivityDetails:i=>{u(i.summary,e.jsx(p.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(fe,{activityId:i.id})}))}}}function xe(s){const{state:t}=G(),n=t==null?void 0:t.activity;p.useEffect(()=>{t!=null&&t.activity&&(s(t.activity),window.history.replaceState({},""))},[n])}const ve="_container_1r60q_1",_e="_buttons_1r60q_6",B={container:ve,buttons:_e},be=()=>{const[s,t]=p.useState(!1),{setPageParams:n,fromDate:u,toDate:r}=D(),c=J({initialValues:{fromDate:u||"",toDate:r||""},enableReinitialize:!0,validationSchema:X().shape({fromDate:Q(),toDate:Q()}),onSubmit:o=>{n({fromDate:o.fromDate,toDate:o.toDate}),t(!1)}});return e.jsx(l.ContextualMenu,{visible:s,autoAdjust:!0,toggleAppearance:"base",toggleLabel:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Date range"}),e.jsx("span",{className:E(b.badgeContainer),children:u||r?e.jsx(l.Badge,{value:u&&r?2:1,className:b.badge}):null})]}),toggleClassName:b.toggle,toggleProps:{onClick:()=>{t(!s)}},hasToggleIcon:!0,dropdownClassName:b.dropdown,position:"left",children:e.jsxs(l.Form,{onSubmit:c.handleSubmit,noValidate:!0,className:B.container,children:[e.jsxs("div",{className:b.container,children:[e.jsx(l.Input,{type:"datetime-local",label:"From",...c.getFieldProps("fromDate")}),e.jsx(l.Input,{type:"datetime-local",label:"To",...c.getFieldProps("toDate")})]}),e.jsxs("div",{className:B.buttons,children:[e.jsx(l.Button,{small:!0,type:"button",appearance:"base",onClick:()=>{t(!1),c.resetForm()},children:"Cancel"}),e.jsx(l.Button,{small:!0,type:"submit",appearance:"positive",children:"Add"})]})]})})},je=({options:s})=>{const[t,n]=p.useState(""),{setPageParams:u,type:r}=D(),c=s.filter(o=>o.label.toLowerCase().includes(t.toLowerCase()));return ae("type",c.map(o=>o.value)),e.jsx(ce,{multiple:!1,label:"Type",hasToggleIcon:!0,hasBadge:!0,onSearch:o=>n(o),options:c,onItemSelect:o=>u({type:o}),selectedItem:r})},Se="_top_t0kqp_1",Ce="_sticky_t0kqp_8",Te="_filters_t0kqp_14",N={top:Se,sticky:Ce,filters:Te},Ae="_iconError_xphpu_1",ke="_iconWarning_xphpu_5",De="_iconWarningRed_xphpu_9",$={iconError:Ae,iconWarning:ke,iconWarningRed:De},w={succeeded:{icon:"success",label:"Succeeded"},scheduled:{icon:"spinner",label:"Scheduled"},waiting:{icon:"status-waiting",label:"Waiting"},undelivered:{icon:"status-queued",label:"Queued"},delivered:{icon:"status-in-progress",label:"In progress"},blocked:{icon:`warning-grey ${$.iconWarningRed}`,label:"Blocked"},unapproved:{icon:`warning-grey ${$.iconWarning}`,label:"Unapproved"},canceled:{icon:"error-grey",label:"Cancelled"},failed:{icon:`error-grey ${$.iconError}`,label:"Failed"}},Fe=[{term:"id:<activity_id>",description:"Search for activities with a specific ID."},{term:"parent-id:<parent_id>",description:"Search for children activities of a specific ID."},{term:"created-after:<date>",description:e.jsxs("span",{children:["Search for activities created after a specific date or time, specified with the ISO-8601 format. The precision depends on how far you specify, for example ",e.jsx("code",{children:"2011-01"}),", ",e.jsx("code",{children:"2011-01-01"}),","," ",e.jsx("code",{children:"2011-01-01T10:30"})," are valid values."]})},{term:"created-before:<date>",description:"Search for activities created before a specific date or time. The format is the same as created-after."},{term:"creator:<email>",description:"Search for activities created by a particular person (specified by email address)."},{term:"computer:<criteria>",description:"Search for activities related to the given instances. The criteria is itself another query argument to search instances. See Instance Queries for details."},{term:"type:<type>",description:"Search for activities of a specific type."}],L=[{label:"All",value:""},...Object.entries(w).filter(([s])=>s!=="unapproved").map(([s,{label:t}])=>({label:t,value:s}))],Ie=({resetSelectedIds:s})=>{const{query:t,setPageParams:n}=D(),{instanceId:u}=Z(),{getActivityTypesQuery:r}=M(),[c,o]=p.useState(""),[v,y]=p.useState(!1),{data:d}=r(),C=((d==null?void 0:d.data)??[]).map(g=>({label:g,value:g})),i=[{label:"All",value:""},...C],h=!!u,_=()=>{c&&(n({query:t?`${t},${c}`:`${c}`}),o(""),s())},x=()=>{n({query:""})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:E(N.top,{[N.sticky]:!h}),children:[e.jsx(me,{inputValue:c,onInputChange:g=>{o(g)},onSearchClick:_,onDescriptionClick:()=>y(!0),onClear:x}),e.jsxs("div",{className:N.filters,children:[e.jsx(ne,{options:L}),e.jsx(je,{options:i}),e.jsx(be,{})]})]}),e.jsx(ge,{open:v,data:Fe,onClose:()=>y(!1)}),e.jsx(re,{filtersToDisplay:["status","type","fromDate","toDate","query"],statusOptions:L,typeOptions:i})]})},Ne="_checkbox_19yw3_1",$e="_description_19yw3_5",Pe="_link_19yw3_9",P={checkbox:Ne,description:$e,link:Pe},we=(s,t)=>s&&t?` created-after:${s} created-before:${t}`:s?` created-after:${s}`:t?` created-before:${t}`:"",Ee=s=>s?` type:${s}`:"",qe=s=>s?` status:${s}`:"",Oe=p.lazy(()=>q(()=>import("./index-CISnXQZH.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),Ye=({instanceId:s,selectedIds:t,setSelectedIds:n})=>{const{search:u,status:r,fromDate:c,toDate:o,type:v,currentPage:y,pageSize:d}=D(),{setSidePanelContent:S}=V(),{getActivitiesQuery:C}=M(),i=we(c,o),h=Ee(v),_=qe(r),x=`${u}${_}${i}${h}`,g=a=>{S(a.summary,e.jsx(p.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(Oe,{activityId:a.id})}))};xe(g);const O=()=>{n([])},{data:m,isPending:T}=C({query:`${s?`computer:id:${s}`:""} ${x??""}`.trim(),limit:d,offset:(y-1)*d}),f=p.useMemo(()=>(m==null?void 0:m.data.results)??[],[m]),R=()=>{n(t.length!==0?[]:f.map(({id:a})=>a))},K=a=>{n(t.includes(a)?t.filter(A=>A!==a):[...t,a])},W=p.useMemo(()=>[{accessor:"checkbox",className:P.checkbox,Header:e.jsx(l.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:R,checked:f.length>0&&t.length===f.length,indeterminate:t.length>0&&t.length<f.length}),Cell:({row:a})=>e.jsx(l.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:a.original.summary}),inline:!0,labelClassName:"u-no-margin--bottom u-no-padding--top",checked:t.includes(a.original.id),onChange:()=>{K(a.original.id)}})},{accessor:"summary",className:P.description,Header:"Description",Cell:({row:a})=>e.jsx(l.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>g(a.original),children:a.original.summary})},{accessor:"activity_status",Header:"Status",Cell:({row:{original:{activity_status:a}}})=>w[a].label,getCellIcon:({row:{original:{activity_status:a}}})=>w[a].icon},{accessor:"computer_id",Header:"Instance",Cell:({row:a})=>a.original.computer_id?e.jsxs(ee,{className:P.link,to:`/instances/${a.original.computer_id}`,children:["ID: ",a.original.computer_id]}):e.jsx(H,{})},{accessor:"creation_time",Header:"Created at",Cell:({row:a})=>e.jsx(e.Fragment,{children:se(a.original.creation_time).format(te)})},{accessor:"creator.name",Header:"Creator",Cell:({row:a})=>{var A;return e.jsx(e.Fragment,{children:((A=a.original.creator)==null?void 0:A.name)??e.jsx(H,{})})}}].filter(a=>!s||a.accessor!=="computer_id"),[f,t]);return e.jsxs(e.Fragment,{children:[!x&&y===1&&d===20&&T&&e.jsx(j,{}),!x&&y===1&&d===20&&!T&&(!m||!m.data.count)&&e.jsx(le,{}),(!!x||y!==1||d!==20||!T&&m&&m.data.count>0)&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{resetSelectedIds:O}),T?e.jsx(j,{}):e.jsx(l.ModularTable,{emptyMsg:"No activities found according to your search parameters.",columns:W,data:f}),e.jsx(ie,{totalItems:m==null?void 0:m.data.count,currentItemCount:f.length,handleClearSelection:O})]})]})},Qe=p.lazy(()=>q(()=>import("./index-CISnXQZH.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),ze=s=>e.jsx(p.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(Qe,{...s})});export{Ye as A,ge as S,w as a,ze as b,M as u};
