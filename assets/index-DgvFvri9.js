import{b as Z,g as O,i as h,k as E,j as e,d as u,ae as H,b4 as K,o as w,h as j,l as S,m as b,c as M,e as W,f as B,p as L,q as A,s as V,G as U,J,v as Q,az as X,aZ as I,a0 as Y,b5 as ee,b6 as se,b7 as te,aB as ne,b8 as ae,b9 as re}from"./index-BSTk3ARV.js";import{P as oe,a as ce,b as ie}from"./PageMain-DD_ciJz0.js";import{u as le}from"./useGetInstances-DrMUoIF6.js";import{u as de}from"./useSelection-Dl5-zlMF.js";import{u as ue}from"./useGetTags-iTf9pLTv.js";import{u as he}from"./useRoles-CB2Qlvbp.js";const pe=()=>{const s=Z(),{data:n,isPending:r}=O({queryKey:["availabilityZones"],queryFn:async()=>s.get("computers/availability-zones")});return{availabilityZones:n?.data.values??[],isGettingAvailabilityZones:r}},me="_menuContainer_xrtuf_1",xe="_wrapper_xrtuf_6",R={menuContainer:me,wrapper:xe},fe="_root_1fm3p_1",je="_label_1fm3p_5",ge="_text_1fm3p_16",ye="_icon_1fm3p_20",ve="_content_1fm3p_24",_={root:fe,label:je,text:ge,icon:ye,content:ve},Se=({el:s})=>{const[n,r]=h.useState(!1),a=h.useRef(null);E(a,()=>{n&&r(!1)});const c=h.cloneElement(s,{inline:!0});return e.jsxs("div",{ref:a,className:_.root,children:[e.jsxs(u.Button,{type:"button",appearance:"base",className:_.label,onClick:()=>{r(o=>!o)},children:[e.jsx(u.Icon,{name:"chevron-down",className:_.icon}),e.jsx("span",{className:_.text,children:s.props.label})]}),n&&e.jsx("div",{className:`p-contextual-menu__dropdown ${_.content}`,children:c})]})},be=({filters:s,collapseFrom:n="md",menuLabel:r="Filters",className:a,menuPosition:c="right"})=>{const o=H(`(min-width: ${K[n]}px)`);return e.jsx("div",{className:w(R.wrapper,a),children:o?s.map((t,l)=>e.jsx("span",{children:t},l)):e.jsx(u.ContextualMenu,{position:c,hasToggleIcon:!0,toggleLabel:r,toggleClassName:"u-no-margin--bottom",children:e.jsx("div",{className:R.menuContainer,children:s.map((t,l)=>t.type.name?e.jsx(Se,{el:t},l):t)})})})},_e="_label_1i8qt_1",Ce={label:_e},we=({options:s,label:n,inline:r=!1})=>{const{disabledColumns:a,setPageParams:c}=j(),o=t=>s.filter(({value:l})=>!t.includes(l)).map(({value:l})=>l);return S("disabledColumns",s.filter(t=>t.canBeHidden).map(t=>t.value)),e.jsx(b,{type:"multiple",showSelectedItemCount:!0,label:e.jsxs(e.Fragment,{children:[e.jsx(u.Icon,{name:"settings"}),e.jsx("span",{className:Ce.label,children:n})]}),onItemsSelect:t=>{c({disabledColumns:o(t)})},options:s,disabledOptions:s.filter(({canBeHidden:t})=>!t),selectedItems:o(a),inline:r})},$=()=>{const s=M(),n=W(),r=(t={},l={})=>O({queryKey:["savedSearches",t],queryFn:async()=>s.get("GetSavedSearches",{params:t}),...l}),a=B({mutationFn:async t=>s.get("CreateSavedSearch",{params:t}),onSuccess:async()=>n.invalidateQueries({queryKey:["savedSearches"]})}),c=B({mutationFn:async t=>s.get("EditSavedSearch",{params:t}),onSuccess:async()=>n.invalidateQueries({queryKey:["savedSearches"]})}),o=B({mutationFn:async t=>s.get("RemoveSavedSearch",{params:t}),onSuccess:async()=>n.invalidateQueries({queryKey:["savedSearches"]})});return{getSavedSearchesQuery:r,createSavedSearchQuery:a,editSavedSearchQuery:c,removeSavedSearchQuery:o}},Ie="_container_m2ugq_1",Ne="_list_m2ugq_6",Be="_listItem_m2ugq_11",Fe="_search_m2ugq_17",ke="_row_m2ugq_25",Pe="_truncated_m2ugq_33",g={container:Ie,list:Ne,listItem:Be,search:Fe,row:ke,truncated:Pe},$e=({onSavedSearchClick:s,onSavedSearchRemove:n,savedSearches:r})=>{if(!r.length)return null;const a=L(),{notify:c}=A(),{removeSavedSearchQuery:o}=$(),{mutateAsync:t,isPending:l}=o,d=async i=>{try{await t({name:i}),n(),c.success({message:`Saved search ${i} successfully removed`,title:"Saved search removed"})}catch(x){a(x)}};return e.jsxs("div",{className:g.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Saved searches"}),e.jsx("ul",{className:w("p-list--divided u-no-margin--bottom",g.list),children:r.map(i=>e.jsx("li",{children:e.jsxs("div",{className:g.listItem,children:[e.jsx(u.Button,{type:"button",appearance:"base",className:g.search,onClick:()=>s(i),children:e.jsxs(u.Row,{className:g.row,children:[e.jsx(u.Col,{size:4,children:e.jsx(u.Tooltip,{message:i.name,positionElementClassName:g.truncated,children:e.jsx("span",{children:i.name})})}),e.jsx(u.Col,{size:8,children:e.jsx(u.Tooltip,{message:i.search,positionElementClassName:g.truncated,children:e.jsx("span",{children:i.search})})})]})}),e.jsx(u.ConfirmationButton,{className:"has-icon u-no-margin--bottom u-no-padding--bottom u-no-padding--top",type:"button",appearance:"base",confirmationModalProps:{title:"Remove saved search",children:e.jsxs("p",{children:['This will remove the saved search "',i.name,'".']}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:l,confirmButtonLoading:l,onConfirm:()=>d(i.name)},children:e.jsx(u.Icon,{name:"delete"})})]})},i.name))})]})},Re="_infoContainer_zti77_1",Te="_helpButtonContainer_zti77_9",qe="_helpButton_zti77_9",F={infoContainer:Re,helpButtonContainer:Te,helpButton:qe},Oe=({onHelpButtonClick:s})=>e.jsx("div",{className:F.infoContainer,children:e.jsx("div",{className:F.helpButtonContainer,children:e.jsx(u.Button,{type:"button",appearance:"base",hasIcon:!0,className:F.helpButton,onClick:n=>{n.stopPropagation(),s()},children:e.jsx(u.Icon,{name:u.ICONS.help})})})}),Ee=({onClose:s,onSearchSave:n,search:r})=>{const a=L(),{notify:c}=A(),{createSavedSearchQuery:o}=$(),{mutateAsync:t}=o,d=V({initialValues:{name:""},onSubmit:async({name:i})=>{try{await t({search:r,name:i,title:i}),c.success({message:`Saved search ${i} successfully added`,title:"Saved search added"}),n(),s()}catch(x){a(x)}},validationSchema:U({name:J().required("This field is required").test({message:"Name must consist of only lowercase alphanumeric characters and hyphens",test:i=>/^[a-z0-9][-a-z0-9]*$/.test(i)})})});return e.jsxs(u.Form,{onSubmit:d.handleSubmit,noValidate:!0,children:[e.jsx(u.Input,{type:"text",autoComplete:"off",autoFocus:!0,label:"Search name",...d.getFieldProps("name"),error:d.touched.name&&d.errors.name?d.errors.name:void 0}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(u.Button,{type:"button",disabled:d.isSubmitting,onClick:s,children:"Cancel"}),e.jsx(u.Button,{type:"submit",disabled:d.isSubmitting,appearance:"positive","aria-label":`Saved search as ${d.values.name}`,children:"Save search"})]})]})},Le="_container_fqj7b_1",Ae="_prompt_fqj7b_10",Qe="_saveButton_fqj7b_17",k={container:Le,prompt:Ae,saveButton:Qe},ze=({onSearchSave:s,search:n})=>{const[r,a]=h.useState(!1);return e.jsxs(e.Fragment,{children:[n&&r&&e.jsx(Ee,{onClose:()=>a(!1),onSearchSave:s,search:n}),n&&!r&&e.jsxs("div",{className:k.container,children:[e.jsxs("span",{className:k.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:n}),e.jsx("span",{children:"..."})]}),e.jsx(u.Button,{type:"button",appearance:"link",onClick:()=>a(!0),className:k.saveButton,children:"Save search"})]})]})},Ge="_searchContainer_pk8ic_1",De="_form_pk8ic_8",Ze="_searchBoxContainer_pk8ic_13",He="_input_pk8ic_17",C={searchContainer:Ge,form:De,searchBoxContainer:Ze,input:He},T=({inputText:s,savedSearches:n,search:r})=>{if(!n)return[];let a=n;if(r){const c=r.split(",").filter(Boolean);a=a.filter(({name:o})=>c.every(t=>t!==`search:${o}`))}return s&&(a=a.filter(({name:c,search:o})=>c.toLowerCase()!==s.trim().toLowerCase()&&o.toLowerCase()!==s.trim().toLowerCase())),a},Ke=({onHelpButtonClick:s})=>{const{query:n,setPageParams:r}=j(),[a,c]=h.useState(""),[o,t]=h.useState(!1),{getSavedSearchesQuery:l}=$(),d=h.useRef(null),i=h.useRef(null);E(d,p=>{const f=document.querySelector(".p-modal");f&&f.contains(p.target)||t(!1)});const{data:y,isLoading:m}=l(),v=h.useMemo(()=>T({inputText:a,savedSearches:y?.data,search:n}),[y,a,n]),N=()=>{if(!a)return;const f=T({inputText:"",savedSearches:y?.data,search:n}).some(({name:D})=>D.toLowerCase()===a.trim().toLowerCase())?"search:":"";r({query:n?`${n},${f}${a}`:`${f}${a}`}),c("")},z=p=>{r({query:n?`${n},search:${p.name}`:`search:${p.name}`})},G=p=>{const{key:f}=p;o?(f==="Escape"&&t(!1),f==="Enter"&&N()):f==="Enter"&&t(!0)};return e.jsxs("div",{className:"p-search-and-filter",ref:d,children:[e.jsxs("div",{className:w("p-search-and-filter__search-container",C.searchContainer),"aria-expanded":o,ref:i,onClick:()=>{t(!0)},children:[e.jsx(u.Form,{onSubmit:p=>{p.preventDefault(),N()},className:w("p-search-and-filter__box",C.form),children:e.jsx("div",{className:C.searchBoxContainer,children:e.jsx(u.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autocomplete:"off",className:C.input,value:a,onChange:p=>{c(p)},onClear:()=>{c("")},onSearch:N,onClick:()=>{t(!0)},onKeyUp:G})})}),e.jsx(Oe,{onHelpButtonClick:s})]}),o&&m&&e.jsx(Q,{}),o&&!m&&e.jsxs("div",{className:"p-search-and-filter__panel",children:[e.jsx(ze,{onSearchSave:()=>{c("")},search:a.trim()}),e.jsx($e,{onSavedSearchClick:z,onSavedSearchRemove:()=>{t(!0)},savedSearches:v})]})]})},Me=({options:s,label:n,inline:r=!1})=>{const{accessGroups:a,setPageParams:c}=j();return S("accessGroups",s.map(o=>o.value)),e.jsx(b,{type:"multiple",label:n,hasToggleIcon:!0,hasBadge:!0,options:s,onItemsSelect:o=>{c({accessGroups:o})},selectedItems:a,inline:r})},We=({options:s,label:n,inline:r=!1})=>{const[a,c]=h.useState(""),{availabilityZones:o,setPageParams:t}=j(),l=s.length>9&&a?s.filter(({value:i})=>i!=="none"&&i.includes(a)):s;S("availabilityZones",l.map(i=>i.value));const d=i=>{i[i.length-1]==="none"?t({availabilityZones:["none"]}):t({availabilityZones:i[0]!=="none"?i:i.filter(x=>x!=="none")})};return e.jsx(b,{type:"multiple",label:n,hasToggleIcon:!0,hasBadge:!0,onSearch:s.length>9?i=>{c(i)}:void 0,options:l,onItemsSelect:d,selectedItems:o,inline:r})},Ve=({options:s,label:n,inline:r=!1})=>{const{os:a,setPageParams:c}=j();return S("os",s.map(o=>o.value)),e.jsx(b,{type:"single",hasBadge:!0,label:n,hasToggleIcon:!0,options:s,onItemSelect:o=>{c({os:o})},selectedItem:a,inline:r})},Ue=({options:s,label:n,inline:r=!1})=>{const[a,c]=h.useState(""),{tags:o,setPageParams:t}=j(),l=s.filter(({value:d})=>d.includes(a));return S("tags",l.map(d=>d.value)),e.jsx(b,{type:"multiple",label:n,hasToggleIcon:!0,hasBadge:!0,options:l,onItemsSelect:d=>{t({tags:d})},onSearch:d=>{c(d)},selectedItems:o,inline:r})},Je=({label:s,inline:n=!1})=>{const{wsl:r,setPageParams:a}=j();return S("wsl",["parent","child"]),e.jsx(b,{type:"multiple",label:s,hasToggleIcon:!0,hasBadge:!0,options:[{label:"WSL parent",value:"parent"},{label:"WSL child",value:"child"}],onItemsSelect:c=>{a({wsl:c})},selectedItems:r,inline:n})},Xe=[{term:"<keyword>",description:e.jsxs("span",{children:["Instances with the title or hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"distribution:<keyword>",description:e.jsxs("span",{children:["Instances with the installed distribution named"," ",e.jsx("code",{children:"<keyword>"})]})},{term:"needs:reboot",description:"Instances needing a reboot"},{term:"alert:<type>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with outstanding alerts of the specified"," ",e.jsx("code",{children:"<type>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be ",e.jsx("code",{children:"package-upgrades"}),","," ",e.jsx("code",{children:"security-upgrades"}),",",e.jsx("code",{children:"package-profiles"}),","," ",e.jsx("code",{children:"package-reporter"}),", ",e.jsx("code",{children:"esm-disabled"}),","," ",e.jsx("code",{children:"computer-offline"}),",",e.jsx("code",{children:"computer-reboot"}),","," ",e.jsx("code",{children:"computer-duplicates"}),", ",e.jsx("code",{children:"unapproved-activities"}),"."]})]})},{term:"ip:<address>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with IP addresses like ",e.jsx("code",{children:"<address>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<address>"})," can be a fragment or partial IP address representing a subnet such as 91.185.94 to match any instances in the subnet."]})]})},{term:"mac:<address>",description:e.jsxs("span",{children:["Instances with the MAC address ",e.jsx("code",{children:"<address>"})]})},{term:"id:<instance_id>",description:e.jsxs("span",{children:["Instance with the id ",e.jsx("code",{children:"<instance_id>"})]})},{term:"access-group:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," access group"]})},{term:"search:<name>",description:e.jsxs("span",{children:["Instances meeting the terms of the ",e.jsx("code",{children:"<name>"})," saved search"]})},{term:"upgrade-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," upgrade profile"]})},{term:"removal-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," removal profile"]})},{term:"tag:<keyword>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<keyword>"})," tag"]})},{term:"hostname:<keyword>",description:e.jsxs("span",{children:["Instance with the hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"title:<keyword>",description:e.jsxs("span",{children:["Instance with the title ",e.jsx("code",{children:"<keyword>"})]})},{term:"license-id:<license_id>",description:e.jsxs("span",{children:["Search for instances licensed to the specified"," ",e.jsx("code",{children:"<license_id>"})]})},{term:"needs:license OR license-id:none",description:"Search for instances that do not have a Landscape license, and, as a result, are not managed"},{term:"annotation:<key>",description:e.jsxs("span",{children:["Search for instances which define the specified annotation key. Optionally specify ",e.jsx("code",{children:"annotation:<key>:<string>"})," ","which will only return instances whose key matches and value also contains the ",e.jsx("code",{children:"<string>"})," specified"]})},{term:"security-profiles:<security-profile-id>:<pass|fail|in-progress>",description:e.jsxs("span",{children:["Search for the security profiles with a specified id. Optionally specify"," ",e.jsx("code",{children:"security-profiles:<security-profiles-id>:<pass|fail|in-progress>"})," ","which will only return security profiles whose id matches, and value also contains ",e.jsx("code",{children:"pass"}),", ",e.jsx("code",{children:"fail"}),","," ",e.jsx("code",{children:"in-progress"})," as specified"]})}],Ye="_top_1d4ve_1",es="_searchContainer_1d4ve_13",ss="_divider_1d4ve_22",P={top:Ye,searchContainer:es,divider:ss},ts=({columnFilterOptions:s})=>{const[n,r]=h.useState(!1),{getAccessGroupQuery:a}=he(),{tags:c}=ue(),o=c.map(m=>({label:m,value:m}))??[],{availabilityZones:t}=pe(),l=t.reduce((m,v)=>(m.push({label:v,value:v}),m),[{label:"Without zones",value:"none",group:"1"}]),{data:d}=a(),i=d?.data.map(({name:m,title:v})=>({value:m,label:v}))??[],x=I.status.options,y=I.os.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:P.top,children:[e.jsx("div",{className:P.searchContainer,children:e.jsx(Ke,{onHelpButtonClick:()=>{r(!0)}})}),e.jsx(be,{collapseFrom:"xxl",filters:[e.jsx(X,{label:"Status",options:x},"status"),e.jsx(Ve,{label:"OS",options:y},"os"),e.jsx(We,{label:"Availability zones",options:l},"availability-zone"),e.jsx(Me,{label:"Access groups",options:i},"access-group"),e.jsx(Ue,{label:"Tags",options:o},"tag"),e.jsx(Je,{label:"WSL",options:[]},"wsl"),e.jsx("span",{className:P.divider},"divider-2"),e.jsx(we,{label:"Columns",options:s},"column")]})]}),e.jsx(Y,{filtersToDisplay:["accessGroups","os","availabilityZones","status","tags","query","wsl"],accessGroupOptions:i,availabilityZonesOptions:l,osOptions:y,statusOptions:x,tagOptions:o}),e.jsx(ee,{open:n,data:Xe,onClose:()=>{r(!1)}}),e.jsx(se,{})]})},ns=h.memo(function({instanceCount:n,instances:r,isGettingInstances:a,selectedInstances:c,setSelectedInstances:o}){const[t,l]=h.useState([]),d=h.useCallback(()=>{o([])},[]);return e.jsxs(e.Fragment,{children:[e.jsx(ts,{columnFilterOptions:t}),a?e.jsx(Q,{}):e.jsx(te,{instances:r,selectedInstances:c,setColumnFilterOptions:l,setSelectedInstances:o}),e.jsx(ne,{totalItems:n,handleClearSelection:d,currentItemCount:r.length})]})}),q=(s,n)=>s.type==="select"?s.options.find(r=>r.value===n)?.query??"":"",as=({accessGroups:s,availabilityZones:n,os:r,query:a,status:c,tags:o})=>{const t=[];return r&&t.push(q(I.os,r)),c&&t.push(q(I.status,c)),a&&t.push(...a.split(",")),o.length&&t.push(`tag:${o.join(" OR tag:")}`),s.length&&t.push(`access-group:${s.join(" OR access-group:")}`),n.length&&t.push(n.includes("none")?"availability-zone:null":`availability-zone:${n.join(" OR availability-zone:")}`),t.join(" ")},us=()=>{const{currentPage:s,pageSize:n,wsl:r,...a}=j(),{instances:c,instancesCount:o,isGettingInstances:t}=le({query:as(a),archived_only:a.status==="archived",with_alerts:!0,with_upgrades:ae,limit:n,offset:(s-1)*n,wsl_children:r.includes("child"),wsl_parents:r.includes("parent")}),{selectedItems:l,setSelectedItems:d}=de(c,t);return e.jsxs(oe,{children:[e.jsx(ce,{title:"Instances",actions:[e.jsx(re,{isGettingInstances:t,selectedInstances:l},"actions")],sticky:!0}),e.jsx(ie,{children:e.jsx(ns,{instanceCount:o,instances:c,isGettingInstances:t,selectedInstances:l,setSelectedInstances:d})})]})};export{us as default};
