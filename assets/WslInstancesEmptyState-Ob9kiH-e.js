const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-QE2dJzR0.js","assets/index-DvQ7Ypp3.js","assets/index-D86Q3Mim.css","assets/FileInput-t9tDl38v.js","assets/SidePanelFormButtons-C0IpdDKq.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/useGetWslInstanceTypes-CtU2UaKi.js"])))=>i.map(i=>d[i]);
import{b as v,g as $,h as w,o as f,p as g,H as d,j as n,n as W,a0 as j,d as c,ap as A,l as y,F as M,_ as T,E as N}from"./index-DvQ7Ypp3.js";import{G as R}from"./GroupFilter-EnSK_Yhs.js";import{H as q}from"./HeaderWithSearch-CxYGZV3d.js";import"./index-ERE8cF63.js";import{T as C}from"./TextConfirmationModal-BnO8D1-m.js";const U={id:6,title:"Noel's Windows Laptop",comment:"",cloud_init:{},hostname:"noel",is_default_child:null,total_memory:1024,total_swap:1024,reboot_required_flag:!1,update_manager_prompt:"normal",clone_id:null,secrets_name:null,last_exchange_time:null,last_ping_time:"2023-11-29T18:24:25Z",tags:["laptop","windows"],access_group:"server",distribution:"10 / 11",cloud_instance_metadata:{},vm_info:null,container_info:null,ubuntu_pro_info:null,is_wsl_instance:!1,children:[{id:11,title:"Bionic WSL",comment:"",cloud_init:{},hostname:"bionic-wsl",is_default_child:null,total_memory:1024,total_swap:1024,reboot_required_flag:!1,update_manager_prompt:"normal",clone_id:null,secrets_name:null,last_exchange_time:null,last_ping_time:"2023-11-29T18:19:25Z",tags:["bionic","wsl"],access_group:"global",distribution:"18.04",cloud_instance_metadata:{},vm_info:null,container_info:null,ubuntu_pro_info:null,is_wsl_instance:!0,distribution_info:{code_name:"bionic",description:"Ubuntu 18.04 LTS",distributor:"Canonical",release:"18.04"},employee_id:null,archived:!1,registered_at:"2023-11-29T18:29:25Z"}],parent:null,distribution_info:{code_name:"windows",description:"Windows 10 / Windows 11",distributor:"Microsoft",release:"10 / 11"},employee_id:null,archived:!1,registered_at:"2023-11-29T18:29:25Z"},E=()=>{const t=v(),e=$(),{isPending:s,mutateAsync:l}=w({mutationFn:async({parent_id:r,...u})=>t.post(`computers/${r}/delete-children`,{params:u}),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["wsl-hosts"]}),e.invalidateQueries({queryKey:["instances"]})])});return{isUninstallingWslInstances:s,uninstallWslInstances:l}},O=()=>{const t=v(),{isPending:e,mutateAsync:s}=w({mutationFn:async l=>t.post("child-instance-profiles/make-hosts-compliant",l)});return{isMakingWindowsInstancesCompliant:e,makeWindowsInstancesCompliant:s}},L=()=>{const t=v(),{isPending:e,mutateAsync:s}=w({mutationFn:async({name:l})=>t.post(`child-instance-profiles/${l}:reapply`)});return{reapplyWslProfile:s,isReapplyingWslProfile:e}},D=({close:t,instances:e,isOpen:s})=>{const l=f(),{notify:r}=g(),{makeWindowsInstancesCompliant:u}=O(),[m]=e;if(!m)return;const i=d(e.length,m.title,`${e.length} instances`),p=async()=>{try{await u({host_computer_ids:e.map(({id:o})=>o)}),r.success({title:`You have successfully marked ${i} to be compliant.`,message:d(e.length,"An activity has been queued to uninstall, install or reinstall all non-compliant child instances.","Activities have been queued to uninstall, install or reinstall all non-compliant child instances.")})}catch(o){l(o)}finally{t()}};return n.jsxs(C,{isOpen:s,close:t,title:`Make ${i} compliant`,confirmButtonLabel:"Make compliant",confirmButtonAppearance:"negative",confirmButtonDisabled:!1,confirmButtonLoading:!1,confirmationText:`make ${i} compliant`,onConfirm:p,children:[n.jsx("p",{children:"This will:"}),n.jsxs("ol",{children:[n.jsx("li",{children:"Remove all child instances that haven’t been created by Landscape"}),n.jsx("li",{children:"Install the instances according to the profiles the parent is associated with"}),n.jsx("li",{children:"Reinstall instances that already exist but aren’t compliant"})]})]})},Y=({close:t,instances:e,isOpen:s})=>{const l=f(),{notify:r}=g(),{reapplyWslProfile:u}=L(),[m]=e;if(!m)return;const i=d(e.length,m.name,`${e.length} instances`),p=async()=>{try{await Promise.all(e.map(o=>u({name:o.name,computer_ids:[U.id]}))),r.success({title:`You have successfully marked ${i} to be reinstalled.`,message:d(e.length,"An activity has been queued to reinstall it.","Activities have been queued to reinstall them.")})}catch(o){l(o)}finally{t()}};return n.jsx(C,{isOpen:s,close:t,title:`Reinstall ${i}`,confirmButtonLabel:"Reinstall",confirmButtonAppearance:"negative",confirmButtonDisabled:!1,confirmButtonLoading:!1,confirmationText:`reinstall ${i}`,onConfirm:p,children:n.jsx("p",{children:d(e.length,"This will uninstall this instance and create a new one with the same name that is compliant with its profiles.","This will uninstall the selected instances and create new ones with the same names that are compliant with their profiles.")})})},H=({close:t,instances:e,isOpen:s,onSuccess:l,parentId:r})=>{const u=f(),{notify:m}=g(),{isUninstallingWslInstances:i,uninstallWslInstances:p}=E(),[o]=e;if(!o)return;const h=d(e.length,o.name,`${e.length} instances`),x=async()=>{try{await p({parent_id:r,child_names:e.map(({name:_})=>_)}),m.success({title:`You have successfully marked ${h} to be uninstalled.`,message:d(e.length,"An activity has been queued to uninstall it.","Activities have been queued to uninstall them.")}),l?.()}catch(_){u(_)}finally{t()}};return n.jsx(C,{isOpen:s,close:t,title:`Uninstall ${h}`,confirmButtonLabel:"Uninstall",confirmButtonAppearance:"negative",confirmButtonDisabled:i,confirmButtonLoading:i,confirmationText:`uninstall ${h}`,onConfirm:x,children:n.jsx("p",{children:d(e.length,"This will permanently uninstall this instance from the Windows host machine and remove it from Landscape.","This will permanently uninstall the selected instances from the Windows host machine and remove them from Landscape.")})})},Z="_cta_1o9o6_1",z="_buttons_1o9o6_7",k={cta:Z,buttons:z},G=y.lazy(async()=>T(()=>import("./index-QE2dJzR0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),en=({selectedWslInstances:t,windowsInstance:e,wslInstances:s})=>{const l=f(),{notify:r}=g(),{setSidePanelContent:u}=W(),{reapplyWslProfile:m}=L(),{value:i,setTrue:p,setFalse:o}=j(),{value:h,setTrue:x,setFalse:_}=j(),{value:I,setTrue:B,setFalse:F}=j(),P=async()=>{try{await Promise.all(t.map(a=>m({name:a.name,computer_ids:[e.id]}))),r.success({title:`You have successfully queued ${d(t.length,`${t[0].name}`,`${t.length} instances`)} to be installed.`,message:"An activity has been queued to install it."})}catch(a){l(a)}},S=()=>{u("Create new WSL instance",n.jsx(y.Suspense,{fallback:n.jsx(M,{}),children:n.jsx(G,{})}))},b=s.some(a=>a.profile);return n.jsxs(n.Fragment,{children:[n.jsx(q,{actions:n.jsxs("div",{className:k.cta,children:[b&&n.jsx(R,{label:"Group by",options:[{label:"None",value:""},{label:"Compliance",value:"compliance"}]}),n.jsxs("div",{className:k.buttons,children:[n.jsx("div",{className:"p-segmented-control",children:n.jsxs("div",{className:"p-segmented-control__list",children:[b&&n.jsxs(c.Button,{type:"button",onClick:P,className:"p-segmented-control__button u-no-margin--bottom",hasIcon:!0,disabled:!t.length||t.some(a=>a.compliance!=="uninstalled"),children:[n.jsx(c.Icon,{name:"begin-downloading"}),n.jsx("span",{children:"Install"})]}),b&&n.jsxs(c.Button,{type:"button",onClick:p,className:"p-segmented-control__button u-no-margin--bottom",hasIcon:!0,disabled:!t.length||t.some(a=>a.compliance!=="noncompliant"),children:[n.jsx(c.Icon,{name:"restart"}),n.jsx("span",{children:"Reinstall"})]}),n.jsxs(c.Button,{type:"button",onClick:x,className:"p-segmented-control__button u-no-margin--bottom",hasIcon:!0,disabled:!t.length||t.some(a=>!a.installed),children:[n.jsx(c.Icon,{name:"close"}),n.jsx("span",{children:"Uninstall"})]})]})}),n.jsx("div",{className:"p-segmented-control",children:n.jsxs("div",{className:"p-segmented-control__list",children:[n.jsxs(c.Button,{type:"button",onClick:S,className:"p-segmented-control__button u-no-margin--bottom",hasIcon:!0,children:[n.jsx(c.Icon,{name:"plus"}),n.jsx("span",{children:"Create new instance"})]}),b&&n.jsxs(c.Button,{type:"button",className:"p-segmented-control__button u-no-margin--bottom",hasIcon:!0,onClick:B,disabled:s.every(a=>a.compliance==="compliant"||a.compliance==="pending"),children:[n.jsx(c.Icon,{name:"security-tick"}),n.jsx("span",{children:"Make compliant"})]})]})})]})]})}),n.jsx(A,{filtersToDisplay:["search"]}),n.jsx(Y,{close:o,instances:t,isOpen:i,windowsInstance:e}),n.jsx(H,{close:_,instances:t,isOpen:h,parentId:e.id}),n.jsx(D,{close:F,instances:[e],isOpen:I})]})},Q=y.lazy(()=>T(()=>import("./index-QE2dJzR0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),tn=()=>{const{setSidePanelContent:t}=W(),e=()=>{t("Create new WSL instance",n.jsx(y.Suspense,{fallback:n.jsx(M,{}),children:n.jsx(Q,{})}))};return n.jsx(N,{title:"No WSL instances found",body:n.jsxs(n.Fragment,{children:[n.jsx("p",{children:"This computer does not have any WSL instances installed. You can install a new instance by clicking the button below."}),n.jsx("a",{href:"https://ubuntu.com/desktop/wsl",target:"_blank",rel:"nofollow noopener noreferrer",children:"Learn more about Ubuntu WSL"})]}),cta:[n.jsx(c.Button,{appearance:"positive",type:"button",onClick:e,children:"Create new WSL instance"},"install-new-instance-button")]})};export{Y as W,H as a,en as b,tn as c,D as d,O as e,L as u};
