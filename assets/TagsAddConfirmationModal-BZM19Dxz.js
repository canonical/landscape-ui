import{d as m,l as P,a7 as C,n as x,J as o,j as n,e as s,a as w,a8 as d}from"./index-CIJ7mRT9.js";import{M as $}from"./ModalTablePagination-BIC1ZD_y.js";const _=(t,r)=>{const i=m(),{data:l,isFetching:a,isPending:c,refetch:g}=P({queryKey:["profileChanges",t],queryFn:async()=>i.get("tags/profile-diff",{params:t}),...r});return{isFetchingProfileChanges:a,isPendingProfileChanges:c,profileChanges:l?.data.results??[],profileChangesCount:l?.data.count??0,refetchProfileChanges:g}},j=t=>{const r={};return r["aria-label"]=`${t.original.profile.name} profile change row`,r},b=({instances:t,profileChangesCount:r,tags:i,...l})=>{const{count:a,decrement:c,increment:g}=C(1),{isPendingProfileChanges:f,profileChanges:u}=_({instance_ids:t.map(e=>e.id),tags:i,limit:d,offset:(a-1)*d}),p=x.useMemo(()=>[i.length>1?{Header:"Tag",Cell:({row:{original:e}})=>e.tag}:null,{Header:"Active profiles",Cell:({row:{original:e}})=>e.profile.name},{Header:"Profile type",Cell:({row:{original:e}})=>({ChildInstanceProfile:"WSL",PackageProfile:"Package",RebootProfile:"Reboot",RemovalProfile:"Removal",RepositoryProfile:"Repository",ScriptProfile:"Script",UpgradeProfile:"Upgrade",UsgProfile:"Security"})[e.profile.profile_type]},{Header:"Associated instances",Cell:({row:{original:e}})=>{const h=`${e.profile.current_associated_instances} ${o(e.profile.current_associated_instances,"instance")}`;return e.profile.will_exceed_limit?n.jsxs(s.Tooltip,{message:`Adding ${o(t.length,"this instance","these instances")} will exceed the instance limit.`,children:[n.jsx(s.Icon,{name:"warning"}),h]}):h},getCellIcon:({row:{original:e}})=>e.profile.will_exceed_limit?"":null}].filter(e=>e!=null),[]);return n.jsxs(s.ConfirmationModal,{title:`Add ${o(i.length,`"${i[0]}" tag`,`${i.length} tags`)} to ${o(t.length,`"${t[0].title}"`,`${t.length} instances`)}`,confirmButtonLabel:"Add tags",...l,children:[n.jsx("p",{children:"Adding tags could trigger irreversible changes to your instances."}),n.jsxs("p",{children:["Adding"," ",o(i.length,`the ${i[0]} tag`,`these ${i.length} tags`)," ","to"," ",o(t.length,`the ${t[0].title} instance`,`${t.length} instances`)," ","will associate the ",o(t.length,"instance")," with the following profiles."]}),n.jsx("p",{children:"Some instances might not be associated with certain profiles due to restrictions."}),f?n.jsx(w,{}):n.jsx(s.ModularTable,{className:"u-no-margin--bottom",columns:p,data:u,getRowProps:j}),n.jsx($,{max:Math.ceil(r/d),current:a,onPrev:c,onNext:g})]})};export{b as T,_ as u};
