import{a5 as F,v as N,x as R,I as $,y as D,w as O,o as I,p as T,k as S,q as k,l as L,j as e,d as l,a7 as m,f as q,i as Q,Z as M,M as b,K as d,C as V}from"./index-CYddq1Dt.js";import{A as H}from"./AssociationBlock-B72vcgBb.js";import{S as U}from"./SidePanelFormButtons-y29iSwpX.js";import{u as w}from"./useRoles-CskDJFuI.js";import{u as C}from"./index-DWDYy_my.js";import{R as xe,a as Pe,b as je}from"./index-DWDYy_my.js";import{T as K}from"./TextConfirmationModal-D1Pp81Mj.js";import"./MultiSelectField-Gz723sxa.js";import"./useGetTags-CnCFjIwc.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";import"./PageMain-wcB-RWYa.js";import"./constants-BvfXqWjy.js";import"./constants-Cj2pKWow.js";import"./HeaderWithSearch-LK3eyMPY.js";const A={add:"Add",edit:"updated"},z={add:"Add removal profile",edit:"Save changes"},W={access_group:F,all_computers:!1,days_without_exchange:"",tags:[],title:""},Z=t=>N().shape({access_group:R(),all_computers:O(),days_without_exchange:D().test({name:"required",message:"This field is required.",params:{action:t},test:o=>o!=null||t!=="add"}).integer("Timeframe must be an integer value.").min(1,"Timeframe must be at least 1.").max(2147483647,"Timeframe must be less than 2147483648."),tags:$().of(R()),title:R().test({name:"required",message:"This field is required.",params:{action:t},test:o=>!!o||t!=="add"})}),J="_inputContainer_v1jo9_1",X="_input_v1jo9_1",Y="_inputDescription_v1jo9_10",g={inputContainer:J,input:X,inputDescription:Y},E=t=>{const o=I(),{notify:n}=T(),{sidePath:c,popSidePath:p,setPageParams:u}=S(),{createRemovalProfileQuery:a,editRemovalProfileQuery:v}=C(),{getAccessGroupQuery:_}=w(),{data:x}=_(),P=x?.data.map(({name:i,title:r})=>({label:r,value:i}))??[],{mutateAsync:f}=a,{mutateAsync:j}=v,h=()=>{u({sidePath:[],profile:""})},s=k({initialValues:W,onSubmit:async i=>{const r={title:i.title,days_without_exchange:i.days_without_exchange,access_group:i.access_group,all_computers:i.all_computers};!i.all_computers&&i.tags.length>0&&(r.tags=i.tags);try{t.action==="edit"?await j({all_computers:r.all_computers,days_without_exchange:r.days_without_exchange,name:t.profile.name,tags:r.tags,title:r.title}):await f(r),h(),n.success({message:`Removal profile ${A[t.action]}`,title:`Removal profile ${i.title} has been ${A[t.action]}`})}catch(B){o(B)}},validationSchema:Z(t.action)});return L.useEffect(()=>{t.action==="edit"&&s.setValues({access_group:t.profile.access_group,all_computers:t.profile.all_computers,days_without_exchange:t.profile.days_without_exchange,tags:t.profile.tags,title:t.profile.title})},[t]),e.jsxs(l.Form,{onSubmit:s.handleSubmit,noValidate:!0,children:[e.jsx(l.Input,{type:"text",label:"Title",required:t.action==="add",...s.getFieldProps("title"),error:s.touched.title&&s.errors.title?s.errors.title:void 0}),e.jsxs("div",{className:g.inputContainer,children:[e.jsx(l.Input,{type:"number",inputMode:"numeric",label:"Removal timeframe",required:t.action==="add",autoComplete:"off",className:g.input,wrapperClassName:g.inputWrapper,...s.getFieldProps("days_without_exchange"),error:s.touched.days_without_exchange&&s.errors.days_without_exchange?s.errors.days_without_exchange:void 0}),e.jsx("span",{className:g.inputDescription,children:"days"})]}),e.jsx(l.Select,{label:"Access group",options:P,...s.getFieldProps("access_group"),error:s.touched.access_group&&s.errors.access_group?s.errors.access_group:void 0}),e.jsx(H,{formik:s}),e.jsx(U,{submitButtonDisabled:s.isSubmitting,submitButtonText:z[t.action],onCancel:h,hasBackButton:c.length>1,onBackButtonPress:p})]})},fe=()=>e.jsxs(e.Fragment,{children:[e.jsx(m.Header,{children:"Add removal profile"}),e.jsx(m.Content,{children:e.jsx(E,{action:"add"})})]});function ee(t){const o=q(),{data:n,isPending:c,error:p}=Q({queryKey:["removalProfile",t],queryFn:async({signal:a})=>o.get("GetRemovalProfiles",{signal:a})}),u=n?.data.find(({id:a})=>a===t);return{removalProfile:u,removalProfileError:n&&!u?new Error("The removal profile could not be found."):p,isGettingRemovalProfile:c}}const G=()=>{const{profile:t}=S(),{isGettingRemovalProfile:o,removalProfile:n,removalProfileError:c}=ee(parseInt(t));if(c)throw c;return o?{removalProfile:void 0,isGettingRemovalProfile:!0}:{removalProfile:n,isGettingRemovalProfile:!1}},he=()=>{const t=I(),{notify:o}=T(),{pushSidePath:n,setPageParams:c}=S(),{removeRemovalProfileQuery:p}=C(),{getAccessGroupQuery:u}=w(),{removalProfile:a,isGettingRemovalProfile:v}=G(),{data:_,isPending:x}=u(),{mutateAsync:P,isPending:f}=p,{value:j,setTrue:h,setFalse:y}=M();if(v||x)return e.jsx(m.LoadingState,{});const s=async()=>{try{await P({name:a.name}),c({sidePath:[],profile:""}),o.success({title:"Removal profile removed",message:`Removal profile ${a.title} has been removed`})}catch(r){t(r)}finally{y()}},i=()=>{n("edit")};return e.jsxs(e.Fragment,{children:[e.jsx(m.Header,{children:a.title}),e.jsxs(m.Content,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(l.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:i,"aria-label":`Edit ${a.title}`,children:[e.jsx(l.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(l.Button,{className:"p-segmented-control__button",hasIcon:!0,type:"button",onClick:h,"aria-label":`Remove ${a.title}`,children:[e.jsx(l.Icon,{name:l.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(b,{children:[e.jsx(b.Item,{children:e.jsxs(d,{children:[e.jsx(d.Item,{label:"Title",value:a.title}),e.jsx(d.Item,{label:"Name",value:a.name}),e.jsx(d.Item,{label:"Access group",value:_?.data.find(r=>r.name===a.access_group)?.title??a.access_group}),e.jsx(d.Item,{label:"Removal timeframe",large:!0,value:`${a.days_without_exchange} ${V(a.days_without_exchange,"day")}`})]})}),e.jsxs(b.Item,{title:"Association",children:[a.all_computers&&e.jsx("p",{children:"This profile has been associated with all instances."}),!a.all_computers&&!a.tags.length&&e.jsx("p",{children:"This profile has not yet been associated with any instances."}),!a.all_computers&&!!a.tags.length&&e.jsx(d,{children:e.jsx(d.Item,{label:"Tags",large:!0,value:a.tags.join(", ")||null,type:"truncated"})})]})]})]}),e.jsx(K,{isOpen:j,title:"Remove package profile",confirmationText:`remove ${a.title}`,confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:f,confirmButtonLoading:f,onConfirm:s,close:y,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},ge=()=>{const{removalProfile:t,isGettingRemovalProfile:o}=G();return o?e.jsx(m.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(m.Header,{children:['Edit "',t.title,'" profile']}),e.jsxs(m.Content,{children:[e.jsx(E,{action:"edit",profile:t}),";"]})]})};export{fe as RemovalProfileAddSidePanel,he as RemovalProfileDetailsSidePanel,ge as RemovalProfileEditSidePanel,xe as RemovalProfileList,Pe as RemovalProfilesEmptyState,je as RemovalProfilesHeader,C as useRemovalProfiles};
