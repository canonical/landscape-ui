import{k as f,r as j,j as e,h as o,i as A,l as y,m as v,n as P,t as N,E as S,g as D}from"./index-BUcGDZCR.js";import{P as w,a as G,b as B}from"./PageMain-CCULNlPm.js";import{u as x}from"./useRoles-C51ddSpY.js";import{S as C}from"./SidePanelFormButtons-UNqnJWHo.js";import"./useFetchOld-wQl16_NT.js";import"./SidePanelFormButtons.module-yv6Qz3cN.js";const _="_actions_11z1b_1",F="_name_11z1b_5",h={actions:_,name:F},L=({accessGroupData:l})=>{const{removeAccessGroupQuery:d}=x(),r=f(),{mutateAsync:c,isPending:a}=d,u=(t,n="",p=0)=>{let g=[];return t.filter(b=>b.parent===n).forEach(b=>{g.push({...b,indentLevel:p}),g=g.concat(u(t,b.name,p+1))}),g},i=j.useMemo(()=>{const t=l.sort((n,p)=>n.name.localeCompare(p.name))||[];return u(t)},[l.length]),m=async t=>{try{await c({name:t})}catch(n){r(n)}},s=j.useMemo(()=>[{accessor:"title",Header:"Title",className:h.name},{accessor:"name",Header:"Name",className:h.name},{accessor:"id",className:h.actions,Cell:({row:t})=>t.original.name==="global"?null:e.jsx("div",{className:"divided-blocks",children:e.jsx("div",{className:"divided-blocks__item",children:e.jsx(o.ConfirmationButton,{className:"u-no-margin--bottom u-no-padding--left is-small has-icon",type:"button",appearance:"base","aria-label":`Remove ${t.original.name} access group`,confirmationModalProps:{title:`Deleting ${t.original.name} access group`,children:e.jsx("p",{children:"Are you sure?"}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:a,confirmButtonLoading:a,onConfirm:()=>m(t.original.name)},children:e.jsx(o.Tooltip,{position:"btm-center",message:"Delete",children:e.jsx(o.Icon,{name:o.ICONS.delete})})})})})}],[i]);return e.jsx(e.Fragment,{children:e.jsx(o.ModularTable,{columns:s,data:i,getCellProps:t=>{const n=t.row.original;switch(t.column.id){case"name":return{role:"rowheader"};case"title":return{"aria-label":"Title",style:{paddingLeft:`${n.indentLevel*2}rem`}};case"id":return{"aria-label":"Actions"};default:return{}}}})})},k=()=>{const{createAccessGroupQuery:l,getAccessGroupQuery:d}=x(),{mutateAsync:r}=l,{closeSidePanel:c}=A(),{data:a,isLoading:u}=d(),i=((a==null?void 0:a.data)??[]).map(t=>({label:t.title,value:t.name})),m=f(),s=y({initialValues:{title:"",parent:""},validationSchema:v().shape({title:P().required("This field is required")}),onSubmit:async t=>{try{await r(t),c()}catch(n){m(n)}}});return e.jsxs(o.Form,{noValidate:!0,onSubmit:s.handleSubmit,children:[e.jsx(o.Input,{type:"text",label:"Title",id:"new-access-group-title",required:!0,error:s.touched.title&&s.errors.title?s.errors.title:void 0,...s.getFieldProps("title")}),e.jsx(o.Select,{required:!0,id:"Parent",label:"Parent",disabled:u,options:[...i],...s.getFieldProps("parent")}),e.jsx(C,{submitButtonDisabled:s.isSubmitting,submitButtonText:"Add access group"})]})},Q=()=>{const{setSidePanelContent:l}=A(),{getAccessGroupQuery:d}=x(),{data:r,isLoading:c}=d(),a=(r==null?void 0:r.data)??[],u=()=>{l("Add access group",e.jsx(k,{}))},i=({className:m})=>e.jsx(o.Button,{appearance:"positive",onClick:u,onMouseDown:s=>{s.preventDefault()},type:"button",className:D("u-no-margin--right",m),children:"Add access group"});return e.jsxs(w,{children:[e.jsx(G,{title:"Access groups",actions:[e.jsx(i,{},"add-new-access-group-button")]}),e.jsxs(B,{children:[c&&e.jsx(N,{}),!c&&a.length===0&&e.jsx(S,{title:"No access groups found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any access groups yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/access-groups",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage access groups in Landscape"})]}),cta:[e.jsx(i,{},"empty-state-new-button")]}),!c&&a.length>0&&e.jsx(L,{accessGroupData:a})]})]})};export{Q as default};
