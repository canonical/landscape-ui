import{G as U,q as k,s as _,p as q,t as v,y as A,N as T,B as a,O as B,j as s,e as t}from"./index-DN_YS9_3.js";import{S as C}from"./SidePanelFormButtons-CeIrPige.js";import{M}from"./MultiSelectField-BBnvEm8T.js";import{u as Q}from"./index-BzLyjEYA.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./helpers-C79LO1cG.js";import"./HeaderWithSearch-DzjwmQR6.js";import"./constants-DtLZBNBu.js";const z=({user:i})=>{const{instanceId:c}=U(),h=k(),{notify:g}=_(),{closeSidePanel:P}=q(),{editUserQuery:b,getGroupsQuery:y,getUserGroupsQuery:w,addUserToGroupQuery:G,removeUserFromGroupQuery:f}=Q(),u=Number(c),{data:x,isLoading:V}=y({computer_id:u}),{data:N}=w({username:i.username,computer_id:u}),{mutateAsync:S}=b,{mutateAsync:F}=G,{mutateAsync:j}=f,p=x?.data.groups??[],d=p.map(r=>({label:r.name,value:String(r.gid)})),m=N?.data.groups.map(r=>String(r.gid))||[],e=v({initialValues:{name:i.name??"",username:i.username,password:"",confirmPassword:"",location:i.location??"",homePhoneNumber:i.home_phone??"",workPhoneNumber:i.work_phone??"",primaryGroupValue:String(i.primary_gid),additionalGroupValue:m},validationSchema:A().shape({username:a().required("This field is required"),name:a(),password:a(),confirmPassword:a().when("password",([r],n)=>r&&r.length>0?n.trim().required("Confirm passphrase is required").oneOf([B("password"),""],"Passphrases must match"):n.notRequired()),location:a(),homePhoneNumber:a(),workPhoneNumber:a(),primaryGroupValue:a().required("This field is required"),additionalGroupValue:T().of(a())}),onSubmit:async r=>{const n=r.additionalGroupValue.filter(o=>!m.includes(o)),I=m.filter(o=>!r.additionalGroupValue.includes(o)),l=p.filter(o=>n.includes(String(o.gid))).map(o=>o.name);try{const o=[];n.length&&o.push(F({computer_id:u,groupnames:l,usernames:[r.username],action:"add"})),I.length&&o.push(j({computer_id:u,groupnames:l,usernames:[r.username],action:"remove"})),o.push(S({computer_ids:[u],name:r.name,username:r.username,password:r.password,location:r.location,home_phone:r.homePhoneNumber,work_phone:r.workPhoneNumber,primary_groupname:r.primaryGroupValue})),await Promise.all(o),P(),g.success({message:"User updated successfully"})}catch(o){h(o)}}});return s.jsxs(t.Form,{onSubmit:e.handleSubmit,noValidate:!0,name:"edit-user",children:[s.jsx(t.Input,{type:"text",label:"Username",required:!0,autoComplete:"new-username",error:e.touched.username&&e.errors.username?e.errors.username:void 0,...e.getFieldProps("username")}),s.jsx(t.Input,{type:"text",label:"Name",error:e.touched.name&&e.errors.name?e.errors.name:void 0,...e.getFieldProps("name")}),s.jsx(t.Input,{type:"password",label:"Passphrase",autoComplete:"new-password",error:e.touched.password&&e.errors.password?e.errors.password:void 0,...e.getFieldProps("password")}),s.jsx(t.Input,{type:"password",label:"Confirm passphrase",autoComplete:"new-password",error:e.touched.confirmPassword&&e.errors.confirmPassword?e.errors.confirmPassword:void 0,...e.getFieldProps("confirmPassword")}),s.jsx(t.Select,{"data-testid":"primaryGroupValue",label:"Primary Group",required:!0,disabled:V,options:d,...e.getFieldProps("primaryGroupValue"),error:e.touched.primaryGroupValue&&e.errors.primaryGroupValue?e.errors.primaryGroupValue:void 0}),s.jsx(M,{variant:"condensed",placeholder:"Select groups",label:"Additional Groups",items:d,selectedItems:d.filter(({value:r})=>e.values.additionalGroupValue.includes(r)),onItemsUpdate:r=>{e.setFieldValue("additionalGroupValue",r.map(({value:n})=>n))},error:e.touched.additionalGroupValue&&(Array.isArray(e.errors.additionalGroupValue)?e.errors.additionalGroupValue.join(", "):e.errors.additionalGroupValue)||void 0}),s.jsx(t.Input,{type:"text",label:"Location",error:e.touched.location&&e.errors.location?e.errors.location:void 0,...e.getFieldProps("location")}),s.jsx(t.Input,{type:"text",label:"Home phone",error:e.touched.homePhoneNumber&&e.errors.homePhoneNumber?e.errors.homePhoneNumber:void 0,...e.getFieldProps("homePhoneNumber")}),s.jsx(t.Input,{type:"text",label:"Work phone",error:e.touched.workPhoneNumber&&e.errors.workPhoneNumber?e.errors.workPhoneNumber:void 0,...e.getFieldProps("workPhoneNumber")}),s.jsx(C,{submitButtonDisabled:e.isSubmitting,submitButtonText:"Save changes"})]})};export{z as default};
