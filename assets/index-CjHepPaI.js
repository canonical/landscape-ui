import{m as C,t as p,v as S,e as j,A as I,z as A,C as g,j as t,d as i,F as m,V as h,a0 as b,b as y,$ as E,a2 as x,R as f,c as F,r as L,i as P,aO as _}from"./index-BniO5lih.js";import{A as w}from"./AuthTemplate-BjB-8SvC.js";import{V as N,I as V,a as v,b as T}from"./constants-Dfr6WUEj.js";import{P as q}from"./PasswordConstraints-Dw6bUA-P.js";import"./constants-BYjiL6e-.js";const U=()=>{const s=C(),a=p(),{isPending:o,mutateAsync:n}=S({mutationFn:async e=>s.post("accounts",e),onSuccess:async()=>{await a.invalidateQueries({queryKey:["authUser"]})}});return{createSaaSAccount:n,isCreatingSaaSAccount:o}},H=()=>{const s=p(),a=j.create({baseURL:I}),{isPending:o,mutateAsync:n}=S({mutationFn:async e=>a.post("standalone-account",e),onSuccess:async()=>{await s.invalidateQueries({queryKey:["standaloneAccount"]})}});return{createStandaloneAccount:n,isCreatingStandaloneAccount:o}},O="_button_1t6xj_1",R={button:O},k=()=>{const s=A(),{createSaaSAccount:a,isCreatingSaaSAccount:o}=U(),e=g({initialValues:V,validationSchema:N,onSubmit:async c=>{try{await a({title:c.title})}catch(d){s(d)}}});return t.jsxs(w,{title:"Create a new Landscape SaaS account",children:[t.jsx(i.Notification,{severity:"caution",children:"There is no Landscape organization related to your account."}),t.jsxs(i.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[t.jsx(i.Input,{type:"text",label:"Organization name",required:!0,help:"This will be the name of the Landscape account for your organization.",...e.getFieldProps("title"),error:m(e,"title")}),t.jsx(i.ActionButton,{className:h("u-no-margin--bottom",R.button),appearance:"positive",type:"submit",loading:o,disabled:o,children:"Create account"})]})]})},z="_button_1t6xj_1",$={button:z},M=()=>{const s=A(),a=b(),{createStandaloneAccount:o,isCreatingStandaloneAccount:n}=H(),{setUser:e}=y(),{signInWithEmailAndPasswordQuery:c}=E(),{mutateAsync:d}=c,r=g({initialValues:T,validationSchema:v,onSubmit:async u=>{try{await o({name:u.fullName,email:u.email,password:u.password});const{data:l}=await d({email:u.email,password:u.password});"current_account"in l?(e(l),a(x,{replace:!0})):a(f.auth.login(),{replace:!0})}catch(l){s(l)}}});return t.jsx(w,{title:"Create a new Landscape account",children:t.jsxs(i.Form,{onSubmit:r.handleSubmit,noValidate:!0,children:[t.jsx(i.Input,{type:"text",label:"Full name",required:!0,autoComplete:"name",...r.getFieldProps("fullName"),error:m(r,"fullName")}),t.jsx(i.Input,{type:"email",label:"Email address",required:!0,autoComplete:"email",...r.getFieldProps("email"),error:m(r,"email")}),t.jsx(i.PasswordToggle,{id:"password",label:"Password",required:!0,autoComplete:"new-password",...r.getFieldProps("password")}),t.jsx(q,{password:r.values.password,touched:!!r.touched.password,hasError:!!r.errors.password}),t.jsx(i.ActionButton,{className:h($.button,"u-no-margin--bottom"),appearance:"positive",type:"submit",loading:n,disabled:n||!r.isValid||!r.dirty,children:"Create account"})]})})},J=()=>{const{authorized:s,authLoading:a,hasAccounts:o}=y(),{isSelfHosted:n,envLoading:e}=F(),c=b();return L.useEffect(()=>{if(!(a||e)){if(!n&&!s){c(f.auth.login(),{replace:!0});return}o&&c(x,{replace:!0})}},[s,a,e,o,n,c]),a||e?t.jsx(P,{}):!n&&!s?t.jsx(_,{}):n?t.jsx(M,{}):t.jsx(k,{})};export{J as default};
