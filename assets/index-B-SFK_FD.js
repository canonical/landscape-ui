import{J as y,c as l,a as j,y as b,z as U,j as s,n as I,m as g,ah as P,r as S,o as $,E as v}from"./index-2fzpjuii.js";import{u as p}from"./usePackages-Dz1pfWlQ.js";import{H as L}from"./HeaderWithSearch-BIg5d4wD.js";import{U as k}from"./UsnList-Bn5Mjoeg.js";import"./SelectAllButton-Tn0tIpY_.js";import"./ExpandableTableFooter-DCvzJtCE.js";import"./TruncatedCell-CgdNfcLB.js";import"./helpers-BonKpxw0.js";const N="_actions_1l3g0_1",_={actions:N},w=({usns:t})=>{const{instanceId:c,childInstanceId:a}=y(),{setPageParams:n}=l(),o=j(),e=b(),{notify:i}=U(),{upgradeInstanceUsnsQuery:r}=p(),d=Number(c),{mutateAsync:m,isPending:u}=r,h=()=>{o(`/instances/${a?`${d}/${a}`:`${d}`}`),n({tab:"activities"}),i.clear()},f=async()=>{try{await m({instanceId:d,usns:t}),i.success({title:"You queued packages to be upgraded",message:`Affected packages for ${t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:h}]})}catch(x){e(x)}};return s.jsxs(s.Fragment,{children:[s.jsx(L,{actions:s.jsx("div",{className:I("p-segmented-control",_.actions),children:s.jsxs(g.ConfirmationButton,{className:"p-segmented-control__button has-icon u-no-margin--bottom",type:"button",disabled:t.length===0,confirmationModalProps:{title:"Upgrade affected packages",children:s.jsxs("p",{children:["This will upgrade affected packages for"," ",t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`,"."]}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:u,confirmButtonDisabled:u,onConfirm:f},children:[s.jsx(g.Icon,{name:"change-version"}),s.jsx("span",{children:"Upgrade"})]})})}),s.jsx(P,{filtersToDisplay:["search"]})]})},C=({instance:t,isUsnsLoading:c,totalUsnCount:a,usns:n})=>{const[o,e]=S.useState([]),{search:i}=l();return s.jsxs(s.Fragment,{children:[s.jsx(w,{usns:o}),s.jsx(k,{tableType:"paginated",instances:[t],isUsnsLoading:c,onSelectedUsnsChange:r=>e(r),search:i,selectedUsns:o,totalUsnCount:a,usns:n})]})},z=({instance:t})=>{const{search:c,currentPage:a,pageSize:n}=l(),{getUsnsQuery:o}=p(),{data:e,isLoading:i}=o({computer_ids:[t.id],limit:n,offset:(a-1)*n,search:c,show_packages:!1});return s.jsxs(s.Fragment,{children:[!c&&a===1&&n===20&&i&&s.jsx($,{}),!c&&a===1&&n===20&&!i&&(!e||e.data.results.length===0)&&s.jsx(v,{icon:"inspector-debug",title:"No security issues found"}),(c||a>1||n!==20||!i&&e&&e.data.results.length>0)&&s.jsx(C,{instance:t,isUsnsLoading:i,totalUsnCount:(e==null?void 0:e.data.count)??0,usns:(e==null?void 0:e.data.results)??[]})]})};export{z as default};
