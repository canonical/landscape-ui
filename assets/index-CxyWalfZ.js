const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cqu8bmrR.js","assets/index-BYYwtqOb.js","assets/index-Da3lfBeW.css","assets/InfoItem-Cti4fCWB.js","assets/InfoItem-C-lWh_lY.css","assets/index-C68HcqAE.js","assets/moment-BRVkbQ11.js","assets/TablePagination-DWPTC5u3.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-B645fm9D.js","assets/SearchHelpPopup-CQnR1lC2.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/useFetchOld-BTtqmpM9.js","assets/NoData-CGwk0mn8.js","assets/index-BmoMXq9B.css","assets/moment-C5S46NFB.js","assets/constants-ZwWrqa0z.js","assets/index-_aFDOmw8.css","assets/index-8iey6hc5.js","assets/constants-Dwl1JGyb.js","assets/index-W_BOD1xP.css","assets/index-CMGa8WYh.js","assets/useInstances-WVnlBmJQ.js"])))=>i.map(i=>d[i]);
import{B as P,j as e,h as i,g as C,r as d,_ as j,i as F,s as b,E as L,d as T,c as B,e as w,f as D,v as q}from"./index-BYYwtqOb.js";import{T as V}from"./TablePagination-DWPTC5u3.js";import{I as $}from"./InfoItem-Cti4fCWB.js";import{h}from"./moment-C5S46NFB.js";import{N as y}from"./NoData-CGwk0mn8.js";import{u as A}from"./usePageParams-B645fm9D.js";const Q=(t,n)=>{switch(t){case"Fully patched":return"All available kernel security patches have been applied. You have no pending patches";case"Kernel upgrade available":return`A new kernel version is available. The current version is covered by Livepatch until ${h(n).format(P)}`;case"Restart required":return"Low and/or medium patches have been installed. You must restart to complete patching.";case"End of life":return"The kernel is no longer covered by Livepatch. It is not getting high and critical security patches.";case"Livepatch disabled":return"Livepatch is disabled. Kernel patches will not be applied automatically until you enabled Livepatch.";default:return"There was an error getting the status"}},M=t=>{switch(t){case"Patched by Livepatch":case"Fully patched":case"Kernel upgrade available":return"status-succeeded-small";case"Restart required":return"status-waiting-small";case"End of life":return"status-failed-small";default:return"status-failed-small"}},k=(t,n)=>{const a=h(n),r=h(),l=a.diff(r,"days");return l<0||!t?"status-failed-small":l<7?"status-waiting-small":"status-succeeded-small"},R=(t,n)=>{if(!t)return"Livepatch is disabled";const a=h(n),r=h();return a.diff(r,"days")<0?"Expired":`Expires on ${h(n).format(P)}`},U="_statusIcon_s1xwo_1",z="_tooltipIcon_s1xwo_5",H="_container_s1xwo_9",x={statusIcon:U,tooltipIcon:z,container:H},S=({kernelOverview:t})=>{const n=t.status!=="Livepatch disabled",a=[{label:"current kernel version",value:t.currentVersion||e.jsx(y,{})},{label:"status",value:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:n?t.status||e.jsx(y,{}):"Not covered by Livepatch"}),e.jsxs(i.Tooltip,{message:Q(t.status,t.expirationDate),className:x.tooltipIcon,children:[e.jsx(i.Icon,{name:"help","aria-hidden":!0}),e.jsx("span",{className:"u-off-screen",children:"Help"})]})]})},{label:"livepatch coverage",value:R(n,t.expirationDate)}];return e.jsx(i.Row,{className:C("u-no-padding--left u-no-padding--right u-no-max-width",x.container),children:a.map(({label:r,value:l})=>e.jsxs(i.Col,{size:3,children:[r==="status"&&e.jsx(i.Icon,{name:M(t.status),"aria-hidden":!0,className:x.statusIcon}),r==="livepatch coverage"&&e.jsx(i.Icon,{name:k(n,t.expirationDate),"aria-hidden":!0,className:x.statusIcon}),e.jsx($,{label:r,value:l})]},r))})},Y="_container_12dfg_1",O={container:Y},G=d.lazy(()=>j(()=>import("./index-Cqu8bmrR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))),J=d.lazy(()=>j(()=>import("./index-8iey6hc5.js"),__vite__mapDeps([19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,20,17,21]))),W=d.lazy(()=>j(()=>import("./index-CMGa8WYh.js"),__vite__mapDeps([22,1,2,5,6,7,8,9,10,11,12,13,14,15,23,16,20,3,4,21]))),X=({instanceName:t,hasTableData:n,kernelStatuses:a})=>{var g;const{setSidePanelContent:r}=F(),l=((g=a==null?void 0:a.installed)==null?void 0:g.version_rounded)??"",u=(a==null?void 0:a.downgrades)??[],s=(a==null?void 0:a.upgrades)??[],o=()=>{r("Downgrade kernel",e.jsx(d.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(G,{instanceName:t,currentKernelVersion:l,downgradeKernelVersions:u})}))},c=()=>{r("Upgrade kernel",e.jsx(d.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(J,{instanceName:t,currentKernelVersion:l,upgradeKernelVersions:s})}))},m=()=>{var p;r(`Restart ${t}`,e.jsx(d.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(W,{instanceName:t,showNotification:n,newKernelVersionId:(p=s[0])==null?void 0:p.id})}))};return e.jsxs("div",{className:O.container,children:[e.jsx("h5",{className:"u-no-padding u-no-margin",children:"Patches discovered since last restart"}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(i.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:m,children:[e.jsx(i.Icon,{name:"restart"}),e.jsx("span",{children:"Restart instance"})]}),e.jsxs(i.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:u.length===0,onClick:o,children:[e.jsx(i.Icon,{name:"begin-downloading"}),e.jsx("span",{children:"Downgrade kernel"})]}),e.jsxs(i.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:s.length===0,onClick:c,children:[e.jsx(i.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade kernel"})]})]})},"buttons")]})},Z=t=>`https://cve.mitre.org/cgi-bin/cvename.cgi?name=${t}`,ee=t=>{const n={};switch(t.column.id){case"Name":n.role="rowheader";break;case"Patched":n["aria-label"]="Status";break;case"Description":n["aria-label"]="Description";break;case"Bug":n["aria-label"]="Bug";break}return n},te="_description_1s9gq_1",ae={description:te},se=`There are no pending kernel security patches to apply at this time.
                Livepatch applies critical and high security patches in the background without requiring a system restart.
                Patches found since last restart and their status will be shown here.`,ne=({kernelData:t})=>{const n=d.useMemo(()=>[{Header:e.jsx("span",{children:"CVE"}),accessor:"Name",Cell:({row:a})=>e.jsx(i.Link,{href:Z(a.original.Name),target:"_blank",rel:"nofollow noopener noreferrer",className:"u-no-margin--bottom u-no-padding--top",children:a.original.Name})},{Header:"Status",accessor:"Patched",Cell:({row:{original:a}})=>a.Patched?"Patched by Livepatch":"Unpatched",getCellIcon:({row:{original:a}})=>a.Patched?"status-succeeded-small":"status-failed-small",disableSortBy:!0},{Header:"Description",accessor:"Description",className:ae.description,Cell:({row:a})=>a.original.Description||e.jsx(y,{}),disableSortBy:!0},{Header:"Bug",accessor:"Bug",Cell:({row:a})=>a.original.Bug||e.jsx(y,{}),disableSortBy:!0}],[]);return e.jsxs(e.Fragment,{children:[e.jsx(i.ModularTable,{columns:n,data:t,getCellProps:ee,sortable:!0,initialSortColumn:"Name",initialSortDirection:"ascending"}),t.length===0&&e.jsx(L,{title:"No outstanding kernel patches",body:se})]})};function re(){const t=T(),n=B(),a=({id:s},o={})=>D({queryKey:["kernel",s],queryFn:()=>t.get(`computers/${s}/livepatch/kernel`),...o}),r=({id:s,...o},c={})=>D({queryKey:["kernel",{id:s,...o}],queryFn:()=>t.get(`computers/${s}/livepatch/info`,{params:o}),...c}),l=w({mutationKey:["kernel","downgrade"],mutationFn:({id:s,...o})=>t.post(`computers/${s}/kernel/downgrade`,o),onSuccess:()=>n.invalidateQueries({queryKey:["kernel"]})}),u=w({mutationKey:["kernel","upgrade"],mutationFn:({id:s,...o})=>t.post(`computers/${s}/kernel/upgrade`,o),onSuccess:()=>n.invalidateQueries({queryKey:["kernel"]})});return{getKernelQuery:a,getLivepatchInfoQuery:r,downgradeKernelQuery:l,upgradeKernelQuery:u}}const oe=({instanceTitle:t})=>{var _,v,f,I;const{instanceId:n}=q(),{pageSize:a,currentPage:r}=A(),{getKernelQuery:l,getLivepatchInfoQuery:u}=re(),{data:s,isPending:o}=l({id:parseInt(n??"")}),{data:c}=u({id:parseInt(n??"")}),m=((_=c==null?void 0:c.data.livepatch_info)==null?void 0:_.json.output.Status[0].Livepatch.Fixes)??[],g=(E,K)=>m.slice(K,K+E),p=d.useMemo(()=>g(a,(r-1)*a),[m,r,a]),N={currentVersion:((v=c==null?void 0:c.data.livepatch_info)==null?void 0:v.json.output.Status[0].Kernel)??((f=s==null?void 0:s.data.installed)==null?void 0:f.version_rounded)??"",expirationDate:((I=c==null?void 0:c.data.livepatch_info)==null?void 0:I.json.output.Status[0].UpgradeRequiredDate)??"",status:(s==null?void 0:s.data.smart_status)??""};return e.jsxs(e.Fragment,{children:[o&&e.jsx(b,{}),!o&&!(s!=null&&s.data.installed)&&e.jsx(L,{title:"Kernel Information Unavailable",body:(s==null?void 0:s.data.message)||"No kernel information available"}),!o&&(s==null?void 0:s.data.installed)&&e.jsxs(e.Fragment,{children:[e.jsx(S,{kernelOverview:N}),e.jsx(X,{instanceName:t,hasTableData:p.length>0,kernelStatuses:s.data}),e.jsx(ne,{kernelData:p}),e.jsx(V,{totalItems:m.length,currentItemCount:p.length})]})]})},he=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"}));export{he as i,re as u};
