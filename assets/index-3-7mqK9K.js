import{y as k,z as B,l as F,r as u,j as t,m as c,o as $}from"./index-CGM03hee.js";import{S as D}from"./SidePanelFormButtons-QRtzN-Cq.js";import{u as E}from"./useInstances-BIfg_-pg.js";import{u as N,T as O}from"./useTaggedSecurityProfiles-CnXVEuvo.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./helpers-CzrmJ8wk.js";import"./useGetSecurityProfiles-CTDbHQ2C.js";const G=({selected:e})=>{const x=k(),{notify:p}=B(),{closeSidePanel:T}=F(),{addTagsToInstancesQuery:b,getAllInstanceTagsQuery:j}=E(),{mutateAsync:C,isPending:g}=b,{data:d,isLoading:S}=j(),[v,m]=u.useState(!1),[r,w]=u.useState(""),[n,l]=u.useState([]),{securityProfiles:f,isSecurityProfilesLoading:L}=N(n,e),h=async()=>{try{await C({query:e.map(({id:s})=>`id:${s}`).join(" OR "),tags:n}),T(),p.success({title:"Tags assigned",message:`Tags successfully assigned to ${e.length>1?`${e.length} instances`:`"${e[0].title}" instance`}`})}catch(s){x(s)}},A=async()=>{f.length?m(!0):await h()},o=(d==null?void 0:d.data.results.filter(s=>s.toLowerCase().includes(r.toLowerCase())))??[],I=()=>{o.every(s=>n.includes(s))?l([]):l(o)},M=u.useMemo(()=>[{accessor:"value",Header:t.jsxs(t.Fragment,{children:[t.jsx(c.CheckboxInput,{inline:!0,label:null,disabled:o.every(s=>e.every(i=>i.tags.includes(s))),checked:o.every(s=>n.includes(s)||e.every(i=>i.tags.includes(s))),indeterminate:o.some(s=>e.some(i=>!i.tags.includes(s)))&&o.some(s=>e.some(i=>i.tags.includes(s))),onChange:I}),"Name"]}),Cell:({row:{original:{value:s}}})=>{const i=()=>{if(n.includes(s)){l(n.toSpliced(n.findIndex(a=>a==s),1));return}e.every(a=>a.tags.includes(s))||l([...n,s])};return t.jsxs(t.Fragment,{children:[t.jsx(c.CheckboxInput,{inline:!0,label:null,disabled:e.every(a=>a.tags.includes(s)),checked:n.includes(s)||e.every(a=>a.tags.includes(s)),indeterminate:!n.includes(s)&&e.some(a=>a.tags.includes(s))&&e.some(a=>!a.tags.includes(s)),onChange:i}),s]})}}],[n,o]);if(S)return t.jsx($,{});const y=o.map(s=>({value:s})),P=()=>{m(!1)};return t.jsxs(t.Fragment,{children:[t.jsx("p",{children:"Adding tags will associate the instance with the profiles that tag is linked to. This may change configurations on your instance."}),t.jsx(c.SearchBox,{value:r,onChange:s=>{w(s)}}),t.jsx(c.ModularTable,{emptyMsg:"No tags found",columns:M,data:[...y.filter(({value:s})=>s.toLowerCase().startsWith(r.toLowerCase())),...y.filter(({value:s})=>!s.toLowerCase().startsWith(r.toLowerCase()))]}),t.jsx(D,{onSubmit:A,submitButtonDisabled:!n.length||g||L,submitButtonText:"Assign"}),v&&t.jsx(O,{instances:e,securityProfiles:f,tags:n,onConfirm:h,confirmButtonDisabled:g,close:P})]})};export{G as default};
