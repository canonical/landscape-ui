const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BXiymkH3.js","assets/index-DM-5oHlz.js","assets/index-BwHlIK4o.css","assets/usePageParams-CQNbyqOJ.js","assets/SidePanelFormButtons-DAFaAJmg.js","assets/SidePanelFormButtons.module-tJTvEwdD.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/index-DtV6ZKLC.js","assets/TablePagination-D_ICigW5.js","assets/TablePaginationBase-CNcqrm_X.js","assets/TablePaginationBase-CJl3HN1X.css","assets/StatusFilter-jUJsCAig.js","assets/TableFilter-BzmomHXW.js","assets/TableFilter-DXBG6q86.css","assets/TableFilterChips-B3H_GiL3.js","assets/TableFilterChips-CHqetGbX.css","assets/useFetchOld-BNSMcAIO.js","assets/NoData-DE1XHMtF.js","assets/index-CRv_aeRB.css","assets/index-Ba81IojM.css","assets/index-BiPPIw6_.js","assets/index-9nKOZEr5.js","assets/downshift.esm-CY2j12nQ.js","assets/index-QZipd6RP.css"])))=>i.map(i=>d[i]);
import{b as F,e as N,c as y,d as f,f as S,j as n,g as u,r as g,n as j,_ as I,a as U,o as T,L as w,m as Q}from"./index-DM-5oHlz.js";import{u as L}from"./useFetchOld-BNSMcAIO.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c4550c7b-4d14-4c4d-84b1-6d871122dd4d",e._sentryDebugIdIdentifier="sentry-dbid-c4550c7b-4d14-4c4d-84b1-6d871122dd4d")}catch{}function oe(){const e=F(),t=N(),a=(i,p={})=>f({queryKey:["usns",i],queryFn:()=>t.get("usns",{params:i}),...p}),c=({usn:i,...p},x={})=>f({queryKey:["usnPackages",{usn:i,...p}],queryFn:()=>t.get(`usns/${i}`,{params:p}),...x}),l=y({mutationFn:({instanceId:i,...p})=>t.post(`/computers/${i}/usns/upgrade-packages`,p),onSuccess:()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])}),s=y({mutationFn:({instanceId:i,...p})=>t.post(`/computers/${i}/usns/remove-packages`,p),onSuccess:()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])}),b=y({mutationFn:i=>t.post("/computers/usns/upgrade-packages",i),onSuccess:()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])});return{getUsnsQuery:a,getAffectedPackagesQuery:c,upgradeInstanceUsnsQuery:l,removeUsnPackagesQuery:s,upgradeUsnsQuery:b}}const d={downgrade:{appearance:"positive",icon:"begin-downloading",label:"Downgrade",order:4},hold:{appearance:"positive",icon:"pause",label:"Hold",order:2},remove:{appearance:"negative",icon:"delete",label:"Uninstall",order:1},unhold:{appearance:"positive",icon:"play",label:"Unhold",order:3},upgrade:{appearance:"positive",icon:"change-version",label:"Upgrade",order:5}},A="_toggleButton_1ep2i_1",B={toggleButton:A},O=g.lazy(()=>I(()=>import("./index-BXiymkH3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]))),H=({pkg:e})=>{const{setSidePanelContent:t}=S(),a={remove:!0,hold:e.status!=="held",unhold:e.status==="held",upgrade:!!e.available_version&&e.available_version!==e.current_version,downgrade:e.status!=="held"},c=s=>{t(`${d[s].label} ${e.name}`,n.jsx(g.Suspense,{fallback:n.jsx(j,{}),children:n.jsx(O,{action:s,packages:[e]})}))},l=Object.keys(d).map(s=>s).filter(s=>a[s]).sort((s,b)=>d[b].order-d[s].order).map(s=>({children:n.jsxs(n.Fragment,{children:[n.jsx(u.Icon,{name:d[s].icon}),n.jsx("span",{children:d[s].label})]}),"aria-label":`${d[s].label} ${e.name} package`,hasIcon:!0,onClick:()=>c(s)}));return n.jsx(u.ContextualMenu,{position:"left",toggleClassName:B.toggleButton,toggleAppearance:"base",toggleLabel:n.jsx(u.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${e.name} package actions`},links:l})},R=({onDismiss:e})=>{const t=U(),{instanceId:a,childInstanceId:c}=T();return n.jsxs(u.Notification,{severity:"caution",onDismiss:e,children:[n.jsx("strong",{children:"Some upgrades require Ubuntu Pro: "}),n.jsxs("span",{children:["Your current Ubuntu package upgrades are limited. To unlock full upgrades, please upgrade to Ubuntu Pro."," "]}),n.jsx(u.Button,{type:"button",appearance:"link",onClick:()=>{t(`/instances/${c?`${a}/${c}`:a}`,{state:{tab:"ubuntu-pro"}})},children:"Learn more"})]})},V={available_version:null,current_version:null,id:-1,name:"loading",status:"available",summary:""},M="_checkbox_1xyx4_1",W="_details_1xyx4_5",z="_tooltipLink_1xyx4_9",G="_hidden_1xyx4_13",Y="_actions_1xyx4_17",_={checkbox:M,details:W,tooltipLink:z,hidden:G,actions:Y},C=e=>!!e.available_version&&!!e.current_version&&e.available_version.includes("ubuntu-pro"),q=e=>{const t={label:"Unknown",icon:""};return e.status==="available"?(t.label="Available",t.icon="status-queued-small"):e.status==="held"?(t.label="Held",t.icon="status-in-progress-small"):e.status==="security"?(t.label="Security upgrade",t.icon="status-failed-small"):e.status==="installed"&&(e.available_version!==e.current_version?(t.label="Regular upgrade",t.icon="status-waiting-small"):(t.label="Installed",t.icon="status-succeeded-small")),t},J=({column:e,row:t})=>{const a={};return t.original.name==="loading"?e.id==="name"?a.colSpan=5:(a.className=_.hidden,a["aria-hidden"]=!0):e.id==="checkbox"?a["aria-label"]=`Toggle ${t.original.name} package`:e.id==="name"?a.role="rowheader":e.id==="status"?a["aria-label"]="Status":e.id==="current_version"?a["aria-label"]="Current version":e.id==="available_version"?a["aria-label"]="Available version":e.id==="summary"&&(a["aria-label"]="Details"),a},X=g.lazy(()=>I(()=>import("./index-BiPPIw6_.js"),__vite__mapDeps([20,1,2,16]))),re=({emptyMsg:e,onPackagesSelect:t,packages:a,packagesLoading:c,selectedPackages:l,selectAll:s})=>{const[b,i]=g.useState(!1),[p,x]=g.useState(!1),{instanceId:r,childInstanceId:m}=T(),{setSidePanelContent:v}=S(),D=g.useMemo(()=>c?[V]:a,[a,c]),P=o=>{t(l.some(({name:h})=>h===o.name)?l.filter(({name:h})=>h!==o.name):[...l,o])},$=()=>{t(l.length>0?[]:a.filter(o=>!C(o)))};g.useEffect(()=>{!s||b||!a.length||($(),i(!0))},[s,a]);const E=o=>{v("Package details",n.jsx(g.Suspense,{fallback:n.jsx(j,{}),children:n.jsx(X,{singlePackage:o})}))},K=g.useMemo(()=>[{accessor:"checkbox",className:_.checkbox,Header:n.jsx(u.CheckboxInput,{inline:!0,label:n.jsx("span",{className:"u-off-screen",children:"Toggle all"}),checked:l.length===a.length&&a.length>0,indeterminate:l.length<a.length&&l.length>0,disabled:a.length===0,onChange:$}),Cell:({row:o})=>C(o.original)?n.jsx(u.Tooltip,{message:n.jsxs("div",{children:[n.jsx("p",{className:"u-no-padding--top",children:"Ubuntu Pro is required"}),n.jsx(w,{to:`/instances/${m?`${r}/${m}`:`${r}`}`,state:{tab:"ubuntu-pro"},className:_.tooltipLink,children:"learn more"})]}),children:n.jsx(u.CheckboxInput,{inline:!0,disabled:!0,label:n.jsx("span",{className:"u-off-screen",children:`Toggle ${o.original.name}`}),checked:l.some(({name:h})=>h===o.original.name),onChange:()=>{P(o.original)}})}):n.jsx(u.CheckboxInput,{inline:!0,label:n.jsx("span",{className:"u-off-screen",children:`Toggle ${o.original.name}`}),checked:l.some(({name:h})=>h===o.original.name),onChange:()=>{P(o.original)}})},{accessor:"name",Header:"Name",Cell:({row:o})=>o.original.name==="loading"?n.jsx(j,{}):n.jsx(u.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{E(o.original)},children:o.original.name})},{accessor:"status",Header:"Status",Cell:({row:{original:o}})=>q(o).label,getCellIcon:({row:{original:o}})=>q(o).icon},{accessor:"current_version",Header:"Current version"},{accessor:"summary",className:_.details,Header:"Details",Cell:({row:{original:o}})=>o.available_version?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:o.summary}),n.jsx("br",{}),n.jsx("span",{children:`available version: ${o.available_version}`})]}):o.summary},{accessor:"actions",className:_.actions,Header:"Actions",Cell:({row:{original:o}})=>n.jsx(H,{pkg:o})}],[a,l.length]);return n.jsxs(n.Fragment,{children:[!p&&a.some(C)&&n.jsx(R,{onDismiss:()=>x(!0)}),n.jsx(u.ModularTable,{columns:K,data:D,getCellProps:J,emptyMsg:e})]})},Z="_container_1nwlw_1",ee="_noWrap_1nwlw_5",k={container:Z,noWrap:ee},ne=g.lazy(()=>I(()=>import("./index-BXiymkH3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]))),se=g.lazy(()=>I(()=>import("./index-9nKOZEr5.js"),__vite__mapDeps([21,1,2,4,5,6,7,3,8,9,10,11,12,13,14,15,16,17,18,22,23]))),le=({selectedPackages:e})=>{const{setSidePanelContent:t}=S(),a=s=>{const b=e.length===1?e[0].name:`${e.length} selected packages`;t(`${d[s].label} ${b}`,n.jsx(g.Suspense,{fallback:n.jsx(j,{}),children:n.jsx(ne,{action:s,packages:e})}))},c={remove:e.length===0||e.every(s=>!s.current_version),hold:e.length===0||e.every(s=>s.status==="held"),unhold:e.length===0||e.every(s=>s.status!=="held"),upgrade:e.length===0||e.every(s=>!s.available_version)},l=()=>{t("Install packages",n.jsx(g.Suspense,{fallback:n.jsx(j,{}),children:n.jsx(se,{})}))};return n.jsxs("div",{className:k.container,children:[n.jsxs(u.Button,{type:"button",onClick:l,hasIcon:!0,className:Q("u-no-margin--bottom",k.noWrap),children:[n.jsx("i",{className:"p-icon--plus"}),n.jsx("span",{children:"Install"})]}),n.jsx("div",{className:Q("p-segmented-control is-small",k.noWrap),children:Object.keys(d).filter(s=>s!=="downgrade").map(s=>s).sort((s,b)=>d[s].order-d[b].order).map(s=>n.jsxs(u.Button,{type:"button",className:"p-segmented-control__button has-icon u-no-margin--bottom",disabled:c[s],onClick:()=>a(s),children:[n.jsx(u.Icon,{name:d[s].icon}),n.jsx("span",{children:d[s].label})]},s))},"buttons")]})};function ie(){const e=F(),t=L(),a=N(),c=(r,m={})=>f({queryKey:["packages",r],queryFn:()=>a.get("packages",{params:r}),...m}),l=({instance_id:r,...m},v={})=>f({queryKey:["packages",{instance_id:r,...m}],queryFn:()=>a.get(`computers/${r}/packages`,{params:m}),...v}),s=y({mutationFn:r=>t.get("UpgradePackages",{params:r}),onSuccess:()=>e.invalidateQueries({queryKey:["packages"]})}),b=y({mutationFn:r=>a.post("/computers/upgrade-packages",r),onSuccess:()=>Promise.all([e.invalidateQueries({queryKey:["packages"]}),e.invalidateQueries({queryKey:["instances"]})])}),i=({instanceId:r,packageName:m},v={})=>f({queryKey:["packageDowngradeVersion",{instanceId:r,packageName:m}],queryFn:()=>a.get(`computers/${r}/packages/installed/${m}/downgrades`),...v}),p=y({mutationFn:({instanceId:r,...m})=>a.post(`computers/${r}/packages/installed`,m),onSuccess:()=>e.invalidateQueries({queryKey:["packages"]})}),x=y({mutationFn:r=>a.post("packages",r),onSuccess:()=>e.invalidateQueries({queryKey:["packages"]})});return{getPackagesQuery:c,getInstancePackagesQuery:l,upgradePackagesQuery:s,getDowngradePackageVersionsQuery:i,downgradePackageVersionQuery:p,packagesActionQuery:x,upgradeInstancesPackagesQuery:b}}export{d as I,le as P,ie as a,re as b,oe as u};
