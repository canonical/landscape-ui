const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BV11l4I8.js","assets/index-DY0yKsFY.js","assets/index-BPqj2aAr.css","assets/formik.esm-CtTAjn9c.js","assets/SidePanelFormButtons-BMN115EL.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/AssociationBlock-DtrFLlE1.js","assets/MultiSelectField-DcwazbYY.js","assets/MultiSelectField-B2rqRhX9.css","assets/useInstances-cT_HEEfr.js","assets/useFetchOld-CZMB78f6.js","assets/useMutation-cdyoRliz.js","assets/PageMain-CBWka__a.js","assets/PageMain-DyI__TtH.css","assets/AssociationBlock-Cb2Mr2ww.css","assets/useAPTSources-CSjd-R77.js","assets/useDistributions-DOwxETlT.js","assets/useRoles-A1iSOABi.js","assets/index.esm-BFRrLlkL.js","assets/tests-DFnZqbNV.js","assets/index-Cbgi0rQx.css"])))=>i.map(i=>d[i]);
import{c as F,d as Q,e as _,r as m,_ as j,f as R,h as y,j as e,g as r,k as P}from"./index-DY0yKsFY.js";import{E as k}from"./EmptyState-Cp7kPxIV.js";import{u as M,P as $,a as D,b as I}from"./PageMain-CBWka__a.js";import{u as w}from"./useFetchOld-CZMB78f6.js";import{u as h}from"./useMutation-cdyoRliz.js";import"./index.esm-BFRrLlkL.js";import{u as L}from"./useConfirm-BmebmGkS.js";import{u as N}from"./useRoles-A1iSOABi.js";function v(){const o=F(),s=Q(),n=w(),l=_(),c=(a={},p={})=>M({queryKey:["repositoryProfiles",a],queryFn:()=>s.get("repositoryprofiles",{params:a}),...p}),u=h({mutationFn:a=>s.post("repositoryprofiles",a),onSuccess:()=>o.invalidateQueries(["repositoryProfiles"])}),f=h({mutationFn:({name:a,...p})=>s.put(`repositoryprofiles/${a}`,p),onSuccess:()=>o.invalidateQueries(["repositoryProfiles"])}),g=h({mutationKey:["repositoryProfiles"],mutationFn:a=>n.get("RemoveRepositoryProfile",{params:a}),onSuccess:()=>{o.invalidateQueries(["repositoryProfiles"]).catch(l)}});return{getRepositoryProfilesQuery:c,createRepositoryProfileQuery:u,editRepositoryProfileQuery:f,removeRepositoryProfileQuery:g}}const O=({column:o})=>{const s={};return o.id==="title"?s.role="rowheader":o.id==="description"?s["aria-label"]="Description":o.id==="access_group"?s["aria-label"]="Access group":o.id==="id"&&(s["aria-label"]="Actions"),s},H="_accessGroup_16hmw_1",T="_description_16hmw_5",G="_actions_16hmw_9",z="_toggleButton_16hmw_13",q="_actionButton_16hmw_18",d={accessGroup:H,description:T,actions:G,toggleButton:z,actionButton:q},K=m.lazy(()=>j(()=>import("./index-BV11l4I8.js").then(o=>o.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]))),V=({repositoryProfiles:o})=>{const s=_(),{confirmModal:n,closeConfirmModal:l}=L(),{setSidePanelContent:c}=R(),{removeRepositoryProfileQuery:u}=v(),{mutateAsync:f,isLoading:g}=u,{getAccessGroupQuery:a}=N(),{data:p}=a(),b=((p==null?void 0:p.data)??[]).map(({name:t,title:i})=>({label:i,value:t})),C=(t,i)=>{t.currentTarget.blur(),c(`Edit ${i.title}`,e.jsx(m.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(K,{action:"edit",profile:i})}))},A=async t=>{try{await f({name:t})}catch(i){s(i)}finally{l()}},B=t=>{n({body:"Are you sure?",title:`Deleting ${t} repository profile`,buttons:[e.jsxs(r.Button,{appearance:"negative",hasIcon:!0,onClick:()=>A(t),"aria-label":`Delete ${t} repository profile`,children:[g&&e.jsx(r.Spinner,{}),"Delete"]},`delete-profile-${t}`)]})},x=m.useMemo(()=>o,[o]),S=m.useMemo(()=>[{accessor:"title",Header:"Title"},{accessor:"description",Header:"Description",className:d.description},{accessor:"access_group",Header:"Access group",className:d.accessGroup,Cell:({row:{original:t}})=>{var i;return((i=b.find(({value:E})=>t.access_group===E))==null?void 0:i.label)??t.access_group}},{accessor:"id",className:y("u-align-text--right",d.actions),Header:"Actions",Cell:({row:t})=>e.jsxs(r.ContextualMenu,{position:"left",toggleClassName:d.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(r.Icon,{name:"contextual-menu","aria-hidden":!0}),toggleProps:{"aria-label":`${t.original.name} profile actions`},children:[e.jsxs(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:y("u-no-margin--bottom u-no-margin--right",d.actionButton),onClick:i=>C(i,t.original),"aria-label":`Edit ${t.original.name} profile`,children:[e.jsx(r.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:y("u-no-margin--bottom u-no-margin--right",d.actionButton),onClick:()=>B(t.original.name),"aria-label":`Remove ${t.original.name} repository profile`,children:[e.jsx(r.Icon,{name:r.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]})}],[x,b]);return e.jsx(r.ModularTable,{columns:S,data:x,getCellProps:O,emptyMsg:"No profiles yet."})},Y=m.lazy(()=>j(()=>import("./index-BV11l4I8.js").then(o=>o.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])).then(o=>({default:o.RepositoryProfileForm}))),J=()=>{const{setSidePanelContent:o}=R(),{getRepositoryProfilesQuery:s}=v(),{data:n,isLoading:l}=s(),c=(n==null?void 0:n.data.results)??[],u=()=>{o("Add repository profile",e.jsx(m.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Y,{action:"add"})}))};return e.jsxs($,{children:[e.jsx(D,{title:"Repository profiles",actions:[e.jsx(r.Button,{appearance:"positive",onClick:u,type:"button",children:"Add repository profile"},"new-key-button")]}),e.jsxs(I,{children:[l&&e.jsx(P,{}),!l&&c.length===0&&e.jsx(k,{title:"No profiles found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You havenâ€™t added any profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage profiles in Landscape"})]}),cta:[e.jsx(r.Button,{appearance:"positive",onClick:u,type:"button",children:"Add repository profile"},"table-add-new-profile")]}),!l&&c.length>0&&e.jsx(V,{repositoryProfiles:c})]})]})},U=J,ie=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));export{V as R,ie as i,v as u};
