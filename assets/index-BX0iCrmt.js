import{f as q,r as l,_ as P,c as $,l as E,d as b,j as e,e as s,g as F,x as h}from"./index-USfFY6y3.js";import{P as V,a as z,b as H}from"./PageMain-BxDaTx_L.js";import{u as G}from"./useFetchOld-B0QImQ4i.js";import{u as A}from"./useMutation-DY_6kw1u.js";import{u as K}from"./useQuery-BXclWMSX.js";import{u as U}from"./useConfirm-CBkoo4y2.js";import{u as B}from"./useRoles-NASJ59Wm.js";import{E as W}from"./EmptyState-C3F4hI0m.js";import{u as Y}from"./formik.esm-C4aerYG-.js";import{A as J}from"./AssociationBlock-j-Uu_2zy.js";import{S as X}from"./SidePanelFormButtons-eq1cIORy.js";import{c as Z,a as w,d as ee,f as te,b as oe}from"./index.esm-D9RDGm6v.js";function j(){const t=q(),a=G(),u=A({mutationFn:c=>a.get("CreateRemovalProfile",{params:c}),onSuccess:()=>t.invalidateQueries(["removalProfiles"])}),r=A({mutationFn:c=>a.get("EditRemovalProfile",{params:c}),onSuccess:()=>t.invalidateQueries(["removalProfiles"])}),m=A({mutationFn:c=>a.get("RemoveRemovalProfile",{params:c}),onSuccess:()=>t.invalidateQueries(["removalProfiles"])});return{createRemovalProfileQuery:u,editRemovalProfileQuery:r,removeRemovalProfileQuery:m,getRemovalProfilesQuery:(c={},d={})=>K({queryKey:["removalProfiles"],queryFn:()=>a.get("GetRemovalProfiles",{params:c}),...d})}}const ae="_truncated_1l9yd_1",se="_actions_1l9yd_7",ne="_toggleButton_1l9yd_12",re="_actionButton_1l9yd_17",v={truncated:ae,actions:se,toggleButton:ne,actionButton:re},le=l.lazy(()=>P(()=>import("./index-DAFbUGBI.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]))),ie=l.lazy(()=>P(()=>Promise.resolve().then(()=>Q),void 0)),N=({profiles:t,search:a})=>{const u=$(),{notify:r}=E(),{setSidePanelContent:m}=b(),{closeConfirmModal:p,confirmModal:c}=U(),{removeRemovalProfileQuery:d}=j(),{getAccessGroupQuery:R}=B(),{data:_}=R(),x=(_==null?void 0:_.data.map(({name:o,title:g})=>({label:g,value:o})))??[],S=l.useMemo(()=>a?t.filter(o=>o.title.toLowerCase().includes(a.toLowerCase())):t,[t,a]),n=o=>{m(`Edit ${o.title} profile`,e.jsx(l.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(ie,{action:"edit",profile:o})}))},{mutateAsync:i}=d,f=async o=>{try{await i({name:o}),r.success({message:`${o} profile removed successfully`,title:"Removal profile removed"})}catch(g){u(g)}finally{p()}},C=o=>{c({title:"Remove removal profile",body:`This will remove "${o}" profile`,buttons:[e.jsx(s.Button,{type:"button",appearance:"negative",onClick:()=>f(o),"aria-label":`Remove "${o}" profile`,children:"Remove"},"remove")]})},k=o=>{m(o.title,e.jsx(l.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(le,{accessGroupOptions:x,profile:o})}))},D=l.useMemo(()=>[{accessor:"title",Header:"Name",Cell:({row:{original:o}})=>e.jsx(s.Button,{type:"button",appearance:"link",onClick:()=>k(o),className:"u-no-margin--bottom u-no-padding--top","aria-label":`Open "${o.title}" profile details`,children:o.title})},{accessor:"access_group",Header:"Access group",Cell:({row:{original:o}})=>{var g;return e.jsx(e.Fragment,{children:((g=x.find(M=>M.value===o.access_group))==null?void 0:g.label)??o.access_group})}},{accessor:"tags",className:v.truncated,Header:"Tags",Cell:({row:{original:o}})=>e.jsx(e.Fragment,{children:o.tags.join(", ")})},{accessor:"associated",Header:"Associated"},{accessor:"actions",className:v.actions,Header:"Actions",Cell:({row:{original:o}})=>e.jsxs(s.ContextualMenu,{position:"left",toggleClassName:v.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(s.Icon,{name:"contextual-menu"}),children:[e.jsxs(s.Button,{type:"button",appearance:"base",hasIcon:!0,className:F("u-no-margin--bottom u-no-margin--right",v.actionButton),onClick:()=>n(o),"aria-label":`Edit "${o.title}" profile`,children:[e.jsx(s.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(s.Button,{type:"button",appearance:"base",hasIcon:!0,className:F("u-no-margin--bottom u-no-margin--right",v.actionButton),onClick:()=>C(o.name),"aria-label":`Remove "${o.title}" profile`,children:[e.jsx(s.Icon,{name:"delete"}),e.jsx("span",{children:"Remove"})]})]})}],[S]);return e.jsx(s.ModularTable,{columns:D,data:S,emptyMsg:`No removal profiles found with the search: "${a}"`})},ce=l.lazy(()=>P(()=>Promise.resolve().then(()=>Q),void 0)),I=()=>{const{setSidePanelContent:t}=b(),a=()=>{t("Add removal profile",e.jsx(l.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(ce,{action:"add"})}))};return e.jsx(W,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You havenâ€™t added any removal profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage computers in Landscape"})]}),cta:[e.jsx(s.Button,{appearance:"positive",onClick:a,type:"button",children:"Add removal profile"},"table-add-new-mirror")],icon:"delete",title:"Removal profiles not found"})},O=({onSearch:t})=>{const[a,u]=l.useState("");return e.jsx(s.Form,{onSubmit:r=>{r.preventDefault(),t(a)},children:e.jsx(s.Row,{className:"u-no-margin--left u-no-margin--right u-no-padding--left u-no-padding--right",children:e.jsx(s.Col,{size:4,children:e.jsx(s.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autoComplete:"off",value:a,onChange:r=>u(r),onReset:()=>{u(""),t("")},onSearch:()=>t(a)})})})})},T={add:"Add",edit:"updated"},ue={add:"Add removal profile",edit:"Save changes"},me={access_group:"",all_computers:!1,days_without_exchange:"",tags:[],title:""},de=t=>Z().shape({access_group:w(),all_computers:ee(),days_without_exchange:te().test({name:"required",message:"This field is required.",params:{action:t},test:a=>!!a||!["add","add"].includes(t)}).integer("Timeframe must be an integer value.").min(1,"Timeframe must be at least 1.").max(2147483647,"Timeframe must be less than 2147483648."),tags:oe().of(w()),title:w().test({name:"required",message:"This field is required.",params:{action:t},test:a=>!!a||!["add","add"].includes(t)})}),fe="_inputContainer_v1jo9_1",pe="_input_v1jo9_1",ge="_inputDescription_v1jo9_10",y={inputContainer:fe,input:pe,inputDescription:ge},_e=t=>{const a=$(),{notify:u}=E(),{closeSidePanel:r}=b(),{createRemovalProfileQuery:m,editRemovalProfileQuery:p}=j(),{getAccessGroupQuery:c}=B(),{data:d}=c(),R=(d==null?void 0:d.data.map(({name:i,title:f})=>({label:f,value:i})))??[],{mutateAsync:_}=m,{mutateAsync:x}=p,n=Y({initialValues:me,onSubmit:async i=>{const f={title:i.title,days_without_exchange:i.days_without_exchange,access_group:i.access_group,all_computers:i.all_computers};!i.all_computers&&i.tags.length>0&&(f.tags=i.tags);try{t.action==="edit"?await x({...f,name:t.profile.name}):await _(f),r(),u.success({message:`Removal profile ${T[t.action]}`,title:`Removal profile ${i.title} has been ${T[t.action]}`})}catch(C){a(C)}},validationSchema:de(t.action)});return l.useEffect(()=>{t.action==="edit"&&n.setValues({access_group:t.profile.access_group,all_computers:t.profile.all_computers,days_without_exchange:t.profile.days_without_exchange,tags:t.profile.tags,title:t.profile.title})},[t]),e.jsxs(s.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:[e.jsx(s.Input,{type:"text",label:"Name",required:t.action==="add",...n.getFieldProps("title"),error:n.touched.title&&n.errors.title?n.errors.title:void 0}),e.jsxs("div",{className:y.inputContainer,children:[e.jsx(s.Input,{type:"number",inputMode:"numeric",label:"Removal timeframe",required:t.action==="add",autoComplete:"off",className:y.input,wrapperClassName:y.inputWrapper,...n.getFieldProps("days_without_exchange"),error:n.touched.days_without_exchange&&n.errors.days_without_exchange?n.errors.days_without_exchange:void 0}),e.jsx("span",{className:y.inputDescription,children:"days"})]}),e.jsx(s.Select,{label:"Access group",options:R,...n.getFieldProps("access_group"),error:n.touched.access_group&&n.errors.access_group?n.errors.access_group:void 0}),e.jsx(J,{formik:n}),e.jsx(X,{submitButtonDisabled:n.isSubmitting,submitButtonText:ue[t.action]})]})},L=_e,Q=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"})),ve=Object.freeze(Object.defineProperty({__proto__:null,RemovalProfileList:N,RemovalProfilesEmptyState:I,RemovalProfilesHeader:O,SingleRemovalProfileForm:L,useRemovalProfiles:j},Symbol.toStringTag,{value:"Module"})),he=()=>{const[t,a]=l.useState(""),{getRemovalProfilesQuery:u}=j(),{data:r,isLoading:m}=u();return e.jsxs(e.Fragment,{children:[m&&e.jsx(h,{}),!m&&(!r||r.data.length===0)&&e.jsx(I,{}),!m&&r&&r.data.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(O,{onSearch:p=>a(p)}),e.jsx(N,{profiles:r.data,search:t})]})]})},xe=l.lazy(()=>P(()=>Promise.resolve().then(()=>ve),void 0).then(t=>({default:t.SingleRemovalProfileForm}))),ye=()=>{const{setSidePanelContent:t}=b(),a=()=>{t("Add removal profile",e.jsx(l.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(xe,{action:"add"})}))};return e.jsxs(V,{children:[e.jsx(z,{title:"Removal profiles",actions:[e.jsx(s.Button,{type:"button",appearance:"positive",onClick:a,children:"Add removal profile"},"add")]}),e.jsx(H,{children:e.jsx(he,{})})]})},Pe=ye,Ne=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"}));export{Ne as a,Q as i,j as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-DAFbUGBI.js","assets/index-USfFY6y3.js","assets/index-57O3pXzM.css","assets/InfoItem-C4QiPsl7.js","assets/InfoItem-BbayMzTk.css","assets/useConfirm-CBkoo4y2.js","assets/PageMain-BxDaTx_L.js","assets/PageMain-DtiowUD8.css","assets/useFetchOld-B0QImQ4i.js","assets/useMutation-DY_6kw1u.js","assets/useQuery-BXclWMSX.js","assets/useRoles-NASJ59Wm.js","assets/EmptyState-C3F4hI0m.js","assets/EmptyState-BNXajmMK.css","assets/formik.esm-C4aerYG-.js","assets/AssociationBlock-j-Uu_2zy.js","assets/MultiSelectField-C31DR7gN.js","assets/MultiSelectField.module-D1r8qo_i.js","assets/MultiSelectField-B2rqRhX9.css","assets/useInstances-DuIRAs83.js","assets/AssociationBlock.module-BSYf3X0u.js","assets/AssociationBlock-Cb2Mr2ww.css","assets/SidePanelFormButtons-eq1cIORy.js","assets/SidePanelFormButtons.module-CoxOjuX8.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/index.esm-D9RDGm6v.js","assets/index-YvXtz6mj.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
