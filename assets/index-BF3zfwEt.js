import{r as f,b as U,z as E,j as t,h as o,k as A,y as N,a as y,l as T,m as k,n as P,R as $,t as q}from"./index-CPTwPS4O.js";import{A as F}from"./AuthTemplate-CPmZJlB1.js";import{r as I}from"./helpers-Bo73Thd0.js";import{S}from"./constants-LFXGfoad.js";const B="_list_9u1s7_1",R="_button_9u1s7_20",C="_icon_9u1s7_28",m={list:B,button:R,icon:C},D=({isStandaloneOidcEnabled:b,isUbuntuOneEnabled:p,oidcProviders:x,onInvitation:a})=>{const[i,c]=f.useState(0),[n]=U(),{getOidcUrlQuery:l,getUbuntuOneUrlQuery:h,getInvitationSummaryQuery:e}=E(),r=n.get("redirect-to"),s=n.get("invitation_id"),d=n.has("external"),{data:u}=e({invitationId:s??""},{enabled:!!s});f.useEffect(()=>{u&&a(u.data.account_title)},[u]);const v={};i>0&&(v.id=i),r&&(v.return_to=r),s&&(v.invitation_id=s),d&&(v.external=!0);const{data:j}=l(v,{enabled:i!==0});f.useEffect(()=>{j&&I(j.data.location)},[j]);const _={};r&&(_.return_to=`${window.origin}${r}`),s&&(_.invitation_id=s),d&&(_.external=!0);const{data:g,refetch:O}=h(_,{enabled:!1});return f.useEffect(()=>{g&&I(g.data.location)},[g]),t.jsxs("ul",{className:m.list,children:[p&&t.jsx("li",{className:"p-list__item",children:t.jsxs(o.Button,{type:"button",hasIcon:!0,onClick:O,className:m.button,children:[t.jsx(o.Icon,{name:S["ubuntu-one"].icon,className:m.icon}),t.jsx("span",{children:"Sign in with Ubuntu One"})]})}),b&&t.jsx("li",{className:"p-list__item",children:t.jsxs(o.Button,{type:"button",hasIcon:!0,onClick:()=>c(-1),className:m.button,children:[t.jsx(o.Icon,{name:S["standalone-oidc"].icon,className:m.icon}),t.jsx("span",{children:"Sign in with Enterprise Login"})]})}),x.map(w=>t.jsx("li",{className:"p-list__item",children:t.jsxs(o.Button,{type:"button",hasIcon:!0,onClick:()=>c(w.id),className:m.button,children:[t.jsx(o.Icon,{name:S[w.provider].icon,className:m.icon}),t.jsx("span",{children:`Sign in with ${w.name}`})]})},w.id))]})},H="_buttonRow_f3s21_1",V={buttonRow:H},W=({isEmailIdentityOnly:b})=>{const[p]=U(),x=A(),{signInWithEmailAndPasswordQuery:a}=E(),{setUser:i}=N(),c=y(),n=p.get("redirect-to"),l=p.has("external"),{mutateAsync:h}=a,e=T({initialValues:{email:"",password:""},validationSchema:k().shape({email:b?P().required("This field is required").email("Please provide a valid email address"):P().required("This field is required"),password:P().required("This field is required")}),onSubmit:async r=>{try{const{data:s}=await h({email:r.email,password:r.password});if(l&&n)I(n,{replace:!0});else{"current_account"in s&&i(s);const d=new URL(n??`${$}overview`,location.origin);c(d.toString().replace(d.origin,""),{replace:!0})}}catch(s){x(s)}}});return t.jsxs(o.Form,{onSubmit:e.handleSubmit,children:[t.jsx(o.Input,{type:"text",label:b?"Email":"Identity",error:e.touched.email&&e.errors.email?e.errors.email:void 0,...e.getFieldProps("email"),"data-testid":"email"}),t.jsx(o.PasswordToggle,{id:"password",label:"Password",error:e.touched.password&&e.errors.password?e.errors.password:void 0,...e.getFieldProps("password"),"data-testid":"password"}),t.jsx("div",{className:V.buttonRow,children:t.jsx(o.Button,{type:"submit",appearance:"positive",disabled:e.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},X=()=>{const[b,p]=f.useState(""),{getLoginMethodsQuery:x}=E(),{data:a,isLoading:i}=x(),c=a!=null&&a.data.oidc.available?a==null?void 0:a.data.oidc.configurations.filter(({enabled:u})=>u):[],n=!!(a!=null&&a.data.standalone_oidc.available&&a.data.standalone_oidc.enabled),l=!!(a!=null&&a.data.ubuntu_one.available&&a.data.ubuntu_one.enabled),h=!!(a!=null&&a.data.password.available&&a.data.password.enabled),e=!!(a!=null&&a.data.pam.available&&a.data.pam.enabled),r=!i&&!h&&!l&&!n&&!c.length,s=!i&&(l||n||c.length>0),d=!i&&(h||e);return t.jsxs(F,{invitationAccount:b,title:"Sign in to Landscape",children:[i&&t.jsx(q,{}),d&&t.jsx(W,{isEmailIdentityOnly:e}),s&&t.jsx(D,{isStandaloneOidcEnabled:n,isUbuntuOneEnabled:l,oidcProviders:c,onInvitation:u=>p(u)}),r&&t.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})};export{X as default};
