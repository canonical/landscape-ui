import{r as p,b as y,z as P,j as e,h as r,k as E,y as O,a as U,l as A,m as T,n as I,p as k,R,s as N}from"./index-BYYwtqOb.js";import{A as $}from"./AuthTemplate-CRvpbHa5.js";import{r as j}from"./helpers-Bo73Thd0.js";import{S}from"./constants-BLCEp6T8.js";const F="_list_1ltfk_1",q="_button_1ltfk_17",_={list:F,button:q},B=({isUbuntuOneEnabled:l,oidcProviders:u,onInvitation:m})=>{const[t,i]=p.useState(0),[s]=y(),{getOidcUrlQuery:c,getUbuntuOneUrlQuery:d,getInvitationSummaryQuery:a}=P(),o=s.get("redirect-to"),n=s.get("invitation_id"),b=s.has("external"),{data:w}=a({invitationId:n??""},{enabled:!!n});p.useEffect(()=>{w&&m(w.data.account_title)},[w]);const h={id:t};o&&(h.return_to=o),n&&(h.invitation_id=n),b&&(h.external=!0);const{data:g}=c(h,{enabled:t>0});p.useEffect(()=>{g&&j(g.data.location)},[g]);const x={};o&&(x.return_to=`${window.origin}${o}`),n&&(x.invitation_id=n),b&&(x.external=!0);const{data:v}=d(x,{enabled:t===-1});return p.useEffect(()=>{v&&j(v.data.location)},[v]),e.jsxs("ul",{className:_.list,children:[l&&e.jsx("li",{className:"p-list__item",children:e.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:()=>i(-1),className:_.button,children:[e.jsx(r.Icon,{name:S["ubuntu-one"].icon}),e.jsx("span",{children:"Sign in with Ubuntu One"})]})}),u.map(f=>e.jsx("li",{className:"p-list__item",children:e.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:()=>i(f.id),className:_.button,children:[e.jsx(r.Icon,{name:S[f.provider].icon}),e.jsx("span",{children:`Sign in with ${f.name}`})]})},f.id))]})},C="_buttonRow_46ihv_1",D={buttonRow:C},H=()=>{const[l]=y(),u=E(),{signInWithEmailAndPasswordQuery:m}=P(),{setUser:t}=O(),i=U(),s=l.get("redirect-to"),c=l.has("external"),{mutateAsync:d}=m,a=A({initialValues:{email:"",password:"",remember:!1},validationSchema:T().shape({email:I().required("This field is required"),password:I().required("This field is required"),remember:k()}),onSubmit:async o=>{try{const{data:n}=await d({email:o.email,password:o.password});if(c&&s)j(s,{replace:!0});else{t(n,o.remember);const b=new URL(s??R,location.origin);i(b.toString().replace(b.origin,""),{replace:!0})}}catch(n){u(n)}}});return e.jsxs(r.Form,{onSubmit:a.handleSubmit,children:[e.jsx(r.Input,{type:"text",label:"Identity",error:a.touched.email&&a.errors.email?a.errors.email:void 0,...a.getFieldProps("email"),"data-testid":"email"}),e.jsx(r.PasswordToggle,{id:"password",label:"Password",error:a.touched.password&&a.errors.password?a.errors.password:void 0,...a.getFieldProps("password"),"data-testid":"password"}),e.jsx(r.CheckboxInput,{label:"Remember this device",...a.getFieldProps("remember")}),e.jsx("div",{className:D.buttonRow,children:e.jsx(r.Button,{type:"submit",appearance:"positive",disabled:a.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},Q=()=>{const[l,u]=p.useState(""),{getLoginMethodsQuery:m}=P(),{data:t,isLoading:i}=m(),s=t!=null&&t.data.oidc.available?t==null?void 0:t.data.oidc.configurations.filter(({enabled:a})=>a):[],c=!!(t!=null&&t.data.ubuntu_one.available&&t.data.ubuntu_one.enabled),d=!!(t!=null&&t.data.password.available&&t.data.password.enabled);return e.jsxs($,{invitationAccount:l,title:"Sign in to Landscape",children:[i&&e.jsx(N,{}),!i&&d&&e.jsx(H,{}),!i&&(c||s.length>0)&&e.jsx(B,{isUbuntuOneEnabled:c,oidcProviders:s,onInvitation:a=>u(a)}),!i&&!d&&!c&&!s.length&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})};export{Q as default};
