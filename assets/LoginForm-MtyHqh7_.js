import{j as e,O as w,z as v,a7 as h,u as x,C as P,S as A,p as j,i as g,d as u}from"./index-DYykpNVa.js";import{g as f}from"./formikErrors-Bw8iTXYS.js";import{A as E}from"./AvailableProviderList-BuJqHLgD.js";const q=({methods:a})=>{if(!a)return null;const o=!!(a.standalone_oidc.available&&a.standalone_oidc.enabled),l=!!(a.ubuntu_one.available&&a.ubuntu_one.enabled),m=!!(a.password.available&&a.password.enabled),n=!!(a.pam.available&&a.pam.enabled),p=a.oidc.available?a.oidc.configurations.filter(({enabled:b})=>b):[],d=m||n,c=l||o||a.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[d&&e.jsx(y,{isIdentityAvailable:n}),c&&e.jsx(E,{isStandaloneOidcEnabled:o,isUbuntuOneEnabled:l,oidcProviders:p}),!d&&!c&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},S="_buttonRow_f3s21_1",_={buttonRow:S},y=({isIdentityAvailable:a})=>{const[o]=w(),l=v(),{login:m,isLoggingIn:n}=h(),{safeRedirect:p,setUser:d}=x(),c=o.get("redirect-to"),b=o.has("external"),s=P({initialValues:{email:"",password:""},validationSchema:j().shape({email:a?g().required("This field is required"):g().required("This field is required").matches(/^[a-zA-Z0-9-_.]+@[a-zA-Z0-9-.]*[a-zA-Z]$/,"Please provide a valid email address").test({message:"Please provide a valid email address",test:t=>{if(!t||t.match(/\.\./))return!1;const[i,r]=t.split("@");return!(!i||!r||i.startsWith(".")||i.endsWith(".")||!r.includes(".")||r.startsWith(".")||r.startsWith("-")||r.match(/\.-/)||r.match(/-\./))}}),password:g().required("This field is required")}),onSubmit:async t=>{try{const{data:i}=await m({email:t.email,password:t.password});"current_account"in i&&d(i),p(c??A,{external:b,replace:!0})}catch(i){l(i)}}});return e.jsxs(u.Form,{onSubmit:s.handleSubmit,children:[e.jsx(u.Input,{type:"text",label:a?"Identity":"Email",error:f(s,"email"),...s.getFieldProps("email"),"data-testid":"email"}),e.jsx(u.PasswordToggle,{id:"password",label:"Password",error:f(s,"password"),...s.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:_.buttonRow,children:e.jsx(u.ActionButton,{type:"submit",appearance:"positive",loading:s.isSubmitting||n,disabled:s.isSubmitting||!s.isValid||n,className:"u-no-margin--bottom",children:"Sign in"})})]})};export{q as L};
