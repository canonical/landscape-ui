import{b,g as y,i as x,j as t,a8 as p,L as g,A as j,D as m,d as e,v as h,E as S,I as n,N as d}from"./index-CAxb-9CO.js";import{S as _}from"./SidePanelTablePagination-CVHlLoEX.js";import{b as A}from"./ScriptsTabs-C3oDeCAY.js";import"./index-DfA4GLZO.js";import{u as f}from"./useRoles-CwlY2G8P.js";import{g as C,a as T,S as I}from"./index-CCNWOOA4.js";import"./TruncatedCell-D7I1Byj1.js";import"./HeaderWithSearch-D9EWFI6l.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./useExpandableRow-Dk4aTLgf.js";const N=({id:s,...i})=>{const a=b(),{data:r,isLoading:o}=y({queryKey:["scriptProfileActivities",{id:s,...i}],queryFn:async()=>a.get(`script-profiles/${s}/activities`,{params:i})});return{activities:r?.data.results??[],activitiesCount:r?.data.count,isGettingActivities:o}},P=({activities:s})=>{const i=x.useMemo(()=>[{Header:"Run",accessor:"creation_time",Cell:({row:{original:a}})=>t.jsx(g,{className:"font-monospace",to:`/activities?query=parent-id%3A${a.id}`,children:j(a.creation_time).utc().format(m)})},{Header:"Status",accessor:"activity_status",Cell:({row:{original:a}})=>p[a.activity_status].label,getCellIcon:({row:{original:a}})=>p[a.activity_status].icon}],[s]);return t.jsx(e.ModularTable,{columns:i,data:s})},L=({profile:s})=>{const[i,a]=x.useState(1),[r,o]=x.useState(20),{activities:l,activitiesCount:u,isGettingActivities:c}=N({id:s.id,limit:r,offset:(i-1)*r});return c?t.jsx(h,{}):l.length?t.jsxs(t.Fragment,{children:[t.jsx(P,{activities:l}),t.jsx(_,{currentPage:i,pageSize:r,paginate:a,setPageSize:o,totalItems:u})]}):t.jsx(S,{title:"No runs found",body:"The profile has not run yet."})},R=({actions:s,profile:i})=>i.archived?t.jsxs(e.Notification,{inline:!0,title:"Profile archived:",severity:"caution",children:["The profile was archived on"," ",j(i.last_edited_at).format(m),"."]}):t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[t.jsxs(e.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:s.edit,children:[t.jsx(e.Icon,{name:"edit"}),t.jsx("span",{children:"Edit"})]}),t.jsxs(e.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:s.archive,children:[t.jsx(e.Icon,{name:"archive"}),t.jsx("span",{children:"Archive"})]})]})}),w=({profile:s})=>{const{script:i,isScriptLoading:a}=A(s.script_id),{getAccessGroupQuery:r}=f(),{data:o,isLoading:l}=r();if(a||l)return t.jsx(h,{});const u=o?.data.find(v=>v.name==s.access_group)?.title||s.access_group,c=s.activities.last_activity;return t.jsxs(t.Fragment,{children:[t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(n,{label:"Title",value:s.title})}),t.jsx(e.Col,{size:6,children:t.jsx(n,{label:"Status",value:C(s)})})]}),t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(n,{label:"Script",value:i?t.jsx(g,{to:"/scripts?tab=scripts",state:{scriptId:i.id},children:i.title}):t.jsx(d,{})})}),t.jsx(e.Col,{size:6,children:t.jsx(n,{label:"Access group",value:u})})]}),t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(n,{label:"Run as user",value:s.username})}),t.jsx(e.Col,{size:6,children:t.jsx(n,{label:"Time limit",value:`${s.time_limit}s`})})]}),t.jsx("hr",{}),t.jsx(n,{label:"Trigger",value:T(s)||t.jsx(d,{})}),t.jsxs(e.Row,{className:"u-no-padding",children:[s.trigger.trigger_type!="event"&&t.jsx(e.Col,{size:6,children:t.jsx(n,{label:"Next run",value:s.trigger.next_run?`${j(s.trigger.next_run).utc().format(m)}`:t.jsx(d,{})})}),t.jsx(e.Col,{size:6,children:t.jsx(n,{label:"Last run",value:c?t.jsx(g,{to:`/activities?query=parent-id%3A${c.id}`,children:j(c.creation_time).utc().format(m)}):t.jsx(d,{})})})]}),t.jsx("hr",{}),t.jsx("p",{className:"p-heading--5",children:"Association"}),t.jsx(e.Row,{className:"u-no-padding",children:t.jsx(n,{label:"Associated instances",value:t.jsx(I,{scriptProfile:s})})}),t.jsx(e.Row,{className:"u-no-padding",children:t.jsx(n,{label:"Tags",type:"truncated",value:s.all_computers?"All instances":s.tags.join(", ")||t.jsx(d,{})})})]})},Q=({actions:s,profile:i})=>{const[a,r]=x.useState("info"),l=[{label:"Info",id:"info"},{label:"Activity history",id:"activity-history"}].map(({label:u,id:c})=>({label:u,active:a==c,onClick:()=>{r(c)}}));return t.jsxs(t.Fragment,{children:[t.jsx(R,{actions:s,profile:i}),t.jsx(e.Tabs,{listClassName:"u-no-margin--bottom",links:l}),a=="info"&&t.jsx(w,{profile:i}),a=="activity-history"&&t.jsx(L,{profile:i})]})};export{Q as default};
