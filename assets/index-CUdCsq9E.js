import{j as a,g as i,p as P,q as F,f as S,s as h}from"./index-F5ixs2NP.js";import{u as m,V as x,I as T,P as j,b as I,c as v}from"./index-it41AhDT.js";import{F as w}from"./FileInput-9g8xdon0.js";import{P as V}from"./PackageProfileConstraintsBlock-tw4xzqXg.js";import{u as A}from"./useInstances-ilOChO3j.js";import{u as C}from"./useRoles-Cwy1oMtZ.js";import{A as O}from"./AssociationBlock-Roitr0Zf.js";import{S as D}from"./SidePanelFormButtons-CsLLCRpy.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new e.Error().stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="41087455-48b8-4a4b-acc1-a338107fd57a",e._sentryDebugIdIdentifier="sentry-dbid-41087455-48b8-4a4b-acc1-a338107fd57a")}catch{}const E=[{label:"Select constraints type",value:""},{label:"From an instance's packages",value:"instance"},{label:"From a CSV file",value:"material"},{label:"Enter manually",value:"manual"}],N="_container_1y4qx_1",q={container:N},B=({formik:e})=>{const{getInstancesQuery:n}=A(),{data:l}=n(),d=(l==null?void 0:l.data.results.map(({id:o,title:u})=>({label:u,value:`${o}`})))??[];d.unshift({label:"Select instance",value:""});const p=async o=>{await e.setFieldValue("csvFile",o[0]);const u=await o[0].text();await e.setFieldValue("material",u)},c=async()=>{await e.setFieldValue("csvFile",null),await e.setFieldValue("material",""),await e.setFieldValue("isCsvFileParsed",!1)};return a.jsxs("div",{className:q.container,children:[a.jsx(i.Select,{label:"Package constraints",required:!0,options:E,...e.getFieldProps("constraintsType"),error:e.touched.constraintsType&&e.errors.constraintsType?e.errors.constraintsType:void 0}),e.values.constraintsType==="instance"&&a.jsx(i.Select,{label:"Instance",required:e.values.constraintsType==="instance",options:d,...e.getFieldProps("source_computer_id"),error:e.touched.source_computer_id&&e.errors.source_computer_id?e.errors.source_computer_id:void 0}),e.values.constraintsType==="material"&&a.jsx(w,{label:"Upload constraints",accept:".csv",...e.getFieldProps("csvFile"),onFileRemove:c,onFileUpload:p,help:'File should be formatted as either a package profile CSV file or the output of running "dpkg --get-selections" on a computer with desired packages installed.',error:e.touched.csvFile&&e.errors.csvFile||e.touched.material&&e.errors.material||void 0}),e.values.constraintsType==="manual"&&a.jsx(V,{formik:e})]})},b=()=>{const e=P(),{notify:n}=F(),{closeSidePanel:l}=S(),{getAccessGroupQuery:d}=C(),{createPackageProfileQuery:p}=m(),{data:c}=d(),o=(c==null?void 0:c.data.map(({name:s,title:r})=>({label:r,value:s})))??[];o.unshift({label:"Select access group",value:""});const{mutateAsync:u}=p,t=h({initialValues:T,onSubmit:async s=>{const r={access_group:s.access_group,description:s.description,title:s.title};s.all_computers?r.all_computers=!0:s.tags.length>0&&(r.tags=s.tags),s.constraintsType==="material"?r.material=s.material:s.constraintsType==="instance"?r.source_computer_id=s.source_computer_id:r.constraints=s.constraints.map(({constraint:g,package:f,rule:y,version:_})=>({constraint:g,package:f,rule:y,version:_}));try{await u(r),l(),n.success({message:`Profile "${s.title}" added successfully`,title:"Profile added"})}catch(g){e(g)}},validationSchema:x});return a.jsxs(i.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[a.jsx(i.Input,{type:"text",label:"Name",required:!0,...t.getFieldProps("title"),error:t.touched.title&&t.errors.title?t.errors.title:void 0}),a.jsx(i.Input,{type:"text",label:"Description",required:!0,autoComplete:"off",...t.getFieldProps("description"),error:t.touched.description&&t.errors.description?t.errors.description:void 0}),a.jsx(i.Select,{label:"Access group",...t.getFieldProps("access_group"),options:o,error:t.touched.access_group&&t.errors.access_group?t.errors.access_group:void 0}),a.jsx(O,{formik:t}),a.jsx(B,{formik:t}),a.jsx(D,{submitButtonDisabled:t.isSubmitting,submitButtonText:"Add package profile"})]})},Q=Object.freeze(Object.defineProperty({__proto__:null,default:b},Symbol.toStringTag,{value:"Module"})),Y=Object.freeze(Object.defineProperty({__proto__:null,PackageProfileCreateForm:b,PackageProfileHeader:I,PackageProfileList:j,PackageProfilesEmptyState:v,usePackageProfiles:m},Symbol.toStringTag,{value:"Module"}));export{Y as a,Q as i};
