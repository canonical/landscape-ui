const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CGOqFR7y.js","assets/index-BWDSuVdc.js","assets/index-D3DIubem.css","assets/MultiSelectField-BgIVnwCP.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-C7maNMEA.js","assets/SidePanelFormButtons.module-tJTvEwdD.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/useRoles-CrVoQhRg.js","assets/useFetchOld-BrEW1db4.js","assets/PageMain-DgpfYE6B.js","assets/PageMain--v5xNZ5p.css","assets/TablePagination-B-je2IEH.js","assets/usePageParams-Bts0F2BK.js","assets/TablePaginationBase-BhH1Qvbp.js","assets/TablePaginationBase-CJl3HN1X.css","assets/NoData-B3Q3EXVi.js","assets/TableFilterChips-BuKzUo5Y.js","assets/TableFilterChips-CHqetGbX.css","assets/HeaderWithSearch-BVVpyzCJ.js","assets/HeaderWithSearch-C2lwo0VI.css"])))=>i.map(i=>d[i]);
import{b as q,e as H,c as j,d as L,r as b,q as k,p as S,s as R,h as D,t as Q,k as E,j as e,g as d,I as _,f as F,n as C,E as V,_ as w,D as B}from"./index-BWDSuVdc.js";import{P as z,a as O,b as K}from"./PageMain-DgpfYE6B.js";import{u as Y}from"./useFetchOld-BrEW1db4.js";import{T as U}from"./TablePagination-B-je2IEH.js";import{u as M}from"./useRoles-CrVoQhRg.js";import{M as $}from"./MultiSelectField-BgIVnwCP.js";import{S as W}from"./SidePanelFormButtons-C7maNMEA.js";import{N}from"./NoData-B3Q3EXVi.js";import{u as G,h as I}from"./usePageParams-Bts0F2BK.js";import{T as J}from"./TableFilterChips-BuKzUo5Y.js";import{H as X}from"./HeaderWithSearch-BVVpyzCJ.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new t.Error().stack;n&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[n]="b7e55574-a1f3-48a6-b5af-4eaa673abf8c",t._sentryDebugIdIdentifier="sentry-dbid-b7e55574-a1f3-48a6-b5af-4eaa673abf8c")}catch{}function A(){const t=q(),n=Y(),o=H(),m=(i,p={})=>L({queryKey:["administrators"],queryFn:()=>n.get("GetAdministrators"),...p}),g=j({mutationFn:i=>n.get("InviteAdministrator",{params:i}),onSuccess:()=>t.invalidateQueries({queryKey:["invitations"]})}),h=j({mutationFn:i=>n.get("DisableAdministrator",{params:i}),onSuccess:()=>t.invalidateQueries({queryKey:["administrators"]})}),f=j({mutationFn:({id:i,...p})=>o.put(`administrators/${i}`,p),onSuccess:()=>Promise.all([t.invalidateQueries({queryKey:["administrators"]}),t.invalidateQueries({queryKey:["roles"]})])}),c=(i,p={})=>L({queryKey:["invitations",i],queryFn:()=>o.get("/invitations",{params:i}),...p}),r=j({mutationFn:i=>o.delete(`/invitations/${i.id}`),onSuccess:()=>t.invalidateQueries({queryKey:["invitations"]})}),u=j({mutationFn:i=>o.post(`/invitations/${i.id}`),onSuccess:()=>t.invalidateQueries({queryKey:["invitations"]})});return{getAdministratorsQuery:m,inviteAdministratorQuery:g,disableAdministratorQuery:h,editAdministratorQuery:f,getInvitationsQuery:c,revokeInvitationQuery:r,resendInvitationQuery:u}}const Z=({administrator:t})=>{const[n,o]=b.useState(t);b.useEffect(()=>{o(t)},[t]);const{notify:m}=k(),g=S(),{disableAdministratorQuery:h,editAdministratorQuery:f}=A(),{getRolesQuery:c}=M(),{data:r}=c(),u=(r==null?void 0:r.data.map(({name:a})=>({label:a,value:a})))??[],{mutateAsync:i}=f,{mutateAsync:p,isPending:v}=h,y=async()=>{try{await p({email:n.email})}catch(a){g(a)}},l=async a=>{try{await i({id:t.id,roles:a.roles}),o(x=>({...x,roles:a.roles})),m.success({title:"Permission changes have been queued",message:`You changed ${n.name}'s roles`})}catch(x){g(x)}},s=R({initialValues:{roles:[]},validationSchema:D().shape({roles:Q().of(E()).min(1,"At least one role is required")}),onSubmit:l});return b.useEffect(()=>{s.setValues({roles:n.roles})},[n]),e.jsxs(d.Form,{onSubmit:s.handleSubmit,noValidate:!0,children:[e.jsxs(d.ConfirmationButton,{type:"button",className:"has-icon",confirmationModalProps:{title:"Disable Administrator",children:e.jsx("p",{children:"This will remove the administrator from your Landscape organisation."}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:v,confirmButtonLoading:v,onConfirm:y},children:[e.jsx(d.Icon,{name:d.ICONS.delete,"aria-hidden":"true"}),e.jsx("span",{children:"Remove"})]}),e.jsxs(d.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(d.Col,{size:6,children:e.jsx(_,{label:"Name",value:n.name})}),e.jsx(d.Col,{size:6,children:e.jsx(_,{label:"Email",value:n.email})}),e.jsx(d.Col,{size:12,children:e.jsx(_,{label:"Timezone",value:e.jsx(N,{})})}),e.jsx(d.Col,{size:12,children:e.jsx(_,{label:"Identity URL",value:e.jsx(N,{})})})]}),e.jsx($,{variant:"condensed",label:"Roles",items:u,selectedItems:u.filter(({value:a})=>s.values.roles.includes(a)),placeholder:"Select roles",onItemsUpdate:a=>s.setFieldValue("roles",a.map(({value:x})=>x)),error:s.touched.roles&&typeof s.errors.roles=="string"?s.errors.roles:void 0}),e.jsx(W,{submitButtonDisabled:s.isSubmitting||s.values.roles.length===n.roles.length&&s.values.roles.every(a=>n.roles.includes(a)),submitButtonText:"Save changes"})]})},ee="_footer_nfyyh_1",te="_multiSelect_nfyyh_7",T={footer:ee,multiSelect:te},se=({administrator:t,roleOptions:n})=>{const o=S(),{notify:m}=k(),{editAdministratorQuery:g}=A(),{mutateAsync:h}=g,f=async({roles:r})=>{try{await h({id:t.id,roles:r}),m.success({title:"Permission changes have been queued",message:`You changed ${t.name}'s roles`})}catch(u){o(u)}},c=R({initialValues:{roles:[]},validationSchema:D().shape({roles:Q().of(E()).min(1,"At least one role is required")}),onSubmit:f});return b.useEffect(()=>{c.setValues({roles:t.roles})},[t.roles]),e.jsx(d.Form,{onSubmit:c.handleSubmit,noValidate:!0,children:e.jsx($,{required:!0,variant:"condensed",className:T.multiSelect,items:n,selectedItems:n.filter(({value:r})=>c.values.roles.includes(r)),onItemsUpdate:r=>c.setValues({roles:r.map(({value:u})=>u)}),placeholder:"Select roles",error:c.touched.roles&&typeof c.errors.roles=="string"?c.errors.roles:void 0,dropdownFooter:e.jsxs("div",{className:T.footer,children:[e.jsx(d.Button,{type:"button",dense:!0,small:!0,className:"u-no-margin--bottom",disabled:c.values.roles.length===t.roles.length&&t.roles.every(r=>c.values.roles.includes(r)),onClick:()=>c.setFieldValue("roles",t.roles),children:"Revert"}),e.jsx(d.Button,{type:"submit",dense:!0,small:!0,appearance:"positive",className:"u-no-margin--bottom",disabled:c.values.roles.length===t.roles.length&&t.roles.every(r=>c.values.roles.includes(r)),children:"Save changes"})]})})})},ne="_roles_1cuab_1",ie="_actions_1cuab_2",ae="_table_1cuab_6",P={roles:ne,actions:ie,table:ae},oe=({administrators:t,emptyMessage:n,roles:o})=>{const m=S(),{setSidePanelContent:g}=F(),{disableAdministratorQuery:h}=A(),{mutateAsync:f,isPending:c}=h,r=b.useMemo(()=>t,[t]),u=b.useMemo(()=>o.map(({name:l})=>({label:l,value:l})),[o]),i=async l=>{try{await f({email:l})}catch(s){m(s)}},p=l=>{g(l.name,e.jsx(Z,{administrator:l}))},v=b.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:l})=>e.jsx(d.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{p(l.original)},children:l.original.name})},{accessor:"email",Header:"Email"},{accessor:"roles",className:P.roles,Header:"Roles",Cell:({row:l})=>e.jsx(se,{administrator:l.original,roleOptions:u})},{accessor:"actions",className:P.actions,Cell:({row:l})=>e.jsx(d.ConfirmationButton,{className:"u-no-margin--bottom u-no-padding--left is-small has-icon",type:"button",appearance:"base","aria-label":`Remove ${l.original.name}`,confirmationModalProps:{title:`Remove ${l.original.name}`,children:e.jsx("p",{children:"This will remove the administrator from your Landscape organisation."}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:c,confirmButtonLoading:c,onConfirm:()=>i(l.original.email)},children:e.jsx(d.Tooltip,{position:"top-center",message:"Remove",children:e.jsx(d.Icon,{name:d.ICONS.delete,className:"u-no-margin--left u-no-padding"})})})}],[r,u]),y=l=>{const s={};return l.column.id==="name"?s.role="rowheader":l.column.id==="email"?s["aria-label"]="Email":l.column.id==="roles"?s["aria-label"]="Roles":l.column.id==="actions"&&(s["aria-label"]="Actions"),s};return e.jsx(d.ModularTable,{columns:v,data:r,getCellProps:y,emptyMsg:n,className:P.table})},re=()=>e.jsxs(e.Fragment,{children:[e.jsx(X,{}),e.jsx(J,{filtersToDisplay:["search"]})]}),le=({administrators:t})=>{const{search:n,pageSize:o,currentPage:m}=G(),{getRolesQuery:g}=M(),{data:h}=g(),c=(()=>{const u=n.trim().toLowerCase();return u?t.filter(i=>i.email.toLowerCase().includes(u)||i.name.toLowerCase().includes(u)||i.roles.some(p=>p.toLowerCase().includes(u))):t})(),r=c.filter((u,i)=>i>=(m-1)*o&&i<m*o)??[];return e.jsxs(e.Fragment,{children:[e.jsx(re,{}),e.jsx(oe,{administrators:r,emptyMessage:n.trim()?`No administrators found with the search: "${n.trim()}"`:"You have no administrators on your Landscape organisation",roles:(h==null?void 0:h.data)??[]}),r.length>0&&e.jsx(U,{totalItems:c.length,currentItemCount:r.length})]})},ce=b.lazy(()=>w(()=>import("./index-CGOqFR7y.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))),de=()=>{const{setSidePanelContent:t}=F(),{getAdministratorsQuery:n}=A(),{data:o,isLoading:m}=n(),g=()=>{t("Invite administrator",e.jsx(b.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(ce,{})}))};return e.jsxs(e.Fragment,{children:[m&&e.jsx(C,{}),!m&&(!o||!o.data.length)&&e.jsx(V,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no administrators in your Landscape organization."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[e.jsx(d.Button,{type:"button",appearance:"positive",onClick:g,children:"Invite Administrator"},"invite-administrator")],icon:"user",title:"No administrators found"}),!m&&o&&o.data.length>0&&e.jsx(le,{administrators:o.data})]})},me=()=>{const t=S(),{notify:n}=k(),{getInvitationsQuery:o,revokeInvitationQuery:m,resendInvitationQuery:g}=A(),{data:h}=o(),f=b.useMemo(()=>(h==null?void 0:h.data.results.sort((s,a)=>I(a.creation_time).diff(I(s.creation_time))))??[],[h]),{mutateAsync:c,isPending:r}=m,{mutateAsync:u,isPending:i}=g,p=async s=>{try{await c({id:s.id}),n.success({message:`${s.name}’${s.name.endsWith("s")?"":"s"} invitation has been revoked`,title:"You revoked an administrator invite"})}catch(a){t(a)}},v=async s=>{try{await u({id:s.id}),n.success({message:`${s.name} will receive a new invitation email`,title:"You resent an administrator invite"})}catch(a){t(a)}},y=b.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"email",Header:"Email"},{accessor:"creation_time",Header:"Invited",Cell:({row:s})=>I(s.original.creation_time).format(B)},{accessor:"expiration_time",Header:"Expires",Cell:({row:s})=>I(s.original.creation_time).add(14,"days").format(B)},{accessor:"actions",Cell:({row:s})=>e.jsxs("div",{className:"u-align-text--right",children:[e.jsx(d.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Revoke invitation for ${s.original.name}`,children:e.jsxs("p",{children:["This action will prevent ",s.original.name," from joining your Landscape organisation."]}),confirmButtonLabel:"Revoke invitation",confirmButtonAppearance:"negative",confirmButtonDisabled:r,confirmButtonLoading:r,onConfirm:()=>p(s.original)},children:"Revoke"}),e.jsx(d.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Resend invitation for ${s.original.name}`,children:e.jsxs("p",{children:[s.original.name," will receive a new invitation email."]}),confirmButtonLabel:"Resend invitation",confirmButtonAppearance:"positive",confirmButtonDisabled:i,confirmButtonLoading:i,onConfirm:()=>v(s.original)},children:"Resend"})]})}],[f]),l=s=>{const a={};return s.column.id==="name"?a.role="rowheader":s.column.id==="email"?a["aria-label"]="Email":s.column.id==="creation_time"?a["aria-label"]="Invited":s.column.id==="expiration_time"?a["aria-label"]="Expires":s.column.id==="actions"&&(a["aria-label"]="Actions"),a};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-text--muted p-text--small",children:"Unclaimed invitations expire after 14 days."}),e.jsx(d.ModularTable,{columns:y,data:f,getCellProps:l,emptyMsg:"You have no unclaimed invitations."})]})},ue="_tabPanel_1n8p7_1",he={tabPanel:ue},be=[{label:"Administrators",id:"tab-link-administrators"},{label:"Invites",id:"tab-link-invites"}],ge=()=>{const[t,n]=b.useState("tab-link-administrators");return e.jsxs(e.Fragment,{children:[e.jsx(d.Tabs,{listClassName:"u-no-margin--bottom",links:be.map(({label:o,id:m})=>({label:o,id:m,role:"tab",active:m===t,onClick:()=>n(m)}))}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":t,className:he.tabPanel,children:e.jsxs(b.Suspense,{fallback:e.jsx(C,{}),children:[t==="tab-link-administrators"&&e.jsx(de,{}),t==="tab-link-invites"&&e.jsx(me,{})]})})]})},pe=b.lazy(()=>w(()=>import("./index-CGOqFR7y.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))),fe=()=>{const{setSidePanelContent:t}=F(),n=()=>{t("Invite administrator",e.jsx(b.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(pe,{})}))};return e.jsxs(z,{children:[e.jsx(O,{title:"Administrators",actions:[e.jsx(d.Button,{type:"button",onClick:n,children:"Invite administrator"},"invite-administrator")]}),e.jsx(K,{children:e.jsx(ge,{})})]})},Fe=Object.freeze(Object.defineProperty({__proto__:null,default:fe},Symbol.toStringTag,{value:"Module"}));export{Fe as i,A as u};
