const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CkugiiIN.js","assets/index-B7B6ilm5.js","assets/index-DM5072WT.css","assets/MultiSelectField-vXgT37NA.js","assets/MultiSelectField-DOBW8uWL.css","assets/SidePanelFormButtons-DMklau0U.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/useRoles-C9ZPoQqW.js","assets/useFetchOld-1Nw_5ixo.js","assets/PageMain-B9UunXWw.js","assets/PageMain-BIuYvhUI.css","assets/TablePagination-BnMZ3GtV.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-B293qugv.js","assets/InfoItem-Ke61lZbc.js","assets/InfoItem-C-lWh_lY.css","assets/NoData-DuM1zKhh.js","assets/moment-C5S46NFB.js"])))=>i.map(i=>d[i]);
import{c as O,d as K,e as C,f as Q,r as v,v as F,k as P,C as N,l as E,m as L,o as D,n as B,j as e,h as l,i as w,_ as q,s as k,E as Y,G as $}from"./index-B7B6ilm5.js";import{P as U,a as G,b as W}from"./PageMain-B9UunXWw.js";import{u as J}from"./useFetchOld-1Nw_5ixo.js";import{T as X}from"./TablePagination-BnMZ3GtV.js";import{u as z}from"./useRoles-C9ZPoQqW.js";import{M as V}from"./MultiSelectField-vXgT37NA.js";import{S as Z}from"./SidePanelFormButtons-DMklau0U.js";import{I as _}from"./InfoItem-Ke61lZbc.js";import{N as M}from"./NoData-DuM1zKhh.js";import{u as H}from"./usePageParams-B293qugv.js";import{h as I}from"./moment-C5S46NFB.js";function S(){const s=O(),a=J(),i=K(),d=(o,b={})=>Q({queryKey:["administrators"],queryFn:()=>a.get("GetAdministrators"),...b}),h=C({mutationFn:o=>a.get("InviteAdministrator",{params:o}),onSuccess:()=>s.invalidateQueries({queryKey:["invitations"]})}),p=C({mutationFn:o=>a.get("DisableAdministrator",{params:o}),onSuccess:()=>s.invalidateQueries({queryKey:["administrators"]})}),g=C({mutationFn:({id:o,...b})=>i.put(`administrators/${o}`,b),onSuccess:()=>Promise.all([s.invalidateQueries({queryKey:["administrators"]}),s.invalidateQueries({queryKey:["roles"]})])}),n=(o,b={})=>Q({queryKey:["invitations",o],queryFn:()=>i.get("/invitations",{params:o}),...b}),m=C({mutationFn:o=>i.delete(`/invitations/${o.id}`),onSuccess:()=>s.invalidateQueries({queryKey:["invitations"]})}),u=C({mutationFn:o=>i.post(`/invitations/${o.id}`),onSuccess:()=>s.invalidateQueries({queryKey:["invitations"]})});return{getAdministratorsQuery:d,inviteAdministratorQuery:h,disableAdministratorQuery:p,editAdministratorQuery:g,getInvitationsQuery:n,revokeInvitationQuery:m,resendInvitationQuery:u}}const ee=({administrator:s})=>{const[a,i]=v.useState(s);v.useEffect(()=>{i(s)},[s]);const{notify:d}=F(),h=P(),{confirmModal:p,closeConfirmModal:g}=N(),{disableAdministratorQuery:n,editAdministratorQuery:m}=S(),{getRolesQuery:u}=z(),{data:o}=u(),b=(o==null?void 0:o.data.map(({name:c})=>({label:c,value:c})))??[],{mutateAsync:y}=m,{mutateAsync:x}=n,f=async()=>{try{await x({email:a.email})}catch(c){h(c)}finally{g()}},j=()=>{p({title:"Disable Administrator",body:"This will remove the administrator from your Landscape organization.",buttons:[e.jsx(l.Button,{onClick:f,appearance:"negative",hasIcon:!0,"aria-label":`Remove ${a.name}`,children:"Remove"},"remove-administrator")]})},r=async c=>{try{await y({id:s.id,roles:c.roles}),i(A=>({...A,roles:c.roles})),d.success({title:"Permission changes have been queued",message:`You changed ${a.name}'s roles`})}catch(A){h(A)}},t=E({initialValues:{roles:[]},validationSchema:L().shape({roles:D().of(B()).min(1,"At least one role is required")}),onSubmit:r});return v.useEffect(()=>{t.setValues({roles:a.roles})},[a]),e.jsxs(l.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[e.jsxs(l.Button,{type:"button",hasIcon:!0,onClick:j,children:[e.jsx("i",{className:"p-icon--delete","aria-hidden":"true"}),e.jsx("span",{children:"Remove"})]}),e.jsxs(l.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(l.Col,{size:6,children:e.jsx(_,{label:"Name",value:a.name})}),e.jsx(l.Col,{size:6,children:e.jsx(_,{label:"Email",value:a.email})}),e.jsx(l.Col,{size:12,children:e.jsx(_,{label:"Timezone",value:e.jsx(M,{})})}),e.jsx(l.Col,{size:12,children:e.jsx(_,{label:"Identity URL",value:e.jsx(M,{})})})]}),e.jsx(V,{variant:"condensed",label:"Roles",items:b,selectedItems:b.filter(({value:c})=>t.values.roles.includes(c)),placeholder:"Select roles",onItemsUpdate:c=>t.setFieldValue("roles",c.map(({value:A})=>A)),error:t.touched.roles&&typeof t.errors.roles=="string"?t.errors.roles:void 0}),e.jsx(Z,{submitButtonDisabled:t.isSubmitting||t.values.roles.length===a.roles.length&&t.values.roles.every(c=>a.roles.includes(c)),submitButtonText:"Save changes"})]})},te="_footer_uzw2n_1",se="_multiSelect_uzw2n_7",T={footer:te,multiSelect:se},ae=({administrator:s,roleOptions:a})=>{const i=P(),{notify:d}=F(),{editAdministratorQuery:h}=S(),{mutateAsync:p}=h,g=async({roles:m})=>{try{await p({id:s.id,roles:m}),d.success({title:"Permission changes have been queued",message:`You changed ${s.name}'s roles`})}catch(u){i(u)}},n=E({initialValues:{roles:[]},validationSchema:L().shape({roles:D().of(B()).min(1,"At least one role is required")}),onSubmit:g});return v.useEffect(()=>{n.setValues({roles:s.roles})},[s.roles]),e.jsx(l.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:e.jsx(V,{required:!0,variant:"condensed",className:T.multiSelect,items:a,selectedItems:a.filter(({value:m})=>n.values.roles.includes(m)),onItemsUpdate:m=>n.setValues({roles:m.map(({value:u})=>u)}),placeholder:"Select roles",error:n.touched.roles&&typeof n.errors.roles=="string"?n.errors.roles:void 0,dropdownFooter:e.jsxs("div",{className:T.footer,children:[e.jsx(l.Button,{type:"button",dense:!0,small:!0,className:"u-no-margin--bottom",disabled:n.values.roles.length===s.roles.length&&s.roles.every(m=>n.values.roles.includes(m)),onClick:()=>n.setFieldValue("roles",s.roles),children:"Revert"}),e.jsx(l.Button,{type:"submit",dense:!0,small:!0,appearance:"positive",className:"u-no-margin--bottom",disabled:n.values.roles.length===s.roles.length&&s.roles.every(m=>n.values.roles.includes(m)),children:"Save changes"})]})})})},ne="_roles_1cuab_1",ie="_actions_1cuab_2",oe="_table_1cuab_6",R={roles:ne,actions:ie,table:oe},re=({administrators:s,emptyMessage:a,roles:i})=>{const d=P(),{setSidePanelContent:h}=w(),{confirmModal:p,closeConfirmModal:g}=N(),{disableAdministratorQuery:n}=S(),{mutateAsync:m}=n,u=v.useMemo(()=>s,[s]),o=v.useMemo(()=>i.map(({name:r})=>({label:r,value:r})),[i]),b=async r=>{try{await m({email:r})}catch(t){d(t)}finally{g()}},y=r=>{p({body:"This will remove the administrator from your Landscape organisation.",title:`Remove ${r.name}`,buttons:[e.jsx(l.Button,{appearance:"negative",hasIcon:!0,onClick:()=>b(r.email),"aria-label":`Remove ${r.name}`,children:e.jsx("span",{children:"Remove"})},`remove-administrator-${r.id}`)]})},x=r=>{h(r.name,e.jsx(ee,{administrator:r}))},f=v.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:r})=>e.jsx(l.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{x(r.original)},children:r.original.name})},{accessor:"email",Header:"Email"},{accessor:"roles",className:R.roles,Header:"Roles",Cell:({row:r})=>e.jsx(ae,{administrator:r.original,roleOptions:o})},{accessor:"actions",className:R.actions,Cell:({row:r})=>e.jsxs(l.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left p-tooltip--top-center","aria-label":`Remove ${r.original.name}`,onClick:()=>y(r.original),children:[e.jsx("span",{className:"p-tooltip__message",children:"Remove"}),e.jsx(l.Icon,{name:l.ICONS.delete,className:"u-no-margin--left"})]})}],[u,o]),j=r=>{const t={};return r.column.id==="name"?t.role="rowheader":r.column.id==="email"?t["aria-label"]="Email":r.column.id==="roles"?t["aria-label"]="Roles":r.column.id==="actions"&&(t["aria-label"]="Actions"),t};return e.jsx(l.ModularTable,{columns:f,data:u,getCellProps:j,emptyMsg:a,className:R.table})},le=()=>{const{search:s,setPageParams:a}=H(),[i,d]=v.useState(s),h=()=>{a({search:i})},p=()=>{a({search:""})},g=n=>{n.preventDefault(),h()};return e.jsx(l.Row,{className:"u-no-padding--left u-no-padding--right u-no-margin--left u-no-margin--right",children:e.jsx(l.Col,{size:6,children:e.jsx(l.Form,{onSubmit:g,noValidate:!0,children:e.jsx(l.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,value:i,onChange:n=>d(n),onSearch:h,onClear:p,autocomplete:"off"})})})})},ce=({administrators:s})=>{const{search:a,pageSize:i,currentPage:d}=H(),{getRolesQuery:h}=z(),{data:p}=h(),n=(()=>{const u=a.trim().toLowerCase();return u?s.filter(o=>o.email.toLowerCase().includes(u)||o.name.toLowerCase().includes(u)||o.roles.some(b=>b.toLowerCase().includes(u))):s})(),m=n.filter((u,o)=>o>=(d-1)*i&&o<d*i)??[];return e.jsxs(e.Fragment,{children:[e.jsx(le,{}),e.jsx(re,{administrators:m,emptyMessage:a.trim()?`No administrators found with the search: "${a.trim()}"`:"You have no administrators on your Landscape organisation",roles:(p==null?void 0:p.data)??[]}),m.length>0&&e.jsx(X,{totalItems:n.length,currentItemCount:m.length})]})},de=v.lazy(()=>q(()=>import("./index-CkugiiIN.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]))),me=()=>{const{setSidePanelContent:s}=w(),{getAdministratorsQuery:a}=S(),{data:i,isLoading:d}=a(),h=()=>{s("Invite administrator",e.jsx(v.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(de,{})}))};return e.jsxs(e.Fragment,{children:[d&&e.jsx(k,{}),!d&&(!i||!i.data.length)&&e.jsx(Y,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no administrators in your Landscape organization."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[e.jsx(l.Button,{type:"button",appearance:"positive",onClick:h,children:"Invite Administrator"},"invite-administrator")],icon:"user",title:"No administrators found"}),!d&&i&&i.data.length>0&&e.jsx(ce,{administrators:i.data})]})},ue=()=>{const s=P(),{notify:a}=F(),{confirmModal:i,closeConfirmModal:d}=N(),{getInvitationsQuery:h,revokeInvitationQuery:p,resendInvitationQuery:g}=S(),{data:n}=h(),m=v.useMemo(()=>(n==null?void 0:n.data.results.sort((t,c)=>I(c.creation_time).diff(I(t.creation_time))))??[],[n]),{mutateAsync:u}=p,{mutateAsync:o}=g,b=async t=>{try{await u({id:t.id}),a.success({message:`${t.name}â€™${t.name.endsWith("s")?"":"s"} invitation has been revoked`,title:"You revoked an administrator invite"})}catch(c){s(c)}finally{d()}},y=t=>{i({title:`Revoke invitation for ${t.name}`,body:`This action will prevent ${t.name} from joining your Landscape organisation.`,buttons:[e.jsx(l.Button,{appearance:"negative",onClick:()=>b(t),children:"Revoke invitation"},"revoke")]})},x=async t=>{try{await o({id:t.id}),a.success({message:`${t.name} will receive a new invitation email`,title:"You resent an administrator invite"})}catch(c){s(c)}finally{d()}},f=t=>{i({title:`Resend invitation for ${t.name}`,body:`${t.name} will receive a new invitation email`,buttons:[e.jsx(l.Button,{appearance:"positive",onClick:()=>x(t),children:"Resend invitation"},"resend")]})},j=v.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"email",Header:"Email"},{accessor:"creation_time",Header:"Invited",Cell:({row:t})=>I(t.original.creation_time).format($)},{accessor:"expiration_time",Header:"Expires",Cell:({row:t})=>I(t.original.creation_time).add(14,"days").format($)},{accessor:"actions",Cell:({row:t})=>e.jsxs("div",{className:"u-align-text--right",children:[e.jsx(l.Button,{dense:!0,small:!0,className:"u-no-margin--bottom",onClick:()=>y(t.original),children:"Revoke"}),e.jsx(l.Button,{dense:!0,small:!0,className:"u-no-margin--bottom",onClick:()=>f(t.original),children:"Resend"})]})}],[m]),r=t=>{const c={};return t.column.id==="name"?c.role="rowheader":t.column.id==="email"?c["aria-label"]="Email":t.column.id==="creation_time"?c["aria-label"]="Invited":t.column.id==="expiration_time"?c["aria-label"]="Expires":t.column.id==="actions"&&(c["aria-label"]="Actions"),c};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-text--muted p-text--small",children:"Unclaimed invitations expire after 14 days."}),e.jsx(l.ModularTable,{columns:j,data:m,getCellProps:r,emptyMsg:"You have no unclaimed invitations."})]})},he="_tabPanel_1n8p7_1",ve={tabPanel:he},pe=[{label:"Administrators",id:"tab-link-administrators"},{label:"Invites",id:"tab-link-invites"}],be=()=>{const[s,a]=v.useState("tab-link-administrators");return e.jsxs(e.Fragment,{children:[e.jsx(l.Tabs,{listClassName:"u-no-margin--bottom",links:pe.map(({label:i,id:d})=>({label:i,id:d,role:"tab",active:d===s,onClick:()=>a(d)}))}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":s,className:ve.tabPanel,children:e.jsxs(v.Suspense,{fallback:e.jsx(k,{}),children:[s==="tab-link-administrators"&&e.jsx(me,{}),s==="tab-link-invites"&&e.jsx(ue,{})]})})]})},ge=v.lazy(()=>q(()=>import("./index-CkugiiIN.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]))),ye=()=>{const{setSidePanelContent:s}=w(),a=()=>{s("Invite administrator",e.jsx(v.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(ge,{})}))};return e.jsxs(U,{children:[e.jsx(G,{title:"Administrators",actions:[e.jsx(l.Button,{type:"button",onClick:a,children:"Invite administrator"},"invite-administrator")]}),e.jsx(W,{children:e.jsx(be,{})})]})},Fe=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"}));export{Fe as i,S as u};
