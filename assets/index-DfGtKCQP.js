import{y as k,z as B,l as F,r as u,j as n,m as c,o as $}from"./index-Q7_P6QJX.js";import{S as D}from"./SidePanelFormButtons-BqhcAbDz.js";import{u as E}from"./useInstances-B_1M65Fe.js";import{u as N,T as O}from"./useTaggedSecurityProfiles-B2Wv4FDy.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./helpers-BiUFhH9_.js";const R=({selected:e})=>{const x=k(),{notify:T}=B(),{closeSidePanel:b}=F(),{addTagsToInstancesQuery:p,getAllInstanceTagsQuery:j}=E(),{mutateAsync:C,isPending:g}=p,{data:d,isLoading:S}=j(),[v,m]=u.useState(!1),[r,w]=u.useState(""),[t,l]=u.useState([]),{securityProfiles:f,isSecurityProfilesLoading:L}=N(t,e),h=async()=>{try{await C({query:e.map(({id:s})=>`id:${s}`).join(" OR "),tags:t}),b(),T.success({title:"Tags assigned",message:`Tags successfully assigned to ${e.length>1?`${e.length} instances`:`"${e[0].title}" instance`}`})}catch(s){x(s)}},A=async()=>{f.length?m(!0):await h()},o=(d==null?void 0:d.data.results.filter(s=>s.toLowerCase().includes(r.toLowerCase())))??[],I=()=>{o.every(s=>t.includes(s))?l([]):l(o)},M=u.useMemo(()=>[{accessor:"value",Header:n.jsxs(n.Fragment,{children:[n.jsx(c.CheckboxInput,{inline:!0,label:null,disabled:o.every(s=>e.every(i=>i.tags.includes(s))),checked:o.every(s=>t.includes(s)||e.every(i=>i.tags.includes(s))),indeterminate:o.some(s=>e.some(i=>!i.tags.includes(s)))&&o.some(s=>e.some(i=>i.tags.includes(s))),onChange:I}),"Name"]}),Cell:({row:{original:{value:s}}})=>{const i=()=>{if(t.includes(s)){l(t.toSpliced(t.findIndex(a=>a==s),1));return}e.every(a=>a.tags.includes(s))||l([...t,s])};return n.jsxs(n.Fragment,{children:[n.jsx(c.CheckboxInput,{inline:!0,label:null,disabled:e.every(a=>a.tags.includes(s)),checked:t.includes(s)||e.every(a=>a.tags.includes(s)),indeterminate:!t.includes(s)&&e.some(a=>a.tags.includes(s))&&e.some(a=>!a.tags.includes(s)),onChange:i}),s]})}}],[t,o]);if(S)return n.jsx($,{});const y=o.map(s=>({value:s})),P=()=>{m(!1)};return n.jsxs(n.Fragment,{children:[n.jsx("p",{children:"Adding tags will associate the instance with the profiles that tag is linked to. This may change configurations on your instance."}),n.jsx(c.SearchBox,{value:r,onChange:s=>{w(s)}}),n.jsx(c.ModularTable,{emptyMsg:"No tags found",columns:M,data:[...y.filter(({value:s})=>s.toLowerCase().startsWith(r.toLowerCase())),...y.filter(({value:s})=>!s.toLowerCase().startsWith(r.toLowerCase()))]}),n.jsx(D,{onSubmit:A,submitButtonDisabled:!t.length||g||L,submitButtonText:"Assign"}),v&&n.jsx(O,{instances:e,securityProfiles:f,tags:t,onConfirm:h,confirmButtonDisabled:g,close:P})]})};export{R as default};
