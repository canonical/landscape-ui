import{c as x,l as C,j as e,d as a,at as b,r as j,y as s,q as _}from"./index-C_afT7mA.js";const w=(i,r)=>{const t=x(),{data:o,isFetching:l,isPending:c,refetch:g}=C({queryKey:["profileChanges",i],queryFn:async()=>t.get("tags/profile-diff",{params:i}),...r});return{isFetchingProfileChanges:l,isPendingProfileChanges:c,profileChanges:(o==null?void 0:o.data.results)??[],profileChangesCount:(o==null?void 0:o.data.count)??0,refetchProfileChanges:g}},d=10,$="_pagination_1kb8s_1",y="_inner_1kb8s_10",m={pagination:$,inner:y},v=({onPrev:i,onNext:r,max:t,current:o})=>e.jsx("div",{className:m.pagination,children:e.jsxs("div",{className:m.inner,children:[e.jsx(a.Button,{className:"u-no-margin--right u-no-margin--bottom",appearance:"base",hasIcon:!0,onClick:i,disabled:o<=1,"aria-label":"Previous page",children:e.jsx(a.Icon,{name:"chevron-left"})}),e.jsxs("span",{children:["Page ",o," of ",t]}),e.jsx(a.Button,{className:"u-no-margin--bottom",appearance:"base",hasIcon:!0,onClick:r,disabled:o>=t,"aria-label":"Next page",children:e.jsx(a.Icon,{name:"chevron-right"})})]})}),I=({instances:i,profileChangesCount:r,tags:t,...o})=>{const{count:l,decrement:c,increment:g}=b(1),{isPendingProfileChanges:p,profileChanges:f}=w({instance_ids:i.map(n=>n.id),tags:t,limit:d,offset:(l-1)*d}),P=j.useMemo(()=>[t.length>1?{Header:"Tag",Cell:({row:{original:n}})=>n.tag}:null,{Header:"Active profiles",Cell:({row:{original:n}})=>n.profile.name},{Header:"Profile type",Cell:({row:{original:n}})=>({ChildInstanceProfile:"WSL",PackageProfile:"Package",RebootProfile:"Reboot",RemovalProfile:"Removal",RepositoryProfile:"Repository",ScriptProfile:"Script",UpgradeProfile:"Upgrade",UsgProfile:"Security"})[n.profile.profile_type]},{Header:"Associated instances",Cell:({row:{original:n}})=>{const u=`${n.profile.current_associated_instances} ${s(n.profile.current_associated_instances,"instance")}`;return n.profile.will_exceed_limit?e.jsxs(a.Tooltip,{message:`Adding ${s(i.length,"this instance","these instances")} will exceed the instance limit.`,children:[e.jsx(a.Icon,{name:"warning"}),u]}):u},getCellIcon:({row:{original:n}})=>n.profile.will_exceed_limit?"":null}].filter(n=>n!=null),[]),h=Math.ceil(r/d);return e.jsxs(a.ConfirmationModal,{title:`Add ${s(t.length,`"${t[0]}" tag`,`${t.length} tags`)} to ${s(i.length,`"${i[0].title}"`,`${i.length} instances`)}`,confirmButtonLabel:"Add tags",...o,children:[e.jsx("p",{children:"Adding tags could trigger irreversible changes to your instances."}),e.jsxs("p",{children:["Adding"," ",s(t.length,`the ${t[0]} tag`,`these ${t.length} tags`)," ","to"," ",s(i.length,`the ${i[0].title} instance`,`${i.length} instances`)," ","will associate the ",s(i.length,"instance")," with the following profiles."]}),e.jsx("p",{children:"Some instances might not be associated with certain profiles due to restrictions."}),p?e.jsx(_,{}):e.jsx(a.ModularTable,{className:"u-no-margin--bottom",columns:P,data:f}),h>1&&e.jsx(v,{max:h,current:l,onPrev:c,onNext:g})]})};export{I as T,w as u};
