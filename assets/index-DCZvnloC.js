import{m as j,e as U,n as I,f as k,g as _,j as o,h as a}from"./index-u_EhbhC_.js";import{c as q,a as t,e as v,b as A}from"./index.esm-BQnwAMDD.js";import{S as T}from"./SidePanelFormButtons-xqQ8httV.js";import{M as B}from"./MultiSelectField-ehdSZtl5.js";import{u as C}from"./index-WHwLBsZm.js";import"./SidePanelFormButtons.module-yv6Qz3cN.js";import"./EmptyState-BqInhbHc.js";import"./TablePagination-B-hCaI46.js";import"./TablePagination.module-CgQ3jx4B.js";import"./usePageParams-TkE3cuN_.js";import"./PageMain-CmLgxdJK.js";import"./useMutation-CrcSbzv3.js";import"./useConfirm-B8tJ1H3c.js";import"./helpers-BrQYpof6.js";import"./HeaderWithSearch-8K0RDNyY.js";import"./NoData-BfY2RoAl.js";const M=({user:i})=>{const{instanceId:h}=j(),g=U(),{notify:b}=I(),{closeSidePanel:P}=k(),{editUserQuery:w,getGroupsQuery:y,getUserGroupsQuery:f,addUserToGroupQuery:G,removeUserFromGroupQuery:x}=C(),u=Number(h),{data:m,isLoading:V}=y({computer_id:u}),{data:d}=f({username:i.username,computer_id:u}),{mutateAsync:F}=w,{mutateAsync:N}=G,{mutateAsync:S}=x,p=((m==null?void 0:m.data.groups)??[]).map(r=>({label:r.name,value:String(r.gid)})),l=(d==null?void 0:d.data.groups.map(r=>String(r.gid)))||[],e=_({initialValues:{name:i.name??"",username:i.username,password:"",confirmPassword:"",location:i.location??"",homePhoneNumber:i.home_phone??"",workPhoneNumber:i.work_phone??"",primaryGroupValue:String(i.primary_gid),additionalGroupValue:l},validationSchema:q().shape({username:t().required("This field is required"),name:t(),password:t(),confirmPassword:t().when("password",([r],n)=>r&&r.length>0?n.trim().required("Confirm passphrase is required").oneOf([v("password"),""],"Passphrases must match"):n.notRequired()),location:t(),homePhoneNumber:t(),workPhoneNumber:t(),primaryGroupValue:t().required("This field is required"),additionalGroupValue:A().of(t())}),onSubmit:async r=>{const n=r.additionalGroupValue.filter(s=>!l.includes(s)),c=l.filter(s=>!r.additionalGroupValue.includes(s));try{const s=[];n.length&&s.push(N({computer_id:u,groupnames:n,usernames:[r.username],action:"add"})),c.length&&s.push(S({computer_id:u,groupnames:c,usernames:[r.username],action:"remove"})),s.push(F({computer_ids:[u],name:r.name,username:r.username,password:r.password,location:r.location,home_phone:r.homePhoneNumber,work_phone:r.workPhoneNumber,primary_groupname:r.primaryGroupValue})),await Promise.all(s),P(),b.success({message:"User updated successfully"})}catch(s){g(s)}}});return o.jsxs(a.Form,{onSubmit:e.handleSubmit,noValidate:!0,name:"edit-user",children:[o.jsx(a.Input,{type:"text",label:"Username",required:!0,autoComplete:"new-username",error:e.touched.username&&e.errors.username?e.errors.username:void 0,...e.getFieldProps("username")}),o.jsx(a.Input,{type:"text",label:"Name",error:e.touched.name&&e.errors.name?e.errors.name:void 0,...e.getFieldProps("name")}),o.jsx(a.Input,{type:"password",label:"Passphrase",autoComplete:"new-password",error:e.touched.password&&e.errors.password?e.errors.password:void 0,...e.getFieldProps("password")}),o.jsx(a.Input,{type:"password",label:"Confirm passphrase",autoComplete:"new-password",error:e.touched.confirmPassword&&e.errors.confirmPassword?e.errors.confirmPassword:void 0,...e.getFieldProps("confirmPassword")}),o.jsx(a.Select,{"data-testid":"primaryGroupValue",label:"Primary Group",required:!0,disabled:V,options:p,...e.getFieldProps("primaryGroupValue"),error:e.touched.primaryGroupValue&&e.errors.primaryGroupValue?e.errors.primaryGroupValue:void 0}),o.jsx(B,{variant:"condensed",placeholder:"Select groups",label:"Additional Groups",items:p,selectedItems:p.filter(({value:r})=>e.values.additionalGroupValue.includes(r)),onItemsUpdate:r=>{e.setFieldValue("additionalGroupValue",r.map(({value:n})=>n))},error:e.touched.additionalGroupValue&&(Array.isArray(e.errors.additionalGroupValue)?e.errors.additionalGroupValue.join(", "):e.errors.additionalGroupValue)||void 0}),o.jsx(a.Input,{type:"text",label:"Location",error:e.touched.location&&e.errors.location?e.errors.location:void 0,...e.getFieldProps("location")}),o.jsx(a.Input,{type:"text",label:"Home phone",error:e.touched.homePhoneNumber&&e.errors.homePhoneNumber?e.errors.homePhoneNumber:void 0,...e.getFieldProps("homePhoneNumber")}),o.jsx(a.Input,{type:"text",label:"Work phone",error:e.touched.workPhoneNumber&&e.errors.workPhoneNumber?e.errors.workPhoneNumber:void 0,...e.getFieldProps("workPhoneNumber")}),o.jsx(T,{submitButtonDisabled:e.isSubmitting,submitButtonText:"Save changes"})]})},oe=M;export{oe as default};
