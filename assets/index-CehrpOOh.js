const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D0phTWzz.js","assets/index-xYBbIcB9.js","assets/index-QfA8j4AK.css","assets/useRoles-BxJBQmFk.js","assets/useFetchOld-BU5n9LWB.js","assets/AccessGroupBlock-C_YrwAx5.js","assets/AccessGroupBlock-BYZHjcgZ.css","assets/SidePanelFormButtons-CFvJziO0.js","assets/SidePanelFormButtons.module-tJTvEwdD.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/PageMain-Ns2BZnnp.js","assets/PageMain--v5xNZ5p.css","assets/TruncatedCell-DYWKTapm.js","assets/TruncatedCell-CoXbu3VM.css","assets/index-C9Zwkyfs.js"])))=>i.map(i=>d[i]);
import{p as _,f as g,j as n,g as p,r as m,n as f,_ as h,U as y,E as R}from"./index-xYBbIcB9.js";import{P,a as A,b as I}from"./PageMain-Ns2BZnnp.js";import{u as x}from"./useRoles-BxJBQmFk.js";import{T as w}from"./TruncatedCell-DYWKTapm.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new t.Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="c525fdfb-5414-4e9c-986d-d085134cae00",t._sentryDebugIdIdentifier="sentry-dbid-c525fdfb-5414-4e9c-986d-d085134cae00")}catch{}const D="_bold_nffzr_1",E={bold:D},T=m.lazy(()=>h(()=>import("./index-D0phTWzz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),C=({role:t})=>{const e=_(),{setSidePanelContent:s}=g(),{removeRoleQuery:o}=x(),{mutateAsync:a,isPending:r}=o,i=async c=>{try{await a({name:c})}catch(d){e(d)}},l=c=>{s(`Edit "${c.name}" role`,n.jsx(m.Suspense,{fallback:n.jsx(f,{}),children:n.jsx(T,{role:c})}))};return n.jsxs("div",{className:"divided-blocks",children:[n.jsx("div",{className:"divided-blocks__item",children:n.jsx(p.Tooltip,{message:"Edit",position:"top-center",children:n.jsx(p.Button,{small:!0,hasIcon:!0,type:"button",appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Edit ${t.name} role`,onClick:()=>l(t),children:n.jsx(p.Icon,{name:"edit",className:"u-no-margin--left"})})})}),n.jsx("div",{className:"divided-blocks__item",children:n.jsx(p.ConfirmationButton,{className:"u-no-margin--bottom u-no-padding--left is-small has-icon",type:"button",appearance:"base","aria-label":`Delete ${t.name} role`,confirmationModalProps:{title:`Remove '${t.name}' role`,children:n.jsxs("p",{children:[n.jsx("span",{children:`This will remove '${t.name}' role.`}),t.persons.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("br",{}),n.jsx("span",{className:E.bold,children:`This will affect ${t.persons.length} administrator${t.persons.length===1?"":"s"}`})]})]}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:r,confirmButtonLoading:r,onConfirm:()=>i(t.name)},children:n.jsx(p.Tooltip,{position:"top-center",message:"Delete",children:n.jsx(p.Icon,{name:p.ICONS.delete})})})})]})},S=t=>t.reduce((e,{global:s,name:o,title:a})=>{if(o==="RemoveComputerFromAccessGroup")return e;const r=/view/i.test(o)?"view":"manage",i=o==="AddComputerToAccessGroup"?"access group":a.replace(/(view|manage) /i,"").replace(/computer/i,"instance"),l=e.find(({label:c})=>c===i)||{global:s,label:i,values:{manage:"",view:""}};return l.values[r]=o,[...e.filter(({label:c})=>c!==i),l]},[]),Y=t=>{const e={maxDepth:0,options:t.filter(s=>s.parent==="").map(({name:s,title:o})=>({children:[],depth:0,label:o,parents:[],value:s}))};for(;e.maxDepth>=0;){const s=e.options.filter(({depth:a})=>a===e.maxDepth);e.maxDepth++;const o=t.filter(({parent:a})=>s.some(({value:r})=>r===a));if(o.length===0)break;for(const{name:a,parent:r,title:i}of o){const l=s.find(({value:d})=>d===r);if(!l)continue;const c=[r,...l.parents];e.options.push({children:[],depth:e.maxDepth,label:i,parents:c,value:a});for(const d of c)e.options.filter(({value:u})=>u===d)[0].children.push(a)}}return e.options},j=(t,e,s)=>s.filter(o=>o.depth===e).filter(({value:o})=>t.includes(o))[0].value,J=t=>t.sort((e,s)=>{if(e.children.includes(s.value))return-1;if(s.children.includes(e.value))return 1;for(let o=0;o<Math.min(e.depth,s.depth);o++){const a=j(e.parents,o,t),r=j(s.parents,o,t);if(a!==r)return a.localeCompare(r)}return e.value.localeCompare(s.value)}),K=(t,e)=>{const s=Math.max(...e.map(({depth:a})=>a)),o=t;if(t.length>0)for(let a=0;a<s;a++){const r=e.filter(({depth:i})=>i===a).filter(({value:i})=>t.includes(i));for(const i of r)if(i.children.every(l=>t.includes(l))){const l=t.filter(c=>!i.children.includes(c));t.splice(0,t.length,...l)}}return o},O="_actions_i10lf_1",N="_expandedRow_i10lf_6",k="_expandedCell_i10lf_11",b={actions:O,expandedRow:N,expandedCell:k},v=(t,e,s)=>{const o=t.global_permissions?[...t.permissions,...t.global_permissions]:t.permissions,a=[...new Set(o.filter(r=>s==="manage"?!/(view|remove)/i.test(r):!/(remove)/i.test(r)&&!e.find(({values:i})=>i.manage===r&&!i.view)).map(r=>{var i;return((i=e.find(({values:l})=>s==="manage"?l.manage===r:l.view===r||l.manage===r))==null?void 0:i.label)??""}))];return a.length===0?"":a.length!==e.filter(({values:r})=>!!r[s]).length?a.map((r,i)=>i>0?r:r.replace(/^\w/,l=>l.toUpperCase())).join(", "):"All properties"},L=t=>({column:e,row:{index:s}})=>{const o={};return(t==null?void 0:t.rowIndex)===s&&t.columnId===e.id&&(o.className=b.expandedCell),e.id==="name"?o.role="rowheader":e.id==="persons"?o["aria-label"]="Administrators":e.id==="view"?o["aria-label"]="View permissions":e.id==="manage"?o["aria-label"]="Manage permissions":e.id==="actions"&&(o["aria-label"]="Actions"),o},B=t=>({index:e})=>{const s={};return t===e&&(s.className=b.expandedRow),s},M=t=>e=>{e&&(t.current=[...e.querySelectorAll("tbody tr")])},$=({roleList:t})=>{const[e,s]=m.useState(null),{getPermissionsQuery:o}=x(),a=m.useRef([]);y({current:e?a.current[e.rowIndex]:null},()=>s(null));const{data:r}=o(),i=r?S(r.data):[],l=m.useMemo(()=>t,[t]),c=m.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"persons",Header:"Administrators",Cell:({row:d})=>d.original.persons.length},{accessor:"view",Header:"View",Cell:({row:{original:d,index:u}})=>n.jsx(w,{content:v(d,i,"view"),isExpanded:(e==null?void 0:e.rowIndex)===u&&e.columnId==="view",onExpand:()=>s({rowIndex:u,columnId:"view"})})},{accessor:"manage",Header:"Manage",Cell:({row:{original:d,index:u}})=>n.jsx(w,{content:v(d,i,"manage"),isExpanded:(e==null?void 0:e.rowIndex)===u&&e.columnId==="manage",onExpand:()=>s({rowIndex:u,columnId:"manage"})})},{accessor:"actions",className:b.actions,Cell:({row:{original:d}})=>d.name!=="GlobalAdmin"?n.jsx(C,{role:d}):null}],[l,r,e]);return n.jsx("div",{ref:M(a),children:n.jsx(p.ModularTable,{columns:c,data:l,getCellProps:L(e),getRowProps:B(e==null?void 0:e.rowIndex)})})},F=m.lazy(()=>h(()=>import("./index-C9Zwkyfs.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,8,9,10,11,12,13]))),H=()=>{const{setSidePanelContent:t}=g(),{getRolesQuery:e}=x(),{data:s,isLoading:o}=e();return n.jsxs(n.Fragment,{children:[o&&n.jsx(f,{}),!o&&(!s||!s.data.length)&&n.jsx(R,{title:"No roles found",body:n.jsxs(n.Fragment,{children:[n.jsx("p",{className:"u-no-margin--bottom",children:"You havenâ€™t added any roles yet."}),n.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[n.jsx(p.Button,{type:"button",appearance:"positive",onClick:()=>t("Add role",n.jsx(m.Suspense,{fallback:n.jsx(f,{}),children:n.jsx(F,{})})),children:"Add role"},"add")]}),!o&&s&&s.data.length>0&&n.jsx($,{roleList:s.data})]})},Q=m.lazy(()=>h(()=>import("./index-C9Zwkyfs.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,8,9,10,11,12,13]))),z=()=>{const{setSidePanelContent:t}=g(),e=()=>{t("Add Role",n.jsx(m.Suspense,{fallback:n.jsx(f,{}),children:n.jsx(Q,{})}))};return n.jsxs(P,{children:[n.jsx(A,{title:"Roles",actions:[n.jsx(p.Button,{type:"button",onClick:e,appearance:"positive",children:"Add role"},"add-role")]}),n.jsx(I,{children:n.jsx(H,{})})]})},W=Object.freeze(Object.defineProperty({__proto__:null,default:z},Symbol.toStringTag,{value:"Module"}));export{S as a,J as b,Y as c,K as g,W as i};
