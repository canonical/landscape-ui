const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cj9k5cyK.js","assets/index-CNysL-N9.js","assets/index-CeZ3lspp.css","assets/MultiSelectField-kqdVKOgL.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-M1anpLEA.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/TagsAddConfirmationModal-Dl0kELem.js","assets/TagsAddConfirmationModal-HDr0Q-Wm.css","assets/useGetTags-Do6lDDEf.js","assets/useRoles-DskEo6KR.js","assets/AssociationBlock-DQBJa-xL.css","assets/index-CzjtJ8xI.js","assets/ScriptsTabs-Bh6lIh7z.js","assets/HeaderWithSearch-CvedKTiw.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-DFOXV98U.js","assets/useExpandableRow-DxiOSS1-.js","assets/ScriptsTabs-DN44MVZt.css","assets/DeliveryBlock-PG1aKZNC.js","assets/DeliveryBlock-VExRkUer.css","assets/ScriptDropdown-WhG9lUJx.js","assets/downshift.esm-NCfJqLaf.js","assets/ScriptDropdown-Wdg9HaWt.css","assets/index-CqAoGR2A.js","assets/CodeEditor-B8ypm5kk.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-BRIdia8p.js","assets/AttachmentFile-DesTEaPa.js","assets/AttachmentFile-B_HSPNHl.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-BH4W5S1x.js","assets/AutoinstallFileVersionHistory-CI7mysYb.js","assets/SidePanelTablePagination-CiKesZiF.js","assets/AutoinstallFileVersionHistory-D9A9QiBO.css","assets/EmployeeList-DQbEg6gQ.js","assets/EmployeeList-BQrbbWYX.css","assets/useGetEmployees-3AZP353b.js","assets/InstanceRemoveFromLandscapeModal-BOZEvTxX.js","assets/useRemoveInstancesFromLandscape-DMxb7EIB.js","assets/WslInstancesEmptyState-BImifQ_s.js","assets/GroupFilter-BzYr0gmU.js","assets/WslInstancesEmptyState-CanINxhB.css","assets/index-0uuPVSHU.css"])))=>i.map(i=>d[i]);
import{i as h,j as e,o as T,d as t,aK as ue,b as me,g as pe,a as W,G as he,at as ge,H as xe,J as be,A as w,p as je,X as _e,q as fe,n as ve,a5 as ye,aL as Ce,aM as Ie,a4 as y,s as we,v as k,aD as m,I as n,aN as q,D as G,N as p,t as U,ac as Se,a2 as D}from"./index-CNysL-N9.js";import{C as Re}from"./AutoinstallFileVersionHistory-CI7mysYb.js";import"./index-DFOXV98U.js";import"./EmployeeList-DQbEg6gQ.js";import{u as Ae,I as Fe}from"./InstanceRemoveFromLandscapeModal-BOZEvTxX.js";import{u as ke}from"./useRoles-DskEo6KR.js";import{h as ze,i as Me}from"./WslInstancesEmptyState-BImifQ_s.js";const Ee="_container_pgwx9_1",Ne="_innerContainer_pgwx9_9",Le="_button_pgwx9_13",L={container:Ee,innerContainer:Ne,button:Le},Te=({actions:{destructive:s=[],nondestructive:l=[]}})=>{s=s.filter(i=>!i.excluded),l=l.filter(i=>!i.excluded);const a=[...l,...s],b={nondestructive:[],destructive:[]},[_,j]=h.useState(a),[g,f]=h.useState(b),[z,S]=h.useState(!1),[R,M]=h.useState(0),I=l.filter(i=>i.collapsed).length+s.filter(i=>i.collapsed).length>1,A=(i,x)=>{if(g.destructive.length||g.nondestructive.length)return;if((!i.lastElementChild||i.lastElementChild.getBoundingClientRect().right<=x.getBoundingClientRect().right)&&!I){S(!1);return}S(!0);const u=[],c={nondestructive:[],destructive:[]};l.forEach((d,v)=>{i.children[v].getBoundingClientRect().right>i.getBoundingClientRect().right||d.collapsed&&I?c.nondestructive.push(d):u.push(d)}),s.forEach((d,v)=>{v+=l.length,i.children[v].getBoundingClientRect().right>i.getBoundingClientRect().right||d.collapsed&&I?c.destructive.push(d):u.push(d)}),j(u),f(c)},E=i=>{const x=i?.parentElement?.parentElement;if(!x)return;A(i,x);const u=new ResizeObserver(()=>{const{width:c}=x.getBoundingClientRect();c!==R&&(j(a),f(b),M(c))});return u.observe(x),()=>{u.disconnect()}};return e.jsxs("div",{className:L.container,children:[e.jsx("div",{className:T(L.innerContainer,"p-segmented-control"),children:e.jsx("div",{ref:E,className:"p-segmented-control__list",children:_.map(({collapsed:i,excluded:x,icon:u,label:c,...d})=>e.jsxs(t.Button,{className:T(L.button,"u-no-margin--bottom p-segmented-control__button"),...d,children:[e.jsx(t.Icon,{name:u}),e.jsx("span",{children:c})]},c))})}),z&&e.jsx(ue,{hasToggleIcon:!0,toggleLabel:_.length?"More actions":"Actions",toggleClassName:"u-no-margin--bottom",toggleDisabled:[...s,...l].every(i=>i.disabled),actions:g.nondestructive,destructiveActions:g.destructive})]})},De=(s,l={})=>{const a=me(),{id:b,..._}=s,{data:j,isPending:g,isLoading:f}=pe({queryKey:["employee",s],queryFn:async()=>a.get(`employees/${b}`,{params:_}),...l});return{employee:j?.data,isLoading:f,isPending:g}},Be=({profiles:s})=>{const{isFeatureEnabled:l}=W();return l("script-profiles")||(s=s.filter(a=>a.type!=="script")),l("usg-profiles")||(s=s.filter(a=>a.type!=="security")),l("wsl-child-instance-profiles")||(s=s.filter(a=>a.type!=="wsl")),s.map((a,b)=>e.jsxs("span",{children:[a.title,b<s.length-1?", ":""]},`${a.type}${a.id}`))},Oe={deliver_after:"",deliverImmediately:!0,action:null},Pe=he().shape({deliver_after:be().when("deliverImmediately",{is:!1,then:s=>s.required("This field is required").test({message:"Invalid date",test:l=>w(l).isValid()}).test({message:"Date must be in the future",test:l=>w(l).isAfter()})}),deliverImmediately:xe(),action:ge().oneOf(["shutdown","reboot"]).required()}),Ve="_titleRow_b58e9_1",$e="_headerContainer_b58e9_9",qe="_status_b58e9_14",Ge="_heading_b58e9_20",Ue="_block_b58e9_24",C={titleRow:Ve,headerContainer:$e,status:qe,heading:Ge,block:Ue},We=h.lazy(async()=>D(()=>import("./index-Cj9k5cyK.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),He=h.lazy(async()=>D(()=>import("./index-CzjtJ8xI.js"),__vite__mapDeps([13,14,1,2,11,15,16,17,18,19,20,21,5,6,7,22,23,24,25,26,27,28,29,30,31,32,33])).then(s=>({default:s.RunInstanceScriptForm}))),Qe=h.lazy(async()=>D(()=>import("./index-BH4W5S1x.js"),__vite__mapDeps([34,1,2,5,6,7,19,35,15,16,36,37,38,39,25,40,41,42,11,43,44,20,45,46]))),Ye=({instance:s})=>{const{isFeatureEnabled:l}=W(),a=je(),b=_e(),{notify:_}=fe(),{setSidePanelContent:j}=ve(),{openActivityDetails:g}=ye(),{employee:f,isLoading:z}=De({id:s.employee_id},{enabled:!!s.employee_id}),{restartInstances:S,isRestartingInstances:R}=Ce(),{getAccessGroupQuery:M}=ke(),{sanitizeInstance:I,isSanitizingInstance:A}=Ae(),{shutDownInstances:E,isShuttingDownInstances:i}=Ie(),{value:x,setTrue:u,setFalse:c}=y(),{value:d,setTrue:v,setFalse:H}=y(),{value:Q,setTrue:Y,setFalse:K}=y(),{value:J,setTrue:X,setFalse:Z}=y(),{value:ee,setTrue:se,setFalse:te}=y(),{value:ie,setTrue:le,setFalse:B}=y(),{data:O,isPending:ae}=M(),r=we({initialValues:Oe,validationSchema:Pe,onSubmit:async o=>{if(!o.action)return;const V={computer_ids:[s.id],deliver_after:o.deliverImmediately?void 0:`${o.deliver_after}:00Z`};try{const{data:N}=o.action==="reboot"?await S(V):await E(V),$=o.action==="reboot"?"restarted":"shut down";_.success({title:`You queued "${s.title}" to be ${$}`,message:`Instance "${s.title}" will be ${$} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{g(N)}}]})}catch(N){a(N)}}});if(ae||z)return e.jsx(k,{});const oe=async()=>{try{const{data:o}=await I({computer_id:s.id,computer_title:s.title});_.success({title:`You have successfully marked ${s.title} to be sanitized.`,message:"An activity has been queued to sanitize it. The data will be permanently irrecoverable once complete.",actions:[{label:"View details",onClick:()=>{g(o)}}]})}catch(o){a(o)}finally{B()}},ne=()=>{j("Edit instance",e.jsx(h.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(We,{instance:s})}))},re=()=>{j("Run script",e.jsx(h.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(He,{parentAccessGroup:s.access_group,query:`id:${s.id}`})}))},ce=()=>{j(`Associate employee with ${s.title}`,e.jsx(h.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(Qe,{instanceTitle:s.title,employeeId:s.employee_id})}))},F=async o=>{await r.setFieldValue("action",o),r.handleSubmit()},P=()=>{b("/instances",{replace:!0})},de=O?O.data:[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:C.titleRow,children:[e.jsxs("div",{className:C.headerContainer,children:[e.jsx("h2",{className:T("p-heading--4 u-no-padding--top",C.heading),children:s.title}),s.is_wsl_instance&&e.jsx(Re,{value:"WSL instance"})]}),e.jsx(Te,{actions:{nondestructive:[{icon:"edit",label:"Edit",onClick:ne},{icon:"restart",label:"Restart",onClick:u,excluded:!m(s).power},{icon:"power-off",label:"Shut down",onClick:v,excluded:!m(s).power},{icon:"code",label:"Run script",onClick:re,excluded:!m(s).scripts},{icon:t.ICONS.user,label:"Associate employee",onClick:ce,collapsed:!0,excluded:!l("employee-management")||!m(s).employees}],destructive:[{icon:"restart",label:"Reinstall",onClick:Y,collapsed:!0,excluded:!m(s).uninstallation},{icon:"close",label:"Uninstall",onClick:X,collapsed:!0,excluded:!m(s).uninstallation},{icon:t.ICONS.delete,label:"Remove from Landscape",onClick:se,collapsed:!0},{icon:"tidy",label:"Sanitize",onClick:le,collapsed:!0,excluded:!m(s).sanitization}]}})]}),e.jsxs("section",{children:[e.jsx("h5",{className:"u-no-margin--bottom",children:"Instance status"}),e.jsxs(t.Row,{className:"u-no-padding u-no-margin",children:[e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Status",value:e.jsxs("div",{className:C.status,children:[e.jsx(t.Icon,{name:q(s).icon??""}),e.jsx("span",{children:q(s).label})]})})}),e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Last ping time",value:w(s.last_ping_time).isValid()?w(s.last_ping_time).format(G):e.jsx(p,{})})}),e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Access group",value:de.find(o=>o.name===s.access_group)?.title||s.access_group})})]}),e.jsxs(t.Row,{className:"u-no-padding u-no-margin",children:[e.jsx(t.Col,{size:3,children:e.jsx(n,{type:"truncated",label:"Profiles",value:s.profiles?.length?e.jsx(Be,{profiles:s.profiles}):e.jsx(p,{})})}),m(s).employees&&l("employee-management")&&e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Associated employee",value:f?f.name:e.jsx(p,{})})})]})]}),e.jsxs("section",{className:C.block,children:[e.jsx("h5",{children:"Registration details"}),e.jsxs(t.Row,{className:"u-no-padding u-no-margin",children:[e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Hostname",value:s.hostname??e.jsx(p,{})})}),e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Instance ID",value:s.id})}),m(s).hardware&&e.jsxs(e.Fragment,{children:[e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Serial number",value:s.grouped_hardware?.system.serial??e.jsx(p,{})})}),e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Product identifier",value:s.grouped_hardware?.system.model??e.jsx(p,{})})})]})]}),e.jsxs(t.Row,{className:"u-no-padding u-no-margin",children:[e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"OS",value:s.distribution_info?s.distribution_info.description:e.jsx(p,{})})}),m(s).hardware&&e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"IP addresses",type:"truncated",value:Array.isArray(s.grouped_hardware?.network)?s.grouped_hardware.network.map(o=>o.ip).join(", "):e.jsx(p,{})})}),e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Registered",value:w(s.registered_at).format(G)})})]})]}),e.jsxs("section",{className:C.block,children:[e.jsx("h5",{children:"Other"}),e.jsxs(t.Row,{className:"u-no-padding u-no-margin",children:[e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Annotations",value:e.jsx(p,{})})}),e.jsx(t.Col,{size:3,children:e.jsx(n,{label:"Comment",value:s.comment||e.jsx(p,{})})})]})]}),x&&e.jsx(t.ConfirmationModal,{close:c,title:"Restart instance",confirmButtonLabel:"Restart",confirmButtonAppearance:"positive",confirmButtonDisabled:R,confirmButtonLoading:R,onConfirm:async()=>F("reboot"),children:e.jsxs(t.Form,{onSubmit:async()=>F("reboot"),noValidate:!0,children:[e.jsx(t.CheckboxInput,{label:"Deliver as soon as possible",...r.getFieldProps("deliverImmediately"),checked:r.values.deliverImmediately}),e.jsx(t.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...r.getFieldProps("deliver_after"),disabled:r.values.deliverImmediately,error:U(r,"deliver_after")}),e.jsxs("p",{children:['This will restart "',s.title,'" instance.']})]})}),d&&e.jsx(t.ConfirmationModal,{close:H,title:"Shut down instance",confirmButtonLabel:"Shut down",confirmButtonAppearance:"positive",confirmButtonDisabled:i,confirmButtonLoading:i,onConfirm:async()=>F("shutdown"),children:e.jsxs(t.Form,{onSubmit:async()=>F("shutdown"),noValidate:!0,children:[e.jsx(t.CheckboxInput,{label:"Deliver as soon as possible",...r.getFieldProps("deliverImmediately"),checked:r.values.deliverImmediately}),e.jsx(t.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...r.getFieldProps("deliver_after"),disabled:r.values.deliverImmediately,error:U(r,"deliver_after")}),e.jsxs("p",{children:['This will shut down "',s.title,'" instance.']})]})}),s.is_wsl_instance&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{close:K,instances:[{name:s.title,computer_id:s.id}],isOpen:Q,windowsInstance:s}),e.jsx(Me,{close:Z,instances:[{name:s.title,computer_id:s.id}],isOpen:J,onSuccess:P,parentId:s.parent.id})]}),e.jsx(Fe,{close:te,instances:[s],isOpen:ee,onSuccess:P}),e.jsx(Se,{isOpen:ie,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:A,confirmButtonLoading:A,onConfirm:oe,close:B,confirmationText:`sanitize ${s.title}`,title:"Sanitize instance",children:e.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",s.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})},ls=Object.freeze(Object.defineProperty({__proto__:null,default:Ye},Symbol.toStringTag,{value:"Module"}));export{ls as i,De as u};
