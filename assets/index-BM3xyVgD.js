const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-0mVGJOyq.js","assets/index-CXV5jfcW.js","assets/index-Dkc_mJ0y.css","assets/SidePanelTablePagination-Bh6o_G1J.js","assets/ScriptsTabs-PF0l9IlK.js","assets/useRoles-BTRYX2Wm.js","assets/HeaderWithSearch-B7q8XaMz.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-Dih-U9Ex.js","assets/useExpandableRow-Bll095V0.js","assets/ScriptsTabs-DN44MVZt.css","assets/index-BwtZ1ers.css","assets/index-y5VUI0c3.js","assets/AssociationBlock-CocgMUVg.js","assets/MultiSelectField-DlwH4eRc.js","assets/MultiSelectField-GyNA33om.css","assets/useInstances-BTl_86ur.js","assets/AssociationBlock-DQBJa-xL.css","assets/SidePanelFormButtons-DZdKjurL.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/ScriptDropdown-BmKIbH3e.js","assets/downshift.esm-DaL4JUTQ.js","assets/ScriptDropdown-B5XgtP-0.css","assets/index-DSprvPeY.css","assets/index-vvTyTXgR.js","assets/DeliveryBlock-DQcBUdEd.js","assets/DeliveryBlock-VExRkUer.css","assets/index-CuwoqBPp.js","assets/CodeEditor-BgydS_qe.js","assets/CodeEditor-CwlLRp3p.css","assets/ScriptFormAttachments-CiiitO5a.js","assets/AttachmentFile-CZswgLy6.js","assets/AttachmentFile-Br6SRBhg.css","assets/ScriptFormAttachments-DoEC9DUJ.css"])))=>i.map(i=>d[i]);
import{i as S,f as N,g as O,h as F,c as H,au as W,r as g,B as L,j as e,a7 as K,N as j,aD as V,x as J,k as q,ah as Q,n as y,L as Z,w as A,D as X,ap as tt,aq as et,p as h,a5 as b,a0 as C,at as st,ao as it,av as rt,E as $}from"./index-CXV5jfcW.js";import{H as nt}from"./HeaderWithSearch-B7q8XaMz.js";import{u as at}from"./ScriptsTabs-PF0l9IlK.js";import"./index-Dih-U9Ex.js";const ot=()=>{const t=S(),s=N(),{isPending:a,mutateAsync:o}=O({mutationFn:async n=>t.post("script-profiles",n),onSuccess:async()=>s.invalidateQueries({queryKey:["scriptProfiles"]})});return{isAddingScriptProfile:a,addScriptProfile:o}},ct=()=>{const t=S(),s=N(),{isPending:a,mutateAsync:o}=O({mutationFn:async({id:n})=>t.post(`script-profiles/${n}:archive`),onSuccess:async()=>s.invalidateQueries({queryKey:["scriptProfiles"]})});return{isArchivingScriptProfile:a,archiveScriptProfile:o}},lt=()=>{const t=S(),s=N(),{isPending:a,mutateAsync:o}=O({mutationFn:async({id:n,...u})=>t.patch(`script-profiles/${n}`,u),onSuccess:async()=>s.invalidateQueries({queryKey:["scriptProfiles"]})});return{isEditingScriptProfile:a,editScriptProfile:o}},ut=()=>{const t=S(),{data:s,isLoading:a}=F({queryKey:["scriptProfileLimits"],queryFn:async()=>t.get("script-profile-limits")});return{scriptProfileLimits:(s==null?void 0:s.data)??null,isGettingScriptProfileLimits:a}},dt={listenToUrlParams:!0},k=(t,s)=>{const a=S(),{currentPage:o,pageSize:n,status:u,search:c}=H();t={...dt,...t};const i={...t.listenToUrlParams?{limit:n,offset:(o-1)*n,search:c??void 0,archived:u||"active"}:s},{data:l,isLoading:_}=F({queryKey:["scriptProfiles",i],queryFn:async()=>a.get("script-profiles",{params:i})});return{scriptProfiles:(l==null?void 0:l.data.results)??[],scriptProfilesCount:(l==null?void 0:l.data.count)??0,isGettingScriptProfiles:_}},pt=(t,s={enabled:!0})=>{const a=S(),{data:o,isPending:n}=F({queryKey:["scriptProfiles","single",t],queryFn:async()=>a.get(`script-profiles/${t.id}`),...s});return{scriptProfile:o==null?void 0:o.data,isGettingScriptProfile:n}},m={MINUTE:{min:0,max:59},HOUR:{min:0,max:23},DAY_OF_MONTH:{min:1,max:31},MONTH:{min:1,max:12},DAY_OF_WEEK:{min:0,max:6}},mt=t=>{switch(t%100){case 11:case 12:case 13:return"th"}switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},gt=t=>`${t}${mt(t)}`,E=(t,s)=>s?s.labels[s.offset?t-s.offset:t]:t,G=(t,s)=>t.start==s.min&&t.end==s.max&&t.step==1,v=(t,s,a,o,n)=>{let u="";if(t.some(i=>G(i,s)))return u;o&&(u+=` ${o} `);const c=t.map(i=>{let l="";return(i.step>1||i.start!=i.end)&&(l+="every "),i.step>1&&(l+=`${gt(i.step)} `),i.start!=i.end||i.step>1?(l+=a,(i.start!=s.min||i.end!=s.max)&&(l+=` from ${E(i.start,n)} through ${E(i.end,n)}`)):n?l+=E(i.start,n):l+=`${a} ${i.start}`,l});return u+=c.slice(0,-1).join(", "),c.length>2&&(u+=","),c.length>1&&(u+=" and "),u+=c.slice(-1),u},w=t=>{const s=parseFloat(t);if(!Number.isSafeInteger(s))throw new Error("Invalid value.");return s},x=(t,s,a={})=>t.split(",").map(o=>{const n={start:Number.NaN,end:Number.NaN,step:1},u=c=>{if(c=="*"){n.start=s.min,n.end=s.max;return}if(c=c.replaceAll(/[a-zA-Z]+/g,i=>{const l=a[i.toUpperCase()];if(!l)throw new Error("Invalid character.");return l}),c.includes("-")){const[i,l]=c.split("-").map(w);if(l<i)throw new Error("The end of a range must not be less than the start.");n.start=i,n.end=l}else{const i=w(c);n.start=i,n.end=i}};if(o.includes("/")){const[c,i]=o.split("/");n.step=w(i),u(c)}else u(o);if(n.start<s.min||n.end>s.max)throw new Error("Value out of range.");return n}),ft=t=>{const[s,a,o,n,u]=t.trim().split(/ +/);if(!s||!a||!o||!n||!u)throw new Error("Enter a complete interval.");const c=x(s,m.MINUTE),i=x(a,m.HOUR),l=x(o,m.DAY_OF_MONTH),_=x(n,m.MONTH,{JAN:"1",FEB:"2",MAR:"3",APR:"4",MAY:"5",JUN:"6",JUL:"7",AUG:"8",SEP:"9",OCT:"10",NOV:"11",DEC:"12"}),r=x(u,m.DAY_OF_WEEK,{SUN:"0",MON:"1",TUE:"2",WED:"3",THU:"4",FRI:"5",SAT:"6"});let d="at ";c.some(T=>G(T,m.MINUTE))&&(d+="every minute"),c.length==1&&c[0].start==c[0].end&&i.length==1&&i[0].start==i[0].end?d+=`${i[0].start.toString().padStart(2,"0")}:${c[0].start.toString().padStart(2,"0")}`:(d+=v(c,m.MINUTE,"minute"),d+=v(i,m.HOUR,"hour","past"));const p=v(l,m.DAY_OF_MONTH,"day-of-month","on");return d+=p,d+=v(r,m.DAY_OF_WEEK,"day-of-week",p?"and on":"on",{labels:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}),d+=v(_,m.MONTH,"month","in",{offset:1,labels:["January","February","March","April","May","June","July","August","September","October","November","December"]}),d},ht=t=>t.archived?"Archived":"Active",Y=t=>{switch(t.trigger.trigger_type){case"event":switch(t.trigger.event_type){case"post_enrollment":return"Post enrollment";default:return}case"one_time":return"On a date";case"recurring":return"Recurring"}},Mt=t=>{switch(t.trigger.trigger_type){case"recurring":return`Recurring, ${ft(t.trigger.interval)}`;default:return Y(t)}};function _t(t){const{state:s}=W(),a=(s==null?void 0:s.scriptProfileId)||0,{scriptProfile:o}=pt({id:a},{enabled:!!a});g.useEffect(()=>{!a||!o||(t(o),window.history.replaceState({},""))},[a,o])}const yt=({profile:t,removeProfile:s})=>{const{notify:a}=L(),{archiveScriptProfile:o,isArchivingScriptProfile:n}=ct(),u=()=>{s()},c=async()=>{await o({...t}),u(),a.success({title:`You have successfully archived "${t.title}"`,message:"The profile will no longer run on the defined schedule."})};return e.jsx(K,{isOpen:!0,title:`Archive ${t.title}`,confirmButtonLabel:"Archive",confirmButtonDisabled:n,confirmButtonLoading:n,onConfirm:c,close:u,confirmationText:`archive ${t.title}`,children:e.jsxs("p",{children:["Archiving the script will prevent it from running in the future.",e.jsx("br",{}),"This action is ",e.jsx("strong",{children:"irreversible"}),"."]})})},St=({scriptProfile:t})=>!t.tags.length&&!t.all_computers?e.jsx(j,{}):t.trigger.trigger_type==="event"&&t.trigger.event_type==="post_enrollment"?e.jsx(j,{}):t.computers.num_associated_computers?e.jsxs(V,{to:{pathname:"/instances",search:`query=${encodeURIComponent(`profile:script:${t.id}`)}`},children:[t.computers.num_associated_computers," ",J(t.computers.num_associated_computers,"instance")]}):"0 instances",Pt="_link_1wvsk_1",vt={link:Pt},xt=g.lazy(async()=>C(()=>import("./index-0mVGJOyq.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),At=g.lazy(async()=>C(()=>import("./index-y5VUI0c3.js"),__vite__mapDeps([14,1,2,15,16,17,18,19,20,21,22,4,5,6,7,8,9,10,11,12,23,24,25,26]))),Tt=({profiles:t})=>{const{notify:s}=L(),{setSidePanelContent:a}=q(),{editScriptProfile:o,isEditingScriptProfile:n}=lt(),[u,c]=g.useState(null),i=r=>({archive:()=>{c(r)},edit:()=>{const d=async p=>{await o({id:r.id,all_computers:p.all_computers,tags:p.tags,time_limit:p.time_limit,title:p.title,trigger:p.trigger,username:p.username})};a(`Edit ${r.title}`,e.jsx(g.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(At,{disabledFields:{script_id:!0,trigger_type:!0},initialValues:{...r,interval:"",...r.trigger,start_after:r.trigger.trigger_type=="recurring"?A(r.trigger.start_after).utc().format(b):"",timestamp:r.trigger.trigger_type=="one_time"?A(r.trigger.timestamp).utc().format(b):""},onSubmit:d,onSuccess:p=>{s.success({title:`You have successfully saved changes for ${p.title}`,message:"The changes will be applied to this profile."})},submitButtonText:"Save changes",submitting:n})}))},viewDetails:()=>{a(r.title,e.jsx(g.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(xt,{actions:i(r),profile:r})}))}});_t(r=>{i(r).viewDetails()});const l=g.useMemo(()=>[{Header:"Name",Cell:({row:{original:r}})=>e.jsx(y.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top u-align-text--left",onClick:i(r).viewDetails,children:r.title})},{Header:"Status",Cell:({row:{original:r}})=>ht(r),getCellIcon:({row:{original:{archived:r}}})=>r?"status-queued-small":"status-succeeded-small"},{Header:"Associated instances",Cell:({row:{original:r}})=>e.jsx(St,{scriptProfile:r})},{Header:"Tags",Cell:({row:{original:r}})=>r.all_computers?"All instances":r.tags.join(", ")||e.jsx(j,{})},{Header:"Trigger",Cell:({row:{original:r}})=>Y(r)},{Header:"Last run",className:"date-cell",Cell:({row:{original:{activities:{last_activity:r}}}})=>r?e.jsxs(Z,{className:`${vt.link} font-monospace`,to:`/activities?query=parent-id%3A${r.id}`,children:[A(r.creation_time).utc().format(X)," "]}):e.jsx(j,{})},{...Q,Cell:({row:{original:r}})=>{const d=[{icon:"switcher-environments",label:"View details",onClick:i(r).viewDetails}];r.archived||d.push({icon:"edit",label:"Edit",onClick:i(r).edit});const p=r.archived?void 0:[{icon:"archive",label:"Archive",onClick:i(r).archive}];return e.jsx(tt,{toggleAriaLabel:`${r.title} script profile actions`,actions:d,destructiveActions:p})}}],[]),_=()=>{c(null)};return e.jsxs(e.Fragment,{children:[e.jsx(et,{columns:l,data:t,emptyMsg:"No script profiles found according to your search parameters.",minWidth:1200}),u&&e.jsx(yt,{profile:u,removeProfile:_})]})},jt="_actions_dhdem_1",bt={actions:jt},U=[{label:"All",value:"all"},{label:"Active",value:""},{label:"Archived",value:"archived"}],Ct=g.lazy(async()=>C(()=>import("./index-vvTyTXgR.js"),__vite__mapDeps([27,4,1,2,5,6,7,8,9,10,11,12,20,21,22,28,29,23,24,25,30,31,32,33,34,35,36])).then(t=>({default:t.CreateScriptForm}))),Et=g.lazy(async()=>C(()=>import("./index-y5VUI0c3.js"),__vite__mapDeps([14,1,2,15,16,17,18,19,20,21,22,4,5,6,7,8,9,10,11,12,23,24,25,26]))),wt=()=>{const{notify:t}=L(),{currentPage:s,pageSize:a,search:o,status:n}=H(),{setSidePanelContent:u}=q(),{scriptsCount:c,isScriptsLoading:i}=at({listenToUrlParams:!1},{script_type:"active",limit:0,offset:0}),{scriptProfiles:l,scriptProfilesCount:_,isGettingScriptProfiles:r}=k(),{addScriptProfile:d,isAddingScriptProfile:p}=ot(),{scriptProfilesCount:T,isGettingScriptProfiles:M}=k({listenToUrlParams:!1},{archived:"active"}),{scriptProfileLimits:P,isGettingScriptProfileLimits:I}=ut(),D=s===1&&a===20&&r;if(M||I||P===null)return e.jsx(h,{});const B=()=>{u("Add script profile",e.jsx(g.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Et,{initialValues:{all_computers:!1,interval:"",start_after:A().utc().format(b),tags:[],time_limit:300,timestamp:A().utc().format(b),title:"",trigger_type:"",username:"root",script:null},onSubmit:async f=>{await d({all_computers:f.all_computers,script_id:f.script_id,tags:f.tags,time_limit:f.time_limit,title:f.title,trigger:f.trigger,username:f.username})},onSuccess:f=>{t.success({title:`You have successfully created ${f.title}`,message:"The profile has been created and associated to the defined instances."})},submitButtonText:"Add profile",submitting:p})}))};if(M||I)return e.jsx(h,{});if(P==null)return;const R=e.jsxs(y.Button,{type:"button",appearance:"positive",onClick:B,className:"u-no-margin--bottom",hasIcon:!0,disabled:T>=P.max_num_profiles,children:[e.jsx(y.Icon,{name:"plus",light:!0}),e.jsx("span",{children:"Add profile"})]});if(l.length||o||n||D)return e.jsxs(e.Fragment,{children:[e.jsx(nt,{actions:e.jsxs("div",{className:bt.actions,children:[e.jsx(st,{label:"Status",options:U}),R]})}),e.jsx(it,{filtersToDisplay:["search","status"],statusOptions:U}),T>=P.max_num_profiles&&e.jsxs(y.Notification,{inline:!0,title:"Profile limit reached:",severity:"caution",children:["You've reached the limit of"," ",P.max_num_profiles," active script profiles. To be able to add new profiles you must archive an active one."]}),D?e.jsx(h,{}):e.jsxs(e.Fragment,{children:[e.jsx(Tt,{profiles:l}),e.jsx(rt,{totalItems:_,currentItemCount:l.length})]})]});if(i)return e.jsx(h,{});const z=()=>{u("Add script",e.jsx(g.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Ct,{})}))};return c?e.jsx($,{title:"You don't have any script profiles yet.",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Script profiles allow you to automate your script runs based on triggers. Triggers can be either a recurring schedule, on a set date, or before or after an event."}),R]})}):e.jsx($,{title:"You need at least one script to add a profile.",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"In order to create a script profile, you need to have added a script to your Landscape organization."}),e.jsxs(y.Button,{type:"button",appearance:"positive",onClick:z,className:"u-no-margin--bottom",hasIcon:!0,children:[e.jsx(y.Icon,{name:"plus",light:!0}),e.jsx("span",{children:"Add script"})]})]})})},It=Object.freeze(Object.defineProperty({__proto__:null,default:wt},Symbol.toStringTag,{value:"Module"}));export{St as S,Mt as a,ht as g,It as i,ft as t,ut as u};
