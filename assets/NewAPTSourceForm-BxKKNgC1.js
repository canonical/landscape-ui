import{i as x,k as G,l as f,m as k,n as o,j as s,h as r}from"./index-DADCH2pl.js";import{u as A}from"./useAPTSources--08ovWEA.js";import{u as v}from"./useGPGKeys-BuAQtKUm.js";import{u as j}from"./useRoles-4uJ-OU-E.js";import{t as n}from"./tests-DFnZqbNV.js";import{S as F}from"./SidePanelFormButtons-CKOmlNzw.js";import"./useFetchOld-CG1Ychvt.js";import"./SidePanelFormButtons.module-yv6Qz3cN.js";const N=()=>{const{closeSidePanel:l}=x(),p=G(),{createAPTSourceQuery:d,getAPTSourcesQuery:m}=A(),{getGPGKeysQuery:g}=v(),{data:i,isLoading:b}=g(),{getAccessGroupQuery:y}=j(),{data:u,isLoading:_}=y(),P=((u==null?void 0:u.data)??[]).map(t=>({label:t.title,value:t.name})),S=((i==null?void 0:i.data)??[]).filter(({has_secret:t})=>t).map(({name:t})=>({label:t,value:t})),{mutateAsync:h}=d,{data:a}=m(),e=f({initialValues:{name:"",apt_line:"",gpg_key:"",access_group:""},validationSchema:k().shape({name:o().required("This field is required").test({test:n.test,message:n.message}).test({params:{getAPTSourcesResponse:a},test:t=>!((a==null?void 0:a.data)??[]).map(({name:c})=>c).includes(t),message:"It must be unique within the account."}),apt_line:o().required("This field is required"),gpg_key:o(),access_group:o()}),onSubmit:async t=>{try{await h(t),l()}catch(c){p(c)}}});return s.jsxs(r.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[s.jsx(r.Input,{type:"text",label:"Name",required:!0,error:e.touched.name&&e.errors.name?e.errors.name:void 0,...e.getFieldProps("name")}),s.jsx(r.Input,{type:"text",label:"APT Line",required:!0,error:e.touched.apt_line&&e.errors.apt_line?e.errors.apt_line:void 0,...e.getFieldProps("apt_line")}),s.jsx(r.Select,{label:"GPG key",disabled:b,options:[{label:"Select GPG key",value:""},...S],...e.getFieldProps("gpg_key"),error:e.touched.gpg_key&&e.errors.gpg_key?e.errors.gpg_key:void 0}),s.jsx(r.Select,{label:"Access group",disabled:_,options:[{label:"Select access group",value:""},...P],...e.getFieldProps("access_group"),error:e.touched.access_group&&e.errors.access_group?e.errors.access_group:void 0}),s.jsx(F,{submitButtonDisabled:e.isSubmitting,submitButtonText:"Add APT Source"})]})};export{N as default};
