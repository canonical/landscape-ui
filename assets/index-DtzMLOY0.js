import{r as p,j as e,m as s,c as _,A as q,F as $,J as N,B as T,T as z,az as k,ap as H,aj as U,aq as W,a as G,z as J,l as K,aA as Q,a8 as L,aB as X,W as Z,aC as ee,a7 as S,o as v,aD as te,al as se,aE as ie,aF as C,E as ae}from"./index-UpX-dzun.js";import{P as oe,a as ne,b as re}from"./PageMain-B5bGF__y.js";import le from"./index-Djwj2u_D.js";import{u as ce}from"./useSecurityProfileDownloadAudit-j7tpTd3L.js";import{H as de}from"./HeaderWithSearch-Brh4C753.js";import"./SidePanelFormButtons-Ba4swt1J.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./useSecurityProfileForm-CbMrjDxV.js";import"./AssociationBlock-A9pFAvtO.js";import"./MultiSelectField-C6gzHj7Y.js";import"./useInstances-CCIYSZv0.js";import"./FileInput-zwTPq-Lx.js";import"./Flow-fCu9yRR6.js";import"./useOrgSettings-BZXAOPlE.js";import"./useRoles-CcEshkSd.js";import"./RadioGroup-Dw7g5rRW.js";const ue=({checkboxProps:i={label:void 0},children:n,hideModal:a,hideNotification:o,ignore:t,...l})=>{const[c,m]=p.useState(!1),g=h=>{a(),o(h),c&&t(h)},f=()=>{a(),m(!1)},y=()=>{m(h=>!h)};return e.jsxs(s.ConfirmationModal,{...l,onConfirm:g,close:f,children:[e.jsx(e.Fragment,{children:n}),e.jsx(s.CheckboxInput,{checked:c,onChange:y,...i})]})},pe=({children:i,hide:n,modalProps:a={confirmButtonLabel:void 0},storageKey:o,...t})=>{const[l,c]=p.useState(!1),m=()=>{c(!0)},g=()=>{c(!1)},f=()=>{localStorage.setItem(o,"true")};return e.jsxs(e.Fragment,{children:[localStorage.getItem(o)!="true"&&e.jsx(s.Notification,{...t,onDismiss:m,children:i}),l&&e.jsx(ue,{hideModal:g,hideNotification:n,ignore:f,...a,children:e.jsx("p",{children:i})})]})},me="_container_hky67_1",fe="_buttons_hky67_6",he="_inlineInput_hky67_13",ge="_input_hky67_19",ye="_percent_hky67_23",u={container:me,buttons:fe,inlineInput:he,input:ge,percent:ye},xe=({closeMenu:i})=>{const{setPageParams:n,passRateFrom:a,passRateTo:o}=_(),t=q({initialValues:{passRateFrom:a,passRateTo:o},enableReinitialize:!0,validationSchema:$().shape({passRateFrom:N().required("This field is required").min(0,"Must not be negative").integer("Enter an integer").max(100,"Must not be greater than 100"),passRateTo:N().required("This field is required").max(100,"Must not be greater than 100").when("passRateFrom",([l],c)=>c.min(l,"Must not be less than minimum pass rate"))}),onSubmit:l=>{n({passRateFrom:l.passRateFrom,passRateTo:l.passRateTo}),i()}});return e.jsxs(s.Form,{onSubmit:t.handleSubmit,noValidate:!0,className:u.container,children:[e.jsxs("div",{className:u.inlineInput,children:[e.jsx(s.Input,{className:u.input,type:"number",label:"From",min:0,max:t.values.passRateTo,...t.getFieldProps("passRateFrom"),error:T(t,"passRateFrom")}),e.jsx("span",{className:u.percent,children:"%"})]}),e.jsxs("div",{className:u.inlineInput,children:[e.jsx(s.Input,{className:u.input,type:"number",label:"To",min:t.values.passRateFrom,max:100,...t.getFieldProps("passRateTo"),error:T(t,"passRateTo")}),e.jsx("span",{className:u.percent,children:"%"})]}),e.jsxs("div",{className:u.buttons,children:[e.jsx(s.Button,{small:!0,type:"button",appearance:"base",className:"u-no-margin--bottom",onClick:()=>{n({passRateFrom:0,passRateTo:100}),i()},children:"Reset"}),e.jsx(s.Button,{small:!0,type:"submit",appearance:"positive",className:"u-no-margin--bottom",disabled:!t.isValid,children:"Apply"})]})]})},be=()=>{const{passRateFrom:i,passRateTo:n}=_(),a=i!==0,o=n!==100;return e.jsx(z,{type:"custom",label:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Pass rate"}),e.jsx("span",{className:k.badgeContainer,children:a||o?e.jsx(s.Badge,{value:a&&o?2:1,className:k.badge}):null})]}),customComponent:({closeMenu:t})=>e.jsx(xe,{closeMenu:t})})},w=[{label:"All",value:"all"},{label:"Active",value:""},{label:"Archived",value:"archived"}],Se="_filters_1bctl_1",je={filters:Se},ve=()=>e.jsxs(e.Fragment,{children:[e.jsx(de,{actions:e.jsxs("div",{className:je.filters,children:[e.jsx(H,{options:w}),e.jsx(be,{})]})}),e.jsx(U,{filtersToDisplay:["status","search","passRateFrom","passRateTo"],statusOptions:w})]}),_e=i=>{if(i!=="all")return i||"active"},Pe=({hideRetentionNotification:i,retentionNotificationVisible:n})=>{const a=W(),o=G(),{notify:t}=J(),{currentPage:l,pageSize:c,search:m,status:g,passRateFrom:f,passRateTo:y}=_(),{setSidePanelContent:h}=K(),A=Q(),{securityProfiles:P,securityProfilesCount:E,isSecurityProfilesLoading:D}=L({search:m,status:_e(g),limit:c,offset:(l-1)*c,pass_rate_from:f!=0?f:void 0,pass_rate_to:y!=100?y:void 0}),{overLimitSecurityProfiles:x}=X({limit:20,offset:0}),[R,I]=p.useState(JSON.parse(localStorage.getItem("_landscape_pendingSecurityProfileReports")??"[]")),{getActivitiesQuery:B}=Z(),{data:j}=B({query:R.map(d=>`id:${d.activityId}`).join(" OR ")},{enabled:!!R.length}),{updateSecurityProfile:M}=ee(),F=ce(),[V,Y]=p.useState(localStorage.getItem("_landscape_isSecurityProfileLimitNotificationIgnored")=="true"),O=()=>{const[d]=x;h(`Edit ${d.title}`,e.jsx(p.Suspense,{fallback:e.jsx(v,{}),children:e.jsx(le,{benchmarkStepDisabled:!0,confirmationStepDescription:"To save your changes, you need to run the profile.",getConfirmationStepDisabled:r=>r.mode=="audit",initialValues:ie(d),mutate:async r=>{M({id:d.id,access_group:r.access_group,all_computers:r.all_computers,restart_deliver_delay:r.restart_deliver_delay,restart_deliver_delay_window:r.restart_deliver_delay_window,schedule:r.schedule,tags:r.tags,title:r.title})},onSuccess:r=>{t.success({title:`You have successfully saved changes for ${r.title} security profile.`,message:"Your changes have been saved successfully."})},submitButtonText:"Save changes",submitting:!1})}))},b=(j==null?void 0:j.data.results.filter(d=>d.activity_status=="succeeded"))??[];return e.jsxs(e.Fragment,{children:[n&&e.jsx(pe,{inline:!0,title:"Audit retention policy:",storageKey:"_landscape_isAuditModalIgnored",hide:i,modalProps:{title:"Dismiss audit retention acknowledgment",confirmButtonAppearance:"positive",confirmButtonLabel:"Dismiss",checkboxProps:{label:"I understand and acknowledge this policy. Don't show this message again."}},children:e.jsx(e.Fragment,{children:"Any audit older than the specified retention period for a given profile will be automatically removed. We recommend downloading and storing audit data externally before it expires. You can view the exact retention period for each profile in its details."})}),x.length>1&&e.jsxs(s.Notification,{severity:"negative",inline:!0,title:"Profiles exceeded associated instance limit:",children:["Some of your security profiles are assigned to more than"," ",e.jsxs("strong",{children:[S.toLocaleString()," ","instances"]}),". Only the first"," ",S.toLocaleString()," will be audited. Edit the profiles or duplicate them to cover the rest."," ",e.jsx(s.Button,{type:"button",appearance:"link",onClick:()=>{o({pathname:a.pathname,search:"?status=over-limit"})},children:"View profiles"})]}),x.length===1&&e.jsxs(s.Notification,{severity:"negative",inline:!0,title:"Profile exceeded associated instance limit:",children:["Your security profile"," ",e.jsx("strong",{children:x[0].title})," is assigned to more than"," ",e.jsxs("strong",{children:[S.toLocaleString()," ","instances"]}),". Only the first"," ",S.toLocaleString()," will be covered. Edit the profile or duplicate it to cover the rest."," ",e.jsx(s.Button,{type:"button",appearance:"link",onClick:O,children:"Edit profile"})]}),A&&!V&&e.jsxs(s.Notification,{severity:"caution",inline:!0,title:"Security profiles limit reached:",onDismiss:()=>{localStorage.setItem("_landscape_isSecurityProfileLimitNotificationIgnored","true"),Y(!0)},children:["You've reached the maximum of"," ",e.jsx("strong",{children:"5 security profiles"}),". To add more, archive profiles that are no longer in use to free up space for active ones."]}),b.length>1&&e.jsxs(s.Notification,{inline:!0,title:"Your audits are ready for download:",onDismiss:()=>{localStorage.removeItem("_landscape_pendingSecurityProfileReports"),I([])},children:["Several of your audits have been successfully generated and are now ready for download."," ",e.jsx(s.Button,{appearance:"link",type:"button",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{for(const d of b)F(d.result_text)},children:"Download audits"})]}),b.length==1&&e.jsxs(s.Notification,{inline:!0,title:"Your audit is ready for download:",onDismiss:()=>{localStorage.removeItem("_landscape_pendingSecurityProfileReports"),I([])},children:["Your audit has been successfully generated and is now ready for download."," ",e.jsx(s.Button,{appearance:"link",type:"button",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{F(b[0].result_text)},children:"Download audit"})]}),e.jsx(ve,{}),D?e.jsx(v,{}):e.jsxs(e.Fragment,{children:[e.jsx(te,{securityProfiles:P}),e.jsx(se,{totalItems:E,currentItemCount:P.length})]})]})},Oe=()=>{const[i,n]=p.useState(!1),{securityProfilesCount:a,isSecurityProfilesLoading:o}=L({offset:0,limit:0}),t=()=>{n(!0)};return e.jsxs(oe,{children:[e.jsx(ne,{title:"Security profiles",actions:a?[e.jsx(p.Fragment,{children:e.jsx(C,{onAddProfile:t})},"add-security-profile-button")]:void 0}),e.jsxs(re,{children:[o&&e.jsx(v,{}),!o&&a===0&&e.jsx(ae,{body:e.jsx("p",{children:"Add a security profile to ensure security and complaince across your instances. Security profile audits aggregate audit results over time and in bulk, helping you align with tailored security benchmarks, run scheduled audits, and generate detailed audits for your estate."}),cta:[e.jsx(p.Fragment,{children:e.jsx(C,{onAddProfile:t})},"add-security-profile-button")],title:"You don't have any security profiles yet"}),!o&&!!a&&e.jsx(Pe,{hideRetentionNotification:()=>{n(!1)},retentionNotificationVisible:i})]})]})};export{Oe as default};
