const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CsD60s2h.js","assets/index-BE2TKmZA.js","assets/index-DCq_vsqr.css","assets/EmployeeGroupIdentityIssuerList-DJMhmDv4.js","assets/usePageParams-CBLmn4Hi.js","assets/TablePagination-BkgYVqcD.js","assets/TablePaginationBase-ClNbvr7T.js","assets/TablePaginationBase-CJl3HN1X.css","assets/TableFilter-CHmfeGzi.js","assets/TableFilter-CNw_lMaf.css","assets/TableFilterChips-DLsUHLGy.js","assets/TableFilterChips-CHqetGbX.css","assets/HeaderWithSearch-BYJTyjF0.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/index-yzfLujq0.js","assets/TruncatedCell-BEE1raqP.js","assets/TruncatedCell-CoXbu3VM.css","assets/EmployeeGroupIdentityIssuerList-DJkUyphv.css"])))=>i.map(i=>d[i]);
import{b as M,e as I,c as P,r,p as C,d as $,j as e,g as d,f as q,q as D,n as j,E as R,_ as z}from"./index-BE2TKmZA.js";import{S as Q}from"./SidePanelFormButtons-CYCRc-MM.js";import{S as H}from"./TableFilter-CHmfeGzi.js";import{P as K}from"./usePageParams-CBLmn4Hi.js";import"./EmployeeGroupIdentityIssuerList-DJMhmDv4.js";import{u as E}from"./useGetEmployeeGroups-CcArU25M.js";import{I as G,S as V}from"./SidePanelDescription-DCZcSvUX.js";import{S as Y}from"./SidePanelTablePagination-CpKm91Ig.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./TablePagination-BkgYVqcD.js";import"./TablePaginationBase-ClNbvr7T.js";import"./TableFilterChips-DLsUHLGy.js";import"./HeaderWithSearch-BYJTyjF0.js";import"./index-yzfLujq0.js";import"./TruncatedCell-BEE1raqP.js";const U=()=>{const a=M(),i=I(),{mutateAsync:m,isPending:s}=P({mutationFn:async({staged_oidc_group_ids:c,import_all:n})=>i.post("/employee_groups",{staged_oidc_group_ids:c,import_all:n}),onSuccess:async()=>a.invalidateQueries({queryKey:["employeeGroups"]})});return{importEmployeeGroups:m,isEmployeeGroupsImporting:s}},W=({issuerId:a,pageSize:i,currentPage:m,search:s})=>{const{employeeGroupsCount:c}=E(),[n,x]=r.useState(null),g=I(),S=C(),h={import_session_id:n==null?void 0:n.id,exclude_imported:c&&c>0,offset:(m-1)*i,limit:i,search:s},{mutateAsync:b,isPending:f}=P({mutationFn:async({issuer_id:p})=>g.post("/oidc/groups/import_session",{issuer_id:p})});r.useEffect(()=>{b({issuer_id:a}).then(({data:p})=>{x(p)}).catch(S)},[]);const{data:u,isLoading:l}=$({queryKey:["stagedOidcGroups",h],queryFn:async()=>g.get("/oidc/groups/staged",{params:h}),enabled:n!==null});return{stagedOidcGroups:(u==null?void 0:u.data.results)??[],stagedOidcGroupsCount:(u==null?void 0:u.data.count)??0,isStagedOidcGroupsLoading:f||l}},Z=()=>{const{employeeGroupsCount:a}=E();return a&&a<=G?null:e.jsx("div",{children:e.jsx(d.Notification,{severity:"negative",title:"Group limit reached",children:`You've reached the limit of ${G.toLocaleString()} groups. Remove excess groups to proceed.`})})},J="_checkbox_1ksvx_1",_={checkbox:J},X=r.lazy(async()=>z(()=>import("./index-CsD60s2h.js").then(a=>a.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))),he=({issuer:a})=>{const[i,m]=r.useState(""),[s,c]=r.useState([]),[n,x]=r.useState(!0),[g,S]=r.useState(1),[h,b]=r.useState(K[0].value),{setSidePanelContent:f,closeSidePanel:u}=q(),{stagedOidcGroups:l,stagedOidcGroupsCount:p,isStagedOidcGroupsLoading:y}=W({issuerId:a.id,pageSize:h,currentPage:g,search:i}),k=C(),{notify:v}=D(),{importEmployeeGroups:N,isEmployeeGroupsImporting:O}=U(),F=t=>{c([]),S(t)},L=t=>{c([]),b(t)},B=async t=>{t.preventDefault();try{const{data:{count:o}}=await N({staged_oidc_group_ids:s,import_all:n});u(),v.success({title:`Youâ€™ve successfully Imported ${o} Employee ${o>1?"groups":"group"}.`,message:"Newly added Employee groups can now be managed within Landscape."})}catch(o){k(o)}},T=t=>{c(s.includes(t)?s.filter(o=>o!==t):[...s,t])},w=()=>{f("Choose an identity issuer",e.jsx(r.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(X,{})}))},A=r.useMemo(()=>{const t={accessor:"name",Header:"name",Cell:({row:{original:{name:o}}})=>e.jsx(e.Fragment,{children:e.jsx("span",{children:o})})};return n?[t]:[{accessor:"id",className:"checkbox-column",Header:()=>e.jsx(d.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all employee groups"}),disabled:l.length===0||y,indeterminate:s.length>0&&s.length<l.length,checked:s.length>0&&s.length===l.length,onChange:()=>{c(s.length>0?[]:l.map(({id:o})=>o))}}),Cell:({row:{original:o}})=>e.jsx(d.CheckboxInput,{labelClassName:"u-no-margin--bottom u-no-padding--top",label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${o.name}`}),disabled:y,name:"employee-group-checkbox",checked:s.includes(o.id),onChange:()=>{T(o.id)}})},t]},[s,y,l,n]);return y&&!i?e.jsx(j,{}):!p&&!i?e.jsx(R,{title:"No employee groups found",body:e.jsx("p",{className:"u-no-margin--bottom",children:`Seems like there are no employee groups to import from ${a.provider.provider_label}.`})}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsx(V,{children:"Choose employee groups to import into Landscape. Once imported, you can set their priority, assign Autoinstall files, and manage associated employees."}),e.jsx("div",{className:_.checkbox,children:e.jsx(d.CheckboxInput,{label:"Import all groups",onChange:()=>{x(t=>!t)},checked:n})}),e.jsx(H,{onSearch:t=>{m(t)}}),y?e.jsx(j,{}):e.jsxs(d.Form,{noValidate:!0,onSubmit:B,children:[e.jsx(d.ModularTable,{data:l,columns:A,emptyMsg:`No employee groups found with the search: "${i}"`}),e.jsx(Y,{currentPage:g,pageSize:h,paginate:F,setPageSize:L,totalItems:p,className:_.pagination}),e.jsx(Q,{hasBackButton:!0,onBackButtonPress:w,submitButtonText:"Import",submitButtonDisabled:!n&&s.length===0||O})]})]})};export{he as default};
