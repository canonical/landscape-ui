const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DMJKUZPM.js","assets/ScriptsTabs-DfoExKFg.js","assets/index-CNSDWj8Q.js","assets/index-CoB-_C5O.css","assets/TablePagination-CFXNvqsZ.js","assets/TableFilterChips-06YfpJdc.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-CLgA9gvz.css","assets/helpers-kPKhnyjI.js","assets/constants-CDnVvJTb.js","assets/NoData-6ZK9sV5u.js","assets/ResponsiveTable-BXalKviy.js","assets/ResponsiveTable-DsN8RVSX.css","assets/StaticLink-BEYCGcPv.js","assets/TruncatedCell-BMum6DLZ.js","assets/Truncated-Dtg97i8C.js","assets/Truncated-uqJp6ujM.css","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-B4jhRgod.js","assets/useRoles-DYJzr0u4.js","assets/useFetchOld-BAAs34Op.js","assets/TextConfirmationModal-q88mH05g.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/PageParamFilter-ChSwlZqZ.js","assets/TableFilter-2AKF5NjJ.js","assets/TableFilter-B85Stwni.css","assets/HeaderWithSearch-D2tNhOlz.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-CySvbr4l.js","assets/ScriptsTabs-DN44MVZt.css","assets/SidePanelFormButtons-DIizKTix.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useRunScript-Djv9SBc3.js","assets/formikErrors-Bw8iTXYS.js","assets/DeliveryBlock-B3k_IVND.js","assets/RadioGroup-BVZkBsDq.js","assets/RadioGroup-WBbAFTwm.css","assets/ScriptDropdown-BDpvNfnn.js","assets/downshift.esm-DADdD-V8.js","assets/ScriptDropdown-DGqiHs-J.css","assets/index-D8g_Dy3D.js","assets/CodeEditor-DBPYuwcp.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-1fibiNNB.js","assets/AttachmentFile-CcsxK_w8.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-BarVoJgc.js","assets/SidePanel-ChyjtMJv.js","assets/SidePanel-C17_jvtU.css","assets/ScriptProfileForm-CdAD-ysD.js","assets/AssociationBlock-B4LnXWNE.js","assets/MultiSelectField-CqoYdMk0.js","assets/MultiSelectField-GyNA33om.css","assets/useGetTags-B_HL7bdb.js","assets/AssociationBlock-vsPH8fvb.css","assets/useGetInstances-rIFBd_bT.js","assets/InstancesPageActions-DL7_pmR1.js","assets/index-D-YBZSy_.js","assets/index-B1ULwG00.css","assets/ListTitle-BUruUKn1.js","assets/ListTitle-CxCHkD9o.css","assets/InfoGrid-3w5mqARw.js","assets/InfoItem-Bt7JBIPo.js","assets/InfoItem-D8nPzgUA.css","assets/InfoGrid-D3QqOHFx.css","assets/InstancesPageActions-h3D4euDx.css","assets/ScriptProfileForm-CqtphJAy.css","assets/ProfileAssociatedInstancesLink-Neer6jGU.js","assets/index-B6ddlbgq.js","assets/useGetPageScriptProfile-yEth1egE.js","assets/index-jDJHVPCe.js","assets/index-CpGGN5YE.css"])))=>i.map(i=>d[i]);
import{f as w,t as I,v as U,c as N,q as h,j as t,z as D,U as k,a4 as H,r as f,d as m,L as $,o as G,R as Y,J as q,x as z,E as O,e as x,_,D as W}from"./index-CNSDWj8Q.js";import{S as v}from"./SidePanel-ChyjtMJv.js";import{T as B,u as V}from"./TableFilterChips-06YfpJdc.js";import{a as J}from"./TablePagination-CFXNvqsZ.js";import{u as K}from"./ScriptsTabs-DfoExKFg.js";import"./helpers-kPKhnyjI.js";import"./index-CySvbr4l.js";import{L as Q}from"./constants-CDnVvJTb.js";import{N as b}from"./NoData-6ZK9sV5u.js";import{R as Z}from"./ResponsiveTable-BXalKviy.js";import{T as X}from"./TruncatedCell-BMum6DLZ.js";import{u as ee}from"./useExpandableRow-B4jhRgod.js";import{P as te}from"./ProfileAssociatedInstancesLink-Neer6jGU.js";import{T as se}from"./TextConfirmationModal-q88mH05g.js";import{P as re}from"./PageParamFilter-ChSwlZqZ.js";import{H as ie}from"./HeaderWithSearch-D2tNhOlz.js";const ae=()=>{const e=w(),r=I(),{isPending:n,mutateAsync:i}=U({mutationFn:async({id:o})=>e.post(`script-profiles/${o}:archive`),onSuccess:async()=>r.invalidateQueries({queryKey:["scriptProfiles"]})});return{isArchivingScriptProfile:n,archiveScriptProfile:i}},L=()=>{const e=w(),{data:r,isLoading:n}=N({queryKey:["scriptProfileLimits"],queryFn:async()=>e.get("script-profile-limits")});return{scriptProfileLimits:r?.data??null,isGettingScriptProfileLimits:n}},ne={listenToUrlParams:!0},C=(e,r)=>{const n=w(),{currentPage:i,pageSize:o,status:c,search:s}=h();e={...ne,...e};const a={...e.listenToUrlParams?{limit:o,offset:(i-1)*o,search:s??void 0,archived:c||"active"}:r},{data:l,isPending:p}=N({queryKey:["scriptProfiles",a],queryFn:async()=>n.get("script-profiles",{params:a})});return{scriptProfiles:l?.data.results??[],scriptProfilesCount:l?.data.count,isGettingScriptProfiles:p}},u={MINUTE:{min:0,max:59},HOUR:{min:0,max:23},DAY_OF_MONTH:{min:1,max:31},MONTH:{min:1,max:12},DAY_OF_WEEK:{min:0,max:6}},oe=e=>{switch(e%100){case 11:case 12:case 13:return"th"}switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},ce=e=>`${e}${oe(e)}`,T=(e,r)=>r?r.labels[r.offset?e-r.offset:e]:e,F=(e,r)=>e.start==r.min&&e.end==r.max&&e.step==1,g=(e,r,n,i,o)=>{let c="";if(e.some(a=>F(a,r)))return c;i&&(c+=` ${i} `);const s=e.map(a=>{let l="";return(a.step>1||a.start!=a.end)&&(l+="every "),a.step>1&&(l+=`${ce(a.step)} `),a.start!=a.end||a.step>1?(l+=n,(a.start!=r.min||a.end!=r.max)&&(l+=` from ${T(a.start,o)} through ${T(a.end,o)}`)):o?l+=T(a.start,o):l+=`${n} ${a.start}`,l});return c+=s.slice(0,-1).join(", "),s.length>2&&(c+=","),s.length>1&&(c+=" and "),c+=s.slice(-1),c},A=e=>{const r=parseFloat(e);if(!Number.isSafeInteger(r))throw new Error("Invalid value.");return r},P=(e,r,n={})=>e.split(",").map(i=>{const o={start:Number.NaN,end:Number.NaN,step:1},c=s=>{if(s=="*"){o.start=r.min,o.end=r.max;return}if(s=s.replaceAll(/[a-zA-Z]+/g,a=>{const l=n[a.toUpperCase()];if(!l)throw new Error("Invalid character.");return l}),s.includes("-")){const[a,l]=s.split("-").map(A);if(l<a)throw new Error("The end of a range must not be less than the start.");o.start=a,o.end=l}else{const a=A(s);o.start=a,o.end=a}};if(i.includes("/")){const[s,a]=i.split("/");o.step=A(a),c(s)}else c(i);if(o.start<r.min||o.end>r.max)throw new Error("Value out of range.");return o}),le=e=>{const[r,n,i,o,c]=e.trim().split(/ +/);if(!r||!n||!i||!o||!c)throw new Error("Enter a complete interval.");const s=P(r,u.MINUTE),a=P(n,u.HOUR),l=P(i,u.DAY_OF_MONTH),p=P(o,u.MONTH,{JAN:"1",FEB:"2",MAR:"3",APR:"4",MAY:"5",JUN:"6",JUL:"7",AUG:"8",SEP:"9",OCT:"10",NOV:"11",DEC:"12"}),y=P(c,u.DAY_OF_WEEK,{SUN:"0",MON:"1",TUE:"2",WED:"3",THU:"4",FRI:"5",SAT:"6"});let d="at ";s.some(j=>F(j,u.MINUTE))&&(d+="every minute"),s.length==1&&s[0].start==s[0].end&&a.length==1&&a[0].start==a[0].end?d+=`${a[0].start.toString().padStart(2,"0")}:${s[0].start.toString().padStart(2,"0")}`:(d+=g(s,u.MINUTE,"minute"),d+=g(a,u.HOUR,"hour","past"));const S=g(l,u.DAY_OF_MONTH,"day-of-month","on");return d+=S,d+=g(y,u.DAY_OF_WEEK,"day-of-week",S?"and on":"on",{labels:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}),d+=g(p,u.MONTH,"month","in",{offset:1,labels:["January","February","March","April","May","June","July","August","September","October","November","December"]}),d},de=e=>e.archived?"Archived":"Active",R=e=>{switch(e.trigger.trigger_type){case"event":switch(e.trigger.event_type){case"post_enrollment":return"Post enrollment";default:return}case"one_time":return"On a date";case"recurring":return"Recurring"}},qe=e=>{switch(e.trigger.trigger_type){case"recurring":return`Recurring, ${le(e.trigger.interval)}`;default:return R(e)}},ue=({scriptProfile:e})=>e.trigger.trigger_type==="event"&&e.trigger.event_type==="post_enrollment"?t.jsx(b,{}):t.jsx(te,{count:e.computers.num_associated_computers,profile:e,query:`script:${e.id}`}),pe=({profile:e,opened:r,onClose:n})=>{const{notify:i}=D(),{archiveScriptProfile:o,isArchivingScriptProfile:c}=ae(),s=async()=>{await o({...e}),n(),i.success({title:`You have successfully archived "${e.title}"`,message:"The profile will no longer run on the defined schedule."})};return t.jsx(se,{isOpen:r,title:`Archive ${e.title}`,confirmButtonLabel:"Archive",confirmButtonDisabled:c,confirmButtonLoading:c,onConfirm:s,close:n,confirmationText:`archive ${e.title}`,children:t.jsxs("p",{children:["Archiving the script will prevent it from running in the future.",t.jsx("br",{}),"This action is ",t.jsx("strong",{children:"irreversible"}),"."]})})},me=({scriptProfile:e})=>{const{createPageParamsSetter:r}=h(),{value:n,setTrue:i,setFalse:o}=k(),c=[{icon:"show",label:"View details",onClick:r({sidePath:["view"],profile:e.id.toString()})}];e.archived||c.push({icon:"edit",label:"Edit",onClick:r({sidePath:["edit"],profile:e.id.toString()})});const s=e.archived?void 0:[{icon:"archive",label:"Archive",onClick:i}];return t.jsxs(t.Fragment,{children:[t.jsx(H,{toggleAriaLabel:`${e.title} script profile actions`,actions:c,destructiveActions:s}),t.jsx(pe,{onClose:o,opened:n,profile:e})]})},he=e=>({column:r,row:{index:n}})=>{const i={};switch(r.id){case"title":i.role="rowheader";break;case"archived":i["aria-label"]="Status";break;case"all_computers":i["aria-label"]="Associated instances";break;case"tags":i["aria-label"]="Tags",e===n&&(i.className="expandedCell");break;case"trigger":i["aria-label"]="Trigger";break;case"activities.last_activity.creation_time":i["aria-label"]="Last run";break;case"actions":i["aria-label"]="Actions";break}return i},fe=e=>({index:r,original:n})=>{const i={};return e===r&&(i.className="expandedRow"),i["aria-label"]=`${n.title} script profile row`,i},ge=({profiles:e})=>{const{createPageParamsSetter:r}=h(),{expandedRowIndex:n,handleExpand:i,getTableRowsRef:o}=ee(),c=f.useMemo(()=>[{Header:"Title",accessor:"title",Cell:({row:{original:s}})=>t.jsx(m.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top u-align-text--left",onClick:r({sidePath:["view"],profile:s.id.toString()}),children:s.title})},{Header:"Status",accessor:"archived",Cell:({row:{original:s}})=>de(s),getCellIcon:({row:{original:{archived:s}}})=>s?"status-queued-small":"status-succeeded-small"},{Header:"Associated instances",accessor:"all_computers",Cell:({row:{original:s}})=>t.jsx(ue,{scriptProfile:s})},{Header:"Tags",accessor:"tags",Cell:({row:{original:s,index:a}})=>s.all_computers?"All instances":s.tags.length===0?t.jsx(b,{}):t.jsx(X,{content:s.tags.map(l=>t.jsx("span",{className:"truncatedItem",children:l},l)),isExpanded:a==n,onExpand:()=>{i(a)},showCount:!0})},{Header:"Trigger",accessor:"trigger",Cell:({row:{original:s}})=>R(s)},{Header:"Last run",accessor:"activities.last_activity.creation_time",className:"date-cell",Cell:({row:{original:{activities:{last_activity:s}}}})=>s?t.jsxs($,{className:"font-monospace",to:Y.activities.root({query:`parent-id:${s.id}`}),children:[G(s.creation_time).utc().format(q)," "]}):t.jsx(b,{})},{...Q,Cell:({row:{original:s}})=>t.jsx(me,{scriptProfile:s})}],[r,n,i]);return t.jsx("div",{ref:o,children:t.jsx(Z,{columns:c,data:e,emptyMsg:"No script profiles found according to your search parameters.",getCellProps:he(n),getRowProps:fe(n),minWidth:1200})})},Pe=f.lazy(async()=>_(()=>import("./index-DMJKUZPM.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49])).then(e=>({default:e.CreateScriptForm}))),Se=()=>{const{setSidePanelContent:e}=z(),r=()=>{e("Add script",t.jsx(f.Suspense,{fallback:t.jsx(x,{}),children:t.jsx(Pe,{})}))};return t.jsx(O,{title:"You need at least one script to add a profile.",body:t.jsxs(t.Fragment,{children:[t.jsx("p",{children:"In order to create a script profile, you need to have added a script to your Landscape organization."}),t.jsxs(m.Button,{type:"button",appearance:"positive",onClick:r,className:"u-no-margin--bottom",hasIcon:!0,children:[t.jsx(m.Icon,{name:"plus",light:!0}),t.jsx("span",{children:"Add script"})]})]})})},M=({appearance:e})=>{const{createPageParamsSetter:r}=h(),{scriptProfilesCount:n}=C({listenToUrlParams:!1},{archived:"active"}),{scriptProfileLimits:i}=L(),o=r({sidePath:["add"],profile:""});return t.jsxs(m.Button,{type:"button",appearance:e,onClick:o,className:"u-no-margin--bottom",hasIcon:!0,disabled:(n??0)>=(i?.max_num_profiles??0),children:[t.jsx(m.Icon,{name:"plus",light:e==="positive"}),t.jsx("span",{children:"Add profile"})]})},ve=()=>t.jsx(O,{title:"You don't have any script profiles yet.",body:t.jsxs(t.Fragment,{children:[t.jsx("p",{children:"Script profiles allow you to automate your script runs based on triggers. Triggers can be either a recurring schedule, on a set date, or before or after an event."}),t.jsx(M,{appearance:"positive"})]})}),E=[{label:"All",value:"all"},{label:"Active",value:""},{label:"Archived",value:"archived"}],xe="_actions_dhdem_1",_e={actions:xe},ye=()=>t.jsxs(t.Fragment,{children:[t.jsx(ie,{actions:t.jsxs("div",{className:_e.actions,children:[t.jsx(re,{pageParamKey:"status",label:"Status",options:E}),t.jsx(M,{})]})}),t.jsx(B,{filtersToDisplay:["search","status"],statusOptions:E})]}),je=()=>{const{currentPage:e,pageSize:r,search:n,status:i}=h(),{scriptsCount:o,isScriptsLoading:c}=K({listenToUrlParams:!1},{script_type:"active",limit:0,offset:0}),{scriptProfiles:s,scriptProfilesCount:a,isGettingScriptProfiles:l}=C(),{scriptProfilesCount:p,isGettingScriptProfiles:y}=C({listenToUrlParams:!1},{archived:"active"}),{scriptProfileLimits:d,isGettingScriptProfileLimits:S}=L(),j=e===1&&r===W&&l;return y||S||d===null?t.jsx(x,{}):s.length||n||i||j?t.jsxs(t.Fragment,{children:[t.jsx(ye,{}),p&&p>=d.max_num_profiles&&t.jsxs(m.Notification,{inline:!0,title:"Profile limit reached:",severity:"caution",children:["You've reached the limit of"," ",d.max_num_profiles," active script profiles. To be able to add new profiles you must archive an active one."]}),l?t.jsx(x,{}):t.jsx(ge,{profiles:s}),t.jsx(J,{totalItems:a,currentItemCount:s.length})]}):c?t.jsx(x,{}):o?t.jsx(ve,{}):t.jsx(Se,{})},Te=f.lazy(()=>_(()=>import("./index-BarVoJgc.js"),__vite__mapDeps([50,2,3,51,52,53,54,55,56,57,58,32,33,34,59,60,61,10,4,5,6,7,20,23,24,25,36,11,12,62,63,64,13,14,15,16,17,18,30,21,22,65,66,67,68,69,8,1,9,19,26,27,28,29,31,40,41,42,70,71]))),Ae=f.lazy(()=>_(()=>import("./index-B6ddlbgq.js"),__vite__mapDeps([72,2,3,51,52,73,53,54,55,56,57,58,32,33,34,59,60,61,10,4,5,6,7,20,23,24,25,36,11,12,62,63,64,13,14,15,16,17,18,30,21,22,65,66,67,68,69,8,1,9,19,26,27,28,29,31,40,41,42,70,71]))),be=f.lazy(()=>_(()=>import("./index-jDJHVPCe.js"),__vite__mapDeps([74,2,3,51,52,73,5,6,4,7,1,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,71,75]))),Ce=()=>{const{sidePath:e,lastSidePathSegment:r,createPageParamsSetter:n}=h(),i=n({sidePath:[],profile:""});return V("sidePath",["add","edit","view"]),t.jsxs(t.Fragment,{children:[t.jsx(je,{}),t.jsxs(v,{onClose:i,isOpen:!!e.length,children:[r==="add"&&t.jsx(v.Suspense,{children:t.jsx(Te,{})},"add"),r==="edit"&&t.jsx(v.Suspense,{children:t.jsx(Ae,{})},"edit"),r==="view"&&t.jsx(v.Suspense,{children:t.jsx(be,{})},"view")]})]})},ze=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"}));export{ue as S,qe as a,pe as b,de as g,ze as i,le as t,L as u};
