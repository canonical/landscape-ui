import{ab as N,z as $,f as b,O,ar as D,B as L,s as I,t as w,n as S,v as k,o as q,j as e,e as l,ag as m,i as Q,m as H,a2 as M,Q as R,I as d,J as V}from"./index-D2Oms9tG.js";import{A as U}from"./AssociationBlock-DUM7rYzS.js";import{S as z}from"./SidePanelFormButtons-BYOeNULY.js";import{u as C}from"./useRoles-DpI5_hUS.js";import{u as E}from"./index-Cd8l_q7d.js";import{R as je,a as ye,b as be}from"./index-Cd8l_q7d.js";import{T as W}from"./TextConfirmationModal-CtMemiEv.js";import"./MultiSelectField-DQnDyOpp.js";import"./useGetTags-NHiP88Tm.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./PageMain-9uLXS3Ev.js";import"./constants-DTivhiFn.js";import"./constants-DJbOMpfM.js";import"./table-CdFwMAPu.js";import"./HeaderWithSearch-BvyKfcDC.js";const A={add:"Add",edit:"updated"},X={add:"Add removal profile",edit:"Save changes"},J={access_group:N,all_computers:!1,days_without_exchange:"",tags:[],title:""},T=2147483647,K=t=>$().shape({access_group:b(),all_computers:L(),days_without_exchange:D().test({name:"required",message:"This field is required.",params:{action:t},test:o=>o!=null||t!=="add"}).integer("Timeframe must be an integer value.").min(1,"Timeframe must be at least 1.").max(T,`Timeframe must be at most  ${T}.`),tags:O().of(b()),title:b().test({name:"required",message:"This field is required.",params:{action:t},test:o=>!!o||t!=="add"})}),Y="_inputContainer_v1jo9_1",Z="_input_v1jo9_1",ee="_inputDescription_v1jo9_10",g={inputContainer:Y,input:Z,inputDescription:ee},G=t=>{const o=I(),{notify:n}=w(),{sidePath:c,popSidePath:p,setPageParams:u}=S(),{createRemovalProfileQuery:a,editRemovalProfileQuery:_}=E(),{getAccessGroupQuery:v}=C(),{data:x}=v(),P=x?.data.map(({name:i,title:r})=>({label:r,value:i}))??[],{mutateAsync:f}=a,{mutateAsync:j}=_,h=()=>{u({sidePath:[],profile:""})},s=k({initialValues:J,onSubmit:async i=>{const r={title:i.title,days_without_exchange:i.days_without_exchange,access_group:i.access_group,all_computers:i.all_computers};!i.all_computers&&i.tags.length>0&&(r.tags=i.tags);try{t.action==="edit"?await j({all_computers:r.all_computers,days_without_exchange:r.days_without_exchange,name:t.profile.name,tags:r.tags,title:r.title}):await f(r),h(),n.success({message:`Removal profile ${A[t.action]}`,title:`Removal profile ${i.title} has been ${A[t.action]}`})}catch(F){o(F)}},validationSchema:K(t.action)});return q.useEffect(()=>{t.action==="edit"&&s.setValues({access_group:t.profile.access_group,all_computers:t.profile.all_computers,days_without_exchange:t.profile.days_without_exchange,tags:t.profile.tags,title:t.profile.title})},[t]),e.jsxs(l.Form,{onSubmit:s.handleSubmit,noValidate:!0,children:[e.jsx(l.Input,{type:"text",label:"Title",required:t.action==="add",...s.getFieldProps("title"),error:s.touched.title&&s.errors.title?s.errors.title:void 0}),e.jsxs("div",{className:g.inputContainer,children:[e.jsx(l.Input,{type:"number",inputMode:"numeric",label:"Removal timeframe",required:t.action==="add",autoComplete:"off",className:g.input,wrapperClassName:g.inputWrapper,...s.getFieldProps("days_without_exchange"),error:s.touched.days_without_exchange&&s.errors.days_without_exchange?s.errors.days_without_exchange:void 0}),e.jsx("span",{className:g.inputDescription,children:"days"})]}),e.jsx(l.Select,{label:"Access group",options:P,...s.getFieldProps("access_group"),error:s.touched.access_group&&s.errors.access_group?s.errors.access_group:void 0}),e.jsx(U,{formik:s}),e.jsx(z,{submitButtonDisabled:s.isSubmitting,submitButtonText:X[t.action],onCancel:h,hasBackButton:c.length>1,onBackButtonPress:p})]})},ge=()=>e.jsxs(e.Fragment,{children:[e.jsx(m.Header,{children:"Add removal profile"}),e.jsx(m.Content,{children:e.jsx(G,{action:"add"})})]});function te(t){const o=Q(),{data:n,isPending:c,error:p}=H({queryKey:["removalProfile",t],queryFn:async({signal:a})=>o.get("GetRemovalProfiles",{signal:a})}),u=n?.data.find(({id:a})=>a===t);return{removalProfile:u,removalProfileError:n&&!u?new Error("The removal profile could not be found."):p,isGettingRemovalProfile:c}}const B=()=>{const{profile:t}=S(),{isGettingRemovalProfile:o,removalProfile:n,removalProfileError:c}=te(parseInt(t));if(c)throw c;return o?{removalProfile:void 0,isGettingRemovalProfile:!0}:{removalProfile:n,isGettingRemovalProfile:!1}},_e=()=>{const t=I(),{notify:o}=w(),{pushSidePath:n,setPageParams:c}=S(),{removeRemovalProfileQuery:p}=E(),{getAccessGroupQuery:u}=C(),{removalProfile:a,isGettingRemovalProfile:_}=B(),{data:v,isPending:x}=u(),{mutateAsync:P,isPending:f}=p,{value:j,setTrue:h,setFalse:y}=M();if(_||x)return e.jsx(m.LoadingState,{});const s=async()=>{try{await P({name:a.name}),c({sidePath:[],profile:""}),o.success({title:"Removal profile removed",message:`Removal profile ${a.title} has been removed`})}catch(r){t(r)}finally{y()}},i=()=>{n("edit")};return e.jsxs(e.Fragment,{children:[e.jsx(m.Header,{children:a.title}),e.jsxs(m.Content,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(l.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:i,"aria-label":`Edit ${a.title}`,children:[e.jsx(l.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(l.Button,{className:"p-segmented-control__button",hasIcon:!0,type:"button",onClick:h,"aria-label":`Remove ${a.title}`,children:[e.jsx(l.Icon,{name:l.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(R,{children:[e.jsx(R.Item,{children:e.jsxs(d,{children:[e.jsx(d.Item,{label:"Title",value:a.title}),e.jsx(d.Item,{label:"Name",value:a.name}),e.jsx(d.Item,{label:"Access group",value:v?.data.find(r=>r.name===a.access_group)?.title??a.access_group}),e.jsx(d.Item,{label:"Removal timeframe",large:!0,value:`${a.days_without_exchange} ${V(a.days_without_exchange,"day")}`})]})}),e.jsxs(R.Item,{title:"Association",children:[a.all_computers&&e.jsx("p",{children:"This profile has been associated with all instances."}),!a.all_computers&&!a.tags.length&&e.jsx("p",{children:"This profile has not yet been associated with any instances."}),!a.all_computers&&!!a.tags.length&&e.jsx(d,{children:e.jsx(d.Item,{label:"Tags",large:!0,value:a.tags.join(", ")||null,type:"truncated"})})]})]})]}),e.jsx(W,{isOpen:j,title:"Remove package profile",confirmationText:`remove ${a.title}`,confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:f,confirmButtonLoading:f,onConfirm:s,close:y,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},ve=()=>{const{removalProfile:t,isGettingRemovalProfile:o}=B();return o?e.jsx(m.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(m.Header,{children:['Edit "',t.title,'" profile']}),e.jsxs(m.Content,{children:[e.jsx(G,{action:"edit",profile:t}),";"]})]})};export{ge as RemovalProfileAddSidePanel,_e as RemovalProfileDetailsSidePanel,ve as RemovalProfileEditSidePanel,je as RemovalProfileList,ye as RemovalProfilesEmptyState,be as RemovalProfilesHeader,E as useRemovalProfiles};
