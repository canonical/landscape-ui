import{r as g,j as e,o as p,J as y,q as u,am as d,f as x,c as h,u as f,d as _,e as j}from"./index-CNSDWj8Q.js";import{P as v,a as E,b}from"./PageMain-C8MVZwda.js";import{a as C}from"./TablePagination-CFXNvqsZ.js";import{T as P}from"./TruncatedCell-BMum6DLZ.js";import{u as T}from"./useExpandableRow-B4jhRgod.js";import{R as L}from"./ResponsiveTable-BXalKviy.js";import{u as w,T as R}from"./TableFilterChips-06YfpJdc.js";import{H as D}from"./HeaderWithSearch-D2tNhOlz.js";import{T as F}from"./TableFilter-2AKF5NjJ.js";import"./Truncated-Dtg97i8C.js";const H="_message_1hc9t_1",I={message:H},S=n=>({index:s})=>{const t={};return n===s&&(t.className="expandedRow"),t},N=n=>({column:s,row:{index:t}})=>{const a={};return s.id==="creation_time"?a.role="rowheader":s.id==="person_name"?a["aria-label"]="username":s.id==="entity_type"?a["aria-label"]="entity type":s.id==="entity_name"?a["aria-label"]="entity name":s.id==="message"&&(a["aria-label"]="message",n===t&&(a.className="expandedCell")),a},M=({eventsLog:n})=>{const{expandedRowIndex:s,getTableRowsRef:t,handleExpand:a}=T(),l=g.useMemo(()=>[{accessor:"creation_time",Header:"creation time",className:"date-cell",Cell:({row:o})=>e.jsx("span",{className:"font-monospace",children:p(o.original.creation_time).format(y)})},{accessor:"person_name",Header:"username",Cell:({row:o})=>e.jsx(e.Fragment,{children:o.original.person_name})},{accessor:"entity_type",Header:"entity type",Cell:({row:o})=>e.jsx(e.Fragment,{children:o.original.entity_type})},{accessor:"entity_name",Header:"entity name",Cell:({row:o})=>e.jsx(e.Fragment,{children:o.original.entity_name})},{accessor:"message",className:I.message,Header:"message",Cell:({row:{original:o,index:r}})=>e.jsx(P,{content:o.message,isExpanded:r===s,onExpand:()=>{a(r)}})}],[n,s]);return e.jsx("div",{ref:t,children:e.jsx(L,{columns:l,data:n,emptyMsg:"No events found according to your search parameters.",getCellProps:N(s),getRowProps:S(s),minWidth:1200})})},Y=()=>{const{days:n,setPageParams:s}=u();return w("days",d.map(t=>t.value)),e.jsx(F,{type:"single",label:"Days",showSelectionOnToggleLabel:!0,hasToggleIcon:!0,options:d,onItemSelect:t=>{s({days:t})},selectedItem:n.toString()})},k=()=>e.jsxs(e.Fragment,{children:[e.jsx(D,{actions:e.jsx(Y,{})}),e.jsx(R,{filtersToDisplay:["search"]})]});function A(){const n=x();return{getEventsLog:(t,a={})=>h({queryKey:["events",t],queryFn:async()=>n.get("events",{params:t}),...a})}}const O=(n,s)=>{const t=["creation_time","person_id","person_name","entity_type","entity_id","entity_name","message"],l=[["Creation Time","Person ID","Person Name","Entity Type","Entity ID","Entity Name","Message"].join(","),...n.map(c=>t.map(m=>c[m]).join(","))].join(`\r
`),o=new Blob([l],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(o),i=document.createElement("a");i.href=r,i.download=s,document.body.appendChild(i),i.click(),document.body.removeChild(i)},Z=()=>{const{days:n,search:s,currentPage:t,pageSize:a}=u(),{user:l}=f(),{getEventsLog:o}=A(),{data:r,isLoading:i}=o({days:Number(n),limit:a,offset:(t-1)*a,search:s}),c=g.useMemo(()=>r?.data.results.filter(m=>m.message.toLowerCase().includes(s.toLowerCase()))??[],[r,s]);return e.jsxs(v,{children:[e.jsx(E,{sticky:!0,title:"Events log",actions:[e.jsx(_.Button,{type:"button",onClick:()=>{O(c,`Event Log - ${l.current_account}-${p().format("YYYY-MM-DDTHH mm ss[Z]")}.csv`)},children:"Download as CSV"},"download-as-cv")]}),e.jsxs(b,{children:[e.jsx(k,{}),i&&e.jsx(j,{}),!i&&c&&e.jsx(M,{eventsLog:c}),e.jsx(C,{totalItems:r?.data.count,currentItemCount:c.length})]})]})};export{Z as default};
