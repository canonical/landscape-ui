import{j as t,r as b,o as w,p as P,O as H,g as f,m as j,n as K,q as R,f as V}from"./index-DNI6uvRV.js";import{S as Y}from"./SidePanelFormButtons-D5fqMSQT.js";import{u as M}from"./index-CX-ZX-r_.js";import{a as A}from"./usePackages-C6Oauan0.js";import{D as z}from"./downshift.esm-CpLdwKhJ.js";import"./SidePanelFormButtons.module-tJTvEwdD.js";import"./usePageParams-CWR0Fwx8.js";import"./TablePagination-DXfnTgHQ.js";import"./TablePaginationBase-CT2gxC4B.js";import"./StatusFilter-z9qaOlXP.js";import"./TableFilter-Cvx0X4Gf.js";import"./TableFilterChips-CZ0FoPkD.js";import"./useFetchOld-HjUAte7_.js";import"./NoData-n05VdZwW.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new e.Error().stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="442cf9ad-166f-405f-9531-a6291f63049c",e._sentryDebugIdIdentifier="sentry-dbid-442cf9ad-166f-405f-9531-a6291f63049c")}catch{}const G=200,J=(e,n)=>{const o=e.toLowerCase(),i=n.toLowerCase(),a=o.indexOf(i);return a>=0?t.jsxs(t.Fragment,{children:[e.substring(0,a),t.jsx("strong",{children:e.substring(a,a+n.length)}),e.substring(a+n.length)]}):e},W="_container_10sit_1",X="_suggestionsContainer_10sit_5",Z="_pointer_10sit_12",ee="_highlighted_10sit_17",te="_selectedContainer_10sit_21",g={container:W,suggestionsContainer:X,pointer:Z,highlighted:ee,selectedContainer:te},se=({selectedItems:e,setSelectedItems:n})=>{var D;const[o,i]=b.useState(""),[a,c]=b.useState(!1),[r,p]=b.useState(""),{instanceId:x}=w(),_=P(),{getInstancePackagesQuery:S}=A(),y=Number(x),{data:d,isFetching:l}=S({instance_id:y,available:!0,installed:!1,upgrade:!1,held:!1,limit:50,search:o},{enabled:o.length>2}),m=((D=d==null?void 0:d.data)==null?void 0:D.results)??[],T=s=>!e.map(u=>u.name).includes(s.name),k=m.filter(T),B=s=>{n(e.filter(u=>u.name!==s))},E=()=>{c(!1)},I=()=>{p(""),i("")},C=()=>{r.length>2?c(!0):c(!1)},O=s=>{p(s),s.length>2&&i(s)},$=H(()=>{try{C()}catch(s){_(s)}},G),F=s=>{n([...e,s]),I()},L=s=>{s&&(F(s),c(!1))},q=s=>{s.key==="Escape"?s.currentTarget.blur():$()},N=!a&&r.length<3?"Min 3. characters":m.length===0&&o&&!l?`No packages found by "${o}"`:null;return t.jsxs("div",{className:g.container,children:[t.jsx(z,{onSelect:L,itemToString:()=>"",isOpen:a,children:({getInputProps:s,getItemProps:u,getMenuProps:Q,highlightedIndex:U})=>t.jsxs("div",{className:"p-autocomplete",children:[t.jsx(f.SearchBox,{...s(),placeholder:"Search for available packages",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:r,onChange:O,onClear:I,onBlur:E,onFocus:C,onKeyUp:q}),N?t.jsx("span",{className:"p-form-help-text",children:N}):null,a&&(k.length>0||l)?t.jsx("ul",{className:j("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",g.suggestionsContainer),...Q(),children:l?t.jsx(K,{}):k.map((h,v)=>t.jsxs("li",{className:j("p-list__item",g.pointer,{[g.highlighted]:U===v}),...u({item:h,index:v}),children:[t.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:J(h.name,o)}),t.jsx("div",{children:t.jsx("small",{className:"u-text-muted",children:h.available_version})})]},h.name))}):null]})}),t.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:e.length?e.map(s=>t.jsxs("li",{className:j("p-autocomplete__result p-list__item p-card u-no-margin--bottom",g.selectedContainer),children:[t.jsxs("div",{children:[t.jsx("div",{children:s.name}),t.jsx("small",{className:"u-text--muted p-text--small",children:s.available_version})]}),t.jsx(f.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom",onClick:()=>B(s.name),children:t.jsx(f.Icon,{name:f.ICONS.delete})})]},s.name)):null})]})},xe=()=>{const[e,n]=b.useState([]),{instanceId:o,childInstanceId:i}=w(),a=P(),{notify:c}=R(),{packagesActionQuery:r}=A(),{closeSidePanel:p}=V(),{openActivityDetails:x}=M(),_=Number(i??o),{mutateAsync:S,isPending:y}=r,d=async()=>{try{const{data:l}=await S({action:"install",computer_ids:[_],package_ids:e.map(({id:m})=>m)});p(),c.success({title:`You queued ${e.length===1?`package ${e[0].name}`:`${e.length} packages`} to be installed.`,message:`${e.length===1?`${e[0].name} package`:`${e.length} selected packages`} will be installed and are queued in Activities.`,actions:[{label:"Details",onClick:()=>x(l)}]})}catch(l){a(l)}};return t.jsxs(t.Fragment,{children:[t.jsx(se,{selectedItems:e,setSelectedItems:l=>n(l)}),t.jsx(Y,{submitButtonDisabled:y||e.length===0,submitButtonText:"Install packages",submitButtonAppearance:"positive",onSubmit:d})]})};export{xe as default};
