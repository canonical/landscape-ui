const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B6cD-yUb.js","assets/index-YlcVILYq.js","assets/index-DAy43ny_.css","assets/index-C-Cemkxt.css"])))=>i.map(i=>d[i]);
import{m as _,j as e,d as s,r as d,q as P,a1 as S,K as k,O as o,M as q,B as F,a0 as B,F as N}from"./index-YlcVILYq.js";const A="_container_1yori_1",E="_backButton_1yori_14",T="_chevronIcon_1yori_19",l={container:A,backButton:E,chevronIcon:T},V=d.lazy(()=>S(()=>import("./index-B6cD-yUb.js"),__vite__mapDeps([0,1,2,3]))),L=({action:n})=>{const{closeSidePanel:r,setSidePanelContent:i}=_(),u=()=>{i("Choose an identity provider",e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(V,{})}))};return e.jsxs("div",{className:l.container,children:[n==="add"&&e.jsxs(s.Button,{type:"button",hasIcon:!0,onClick:u,className:l.backButton,children:[e.jsx(s.Icon,{name:"chevron-up",className:l.chevronIcon}),e.jsx("span",{children:"Back"})]}),e.jsx(s.Button,{type:"button",onClick:r,appearance:"base",className:"u-no-margin--bottom",children:"Cancel"}),e.jsx(s.Button,{type:"submit",appearance:"positive",className:"u-no-margin--bottom",children:n==="edit"?"Save changes":"Add ID provider"})]})},w={client_id:"",client_secret:"",enabled:!1,issuer:"",name:""},D=n=>k().shape({client_id:(n==null?void 0:n.provider)==="ubuntu-one"?o():o().required("This field is required"),client_secret:(n==null?void 0:n.provider)==="ubuntu-one"?o():o().required("This field is required"),enabled:q(),issuer:(n==null?void 0:n.provider)==="ubuntu-one"?o():o().url().required("This field is required"),name:(n==null?void 0:n.provider)==="ubuntu-one"?o():o().required("This field is required")}),$="_urlContainer_1l27h_1",O="_url_1l27h_1",h={urlContainer:$,url:O},H=n=>{const{action:r,provider:i}=n,u=F(),{closeSidePanel:p}=_(),{getSingleProviderQuery:f,addProviderQuery:x,updateProviderQuery:g,toggleUbuntuOneQuery:j}=B(),{data:a}=f({providerId:r==="edit"?i.id:0},{enabled:r==="edit"&&i.provider!=="ubuntu-one"}),{mutateAsync:y}=x,{mutateAsync:I}=g,{mutateAsync:v}=j,t=N({initialValues:w,onSubmit:async c=>{const b={configuration:{issuer:c.issuer,client_id:c.client_id,client_secret:c.client_secret,name:c.name,provider:r==="add"?i.provider_slug:i.provider},enabled:c.enabled};try{r==="add"?await y(b):i.provider==="ubuntu-one"?await v({ubuntu_one:c.enabled}):await I({...b,providerId:i.id}),p()}catch(C){u(C)}},validationSchema:D(r==="edit"?i:null)});d.useEffect(()=>{r!=="edit"||i.provider!=="ubuntu-one"||t.setFieldValue("enabled",i.enabled)},[r,i]),d.useEffect(()=>{a&&t.setValues({client_id:a.data.configuration.client_id,client_secret:a.data.configuration.client_secret,enabled:a.data.enabled,issuer:a.data.configuration.issuer,name:a.data.configuration.name})},[a]);const m=r==="edit"&&!n.canBeDisabled&&(a==null?void 0:a.data.enabled);return e.jsxs(s.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[(r!=="edit"||i.provider!=="ubuntu-one")&&e.jsxs("div",{className:h.urlContainer,children:[e.jsx("span",{children:"Redirect URL "}),e.jsx(s.Icon,{name:"information"}),e.jsx("code",{className:h.url,children:r==="add"?i.redirect_uri:a==null?void 0:a.data.redirect_uri}),e.jsx("p",{className:"p-text--small u-text--muted u-no-margin--bottom",children:"You will need to set this in the configuration of your identity provider."})]}),e.jsx(s.Tooltip,{message:m&&"At least one identity provider must be active on the Landscape account.",children:e.jsx(s.Input,{type:"checkbox",label:"Enabled",...t.getFieldProps("enabled"),checked:t.values.enabled,disabled:m,help:`If checked the identity provider will be enabled. ${r==="add"?"when it is created.":"for logging in."}`})}),(r!=="edit"||i.provider!=="ubuntu-one")&&e.jsxs(e.Fragment,{children:[e.jsx(s.Input,{type:"text",label:"Name",required:!0,...t.getFieldProps("name"),autoComplete:"off",error:t.touched.name&&t.errors.name?t.errors.name:void 0}),e.jsx(s.Input,{type:"text",label:"Client ID",required:!0,...t.getFieldProps("client_id"),autoComplete:"off",error:t.touched.client_id&&t.errors.client_id?t.errors.client_id:void 0}),e.jsx(s.Input,{type:"text",label:"Client Secret",required:!0,...t.getFieldProps("client_secret"),autoComplete:"off",error:t.touched.client_secret&&t.errors.client_secret?t.errors.client_secret:void 0}),e.jsx(s.Input,{type:"url",label:"Issuer",required:!0,...t.getFieldProps("issuer"),autoComplete:"off",error:t.touched.issuer&&t.errors.issuer?t.errors.issuer:void 0})]}),e.jsx(L,{action:r})]})};export{H as default};
