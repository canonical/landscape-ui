import{f as C,t as p,v as S,b as j,A as I,y as g,B as A,j as t,d as i,G as h,N as b,u as x,$ as L,P as y,R as f,a as E,r as F,e as P,al as N}from"./index-CNSDWj8Q.js";import{A as w}from"./AuthTemplate-BV-qJbFV.js";import{g as d}from"./formikErrors-Bw8iTXYS.js";import{V as _,I as v,a as T,b as V}from"./constants-DcOGIsSH.js";import{P as q}from"./PasswordConstraints-Cxjd4DDU.js";import"./constants-Byx_TwUc.js";const U=()=>{const n=C(),a=p(),{isPending:s,mutateAsync:o}=S({mutationFn:async e=>n.post("accounts",e),onSuccess:async()=>{await a.invalidateQueries({queryKey:["authUser"]})}});return{createSaaSAccount:o,isCreatingSaaSAccount:s}},H=()=>{const n=p(),a=j.create({baseURL:I}),{isPending:s,mutateAsync:o}=S({mutationFn:async e=>a.post("standalone-account",e),onSuccess:async()=>{await n.invalidateQueries({queryKey:["standaloneAccount"]})}});return{createStandaloneAccount:o,isCreatingStandaloneAccount:s}},R="_button_1t6xj_1",O={button:R},$=()=>{const n=g(),{createSaaSAccount:a,isCreatingSaaSAccount:s}=U(),e=A({initialValues:v,validationSchema:_,onSubmit:async c=>{try{await a({title:c.title})}catch(m){n(m)}}});return t.jsxs(w,{title:"Create a new Landscape SaaS account",children:[t.jsx(i.Notification,{severity:"caution",children:"There is no Landscape organization related to your account."}),t.jsxs(i.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[t.jsx(i.Input,{type:"text",label:"Organization name",required:!0,help:"This will be the name of the Landscape account for your organization.",...e.getFieldProps("title"),error:d(e,"title")}),t.jsx(i.ActionButton,{className:h("u-no-margin--bottom",O.button),appearance:"positive",type:"submit",loading:s,disabled:s,children:"Create account"})]})]})},k="_button_1t6xj_1",z={button:k},M=()=>{const n=g(),a=b(),{setUser:s}=x(),{createStandaloneAccount:o,isCreatingStandaloneAccount:e}=H(),{login:c}=L(),r=A({initialValues:V,validationSchema:T,onSubmit:async u=>{try{await o({name:u.fullName,email:u.email,password:u.password});const{data:l}=await c({email:u.email,password:u.password});"current_account"in l?(s(l),a(y,{replace:!0})):a(f.auth.login(),{replace:!0})}catch(l){n(l)}}});return t.jsx(w,{title:"Create a new Landscape account",children:t.jsxs(i.Form,{onSubmit:r.handleSubmit,noValidate:!0,children:[t.jsx(i.Input,{type:"text",label:"Full name",required:!0,autoComplete:"name",...r.getFieldProps("fullName"),error:d(r,"fullName")}),t.jsx(i.Input,{type:"email",label:"Email address",required:!0,autoComplete:"email",...r.getFieldProps("email"),error:d(r,"email")}),t.jsx(i.PasswordToggle,{id:"password",label:"Password",required:!0,autoComplete:"new-password",...r.getFieldProps("password")}),t.jsx(q,{password:r.values.password,touched:!!r.touched.password,hasError:!!r.errors.password}),t.jsx(i.ActionButton,{className:h(z.button,"u-no-margin--bottom"),appearance:"positive",type:"submit",loading:e,disabled:e||!r.isValid||!r.dirty,children:"Create account"})]})})},W=()=>{const{authorized:n,authLoading:a,hasAccounts:s}=x(),{isSelfHosted:o,envLoading:e}=E(),c=b();return F.useEffect(()=>{if(!(a||e)){if(!o&&!n){c(f.auth.login(),{replace:!0});return}s&&c(y,{replace:!0})}},[n,a,e,s,o,c]),a||e?t.jsx(P,{}):!o&&!n?t.jsx(N,{}):o?t.jsx(M,{}):t.jsx($,{})};export{W as default};
