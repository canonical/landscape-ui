const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DeuvLz8S.js","assets/index-DMXNEIi7.js","assets/index-C0ZxZ9J6.css","assets/SelectAllButton-DkNGZMy4.js","assets/ExpandableTableFooter-BJmlkZ0P.js","assets/ExpandableTableFooter-DWm8zyWg.css","assets/useUsns-CNAF_U73.js","assets/useFetchOld-CbtR_FJp.js","assets/useUsns-D2X0CFCl.css","assets/index-opcF9JuM.css","assets/index-BpeDdeiM.js","assets/index-DXCgn1fK.css","assets/index-ByYwjuiP.js","assets/UsnList-CIOVrmwD.js","assets/moment-BFprfAlu.js","assets/NoData-Bf6AVw5n.js","assets/TablePagination-C2Qj9oCi.js","assets/usePageParams-0jCHbpdj.js","assets/TablePaginationBase-ilpj99iv.js","assets/TablePaginationBase-CJl3HN1X.css","assets/TruncatedCell-Cb2wnXwF.js","assets/TruncatedCell-CoXbu3VM.css","assets/helpers-Fm1c994r.js","assets/helpers-CCHFURK6.css","assets/UsnList-B4hAwQmb.css"])))=>i.map(i=>d[i]);
import{j as e,m as U,r,_ as o,h,v as u,k as A,l as b,p as E,q as v,f as I,s as T,g as k,M as L,n as C}from"./index-DMXNEIi7.js";import{S as V}from"./SidePanelFormButtons-M1h5Bq-w.js";import{a as N,u as B}from"./useUsns-CNAF_U73.js";import"./moment-BFprfAlu.js";import"./SidePanelFormButtons.module-C5v714vX.js";import"./useFetchOld-CbtR_FJp.js";const D=({instances:c})=>{const t=c.filter(({upgrades:n})=>n==null?void 0:n.security).length,l=c.filter(({upgrades:n})=>n==null?void 0:n.regular).length,a=c.filter(({upgrades:n})=>!(n!=null&&n.security)&&!(n!=null&&n.regular)).length;return e.jsxs("div",{children:[e.jsx("span",{children:"You selected "}),e.jsx("span",{children:e.jsx("b",{children:c.length})}),e.jsx("span",{children:" instances:"}),e.jsxs("ul",{className:U({"u-no-margin--bottom":a>0}),children:[t>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Security upgrades are available for "}),e.jsx("b",{children:t}),e.jsx("span",{children:t!==1?" instances":" instance"})]}),l>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Regular upgrades are available for "}),e.jsx("b",{children:l}),e.jsx("span",{children:l!==1?" instances":" instance"})]})]}),a>0&&e.jsxs("p",{children:[e.jsx("span",{children:"No upgrades for "}),e.jsx("span",{children:e.jsx("b",{children:a})}),e.jsx("span",{children:a!==1?" instances needed.":" instance needed."})]})]})},m=[{id:"tab-link-instances",label:"Instances"},{id:"tab-link-packages",label:"Packages"},{id:"tab-link-usns",label:"USNs"}],x={instances:r.lazy(()=>o(()=>import("./index-DeuvLz8S.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),packages:r.lazy(()=>o(()=>import("./index-BpeDdeiM.js"),__vite__mapDeps([10,1,2,6,7,8,3,4,5,11]))),usns:r.lazy(()=>o(()=>import("./index-ByYwjuiP.js"),__vite__mapDeps([12,1,2,13,14,3,4,5,15,16,17,18,19,20,21,6,7,8,22,23,24])))},F=h().shape({excludedPackages:u().of(h().shape({id:A().required(),exclude_packages:u().of(b())})),excludedUsns:u().of(b())}),R=({activeTabLinkId:c,onTabLinkClick:t,withUsnsTab:l})=>m.filter(({id:a})=>l||a!=="tab-link-usns").map(({id:a,label:n})=>({id:a,label:n,active:a===c,onClick:()=>t(a),role:"tab"})),$=c=>({excludedPackages:c.map(({id:t})=>({id:t,exclude_packages:[]})),excludedUsns:[]}),Q=({selectedInstances:c})=>{const[t,l]=r.useState(m[0].id),a=c.filter(({upgrades:s})=>(s==null?void 0:s.security)||(s==null?void 0:s.regular)),n=a.filter(({upgrades:s})=>s==null?void 0:s.security),j=E(),{notify:g}=v(),{closeSidePanel:f}=I(),{upgradeInstancesPackagesQuery:p}=N(),{upgradeUsnsQuery:P}=B(),{mutateAsync:_}=p,{mutateAsync:y}=P,S=async s=>{try{t==="tab-link-usns"?await y({computers:n.map(({id:d})=>({id:d,exclude_usns:s.excludedUsns}))}):await _({computers:s.excludedPackages}),f(),g.success({title:"You queued packages to be upgraded",message:`Packages on ${c.length} ${c.length!==1?"instances":"instance"} will be upgraded and are queued in Activities`})}catch(d){j(d)}},i=T({initialValues:$(a),onSubmit:S,validationSchema:F});return e.jsxs(k.Form,{onSubmit:i.handleSubmit,children:[e.jsx(D,{instances:c}),e.jsx(k.Tabs,{links:R({activeTabLinkId:t,onTabLinkClick:s=>l(s),withUsnsTab:n.length>0})}),e.jsx(L,{children:e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":t,children:e.jsxs(r.Suspense,{fallback:e.jsx(C,{}),children:[t==="tab-link-instances"&&e.jsx(x.instances,{excludedPackages:i.values.excludedPackages,instances:a,onExcludedPackagesChange:s=>i.setFieldValue("excludedPackages",s)}),t==="tab-link-packages"&&e.jsx(x.packages,{excludedPackages:i.values.excludedPackages,instances:a,onExcludedPackagesChange:s=>i.setFieldValue("excludedPackages",s)}),t==="tab-link-usns"&&e.jsx(x.usns,{excludedUsns:i.values.excludedUsns,instances:n,onExcludedUsnsChange:s=>i.setFieldValue("excludedUsns",s)})]})})}),e.jsx(V,{submitButtonDisabled:i.isSubmitting,submitButtonText:"Upgrade"})]})};export{Q as Upgrades};
