import{r as x,m as y,a as k,e as _,l as $,j as e,g,h as N,R as L,p as T}from"./index-DjN6NDkk.js";import{E as w}from"./EmptyState-DDT28izc.js";import{u as j}from"./useUsns-DPh-HGpW.js";import"./TablePagination.module-DLVph1Z1.js";import{T as A}from"./TablePagination-BvT4Pax9.js";import{u as q}from"./useConfirm-DfWcK83z.js";import{u as f}from"./usePageParams-WA20WKVO.js";import{U as E}from"./UsnList-CW5HXSp5.js";import"./helpers-BfuBH7Ij.js";import"./useFetchOld-D4uGCnIe.js";import"./useMutation-CPZ6Lp07.js";import"./useQuery-CsSPQ_-7.js";import"./moment-B5xCd7tk.js";import"./TruncatedCell-DEc4JXrs.js";import"./ExpandableTableFooter-BCT3haHm.js";import"./ExpandableTableFooter.module-C3W6TVe_.js";import"./useOnClickOutside-goKTcTdD.js";const D="_container_viyqm_1",B="_searchContainer_viyqm_5",F="_cta_viyqm_9",h={container:D,searchContainer:B,cta:F},V=({onSearch:o,usns:t})=>{const[a,c]=x.useState(""),{instanceId:r,childInstanceId:i}=y(),{setPageParams:d}=f(),s=k(),n=_(),{notify:m}=$(),{confirmModal:l,closeConfirmModal:I}=q(),{upgradeUsnPackagesQuery:b}=j(),p=Number(r),{mutateAsync:P,isLoading:C}=b,U=()=>{s(`${L}instances/${i?`${p}/${i}`:`${p}`}`),d({tab:"activities"}),m.clear()},v=async()=>{try{await P({instanceId:p,usns:t}),m.success({title:"You queued packages to be upgraded",message:`Affected packages for ${t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:U}]})}catch(u){n(u)}finally{I()}},S=()=>{l({title:"Upgrade affected packages",body:`This will upgrade affected packages for ${t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`}.`,buttons:[e.jsx(g.Button,{appearance:"positive",onClick:v,disabled:C,"aria-label":"Upgrade selected packages",children:"Upgrade"},"upgrade")]})};return e.jsxs("div",{className:h.container,children:[e.jsx("div",{className:h.searchContainer,children:e.jsx(g.Form,{onSubmit:u=>{u.preventDefault(),o(a)},noValidate:!0,children:e.jsx(g.SearchBox,{shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:a,onChange:u=>c(u),onSearch:()=>o(a),onClear:()=>{c(""),o("")}})})}),e.jsx("div",{className:N("p-segmented-control",h.cta),children:e.jsxs(g.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:S,disabled:t.length===0,children:[e.jsx(g.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]})})]})},H=({instanceTitle:o,isUsnsLoading:t,totalUsnCount:a,usns:c})=>{const[r,i]=x.useState([]),{search:d,setPageParams:s}=f(),n=()=>{i([])},m=l=>{s({search:l}),n()};return e.jsxs(e.Fragment,{children:[e.jsx(V,{onSearch:m,usns:r.map(({usn:l})=>l)}),e.jsx(E,{tableType:"paginated",instanceTitle:o,isUsnsLoading:t,onSelectedUsnsChange:l=>i(l),search:d,selectedUsns:r,usns:c}),c.length>0&&e.jsx(A,{handleClearSelection:n,totalItems:a,currentItemCount:c.length})]})},M=({instanceTitle:o})=>{const{instanceId:t}=y(),{search:a,currentPage:c,pageSize:r}=f(),{getUsnsQuery:i}=j(),d=Number(t),{data:s,isLoading:n}=i({computer_ids:[d],limit:r,offset:(c-1)*r,search:a,show_packages:!1});return e.jsxs(e.Fragment,{children:[!a&&n&&e.jsx(T,{}),!a&&!n&&(!s||s.data.results.length===0)&&e.jsx(w,{icon:"inspector-debug",title:"No security issues found"}),(a||!n&&s&&s.data.results.length>0)&&e.jsx(H,{instanceTitle:o,isUsnsLoading:n,totalUsnCount:(s==null?void 0:s.data.count)??0,usns:(s==null?void 0:s.data.results)??[]})]})},oe=M;export{oe as default};
