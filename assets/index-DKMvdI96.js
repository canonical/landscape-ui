const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-kKgd4Xf1.js","assets/index-ByADQnPs.js","assets/index-DCq_vsqr.css","assets/UdebCheckboxInput-CR7BGFP3.js","assets/UdebCheckboxInput-mCgCMP_S.css","assets/debug-uw8QfFou.js","assets/useGPGKeys-WnooBs3Z.js","assets/useFetchOld-DIFbHJtm.js","assets/debug-CHNhm1j1.css","assets/MultiSelectField-B7EQUV_5.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-BH8h4yK5.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/formikErrors-Bw8iTXYS.js","assets/constants-BDEyAs-R.js","assets/usePageParams-5nFqhiQZ.js","assets/NoData-DItfLEGM.js","assets/index-BCZPLs2V.js","assets/TablePagination-BQvrOeIR.js","assets/TablePaginationBase-C43SLHIs.js","assets/TablePaginationBase-CJl3HN1X.css","assets/StatusFilter-CTul-nBV.js","assets/TableFilter-BS-fqEh_.js","assets/TableFilter-CNw_lMaf.css","assets/TableFilterChips-B0xVlNvZ.js","assets/TableFilterChips-CHqetGbX.css","assets/index-CRv_aeRB.css","assets/constants-DhXkDRlN.css"])))=>i.map(i=>d[i]);
import{r as i,j as e,g as c,G as le,p as de,f as me,m as F,n as A,_ as ge}from"./index-ByADQnPs.js";import{S as ue}from"./SidePanelTablePagination-D9MRkld_.js";import"./usePageParams-5nFqhiQZ.js";import{f as fe,p as pe}from"./constants-BDEyAs-R.js";import"./TablePaginationBase-C43SLHIs.js";import"./useFetchOld-DIFbHJtm.js";import"./NoData-DItfLEGM.js";import"./index-BCZPLs2V.js";import"./TablePagination-BQvrOeIR.js";import"./StatusFilter-CTul-nBV.js";import"./TableFilter-BS-fqEh_.js";import"./TableFilterChips-B0xVlNvZ.js";const he="_version_sfav3_1",Pe="_content_sfav3_5",Q={version:he,content:Pe},ke=({isUpload:o,packagesToShow:n,search:s,selectedPackages:l,setSelectedPackages:u})=>{const m=i.useMemo(()=>[{accessor:"packageName",Header:({rows:t})=>o?e.jsxs(e.Fragment,{children:[e.jsx(c.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),disabled:!t.length,indeterminate:!!l.length&&l.length<t.length,checked:l.length===t.length&&!!l.length,onChange:()=>{u(d=>d.length?[]:t.map((h,x)=>x))}}),e.jsx("span",{children:"Package"})]}):"Package",Cell:({row:t})=>o?e.jsx(c.CheckboxInput,{inline:!0,label:t.original.packageName,checked:l.includes(t.index),onChange:()=>{u(d=>d.includes(t.index)?d.filter(h=>h!==t.index):[...d,t.index])}}):t.original.packageName},{accessor:"packageVersion",Header:"Version",getCellIcon:({row:t})=>t.original.difference?"warning":!1,className:Q.version,Cell:({row:t})=>t.original.difference?e.jsx(c.Tooltip,{position:"top-center",message:t.original.difference==="delete"?"Package deleted":`Version differs
from parent pocket.
Parent version:
${t.original.newVersion}`,children:e.jsx("span",{children:t.original.packageVersion})}):t.original.packageVersion}],[n,l.length]);return e.jsx(c.ModularTable,{columns:m,data:n,emptyMsg:s?`No packages found with the search: "${s}".`:void 0,className:Q.content,getCellProps:({column:t})=>{switch(t.id){case"packageName":return{role:"rowheader"};case"packageVersion":return{"aria-label":"Version"};default:return{}}}})},xe="_ctaRow_qlsck_1",je={ctaRow:xe},be=i.lazy(async()=>ge(()=>import("./index-kKgd4Xf1.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]))),k=1,H=20,Me=({distributionName:o,pocket:n,seriesName:s})=>{const[l,u]=i.useState(k),[m,t]=i.useState(H),[d,h]=i.useState([]),[x,O]=i.useState(!1),[_,D]=i.useState(""),[j,v]=i.useState(""),[R,U]=i.useState([]),B=le("(max-width: 619px)"),E=de(),{setSidePanelContent:q,closeSidePanel:G}=me(),{listPocketQuery:K,diffPullPocketQuery:J,pullPackagesToPocketQuery:W,syncMirrorPocketQuery:X,removePackagesFromPocketQuery:Y,removePocketQuery:Z}=fe(),{mutate:N,isPending:T}=X,{mutate:ee,isPending:M}=W,ne=()=>{n.mode==="mirror"?N({name:n.name,series:s,distribution:o}):n.mode==="pull"&&ee({name:n.name,series:s,distribution:o})},te=()=>{q(`Edit ${n.name} pocket`,e.jsx(i.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(be,{pocket:n,distributionName:o,seriesName:s})}))},{mutateAsync:ae,isPending:S}=Z,oe=async()=>{try{await ae({distribution:o,series:s,name:n.name}),G()}catch(a){E(a)}},{mutateAsync:se,isPending:b}=Y,z=!T&&!M&&!b&&!S,{data:C,isLoading:I}=K({name:n.name,series:s,distribution:o,search:j,limit:m,offset:l*m-m},{enabled:z}),$=(C==null?void 0:C.data)??{count:0,results:[]},f=$.results.map(a=>({packageName:a.name,packageVersion:a.version})),{data:y}=J({name:n.name,series:s,distribution:o},{enabled:n.mode==="pull"&&!I&&z});i.useEffect(()=>{const a=(y==null?void 0:y.data)??{},r=[];for(const g in a){const p={add:[],update:[],delete:[],...a[g]};for(const[P,V]of p.add)r.push({packageName:P,newVersion:V,difference:"add"});(p.update.length||p.delete.length)&&O(!0);for(const[P,,V]of p.update)r.push({packageName:P,newVersion:V,difference:"update"});for(const[P]of p.delete)r.push({packageName:P,difference:"delete",newVersion:""})}U(r)},[y]);const ce=()=>x?(f.forEach((a,r)=>{const g=R.find(({packageName:p})=>a.packageName===p);g&&(f[r].difference=g.difference,g.newVersion!==""&&(f[r].newVersion=g.newVersion))}),[...f.filter(({difference:a})=>a),...f.filter(({difference:a})=>!a)]):f,L=i.useMemo(()=>ce(),[l,m,j,x,f.length,R.length]),re=async()=>{const a=L.filter((r,g)=>d.includes(g)).map(({packageName:r})=>r);try{await se({name:n.name,series:s,distribution:o,packages:a})}catch(r){E(r)}},w=!j&&l===k&&m===H&&!$.count,ie=n.mode==="upload"?{size:8,medium:4}:{size:6,medium:3};return e.jsxs(e.Fragment,{children:[e.jsxs(c.Row,{className:F("u-no-padding--left u-no-padding--right",je.ctaRow),children:[e.jsx(c.Col,{...ie,children:e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[n.mode!=="upload"&&e.jsx(c.Button,{className:"p-segmented-control__button",type:"button",onClick:ne,disabled:T&&M,"aria-label":n.mode==="mirror"?`Synchronize ${n.name} pocket of ${o}/${s}`:`Pull packages to ${n.name} pocket of ${o}/${s}`,children:n.mode==="mirror"?"Sync":"Pull"}),e.jsx(c.Button,{className:"p-segmented-control__button",type:"button",onClick:te,"aria-label":`Edit ${n.name} pocket of ${o}/${s}`,children:"Edit"}),e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button",type:"button","aria-label":`Remove ${n.name} pocket of ${o}/${s}`,confirmationModalProps:{title:"Deleting pocket",children:e.jsxs("p",{children:["Do you really want to delete ",n.name," pocket from"," ",s," series of ",o," distribution?"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:S,confirmButtonLoading:S,onConfirm:oe},children:"Remove"}),n.mode==="upload"&&e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:!d.length||b,"aria-label":`Remove selected packages from ${n.name} pocket of ${o}/${s}`,confirmationModalProps:{title:"Deleting packages from pocket",children:e.jsxs("p",{children:["This will delete ",d.length," selected"," ",pe(d.length,"package","packages")," ","from ",n.name," pocket ",s," series of"," ",o," distribution"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:b,confirmButtonLoading:b,onConfirm:re},children:"Remove packages"})]})})}),n.mode!=="upload"&&!w&&e.jsx(c.Col,{size:6,medium:3,children:e.jsx(c.Form,{onSubmit:a=>{a.preventDefault(),v(_),u(k)},noValidate:!0,children:e.jsx(c.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,"aria-label":"Package search",onChange:a=>{D(a)},value:_,onClear:()=>{D(""),v(""),u(k)},className:F({"is-dense":!B,"u-no-margin--bottom":B}),onSearch:()=>{v(_),u(k)},autocomplete:"off"})})})]}),I?e.jsx(A,{}):w?e.jsx("p",{children:"No packages found"}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{isUpload:n.mode==="upload",packagesToShow:L,search:j,selectedPackages:d,setSelectedPackages:h}),e.jsx(ue,{currentPage:l,totalItems:$.count,paginate:a=>{h([]),u(a)},pageSize:m,setPageSize:a=>{t(a)}})]})]})};export{Me as default};
