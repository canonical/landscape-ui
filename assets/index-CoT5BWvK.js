const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D5pWmPtq.js","assets/index-BRihK9aF.js","assets/index-DgLN2HdX.css","assets/UdebCheckboxInput-D3APk8fG.js","assets/UdebCheckboxInput-mCgCMP_S.css","assets/debug-_fCIGEYo.js","assets/debug-CHNhm1j1.css","assets/MultiSelectField-60LuLhWg.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-BFlViY8c.js","assets/SidePanelFormButtons.module-C5v714vX.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/useGPGKeys-gIl3sZeS.js","assets/useFetchOld-CpP6IFJx.js","assets/constants-DdAECAFq.js","assets/usePageParams-iyOWMaH2.js","assets/NoData-UXVxwgLt.js","assets/index-ClUtLbQ0.js","assets/TablePagination-5Vy8vn_p.js","assets/TablePaginationBase-BoGPMhhk.js","assets/TablePaginationBase-CJl3HN1X.css","assets/StatusFilter-BGKMvabJ.js","assets/TableFilter-BXUu-Qwz.js","assets/TableFilter-DXBG6q86.css","assets/TableFilterChips-BIIQiaEm.js","assets/TableFilterChips-CHqetGbX.css","assets/index-geI-abAU.css","assets/constants-DhXkDRlN.css"])))=>i.map(i=>d[i]);
import{r as d,z as ne,p as ae,f as te,j as n,g as i,m as w,n as M,_ as oe}from"./index-BRihK9aF.js";import{S as se}from"./SidePanelTablePagination-MIdg0Mph.js";import"./usePageParams-iyOWMaH2.js";import{e as re}from"./constants-DdAECAFq.js";import"./TablePaginationBase-BoGPMhhk.js";import"./useFetchOld-CpP6IFJx.js";import"./NoData-UXVxwgLt.js";import"./index-ClUtLbQ0.js";import"./TablePagination-5Vy8vn_p.js";import"./StatusFilter-BGKMvabJ.js";import"./TableFilter-BXUu-Qwz.js";import"./TableFilterChips-BIIQiaEm.js";const ie="_ctaRow_31lfx_1",ce="_version_31lfx_5",le="_content_31lfx_9",R={ctaRow:ie,version:ce,content:le},de=d.lazy(()=>oe(()=>import("./index-D5pWmPtq.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),be=({distributionName:s,pocket:a,seriesName:r})=>{const[f,k]=d.useState(1),[m,L]=d.useState(20),[l,j]=d.useState([]),[V,E]=d.useState(!1),[y,B]=d.useState(""),[u,_]=d.useState(""),D=ne("(max-width: 619px)"),T=ae(),{setSidePanelContent:z,closeSidePanel:F}=te(),{listPocketQuery:I,diffPullPocketQuery:Q,pullPackagesToPocketQuery:A,syncMirrorPocketQuery:H,removePackagesFromPocketQuery:O,removePocketQuery:U}=re(),{mutate:K,isPending:b}=H,{mutate:q,isPending:S}=A,G=()=>{a.mode==="mirror"?K({name:a.name,series:r,distribution:s}):a.mode==="pull"&&q({name:a.name,series:r,distribution:s})},J=()=>{z(`Edit ${a.name} pocket`,n.jsx(d.Suspense,{fallback:n.jsx(M,{}),children:n.jsx(de,{pocket:a,distributionName:s,seriesName:r})}))},{mutateAsync:W,isPending:x}=U,X=async()=>{try{await W({distribution:s,series:r,name:a.name}),F()}catch(e){T(e)}},{mutateAsync:Y,isPending:p}=O,Z=async()=>{const e=C.filter((t,o)=>l.includes(o)).map(({packageName:t})=>t);try{await Y({name:a.name,series:r,distribution:s,packages:e})}catch(t){T(t)}},{data:c,isLoading:h}=I({name:a.name,series:r,distribution:s,search:u,limit:m,offset:(f-1)*m},{enabled:!b&&!S&&!p&&!x}),g=[];if(c)for(const e of c.data.results)g.push({packageName:e.name,packageVersion:e.version});const{data:v}=Q({name:a.name,series:r,distribution:s},{enabled:a.mode==="pull"&&!h&&!b&&!S&&!p&&!x}),P=[];if(v)for(const e in v.data){const t=v.data[e];if(t.add)for(const o of t.add)P.push({packageName:o[0],newVersion:o[1],difference:"add"});if(t.update){E(!0);for(const o of t.update)P.push({packageName:o[0],newVersion:o[2],difference:"update"})}if(t.delete){E(!0);for(const o of t.delete)P.push({packageName:o[0],difference:"delete",newVersion:""})}}const N=()=>V?(g.forEach((e,t)=>{const o=P.find(({packageName:$})=>e.packageName===$);o&&(g[t].difference=o.difference,o.newVersion!==""&&(g[t].newVersion=o.newVersion))}),g.sort((e,t)=>e.difference&&!t.difference?-1:!e.difference&&t.difference?1:0)):g,C=d.useMemo(()=>N(),[f,m,u,V,g.length,P.length]),ee=d.useMemo(()=>[{accessor:"packageName",Header:({rows:e})=>a.mode==="upload"?n.jsxs(n.Fragment,{children:[n.jsx(i.CheckboxInput,{inline:!0,label:n.jsx("span",{className:"u-off-screen",children:"Toggle all"}),disabled:e.length===0,indeterminate:l.length>0&&l.length<e.length,checked:l.length===e.length&&l.length>0,onChange:()=>{j(t=>t.length>0?[]:e.map((o,$)=>$))}}),n.jsx("span",{children:"Package"})]}):"Package",Cell:({row:e})=>a.mode==="upload"?n.jsx(i.CheckboxInput,{inline:!0,label:e.original.packageName,checked:l.includes(e.index),onChange:()=>{j(t=>t.includes(e.index)?t.filter(o=>o!==e.index):[...t,e.index])}}):e.original.packageName},{accessor:"packageVersion",Header:"Version",getCellIcon:({row:e})=>e.original.difference?"warning":!1,className:R.version,Cell:({row:e})=>{var t;return e.original.difference?n.jsx(i.Tooltip,{position:"top-center",message:e.original.difference==="delete"?"Package deleted":`Version differs
from parent pocket.
Parent version:
${(t=e.original)==null?void 0:t.newVersion}`,children:n.jsx("span",{children:e.original.packageVersion})}):e.original.packageVersion}}],[C,l.length]);return n.jsxs(n.Fragment,{children:[n.jsxs(i.Row,{className:w("u-no-padding--left u-no-padding--right",R.ctaRow),children:[n.jsx(i.Col,{size:a.mode==="upload"?8:6,medium:a.mode==="upload"?4:3,children:n.jsx("div",{className:"p-segmented-control",children:n.jsxs("div",{className:"p-segmented-control__list",children:[(a.mode=="mirror"||a.mode=="pull")&&n.jsx(i.Button,{className:"p-segmented-control__button",type:"button",onClick:G,disabled:b&&S,"aria-label":a.mode==="mirror"?`Synchronize ${a.name} pocket of ${s}/${r}`:`Pull packages to ${a.name} pocket of ${s}/${r}`,children:a.mode==="mirror"?"Sync":"Pull"}),n.jsx(i.Button,{className:"p-segmented-control__button",type:"button",onClick:J,"aria-label":`Edit ${a.name} pocket of ${s}/${r}`,children:"Edit"}),n.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button","aria-label":`Remove ${a.name} pocket of ${s}/${r}`,confirmationModalProps:{title:"Deleting pocket",children:n.jsxs("p",{children:["Do you really want to delete ",a.name," pocket from"," ",r," series of ",s," distribution?"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:x,confirmButtonLoading:x,onConfirm:X},children:"Remove"}),a.mode==="upload"&&n.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:l.length===0||p,"aria-label":`Remove selected packages from ${a.name} pocket of ${s}/${r}`,confirmationModalProps:{title:"Deleting packages from pocket",children:n.jsxs("p",{children:["This will delete ",l.length," selected"," ",l.length===1?"package":"packages"," ","from ",a.name," pocket ",r," series of"," ",s," distribution"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:p,confirmButtonLoading:p,onConfirm:Z},children:"Remove packages"})]})})}),(a.mode==="pull"||a.mode==="mirror")&&(u||f!==1||m!==20||!h&&c&&c.data.count>0)&&n.jsx(i.Col,{size:6,medium:3,children:n.jsx(i.Form,{onSubmit:e=>{e.preventDefault(),_(y),k(1)},noValidate:!0,children:n.jsx(i.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,"aria-label":"Package search",onChange:e=>{B(e)},value:y,onClear:()=>{B(""),_(""),k(1)},className:w({"is-dense":!D,"u-no-margin--bottom":D}),onSearch:()=>{_(y),k(1)},autocomplete:"off"})})})]}),h&&n.jsx(M,{}),!u&&f===1&&m===20&&!h&&(!c||!c.data.count)&&n.jsx("p",{children:"No packages found"}),!h&&(u||f!==1||m!==20||c&&c.data.count>0)&&n.jsxs(n.Fragment,{children:[n.jsx(i.ModularTable,{columns:ee,data:C,emptyMsg:u?`No packages found with the search: "${u}".`:void 0,className:R.content,getCellProps:({column:e})=>{switch(e.id){case"packageName":return{role:"rowheader"};case"packageVersion":return{"aria-label":"Version"};default:return{}}}}),n.jsx(se,{currentPage:f,totalItems:c==null?void 0:c.data.count,paginate:e=>{j([]),k(e)},pageSize:m,setPageSize:e=>{L(e)}})]})]})};export{be as default};
