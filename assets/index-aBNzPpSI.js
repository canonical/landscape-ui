import{R,a as A,b as T}from"./index-XLBOAHpO.js";import{i as j,f as I,g as N,H as z,P as f,M as _,J as g,K as p,A as D,m as E,B as M,C as q,F as y,j as e,aQ as $,n as l,o as b}from"./index-2G8kPGdZ.js";import{A as k}from"./AssociationBlock-EqxJPBP5.js";import{M as O}from"./MultiSelectField-D8ghYzhC.js";import{S as B}from"./SidePanelFormButtons-C_hG8wcn.js";import{u as H}from"./useRoles-Delhp72k.js";import{p as V}from"./helpers-j2KgSda4.js";function Q(){const r=j(),a=I(),d=N({mutationKey:["rebootprofiles","create"],mutationFn:async c=>r.post("rebootprofiles",c),onSuccess:async()=>a.invalidateQueries({queryKey:["rebootprofiles"]})}),{mutateAsync:u,isPending:n}=d;return{createRebootProfile:u,isCreatingRebootProfile:n}}function K(){const r=j(),a=I(),d=N({mutationKey:["rebootprofiles","edit"],mutationFn:async({id:c,...h})=>r.patch(`rebootprofiles/${c}`,h),onSuccess:async()=>a.invalidateQueries({queryKey:["rebootprofiles"]})}),{mutateAsync:u,isPending:n}=d;return{editRebootProfile:u,isEditingRebootProfile:n}}const v={add:"added",edit:"updated",duplicate:"added"},L={add:"Add reboot profile",duplicate:"Add reboot profile",edit:"Save changes"},x=[{label:"Sunday",order:0,value:"su"},{label:"Monday",order:1,value:"mo"},{label:"Tuesday",order:2,value:"tu"},{label:"Wednesday",order:3,value:"we"},{label:"Thursday",order:4,value:"th"},{label:"Friday",order:5,value:"fr"},{label:"Saturday",order:6,value:"sa"}],G=`If Landscape cannot reboot the
associated instances by this point,
the reboot will be cancelled.`,Y=r=>z().shape({title:p().test({name:"required",message:"This field is required.",test:a=>!!a||r!=="add"}),access_group:p(),all_computers:g(),at_hour:_().required("Hour is required.").integer("Hour must be an integer.").min(0,"Hour must be between 0 and 23.").max(23,"Hour must be between 0 and 23."),at_minute:_().required("Minute is required.").integer("Minute must be an integer.").min(0,"Minute must be between 0 and 59.").max(59,"Minute must be between 0 and 59."),randomize_delivery:g(),deliver_delay_window:_().when("randomize_delivery",{is:!0,then:a=>a.required("This field is required.").integer("This field must be an integer.").max(43200,"Deliver delay window in minutes must be a number less than or equal to 30 days (43200 minutes)").test((d,{createError:u,parent:n})=>d<parseInt(n.deliver_within)*60||u({message:`Deliver delay window of '${d}' minutes should be shorter than the 'deliver within' expiration time of ${n.deliver_within} ${n.deliver_within==="1"?"hour":"hours"}.`})).min(0,"Deliver delay window must be at least 0.")}),deliver_within:_().integer("'Expires after' must be an integer.").min(0,"'Expires after' must be at least 0."),tags:f().of(p()),on_days:f().of(p()).min(1,"At least one day must be selected.")}),J=(r,a)=>{var c;if(r.action==="add")return{title:"",access_group:((c=a==null?void 0:a[0])==null?void 0:c.value)||"",all_computers:!1,randomize_delivery:!1,deliver_delay_window:"",tags:[],at_hour:"",at_minute:"",deliver_within:0,on_days:[]};const{at_hour:d,at_minute:u,on_days:n}=V(r.profile.schedule);return{title:r.action==="duplicate"?`${r.profile.title} (copy)`:r.profile.title,access_group:r.profile.access_group,all_computers:r.profile.all_computers,randomize_delivery:!!r.profile.deliver_delay_window,deliver_delay_window:r.profile.deliver_delay_window.toString()||"",tags:r.profile.tags,at_hour:d,at_minute:u,deliver_within:r.profile.deliver_within,on_days:n}},U="_container_1es1y_1",W="_radioGroup_1es1y_7",X="_timeContainer_1es1y_13",Z="_time_1es1y_13",ee="_timeInput_1es1y_27",ie="_inputDescriptionAfter_1es1y_32",te="_colon_1es1y_37",re="_tooltip_1es1y_43",oe="_expiration_1es1y_47",ae="_windowInputContainer_1es1y_54",se="_windowInput_1es1y_54",ne="_windowInputDescription_1es1y_63",o={container:U,radioGroup:W,timeContainer:X,time:Z,timeInput:ee,inputDescriptionAfter:ie,colon:te,tooltip:re,expiration:oe,windowInputContainer:ae,windowInput:se,windowInputDescription:ne},P=r=>{const{getAccessGroupQuery:a}=H(),d=D(),{closeSidePanel:u}=E(),{notify:n}=M(),{data:c}=a(),{createRebootProfile:h,isCreatingRebootProfile:S}=Q(),{editRebootProfile:F,isEditingRebootProfile:C}=K(),w=(c==null?void 0:c.data.map(({name:t,title:m})=>({label:m,value:t})))??[],i=q({initialValues:J(r,w),enableReinitialize:!0,onSubmit:async t=>{try{r.action==="edit"?await F({id:r.profile.id,access_group:t.access_group,at_hour:Number(t.at_hour),at_minute:Number(t.at_minute),deliver_delay_window:t.randomize_delivery?Number(t.deliver_delay_window):0,deliver_within:Number(t.deliver_delay_window),on_days:t.on_days,title:t.title,tags:t.tags,every:"week",all_computers:t.all_computers}):await h({title:t.title,tags:t.tags,access_group:t.access_group,on_days:t.on_days,every:"week",at_hour:Number(t.at_hour),at_minute:Number(t.at_minute),deliver_delay_window:t.randomize_delivery?Number(t.deliver_delay_window):0,deliver_within:Number(t.deliver_within),all_computers:t.all_computers}),u(),n.success({message:`Reboot profile "${t.title}" has been ${v[r.action]} `,title:`Reboot profile ${v[r.action]}`})}catch(m){d(m)}},validationSchema:Y(r.action)}),s=[y(i,"at_hour"),y(i,"at_minute"),y(i,"deliver_within")];return e.jsx($,{value:i,children:e.jsxs(l.Form,{onSubmit:i.handleSubmit,noValidate:!0,children:[e.jsx(l.Input,{type:"text",label:"Name",required:r.action==="add",...i.getFieldProps("title"),error:i.touched.title&&i.errors.title}),e.jsx(l.Select,{label:"Access group","aria-label":"Access group",options:w,...i.getFieldProps("access_group"),error:y(i,"access_group")}),e.jsxs("div",{className:o.container,children:[e.jsx("p",{className:"p-heading--5",children:"Schedule"}),e.jsx(O,{variant:"condensed",label:"Days",items:x,selectedItems:x.filter(({value:t})=>i.values.on_days.includes(t)),onItemsUpdate:async t=>i.setFieldValue("on_days",t.map(({value:m})=>m)),isSortedAlphabetically:!1,hasSelectedItemsFirst:!1,error:i.touched.on_days&&typeof i.errors.on_days=="string"?i.errors.on_days:void 0}),e.jsxs("div",{className:o.timeContainer,children:[e.jsxs("div",{className:o.time,children:[e.jsxs(e.Fragment,{children:[e.jsx(l.Input,{type:"number",label:"Time","aria-label":"at hour",placeholder:"HH",className:o.timeInput,wrapperClassName:b({"is-error":s[0]}),...i.getFieldProps("at_hour"),"aria-errormessage":s[0]?"hour-error":void 0}),e.jsx("span",{className:o.colon,children:":"})]}),e.jsx(l.Input,{type:"number",label:"At minute",labelClassName:"u-off-screen","aria-label":"at minute",className:o.timeInput,wrapperClassName:b({"is-error":s[1]}),placeholder:"MM",...i.getFieldProps("at_minute"),"aria-errormessage":s[1]?"minute-error":void 0}),e.jsx(l.Input,{type:"number",label:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Expires after "}),e.jsx(l.Tooltip,{message:G,position:"top-right",tooltipClassName:o.tooltip,children:e.jsx(l.Icon,{name:"help"})})]}),wrapperClassName:b(o.expiration,{"is-error":s[2]}),className:o.timeInput,...i.getFieldProps("deliver_within"),"aria-errormessage":"expires-error"}),e.jsx("span",{className:o.inputDescriptionAfter,children:"hours"})]}),s.filter(Boolean).length>0&&e.jsxs("div",{className:b({"is-error":s.filter(Boolean).length>0}),children:[s[0]&&e.jsx("p",{className:"p-form-validation__message",id:"hour-error",children:e.jsx("span",{children:s[0]})}),s[1]&&e.jsx("p",{className:"p-form-validation__message",id:"minute-error",children:e.jsx("span",{children:s[1]})}),s[2]&&e.jsxs("p",{className:"p-form-validation__message",id:"expires-error",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:s[2]})]})]})]}),e.jsx("p",{children:"Randomise delivery over a time window"}),e.jsxs("div",{className:o.radioGroup,children:[e.jsx(l.RadioInput,{label:"No",...i.getFieldProps("randomize_delivery"),checked:!i.values.randomize_delivery,onChange:async()=>{await i.setFieldValue("randomize_delivery",!1),await i.setFieldValue("deliver_delay_window","")}}),e.jsx(l.RadioInput,{label:"Yes",...i.getFieldProps("randomize_delivery"),checked:i.values.randomize_delivery,onChange:async()=>i.setFieldValue("randomize_delivery",!0)})]}),i.values.randomize_delivery&&e.jsxs("div",{className:o.windowInputContainer,children:[e.jsx(l.Input,{type:"number",inputMode:"numeric",min:0,label:"Deliver delay window",labelClassName:"u-off-screen",className:o.windowInput,...i.getFieldProps("deliver_delay_window"),error:i.touched.deliver_delay_window&&i.errors.deliver_delay_window?i.errors.deliver_delay_window:void 0}),e.jsx("span",{className:o.windowInputDescription,children:"minutes"})]})]}),e.jsx(k,{formik:i}),e.jsx(B,{submitButtonText:L[r.action],submitButtonDisabled:i.isSubmitting||S||C})]})})},ye=Object.freeze(Object.defineProperty({__proto__:null,default:P},Symbol.toStringTag,{value:"Module"})),be=Object.freeze(Object.defineProperty({__proto__:null,RebootProfilesContainer:R,RebootProfilesForm:P,RebootProfilesHeader:A,RebootProfilesList:T},Symbol.toStringTag,{value:"Module"}));export{be as a,ye as i};
