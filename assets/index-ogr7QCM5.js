import{c as Z,e as M,l as K,j as e,h as P,g as o,r as g,o as $,L as ee,R as W,B as G,_ as T,f as Y}from"./index-DXs1haZl.js";import{P as te,a as se,b as ne}from"./PageMain-DhSBVwHg.js";import{S as ae}from"./SearchHelpPopup-CCs3NejY.js";import"./TablePagination.module-DLVph1Z1.js";import{T as re}from"./TablePagination-DZ07rvb4.js";import{u as oe}from"./useFetchOld-DWTVWZGf.js";import{u as D}from"./useMutation-CoMMCR6r.js";import{u as ie}from"./useQuery-DPA9mHwu.js";import{u as J}from"./useConfirm-C9Ai5vPv.js";import{a as ce,u as le}from"./useOnClickOutside-C-WOPQdE.js";import{u as de}from"./formik.esm-CwYJvJSO.js";import{c as ue,a as he}from"./index.esm-FGh7VWBq.js";import{u as X}from"./usePageParams-BJqFm8Ol.js";import{u as z}from"./useInstances-B3fQT90b.js";import{h as B}from"./moment-Cl4UOzQZ.js";import{N as L}from"./NoData-BmTO_w1O.js";import{S as b}from"./constants-C0eAoEXY.js";const V=()=>{const s=oe(),n=Z(),a=(i={},p={})=>ie({queryKey:["savedSearches",i],queryFn:()=>s.get("GetSavedSearches",{params:i}),...p}),r=D({mutationFn:i=>s.get("CreateSavedSearch",{params:i}),onSuccess:()=>n.invalidateQueries(["savedSearches"])}),h=D({mutationFn:i=>s.get("EditSavedSearch",{params:i}),onSuccess:()=>n.invalidateQueries(["savedSearches"])}),u=D({mutationFn:i=>s.get("RemoveSavedSearch",{params:i}),onSuccess:()=>n.invalidateQueries(["savedSearches"])});return{getSavedSearchesQuery:a,createSavedSearchQuery:r,editSavedSearchQuery:h,removeSavedSearchQuery:u}},pe="_container_5hvuq_1",me="_list_5hvuq_6",ge="_listItem_5hvuq_11",xe="_search_5hvuq_17",je="_row_5hvuq_25",fe="_truncated_5hvuq_33",k={container:pe,list:me,listItem:ge,search:xe,row:je,truncated:fe},_e=({onSavedSearchClick:s,onSavedSearchRemove:n,savedSearches:a})=>{if(!a.length)return null;const r=M(),{notify:h}=K(),{closeConfirmModal:u,confirmModal:i}=J(),{removeSavedSearchQuery:p}=V(),{mutateAsync:l}=p,j=async t=>{try{await l({name:t}),n(),h.success({message:`Saved search ${t} successfully removed`,title:"Saved search removed"})}catch(c){r(c)}finally{u()}},y=t=>{i({title:"Remove saved search",body:`This will remove the saved search "${t}"`,buttons:[e.jsx(o.Button,{type:"button",appearance:"negative",onClick:()=>j(t),"aria-label":`Remove ${t} search`,children:"Remove"},"remove")]})};return e.jsxs("div",{className:k.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Saved searches"}),e.jsx("ul",{className:P("p-list--divided u-no-margin--bottom",k.list),children:a.map(t=>e.jsx("li",{children:e.jsxs("div",{className:k.listItem,children:[e.jsx(o.Button,{appearance:"base",className:k.search,onClick:()=>s(t),children:e.jsxs(o.Row,{className:k.row,children:[e.jsx(o.Col,{size:4,children:e.jsx(o.Tooltip,{message:t.name,positionElementClassName:k.truncated,children:e.jsx("span",{children:t.name})})}),e.jsx(o.Col,{size:8,children:e.jsx(o.Tooltip,{message:t.search,positionElementClassName:k.truncated,children:e.jsx("span",{children:t.search})})})]})}),e.jsx(o.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding--bottom u-no-padding--top",onClick:()=>y(t.name),"aria-label":`Remove ${t.title} search`,children:e.jsx(o.Icon,{name:"delete"})})]})},t.name))})]})},be=({containerRef:s,onDismiss:n,onOverflowingItemsAmountChange:a,searchData:r})=>{const h=()=>{if(!s.current)return;const i=s.current.querySelectorAll("span.p-chip");a(Array.from(i).filter(({offsetHeight:p,offsetTop:l})=>l>p).length)};ce("resize",h),g.useEffect(()=>{h()},[r.length]);const u=i=>i.title?i.title:i.quoteValue?`'${i.value}'`:i.value;return r.map(i=>e.jsx(o.Chip,{value:u(i),lead:i.lead,onDismiss:()=>n(i.value)},i.value))},ye="_infoContainer_drsz5_1",ve="_amount_drsz5_9",Se="_helpButtonContainer_drsz5_14",Ce="_helpButton_drsz5_14",q={infoContainer:ye,amount:ve,helpButtonContainer:Se,helpButton:Ce},we=({isExpanded:s,onHelpButtonClick:n,overflowingChipsAmount:a})=>e.jsxs("div",{className:q.infoContainer,children:[a>0&&!s&&e.jsx("span",{className:P("u-text--muted",q.amount),children:`+${a}`}),e.jsx("div",{className:q.helpButtonContainer,children:e.jsx(o.Button,{type:"button",appearance:"base",hasIcon:!0,className:q.helpButton,onClick:r=>{r.stopPropagation(),n()},children:e.jsx(o.Icon,{name:"help"})})})]}),ke=({onClose:s,onSearchSave:n,search:a})=>{const r=M(),{notify:h}=K(),{createSavedSearchQuery:u}=V(),{mutateAsync:i}=u,l=de({initialValues:{name:""},onSubmit:async({name:j})=>{try{await i({search:a,name:j,title:j}),h.success({message:`Saved search ${j} successfully added`,title:"Saved search added"}),n(),s()}catch(y){r(y)}},validationSchema:ue({name:he().required("This field is required").test({message:"Name must consist of only lowercase alphanumeric characters and hyphens",test:j=>/^[a-z0-9][-a-z0-9]*$/.test(j)})})});return e.jsxs(o.Form,{onSubmit:l.handleSubmit,noValidate:!0,children:[e.jsx(o.Input,{type:"text",autoComplete:"off",autoFocus:!0,label:"Search name",...l.getFieldProps("name"),error:l.touched.name&&l.errors.name?l.errors.name:void 0}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(o.Button,{type:"button",disabled:l.isSubmitting,onClick:s,children:"Cancel"}),e.jsx(o.Button,{type:"submit",disabled:l.isSubmitting,appearance:"positive","aria-label":`Saved search as ${l.values.name}`,children:"Save search"})]})]})},Ie="_container_fqj7b_1",Ne="_prompt_fqj7b_10",$e="_saveButton_fqj7b_17",U={container:Ie,prompt:Ne,saveButton:$e},Ae=({onSearchSave:s,search:n})=>{const[a,r]=g.useState(!1);return e.jsxs(e.Fragment,{children:[n&&a&&e.jsx(ke,{onClose:()=>r(!1),onSearchSave:s,search:n}),n&&!a&&e.jsxs("div",{className:U.container,children:[e.jsxs("span",{className:U.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:n}),e.jsx("span",{children:"..."})]}),e.jsx(o.Button,{type:"button",appearance:"link",onClick:()=>r(!0),className:U.saveButton,children:"Save search"})]})]})},Re="_searchContainer_17q9j_1",Pe="_form_17q9j_5",Be="_searchBoxContainer_17q9j_10",Le="_input_17q9j_14",F={searchContainer:Re,form:Pe,searchBoxContainer:Be,input:Le},qe=(s,n)=>s.length===n.length&&s.every((a,r)=>a.value===n[r].value),Fe=(s,n)=>!s||!n?[]:s.split(",").map(a=>{const r=n.find(({name:h})=>h===a);return r?{lead:"search",title:r.name,value:r.name}:{value:a,quoteValue:!0}}),Ee=({onHelpButtonClick:s,returnSearchData:n,existingSearchData:a})=>{const{search:r,setPageParams:h}=X(),[u,i]=g.useState(""),[p,l]=g.useState(!1),[j,y]=g.useState(0),{getSavedSearchesQuery:t}=V(),c=g.useRef(null),d=g.useRef(null);le(c,()=>{l(!1)});const A=x=>{h({search:r.split(",").filter(v=>v!==x).join(",")})},{data:f,isLoading:N}=t(),C=Fe(r,f==null?void 0:f.data);qe(a,C)||n(C);const m=g.useMemo(()=>f?!u&&!C.length?f.data:f.data.filter(({search:x})=>C.every(({value:v})=>v!==x)).filter(({title:x,search:v})=>x.toLowerCase().includes(u.trim().toLowerCase())||v.toLowerCase().includes(u.trim().toLowerCase())):[],[f,u,C]),w=()=>{u&&(h({search:`${r}${r?",":""}${u}`}),i(""))},O=x=>{h({search:`${r}${r?",":""}${x.name}`})},_=x=>{const{key:v}=x;p?(v==="Escape"&&l(!1),v==="Enter"&&w()):v==="Enter"&&l(!0)};return e.jsxs("div",{className:"p-search-and-filter",ref:c,children:[e.jsxs("div",{className:P("p-search-and-filter__search-container",F.searchContainer),"aria-expanded":p,ref:d,onClick:()=>l(!0),children:[e.jsx(be,{containerRef:d,onDismiss:A,onOverflowingItemsAmountChange:x=>y(x),searchData:C}),e.jsx(o.Form,{onSubmit:x=>{x.preventDefault(),w()},className:P("p-search-and-filter__box",F.form),children:e.jsx("div",{className:F.searchBoxContainer,children:e.jsx(o.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autocomplete:"off",className:F.input,value:u,onChange:x=>i(x),onClear:()=>i(""),onSearch:w,onClick:()=>l(!0),onKeyUp:_})})}),e.jsx(we,{isExpanded:p,onHelpButtonClick:s,overflowingChipsAmount:j})]}),p&&N&&e.jsx($,{}),p&&!N&&e.jsxs("div",{className:"p-search-and-filter__panel",children:[e.jsx(Ae,{onSearchSave:()=>i(""),search:u.trim()}),e.jsx(_e,{onSavedSearchClick:O,onSavedSearchRemove:()=>l(!0),savedSearches:m})]})]})},Te="_checkbox_okmcr_1",Oe="_rowHeader_okmcr_5",De="_nested_okmcr_8",Ue="_restartError_okmcr_12",He="_restartWarning_okmcr_16",Qe="_statusListItem_okmcr_20",Me="_statusContainer_okmcr_24",E={checkbox:Te,rowHeader:Oe,nested:De,restartError:Ue,restartWarning:He,statusListItem:Qe,statusContainer:Me},ze=({instances:s,selectedInstances:n,setSelectedInstances:a,groupBy:r})=>{const h=()=>{a(n.length!==0?[]:s)},u=t=>{if(r==="parent"&&t.original.children.length>0){const c=t.original.children.map(({id:d})=>d);n.some(({id:d})=>c.includes(d))?a(n.filter(({id:d})=>!c.includes(d))):a([...n,...t.original.children.map(d=>({...d,parent:t.original,children:[]}))])}else n.some(({id:c})=>c===t.original.id)?a(n.filter(({id:c})=>c!==t.original.id)):a([...n,t.original])},i=g.useMemo(()=>r==="parent"?s.map(t=>({...t,subRows:t.children.map(c=>({...c,parent:t,children:[]}))})):s,[s,r]),p=t=>{const c=n.map(({id:d})=>d);return r==="parent"&&!t.is_wsl_instance&&t.children.length>0?t.children.every(({id:d})=>c.includes(d))?"checked":t.children.some(({id:d})=>c.includes(d))?"indeterminate":"unchecked":c.includes(t.id)?"checked":"unchecked"},l=t=>{if(!t.distribution||!/\d{1,2}\.\d{2}/.test(t.distribution))return{icon:"",label:e.jsx(L,{})};if(!t.upgrades||!t.upgrades.security&&!t.upgrades.regular)return{icon:b.UpToDate.icon.color,label:b.UpToDate.label};if(t.upgrades.security)if(t.upgrades.regular){const c=`${t.upgrades.security} security, ${t.upgrades.regular} regular ${t.upgrades.regular===1?"upgrade":"upgrades"}`;return{icon:b.SecurityUpgradesAlert.icon.color,label:e.jsx(e.Fragment,{children:c})}}else return{icon:b.SecurityUpgradesAlert.icon.color,label:e.jsxs(e.Fragment,{children:[t.upgrades.security," security"," ",t.upgrades.security===1?"upgrade":"upgrades"]})};else return{icon:b.PackageUpgradesAlert.icon.color,label:e.jsxs(e.Fragment,{children:[t.upgrades.regular," regular"," ",t.upgrades.regular===1?"upgrade":"upgrades"]})}},j=t=>{const c=((t==null?void 0:t.alerts)??[]).filter(({type:d})=>!["PackageUpgradesAlert","SecurityUpgradesAlert"].includes(d));return t.reboot_required_flag?{icon:`${b.ComputerRebootAlert.icon.color}`,label:b.ComputerRebootAlert.alternateLabel??b.ComputerRebootAlert.label}:c.length===0?{icon:`${b.Online.icon.color}`,label:b.Online.alternateLabel??b.Online.label}:c.length===1?{icon:`${b[c[0].type].icon.color??b.Unknown.icon.color}`,label:e.jsx(e.Fragment,{children:c[0].summary})}:{label:e.jsx("span",{className:E.statusContainer,children:c.map(({type:d,summary:I})=>e.jsx("span",{className:E.statusListItem,children:e.jsx(o.Tooltip,{message:I,children:e.jsx(o.Icon,{className:"u-no-margin--left",name:`${b[d].icon.color??b.Unknown.icon.color}`})})},d))})}},y=g.useMemo(()=>[{accessor:"title",Header:e.jsxs(e.Fragment,{children:[e.jsx(o.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,onChange:h,disabled:s.length===0,checked:n.length===s.length&&s.length!==0,indeterminate:n.length!==0&&n.length<s.length}),e.jsx("span",{children:"Name"})]}),Cell:({row:t})=>e.jsxs("div",{className:P(E.rowHeader,{[E.nested]:t.depth>0}),children:[e.jsx(o.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:t.original.title}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:p(t.original)==="checked",indeterminate:p(t.original)==="indeterminate",onChange:()=>{u(t)}}),e.jsx(ee,{to:t.original.parent?`${W}instances/${t.original.parent.id}/${t.original.id}`:`${W}instances/${t.original.id}`,children:t.original.title})]})},{Header:"Status",accessor:"reboot_required_flag",Cell:({row:{original:t}})=>{const{label:c}=j(t);return c},getCellIcon:({row:{original:t}})=>{const{icon:c}=j(t);return c}},{Header:"Upgrades",Cell:({row:{original:t}})=>{const{label:c}=l(t);return c},getCellIcon:({row:{original:t}})=>{const{icon:c}=l(t);return c}},{accessor:"distribution",Header:"OS",Cell:({row:{original:t}})=>t.distribution?/\d{1,2}\.\d{2}/.test(t.distribution)?`${t.is_wsl_instance?"WSL - ":""}Ubuntu ${t.distribution}`:`Windows ${t.distribution}`:e.jsx(L,{})},{accessor:"ubuntu_pro_info",Header:"Ubuntu pro",Cell:({row:t})=>e.jsx(e.Fragment,{children:t.original.ubuntu_pro_info&&B(t.original.ubuntu_pro_info.expires).isValid()?`Exp. ${B(t.original.ubuntu_pro_info.expires).format(G)}`:e.jsx(L,{})})},{Header:"Host name",accessor:"hostname"},{Header:"Last ping time",accessor:"last_ping_time",Cell:({row:t})=>e.jsx(e.Fragment,{children:B(t.original.last_ping_time).isValid()?B(t.original.last_ping_time).format(G):e.jsx(L,{})})}],[n.length,s,r]);return e.jsx(e.Fragment,{children:e.jsx(o.ModularTable,{emptyMsg:"No instances found",columns:y,data:i})})},Ve=[{term:"<keyword>",description:e.jsxs("span",{children:["Instances with the title or hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"distribution:<keyword>",description:e.jsxs("span",{children:["Instances with the installed distribution named"," ",e.jsx("code",{children:"<keyword>"})]})},{term:"needs:reboot",description:"Instances needing a reboot"},{term:"alert:<type>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with outstanding alerts of the specified"," ",e.jsx("code",{children:"<type>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be ",e.jsx("code",{children:"package-upgrades"}),","," ",e.jsx("code",{children:"security-upgrades"}),",",e.jsx("code",{children:"package-profiles"}),","," ",e.jsx("code",{children:"package-reporter"}),", ",e.jsx("code",{children:"esm-disabled"}),","," ",e.jsx("code",{children:"computer-offline"}),",",e.jsx("code",{children:"computer-reboot"}),","," ",e.jsx("code",{children:"computer-duplicates"}),", ",e.jsx("code",{children:"unapproved-activities"}),"."]})]})},{term:"ip:<address>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with IP addresses like ",e.jsx("code",{children:"<address>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<address>"})," can be a fragment or partial IP address representing a subnet such as 91.185.94 to match any instances in the subnet."]})]})},{term:"mac:<address>",description:e.jsxs("span",{children:["Instances with the MAC address ",e.jsx("code",{children:"<address>"})]})},{term:"id:<instance_id>",description:e.jsxs("span",{children:["Instance with the id ",e.jsx("code",{children:"<instance_id>"})]})},{term:"access-group:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," access group"]})},{term:"search:<name>",description:e.jsxs("span",{children:["Instances meeting the terms of the ",e.jsx("code",{children:"<name>"})," saved search"]})},{term:"upgrade-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," upgrade profile"]})},{term:"removal-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," removal profile"]})},{term:"tag:<keyword>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<keyword>"})," tag"]})},{term:"hostname:<keyword>",description:e.jsxs("span",{children:["Instance with the hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"title:<keyword>",description:e.jsxs("span",{children:["Instance with the title ",e.jsx("code",{children:"<keyword>"})]})},{term:"license-id:<license_id>",description:e.jsxs("span",{children:["Search for instances licensed to the specified"," ",e.jsx("code",{children:"<license_id>"})]})},{term:"needs:license OR license-id:none",description:"Search for instances that do not have a Landscape license, and, as a result, are not managed"},{term:"annotation:<key>",description:e.jsxs("span",{children:["Search for instances which define the specified annotation key. Optionally specify ",e.jsx("code",{children:"annotation:<key>:<string>"})," ","which will only return instances whose key matches and value also contains the ",e.jsx("code",{children:"<string>"})," specified"]})}],H=["UpToDate","PackageUpgradesAlert","SecurityUpgradesAlert","PackageProfilesAlert","PackageReporterAlert","EsmDisabledAlert","ComputerOfflineAlert","ComputerOnlineAlert","ComputerRebootAlert","ComputerDuplicateAlert","UnapprovedActivitiesAlert"],S={os:{slug:"os",label:"OS",type:"select",options:[{label:"All",value:"",query:""},{label:"Ubuntu",value:"ubuntu",query:"NOT distribution:windows"},{label:"Windows",value:"windows",query:"distribution:windows"}]},groupBy:{slug:"groupBy",label:"Group by",type:"select",options:[{label:"None",value:"",query:""},{label:"Parent",value:"parent",query:"parent"}]},status:{slug:"status",label:"Status",type:"select",options:[{label:"All",value:"",query:""},...Object.values(b).filter(({alertType:s})=>H.includes(s)).sort((s,n)=>H.indexOf(s.alertType)-H.indexOf(n.alertType)).map(({label:s,filterValue:n,query:a})=>({label:s,value:n,query:a}))]}},We="_top_1y6w6_1",Ge="_select_1y6w6_11",Ke="_searchContainer_1y6w6_17",Ye="_widgets_1y6w6_21",R={top:We,select:Ge,searchContainer:Ke,widgets:Ye},Je=g.lazy(()=>T(()=>import("./index-BwYJGMqg.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Xe=()=>{const{setSidePanelContent:s}=Y(),{getPendingInstancesQuery:n}=z(),{data:a}=n();if(!a||!a.data.length)return null;const r=()=>{s("Review Pending Instances",e.jsx(g.Suspense,{fallback:e.jsx($,{}),children:e.jsx(Je,{instances:a.data})}),"large")};return e.jsxs(o.Notification,{severity:"information",title:"Pending instances",children:[e.jsx("span",{children:`You currently have ${a.data.length} pending
          	${a.data.length===1?"instance":"instances"}
          	awaiting your review and approval. `}),e.jsx(o.Button,{type:"button",appearance:"link",onClick:r,children:"Review Pending Instances"})]})},Q=(s,n)=>{var a;return s.type==="select"?((a=s.options.find(r=>r.value===n))==null?void 0:a.query)??"":""},Ze=({selectedInstances:s,setSelectedInstances:n})=>{const[a,r]=g.useState([]),[h,u]=g.useState(!1),{os:i,groupBy:p,status:l,currentPage:j,pageSize:y,setPageParams:t}=X(),{getInstancesQuery:c}=z(),d=Q(S.status,l),I=Q(S.os,i),A=Q(S.groupBy,p),{data:f,isLoading:N}=c({query:`${a.map(({lead:_,value:x,title:v})=>_&&v?`${_}:${v}`:x).join(" ")}${I??""} ${d}`.trim(),root_only:A==="parent",with_alerts:!0,with_upgrades:!0,limit:y,offset:(j-1)*y}),C=(f==null?void 0:f.data.results)??[],m=(f==null?void 0:f.data.count)??0,w=(_,x)=>{t({[_]:x})},O=()=>{n([])};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:R.top,children:[e.jsx("div",{className:R.searchContainer,children:e.jsx(Ee,{existingSearchData:a,onHelpButtonClick:()=>u(!0),returnSearchData:_=>r(_)})}),S.groupBy.type==="select"&&e.jsx(o.Select,{label:S.groupBy.label,wrapperClassName:R.select,className:"u-no-margin--bottom",options:S.groupBy.options,value:p,onChange:_=>w("groupBy",_.target.value)}),S.os.type==="select"&&e.jsx(o.Select,{label:S.os.label,wrapperClassName:R.select,className:"u-no-margin--bottom",options:S.os.options,value:i,onChange:_=>w("os",_.target.value)}),S.status.type==="select"&&e.jsx(o.Select,{label:S.status.label,wrapperClassName:R.select,className:"u-no-margin--bottom",options:S.status.options,value:l,onChange:_=>w("status",_.target.value)})]}),e.jsx(ae,{open:h,data:Ve,onClose:()=>{u(!1)}}),e.jsx(Xe,{}),N?e.jsx($,{}):e.jsx(ze,{instances:C,selectedInstances:s,setSelectedInstances:_=>{n(_)},groupBy:p}),e.jsx(re,{totalItems:m,handleClearSelection:O,currentItemCount:C.length})]})},et="_header_c9ifr_1",tt={header:et},st=g.lazy(()=>T(()=>import("./index-CqVCbaL2.js").then(s=>s.i),__vite__mapDeps([12,1,2,13,14,15,16,3,5,6,7,17,18,8,19,20,21])).then(s=>({default:s.RunInstanceScriptForm}))),nt=g.lazy(()=>T(()=>import("./index-D7wP5riy.js"),__vite__mapDeps([22,1,2,23,5,6,7,24,25,26,14,15,16,27,10,9,28,29,30,31,32,3,33,34,35,36]))),at=g.lazy(()=>T(()=>import("./index-KEcycnC3.js"),__vite__mapDeps([37,1,2,5,7,13,20,14,15,16,38]))),rt=()=>{const[s,n]=g.useState([]),a=M(),{setSidePanelContent:r}=Y(),{confirmModal:h,closeConfirmModal:u}=J(),{rebootInstancesQuery:i,shutdownInstancesQuery:p}=z(),{mutateAsync:l,isLoading:j}=i,{mutateAsync:y,isLoading:t}=p,c=async()=>{r("Run script",e.jsx(g.Suspense,{fallback:e.jsx($,{}),children:e.jsx(st,{query:`id:${s.map(({id:m})=>m).join(" id:")}`})}))},d=async()=>{try{await y({computer_ids:s.map(({id:m})=>m)})}catch(m){a(m)}finally{u()}},I=()=>{h({title:"Shutting down selected instances",body:`Are you sure you want to shutdown ${s.length} instance${s.length===1?"":"s"}?`,buttons:[e.jsx(o.Button,{appearance:"negative",onClick:d,children:"Shutdown"},"shutdown")]})},A=async()=>{try{await l({computer_ids:s.map(({id:m})=>m)})}catch(m){a(m)}finally{u()}},f=()=>{h({title:"Restarting selected instances",body:`Are you sure you want to restart ${s.length} instance${s.length===1?"":"s"}?`,buttons:[e.jsx(o.Button,{appearance:"negative",onClick:A,children:"Restart"},"restart")]})},N=()=>{r("Upgrades",e.jsx(g.Suspense,{fallback:e.jsx($,{}),children:e.jsx(nt,{selectedInstances:s})}),"large")},C=()=>{r(`Report for ${s.length===1?s[0].title:`${s.length} instances`}`,e.jsx(g.Suspense,{fallback:e.jsx($,{}),children:e.jsx(at,{instanceIds:s.map(({id:m})=>m)})}),"medium")};return e.jsxs(te,{children:[e.jsx(se,{title:"Instances",className:tt.header,actions:[e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(o.Button,{className:"p-segmented-control__button",type:"button",onClick:I,disabled:t||s.length===0,children:[e.jsx(o.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]}),e.jsxs(o.Button,{className:"p-segmented-control__button",type:"button",onClick:f,disabled:j||s.length===0,children:[e.jsx(o.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]}),e.jsxs(o.Button,{className:"p-segmented-control__button",type:"button",onClick:C,disabled:s.length===0,children:[e.jsx(o.Icon,{name:"status"}),e.jsx("span",{children:"View report"})]}),e.jsxs(o.Button,{className:"p-segmented-control__button",type:"button",onClick:c,disabled:s.length===0,children:[e.jsx(o.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]}),e.jsxs(o.Button,{className:"p-segmented-control__button",type:"button",onClick:N,disabled:s.length===0||s.every(({upgrades:m})=>!m||!m.regular&&!m.security),children:[e.jsx(o.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]})]})},"buttons")]}),e.jsx(ne,{children:e.jsx(Ze,{selectedInstances:s,setSelectedInstances:m=>{n(m)}})})]})},St=rt;export{St as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-BwYJGMqg.js","assets/index-DXs1haZl.js","assets/index-DzLy8aaC.css","assets/useConfirm-C9Ai5vPv.js","assets/useInstances-B3fQT90b.js","assets/useFetchOld-DWTVWZGf.js","assets/useMutation-CoMMCR6r.js","assets/useQuery-DPA9mHwu.js","assets/useRoles-CGNtMKpq.js","assets/NoData-BmTO_w1O.js","assets/moment-BF0UQeMK.js","assets/index-CoQBeqtS.css","assets/index-CqVCbaL2.js","assets/formik.esm-CwYJvJSO.js","assets/SidePanelFormButtons-Dtg_vQ52.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/EmptyState-BYL1pVz2.js","assets/EmptyState-BNXajmMK.css","assets/moment-Cl4UOzQZ.js","assets/index.esm-FGh7VWBq.js","assets/index-CnWz5K0S.css","assets/index-D7wP5riy.js","assets/useUsns-B3b7Nlk8.js","assets/useUsns-DRSsqQ1A.css","assets/HeaderWithSearch.module-ByXjIdeN.js","assets/HeaderWithSearch-CCRO5bRP.css","assets/UsnList-CVWiDSUl.js","assets/TruncatedCell-Dx_NjREl.js","assets/TruncatedCell-BIhicLLO.css","assets/ExpandableTableFooter-BvE1KnQN.js","assets/ExpandableTableFooter.module-C3W6TVe_.js","assets/ExpandableTableFooter-PHbaG9hU.css","assets/usePageParams-BJqFm8Ol.js","assets/helpers-BfuBH7Ij.js","assets/helpers-Cd2TCZfq.css","assets/useOnClickOutside-C-WOPQdE.js","assets/index-KEcycnC3.js","assets/index-X8X8N8QD.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
