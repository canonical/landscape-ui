import{a as A,b as R,c as T}from"./index-BsM5C7fO.js";import{b as v,e as j,f as I,G as E,Q as w,K as _,H as f,J as p,aa as D,p as z,n as q,q as M,s as O,t as b,j as e,b9 as $,d as n,o as h}from"./index-CAxb-9CO.js";import{A as G}from"./AssociationBlock-Dw3g1JSJ.js";import{M as k}from"./MultiSelectField-DhnvON4Z.js";import{S as H}from"./SidePanelFormButtons-THQX_GYS.js";import{u as Q}from"./useRoles-CwlY2G8P.js";import{p as V}from"./helpers-CeElQcBW.js";function B(){const r=v(),s=j(),l=I({mutationKey:["rebootprofiles","create"],mutationFn:async u=>r.post("rebootprofiles",u),onSuccess:async()=>s.invalidateQueries({queryKey:["rebootprofiles"]})}),{mutateAsync:d,isPending:c}=l;return{createRebootProfile:d,isCreatingRebootProfile:c}}function L(){const r=v(),s=j(),l=I({mutationKey:["rebootprofiles","edit"],mutationFn:async({id:u,...y})=>r.patch(`rebootprofiles/${u}`,y),onSuccess:async()=>s.invalidateQueries({queryKey:["rebootprofiles"]})}),{mutateAsync:d,isPending:c}=l;return{editRebootProfile:d,isEditingRebootProfile:c}}const g={add:"added",edit:"updated",duplicate:"added"},K={add:"Add reboot profile",duplicate:"Add reboot profile",edit:"Save changes"},x=[{label:"Sunday",order:0,value:"su"},{label:"Monday",order:1,value:"mo"},{label:"Tuesday",order:2,value:"tu"},{label:"Wednesday",order:3,value:"we"},{label:"Thursday",order:4,value:"th"},{label:"Friday",order:5,value:"fr"},{label:"Saturday",order:6,value:"sa"}],U=`If Landscape cannot reboot the
associated instances by this point,
the reboot will be canceled.`,Y=r=>E().shape({title:p().test({name:"required",message:"This field is required.",test:s=>!!s||r!=="add"}),access_group:p(),all_computers:f(),at_hour:_().required("Hour is required.").integer("Hour must be an integer.").min(0,"Hour must be between 0 and 23.").max(23,"Hour must be between 0 and 23."),at_minute:_().required("Minute is required.").integer("Minute must be an integer.").min(0,"Minute must be between 0 and 59.").max(59,"Minute must be between 0 and 59."),randomize_delivery:f(),deliver_delay_window:_().when("randomize_delivery",{is:!0,then:s=>s.required("This field is required.").integer("This field must be an integer.").max(43200,"Deliver delay window in minutes must be a number less than or equal to 30 days (43200 minutes)").test((l,{createError:d,parent:c})=>l<parseInt(c.deliver_within)*60||d({message:`Deliver delay window of '${l}' minutes should be shorter than the 'deliver within' expiration time of ${c.deliver_within} ${c.deliver_within==="1"?"hour":"hours"}.`})).min(0,"Deliver delay window must be at least 0.")}),deliver_within:_().integer("'Expires after' must be an integer.").min(0,"'Expires after' must be at least 0."),tags:w().of(p()),on_days:w().of(p()).min(1,"At least one day must be selected.")}),J=r=>{if(r.action==="add")return{title:"",access_group:D,all_computers:!1,randomize_delivery:!1,deliver_delay_window:"",tags:[],at_hour:"",at_minute:"",deliver_within:0,on_days:[]};const{at_hour:s,at_minute:l,on_days:d}=V(r.profile.schedule);return{title:r.action==="duplicate"?`${r.profile.title} (copy)`:r.profile.title,access_group:r.profile.access_group,all_computers:r.profile.all_computers,randomize_delivery:!!r.profile.deliver_delay_window,deliver_delay_window:r.profile.deliver_delay_window.toString()||"",tags:r.profile.tags,at_hour:s,at_minute:l,deliver_within:r.profile.deliver_within,on_days:d}},W="_container_gex1r_1",X="_radioGroup_gex1r_7",Z="_timeContainer_gex1r_13",ee="_time_gex1r_13",te="_timeInput_gex1r_27",ie="_inputDescriptionAfter_gex1r_32",re="_colon_gex1r_37",oe="_tooltip_gex1r_43",ae="_expiration_gex1r_47",se="_windowInputContainer_gex1r_54",ne="_windowInput_gex1r_54",le="_windowInputDescription_gex1r_63",o={container:W,radioGroup:X,timeContainer:Z,time:ee,timeInput:te,inputDescriptionAfter:ie,colon:re,tooltip:oe,expiration:ae,windowInputContainer:se,windowInput:ne,windowInputDescription:le},N=r=>{const{getAccessGroupQuery:s}=Q(),l=z(),{closeSidePanel:d}=q(),{notify:c}=M(),{data:u}=s(),{createRebootProfile:y,isCreatingRebootProfile:P}=B(),{editRebootProfile:S,isEditingRebootProfile:F}=L(),C=u?.data.map(({name:i,title:m})=>({label:m,value:i}))??[],t=O({initialValues:J(r),enableReinitialize:!0,onSubmit:async i=>{try{r.action==="edit"?await S({id:r.profile.id,access_group:i.access_group,at_hour:Number(i.at_hour),at_minute:Number(i.at_minute),deliver_delay_window:i.randomize_delivery?Number(i.deliver_delay_window):0,deliver_within:Number(i.deliver_delay_window),on_days:i.on_days,title:i.title,tags:i.tags,every:"week",all_computers:i.all_computers}):await y({title:i.title,tags:i.tags,access_group:i.access_group,on_days:i.on_days,every:"week",at_hour:Number(i.at_hour),at_minute:Number(i.at_minute),deliver_delay_window:i.randomize_delivery?Number(i.deliver_delay_window):0,deliver_within:Number(i.deliver_within),all_computers:i.all_computers}),d(),c.success({message:`Reboot profile "${i.title}" has been ${g[r.action]} `,title:`Reboot profile ${g[r.action]}`})}catch(m){l(m)}},validationSchema:Y(r.action)}),a=[b(t,"at_hour"),b(t,"at_minute"),b(t,"deliver_within")];return e.jsx($,{value:t,children:e.jsxs(n.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[e.jsx(n.Input,{type:"text",label:"Title",required:r.action==="add",...t.getFieldProps("title"),error:t.touched.title&&t.errors.title}),e.jsx(n.Select,{label:"Access group","aria-label":"Access group",options:C,...t.getFieldProps("access_group"),error:b(t,"access_group")}),e.jsxs("div",{className:o.container,children:[e.jsx("p",{className:"p-heading--5",children:"Schedule"}),e.jsx(k,{variant:"condensed",label:"Days",items:x,selectedItems:x.filter(({value:i})=>t.values.on_days.includes(i)),onItemsUpdate:async i=>t.setFieldValue("on_days",i.map(({value:m})=>m)),isSortedAlphabetically:!1,hasSelectedItemsFirst:!1,error:t.touched.on_days&&typeof t.errors.on_days=="string"?t.errors.on_days:void 0}),e.jsxs("div",{className:o.timeContainer,children:[e.jsxs("div",{className:o.time,children:[e.jsxs(e.Fragment,{children:[e.jsx(n.Input,{type:"number",label:"Time","aria-label":"at hour",placeholder:"HH",className:o.timeInput,wrapperClassName:h({"is-error":a[0]}),...t.getFieldProps("at_hour"),"aria-errormessage":a[0]?"hour-error":void 0}),e.jsx("span",{className:o.colon,children:":"})]}),e.jsx(n.Input,{type:"number",label:"At minute",labelClassName:"u-off-screen","aria-label":"at minute",className:o.timeInput,wrapperClassName:h({"is-error":a[1]}),placeholder:"MM",...t.getFieldProps("at_minute"),"aria-errormessage":a[1]?"minute-error":void 0}),e.jsx(n.Input,{type:"number",label:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Expires after "}),e.jsx(n.Tooltip,{message:U,position:"top-right",tooltipClassName:o.tooltip,children:e.jsx(n.Icon,{name:"help"})})]}),wrapperClassName:h(o.expiration,{"is-error":a[2]}),className:o.timeInput,...t.getFieldProps("deliver_within"),"aria-errormessage":"expires-error"}),e.jsx("span",{className:o.inputDescriptionAfter,children:"hours"})]}),a.filter(Boolean).length>0&&e.jsxs("div",{className:h({"is-error":a.filter(Boolean).length>0}),children:[a[0]&&e.jsx("p",{className:"p-form-validation__message",id:"hour-error",children:e.jsx("span",{children:a[0]})}),a[1]&&e.jsx("p",{className:"p-form-validation__message",id:"minute-error",children:e.jsx("span",{children:a[1]})}),a[2]&&e.jsxs("p",{className:"p-form-validation__message",id:"expires-error",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:a[2]})]})]})]}),e.jsx("p",{children:"Randomise delivery over a time window"}),e.jsxs("div",{className:o.radioGroup,children:[e.jsx(n.RadioInput,{label:"No",...t.getFieldProps("randomize_delivery"),checked:!t.values.randomize_delivery,onChange:async()=>{await t.setFieldValue("randomize_delivery",!1),await t.setFieldValue("deliver_delay_window","")}}),e.jsx(n.RadioInput,{label:"Yes",...t.getFieldProps("randomize_delivery"),checked:t.values.randomize_delivery,onChange:async()=>t.setFieldValue("randomize_delivery",!0)})]}),t.values.randomize_delivery&&e.jsxs("div",{className:o.windowInputContainer,children:[e.jsx(n.Input,{type:"number",inputMode:"numeric",min:0,label:"Deliver delay window",labelClassName:"u-off-screen",className:o.windowInput,...t.getFieldProps("deliver_delay_window"),error:t.touched.deliver_delay_window&&t.errors.deliver_delay_window?t.errors.deliver_delay_window:void 0}),e.jsx("span",{className:o.windowInputDescription,children:"minutes"})]})]}),e.jsx(G,{formik:t}),e.jsx(H,{submitButtonText:K[r.action],submitButtonDisabled:t.isSubmitting||P||F})]})})},he=Object.freeze(Object.defineProperty({__proto__:null,default:N},Symbol.toStringTag,{value:"Module"})),ye=Object.freeze(Object.defineProperty({__proto__:null,RebootProfilesContainer:A,RebootProfilesForm:N,RebootProfilesHeader:R,RebootProfilesList:T},Symbol.toStringTag,{value:"Module"}));export{ye as a,he as i};
