import{r as b,j as s,G as C,f as _,v,K as N,y as A,N as P,B as w,k as E,R as F,H as S,d as y,ah as O}from"./index-CNSDWj8Q.js";import{A as j}from"./AuthTemplate-BV-qJbFV.js";import{g as T}from"./formikErrors-Bw8iTXYS.js";const c=6,V="_otpContainer_m5ew4_9",k="_input_m5ew4_14",x={otpContainer:V,input:k},D=({value:a,onChange:r,error:i,onComplete:d})=>{const h=b.useRef(new Array(c).fill(null));b.useEffect(()=>{const t=a.findIndex(n=>n===""),e=t===-1?c-1:t;h.current[e]?.focus()},[a]);const m=t=>e=>{const n=e.target,l=n.value.replace(/[^A-Za-z0-9]/g,"");let f=l;if(l.length>1){const u=n.selectionStart;f=u&&u>0?l[u-1]:l.slice(-1)}const p=[...a];p[t]=f,r(p),p.every(u=>u!=="")&&setTimeout(()=>{d()},0)},o=t=>e=>{e.key==="Backspace"&&!a[t]&&t>0&&h.current[t-1]?.focus()},g=t=>e=>{e.preventDefault();const n=e.clipboardData.getData("text").replace(/[^A-Za-z0-9]/g,"");if(!n.length)return;const l=n.split(""),f=[...a.slice(0,t),...l,...a.slice(t+l.length)].slice(0,c),p=Object.assign(Array(c).fill(""),f);r(p),p.every(u=>u!=="")&&setTimeout(()=>{d()},0)};return s.jsxs("fieldset",{className:C("p-form__group p-form-validation",{"is-error":i}),role:"group","aria-labelledby":"otp-label",children:[s.jsx("legend",{id:"otp-label",children:"Code"}),s.jsx("div",{className:"p-form__control u-clearfix",children:s.jsx("div",{className:x.otpContainer,children:Array.from({length:c}).map((t,e)=>s.jsx("input",{ref:n=>{h.current[e]=n},type:"text",inputMode:"text",className:x.input,value:a[e]||"",onChange:m(e),onKeyDown:o(e),onPaste:g(e),"aria-label":`Digit ${e+1} of ${c}`},e))})}),i&&s.jsx("p",{className:"p-form-validation__message is-error",id:"otp-error",children:i})]})},$=()=>{const a=_(),{mutateAsync:r,isPending:i}=v({mutationFn:d=>a.get(`ubuntu-installer-attach-sessions/code/${d.attach_code}`)});return{verify:r,isVerifying:i}},I="_buttonContainer_1skbi_1",R={buttonContainer:I},L=()=>{const[a]=N(),r=A(),i=P(),{verify:d,isVerifying:h}=$(),m=a.get("code")||"",o=w({initialValues:{code:Object.assign(Array(c).fill(""),m?.split("")||[])},validationSchema:E().shape({code:S().test("is-complete",`Code must be ${c} characters long`,t=>t!=null&&t.every(e=>e&&e!==""))}),enableReinitialize:!0,onSubmit:async t=>{try{const e=t.code.join(""),{data:n}=await d({attach_code:e});if(!n.valid){r("The code you entered has expired and is no longer valid."),o.resetForm({values:{code:Array(c).fill("")}});return}i(F.auth.login({code:e}))}catch(e){r(e)}}});b.useEffect(()=>{m&&m.length===c&&m.split("").every(e=>e&&e!=="")&&o.submitForm()},[]);const g=t=>{o.setFieldValue("code",t)};return s.jsx(j,{title:"Enter code to connect to the Ubuntu installer",children:s.jsxs(y.Form,{onSubmit:o.handleSubmit,children:[s.jsx(D,{value:o.values.code,onChange:g,onComplete:o.submitForm,error:T(o,"code")}),s.jsx("div",{className:R.buttonContainer,children:s.jsx(y.Button,{className:"u-no-margin--bottom",type:"submit",appearance:"positive",disabled:o.isSubmitting||h,children:"Next"})})]})})},z=()=>s.jsx(j,{title:"Sign in successful",children:s.jsx("p",{className:"u-text--muted",children:"You can close this tab and go back to the Ubuntu installer."})}),G=()=>O().state?.success===!0?s.jsx(z,{}):s.jsx(L,{});export{G as default};
