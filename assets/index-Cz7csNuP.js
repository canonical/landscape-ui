import{e as y,r as A,j as e,h as a,f as D,g as N,l as v,i as w}from"./index-BhA4J3ko.js";import{E as P}from"./EmptyState-C71tSpTG.js";import{P as S,a as C,b as G}from"./PageMain-BGNK0xG-.js";import{u as f}from"./useRoles-Db1B50uX.js";import{u as _}from"./useConfirm-CiNGk-W0.js";import{c as k,a as F}from"./index.esm-B8rBEOcC.js";import{S as T}from"./SidePanelFormButtons-7JkHrlOz.js";import"./useMutation-D6hW2Vr2.js";import"./useFetchOld-5foHVBsZ.js";import"./SidePanelFormButtons.module-yv6Qz3cN.js";const B="_actions_11z1b_1",M="_name_11z1b_5",j={actions:B,name:M},$=({accessGroupData:l})=>{const{confirmModal:m,closeConfirmModal:r}=_(),{removeAccessGroupQuery:n}=f(),{mutateAsync:o}=n,p=y(),c=(t,i="",g=0)=>{let h=[];return t.filter(b=>b.parent===i).forEach(b=>{h.push({...b,indentLevel:g}),h=h.concat(c(t,b.name,g+1))}),h},u=A.useMemo(()=>{const t=l.sort((i,g)=>i.name.localeCompare(g.name))||[];return c(t)},[l.length]),s=async t=>{try{await o({name:t})}catch(i){p(i)}finally{r()}},d=t=>{m({body:`This will delete '${t}' access group`,title:"Delete access group",buttons:[e.jsx(a.Button,{appearance:"negative",onClick:()=>s(t),"aria-label":`Delete ${t} access group`,children:"Delete"},`delete-access-group-${t}`)]})},x=A.useMemo(()=>[{accessor:"title",Header:"Title",className:j.name},{accessor:"name",Header:"Name",className:j.name},{accessor:"id",className:j.actions,Cell:({row:t})=>e.jsx("div",{className:"divided-blocks",children:e.jsx("div",{className:"divided-blocks__item",children:e.jsx(a.Tooltip,{message:"Delete",children:e.jsx(a.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left p-tooltip--btm-center","aria-label":`Remove ${t.original.name} access group`,onClick:()=>d(t.original.name),children:e.jsx(a.Icon,{name:a.ICONS.delete,className:"u-no-margin--left"})})})})})}],[u]);return e.jsx(e.Fragment,{children:e.jsx(a.ModularTable,{columns:x,data:u,getCellProps:t=>{const i=t.row.original;switch(t.column.id){case"name":return{role:"rowheader"};case"title":return{"aria-label":"Title",style:{paddingLeft:`${i.indentLevel*2}rem`}};case"id":return{"aria-label":"Actions"};default:return{}}}})})},E=()=>{const{createAccessGroupQuery:l,getAccessGroupQuery:m}=f(),{mutateAsync:r}=l,{closeSidePanel:n}=D(),{data:o,isLoading:p}=m(),c=((o==null?void 0:o.data)??[]).map(d=>({label:d.title,value:d.name})),u=y(),s=N({initialValues:{title:"",parent:""},validationSchema:k().shape({title:F().required("This field is required")}),onSubmit:async d=>{try{await r(d),n()}catch(x){u(x)}}});return e.jsxs(a.Form,{noValidate:!0,onSubmit:s.handleSubmit,children:[e.jsx(a.Input,{type:"text",label:"Title",id:"new-access-group-title",required:!0,error:s.touched.title&&s.errors.title?s.errors.title:void 0,...s.getFieldProps("title")}),e.jsx(a.Select,{required:!0,id:"Parent",label:"Parent",disabled:p,options:[...c],...s.getFieldProps("parent")}),e.jsx(T,{submitButtonDisabled:s.isSubmitting,submitButtonText:"Add"})]})},J=()=>{const{setSidePanelContent:l}=D(),{getAccessGroupQuery:m}=f(),{data:r,isLoading:n}=m(),o=(r==null?void 0:r.data)??[],p=()=>{l("Add access group",e.jsx(E,{}))},c=({className:u})=>e.jsx(a.Button,{appearance:"positive",onClick:p,onMouseDown:s=>{s.preventDefault()},type:"button",className:w("u-no-margin--right",u),children:"Add access group"});return e.jsxs(S,{children:[e.jsx(C,{title:"Access groups",actions:[e.jsx(c,{},"add-new-access-group-button")]}),e.jsxs(G,{children:[n&&e.jsx(v,{}),!n&&o.length===0&&e.jsx(P,{title:"No access groups found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any access groups yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/access-groups",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage access groups in Landscape"})]}),cta:[e.jsx(c,{},"empty-state-new-button")]}),!n&&o.length>0&&e.jsx($,{accessGroupData:o})]})]})};export{J as default};
