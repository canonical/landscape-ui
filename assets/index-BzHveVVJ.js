const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CR8u7ew3.js","assets/index-Cl3Ng_mk.js","assets/index-DXB7zdRE.css","assets/PackageProfileConstraintsBlock-DzQGqJ7N.js","assets/CellInput-Da5ZQVoa.js","assets/index-Cx3TwClv.js","assets/PageMain-D_Ps47UE.js","assets/PageMain-CIunaku7.css","assets/useRoles-CILegiw-.js","assets/HeaderWithSearch-CESmZ3W6.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SidePanelTablePagination-Bkh1ZbPg.js","assets/TruncatedCell-KEreQk4I.js","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-D0hstL1U.js","assets/index-B9uPrW4N.css","assets/PackageProfileConstraintsBlock-CdyFUl7u.css","assets/SidePanelFormButtons-DGYG3HWU.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css"])))=>i.map(i=>d[i]);
import{p as F,q as $,n as I,j as e,d as r,B as x,i as C,v as A,a3 as L,o as w,G as q,J as f,H,K as W,s as D}from"./index-Cl3Ng_mk.js";import{H as M}from"./HeaderWithSearch-CESmZ3W6.js";import{u as R,L as z,C as Q,a as T}from"./index-Cx3TwClv.js";import{C as k}from"./CellInput-Da5ZQVoa.js";import{S as G}from"./SidePanelTablePagination-Bkh1ZbPg.js";import"./PageMain-D_Ps47UE.js";import"./useRoles-CILegiw-.js";import"./TruncatedCell-KEreQk4I.js";import"./useExpandableRow-D0hstL1U.js";const U=[{label:"All",value:""},{label:"Conflicts",value:"conflicts"},{label:"Depends",value:"depends"}],J="_container_scrq4_1",K={container:J},Y=C.lazy(async()=>L(()=>import("./index-CR8u7ew3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]))),X=({filter:n,formik:a,onFilterChange:o,profile:s,selectedIds:u,setSelectedIds:g})=>{const P=F(),{notify:l}=$(),{setSidePanelContent:p}=I(),{removePackageProfileConstraintsQuery:m}=R(),{mutateAsync:v,isPending:h}=m,b=async()=>{try{await v({constraint_ids:u,name:s.name}),g([]),l.success({message:`${u.length} "${s.title}" profile's ${x(u.length,"constraint")} removed successfully`,title:`Package profile ${x(u.length,"constraint")} removed`})}catch(t){P(t)}},j=()=>{p(`Add package constraints to "${s.title}" profile`,e.jsx(C.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(Y,{profile:s})}),"medium")};return e.jsxs("div",{className:K.container,children:[e.jsx(r.Select,{label:"Constraint type",className:"u-no-margin--bottom",labelClassName:"u-no-padding--top",options:U,value:n,onChange:t=>{o(t.target.value)}}),e.jsxs(r.ConfirmationButton,{className:"has-icon u-no-margin--right u-no-margin--bottom",type:"button",disabled:u.length===0||a.values.id!==0,"aria-label":`Remove selected ${x(u.length,"constraint")}`,confirmationModalProps:{title:`Remove ${x(u.length,"constraint")}`,children:e.jsxs("p",{children:["This will remove ",u.length," ",x(u.length,"constraint"),"."]}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:h,confirmButtonLoading:h,onConfirm:b},children:[e.jsx(r.Icon,{name:r.ICONS.delete}),e.jsx("span",{children:"Remove"})]}),e.jsxs(r.Button,{className:"u-no-margin--bottom",type:"button",hasIcon:!0,onClick:j,"aria-label":"Add new constraint",children:[e.jsx(r.Icon,{name:r.ICONS.plus}),e.jsx("span",{children:"Add constraints"})]})]})},Z="_actionButton_1mrgm_1",ee="_tooltip_1mrgm_5",_={actionButton:Z,tooltip:ee},ae=({constraint:n,formik:a})=>a.values.id===n.id?e.jsxs(e.Fragment,{children:[e.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:w("u-no-margin--bottom u-no-padding",_.actionButton),onClick:()=>a.handleSubmit(),children:e.jsx(r.Tooltip,{tooltipClassName:_.tooltip,message:"Save changes",children:e.jsx(r.Icon,{name:"success-grey",className:"u-no-margin--left u-no-margin--right"})})}),e.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>a.resetForm(),"aria-label":`Cancel editing ${n.package} constraint`,children:e.jsx(r.Tooltip,{tooltipClassName:_.tooltip,message:"Cancel",children:e.jsx(r.Icon,{name:"error-grey",className:"u-no-margin--left u-no-margin--right"})})})]}):e.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>a.setValues(n),disabled:a.values.id!==0,"aria-label":`Edit ${n.package} constraint`,children:e.jsx(r.Tooltip,{tooltipClassName:_.tooltip,message:"Edit constraint",children:e.jsx(r.Icon,{name:"edit",className:"u-no-margin--left u-no-margin--right"})})}),ne="_actionsCell_1kvjf_1",te="_noPadding_1kvjf_7",se="_cell_1kvjf_11",oe="_input_1kvjf_23",re="_inputWrapper_1kvjf_31",ie="_hidden_1kvjf_37",d={actionsCell:ne,noPadding:te,cell:se,input:oe,inputWrapper:re,hidden:ie},le=async(n,a,o)=>{await n.setFieldValue(`${a}`,o),await n.setFieldTouched(`${a}`,!0),["rule","version"].includes(`${a}`)&&(o!==""?await n.setFieldValue("notAnyVersion",!0):n.values[a==="rule"?"version":"rule"]===""&&await n.setFieldValue("notAnyVersion",!1))},ce=(n,a)=>{if(!(!n.touched[a]||!n.errors[a]))return n.errors[a]},ue=n=>({handleConstraintPropChange:(a,o)=>le(n,a,o),getConstraintPropError:a=>ce(n,a)}),de=({column:n,row:a},o)=>{const s={};return s.className=w(d.cell,{[d.noPadding]:a.original.id===o}),a.original.package==="loading"?n.id==="package"?s.colSpan=5:(s.className=d.hidden,s["aria-hidden"]=!0):n.id==="package"?s.role="rowheader":n.id==="actions"?s["aria-label"]="Actions":n.id==="constraint"?s["aria-label"]="Constraint":n.id==="version"?s["aria-label"]="Version":n.id==="rule"&&(s["aria-label"]="Rule"),s},ge=(n,a)=>{let o="No constraints found";return n&&(o+=` with the constraint type: "${n}"`,a&&(o+=" and")),a&&(o+=` with the search: "${a}"`),o},pe=({filter:n,formik:a,isConstraintsLoading:o,onSelectedIdsChange:s,pageSize:u,profileConstraints:g,search:P,selectedIds:l})=>{const p=C.useMemo(()=>{if(o)return[z];if(!g)return[];const t=g.map(c=>({...c,notAnyVersion:!!c.version}));return a.values.id!==-1?t:[a.values,...t].slice(0,u)},[o,g,a.values,u]),m=()=>{s(l.length?[]:p.map(({id:t})=>t))},v=t=>{l.includes(t)?s(l.filter(c=>c!==t)):s([...l,t])},{handleConstraintPropChange:h,getConstraintPropError:b}=ue(a),j=C.useMemo(()=>[{accessor:"constraint",Header:()=>e.jsxs(e.Fragment,{children:[e.jsx(r.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all constraints"}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0||p.length===0,checked:p.length>0&&p.length===l.length,indeterminate:l.length>0&&l.length<p.length,onChange:m}),e.jsx("span",{children:"Constraint"})]}),Cell:({row:{original:t}})=>a.values.id===t.id?e.jsx(r.Select,{label:"Constraint",labelClassName:"u-off-screen",className:d.input,wrapperClassName:d.inputWrapper,options:Q,...a.getFieldProps("constraint"),onChange:c=>h("constraint",c.target.value),error:b("constraint")}):e.jsxs("div",{className:d.checkboxContainer,children:[e.jsx(r.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${t.package} constraint`}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0,checked:l.includes(t.id),onChange:()=>v(t.id)}),e.jsx("span",{children:t.constraint})]})},{accessor:"package",Header:"Package",Cell:({row:{original:t}})=>a.values.id===t.id?e.jsx(k,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:d.input,wrapperClassName:d.inputWrapper,...a.getFieldProps("package"),onChange:c=>h("package",c),error:b("package")}):t.package!=="loading"?e.jsx(e.Fragment,{children:t.package}):e.jsx(A,{})},{accessor:"rule",Header:"Rule",Cell:({row:{original:t}})=>a.values.id===t.id?e.jsx(r.Select,{label:"Rule",labelClassName:"u-off-screen",className:d.input,wrapperClassName:d.inputWrapper,options:T,...a.getFieldProps("rule"),onChange:c=>h("rule",c.target.value),error:b("rule")}):e.jsx(e.Fragment,{children:T.find(({value:c})=>c===t.rule)?.label??t.rule})},{accessor:"version",Header:"Version",Cell:({row:{original:t}})=>a.values.id===t.id?e.jsx(k,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:d.input,wrapperClassName:d.inputWrapper,...a.getFieldProps("version"),onChange:c=>h("version",c),error:b("version")}):e.jsx(e.Fragment,{children:t.version})},{accessor:"actions",className:d.actionsCell,Cell:({row:{original:t}})=>e.jsx(ae,{constraint:t,formik:a})}],[p,l.length,a.errors,a.touched]);return e.jsx(r.ModularTable,{columns:j,data:p,getCellProps:t=>de(t,a.values.id),className:"u-no-margin--bottom",emptyMsg:ge(n,P)})},me={constraint:"",id:0,notAnyVersion:!1,package:"",rule:"",version:""},he=q().shape({constraint:f().required("Required."),id:W(),notAnyVersion:H(),package:f().required("Required."),rule:f().when("notAnyVersion",{is:!0,then:n=>n.required("Required.")}),version:f().when("notAnyVersion",(n,a)=>n[0]?a.required("Required."):a)}),Ce="_pagination_15tqa_1",be={pagination:Ce},Te=({profile:n})=>{const[a,o]=C.useState([]),[s,u]=C.useState(1),[g,P]=C.useState(20),[l,p]=C.useState(""),[m,v]=C.useState(""),h=i=>{o([]),u(i)},b=i=>{o([]),P(i)},j=F(),{notify:t}=$(),{editPackageProfileConstraintQuery:c,getPackageProfileConstraintsQuery:E}=R(),{mutateAsync:V}=c,y=D({initialValues:me,onSubmit:async(i,{resetForm:O})=>{try{await V({constraint:i.constraint,id:i.id,package:i.package,rule:i.rule,version:i.version,name:n.name}),t.success({message:`"${n.title}" package profile's constraint updated successfully`,title:"Package profile constraint updated"}),O()}catch(B){j(B)}},validationSchema:he}),{data:N,isLoading:S}=E({constraint_type:m||void 0,limit:g,name:n.name,offset:(s-1)*g,search:l});return e.jsxs(e.Fragment,{children:[!l&&!m&&s===1&&g===20&&S&&e.jsx(A,{}),(l||m||s!==1||g!==20||!S&&N&&N.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(M,{actions:e.jsx(X,{filter:m,formik:y,onFilterChange:i=>v(i),profile:n,selectedIds:a,setSelectedIds:i=>o(i)}),onSearch:i=>p(i),disabled:y.values.id!==0}),e.jsx(pe,{filter:m,formik:y,isConstraintsLoading:S,onSelectedIdsChange:i=>o(i),pageSize:g,profileConstraints:N?.data.results,search:l,selectedIds:a}),e.jsx(G,{currentPage:s,pageSize:g,paginate:h,setPageSize:b,totalItems:N?.data.count,className:be.pagination})]})]})};export{Te as default};
