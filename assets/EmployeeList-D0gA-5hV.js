const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-ZIjkRawt.js","assets/index-DVhJuAPo.js","assets/index-snvkEeYU.css","assets/InstancesPageActions-B5gMq6_A.js","assets/ResponsiveButtons-COwbGEdE.js","assets/ResponsiveButtons-C56n2q_V.css","assets/useInstances-B2occ7OE.js","assets/InstancesPageActions-B7AIml_J.css","assets/index-DJG_wlh-.css"])))=>i.map(i=>d[i]);
import{c as g,i as T,k as C,f as A,l as z,C as w,B as j,j as t,d as u,F as I,o as _,H as x,ap as S,r as p,q as F,a2 as L,m as D,ai as M,aC as y,L as b,N as f,aq as N}from"./index-DVhJuAPo.js";const $=e=>e.is_active?"Active":"Inactive",O=()=>{const e=g(),a=T(),{mutateAsync:n,isPending:o}=C({mutationKey:["employee","patch"],mutationFn:async({id:m,...d})=>e.patch(`employees/${m}`,d),onSuccess:async()=>a.invalidateQueries({queryKey:["employee"]})});return{patchEmployee:n,isPending:o}},R={listenToUrlParams:!0},k=e=>{switch(e){case"active":return!0;case"inactive":return!1;default:return}},re=(e,a,n={})=>{const o=g(),{autoinstallFiles:m,currentPage:d,employeeGroups:i,pageSize:l,search:s,status:r}=A();e={...R,...e};const c={...e.listenToUrlParams?{with_autoinstall_file:!0,with_computers:!0,with_groups:!0,is_active:k(r),employee_group_ids:i.length>0?i:void 0,autoinstall_file_ids:m.length>0?m:void 0,limit:l,offset:(d-1)*l,search:s??void 0}:a},{data:v,isPending:E,isFetching:P}=z({queryKey:["employees",c,e],queryFn:async()=>o.get("employees",{params:c}),...n});return{employees:v?.data?.results||[],isPending:E,isFetching:P,count:v?.data?.count}},q=()=>{const e=g(),a=T(),{mutateAsync:n,isPending:o}=C({mutationKey:["employee","patch"],mutationFn:async({id:m,...d})=>e.post(`employees/${m}/offboard`,d),onSuccess:async()=>a.invalidateQueries({queryKey:["employee"]})});return{deactivateEmployee:n,isDeactivating:o}},B=({employee:e,handleClose:a})=>{const{notify:n}=w(),o=j(),{patchEmployee:m,isPending:d}=O(),i=async()=>{try{await m({id:e.id,is_active:!0}),n.success({title:`You have successfully activated ${e.name}`,message:`${e.name} will be able to log in to Landscape and register new instances with their account.`}),a()}catch(l){o(l)}};return t.jsx(u.ConfirmationModal,{confirmButtonLabel:"Activate",onConfirm:i,confirmButtonAppearance:"positive",title:`Activate ${e.name}`,close:a,confirmButtonDisabled:d,confirmButtonLoading:d,children:t.jsxs("p",{children:["This will allow ",e.name," to log in to Landscape and register new instances with their account."]})})},H="Irreversibly deletes all data on disks of associated instances. Proceed with caution",V="This will remove all instances associated with this employee from Landscape.",G={sanitizationConfirmationText:"",sanitizeInstances:!1,removeFromLandscapeConfirmationText:"",removeFromLandscape:!1},K="_title_qlqd5_1",U="_tooltipPositionElement_qlqd5_5",Y="_additionalActionContainer_qlqd5_9",h={title:K,tooltipPositionElement:U,additionalActionContainer:Y},Q=(e,a)=>a.removeFromLandscape&&a.sanitizeInstances?`Off-board ${e}`:`Deactivate ${e}`,W=e=>e.removeFromLandscape&&e.sanitizeInstances?"Off-board":e.removeFromLandscape?"Deactivate and remove":e.sanitizeInstances?"Deactivate and sanitize":"Deactivate",Z=e=>!!(e.sanitizeInstances&&e.sanitizationConfirmationText!=="sanitize instances"||e.removeFromLandscape&&e.removeFromLandscapeConfirmationText!=="remove instances"||e.sanitizeInstances&&e.removeFromLandscape&&e.sanitizationConfirmationText!=="sanitize instances"&&e.removeFromLandscapeConfirmationText!=="remove instances"),J=(e,a,n)=>a&&n?{notificationTitle:`You have successfully deactivated ${e} and initiated both Sanitization and Removal of their instances`,notificationMessage:"Sanitization and removal of this employee’s instances have been queued. The data will be permanently irrecoverable once complete. To manage the instances again, they will need to be re-registered in Landscape."}:a?{notificationTitle:`You have successfully deactivated ${e} and initiated sanitization of their instances`,notificationMessage:`Sanitization of the ${e}’s instances has been queued in Activities. The data will be permanently irrecoverable once complete.`}:n?{notificationTitle:`You have successfully deactivated ${e} and initiated the Removal of their instances`,notificationMessage:"The removal of this employee’s instances has been queued. This process will delete all stored data. To manage them again, they will need to be re-registered in Landscape."}:{notificationTitle:`You have successfully deactivated ${e}`,notificationMessage:"This employee won’t be able to log in to Landscape or register new instances with their account."},X=({employee:e,handleClose:a})=>{const{notify:n}=w(),o=j(),{deactivateEmployee:m,isDeactivating:d}=q(),i=I({initialValues:G,enableReinitialize:!0,onSubmit:async l=>{if(!(l.sanitizeInstances&&l.sanitizationConfirmationText!=="sanitize instances"||l.removeFromLandscape&&l.removeFromLandscapeConfirmationText!=="remove instances"))try{await m({id:e.id,remove_instances:i.values.removeFromLandscape,sanitize_instances:i.values.sanitizeInstances}),i.resetForm(),a();const{notificationMessage:s,notificationTitle:r}=J(e.name,i.values.sanitizeInstances,i.values.removeFromLandscape);n.success({title:r,message:s})}catch(s){o(s)}}});return t.jsx(u.ConfirmationModal,{title:Q(e.name,i.values),confirmButtonLabel:W(i.values),confirmButtonProps:{type:"submit"},onConfirm:()=>{i.handleSubmit()},close:a,confirmButtonDisabled:Z(i.values)||d,confirmButtonLoading:d,children:t.jsxs(u.Form,{noValidate:!0,onSubmit:l=>{l.preventDefault(),i.handleSubmit()},children:[t.jsxs("p",{children:["This will prevent ",e.name," from logging in to Landscape and from registering any new instances with their account"]}),t.jsx("b",{children:"Additional actions"}),t.jsxs("div",{children:[t.jsx(u.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:h.title,children:"Sanitize associated instances"}),t.jsxs(u.Tooltip,{position:"top-center",message:H,positionElementClassName:h.tooltipPositionElement,children:[t.jsx(u.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...i.getFieldProps("sanitizeInstances"),onChange:async l=>{i.getFieldProps("sanitizeInstances").onChange(l),await i.setFieldValue("sanitizationConfirmationText","")}}),i.values.sanitizeInstances&&t.jsxs("div",{className:h.additionalActionContainer,children:[t.jsx("p",{children:"Sanitization will permanently delete the encryption keys for associated instances, making its data completely irrecoverable. This action cannot be undone. Please confirm you wish to proceed."}),t.jsx(u.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"sanitize instances"})," to confirm"]}),"aria-label":"Sanitization confirmation text",placeholder:"sanitize instances",autoComplete:"off",type:"text",...i.getFieldProps("sanitizationConfirmationText")},"sanitizationConfirmationText")]}),t.jsx(u.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:h.title,children:"Remove associated instances from Landscape"}),t.jsxs(u.Tooltip,{position:"top-center",message:V,positionElementClassName:h.tooltipPositionElement,children:[t.jsx(u.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...i.getFieldProps("removeFromLandscape"),onChange:async l=>{i.getFieldProps("removeFromLandscape").onChange(l),await i.setFieldValue("removeFromLandscapeConfirmationText","")}}),i.values.removeFromLandscape&&t.jsxs("div",{className:h.additionalActionContainer,children:[t.jsx("p",{children:"This will remove all associated instances from Landscape, along with their stored data. To manage them again, you would need to re-register them in Landscape."}),t.jsx(u.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"remove instances"})," to confirm."]}),placeholder:"remove instances",autoComplete:"off","aria-label":"Remove from Landscape confirmation text",type:"text",...i.getFieldProps("removeFromLandscapeConfirmationText")},"removeFromLandscapeConfirmationText")]})]})]})})},ee=p.lazy(async()=>L(()=>import("./index-ZIjkRawt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),te=({employee:e})=>{const{setSidePanelContent:a}=_(),{value:n,setTrue:o,setFalse:m}=x(),{value:d,setTrue:i,setFalse:l}=x(),s=()=>{a("Employee details",t.jsx(p.Suspense,{fallback:t.jsx(F,{}),children:t.jsx(ee,{employee:e})}),"medium")},r=[{icon:"file",label:"View details","aria-label":`View ${e.name} employee details`,onClick:s}],c=[];return e.is_active?c.push({icon:"pause",label:"Deactivate","aria-label":`Deactivate ${e.name}`,onClick:i}):r.push({icon:"play",label:"Activate","aria-label":`Activate ${e.name}`,onClick:o}),t.jsxs(t.Fragment,{children:[t.jsx(S,{toggleAriaLabel:`${e.name} actions`,actions:r,destructiveActions:c}),n&&t.jsx(B,{employee:e,handleClose:m}),d&&t.jsx(X,{employee:e,handleClose:l})]})},ae="_autoinstallFileHeaderTitle_fd2dm_1",se={autoinstallFileHeaderTitle:ae},ne=e=>({index:a})=>{const n={};return(e?.column==="computers"||e?.column==="groups")&&e.row===a&&(n.className="expandedRow"),n},ie=e=>({column:a,row:{index:n}})=>{const o={};return a.id==="computers"?(o["aria-label"]="Associated instances",e?.column===a.id&&e.row===n&&(o.className="expandedCell")):a.id==="groups"?(o["aria-label"]="Employee group",e?.column===a.id&&e.row===n&&(o.className="expandedCell")):a.id==="name"?o.role="rowheader":a.id==="email"?o["aria-label"]="Email":a.id==="status"?o["aria-label"]="Status":a.id==="autoinstall_file"?o["aria-label"]="Assigned autoinstall file":a.id==="actions"&&(o["aria-label"]="Actions"),o},oe=e=>a=>{a&&(e.current=[...a.querySelectorAll("tbody tr")])},le=p.lazy(async()=>L(()=>import("./index-ZIjkRawt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),de=({employees:e})=>{const{setSidePanelContent:a}=_(),[n,o]=p.useState(null),m=p.useRef([]);D(n?.column==="computers"||n?.column==="groups"?{current:m.current[n.row]}:[],s=>{s.target instanceof Element&&!s.target.closest("truncatedItem")&&o(null)});const d=(s,r)=>{o(c=>c?.column===s&&c.row===r?null:{column:s,row:c&&["computers","groups"].includes(c.column)&&c.row<r?r-1:r})},i=s=>{a("Employee details",t.jsx(p.Suspense,{fallback:t.jsx(F,{}),children:t.jsx(le,{employee:s})}),"medium")},l=p.useMemo(()=>[{accessor:"name",Header:"name",Cell:({row:{original:s}})=>t.jsx(u.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{i(s)},"aria-label":`Show details of user ${s.name}`,children:s.name})},{accessor:"email",Header:"email"},{accessor:"groups",Header:"employee group",Cell:({row:{original:s,index:r}})=>s.groups&&s.groups.length>0?t.jsx(y,{content:s.groups.map(c=>t.jsx(b,{to:`/settings/employees?tab=employee-groups&search=${c.name}`,className:"truncatedItem",children:c.name},c.group_id)),isExpanded:n?.column==="groups"&&n.row===r,onExpand:()=>{d("groups",r)}}):t.jsx(f,{})},{accessor:"autoinstall_file",Header:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:se.autoinstallFileHeaderTitle,children:"assigned autoinstall file"}),t.jsx(u.Tooltip,{message:"This configuration file is assigned based on the highest-priority group the user belongs to.",children:t.jsx(u.Icon,{name:"help"})})]}),Cell:({row:{original:s}})=>s.autoinstall_file?.filename?t.jsx("span",{children:s.autoinstall_file?.filename}):t.jsx(f,{})},{accessor:"status",Header:"status",Cell:({row:{original:s}})=>t.jsx("span",{children:$(s)}),getCellIcon:({row:{original:{is_active:s}}})=>s?"status-succeeded-small":"status-failed-small"},{accessor:"computers",Header:"associated instances",Cell:({row:{original:s,index:r}})=>s.computers&&s.computers.length>0?t.jsx(y,{content:s.computers?.map(c=>t.jsx(b,{className:"truncatedItem",to:`/instances/${c.id}`,children:c.title},c.id)),isExpanded:n?.column==="computers"&&n.row===r,onExpand:()=>{d("computers",r)}}):t.jsx(f,{})},{...M,Cell:({row:{original:s}})=>t.jsx(te,{employee:s})}],[e,n]);return t.jsx("div",{ref:oe(m),children:t.jsx(N,{columns:l,data:e,getCellProps:ie(n),getRowProps:ne(n),emptyMsg:"No employees found according to your search parameters.",minWidth:1200})})};export{B as A,X as D,de as E,$ as g,re as u};
