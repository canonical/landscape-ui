import{p as R,J as f,i as c,z as F,B as j,y as C,C as V,j as t,d}from"./index-DYykpNVa.js";import{u as _}from"./useRoles-CK1OAvut.js";import{g as I,a as Q,b as B,c as O,P as y,A as k}from"./index-BBOGQqin.js";import{S as w}from"./SidePanelFormButtons-Aj5ThB2m.js";import{g as b}from"./formikErrors-Bw8iTXYS.js";import"./useFetchOld-BGD2hIpr.js";import"./PageMain-BnPck7ZK.js";import"./constants-CXofZZ4i.js";import"./ResponsiveTable-C-8YbfBJ.js";import"./TruncatedCell-DQQZxgbr.js";import"./Truncated-DtD6hAHP.js";import"./SidePanelFormButtons.module-CcPyiogC.js";const E={access_groups:[],description:"",name:"",permissions:[]},N=R().shape({access_groups:f().of(c()),description:c(),name:c().required("This field is required.").matches(/^[a-zA-Z][-+a-zA-Z0-9]*$/,"Name must start with a letter and can contain alphanumeric characters, ‘-‘ and ‘+’."),permissions:f().of(c())}),$=(o,i)=>({accessGroupsToAdd:I(o.access_groups,i),permissionsToAdd:o.permissions.includes("AddComputerToAccessGroup")?[...o.permissions,"RemoveComputerFromAccessGroup"]:o.permissions}),D=(o,i,m)=>{const{addAccessGroups:p,addPermissions:u}=m,r=[],{accessGroupsToAdd:n,permissionsToAdd:a}=$(o,i);return n.length>0&&r.push(p({name:o.name,access_groups:n})),a.length>0&&r.push(u({name:o.name,permissions:a})),r},ss=()=>{const o=F(),{notify:i}=j(),{closeSidePanel:m}=C(),{createRoleQuery:p,addPermissionsToRoleQuery:u,addAccessGroupsToRoleQuery:r,getAccessGroupQuery:n,getPermissionsQuery:a}=_(),{data:l}=a(),g=l?Q(l.data):[],{data:A}=n(),h=A?B(O(A.data)):[],{mutateAsync:P}=p,{mutateAsync:T}=u,{mutateAsync:G}=r,e=V({initialValues:E,validationSchema:N,onSubmit:async s=>{await P({description:s.description,name:s.name});const S=D(s,h,{addAccessGroups:G,addPermissions:T});try{await Promise.all(S),m(),i.success({title:"New role has been added",message:`You added the role '${s.name}'`})}catch(x){o(x)}}});return t.jsxs(d.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[t.jsx(d.Input,{type:"text",label:"Role name",required:!0,autoComplete:"off",...e.getFieldProps("name"),error:b(e,"name")}),t.jsx(d.Input,{type:"text",label:"Description",autoComplete:"off",...e.getFieldProps("description"),error:b(e,"description")}),t.jsx(y,{description:"These permissions are for managing the account as a whole. They are not limited to the specified access groups, but instead apply globally.",onPermissionChange:s=>e.setFieldValue("permissions",s),options:g.filter(({global:s})=>s),permissions:e.values.permissions,title:"Global permissions"}),t.jsx(y,{description:"These permissions only apply to selected access groups.",onPermissionChange:s=>e.setFieldValue("permissions",s),options:g.filter(({global:s})=>!s),permissions:e.values.permissions,title:"Permissions"}),t.jsx(k,{accessGroupOptions:h,accessGroups:e.values.access_groups,onAccessGroupChange:s=>{e.setFieldValue("access_groups",s)}}),t.jsx(w,{submitButtonDisabled:e.isSubmitting,submitButtonText:"Add role"})]})};export{ss as default};
