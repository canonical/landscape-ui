import{f as y,e as B,r as g,q as j,j as o,h as m,I as v,D as E,o as A}from"./index-vDh6p1re.js";import{S as L}from"./SidePanelFormButtons-CrzoUcfJ.js";import{h as w}from"./usePageParams-C-pi3Kin.js";import{u as D}from"./useEditScript-37BlZma_.js";import{g as F}from"./ScriptsTabs-qWvYCBab.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./useFetchOld-Dh4_z9Or.js";import"./TablePagination-s2q42wYR.js";import"./TablePaginationBase-eH-xceTk.js";import"./NoData-ClqjzLea.js";import"./TruncatedCell-BRtEnS33.js";import"./StatusFilter-kNfNcZ7x.js";import"./TableFilter-D9jMhOmC.js";import"./TableFilterChips-BgTfFgZ3.js";import"./HeaderWithSearch-DZAyAsgS.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./index-CCmNm2LP.js";const M=({scriptId:s,versionId:e})=>{const r=y(),{data:n,isPending:i}=B({queryKey:["scripts","version",s,e],queryFn:async()=>r.get(`scripts/${s}/versions/${e}`)});return{version:(n==null?void 0:n.data)??null,isVersionLoading:i}},z=({scriptId:s,scriptVersion:e,goBack:r,isArchived:n})=>{const[i,a]=g.useState(!1),d=j(),{version:t,isVersionLoading:f}=M({scriptId:s,versionId:e.version_number}),{editScript:b,isEditing:c}=D(),h=()=>{a(!0)},S=()=>{a(!1)},p=`#!${t==null?void 0:t.interpreter}
`+(t==null?void 0:t.code),l=async()=>{try{if(t){const u={code:p,title:t.title},x=F({scriptId:s,values:u});await b(x),r()}}catch(u){a(!1),d(u)}};return o.jsxs(m.Form,{noValidate:!0,onSubmit:l,children:[o.jsx(v,{label:"author",value:`${w(e.created_at).format(E)}, by ${e.created_by.name}`}),f?o.jsx(A,{}):o.jsx(m.CodeSnippet,{blocks:[{title:"Code",code:p||"",wrapLines:!0,appearance:"numbered"}]}),o.jsx(L,{hasActionButtons:!n,submitButtonAppearance:"secondary",submitButtonText:"Use as new version",onSubmit:h,hasBackButton:!0,onBackButtonPress:r}),i&&o.jsx(m.ConfirmationModal,{title:`Submit new version of ${e.title}`,confirmButtonLabel:"Submit new version",close:S,confirmButtonAppearance:"positive",confirmButtonLoading:c,confirmButtonDisabled:c,onConfirm:l,confirmButtonProps:{type:"button"},children:o.jsx("p",{children:"All future script runs will be done using the latest version of the code."})})]})};export{z as default};
