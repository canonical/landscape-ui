const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DeszTxeW.js","assets/index-HcaOzkr4.js","assets/index-mAgDtnB8.css","assets/SidePanelFormButtons-BaCjyXPu.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useRoles-BAQFoUXg.js"])))=>i.map(i=>d[i]);
import{z as f,ab as x,f as p,n as j,v as w,j as e,e as u,aM as N,av as F,L as R,J as b,R as E,s as k,t as G,a2 as I,a8 as M,o as d,aA as D,aE as O,q as A,a as m,E as $,a0 as C}from"./index-HcaOzkr4.js";import{P as B,a as H,b as V}from"./PageMain-Chfz0_-y.js";import{u as y}from"./useRoles-BAQFoUXg.js";import{G as q}from"./GroupFilter-QBhMA15_.js";import{L as z}from"./constants-BZzpu2au.js";import{u as _}from"./useGetInstances-DcDabc0d.js";const le={title:"",parent:x},ue=f().shape({title:p().required("This field is required"),parent:p().required("This field is required")}),U="_container_1xee9_1",Q="_searchContainer_1xee9_10",g={container:U,searchContainer:Q},Y=()=>{const{search:s,setPageParams:t}=j(),a=()=>{t({search:""})},c=o=>{t({search:o.searchText})},i=w({initialValues:{searchText:s},enableReinitialize:!0,validationSchema:f().shape({search:p()}),onSubmit:c}),n=N.groupBy.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:g.container,children:[e.jsx("div",{className:g.searchContainer,children:e.jsx(u.Form,{onSubmit:i.handleSubmit,noValidate:!0,children:e.jsx(u.SearchBox,{autocomplete:"off",externallyControlled:!0,value:i.values.searchText,onChange:async o=>await i.setFieldValue("searchText",o),placeholder:"Search",onSearch:()=>{i.submitForm()},onClear:a})})}),e.jsx(q,{label:"Group by",options:n},"group-by-filter")]}),e.jsx(F,{filtersToDisplay:["search"]})]})},J=({accessGroup:s})=>{const{instancesCount:t,isGettingInstances:a}=_({query:`access-group: ${s.name}`,with_alerts:!0,with_upgrades:!0,limit:1});return a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"u-off-screen",children:"Loading..."}),e.jsx(u.Spinner,{"aria-hidden":!0})]}):t?e.jsxs(R,{to:E.instances.root({accessGroups:[s.name]}),children:[t," ",b(t,"instance")]}):"0 instances"},K=({accessGroup:s,parentAccessGroupTitle:t})=>{const a=k(),{notify:c}=G(),{removeAccessGroupQuery:i}=y(),{value:n,setTrue:o,setFalse:l}=I(),{instancesCount:r=0}=_({query:`access-group: ${s.name}`,with_alerts:!0,with_upgrades:!0,limit:1}),{mutateAsync:L,isPending:h}=i,T=async()=>{try{await L({name:s.name}),c.success({title:`You have successfully deleted the "${s.title}" access group.`,message:`All entities in this access group will now belong to "${t}".`})}catch(P){a(P)}finally{l()}};return e.jsxs(e.Fragment,{children:[e.jsx(M,{toggleAriaLabel:`${s.title} access group actions`,destructiveActions:[{icon:"delete",label:"Delete","aria-label":`Delete "${s.title}" access group`,onClick:o}]}),n&&e.jsxs(u.ConfirmationModal,{title:`Deleting ${s.title} access group`,confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:h,confirmButtonLoading:h,onConfirm:T,close:l,children:[r>0&&e.jsxs("p",{children:["Removing this access group will affect ",r," ",b(r,"instance"),'. They will now belong to "',t,'".']}),e.jsxs("p",{children:["This action is ",e.jsx("b",{children:"irreversible"})]})]})]})},W=s=>{const t={};switch(s.column.id){case"title":t.role="rowheader";break;case"name":t["aria-label"]="Name";break;case"instancesCount":t["aria-label"]="Instances count";break;case"parent":t["aria-label"]="Parent";break;case"id":t["aria-label"]="Actions";break}return t},S=(s,t)=>{const a=t.find(c=>c.name===s);return a&&a.parent?[a,...S(a.parent,t)]:a?[a]:[]},v=(s,t)=>t.filter(a=>a.parent===s).map(a=>({...a,instancesCount:0,subRows:v(a.name,t)})),X=({accessGroups:s})=>{const{groupBy:t,search:a}=j(),c=d.useMemo(()=>{const n=a?s.filter(r=>r.name.toLowerCase().includes(a.toLowerCase())||r.title.toLowerCase().includes(a.toLowerCase())):s;if(t!=="parent")return n.map(r=>({...r,instancesCount:0}));const o=Array.from(new Set([...n,...n.flatMap(r=>S(r.parent||"",s))])),l=new Set(o.filter(r=>r.parent).map(r=>r.name));return o.filter(r=>!l.has(r.name)).map(r=>({...r,instancesCount:0,subRows:v(r.name,o)}))},[s,a,t]),i=d.useMemo(()=>[{accessor:"title",Header:"title",Cell:({row:n})=>e.jsx("div",{style:{paddingLeft:`${n.depth*1.25}rem`},children:e.jsx("span",{children:n.original.title})})},{accessor:"name",Header:"name"},{accessor:"instancesCount",Header:"affected instances",sortType:(n,o)=>n.original.instancesCount-o.original.instancesCount,Cell:({row:n})=>e.jsx(J,{accessGroup:n.original})},{accessor:"parent",Header:"parent",Cell:({row:{original:n}})=>s.find(l=>l.name===n.parent)?.title||e.jsx(D,{})},{...z,Cell:({row:n})=>{if(n.original.name===x)return null;const o=s.find(l=>l.name===n.original.parent)?.title||n.original.parent;return e.jsx(K,{accessGroup:n.original,parentAccessGroupTitle:o})}}],[t,s]);return e.jsx(O,{columns:i,data:c,sortable:!0,getCellProps:W,emptyMsg:"No access groups found according to your search parameters."})},Z=d.lazy(()=>C(()=>import("./index-DeszTxeW.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6]))),ee=()=>{const{getAccessGroupQuery:s}=y(),{setSidePanelContent:t}=A(),{data:a,isPending:c}=s(),i=a?.data||[],n=()=>{t("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(m,{}),children:e.jsx(Z,{})}))};return e.jsxs(e.Fragment,{children:[c&&e.jsx(m,{}),!c&&i.length===0&&e.jsx($,{title:"No access groups found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any access groups yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/access-groups",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage access groups in Landscape"})]}),cta:[e.jsx(u.Button,{appearance:"positive",onClick:n,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),!c&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{}),e.jsx(X,{accessGroups:i})]})]})},se=d.lazy(()=>C(()=>import("./index-DeszTxeW.js").then(s=>s.a),__vite__mapDeps([0,1,2,3,4,5,6])).then(s=>({default:s.NewAccessGroupForm}))),te=()=>{const{setSidePanelContent:s}=A(),t=()=>{s("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(m,{}),children:e.jsx(se,{})}))};return e.jsxs(B,{children:[e.jsx(H,{sticky:!0,title:"Access groups",actions:[e.jsx(u.Button,{appearance:"positive",onClick:t,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),e.jsx(V,{children:e.jsx(ee,{})})]})},de=Object.freeze(Object.defineProperty({__proto__:null,default:te},Symbol.toStringTag,{value:"Module"}));export{ee as A,le as I,ue as V,de as i};
