const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Duk6eMIe.js","assets/index-DMPyBbUQ.js","assets/index-tBQFzVrl.css","assets/helpers-BW0L5q5z.js","assets/helpers-C7W_HUXn.js","assets/InstancesPageActions-CIEDHOxk.js","assets/useInstances-C4ctbvWq.js","assets/InstancesPageActions-CswnIe9I.css","assets/helpers-1SmgROkh.css","assets/TruncatedCell-DDahLPtM.js","assets/TruncatedCell-CoXbu3VM.css","assets/index-DdrmM_Gj.css"])))=>i.map(i=>d[i]);
import{i as y,f as j,g as L,c as I,h as D,z as E,j as t,m as u,A as S,l as F,af as T,ak as M,r as h,o as z,_ as A,aw as $,ab as N,L as w,N as v}from"./index-DMPyBbUQ.js";import{T as _}from"./TruncatedCell-DDahLPtM.js";const R=e=>e.is_active?"Active":"Inactive",O=()=>{const e=y(),s=j(),{mutateAsync:a,isPending:o}=L({mutationKey:["employee","patch"],mutationFn:async({id:l,...i})=>e.patch(`employees/${l}`,i),onSuccess:async()=>s.invalidateQueries({queryKey:["employee"]})});return{patchEmployee:a,isPending:o}},k={listenToUrlParams:!0},B=e=>{switch(e){case"active":return!0;case"inactive":return!1;default:return}},pe=(e,s,a={})=>{var x,b;const o=y(),{autoinstallFiles:l,currentPage:i,employeeGroups:m,pageSize:p,search:n,status:r}=I();e={...k,...e};const c={...e.listenToUrlParams?{with_autoinstall_file:!0,with_computers:!0,with_groups:!0,is_active:B(r),employee_group_ids:m.length>0?m:void 0,autoinstall_file_ids:l.length>0?l:void 0,limit:p,offset:(i-1)*p,search:n??void 0}:s},{data:d,isPending:P,isFetching:C}=D({queryKey:["employees",c,e],queryFn:async()=>o.get("employees",{params:c}),...a});return{employees:((x=d==null?void 0:d.data)==null?void 0:x.results)||[],isPending:P,isFetching:C,count:(b=d==null?void 0:d.data)==null?void 0:b.count}},H=()=>{const e=y(),s=j(),{mutateAsync:a,isPending:o}=L({mutationKey:["employee","patch"],mutationFn:async({id:l,...i})=>e.post(`employees/${l}/offboard`,i),onSuccess:async()=>s.invalidateQueries({queryKey:["employee"]})});return{deactivateEmployee:a,isDeactivating:o}},V=({employee:e,handleClose:s})=>{const{notify:a}=E(),{patchEmployee:o,isPending:l}=O(),i=async()=>{await o({id:e.id,is_active:!0}),a.success({title:`You have successfully activated ${e.name}`,message:`${e.name} will be able to log in to Landscape and register new instances with their account.`}),s()};return t.jsx(u.ConfirmationModal,{confirmButtonLabel:"Activate",onConfirm:i,confirmButtonAppearance:"positive",title:`Activate ${e.name}`,close:s,confirmButtonDisabled:l,confirmButtonLoading:l,children:t.jsxs("p",{children:["This will allow ",e.name," to log in to Landscape and register new instances with their account."]})})},q="Irreversibly deletes all data on disks of associated instances. Proceed with caution",G="This will remove all instances associated with this employee from Landscape.",K={sanitizationConfirmationText:"",sanitizeInstances:!1,removeFromLandscapeConfirmationText:"",removeFromLandscape:!1},U="_title_1azx9_1",Y="_tooltipPositionElement_1azx9_5",Q="_additionalActionContainer_1azx9_9",g={title:U,tooltipPositionElement:Y,additionalActionContainer:Q},W=(e,s)=>s.removeFromLandscape&&s.sanitizeInstances?`Off-board ${e}`:`Deactivate ${e}`,Z=e=>e.removeFromLandscape&&e.sanitizeInstances?"Off-board":e.removeFromLandscape?"Deactivate and remove":e.sanitizeInstances?"Deactivate and sanitize":"Deactivate",J=e=>!!(e.sanitizeInstances&&e.sanitizationConfirmationText!=="sanitize instances"||e.removeFromLandscape&&e.removeFromLandscapeConfirmationText!=="remove instances"||e.sanitizeInstances&&e.removeFromLandscape&&e.sanitizationConfirmationText!=="sanitize instances"&&e.removeFromLandscapeConfirmationText!=="remove instances"),X=(e,s,a)=>s&&a?{notificationTitle:`You have successfully deactivated ${e} and initiated both Sanitization and Removal of their instances`,notificationMessage:"Sanitization and removal of this employee’s instances have been queued. The data will be permanently irrecoverable once complete. To manage the instances again, they will need to be re-registered in Landscape."}:s?{notificationTitle:`You have successfully deactivated ${e} and initiated sanitization of their instances`,notificationMessage:`Sanitization of the ${e}’s instances has been queued in Activities. The data will be permanently irrecoverable once complete.`}:a?{notificationTitle:`You have successfully deactivated ${e} and initiated the Removal of their instances`,notificationMessage:"The removal of this employee’s instances has been queued. This process will delete all stored data. To manage them again, they will need to be re-registered in Landscape."}:{notificationTitle:`You have successfully deactivated ${e}`,notificationMessage:"This employee won’t be able to log in to Landscape or register new instances with their account."},ee=({employee:e,handleClose:s})=>{const{notify:a}=E(),{deactivateEmployee:o,isDeactivating:l}=H(),i=S({initialValues:K,enableReinitialize:!0,onSubmit:async m=>{if(m.sanitizeInstances&&m.sanitizationConfirmationText!=="sanitize instances"||m.removeFromLandscape&&m.removeFromLandscapeConfirmationText!=="remove instances")return;await o({id:e.id,remove_instances:i.values.removeFromLandscape,sanitize_instances:i.values.sanitizeInstances}),i.resetForm(),s();const{notificationMessage:p,notificationTitle:n}=X(e.name,i.values.sanitizeInstances,i.values.removeFromLandscape);a.success({title:n,message:p})}});return t.jsx(u.ConfirmationModal,{title:W(e.name,i.values),confirmButtonLabel:Z(i.values),confirmButtonProps:{type:"submit"},onConfirm:()=>{i.handleSubmit()},close:s,confirmButtonDisabled:J(i.values)||l,confirmButtonLoading:l,children:t.jsxs(u.Form,{noValidate:!0,onSubmit:m=>{m.preventDefault(),i.handleSubmit()},children:[t.jsxs("p",{children:["This will prevent ",e.name," from logging in to Landscape and from registering any new instances with their account"]}),t.jsx("b",{children:"Additional actions"}),t.jsxs("div",{children:[t.jsx(u.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:g.title,children:"Sanitize associated instances"}),t.jsxs(u.Tooltip,{position:"top-center",message:q,positionElementClassName:g.tooltipPositionElement,children:[t.jsx(u.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...i.getFieldProps("sanitizeInstances"),onChange:async m=>{i.getFieldProps("sanitizeInstances").onChange(m),await i.setFieldValue("sanitizationConfirmationText","")}}),i.values.sanitizeInstances&&t.jsxs("div",{className:g.additionalActionContainer,children:[t.jsx("p",{children:"Sanitization will permanently delete the encryption keys for associated instances, making its data completely irrecoverable. This action cannot be undone. Please confirm you wish to proceed."}),t.jsx(u.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"sanitize instances"})," to confirm"]}),"aria-label":"Sanitization confirmation text",placeholder:"sanitize instances",autoComplete:"off",type:"text",...i.getFieldProps("sanitizationConfirmationText")},"sanitizationConfirmationText")]}),t.jsx(u.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:g.title,children:"Remove associated instances from Landscape"}),t.jsxs(u.Tooltip,{position:"top-center",message:G,positionElementClassName:g.tooltipPositionElement,children:[t.jsx(u.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...i.getFieldProps("removeFromLandscape"),onChange:async m=>{i.getFieldProps("removeFromLandscape").onChange(m),await i.setFieldValue("removeFromLandscapeConfirmationText","")}}),i.values.removeFromLandscape&&t.jsxs("div",{className:g.additionalActionContainer,children:[t.jsx("p",{children:"This will remove all associated instances from Landscape, along with their stored data. To manage them again, you would need to re-register them in Landscape."}),t.jsx(u.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"remove instances"})," to confirm."]}),placeholder:"remove instances",autoComplete:"off","aria-label":"Remove from Landscape confirmation text",type:"text",...i.getFieldProps("removeFromLandscapeConfirmationText")},"removeFromLandscapeConfirmationText")]})]})]})})},te=h.lazy(async()=>A(()=>import("./index-Duk6eMIe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),ae=({employee:e})=>{const{setSidePanelContent:s}=F(),{value:a,setTrue:o,setFalse:l}=T(),{value:i,setTrue:m,setFalse:p}=T(),n=()=>{s("Employee details",t.jsx(h.Suspense,{fallback:t.jsx(z,{}),children:t.jsx(te,{employee:e})}),"medium")},r=[{icon:"file",label:"View details","aria-label":`View ${e.name} employee details`,onClick:n}],c=[];return e.is_active?c.push({icon:"pause",label:"Deactivate","aria-label":`Deactivate ${e.name}`,onClick:m}):r.push({icon:"play",label:"Activate","aria-label":`Activate ${e.name}`,onClick:o}),t.jsxs(t.Fragment,{children:[t.jsx(M,{toggleAriaLabel:`${e.name} actions`,actions:r,destructiveActions:c}),a&&t.jsx(V,{employee:e,handleClose:l}),i&&t.jsx(ee,{employee:e,handleClose:p})]})},se="_expandedCell_1xtzp_1",ne="_expandedRow_1xtzp_6",ie="_truncatedItem_1xtzp_11",oe="_autoinstallFileHeaderTitle_1xtzp_18",f={expandedCell:se,expandedRow:ne,truncatedItem:ie,autoinstallFileHeaderTitle:oe},ce=e=>({index:s})=>{const a={};return((e==null?void 0:e.column)==="computers"||(e==null?void 0:e.column)==="groups")&&e.row===s&&(a.className=f.expandedRow),a},re=e=>({column:s,row:{index:a}})=>{const o={};return s.id==="computers"?(o["aria-label"]="Associated instances",(e==null?void 0:e.column)===s.id&&e.row===a&&(o.className=f.expandedCell)):s.id==="groups"?(o["aria-label"]="Employee group",(e==null?void 0:e.column)===s.id&&e.row===a&&(o.className=f.expandedCell)):s.id==="name"?o.role="rowheader":s.id==="email"?o["aria-label"]="Email":s.id==="status"?o["aria-label"]="Status":s.id==="autoinstall_file"?o["aria-label"]="Assigned autoinstall file":s.id==="actions"&&(o["aria-label"]="Actions"),o},le=e=>s=>{s&&(e.current=[...s.querySelectorAll("tbody tr")])},me=h.lazy(async()=>A(()=>import("./index-Duk6eMIe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),he=({employees:e})=>{const{setSidePanelContent:s}=F(),[a,o]=h.useState(null),l=h.useRef([]);$((a==null?void 0:a.column)==="computers"||(a==null?void 0:a.column)==="groups"?{current:l.current[a.row]}:[],n=>{n.target instanceof Element&&!n.target.closest(`.${f.truncatedItem}`)&&o(null)});const i=(n,r)=>{o(c=>(c==null?void 0:c.column)===n&&c.row===r?null:{column:n,row:c&&["computers","groups"].includes(c.column)&&c.row<r?r-1:r})},m=n=>{s("Employee details",t.jsx(h.Suspense,{fallback:t.jsx(z,{}),children:t.jsx(me,{employee:n})}),"medium")},p=h.useMemo(()=>[{accessor:"name",Header:"name",Cell:({row:{original:n}})=>t.jsx(u.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{m(n)},"aria-label":`Show details of user ${n.name}`,children:n.name})},{accessor:"email",Header:"email"},{accessor:"groups",Header:"employee group",Cell:({row:{original:n,index:r}})=>n.groups&&n.groups.length>0?t.jsx(_,{content:n.groups.map(c=>t.jsx(w,{to:`/settings/employees?tab=employee-groups&search=${c.name}`,className:f.truncatedItem,children:c.name},c.group_id)),isExpanded:(a==null?void 0:a.column)==="groups"&&a.row===r,onExpand:()=>{i("groups",r)}}):t.jsx(v,{})},{accessor:"autoinstall_file",Header:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:f.autoinstallFileHeaderTitle,children:"assigned autoinstall file"}),t.jsx(u.Tooltip,{message:"This configuration file is assigned based on the highest-priority group the user belongs to.",children:t.jsx(u.Icon,{name:"help"})})]}),Cell:({row:{original:n}})=>{var r,c;return(r=n.autoinstall_file)!=null&&r.filename?t.jsx("span",{children:(c=n.autoinstall_file)==null?void 0:c.filename}):t.jsx(v,{})}},{accessor:"status",Header:"status",Cell:({row:{original:n}})=>t.jsx("span",{children:R(n)}),getCellIcon:({row:{original:{is_active:n}}})=>n?"status-succeeded-small":"status-failed-small"},{accessor:"computers",Header:"associated instances",Cell:({row:{original:n,index:r}})=>{var c;return n.computers&&n.computers.length>0?t.jsx(_,{content:(c=n.computers)==null?void 0:c.map(d=>t.jsx(w,{className:f.truncatedItem,to:`/instances/${d.id}`,children:d.title},d.id)),isExpanded:(a==null?void 0:a.column)==="computers"&&a.row===r,onExpand:()=>{i("computers",r)}}):t.jsx(v,{})}},{...N,Cell:({row:{original:n}})=>t.jsx(ae,{employee:n})}],[e,a]);return t.jsx("div",{ref:le(l),children:t.jsx(u.ModularTable,{columns:p,data:e,getCellProps:re(a),getRowProps:ce(a),emptyMsg:"No employees found according to your search parameters."})})};export{V as A,ee as D,he as E,R as g,pe as u};
