import{j as t,r as u,o as z,d as n,B as _,C as T,a as $,a3 as E,aE as w,ap as L,aa as m,ai as N,L as R,E as k,I as l,N as P}from"./index-DdDZs9iJ.js";import{D,A as M,g as O}from"./EmployeeList-B3PvhAfW.js";import{g as p}from"./InstancesPageActions-BB322Y5M.js";import{u as B}from"./useInstances-xzL-A-Ng.js";import"./ResponsiveButtons-D85C5YGV.js";const H=e=>e.employee.is_active?t.jsx(D,{...e}):t.jsx(M,{...e}),V=({employee:e})=>{const[i,a]=u.useState(!1),{closeSidePanel:s}=z(),c=()=>{a(!0)},d=()=>{a(!1),s()};return t.jsxs("div",{children:[t.jsxs(n.Button,{hasIcon:!0,onClick:c,children:[t.jsx(n.Icon,{name:e.is_active?"pause":"play"}),t.jsx("span",{children:e.is_active?"Deactivate":"Activate"})]}),i&&t.jsx(H,{employee:e,handleClose:d})]})},Y=({instance:e})=>{const[i,a]=u.useState(""),s=_(),{notify:c}=T(),d=$(),{openActivityDetails:f}=E(),{removeInstancesQuery:h,sanitizeInstanceQuery:g}=B(),{mutateAsync:x,isPending:y}=h,{mutateAsync:b,isPending:j}=g,r=()=>{a("")},C=async()=>{try{const{data:o}=await b({computer_id:e.id,computer_title:e.title});c.success({title:`You have successfully initiated Sanitization for ${e.title}`,message:`Sanitizing for ${e.title} has been queued in Activities. The data will be permanently irrecoverable once complete.`,actions:[{label:"View details",onClick:()=>{f(o)}}]})}catch(o){s(o)}finally{r()}},A=async()=>{try{await x({computer_ids:[e.id]}),c.success({title:`You have successfully removed ${e.title}`,message:`${e.title} has been removed from Landscape. To manage it again, you will need to re-register it in Landscape.`})}catch(o){s(o)}finally{r()}},S=[{icon:"machines",label:"View details","aria-label":`View ${e.title} instance details`,onClick:async()=>d(`${w}instances/${e.id}`)}],I=[{icon:"tidy",label:"Sanitize","aria-label":`Sanitize ${e.title} instance`,onClick:()=>{a("sanitize")}},{icon:n.ICONS.delete,label:"Remove from Landscape","aria-label":"Remove from Landscape",onClick:()=>{a("remove")}}];return t.jsxs(t.Fragment,{children:[t.jsx(L,{toggleAriaLabel:`${e.title} profile actions`,actions:S,destructiveActions:I}),t.jsx(m,{isOpen:i==="remove",title:`Remove ${e.title} instance`,confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:y,onConfirm:A,close:r,confirmationText:`remove ${e.title}`,children:t.jsxs("p",{children:["Removing this ",e.title," will delete all associated data and free up one license slot for another computer to be registered."]})}),t.jsx(m,{isOpen:i==="sanitize",title:`Sanitize "${e.title}" instance`,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:j,onConfirm:C,close:r,confirmationText:`sanitize ${e.title}`,children:t.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",e.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})},v={title:"No instances found",body:"There are no instances associated with this employee."},F="_container_6gega_1",Q={container:F},q=()=>({column:e})=>{const i={};return e.id==="name"?i.role="rowheader":e.id==="status"?i["aria-label"]="Status":e.id==="recovery_key"?i["aria-label"]="Recovery key":e.id==="actions"&&(i["aria-label"]="Actions"),i},U=({instances:e})=>{const i=u.useMemo(()=>[{accessor:"name",Header:"name",Cell:({row:a})=>t.jsx(R,{to:a.original.parent?`/instances/${a.original.parent.id}/${a.original.id}`:`/instances/${a.original.id}`,children:a.original.title})},{accessor:"status",Header:"status",Cell:({row:{original:a}})=>{const{label:s}=p(a);return s},getCellIcon:({row:{original:a}})=>{const{icon:s}=p(a);return s}},{accessor:"recovery_key",Header:"recovery key",Cell:()=>"****************"},{...N,Cell:({row:{original:a}})=>t.jsx(Y,{instance:a})}],[e]);return t.jsxs("div",{className:Q.container,children:[t.jsx("h4",{className:"p-heading--5",children:"Instances associated"}),e&&e.length>0?t.jsx(n.ModularTable,{data:e,columns:i,getCellProps:q()}):t.jsx(k,{title:v.title,body:v.body})]})},Z=({employee:e})=>{var i,a;return t.jsxs(t.Fragment,{children:[t.jsx(V,{employee:e}),t.jsxs(n.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(n.Col,{size:6,children:t.jsx(l,{label:"name",value:e.name})}),t.jsx(n.Col,{size:6,children:t.jsx(l,{label:"email",value:e.email})})]}),t.jsxs(n.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(n.Col,{size:6,children:t.jsx(l,{label:"employee groups",value:((a=(i=e.groups)==null?void 0:i.map(s=>s.name))==null?void 0:a.join(", "))||"N/A",type:"truncated"})}),t.jsx(n.Col,{size:6,children:t.jsx(l,{label:"status",value:O(e)})})]}),t.jsx(l,{label:"autoinstall file",value:e.autoinstall_file?`${e.autoinstall_file.filename}, v${e.autoinstall_file.version}`:t.jsx(P,{})}),t.jsx(U,{instances:e.computers})]})};export{Z as default};
