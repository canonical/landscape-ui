const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CDFSe72f.js","assets/index-DAtALh-2.js","assets/index-B4iKRl47.css","assets/useInstances-Cm5aDfQ4.js","assets/ResponsiveButtons-XXiC5oZb.js","assets/ResponsiveButtons-C56n2q_V.css","assets/InstancesPageActions-B-roz792.js","assets/InstancesPageActions-B7AIml_J.css","assets/useRoles-CIcnuZR2.js","assets/TagsAddConfirmationModal-D6k3qMFD.js","assets/TagsAddConfirmationModal-HDr0Q-Wm.css","assets/WslInstancesHeader-B72of0uV.js","assets/HeaderWithSearch-ProrQzup.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/WslInstancesHeader-Dj3EjS23.css","assets/index-KgqhRPrR.css","assets/index-ng2zaHmP.js","assets/index-BzXEPdn_.css","assets/index-DOybNzcE.js","assets/index-B8MQ95pn.css","assets/index-DFrrccCx.js","assets/useUsns-DYYzYlk5.js","assets/useUsns-BRJzzA4M.css","assets/useSelection-DCIIpbIv.js","assets/index-B0p01W4u.css","assets/index-BhVepyW3.js","assets/useGetActivities-CWHpqj7C.js","assets/ActivitiesEmptyState-D5h-Oxfd.js","assets/index-DU6LJmgq.js","assets/PageMain-CePrmgOY.js","assets/PageMain-CIunaku7.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-CzrLW3IK.css","assets/index-CPWcA6Qh.js","assets/index-BAsg6f-x.css","assets/index-C8Qxt1US.js","assets/SidePanelFormButtons-CK4Vuqll.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/helpers-LoaB0ErL.js","assets/index-DQLukqVs.css","assets/index-CR1U-ilt.js","assets/UsnList-CBqcqbY_.js","assets/SelectAllButton-Dcj5gkV6.js","assets/ExpandableTableFooter-BRhdIdKP.js","assets/ExpandableTableFooter-CF0EpBAN.css","assets/UsnList-CKGNeYRs.css","assets/index-CsHgpdRJ.css","assets/index-CDWBQG-N.js","assets/index-B1Uu4xTW.css","assets/index-VDNa2GNU.js","assets/downshift.esm-CzLqWppv.js","assets/index-BcIsbW0p.css","assets/index-Bw1fap1c.js","assets/constants-DbRnPyAI.js","assets/index-CNIav8so.css","assets/index-DbHoXgdw.js","assets/constants-Dwl1JGyb.js","assets/index-DgHoeIwv.css","assets/index-BjJnAMSN.js"])))=>i.map(i=>d[i]);
import{a as T,j as e,E as D,d as p,o as K,f as Q,an as V,r as o,q as x,a2 as u,c as O,i as z,k as E,l as w,R as B,b as U}from"./index-DAtALh-2.js";import{P as N,a as S,b as q}from"./PageMain-CePrmgOY.js";import{u as $,a as H}from"./useUsns-DYYzYlk5.js";import{u as M}from"./useInstances-Cm5aDfQ4.js";import{c as G}from"./SingleInstanceTabs.module-Cm1BYFZQ.js";import{d as k,R as W}from"./ResponsiveButtons-XXiC5oZb.js";const J=({childInstanceId:n,instanceId:t})=>{const s=T();return e.jsx(D,{title:"Instance not found",icon:"connected",body:e.jsxs("p",{className:"u-no-margin--bottom",children:[e.jsx("span",{children:"Seems like the instance with id = "}),e.jsx("code",{children:t}),e.jsx("span",{children:" doesn't "}),n?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"have a child instance with id = "}),e.jsx("code",{children:n})]}):e.jsx("span",{children:"exist"}),"."]}),cta:[e.jsx(p.Button,{appearance:"positive",onClick:async()=>s("/instances",{replace:!0}),type:"button","aria-label":"Go back",children:"Back to Instances page"},"go-back-to-instances-page"),e.jsx(p.Button,{onClick:async()=>s("/",{replace:!0}),type:"button","aria-label":"Go back",children:"Home page"},"go-back-to-home-page")]})},_={ubuntu:"Ubuntu",ubuntuCore:"Ubuntu Core",windows:"Microsoft"},X=[{label:"Info",id:"tab-link-info",condition:()=>!0},{label:"WSL",id:"tab-link-wsl",condition:n=>{var t;return((t=n.distribution_info)==null?void 0:t.distributor)===_.windows}},{label:"Activities",id:"tab-link-activities",condition:()=>!0},{label:"Kernel",id:"tab-link-kernel",condition:n=>{var t;return((t=n.distribution_info)==null?void 0:t.distributor)===_.ubuntu}},{label:"Security issues",id:"tab-link-security-issues",condition:n=>{var t;return((t=n.distribution_info)==null?void 0:t.distributor)===_.ubuntu}},{label:"Packages",id:"tab-link-packages",condition:n=>{var t;return((t=n.distribution_info)==null?void 0:t.distributor)===_.ubuntu}},{label:"Snaps",id:"tab-link-snaps",condition:n=>{var t;return((t=n.distribution_info)==null?void 0:t.distributor)!==_.windows}},{label:"Processes",id:"tab-link-processes",condition:n=>{var t;return((t=n.distribution_info)==null?void 0:t.distributor)!==_.windows}},{label:"Ubuntu Pro",id:"tab-link-ubuntu-pro",condition:n=>{var t;return[_.ubuntu,_.ubuntuCore,_.windows].includes(((t=n.distribution_info)==null?void 0:t.distributor)??"")}},{label:"Users",id:"tab-link-users",condition:n=>{var t;return![_.ubuntuCore,_.windows].includes(((t=n.distribution_info)==null?void 0:t.distributor)??"")}},{label:"Hardware",id:"tab-link-hardware",condition:n=>{var t;return((t=n.distribution_info)==null?void 0:t.distributor)!==_.windows}}],Y=({id:n,label:t,packageCount:s,packagesLoading:r,usnCount:d,usnLoading:g,kernelCount:i,kernelLoading:l})=>n==="tab-link-packages"&&r||n==="tab-link-security-issues"&&g||n==="tab-link-kernel"&&l?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:t}),e.jsx(p.Spinner,{className:"u-no-margin--bottom u-no-padding--top"})]}):n==="tab-link-packages"&&s?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:t}),e.jsx(p.Badge,{value:s})]}):n==="tab-link-security-issues"&&d?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:t}),e.jsx(p.Badge,{value:d,isNegative:!0})]}):n==="tab-link-kernel"&&i?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:t}),e.jsx(p.Badge,{value:i})]}):t,Z=({activeTabId:n,instance:t,onActiveTabChange:s,packageCount:r,packagesLoading:d,usnCount:g,usnLoading:i,kernelCount:l,kernelLoading:b})=>X.filter(m=>m.condition(t)).map(({label:m,id:a})=>({label:Y({label:m,id:a,packageCount:r,packagesLoading:d,usnCount:g,usnLoading:i,kernelCount:l,kernelLoading:b}),id:a,role:"tab",active:a===n,onClick:()=>{s(a)}})),nn=o.lazy(async()=>u(()=>import("./index-CDFSe72f.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),en=o.lazy(async()=>u(()=>import("./index-ng2zaHmP.js"),__vite__mapDeps([16,1,2,12,13,17]))),tn=o.lazy(async()=>u(()=>import("./index-DOybNzcE.js"),__vite__mapDeps([18,1,2,19]))),sn=o.lazy(async()=>u(()=>import("./index-DFrrccCx.js"),__vite__mapDeps([20,1,2,21,4,5,22,12,13,23,24]))),an=o.lazy(async()=>u(()=>import("./index-BhVepyW3.js"),__vite__mapDeps([25,1,2,23,26,27]))),rn=o.lazy(async()=>u(()=>import("./index-DU6LJmgq.js"),__vite__mapDeps([28,1,2,29,30,21,4,5,22,3,31,32,33]))),on=o.lazy(async()=>u(()=>import("./index-CPWcA6Qh.js"),__vite__mapDeps([34,1,2,11,12,13,3,14,35]))),cn=o.lazy(async()=>u(()=>import("./index-C8Qxt1US.js").then(n=>n.i),__vite__mapDeps([36,1,2,37,38,39,40,4,5,12,13,41]))),ln=o.lazy(async()=>u(()=>import("./index-CR1U-ilt.js"),__vite__mapDeps([42,1,2,21,4,5,22,12,13,43,44,45,46,47,48]))),un=o.lazy(async()=>u(()=>import("./index-CDWBQG-N.js"),__vite__mapDeps([49,1,2,50]))),dn=o.lazy(async()=>u(()=>import("./index-VDNa2GNU.js"),__vite__mapDeps([51,1,2,37,38,39,52,12,13,40,4,5,53]))),bn=({instance:n,packageCount:t,packagesLoading:s,usnCount:r,usnLoading:d,kernelCount:g,kernelLoading:i})=>{const{closeSidePanel:l}=K(),{tab:b,setPageParams:m}=Q(),a=b?`tab-link-${b}`:"tab-link-info",c=Z({activeTabId:a,instance:n,onActiveTabChange:y=>{m({tab:y.replace("tab-link-","")}),l()},packageCount:t,packagesLoading:s,usnCount:r,usnLoading:d,kernelCount:g,kernelLoading:i});return e.jsxs(e.Fragment,{children:[e.jsx(p.Tabs,{listClassName:"u-no-margin--bottom",links:c}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":a,className:G.tabPanel,children:e.jsx(V,{children:e.jsxs(o.Suspense,{fallback:e.jsx(x,{}),children:[a==="tab-link-info"&&e.jsx(nn,{instance:n}),a==="tab-link-wsl"&&e.jsx(on,{instance:n}),a==="tab-link-activities"&&e.jsx(an,{instanceId:n.id}),a==="tab-link-kernel"&&e.jsx(rn,{instanceTitle:n.title}),a==="tab-link-security-issues"&&e.jsx(ln,{instance:n}),a==="tab-link-packages"&&e.jsx(sn,{}),a==="tab-link-snaps"&&e.jsx(dn,{}),a==="tab-link-processes"&&e.jsx(en,{}),a==="tab-link-ubuntu-pro"&&e.jsx(un,{instance:n}),a==="tab-link-users"&&e.jsx(cn,{}),a==="tab-link-hardware"&&e.jsx(tn,{instance:n})]})})})]})},pn=n=>{if(n)return n.parent?[{label:"Instances",path:"/instances"},{label:n.parent.title,path:`/instances/${n.parent.id}`},{label:n.title,current:!0}]:[{label:"Instances",path:"/instances"},{label:n.title,current:!0}]},gn=n=>{var t,s;if(!(!n||n.length===0||!((s=(t=n[0])==null?void 0:t.Livepatch)!=null&&s.Fixes)))return n[0].Livepatch.Fixes.length},_n=(n,t)=>n.distribution?t:0,mn=(n,t)=>n.distribution?t:0,yn=n=>(n==null?void 0:n.title)??"",xn=(n,t)=>parseInt(t||(n??"")),hn=(n,t,s)=>!!n&&(!t||t===s),jn=(n,t,s)=>{var r;return!!n&&k("ubuntu",n)&&(!s||((r=n.parent)==null?void 0:r.id)===parseInt(t??""))},kn=(n,t,s)=>{var r;return!!n&&k("ubuntu",n)&&(!s||((r=n.parent)==null?void 0:r.id)===parseInt(t??""))},In=(n,t,s)=>{var r;return!!n&&k("ubuntu",n)&&(!s||((r=n.parent)==null?void 0:r.id)===parseInt(t??""))},fn=n=>n?[n.id]:[],L=n=>n?n.id:0,Pn=(n,t,s)=>n&&(!s||n.parent&&n.parent.id===parseInt(t??"")),vn="_container_pnq0d_1",En={container:vn},wn=o.lazy(async()=>u(()=>import("./index-Bw1fap1c.js"),__vite__mapDeps([54,1,2,55,29,30,21,4,5,22,3,31,32,56]))),Ln=o.lazy(async()=>u(()=>import("./index-DbHoXgdw.js"),__vite__mapDeps([57,1,2,58,55,29,30,21,4,5,22,3,31,32,59]))),Tn=o.lazy(async()=>u(()=>import("./index-BjJnAMSN.js"),__vite__mapDeps([60,1,2,3,58,29,30,21,4,5,22,31,32,59]))),On=({instanceName:n,hasTableData:t,kernelStatuses:s})=>{var a;const{setSidePanelContent:r}=K(),d=((a=s==null?void 0:s.installed)==null?void 0:a.version_rounded)??"",g=(s==null?void 0:s.downgrades)??[],i=(s==null?void 0:s.upgrades)??[],l=()=>{r("Downgrade kernel",e.jsx(o.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(wn,{instanceName:n,currentKernelVersion:d,downgradeKernelVersions:g})}))},b=()=>{r("Upgrade kernel",e.jsx(o.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(Ln,{instanceName:n,currentKernelVersion:d,upgradeKernelVersions:i})}))},m=()=>{var c;r(`Restart ${n}`,e.jsx(o.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(Tn,{instanceName:n,showNotification:t,newKernelVersionId:(c=i[0])==null?void 0:c.id})}))};return e.jsxs("div",{className:En.container,children:[e.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:"Kernel overview"}),e.jsx(W,{collapseFrom:"lg",buttons:[e.jsxs(p.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:m,children:[e.jsx(p.Icon,{name:"restart"}),e.jsx("span",{children:"Restart instance"})]},"restart-instance"),e.jsxs(p.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:g.length===0,onClick:l,children:[e.jsx(p.Icon,{name:"begin-downloading"}),e.jsx("span",{children:"Downgrade kernel"})]},"downgrade-kernel"),e.jsxs(p.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:i.length===0,onClick:b,children:[e.jsx(p.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade kernel"})]},"upgrade-kernel")]})]})};function Kn(){const n=O(),t=z(),s=({id:i},l={})=>w({queryKey:["kernel",i],queryFn:async()=>n.get(`computers/${i}/livepatch/kernel`),...l}),r=({id:i,...l},b={})=>w({queryKey:["kernel",{id:i,...l}],queryFn:async()=>n.get(`computers/${i}/livepatch/info`,{params:l}),...b}),d=E({mutationKey:["kernel","downgrade"],mutationFn:async({id:i,...l})=>n.post(`computers/${i}/kernel/downgrade`,l),onSuccess:async()=>t.invalidateQueries({queryKey:["kernel"]})}),g=E({mutationKey:["kernel","upgrade"],mutationFn:async({id:i,...l})=>n.post(`computers/${i}/kernel/upgrade`,l),onSuccess:async()=>t.invalidateQueries({queryKey:["kernel"]})});return{getKernelQuery:s,getLivepatchInfoQuery:r,downgradeKernelQuery:d,upgradeKernelQuery:g}}const Rn=()=>{var f,P,v;const{instanceId:n,childInstanceId:t}=B(),{user:s}=U(),r=T(),{getSingleInstanceQuery:d}=M(),{getUsnsQuery:g}=$(),{getInstancePackagesQuery:i}=H(),{getLivepatchInfoQuery:l}=Kn(),b=o.useRef("");o.useEffect(()=>{s!=null&&s.current_account&&(b.current||(b.current=s.current_account),b.current!==s.current_account&&r("/instances",{replace:!0}))},[s==null?void 0:s.current_account]);const{data:m,isLoading:a}=d({instanceId:xn(n,t),with_annotations:!0,with_grouped_hardware:!0},{enabled:hn(n,b.current,s==null?void 0:s.current_account)}),c=(m==null?void 0:m.data)??null,{data:y,isLoading:R}=g({computer_ids:fn(c),limit:1},{enabled:In(c,n,t)}),{data:h,isLoading:F}=i({available:!1,upgrade:!0,instance_id:L(c),limit:1},{enabled:jn(c,n,t)}),{data:j,isLoading:C}=l({id:L(c)},{enabled:kn(c,n,t)}),A=gn((v=(P=(f=j==null?void 0:j.data.livepatch_info)==null?void 0:f.json)==null?void 0:P.output)==null?void 0:v.Status),I=Pn(c,n,t);return e.jsxs(N,{children:[e.jsx(S,{title:yn(c),hideTitle:!0,breadcrumbs:pn(c)}),e.jsx(q,{children:a?e.jsx(x,{}):e.jsxs(e.Fragment,{children:[!I&&e.jsx(J,{childInstanceId:t,instanceId:n}),c&&I&&e.jsx(bn,{instance:c,packageCount:_n(c,Number(h==null?void 0:h.data.count)),packagesLoading:F,usnCount:mn(c,Number(y==null?void 0:y.data.count)),usnLoading:R,kernelCount:c.distribution?A:0,kernelLoading:C})]})})]})},zn=Object.freeze(Object.defineProperty({__proto__:null,default:Rn},Symbol.toStringTag,{value:"Module"}));export{On as K,zn as i,Kn as u};
