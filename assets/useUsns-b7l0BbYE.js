const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DHwALhPx.js","assets/index-BhA4J3ko.js","assets/index-DWaf_ZwL.css","assets/moment-C5S46NFB.js","assets/SidePanelFormButtons-7JkHrlOz.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/InfoItem-CWs2RNzA.js","assets/InfoItem-C-lWh_lY.css","assets/index-CiyUTYym.js","assets/moment-ik4I3HqO.js","assets/TablePagination-3ewSJTtu.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-Cx4Fh8yG.js","assets/EmptyState-C71tSpTG.js","assets/EmptyState-DUn4ZRie.css","assets/SearchHelpPopup-D3CRBmmX.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/PageMain-BGNK0xG-.js","assets/PageMain-BIuYvhUI.css","assets/useMutation-D6hW2Vr2.js","assets/useFetchOld-5foHVBsZ.js","assets/useConfirm-CiNGk-W0.js","assets/NoData-JiBvrZwJ.js","assets/index-BmoMXq9B.css","assets/index.esm-B8rBEOcC.js","assets/index-BDdu760-.css","assets/index-Dq4XgM9u.js","assets/index-B-IBcZg_.js","assets/downshift.esm-ZJumWBCh.js","assets/index-Cd8ASpmd.css"])))=>i.map(i=>d[i]);
import{r as c,_ as I,f as $,j as n,h as u,l as f,a as L,m as N,R as q,L as A,i as B,c as F,d as T}from"./index-BhA4J3ko.js";import{u as j}from"./PageMain-BGNK0xG-.js";import{u as y}from"./useMutation-D6hW2Vr2.js";import{u as D}from"./useFetchOld-5foHVBsZ.js";const p={downgrade:{appearance:"positive",icon:"begin-downloading",label:"Downgrade",order:4},hold:{appearance:"positive",icon:"pause",label:"Hold",order:2},remove:{appearance:"negative",icon:"delete",label:"Uninstall",order:1},unhold:{appearance:"positive",icon:"play",label:"Unhold",order:3},upgrade:{appearance:"positive",icon:"change-version",label:"Upgrade",order:5}},w="_toggleButton_1ep2i_1",O="_actionButton_1ep2i_6",H={toggleButton:w,actionButton:O},R=c.lazy(()=>I(()=>import("./index-DHwALhPx.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),V=({pkg:e})=>{const{setSidePanelContent:a}=$(),s={remove:!0,hold:e.status!=="held",unhold:e.status==="held",upgrade:!!e.available_version&&e.available_version!==e.current_version,downgrade:e.status!=="held"},d=o=>{a(`${p[o].label} ${e.name}`,n.jsx(c.Suspense,{fallback:n.jsx(f,{}),children:n.jsx(R,{action:o,packages:[e]})}))};return n.jsx(u.ContextualMenu,{position:"left",toggleClassName:H.toggleButton,toggleAppearance:"base",toggleLabel:n.jsx(u.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${e.name} package actions`},children:Object.keys(p).map(o=>o).sort((o,t)=>p[t].order-p[o].order).map(o=>n.jsx(c.Fragment,{children:s[o]&&n.jsxs(u.Button,{type:"button",appearance:"base",hasIcon:!0,className:"p-contextual-menu__link",onClick:()=>d(o),"aria-label":`${p[o].label} ${e.name} package`,children:[n.jsx(u.Icon,{name:p[o].icon}),n.jsx("span",{children:p[o].label})]})},o))})},M=({onDismiss:e})=>{const a=L(),{instanceId:s,childInstanceId:d}=N();return n.jsxs(u.Notification,{severity:"caution",onDismiss:e,children:[n.jsx("strong",{children:"Some upgrades require Ubuntu Pro: "}),n.jsxs("span",{children:["Your current Ubuntu package upgrades are limited. To unlock full upgrades, please upgrade to Ubuntu Pro."," "]}),n.jsx(u.Button,{type:"button",appearance:"link",onClick:()=>{a(`${q}instances/${d?`${s}/${d}`:s}`,{state:{tab:"ubuntu-pro"}})},children:"Learn more"})]})},W={available_version:null,current_version:null,id:-1,name:"loading",status:"available",summary:""},z="_checkbox_1xyx4_1",G="_details_1xyx4_5",Y="_tooltipLink_1xyx4_9",J="_hidden_1xyx4_13",X="_actions_1xyx4_17",_={checkbox:z,details:G,tooltipLink:Y,hidden:J,actions:X},C=e=>!!e.available_version&&!!e.current_version&&e.available_version.includes("ubuntu-pro"),Q=e=>{const a={label:"Unknown",icon:""};return e.status==="available"?(a.label="Available",a.icon="status-queued-small"):e.status==="held"?(a.label="Held",a.icon="status-in-progress-small"):e.status==="security"?(a.label="Security upgrade",a.icon="status-failed-small"):e.status==="installed"&&(e.available_version?(a.label="Regular upgrade",a.icon="status-waiting-small"):(a.label="Installed",a.icon="status-succeeded-small")),a},Z=({column:e,row:a})=>{const s={};return a.original.name==="loading"?e.id==="name"?s.colSpan=5:(s.className=_.hidden,s["aria-hidden"]=!0):e.id==="checkbox"?s["aria-label"]=`Toggle ${a.original.name} package`:e.id==="name"?s.role="rowheader":e.id==="status"?s["aria-label"]="Status":e.id==="current_version"?s["aria-label"]="Current version":e.id==="available_version"?s["aria-label"]="Available version":e.id==="summary"&&(s["aria-label"]="Details"),s},ee=c.lazy(()=>I(()=>import("./index-Dq4XgM9u.js"),__vite__mapDeps([28,1,2,7,8,19,20,21,22]))),ue=({emptyMsg:e,onPackagesSelect:a,packages:s,packagesLoading:d,selectedPackages:o,selectAll:t})=>{const[h,i]=c.useState(!1),[m,x]=c.useState(!1),{instanceId:l,childInstanceId:g}=N(),{setSidePanelContent:v}=$(),K=c.useMemo(()=>d?[W]:s,[s,d]),P=r=>{a(o.some(({name:b})=>b===r.name)?o.filter(({name:b})=>b!==r.name):[...o,r])},k=()=>{a(o.length>0?[]:s.filter(r=>!C(r)))};c.useEffect(()=>{!t||h||!s.length||(k(),i(!0))},[t,s]);const U=r=>{v("Package details",n.jsx(c.Suspense,{fallback:n.jsx(f,{}),children:n.jsx(ee,{singlePackage:r})}))},E=c.useMemo(()=>[{accessor:"checkbox",className:_.checkbox,Header:n.jsx(u.CheckboxInput,{inline:!0,label:n.jsx("span",{className:"u-off-screen",children:"Toggle all"}),checked:o.length===s.length&&s.length>0,indeterminate:o.length<s.length&&o.length>0,disabled:s.length===0,onChange:k}),Cell:({row:r})=>C(r.original)?n.jsx(u.Tooltip,{message:n.jsxs("div",{children:[n.jsx("p",{className:"u-no-padding--top",children:"Ubuntu Pro is required"}),n.jsx(A,{to:`${q}instances/${g?`${l}/${g}`:`${l}`}`,state:{tab:"ubuntu-pro"},className:_.tooltipLink,children:"learn more"})]}),children:n.jsx(u.CheckboxInput,{inline:!0,disabled:!0,label:n.jsx("span",{className:"u-off-screen",children:`Toggle ${r.original.name}`}),checked:o.some(({name:b})=>b===r.original.name),onChange:()=>{P(r.original)}})}):n.jsx(u.CheckboxInput,{inline:!0,label:n.jsx("span",{className:"u-off-screen",children:`Toggle ${r.original.name}`}),checked:o.some(({name:b})=>b===r.original.name),onChange:()=>{P(r.original)}})},{accessor:"name",Header:"Name",Cell:({row:r})=>r.original.name==="loading"?n.jsx(f,{}):n.jsx(u.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{U(r.original)},children:r.original.name})},{accessor:"status",Header:"Status",Cell:({row:{original:r}})=>Q(r).label,getCellIcon:({row:{original:r}})=>Q(r).icon},{accessor:"current_version",Header:"Current version"},{accessor:"summary",className:_.details,Header:"Details",Cell:({row:{original:r}})=>r.available_version?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:r.summary}),n.jsx("br",{}),n.jsx("span",{children:`available version: ${r.available_version}`})]}):r.summary},{accessor:"actions",className:_.actions,Header:"Actions",Cell:({row:{original:r}})=>n.jsx(V,{pkg:r})}],[s,o.length]);return n.jsxs(n.Fragment,{children:[!m&&s.some(C)&&n.jsx(M,{onDismiss:()=>x(!0)}),n.jsx(u.ModularTable,{columns:E,data:K,getCellProps:Z,emptyMsg:e})]})},ne="_container_1nwlw_1",se="_noWrap_1nwlw_5",S={container:ne,noWrap:se},ae=c.lazy(()=>I(()=>import("./index-DHwALhPx.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),te=c.lazy(()=>I(()=>import("./index-B-IBcZg_.js"),__vite__mapDeps([29,1,2,4,5,6,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,30,31]))),ce=({selectedPackages:e})=>{const{setSidePanelContent:a}=$(),s=t=>{const h=e.length===1?e[0].name:`${e.length} selected packages`;a(`${p[t].label} ${h}`,n.jsx(c.Suspense,{fallback:n.jsx(f,{}),children:n.jsx(ae,{action:t,packages:e})}))},d={remove:e.length===0||e.every(t=>!t.current_version),hold:e.length===0||e.every(t=>t.status==="held"),unhold:e.length===0||e.every(t=>t.status!=="held"),upgrade:e.length===0||e.every(t=>!t.available_version)},o=()=>{a("Install packages",n.jsx(c.Suspense,{fallback:n.jsx(f,{}),children:n.jsx(te,{})}))};return n.jsxs("div",{className:S.container,children:[n.jsxs(u.Button,{type:"button",onClick:o,hasIcon:!0,className:S.noWrap,children:[n.jsx("i",{className:"p-icon--plus"}),n.jsx("span",{children:"Install"})]}),n.jsx("div",{className:B("p-segmented-control is-small",S.noWrap),children:Object.keys(p).filter(t=>t!=="downgrade").map(t=>t).sort((t,h)=>p[t].order-p[h].order).map(t=>n.jsxs(u.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:d[t],onClick:()=>s(t),children:[n.jsx(u.Icon,{name:p[t].icon}),n.jsx("span",{children:p[t].label})]},t))},"buttons")]})};function de(){const e=F(),a=D(),s=T(),d=(l,g={})=>j({queryKey:["packages",l],queryFn:()=>s.get("packages",{params:l}),...g}),o=({instance_id:l,...g},v={})=>j({queryKey:["packages",{instance_id:l,...g}],queryFn:()=>s.get(`computers/${l}/packages`,{params:g}),...v}),t=y({mutationFn:l=>a.get("UpgradePackages",{params:l}),onSuccess:()=>e.invalidateQueries({queryKey:["packages"]})}),h=y({mutationFn:l=>s.post("/computers/upgrade-packages",l),onSuccess:()=>Promise.all([e.invalidateQueries({queryKey:["packages"]}),e.invalidateQueries({queryKey:["instances"]})])}),i=({instanceId:l,packageName:g},v={})=>j({queryKey:["packageDowngradeVersion",{instanceId:l,packageName:g}],queryFn:()=>s.get(`computers/${l}/packages/installed/${g}/downgrades`),...v}),m=y({mutationFn:({instanceId:l,...g})=>s.post(`computers/${l}/packages/installed`,g),onSuccess:()=>e.invalidateQueries({queryKey:["packages"]})}),x=y({mutationFn:l=>s.post("packages",l),onSuccess:()=>e.invalidateQueries({queryKey:["packages"]})});return{getPackagesQuery:d,getInstancePackagesQuery:o,upgradePackagesQuery:t,getDowngradePackageVersionsQuery:i,downgradePackageVersionQuery:m,packagesActionQuery:x,upgradeInstancesPackagesQuery:h}}function pe(){const e=F(),a=T(),s=(i,m={})=>j({queryKey:["usns",i],queryFn:()=>a.get("usns",{params:i}),...m}),d=({usn:i,...m},x={})=>j({queryKey:["usnPackages",{usn:i,...m}],queryFn:()=>a.get(`usns/${i}`,{params:m}),...x}),o=y({mutationFn:({instanceId:i,...m})=>a.post(`/computers/${i}/usns/upgrade-packages`,m),onSuccess:()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])}),t=y({mutationFn:({instanceId:i,...m})=>a.post(`/computers/${i}/usns/remove-packages`,m),onSuccess:()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])}),h=y({mutationFn:i=>a.post("/computers/usns/upgrade-packages",i),onSuccess:()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])});return{getUsnsQuery:s,getAffectedPackagesQuery:d,upgradeInstanceUsnsQuery:o,removeUsnPackagesQuery:t,upgradeUsnsQuery:h}}export{p as I,ce as P,de as a,ue as b,pe as u};
