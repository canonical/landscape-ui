const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-ytLfiJUR.js","assets/index-oHELamW6.js","assets/index-tBQFzVrl.css","assets/MultiSelectField-Ccwo0J7a.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-CoDSai3y.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/useRoles-D_--rcor.js","assets/PageMain-BdjJHk-q.js","assets/PageMain--v5xNZ5p.css","assets/HeaderWithSearch-BB_CpSjU.js","assets/HeaderWithSearch-C2lwo0VI.css"])))=>i.map(i=>d[i]);
import{f as q,e as H,i as O,g as p,h as L,y as S,z as P,A as N,F as T,M as Q,H as E,r as v,j as e,m,I as j,N as F,af as z,ak as V,l as k,ab as K,aj as Y,c as U,al as W,o as C,E as G,_ as D,v as A,D as B}from"./index-oHELamW6.js";import{P as J,a as X,b as Z}from"./PageMain-BdjJHk-q.js";import{u as $}from"./useRoles-D_--rcor.js";import{M as w}from"./MultiSelectField-Ccwo0J7a.js";import{S as ee}from"./SidePanelFormButtons-CoDSai3y.js";import{H as te}from"./HeaderWithSearch-BB_CpSjU.js";function f(){const t=q(),a=H(),o=O(),d=(i,b={})=>L({queryKey:["administrators"],queryFn:async()=>a.get("GetAdministrators"),...b}),h=p({mutationFn:async i=>a.get("InviteAdministrator",{params:i}),onSuccess:async()=>t.invalidateQueries({queryKey:["invitations"]})}),u=p({mutationFn:async i=>a.get("DisableAdministrator",{params:i}),onSuccess:async()=>t.invalidateQueries({queryKey:["administrators"]})}),g=p({mutationFn:async({id:i,...b})=>o.put(`administrators/${i}`,b),onSuccess:async()=>Promise.all([t.invalidateQueries({queryKey:["administrators"]}),t.invalidateQueries({queryKey:["roles"]})])}),r=(i,b={})=>L({queryKey:["invitations",i],queryFn:async()=>o.get("/invitations",{params:i}),...b}),l=p({mutationFn:async i=>o.delete(`/invitations/${i.id}`),onSuccess:async()=>t.invalidateQueries({queryKey:["invitations"]})}),s=p({mutationFn:async i=>o.post(`/invitations/${i.id}`),onSuccess:async()=>t.invalidateQueries({queryKey:["invitations"]})});return{getAdministratorsQuery:d,inviteAdministratorQuery:h,disableAdministratorQuery:u,editAdministratorQuery:g,getInvitationsQuery:r,revokeInvitationQuery:l,resendInvitationQuery:s}}const se="_footer_nfyyh_1",ne="_multiSelect_nfyyh_7",R={footer:se,multiSelect:ne},ae=({administrator:t,roleOptions:a})=>{const o=S(),{notify:d}=P(),{editAdministratorQuery:h}=f(),{mutateAsync:u}=h,g=async({roles:l})=>{try{await u({id:t.id,roles:l}),d.success({title:"Permission changes have been queued",message:`You changed ${t.name}'s roles`})}catch(s){o(s)}},r=N({initialValues:{roles:[]},validationSchema:T().shape({roles:Q().of(E()).min(1,"At least one role is required")}),onSubmit:g});return v.useEffect(()=>{r.setValues({roles:t.roles})},[t.roles]),e.jsx(m.Form,{onSubmit:r.handleSubmit,noValidate:!0,children:e.jsx(w,{required:!0,variant:"condensed",className:R.multiSelect,items:a,selectedItems:a.filter(({value:l})=>r.values.roles.includes(l)),onItemsUpdate:l=>r.setValues({roles:l.map(({value:s})=>s)}),placeholder:"Select roles",error:r.touched.roles&&typeof r.errors.roles=="string"?r.errors.roles:void 0,dropdownFooter:e.jsxs("div",{className:R.footer,children:[e.jsx(m.Button,{type:"button",dense:!0,small:!0,className:"u-no-margin--bottom",disabled:r.values.roles.length===t.roles.length&&t.roles.every(l=>r.values.roles.includes(l)),onClick:()=>r.setFieldValue("roles",t.roles),children:"Revert"}),e.jsx(m.Button,{type:"submit",dense:!0,small:!0,appearance:"positive",className:"u-no-margin--bottom",disabled:r.values.roles.length===t.roles.length&&t.roles.every(l=>r.values.roles.includes(l)),children:"Save changes"})]})})})},ie=({administrator:t})=>{const[a,o]=v.useState(t);v.useEffect(()=>{o(t)},[t]);const{notify:d}=P(),h=S(),{disableAdministratorQuery:u,editAdministratorQuery:g}=f(),{getRolesQuery:r}=$(),{data:l}=r(),s=(l==null?void 0:l.data.map(({name:c})=>({label:c,value:c})))??[],{mutateAsync:i}=g,{mutateAsync:b,isPending:x}=u,_=async()=>{try{await b({email:a.email})}catch(c){h(c)}},I=async c=>{try{await i({id:t.id,roles:c.roles}),o(y=>({...y,roles:c.roles})),d.success({title:"Permission changes have been queued",message:`You changed ${a.name}'s roles`})}catch(y){h(y)}},n=N({initialValues:{roles:[]},validationSchema:T().shape({roles:Q().of(E()).min(1,"At least one role is required")}),onSubmit:I});return v.useEffect(()=>{n.setValues({roles:a.roles})},[a]),e.jsxs(m.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:[e.jsxs(m.ConfirmationButton,{type:"button",className:"has-icon",confirmationModalProps:{title:"Disable Administrator",children:e.jsx("p",{children:"This will remove the administrator from your Landscape organisation."}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:x,confirmButtonLoading:x,onConfirm:_},children:[e.jsx(m.Icon,{name:m.ICONS.delete,"aria-hidden":"true"}),e.jsx("span",{children:"Remove"})]}),e.jsxs(m.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(m.Col,{size:6,children:e.jsx(j,{label:"Name",value:a.name})}),e.jsx(m.Col,{size:6,children:e.jsx(j,{label:"Email",value:a.email})}),e.jsx(m.Col,{size:12,children:e.jsx(j,{label:"Timezone",value:e.jsx(F,{})})}),e.jsx(m.Col,{size:12,children:e.jsx(j,{label:"Identity URL",value:e.jsx(F,{})})})]}),e.jsx(w,{variant:"condensed",label:"Roles",items:s,selectedItems:s.filter(({value:c})=>n.values.roles.includes(c)),placeholder:"Select roles",onItemsUpdate:c=>n.setFieldValue("roles",c.map(({value:y})=>y)),error:n.touched.roles&&typeof n.errors.roles=="string"?n.errors.roles:void 0}),e.jsx(ee,{submitButtonDisabled:n.isSubmitting||n.values.roles.length===a.roles.length&&n.values.roles.every(c=>a.roles.includes(c)),submitButtonText:"Save changes"})]})},oe=({administrator:t})=>{const a=S(),{disableAdministratorQuery:o}=f(),{value:d,setTrue:h,setFalse:u}=z(),{mutateAsync:g,isPending:r}=o,l=async()=>{try{await g({email:t.email})}catch(s){a(s)}u()};return e.jsxs(e.Fragment,{children:[e.jsx(V,{toggleAriaLabel:`${t.name} administrator actions`,destructiveActions:[{icon:"delete",label:"Remove","aria-label":`Remove "${t.name}" administrator`,onClick:h}]}),d&&e.jsx(m.ConfirmationModal,{close:u,title:`Remove ${t.name}`,confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:r,confirmButtonLoading:r,onConfirm:l,children:e.jsx("p",{children:"This will remove the administrator from your Landscape organisation."})})]})},re="_roles_eken9_1",le="_table_eken9_11",M={roles:re,table:le},ce=({administrators:t,emptyMessage:a,roles:o})=>{const{setSidePanelContent:d}=k(),h=v.useMemo(()=>t,[t]),u=v.useMemo(()=>o.map(({name:s})=>({label:s,value:s})),[o]),g=s=>{d(s.name,e.jsx(ie,{administrator:s}))},r=v.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:s})=>e.jsx(m.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{g(s.original)},children:s.original.name})},{accessor:"email",Header:"Email"},{accessor:"roles",className:M.roles,Header:"Roles",Cell:({row:s})=>e.jsx(ae,{administrator:s.original,roleOptions:u})},{...K,Cell:({row:s})=>e.jsx(oe,{administrator:s.original})}],[h,u]),l=s=>{const i={};return s.column.id==="name"?i.role="rowheader":s.column.id==="email"?i["aria-label"]="Email":s.column.id==="roles"?i["aria-label"]="Roles":s.column.id==="actions"&&(i["aria-label"]="Actions"),i};return e.jsx(m.ModularTable,{columns:r,data:h,getCellProps:l,emptyMsg:a,className:M.table})},de=()=>e.jsxs(e.Fragment,{children:[e.jsx(te,{}),e.jsx(Y,{filtersToDisplay:["search"]})]}),me=({administrators:t})=>{const{search:a,pageSize:o,currentPage:d}=U(),{getRolesQuery:h}=$(),{data:u}=h(),r=(()=>{const s=a.trim().toLowerCase();return s?t.filter(i=>i.email.toLowerCase().includes(s)||i.name.toLowerCase().includes(s)||i.roles.some(b=>b.toLowerCase().includes(s))):t})(),l=r.filter((s,i)=>i>=(d-1)*o&&i<d*o)??[];return e.jsxs(e.Fragment,{children:[e.jsx(de,{}),e.jsx(ce,{administrators:l,emptyMessage:a.trim()?`No administrators found with the search: "${a.trim()}"`:"You have no administrators on your Landscape organisation",roles:(u==null?void 0:u.data)??[]}),l.length>0&&e.jsx(W,{totalItems:r.length,currentItemCount:l.length})]})},ue=v.lazy(()=>D(()=>import("./index-ytLfiJUR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),he=()=>{const{setSidePanelContent:t}=k(),{getAdministratorsQuery:a}=f(),{data:o,isLoading:d}=a(),h=()=>{t("Invite administrator",e.jsx(v.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(ue,{})}))};return e.jsxs(e.Fragment,{children:[d&&e.jsx(C,{}),!d&&(!o||!o.data.length)&&e.jsx(G,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no administrators in your Landscape organization."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[e.jsx(m.Button,{type:"button",appearance:"positive",onClick:h,children:"Invite Administrator"},"invite-administrator")],icon:"user",title:"No administrators found"}),!d&&o&&o.data.length>0&&e.jsx(me,{administrators:o.data})]})},ve=()=>{const t=S(),{notify:a}=P(),{getInvitationsQuery:o,revokeInvitationQuery:d,resendInvitationQuery:h}=f(),{data:u}=o(),g=v.useMemo(()=>(u==null?void 0:u.data.results.sort((n,c)=>A(c.creation_time).diff(A(n.creation_time))))??[],[u]),{mutateAsync:r,isPending:l}=d,{mutateAsync:s,isPending:i}=h,b=async n=>{try{await r({id:n.id}),a.success({message:`${n.name}â€™${n.name.endsWith("s")?"":"s"} invitation has been revoked`,title:"You revoked an administrator invite"})}catch(c){t(c)}},x=async n=>{try{await s({id:n.id}),a.success({message:`${n.name} will receive a new invitation email`,title:"You resent an administrator invite"})}catch(c){t(c)}},_=v.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"email",Header:"Email"},{accessor:"creation_time",Header:"Invited",Cell:({row:n})=>A(n.original.creation_time).format(B)},{accessor:"expiration_time",Header:"Expires",Cell:({row:n})=>A(n.original.creation_time).add(14,"days").format(B)},{accessor:"actions",Cell:({row:n})=>e.jsxs("div",{className:"u-align-text--right",children:[e.jsx(m.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Revoke invitation for ${n.original.name}`,children:e.jsxs("p",{children:["This action will prevent ",n.original.name," from joining your Landscape organisation."]}),confirmButtonLabel:"Revoke invitation",confirmButtonAppearance:"negative",confirmButtonDisabled:l,confirmButtonLoading:l,onConfirm:()=>b(n.original)},children:"Revoke"}),e.jsx(m.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Resend invitation for ${n.original.name}`,children:e.jsxs("p",{children:[n.original.name," will receive a new invitation email."]}),confirmButtonLabel:"Resend invitation",confirmButtonAppearance:"positive",confirmButtonDisabled:i,confirmButtonLoading:i,onConfirm:()=>x(n.original)},children:"Resend"})]})}],[g]),I=n=>{const c={};return n.column.id==="name"?c.role="rowheader":n.column.id==="email"?c["aria-label"]="Email":n.column.id==="creation_time"?c["aria-label"]="Invited":n.column.id==="expiration_time"?c["aria-label"]="Expires":n.column.id==="actions"&&(c["aria-label"]="Actions"),c};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-text--muted p-text--small",children:"Unclaimed invitations expire after 14 days."}),e.jsx(m.ModularTable,{columns:_,data:g,getCellProps:I,emptyMsg:"You have no unclaimed invitations."})]})},ge="_tabPanel_1n8p7_1",be={tabPanel:ge},ye=[{label:"Administrators",id:"tab-link-administrators"},{label:"Invites",id:"tab-link-invites"}],pe=()=>{const[t,a]=v.useState("tab-link-administrators");return e.jsxs(e.Fragment,{children:[e.jsx(m.Tabs,{listClassName:"u-no-margin--bottom",links:ye.map(({label:o,id:d})=>({label:o,id:d,role:"tab",active:d===t,onClick:()=>a(d)}))}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":t,className:be.tabPanel,children:e.jsxs(v.Suspense,{fallback:e.jsx(C,{}),children:[t==="tab-link-administrators"&&e.jsx(he,{}),t==="tab-link-invites"&&e.jsx(ve,{})]})})]})},fe=v.lazy(()=>D(()=>import("./index-ytLfiJUR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),xe=()=>{const{setSidePanelContent:t}=k(),a=()=>{t("Invite administrator",e.jsx(v.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(fe,{})}))};return e.jsxs(J,{children:[e.jsx(X,{title:"Administrators",actions:[e.jsx(m.Button,{type:"button",onClick:a,children:"Invite administrator"},"invite-administrator")]}),e.jsx(Z,{children:e.jsx(pe,{})})]})},Pe=Object.freeze(Object.defineProperty({__proto__:null,default:xe},Symbol.toStringTag,{value:"Module"}));export{Pe as i,f as u};
