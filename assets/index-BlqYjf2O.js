import{r as x,j as t,d as r,z as T,B as w,w as v,C as $,am as b,F as N,m as te,f as ae,bl as se,x as S,V as q,i as D,l as A,a4 as ne,Q as _,aY as oe}from"./index-6fwIJGGG.js";import{A as M}from"./AssociationBlock-Do6aWs8U.js";import{S as O}from"./SidePanelFormButtons-BJEvhYDN.js";import{u as Q}from"./useRoles-_o0cwwF3.js";import{T as re,C as W,a as E,E as z,u as F,V as ie,I as le,b as ce,L as U,c as ue,d as de,P as pe,e as ge,f as he}from"./index-Bvoqkw4_.js";import{g as Et,h as Rt,i as Dt}from"./index-Bvoqkw4_.js";import{F as me}from"./FileInput-C5js-hkc.js";import{u as Pe}from"./useGetInstances-C2hZS7XO.js";import{H as Y}from"./HeaderWithSearch-Bys-4NSP.js";import{S as K}from"./SidePanelTablePagination-DJTq0l6V.js";import{P as Ce}from"./ProfileAssociatedInstancesLink-DcKDGRzV.js";import"./MultiSelectField-BHsPThic.js";import"./useGetTags-CTYDQw2R.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./PageMain-CCmy4N03.js";import"./constants-BePvSiFl.js";import"./constants-TGwvwJxK.js";import"./table-CdFwMAPu.js";const R=({onChange:e,value:a,...s})=>{const[n,o]=x.useState(a);return t.jsx(r.Input,{type:"text",autoComplete:"off",...s,value:n,onChange:i=>{o(i.target.value)},onBlur:()=>e(n)})},be="_action_w93bw_1",xe="_cell_w93bw_7",je="_input_w93bw_18",fe="_inputWrapper_w93bw_26",f={action:be,cell:xe,input:je,inputWrapper:fe},Se=async(e,a,s,n)=>{await e.setFieldValue(`constraints[${a}]${[s]}`,n),await e.setFieldTouched(`constraints[${a}]${[s]}`,!0),["rule","version"].includes(s)&&(n!==""?await e.setFieldValue(`constraints[${a}].notAnyVersion`,!0):e.values.constraints[a][s==="rule"?"version":"rule"]===""&&await e.setFieldValue(`constraints[${a}].notAnyVersion`,!1))},ye=(e,a,s)=>{if(!e.errors.constraints?.[a]||!e.touched.constraints?.[a]?.[s])return;const n=e.errors.constraints[a];return typeof n!="string"?n[s]:void 0},_e=async(e,a)=>{await e.setFieldValue("constraints",e.values.constraints.filter((s,n)=>n!==a)),e.touched.constraints&&(e.touched.constraints.splice(a,1),await e.setTouched({...e.touched,constraints:e.touched.constraints}))},ve=e=>({handleConstraintPropChange:async(a,s,n)=>{await Se(e,a,s,n)},handleConstraintRowDelete:async a=>{await _e(e,a)},getConstraintsErrorByIndex:(a,s)=>ye(e,a,s)}),Ne=({column:e})=>{const a={};return a.className=f.cell,e.id==="package_name"?a.role="rowheader":e.id==="action"?a["aria-label"]="Action":e.id==="constraint"?a["aria-label"]="Constraint":e.id==="version"?a["aria-label"]="Version":e.id==="rule"&&(a["aria-label"]="Rule"),a},Z=({formik:e})=>{x.useEffect(()=>{e.submitCount!==0&&(async()=>await e.setTouched({...e.touched,constraints:new Array(e.values.constraints.length).fill(re)}))()},[e.submitCount]);const a=x.useMemo(()=>e.values.constraints,[e.values.constraints]),{handleConstraintPropChange:s,handleConstraintRowDelete:n,getConstraintsErrorByIndex:o}=ve(e),i=x.useMemo(()=>[{accessor:"constraint",Header:"Constraint",Cell:({row:{index:c}})=>t.jsx(r.Select,{label:"Constraint",labelClassName:"u-off-screen",className:f.input,wrapperClassName:f.inputWrapper,options:W,...e.getFieldProps(`constraints[${c}].constraint`),onChange:u=>s(c,"constraint",u.target.value),error:o(c,"constraint")})},{accessor:"package",Header:"Package",Cell:({row:{index:c}})=>t.jsx(R,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:f.input,wrapperClassName:f.inputWrapper,...e.getFieldProps(`constraints[${c}].package`),onChange:u=>s(c,"package",u),error:o(c,"package")})},{accessor:"rule",Header:"Rule",Cell:({row:{index:c}})=>t.jsx(r.Select,{label:"Rule",labelClassName:"u-off-screen",className:f.input,wrapperClassName:f.inputWrapper,...e.getFieldProps(`constraints[${c}].rule`),options:E,onChange:u=>s(c,"rule",u.target.value),error:o(c,"rule")})},{accessor:"version",Header:"Version",Cell:({row:{index:c}})=>t.jsx(R,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:f.input,wrapperClassName:f.inputWrapper,...e.getFieldProps(`constraints[${c}].version`),onChange:u=>s(c,"version",u),error:o(c,"version")})},{accessor:"action",className:f.action,Cell:({row:c})=>t.jsx(r.Button,{type:"button",hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding","aria-label":"Delete constraint row",onClick:()=>n(c.index),children:t.jsx(r.Icon,{name:r.ICONS.delete,className:"u-no-margin--left u-no-margin--right"})})}],[a,e.errors.constraints,e.touched.constraints]),g=async()=>{if(await e.setFieldValue("constraints",[z,...e.values.constraints]),e.touched.constraints){const c=[];for(let u=e.values.constraints.length;u>0;u--)e.touched.constraints[u-1]&&(c[u]=e.touched.constraints[u-1]);await e.setTouched({constraints:c})}};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"u-align-text--right",children:t.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:g,children:[t.jsx(r.Icon,{name:r.ICONS.plus,className:"u-no-margin--left"}),t.jsx("span",{children:"Add new constraint"})]})}),t.jsx(r.ModularTable,{columns:i,data:a,getCellProps:Ne,emptyMsg:"No constraints added yet.",className:"u-no-margin--bottom"}),e.touched.constraints&&typeof e.errors.constraints=="string"&&t.jsx("div",{className:"is-error",children:t.jsxs("p",{className:"p-form-validation__message u-no-margin--top",children:[t.jsx("strong",{children:"Error: "}),t.jsx("span",{children:e.errors.constraints})]})})]})},Fe=[{label:"Select constraints type",value:""},{label:"From an instance's packages",value:"instance"},{label:"From a CSV file",value:"material"},{label:"Enter manually",value:"manual"}],Ae="_container_vi1gw_1",Te={container:Ae},we=({formik:e})=>{const{instances:a}=Pe(),s=a.map(({id:i,title:g})=>({label:g,value:`${i}`}))??[];s.unshift({label:"Select instance",value:""});const n=async i=>{await e.setFieldValue("csvFile",i[0]);const g=await i[0].text();await e.setFieldValue("material",g)},o=async()=>{await e.setFieldValue("csvFile",null),await e.setFieldValue("material",""),await e.setFieldValue("isCsvFileParsed",!1)};return t.jsxs("div",{className:Te.container,children:[t.jsx(r.Select,{label:"Package constraints",required:!0,options:Fe,...e.getFieldProps("constraintsType"),error:e.touched.constraintsType&&e.errors.constraintsType?e.errors.constraintsType:void 0}),e.values.constraintsType==="instance"&&t.jsx(r.Select,{label:"Instance",required:e.values.constraintsType==="instance",options:s,...e.getFieldProps("source_computer_id"),error:e.touched.source_computer_id&&e.errors.source_computer_id?e.errors.source_computer_id:void 0}),e.values.constraintsType==="material"&&t.jsx(me,{label:"Upload constraints",accept:".csv",...e.getFieldProps("csvFile"),onFileRemove:o,onFileUpload:n,help:'File should be formatted as either a package profile CSV file or the output of running "dpkg --get-selections" on a computer with desired packages installed.',error:e.touched.csvFile&&e.errors.csvFile||e.touched.material&&e.errors.material||void 0}),e.values.constraintsType==="manual"&&t.jsx(Z,{formik:e})]})},At=()=>{const e=T(),{notify:a}=w(),{createPageParamsSetter:s}=v(),{getAccessGroupQuery:n}=Q(),{createPackageProfileQuery:o}=F(),{data:i,isPending:g}=n(),c=i?.data.map(({name:h,title:m})=>({label:m,value:h}))??[],{mutateAsync:u}=o,p=s({sidePath:[],profile:""}),d=$({initialValues:le,onSubmit:async h=>{const m={access_group:h.access_group,description:h.description,title:h.title};h.all_computers?m.all_computers=!0:h.tags.length>0&&(m.tags=h.tags),h.constraintsType==="material"?m.material=h.material:h.constraintsType==="instance"?m.source_computer_id=h.source_computer_id:m.constraints=h.constraints.map(({constraint:l,package:C,rule:k,version:L})=>({constraint:l,package:C,rule:k,version:L}));try{await u(m),p(),a.success({message:`Profile "${h.title}" added successfully`,title:"Profile added"})}catch(l){e(l)}},validationSchema:ie,validateOnMount:!0});return g?t.jsx(b.LoadingState,{}):t.jsxs(t.Fragment,{children:[t.jsx(b.Header,{children:"Add package profile"}),t.jsx(b.Content,{children:t.jsxs(r.Form,{onSubmit:d.handleSubmit,noValidate:!0,children:[t.jsx(r.Input,{type:"text",label:"Title",required:!0,...d.getFieldProps("title"),error:N(d,"title")}),t.jsx(r.Input,{type:"text",label:"Description",required:!0,autoComplete:"off",...d.getFieldProps("description"),error:N(d,"description")}),t.jsx(r.Select,{label:"Access group",...d.getFieldProps("access_group"),options:c,error:N(d,"access_group")}),t.jsx(M,{formik:d}),t.jsx(we,{formik:d}),t.jsx(O,{submitButtonDisabled:!d.isValid,submitButtonLoading:d.isSubmitting,submitButtonText:"Add package profile",onCancel:p})]})})]})},ke=e=>{const a=te(),{data:s,isPending:n,error:o}=ae({queryKey:["packageProfile",e],queryFn:async({signal:g})=>a.get("packageprofiles",{params:{names:[e]},signal:g})}),i=s?.data.result[0];return{packageProfile:i,packageProfileError:s&&!i?new Error("The package profile could not be found."):o,isGettingPackageProfile:n}},I=()=>{const{profile:e}=v(),{packageProfile:a,isGettingPackageProfile:s,packageProfileError:n}=ke(e);if(n)throw n;return s?{packageProfile:void 0,isGettingPackageProfile:!0}:{packageProfile:a,isGettingPackageProfile:!1}},$e=({profile:e})=>{const a=x.useContext(se),s=T(),{notify:n}=w(),{sidePath:o,popSidePath:i}=v(),{addPackageProfileConstraintsQuery:g}=F(),{mutateAsync:c}=g,p=$({initialValues:{constraints:[z]},onSubmit:async({constraints:P})=>{try{await c({name:e.name,constraints:P.map(({constraint:d,package:h,rule:m,version:l})=>({constraint:d,package:h,rule:m,version:l}))}),i(),n.success({message:`${P.length} package profile ${S(P.length,"constraint")}  added successfully`,title:"Package profile constraints added"})}catch(d){s(d)}},validationSchema:ce,validateOnMount:!0});return t.jsxs(r.Form,{onSubmit:p.handleSubmit,noValidate:!0,children:[t.jsx(Z,{formik:p}),t.jsx(O,{submitButtonDisabled:!p.isValid||p.isValidating,submitButtonLoading:p.isSubmitting,submitButtonText:`Add ${S(p.values.constraints.length,"constraint")}`,submitButtonAriaLabel:`Add ${S(p.values.constraints.length,"constraint")} to "${e.title}" profile`,cancelButtonDisabled:p.isSubmitting,hasBackButton:o.length>1,onBackButtonPress:i,onCancel:a})]})},Tt=()=>{const{packageProfile:e,isGettingPackageProfile:a}=I();return a?t.jsx(b.LoadingState,{}):t.jsxs(t.Fragment,{children:[t.jsxs(b.Header,{children:['Add package constraints to "',e.title,'" profile']}),t.jsx(b.Content,{children:t.jsx($e,{profile:e})})]})},Ie=[{label:"All",value:""},{label:"Conflicts",value:"conflicts"},{label:"Depends",value:"depends"}],Be="_container_scrq4_1",Ve={container:Be},Ee=({filter:e,formik:a,onFilterChange:s,profile:n,selectedIds:o,setSelectedIds:i})=>{const g=T(),{notify:c}=w(),{createSidePathPusher:u}=v(),{removePackageProfileConstraintsQuery:p}=F(),{mutateAsync:P,isPending:d}=p,h=async()=>{try{await P({constraint_ids:o,name:n.name}),i([]),c.success({message:`${o.length} "${n.title}" profile's ${S(o.length,"constraint")} removed successfully`,title:`Package profile ${S(o.length,"constraint")} removed`})}catch(l){g(l)}},m=u("add-constraints");return t.jsxs("div",{className:Ve.container,children:[t.jsx(r.Select,{label:"Constraint type",className:"u-no-margin--bottom",labelClassName:"u-no-padding--top",options:Ie,value:e,onChange:l=>{s(l.target.value)}}),t.jsxs(r.ConfirmationButton,{className:"has-icon u-no-margin--right u-no-margin--bottom",type:"button",disabled:o.length===0||a.values.id!==0,"aria-label":`Remove selected ${S(o.length,"constraint")}`,confirmationModalProps:{title:`Remove ${S(o.length,"constraint")}`,children:t.jsxs("p",{children:["This will remove ",o.length," ",S(o.length,"constraint"),"."]}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:h},children:[t.jsx(r.Icon,{name:r.ICONS.delete}),t.jsx("span",{children:"Remove"})]}),t.jsxs(r.Button,{className:"u-no-margin--bottom",type:"button",hasIcon:!0,onClick:m,"aria-label":"Add new constraint",children:[t.jsx(r.Icon,{name:r.ICONS.plus}),t.jsx("span",{children:"Add constraints"})]})]})},Re="_actionButton_15xpu_1",De="_tooltip_15xpu_5",V={actionButton:Re,tooltip:De},Oe=({constraint:e,formik:a})=>a.values.id===e.id?t.jsxs(t.Fragment,{children:[t.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:q("u-no-margin--bottom u-no-padding",V.actionButton),onClick:()=>{a.handleSubmit()},"aria-label":`Save changes to ${e.package} constraint`,children:t.jsx(r.Tooltip,{tooltipClassName:V.tooltip,message:"Save changes",children:t.jsx(r.Icon,{name:"success-grey",className:"u-no-margin--left u-no-margin--right"})})}),t.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>{a.resetForm()},"aria-label":`Cancel editing ${e.package} constraint`,children:t.jsx(r.Tooltip,{tooltipClassName:V.tooltip,message:"Cancel",children:t.jsx(r.Icon,{name:"error-grey",className:"u-no-margin--left u-no-margin--right"})})})]}):t.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>a.setValues(e),disabled:a.values.id!==0,"aria-label":`Edit ${e.package} constraint`,children:t.jsx(r.Tooltip,{tooltipClassName:V.tooltip,message:"Edit constraint",children:t.jsx(r.Icon,{name:"edit",className:"u-no-margin--left u-no-margin--right"})})}),Le="_actionsCell_1kvjf_1",He="_noPadding_1kvjf_7",Ge="_cell_1kvjf_11",Me="_input_1kvjf_23",Qe="_inputWrapper_1kvjf_31",We="_hidden_1kvjf_37",j={actionsCell:Le,noPadding:He,cell:Ge,input:Me,inputWrapper:Qe,hidden:We},qe=async(e,a,s)=>{await e.setFieldValue(`${a}`,s),await e.setFieldTouched(`${a}`,!0),["rule","version"].includes(`${a}`)&&(s!==""?await e.setFieldValue("notAnyVersion",!0):e.values[a==="rule"?"version":"rule"]===""&&await e.setFieldValue("notAnyVersion",!1))},ze=(e,a)=>{if(!(!e.touched[a]||!e.errors[a]))return e.errors[a]},Ue=e=>({handleConstraintPropChange:(a,s)=>qe(e,a,s),getConstraintPropError:a=>ze(e,a)}),Ye=({column:e,row:a},s)=>{const n={};return n.className=q(j.cell,{[j.noPadding]:a.original.id===s}),a.original.package==="loading"?e.id==="package"?n.colSpan=5:(n.className=j.hidden,n["aria-hidden"]=!0):e.id==="package"?n.role="rowheader":e.id==="actions"?n["aria-label"]="Actions":e.id==="constraint"?n["aria-label"]="Constraint":e.id==="version"?n["aria-label"]="Version":e.id==="rule"&&(n["aria-label"]="Rule"),n},Ke=(e,a)=>{let s="No constraints found";return e&&(s+=` with the constraint type: "${e}"`,a&&(s+=" and")),a&&(s+=` with the search: "${a}"`),s},Ze=({filter:e,formik:a,isConstraintsLoading:s,onSelectedIdsChange:n,pageSize:o,profileConstraints:i,search:g,selectedIds:c})=>{const u=x.useMemo(()=>{if(s)return[U];if(!i)return[];const l=i.map(C=>({...C,notAnyVersion:!!C.version}));return a.values.id!==-1?l:[a.values,...l].slice(0,o)},[s,i,a.values,o]),p=()=>{n(c.length?[]:u.map(({id:l})=>l))},P=l=>{c.includes(l)?n(c.filter(C=>C!==l)):n([...c,l])},{handleConstraintPropChange:d,getConstraintPropError:h}=Ue(a),m=x.useMemo(()=>[{accessor:"constraint",Header:()=>t.jsxs(t.Fragment,{children:[t.jsx(r.CheckboxInput,{inline:!0,label:t.jsx("span",{className:"u-off-screen",children:"Toggle all constraints"}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0||u.length===0,checked:u.length>0&&u.length===c.length,indeterminate:c.length>0&&c.length<u.length,onChange:p}),t.jsx("span",{children:"Constraint"})]}),Cell:({row:{original:l}})=>a.values.id===l.id?t.jsx(r.Select,{label:"Constraint",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,options:W,...a.getFieldProps("constraint"),onChange:C=>d("constraint",C.target.value),error:h("constraint")}):t.jsxs("div",{className:j.checkboxContainer,children:[t.jsx(r.CheckboxInput,{inline:!0,label:t.jsx("span",{className:"u-off-screen",children:`Toggle ${l.package} constraint`}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0,checked:c.includes(l.id),onChange:()=>{P(l.id)}}),t.jsx("span",{children:l.constraint})]})},{accessor:"package",Header:"Package",Cell:({row:{original:l}})=>a.values.id===l.id?t.jsx(R,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,...a.getFieldProps("package"),onChange:C=>d("package",C),error:h("package")}):l.package!=="loading"?t.jsx(t.Fragment,{children:l.package}):t.jsx(D,{})},{accessor:"rule",Header:"Rule",Cell:({row:{original:l}})=>a.values.id===l.id?t.jsx(r.Select,{label:"Rule",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,options:E,...a.getFieldProps("rule"),onChange:C=>d("rule",C.target.value),error:h("rule")}):t.jsx(t.Fragment,{children:E.find(({value:C})=>C===l.rule)?.label??l.rule})},{accessor:"version",Header:"Version",Cell:({row:{original:l}})=>a.values.id===l.id?t.jsx(R,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,...a.getFieldProps("version"),onChange:C=>d("version",C),error:h("version")}):t.jsx(t.Fragment,{children:l.version})},{accessor:"actions",className:j.actionsCell,Cell:({row:{original:l}})=>t.jsx(Oe,{constraint:l,formik:a})}],[u,c.length,a.errors,a.touched]);return t.jsx(r.ModularTable,{columns:m,data:u,getCellProps:l=>Ye(l,a.values.id),className:"u-no-margin--bottom",emptyMsg:Ke(e,g)})},Je="_pagination_15tqa_1",Xe={pagination:Je},et=({profile:e})=>{const[a,s]=x.useState([]),[n,o]=x.useState(1),[i,g]=x.useState(A),[c,u]=x.useState(""),[p,P]=x.useState(""),d=y=>{s([]),o(y)},h=y=>{s([]),g(y)},m=T(),{notify:l}=w(),{editPackageProfileConstraintQuery:C,getPackageProfileConstraintsQuery:k}=F(),{mutateAsync:L}=C,H=$({initialValues:de,onSubmit:async(y,{resetForm:X})=>{try{await L({constraint:y.constraint,id:y.id,package:y.package,rule:y.rule,version:y.version,name:e.name}),l.success({message:`"${e.title}" package profile's constraint updated successfully`,title:"Package profile constraint updated"}),X()}catch(ee){m(ee)}},validationSchema:ue}),{data:B,isLoading:G}=k({constraint_type:p||void 0,limit:i,name:e.name,offset:(n-1)*i,search:c});return t.jsxs(t.Fragment,{children:[!c&&!p&&n===1&&i===A&&G&&t.jsx(D,{}),(c||p||n!==1||i!==A||!G&&B&&B.data.results.length>0)&&t.jsxs(t.Fragment,{children:[t.jsx(Y,{actions:t.jsx(Ee,{filter:p,formik:H,onFilterChange:P,profile:e,selectedIds:a,setSelectedIds:s}),onSearch:u,disabled:H.values.id!==0}),t.jsx(Ze,{filter:p,formik:H,isConstraintsLoading:G,onSelectedIdsChange:s,pageSize:i,profileConstraints:B?.data.results,search:c,selectedIds:a}),t.jsx(K,{currentPage:n,pageSize:i,paginate:d,setPageSize:h,totalItems:B?.data.count,className:Xe.pagination})]})]})},wt=()=>{const{packageProfile:e,isGettingPackageProfile:a}=I();return a?t.jsx(b.LoadingState,{}):t.jsxs(t.Fragment,{children:[t.jsxs(b.Header,{children:['Change "',e.title,`" profile's constraints`]}),t.jsx(b.Content,{children:t.jsx(et,{profile:e})})]})},tt="_constraint_1lz67_1",at="_hidden_1lz67_5",J={constraint:tt,hidden:at},st=({row:e,column:a})=>{const s={};return e.original.package==="loading"?a.id==="package"?s.colSpan=3:(s.className=J.hidden,s["aria-hidden"]=!0):a.id==="package"?s.role="rowheader":a.id==="constraint"?s["aria-label"]="Constraint":a.id==="rule"?s["aria-label"]="Rule":a.id==="version"&&(s["aria-label"]="Version"),s},nt=({isConstraintsLoading:e,profileConstraints:a,search:s})=>{const n=x.useMemo(()=>e?[U]:a?a.map(i=>({...i,notAnyVersion:!!i.version})):[],[e,a]),o=x.useMemo(()=>[{accessor:"constraint",className:J.constraint,Header:"Constraint",Cell:({row:{original:i}})=>W.find(({value:g})=>g===i.constraint)?.label??i.constraint},{accessor:"package",Header:"Package",Cell:({row:{original:i}})=>i.package==="loading"?t.jsx(D,{}):i.package},{accessor:"version",Header:"Version",Cell:({row:{original:i}})=>i.version?`${E.find(({value:g})=>g===i.rule)?.label} ${i.version}`:"Any"}],[n]);return t.jsx(r.ModularTable,{columns:o,data:n,getCellProps:st,emptyMsg:`No constraints found with the search: "${s}"`})},ot="_actions_nxngq_1",rt={actions:ot},it=({profile:e})=>{const[a,s]=x.useState(1),[n,o]=x.useState(A),[i,g]=x.useState(""),{createSidePathPusher:c}=v(),{getPackageProfileConstraintsQuery:u}=F(),{data:p,isLoading:P}=u({name:e.name,limit:n,offset:(a-1)*n,search:i}),d=c("edit-constraints");return t.jsxs(t.Fragment,{children:[!i&&a===1&&n===A&&P&&t.jsx(D,{}),(i||a!==1||n!==A||!P&&p&&p.data.results.length>0)&&t.jsxs(t.Fragment,{children:[t.jsx(Y,{className:rt.actions,onSearch:g,actions:t.jsx(r.Button,{className:"u-no-margin--bottom",type:"button",onClick:d,children:"Change package constraints"})}),t.jsx(nt,{isConstraintsLoading:P,profileConstraints:p?.data.results,search:i}),t.jsx(K,{currentPage:a,pageSize:n,paginate:s,setPageSize:o,totalItems:p?.data.count})]})]})},kt=()=>{const{createSidePathPusher:e}=v(),{getAccessGroupQuery:a}=Q(),{data:s,isPending:n}=a(),{packageProfile:o,isGettingPackageProfile:i}=I(),{value:g,setTrue:c,setFalse:u}=ne();if(i||n)return t.jsx(b.LoadingState,{});const p=e("edit"),P=e("duplicate");return t.jsxs(t.Fragment,{children:[t.jsx(b.Header,{children:o.title}),t.jsxs(b.Content,{children:[t.jsxs("div",{className:"p-segmented-control",children:[t.jsxs(r.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button u-no-margin",onClick:P,children:[t.jsx(r.Icon,{name:"canvas"}),t.jsx("span",{children:"Duplicate profile"})]}),t.jsxs(r.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button u-no-margin",onClick:p,children:[t.jsx(r.Icon,{name:"edit"}),t.jsx("span",{children:"Edit"})]}),t.jsxs(r.Button,{className:"p-segmented-control__button u-no-margin",hasIcon:!0,type:"button",onClick:c,"aria-label":`Remove ${o.title} package profile`,children:[t.jsx(r.Icon,{name:r.ICONS.delete}),t.jsx("span",{children:"Remove"})]})]}),t.jsxs(_,{spaced:!0,children:[t.jsx(_.Item,{label:"Title",value:o.title}),t.jsx(_.Item,{label:"Name",value:o.name}),t.jsx(_.Item,{label:"Description",value:o.description}),t.jsx(_.Item,{label:"Access group",value:oe(o.access_group,s)}),t.jsx(_.Item,{label:"Tags",large:!0,value:o.tags.join(", "),type:"truncated"}),t.jsx(_.Item,{label:"Associated to",value:t.jsx(Ce,{profile:o,count:o.computers.constrained.length,query:`package:${o.id}`})}),t.jsx(_.Item,{label:"Pending on",value:`${o.computers.pending?.length??0} ${S(o.computers.pending.length,"instance")}`}),t.jsx(_.Item,{label:"Not compliant on",value:`${o.computers["non-compliant"].length} ${S(o.computers["non-compliant"].length,"instance")}`})]}),t.jsx(it,{profile:o})]}),t.jsx(pe,{close:u,isOpen:g,packageProfile:o})]})},lt=({profile:e})=>{const a=T(),{sidePath:s,popSidePath:n,createPageParamsSetter:o}=v(),{notify:i}=w(),{getAccessGroupQuery:g}=Q(),{copyPackageProfileQuery:c}=F(),{mutateAsync:u}=c,{data:p}=g(),P=p?.data.map(({name:l,title:C})=>({label:C,value:l}))??[],d=o({sidePath:[],profile:""}),h=async l=>{const C={all_computers:l.all_computers,access_group:l.access_group,copy_from:e.name,description:l.description,title:l.title};!l.all_computers&&l.tags.length>0&&(C.tags=l.tags);try{await u(C),d(),i.success({message:`Profile "${e.title}" duplicated successfully`,title:"Profile duplicated"})}catch(k){a(k)}},m=$({initialValues:{access_group:e.access_group,all_computers:e.all_computers,description:e.description,tags:e.tags,title:`${e.title} (copy)`},onSubmit:h,validationSchema:ge});return t.jsxs(r.Form,{onSubmit:m.handleSubmit,noValidate:!0,children:[t.jsx(r.Input,{type:"text",label:"Title",required:!0,...m.getFieldProps("title"),error:N(m,"title")}),t.jsx(r.Input,{type:"text",label:"Description",required:!0,autoComplete:"off",...m.getFieldProps("description"),error:N(m,"description")}),t.jsx(r.Select,{label:"Access group",...m.getFieldProps("access_group"),options:P,error:N(m,"access_group")}),t.jsx(M,{formik:m}),t.jsx(O,{submitButtonLoading:m.isSubmitting,submitButtonText:"Duplicate",hasBackButton:s.length>1,onBackButtonPress:n,onCancel:d})]})},$t=()=>{const{packageProfile:e,isGettingPackageProfile:a}=I();return a?t.jsx(b.LoadingState,{}):t.jsxs(t.Fragment,{children:[t.jsxs(b.Header,{children:["Duplicate ",e.title]}),t.jsx(b.Content,{children:t.jsx(lt,{profile:e})})]})},ct=({profile:e})=>{const a=T(),{sidePath:s,popSidePath:n,createPageParamsSetter:o}=v(),{notify:i}=w(),{editPackageProfileQuery:g}=F(),{mutateAsync:c}=g,u=o({sidePath:[],profile:""}),p=async d=>{try{await c({...d,name:e.name,tags:d.all_computers?[]:d.tags}),u(),i.success({message:`Package profile "${e.title}" updated successfully`,title:"Package profile updated"})}catch(h){a(h)}},P=$({enableReinitialize:!0,initialValues:{all_computers:e.all_computers,description:e.description,tags:e.tags,title:e.title},onSubmit:p,validationSchema:he});return t.jsxs(r.Form,{onSubmit:P.handleSubmit,noValidate:!0,children:[t.jsx(r.Input,{type:"text",label:"Title",...P.getFieldProps("title"),error:N(P,"title")}),t.jsx(r.Input,{type:"text",label:"Description",...P.getFieldProps("description")}),t.jsx(M,{formik:P}),t.jsx(O,{submitButtonLoading:P.isSubmitting,submitButtonText:"Save changes",hasBackButton:s.length>1,onBackButtonPress:n,onCancel:u})]})},It=()=>{const{packageProfile:e,isGettingPackageProfile:a}=I();return a?t.jsx(b.LoadingState,{}):t.jsxs(t.Fragment,{children:[t.jsxs(b.Header,{children:["Edit ",e.title]}),t.jsx(b.Content,{children:t.jsx(ct,{profile:e})})]})};export{At as PackageProfileAddSidePanel,Tt as PackageProfileConstraintsAddSidePanel,wt as PackageProfileConstraintsEditSidePanel,kt as PackageProfileDetailsSidePanel,$t as PackageProfileDuplicateSidePanel,It as PackageProfileEditSidePanel,Et as PackageProfileHeader,Rt as PackageProfileList,Dt as PackageProfilesEmptyState,F as usePackageProfiles};
