import{e as G,j as t,o as H,g as s,B as u}from"./index-DXs1haZl.js";import{h as p}from"./moment-Cl4UOzQZ.js";import{I as a}from"./InfoItem-BQPTGwVs.js";import{u as J,a as j}from"./index-BU3-Vm4G.js";import{u as K}from"./useConfirm-C9Ai5vPv.js";import{u as W}from"./useInstances-B3fQT90b.js";import"./InfoItem.module-BZ3tYMsb.js";import"./moment-BF0UQeMK.js";import"./TablePagination.module-DLVph1Z1.js";import"./TablePagination-DZ07rvb4.js";import"./usePageParams-BJqFm8Ol.js";import"./EmptyState-BYL1pVz2.js";import"./SearchHelpPopup-CCs3NejY.js";import"./useFetchOld-DWTVWZGf.js";import"./useMutation-CoMMCR6r.js";import"./useQuery-DPA9mHwu.js";import"./NoData-BmTO_w1O.js";const X="_statusIcon_1efxa_1",Z="_output_1efxa_5",C={statusIcon:X,output:Z},tt=({activityId:f})=>{var v,A,b,x,h,g,_;const n=G(),{confirmModal:c,closeConfirmModal:l}=K(),{approveActivitiesQuery:I,cancelActivitiesQuery:L,getSingleActivityQuery:D,redoActivitiesQuery:k,undoActivitiesQuery:w}=J(),{getInstancesQuery:B}=W(),{mutateAsync:N,isLoading:R}=I,{mutateAsync:T,isLoading:$}=L,{mutateAsync:z,isLoading:Q}=k,{mutateAsync:S,isLoading:U}=w,{data:r,isLoading:m}=D({activityId:f}),e=r==null?void 0:r.data,{data:d}=B({query:`id:${e==null?void 0:e.computer_id}`,root_only:!1},{enabled:!!(e!=null&&e.computer_id)}),y=d&&d.data.results.length>0?d.data.results[0].title:"",E=async i=>{try{await N({query:`id:${i.id}`})}catch(o){n(o)}finally{l()}},F=i=>{c({title:"Approve activity",body:`Are you sure you want to approve ${i.summary} activity?`,buttons:[t.jsx(s.Button,{appearance:"positive",onClick:()=>E(i),children:"Approve"},"approve")]})},M=async i=>{try{await T({query:`id:${i.id}`})}catch(o){n(o)}finally{l()}},q=i=>{c({title:"Cancel activity",body:`Are you sure you want to cancel ${i.summary} activity?`,buttons:[t.jsx(s.Button,{appearance:"positive",onClick:()=>M(i),children:"Apply"},"cancel")]})},O=async i=>{try{await z({activity_ids:[i.id]})}catch(o){n(o)}finally{l()}},Y=i=>{c({title:"Redo activity",body:`Are you sure you want to redo ${i.summary} activity?`,buttons:[t.jsx(s.Button,{appearance:"positive",onClick:()=>O(i),children:"Redo"},"redo")]})},P=async i=>{try{await S({activity_ids:[i.id]})}catch(o){n(o)}finally{l()}},V=i=>{c({title:"Undo activity",body:`Are you sure you want to undo ${i.summary} activity?`,buttons:[t.jsx(s.Button,{appearance:"positive",onClick:()=>P(i),children:"Undo"},"undo")]})};return t.jsxs(t.Fragment,{children:[m&&t.jsx(H,{}),!m&&e&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[((v=e.actions)==null?void 0:v.approvable)&&t.jsx(s.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>F(e),disabled:R,children:"Approve"}),((A=e.actions)==null?void 0:A.cancelable)&&t.jsx(s.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>q(e),disabled:$,children:!((b=e.actions)!=null&&b.approvable)&&!((x=e.actions)!=null&&x.reappliable)&&!((h=e.actions)!=null&&h.revertable)?"Cancel activity":"Cancel"}),((g=e.actions)==null?void 0:g.revertable)&&t.jsx(s.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>V(e),disabled:U,children:"Undo"}),((_=e.actions)==null?void 0:_.reappliable)&&t.jsx(s.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>Y(e),disabled:Q,children:"Redo"})]})},"buttons"),t.jsxs(s.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(s.Col,{size:12,children:t.jsx(a,{label:"Description",value:e.summary})}),y&&t.jsx(s.Col,{size:12,children:t.jsx(a,{label:"Instance",value:y})}),t.jsx(s.Col,{size:6,children:t.jsx(a,{label:"Status",value:t.jsxs(t.Fragment,{children:[t.jsx(s.Icon,{name:j[e.activity_status].icon,className:C.statusIcon}),t.jsx("span",{children:j[e.activity_status].label})]})})}),t.jsx(s.Col,{size:6,children:t.jsx(a,{label:"Created at",value:p(e.creation_time).format(u)})}),typeof e.delivery_time=="string"&&t.jsx(s.Col,{size:6,children:t.jsx(a,{label:"Delivered at",value:p(e.delivery_time).format(u)})}),e.completion_time&&t.jsx(s.Col,{size:6,children:t.jsx(a,{label:"Completed at",value:p(e.completion_time).format(u)})}),e.result_text&&t.jsx(s.Col,{size:12,children:t.jsx(a,{label:"Output",type:"snippet",value:e.result_text,className:C.output})})]})]})]})},xt=tt;export{xt as default};
