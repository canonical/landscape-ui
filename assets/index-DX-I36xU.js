import{d as b,c as f,e as _,m as x,l as k,j as t,g as c,p as R}from"./index-D_lFwcwK.js";import{E as C}from"./EmptyState-q7D_iuls.js";import{P as F,a as j,b as N}from"./PageMain-D14q--3H.js";import"./InfoItem.module-BZ3tYMsb.js";import{u as S}from"./formik.esm-DoaukP0W.js";import{b as E}from"./SidePanelFormButtons.module-DyBJG5lm.js";import{u as K}from"./useMutation-CWIc5v1t.js";import{u as O}from"./useQuery-BcltX-SR.js";import{c as v,a as d,d as m}from"./index.esm-CU3WlQFm.js";const I="_registrationContainer_8qyhm_1",P={registrationContainer:I};function h(){const s=b(),o=f(),i=_(),l=(u,p={})=>O({queryKey:["preferences"],queryFn:()=>s.get("preferences"),...p}),n=K({mutationKey:["preferences","change"],mutationFn:u=>s.put("preferences",u),onSuccess:()=>{o.invalidateQueries(["preferences"]).catch(i)}});return{getOrganisationPreferences:l,changeOrganisationPreferences:n}}const a={organisationName:{slug:"organisationName",label:"Organisation's name",type:"text"},useRegistrationKey:{slug:"useRegistrationKey",label:"Use registration key",type:"checkbox"},registrationKey:{slug:"registrationKey",label:"Registration key",type:"text"},autoRegisterNewComputers:{slug:"autoRegisterNewComputers",label:"Auto register new computers",type:"checkbox"}},T=/^(?!.*[;#])(?!.*\s$).+$/,q=v().shape({title:d().required("This field is required"),use_registration_key:m(),registration_password:d().when("use_registration_key",{is:!0,then:s=>s.required("This field is required").min(3,"Registration key must be at least 3 characters").matches(T,"The key cannot contain trailing spaces or ; or # symbols")}),auto_register_new_computers:m()}),$=({organisationPreferences:s})=>{const{updateUser:o,user:i}=x(),l=_(),{notify:n}=k(),{changeOrganisationPreferences:u}=h(),{mutateAsync:p}=u,y={title:s.title,use_registration_key:!!s.registration_password,registration_password:s.registration_password||"",auto_register_new_computers:s.auto_register_new_computers},e=S({initialValues:y,validationSchema:q,onSubmit:async r=>{try{await p({title:r.title,registration_password:r.registration_password,auto_register_new_computers:r.auto_register_new_computers}),r.title!==s.title&&o({...i,current_account:r.title,accounts:i.accounts.map(g=>g.title===s.title?{...g,title:r.title}:g)}),e.resetForm({values:{auto_register_new_computers:r.auto_register_new_computers,registration_password:r.registration_password,title:r.title,use_registration_key:r.use_registration_key}}),n.success({title:"Your changes have been saved",message:`Changes made to organisation settings for ${r.title} have been successfully saved.`})}catch(g){l(g)}}}),w=r=>{e.getFieldProps("registration_password").onChange(r),e.setFieldValue("registration_password",""),e.setFieldTouched("registration_password",!1),e.setFieldError("registration_password",void 0),e.setFieldValue("auto_register_new_computers",!1)};return t.jsxs(c.Form,{noValidate:!0,onSubmit:e.handleSubmit,children:[t.jsx(c.Input,{label:a.organisationName.label,type:a.organisationName.type,help:"Visible to others in organisation",error:e.touched.title&&e.errors.title?e.errors.title:void 0,...e.getFieldProps("title")}),t.jsx(c.Input,{label:a.useRegistrationKey.label,type:a.useRegistrationKey.type,checked:e.values.use_registration_key,...e.getFieldProps("use_registration_key"),onChange:w}),e.values.use_registration_key&&t.jsxs("div",{className:P.registrationContainer,children:[t.jsx(c.Input,{"aria-label":a.registrationKey.label,type:a.registrationKey.type,error:e.touched.registration_password&&e.errors.registration_password?e.errors.registration_password:void 0,...e.getFieldProps("registration_password")}),t.jsx(c.Input,{label:a.autoRegisterNewComputers.label,type:a.autoRegisterNewComputers.type,checked:e.values.auto_register_new_computers,help:"This will automatically accept new instances that register to your organisation.",...e.getFieldProps("auto_register_new_computers")})]}),t.jsx("p",{className:"p-form-help-text",children:"When this feature is enabled, new computers must be enrolled using the key that's defined in the field."}),t.jsx("div",{className:E.buttons,children:t.jsx(c.Button,{className:"u-no-margin--bottom",appearance:"positive",type:"submit",disabled:e.isSubmitting||!e.dirty,children:"Save changes"})})]})},A=()=>{const{getOrganisationPreferences:s}=h(),{data:o,isLoading:i,refetch:l}=s(),n=o==null?void 0:o.data,u=()=>{l()};return t.jsxs(F,{children:[t.jsx(j,{title:"General"}),t.jsxs(N,{container:"medium",children:[i&&t.jsx(R,{}),!i&&!n&&t.jsx(C,{title:"Could not load general information",icon:"connected",cta:[t.jsx(c.Button,{appearance:"positive",onClick:u,children:"Try again"},"refetch")]}),n&&!i&&t.jsx($,{organisationPreferences:n})]})]})},Y=A;export{Y as default};
