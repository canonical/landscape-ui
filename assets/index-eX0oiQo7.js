import{i as h,j as s,d as g,B as C,D as I,aw as N,b as P,e as k,f as x,g as F,Q as j,q as Q,p as S,o as H,a0 as E,v as _,h as M,w as T,E as v,aB as A}from"./index-CltrzfEM.js";import{H as D}from"./HeaderWithSearch-dyLsZe2w.js";const q="_nameColumn_pu3a0_1",z={nameColumn:q},K=({processes:t,selectedPids:n,setSelectedPids:o})=>{const r=()=>{o(n.length===0?t.map(({pid:e})=>e):[])},a=h.useMemo(()=>[{accessor:"selected",className:"checkbox-cell",Header:s.jsx(g.CheckboxInput,{inline:!0,label:s.jsx("span",{className:"u-off-screen",children:"Toggle all processes"}),checked:n.length>0&&n.length===t.length,disabled:t.length===0,onChange:r,indeterminate:n.length>0&&n.length<t.length}),Cell:({row:e})=>s.jsx(g.CheckboxInput,{inline:!0,label:s.jsx("span",{className:"u-off-screen",children:`Select process ${e.original.name}`}),checked:n.includes(e.original.pid),onChange:()=>{o(n.includes(e.original.pid)?n.filter(l=>l!==e.original.pid):[...n,e.original.pid])}})},{accessor:"name",Header:"Command",className:z.nameColumn},{accessor:"state",Header:"State"},{accessor:"vm_size",Header:"VM size"},{accessor:"cpu_utilization",Header:"CPU (%)",Cell:({row:e})=>s.jsxs(s.Fragment,{children:[(100*e.original.cpu_utilisation).toFixed(1),"%"]})},{accessor:"pid",Header:"PID"},{accessor:"start_time",Header:"Started at",className:"date-cell",Cell:({row:e})=>s.jsx("span",{className:"font-monospace",children:C(e.original.start_time).format(I)})},{accessor:"gid",Header:"Group"}],[t,n]);return s.jsx(N,{columns:a,data:t,emptyMsg:"No processes found"})};function b(){const t=P(),n=k(),o=(e,l={})=>{if(!e)throw new Error("Missing required parameters");const{computer_id:i,...m}=e;return F({queryKey:["processes",e],queryFn:async()=>t.get(`/computers/${i}/processes`,{params:m}),...l})},r=x({mutationFn:async e=>t.post("processes/terminate",e),onSuccess:async()=>n.invalidateQueries({queryKey:["processes"]})}),a=x({mutationFn:async e=>t.post("processes/kill",e),onSuccess:async()=>n.invalidateQueries({queryKey:["processes"]})});return{getProcessesQuery:o,killProcessQuery:a,terminateProcessQuery:r}}const $="_actions_1l3g0_1",B={actions:$},L=({selectedPids:t,handleClearSelection:n})=>{const{instanceId:o}=j(),{notify:r}=Q(),a=S(),{killProcessQuery:e,terminateProcessQuery:l}=b(),i=Number(o),{mutateAsync:m}=l,{mutateAsync:c}=e,d=async()=>{try{await m({pids:t,computer_id:i}),r.success({message:`${_(t.length,"Process","Processes")} successfully ended.`}),n()}catch(u){a(u)}},p=async()=>{try{await c({pids:t,computer_id:i}),r.success({message:`${_(t.length,"Process","Processes")} successfully killed.`}),n()}catch(u){a(u)}};return s.jsxs(s.Fragment,{children:[s.jsx(D,{actions:s.jsx("div",{className:H("p-segmented-control",B.actions),children:s.jsxs("div",{className:"p-segmented-control__list",children:[s.jsx(g.Button,{type:"button",className:"p-segmented-control__button u-no-margin--bottom",disabled:t.length===0,onClick:d,children:"End process"}),s.jsx(g.Button,{type:"button",className:"p-segmented-control__button u-no-margin--bottom",disabled:t.length===0,onClick:p,children:"Kill process"})]})}),afterSearch:n}),s.jsx(E,{filtersToDisplay:["search"]})]})},G=()=>{const[t,n]=h.useState([]),{instanceId:o,childInstanceId:r}=j(),{search:a,currentPage:e,pageSize:l}=M(),{getProcessesQuery:i}=b(),m=Number(r??o),{data:c,isLoading:d}=i({computer_id:m,limit:l,offset:(e-1)*l,search:a}),p=c?.data.count??0,u=h.useMemo(()=>c?.data.results??[],[c]),y=()=>{n([])};return s.jsxs(s.Fragment,{children:[!a&&d&&s.jsx(T,{}),!d&&!a&&(!c||c.data.results.length===0)&&s.jsx(v,{icon:"connected",title:"No processes running"}),(a||!d&&c&&c.data.results.length>0)&&s.jsxs(s.Fragment,{children:[s.jsx(L,{handleClearSelection:y,selectedPids:t}),s.jsx(K,{processes:u,setSelectedPids:f=>{n(f)},selectedPids:t})]}),s.jsx(A,{handleClearSelection:y,totalItems:p,currentItemCount:u.length})]})};export{G as default};
