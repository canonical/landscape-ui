import{G as U,m as u,V as b,q as S,s as I,j as e,K as L,e as p,J as m,as as P,n as E,D as l,a as _,E as $}from"./index-B2bBvBqG.js";import{u as h}from"./useUsns-CLaql3Hx.js";import{H as v}from"./HeaderWithSearch-Du9X6FnU.js";import{U as k}from"./UsnList-Bi5_GxUS.js";import"./constants-4reRNk2X.js";import"./SelectAllButton--Z_4OjmB.js";import"./ExpandableTableFooter-DFoZhcKc.js";const A="_actions_1l3g0_1",N={actions:A},w=({usns:s})=>{const{instanceId:n,childInstanceId:t}=U(),{setPageParams:a}=u(),i=b(),r=S(),{notify:c}=I(),{upgradeInstanceUsnsQuery:o}=h(),d=Number(n),{mutateAsync:f,isPending:g}=o,y=()=>{i(`/instances/${t?`${d}/${t}`:`${d}`}`),a({tab:"activities"}),c.clear()},x=async()=>{try{await f({instanceId:d,usns:s}),c.success({title:"You queued packages to be upgraded",message:`Affected packages for ${m(s.length,`"${s[0]}" security issue`,`${s.length} selected security issues`)} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:y}]})}catch(j){r(j)}};return e.jsxs(e.Fragment,{children:[e.jsx(v,{actions:e.jsx("div",{className:L("p-segmented-control",N.actions),children:e.jsxs(p.ConfirmationButton,{className:"p-segmented-control__button has-icon u-no-margin--bottom",type:"button",disabled:s.length===0,confirmationModalProps:{title:"Upgrade affected packages",children:e.jsxs("p",{children:["This will upgrade affected packages for"," ",m(s.length,`"${s[0]}" security issue`,`${s.length} selected security issues`),"."]}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:g,confirmButtonDisabled:g,onConfirm:x},children:[e.jsx(p.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]})})}),e.jsx(P,{filtersToDisplay:["search"]})]})},C=({instance:s,isUsnsLoading:n,totalUsnCount:t,usns:a})=>{const[i,r]=E.useState([]),{search:c}=u();return e.jsxs(e.Fragment,{children:[e.jsx(w,{usns:i}),e.jsx(k,{tableType:"paginated",instances:[s],isUsnsLoading:n,onSelectedUsnsChange:o=>{r(o)},search:c,selectedUsns:i,totalUsnCount:t,usns:a})]})},D=({currentPage:s,getUsnsQueryLoading:n,pageSize:t,search:a})=>!a&&s===1&&t===l&&n,B=({search:s,currentPage:n,pageSize:t,getUsnsQueryLoading:a,getUsnsQueryResult:i})=>!s&&n===1&&t===l&&!a&&(!i||i.data.results.length===0),F=({currentPage:s,getUsnsQueryLoading:n,getUsnsQueryResult:t,pageSize:a,search:i})=>i||s>1||a!==l||!n&&t&&t.data.results.length>0,J=({instance:s})=>{const{search:n,currentPage:t,pageSize:a}=u(),{getUsnsQuery:i}=h(),{data:r,isLoading:c}=i({computer_ids:[s.id],limit:a,offset:(t-1)*a,search:n,show_packages:!1});return e.jsxs(e.Fragment,{children:[D({search:n,currentPage:t,pageSize:a,getUsnsQueryLoading:c})&&e.jsx(_,{}),B({search:n,currentPage:t,pageSize:a,getUsnsQueryLoading:c,getUsnsQueryResult:r})&&e.jsx($,{icon:"inspector-debug",title:"No security issues found"}),F({currentPage:t,getUsnsQueryLoading:c,getUsnsQueryResult:r,pageSize:a,search:n})&&e.jsx(C,{instance:s,isUsnsLoading:c,totalUsnCount:r?.data.count??0,usns:r?.data.results??[]})]})};export{J as default};
