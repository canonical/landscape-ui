const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C9tDkr2g.js","assets/index-BMhnQnvO.js","assets/index-BPqj2aAr.css","assets/useConfirm-DBWWlNvT.js","assets/SidePanelTablePagination-BUnludKB.js","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/PageMain-Do4tk6tv.js","assets/PageMain-DyI__TtH.css","assets/useDistributions-O4ngGji2.js","assets/useFetchOld-Cff5y19B.js","assets/useMutation-Diy-BhWO.js","assets/useQuery-Dxk6aJEc.js","assets/InfoItem-B9r-ZevM.js","assets/InfoItem-BbayMzTk.css","assets/moment-C5S46NFB.js","assets/NoData-D_FYardG.js","assets/index-UIx74X9c.js","assets/moment-BcE1DmV8.js","assets/TablePagination-BdWPaBG6.js","assets/usePageParams-C2gko9oh.js","assets/EmptyState-ClMN1u86.js","assets/EmptyState-BNXajmMK.css","assets/SearchHelpPopup-ufAPkkhr.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/index-D7AnmhC7.css","assets/DistributionCard.module-CdGw1YvC.js","assets/DistributionCard-CcioRwqI.css","assets/index-BqjlXzq9.css","assets/EditPocketForm-DxUnYctA.js","assets/formik.esm-CIbWtvkk.js","assets/index.esm-Cg6cKhK8.js","assets/series-Dn2_gQm_.js","assets/series-Doyz0RCU.css","assets/debug-D6cmFZdU.js","assets/debug-B7PvC2lz.css","assets/MultiSelectField-DwiNKGgx.js","assets/MultiSelectField-B2rqRhX9.css","assets/SidePanelFormButtons-Sm5GAIF2.js","assets/SidePanelFormButtons.module-D1MffuBu.js","assets/SidePanelFormButtons-5RbWRdTr.css","assets/useGPGKeys-D4dXzHqz.js","assets/NewPocketForm-D1ogzNGa.js","assets/tests-DFnZqbNV.js","assets/DeriveSeriesForm-BtJ_bV3Q.js","assets/index-BsYpjdlu.js","assets/NewDistributionForm-DBpe3Zkl.js","assets/useRoles-CVnIP7R8.js"])))=>i.map(i=>d[i]);
import{p as N,f as D,r as l,N as Z,j as e,B as J,h as k,g as i,_ as P,k as b,c as q,e as F,D as X,w as ee}from"./index-BMhnQnvO.js";import{P as te,a as se,b as ne}from"./PageMain-Do4tk6tv.js";import{u as V}from"./useDistributions-O4ngGji2.js";import{I as L}from"./InfoItem-B9r-ZevM.js";import{h as H}from"./moment-C5S46NFB.js";import{N as ae}from"./NoData-D_FYardG.js";import{a as U,b as oe}from"./index-UIx74X9c.js";import{u as I}from"./useConfirm-DBWWlNvT.js";import{u as W}from"./useFetchOld-Cff5y19B.js";import{u as y}from"./useMutation-Diy-BhWO.js";import{u as M}from"./useQuery-Dxk6aJEc.js";import{s as w,d as E}from"./DistributionCard.module-CdGw1YvC.js";import{E as re}from"./EmptyState-ClMN1u86.js";const ie=t=>!t||t==="synced"||t==="in progress"?"":U[t==="queued"?"undelivered":t].icon,ce="_progressContainer_qt3iv_1",le="_progress_qt3iv_1",de="_progressBarContainer_qt3iv_11",ue="_progressBar_qt3iv_11",me="_iconContainer_qt3iv_27",A={progressContainer:ce,progress:le,progressBarContainer:de,progressBar:ue,iconContainer:me},K=({pocket:t,syncPocketRefAdd:s,syncPocketRefs:n})=>{const p=N("(min-width: 620px)"),{setSidePanelContent:r}=D();if(l.useEffect(()=>{t.mode!=="mirror"&&t.mode!=="pull"||!t.last_sync_status||t.last_sync_status!=="in progress"||n.find(({distributionName:d})=>d===t.distribution.name)||s({distributionName:t.distribution.name,seriesName:t.series.name,pocketName:t.name})},[t,n]),t.mode==="upload")return Z;if(!t.last_sync_status)return e.jsx(ae,{});if(t.last_sync_status==="synced")return H(t.last_sync_time).format(J);if(t.last_sync_status==="in progress")return e.jsxs("div",{className:A.progressContainer,children:[p&&e.jsx("div",{className:A.progressBarContainer,children:e.jsx("div",{className:A.progressBar,style:{width:`${t.last_sync_activity.progress}%`}})}),e.jsx("span",{className:A.progress,children:`${t.last_sync_activity.progress}%`})]});const g=t.last_sync_status==="queued"?"undelivered":t.last_sync_status,u=()=>{r(t.last_sync_activity.summary,e.jsx(oe,{activityId:t.last_sync_activity.id}))};return e.jsxs("div",{className:k("p-table__cell--icon-placeholder",A.iconContainer),children:[e.jsx(i.Icon,{name:ie(t.last_sync_status)}),e.jsx(i.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:u,children:U[g].label})]})},pe=l.lazy(()=>P(()=>import("./index-C9tDkr2g.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]))),z=({distributionName:t,pocket:s,seriesName:n})=>{const{setSidePanelContent:p}=D(),r=()=>{p(`${n} ${s.name}`,e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(pe,{distributionName:t,pocket:s,seriesName:n})}))};return e.jsxs(e.Fragment,{children:[e.jsx(i.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:r,"aria-label":`List ${s.name} pocket of ${t}/${n}`,children:s.name}),s.mode==="pull"&&e.jsx("p",{className:"p-text--small u-text--muted u-no-margin--bottom",children:`pulling from ${s.pull_pocket}`})]})};function ge(){const t=q(),s=W(),n=F(),p=y({mutationKey:["pockets","create"],mutationFn:o=>s.get("CreatePocket",{params:o}),onSuccess:()=>{t.invalidateQueries(["distributions"]).catch(n)}}),r=y({mutationKey:["pockets","edit"],mutationFn:o=>s.get("EditPocket",{params:o}),onSuccess:()=>{t.invalidateQueries(["distributions"]).catch(n)}}),g=y({mutationKey:["pockets","remove"],mutationFn:o=>s.get("RemovePocket",{params:o}),onSuccess:()=>{t.invalidateQueries(["distributions"]).catch(n)}}),u=y({mutationKey:["pocketPackages","sync"],mutationFn:o=>s.get("SyncMirrorPocket",{params:o}),onSuccess:(o,c)=>Promise.all([t.invalidateQueries(["pocketPackages",{...c}]),t.invalidateQueries(["distributions"])])}),a=y({mutationKey:["pocketPackages","pull"],mutationFn:o=>s.get("PullPackagesToPocket",{params:o}),onSuccess:(o,c)=>Promise.all([t.invalidateQueries(["pocketPackages",{...c}]),t.invalidateQueries(["distributions"])])}),d=y({mutationKey:["pocketPackages","remove"],mutationFn:o=>s.get("RemovePackagesFromPocket",{params:o}),onSuccess:(o,c)=>{t.invalidateQueries(["pocketPackages",{...c},"list"]).catch(n)}}),h=(o,c={})=>M({queryKey:["pocketPackages",{...o},"difference"],queryFn:()=>s.get("DiffPullPocket",{params:o}),...c}),j=(o,c={})=>M({queryKey:["pocketPackages",{...o},"list"],queryFn:()=>s.get("ListPocket",{params:o}),...c}),_=y({mutationKey:["packageFilters","add"],mutationFn:o=>s.get("AddPackageFiltersToPocket",{params:o}),onSuccess:(o,c)=>{t.invalidateQueries(["distributions"]).catch(n),t.invalidateQueries(["pocketPackages",{...c}]).catch(n)}}),x=y({mutationKey:["packageFilters","remove"],mutationFn:o=>s.get("RemovePackageFiltersFromPocket",{params:o}),onSuccess:(o,c)=>{t.invalidateQueries(["distributions"]).catch(n),t.invalidateQueries(["pocketPackages",{...c}]).catch(n)}}),f=y({mutationKey:["uploaderGPGKeys","add"],mutationFn:o=>s.get("AddUploaderGPGKeysToPocket",{params:o}),onSuccess:(o,c)=>{t.invalidateQueries(["distributions"]).catch(n),t.invalidateQueries(["pocketPackages",{...c}]).catch(n)}}),S=y({mutationKey:["uploaderGPGKeys","remove"],mutationFn:o=>s.get("RemoveUploaderGPGKeysFromPocket",{params:o}),onSuccess:(o,c)=>{t.invalidateQueries(["distributions"]).catch(n),t.invalidateQueries(["pocketPackages",{...c}]).catch(n)}});return{createPocketQuery:p,editPocketQuery:r,syncMirrorPocketQuery:u,pullPackagesToPocketQuery:a,diffPullPocketQuery:h,removePocketQuery:g,listPocketQuery:j,removePackagesFromPocketQuery:d,addPackageFiltersToPocketQuery:_,removePackageFiltersFromPocketQuery:x,addUploaderGPGKeysToPocketQuery:f,removeUploaderGPGKeysFromPocketQuery:S}}const he=l.lazy(()=>P(()=>import("./EditPocketForm-DxUnYctA.js"),__vite__mapDeps([29,1,2,30,31,32,33,34,35,36,37,38,39,40,41,10,11,12,7,8,9,13,14,15,16,17,18,19,5,6,20,21,22,23,24,3,25,26,27]))),O=({distributionName:t,pocket:s,seriesName:n,syncPocketRefs:p})=>{const r=N("(min-width: 620px)"),g=F(),{confirmModal:u,closeConfirmModal:a}=I(),{setSidePanelContent:d}=D(),{removePocketQuery:h,syncMirrorPocketQuery:j,pullPackagesToPocketQuery:_}=ge(),{mutateAsync:x,isLoading:f}=h,S=m=>{u({body:`Do you really want to delete ${m.name} pocket from ${n} series of ${t} distribution?`,title:"Deleting pocket",buttons:[e.jsx(i.Button,{appearance:"negative",disabled:f,onClick:async()=>{try{await x({distribution:t,series:n,name:m.name})}catch(R){g(R)}finally{a()}},"aria-label":`Delete ${m.name} pocket of ${t}/${n}`,children:"Delete"},`delete-${m.name}-pocket`)]})},{mutateAsync:o,isLoading:c}=j,{mutateAsync:C,isLoading:B}=_,Q=async()=>{try{await o({name:s.name,series:n,distribution:t})}catch(m){g(m)}finally{a()}},v=async()=>{try{await C({name:s.name,series:n,distribution:t})}catch(m){g(m)}finally{a()}},$=m=>{m.mode==="mirror"?u({title:`Synchronizing ${m.name} pocket`,body:"Do you want to synchronize packages?",buttons:[e.jsx(i.Button,{appearance:"positive",onClick:Q,disabled:c,"aria-label":`Synchronize ${m.name} pocket of ${t}/${n}`,children:"Sync"},m.name)]}):m.mode==="pull"&&u({title:`Pulling packages to ${m.name} pocket`,body:`Do you want to pull packages from ${m.pull_pocket}?`,buttons:[e.jsx(i.Button,{appearance:"positive",onClick:v,disabled:B,"aria-label":`Pull packages to ${m.name} pocket of ${t}/${n}`,children:"Pull"},m.name)]})},Y=(m,R)=>{m.currentTarget.blur(),d(`Edit ${R.name} pocket`,e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(he,{pocket:R,distributionName:t,seriesName:n})}))};return e.jsxs("div",{className:"divided-blocks",children:[(s.mode=="mirror"||s.mode=="pull")&&e.jsx("div",{className:"divided-blocks__item",children:e.jsx(i.Tooltip,{message:s.mode==="mirror"?"Sync":"Pull",position:"btm-center",children:e.jsx(i.Button,{small:r,hasIcon:!0,appearance:r?"base":"",className:k("u-no-margin--bottom",{"u-no-padding--right":r}),"aria-label":s.mode==="mirror"?`Synchronize ${s.name} pocket of ${t}/${n}`:`Pull packages to ${s.name} pocket of ${t}/${n}`,onClick:()=>$(s),disabled:p.some(m=>m.distributionName===t),children:e.jsx("i",{className:k("p-icon--change-version",{"u-no-margin--right":r})})})})}),e.jsx("div",{className:"divided-blocks__item",children:e.jsx(i.Tooltip,{message:"Edit",position:"btm-center",children:e.jsx(i.Button,{small:r,hasIcon:!0,appearance:r?"base":"",className:k("u-no-margin--bottom",{"u-no-padding--right":r}),"aria-label":`Edit ${s.name} pocket of ${t}/${n}`,onClick:m=>Y(m,s),disabled:p.some(m=>m.distributionName===t),children:e.jsx("i",{className:k("p-icon--edit",{"u-no-margin--right":r})})})})}),e.jsx("div",{className:"divided-blocks__item",children:e.jsx(i.Tooltip,{message:"Delete",position:"btm-center",children:e.jsx(i.Button,{small:r,hasIcon:!0,appearance:r?"base":"",className:k("u-no-margin--bottom",{"u-no-padding--right":r}),"aria-label":`Remove ${s.name} pocket of ${t}/${n}`,onClick:()=>S(s),disabled:p.some(m=>m.distributionName===t),children:e.jsx("i",{className:k("p-icon--delete",{"u-no-margin--right":r})})})})})]})},xe=({column:t})=>{const s={};return t.id==="name"?s.role="rowheader":t.id==="mode"?s["aria-label"]="Mode":t.id==="last_sync"?s["aria-label"]="Last synced":t.id==="package_count"?s["aria-label"]="Content":t.id==="actions"&&(s["aria-label"]="Actions"),s},_e="_pocketWrapper_17dw4_1",ye="_ctaRow_17dw4_9",G={pocketWrapper:_e,ctaRow:ye},je=({distributionName:t,series:s,syncPocketRefAdd:n,syncPocketRefs:p})=>{const r=N("(min-width: 620px)"),g=l.useMemo(()=>s.pockets,[s.pockets]),u=l.useMemo(()=>[{accessor:"name",Header:"Pocket",Cell:({row:{original:a}})=>e.jsx(z,{distributionName:t,pocket:a,seriesName:s.name})},{accessor:"mode",Header:"Mode"},{accessor:"last_sync",Header:"Last synced",Cell:({row:{original:a}})=>e.jsx(K,{pocket:a,syncPocketRefAdd:n,syncPocketRefs:p})},{accessor:"package_count",Header:"Content",Cell:({row:{original:a}})=>e.jsx(e.Fragment,{children:`${a.package_count} ${a.package_count===1?"package":"packages"}`})},{accessor:"actions",Cell:({row:{original:a}})=>e.jsx(O,{distributionName:t,pocket:a,seriesName:s.name,syncPocketRefs:p})}],[g,p]);return r?e.jsx(i.ModularTable,{columns:u,data:g,getCellProps:xe,emptyMsg:"No pockets yet"}):s.pockets.map((a,d)=>e.jsxs(i.Row,{className:k("u-no-padding--left u-no-padding--right",G.pocketWrapper),children:[e.jsx(i.Col,{size:2,small:2,children:e.jsx(L,{label:"Pocket",value:e.jsx(z,{distributionName:t,pocket:a,seriesName:s.name})})}),e.jsx(i.Col,{size:2,small:2,children:e.jsx(L,{label:"Last synced",value:e.jsx(K,{pocket:a,syncPocketRefAdd:n,syncPocketRefs:p})})}),e.jsx(i.Col,{size:2,small:2,children:e.jsx(L,{label:"Mode",value:a.mode})}),e.jsx(i.Col,{size:2,small:2,children:e.jsx(L,{label:"Content",value:e.jsx(e.Fragment,{children:`${a.package_count} ${a.package_count===1?"package":"packages"}`})})}),e.jsx("div",{className:G.ctaRow,children:e.jsx(O,{distributionName:t,pocket:a,seriesName:s.name,syncPocketRefs:p})})]},d))};function ke(){const t=q(),s=W(),n=F(),p=y({mutationKey:["series","new"],mutationFn:a=>s.get("CreateSeries",{params:a}),onSuccess:()=>{t.invalidateQueries(["distributions"]).catch(n)}}),r=y({mutationKey:["series","derive"],mutationFn:a=>s.get("DeriveSeries",{params:a}),onSuccess:()=>{t.invalidateQueries(["distributions"]).catch(n)}}),g=y({mutationKey:["series","remove"],mutationFn:a=>s.get("RemoveSeries",{params:a}),onSuccess:()=>{t.invalidateQueries(["distributions"]).catch(n)}});return{createSeriesQuery:p,removeSeriesQuery:g,deriveSeriesQuery:r,getRepoInfo:(a,d={})=>M({queryKey:["repoInfo",{queryParams:a}],queryFn:()=>s.get("GetRepoInfo",{params:a}),...d})}}const ve=l.lazy(()=>P(()=>import("./NewPocketForm-D1ogzNGa.js"),__vite__mapDeps([42,1,2,30,31,32,33,34,35,36,37,38,39,40,41,10,11,12,43,7,8,9,13,14,15,16,17,18,19,5,6,20,21,22,23,24,3,25,26,27]))),be=l.lazy(()=>P(()=>import("./DeriveSeriesForm-BtJ_bV3Q.js"),__vite__mapDeps([44,1,2,30,31,43,38,39,40,7,8,9,10,11,12,13,14,15,16,17,18,19,5,6,20,21,22,23,24,3,25,26,27]))),fe=({distribution:t,series:s,syncPocketRefAdd:n,syncPocketRefs:p})=>{const[r,g]=l.useState(!1),[u,a]=l.useState("");l.useEffect(()=>{!s||!s.pockets.length||s.pockets[0].mode!=="mirror"||!s.pockets[0].mirror_uri.startsWith(X)||a(s.pockets[0].mirror_uri.replace(/^.*\/(\d{8})T\d{6}Z$/,"$1"))},[s]);const d=N("(min-width: 620px)"),{confirmModal:h,closeConfirmModal:j}=I(),{setSidePanelContent:_}=D(),{removeSeriesQuery:x}=ke(),f=F(),{mutateAsync:S,isLoading:o}=x,c=async()=>{h({title:"Remove series",body:"Are you sure? This action cannot be undone.",buttons:[e.jsxs(i.Button,{appearance:"negative",hasIcon:!0,onClick:async()=>{try{await S({name:s.name,distribution:t.name})}catch(v){f(v)}finally{j()}},"aria-label":`Remove ${s.name} from ${t.name}`,children:[o&&e.jsx(i.Spinner,{}),"Remove"]},`delete-${s.name}`)]})},C=({className:v})=>e.jsx(i.Button,{onClick:()=>{_("Derive series",e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(be,{distribution:t,origin:s.name})}))},onMouseDown:$=>{$.preventDefault()},"aria-label":`Derive series ${t.name}/${s.name}`,className:v??"is-small",children:"Derive series"}),B=({className:v})=>e.jsx(i.Button,{onClick:()=>{_(`New pocket for ${s.name}`,e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(ve,{distribution:t,series:s})}))},onMouseDown:$=>{$.preventDefault()},"aria-label":`Add new pocket for ${t.name}/${s.name}`,className:v??"is-small",children:"New pocket"}),Q=({className:v})=>e.jsx(i.Button,{onClick:c,onMouseDown:$=>{$.preventDefault()},disabled:o,"aria-label":`Remove ${t.name}/${s.name}`,className:v??"is-small",children:"Remove"});return e.jsxs("div",{className:w.card,children:[e.jsxs("div",{className:w.header,children:[e.jsx("h3",{className:w.title,children:s.name}),!!u&&e.jsx("span",{className:k("u-text--muted",w.snapshot),children:`Snapshot from ${H(u).format(ee)}`}),d?e.jsxs("div",{className:w.cta,children:[!u&&e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsx(B,{})]}),e.jsx(Q,{})]}):e.jsxs("span",{className:"p-contextual-menu",children:[e.jsx(i.Button,{className:"p-contextual-menu__toggle u-no-margin--bottom","aria-controls":"series-cta","aria-expanded":r,"aria-haspopup":"true",onClick:()=>{g(v=>!v)},onBlur:()=>{g(!1)},children:"Actions"}),e.jsxs("span",{className:"p-contextual-menu__dropdown",id:"series-cta","aria-hidden":!r,children:[!u&&e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"p-contextual-menu__link"}),e.jsx(B,{className:"p-contextual-menu__link"})]}),e.jsx(Q,{className:"p-contextual-menu__link"})]})]})]}),e.jsx("div",{className:w.content,children:e.jsx(je,{distributionName:t.name,series:s,syncPocketRefAdd:n,syncPocketRefs:p})})]})},Pe="_card_3dgbp_1",Se="_header_3dgbp_5",Ce="_title_3dgbp_11",De="_content_3dgbp_20",T={card:Pe,header:Se,title:Ce,content:De},$e=l.lazy(()=>P(()=>import("./index-BsYpjdlu.js"),__vite__mapDeps([45,1,2,30,15,31,32,33,38,39,40,9,10,11,12,41,43,7,8,13,14,16,17,18,19,5,6,20,21,22,23,24,3,25,26,27]))),we=({distribution:t})=>{const{setSidePanelContent:s}=D();return e.jsxs("div",{className:T.card,children:[e.jsx("div",{className:T.header,children:e.jsx("h3",{className:T.title,children:"No series have been added yet"})}),e.jsxs("div",{className:T.content,children:[e.jsx("p",{className:"u-no-margin--bottom",children:"Add a new mirror or series to get started"}),e.jsx("p",{className:"u-no-margin--top",children:e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage repositories in Landscape"})}),e.jsx(i.Button,{appearance:"positive",className:"u-no-margin--bottom",onClick:()=>{s(`Add mirror for ${t.name}`,e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx($e,{distribution:t})}))},"aria-label":`Add mirror for ${t.name}`,children:"Add mirror"})]})]})},Ne=l.lazy(()=>P(()=>import("./index-BsYpjdlu.js"),__vite__mapDeps([45,1,2,30,15,31,32,33,38,39,40,9,10,11,12,41,43,7,8,13,14,16,17,18,19,5,6,20,21,22,23,24,3,25,26,27]))),Ae=({distribution:t,syncPocketRefAdd:s,syncPocketRefs:n})=>{const[p,r]=l.useState(!1),g=N("(min-width: 620px)"),{confirmModal:u,closeConfirmModal:a}=I(),{setSidePanelContent:d}=D(),{removeDistributionQuery:h}=V(),{mutateAsync:j,isLoading:_}=h,x=F(),f=async()=>{u({title:`Removing ${t.name} distribution`,body:"Are you sure? This action cannot be undone.",buttons:[e.jsxs(i.Button,{appearance:"negative",hasIcon:!0,"aria-label":`Remove ${t.name} distribution`,onClick:async()=>{try{await j({name:t.name})}catch(c){x(c)}finally{a()}},children:[_&&e.jsx(i.Spinner,{}),"Remove"]},`delete-${t.name}`)]})},S=({className:c})=>e.jsx(i.Button,{onClick:()=>{d(`Add series to ${t.name}`,e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(Ne,{distribution:t,ctaText:"Add series"})}))},onMouseDown:C=>{C.preventDefault()},"aria-label":`Add series to ${t.name}`,className:c??"is-small",children:"Add series"}),o=({className:c})=>e.jsx(i.Button,{onClick:f,onMouseDown:C=>{C.preventDefault()},"aria-label":`Remove ${t.name} distribution`,disabled:_,className:c??"is-small",children:"Remove distribution"});return e.jsxs("div",{className:E.item,children:[e.jsxs("div",{className:E.titleGroup,children:[e.jsx("h2",{className:k("p-heading--4 u-no-margin--bottom u-no-padding--top",E.title),children:t.name}),g?e.jsxs("div",{children:[e.jsx(S,{}),e.jsx(o,{})]}):e.jsxs("span",{className:"p-contextual-menu--left",children:[e.jsx(i.Button,{className:"p-contextual-menu__toggle","aria-controls":"distribution-cta","aria-expanded":p,"aria-haspopup":"true",onClick:()=>{r(c=>!c)},onBlur:()=>{r(!1)},children:"Actions"}),e.jsxs("span",{className:"p-contextual-menu__dropdown",id:"distribution-cta","aria-hidden":!p,children:[e.jsx(S,{className:"p-contextual-menu__link"}),e.jsx(o,{className:"p-contextual-menu__link"})]})]})]}),t.series.length===0&&e.jsx(we,{distribution:t}),t.series.length>0&&t.series.map(c=>e.jsx(fe,{distribution:t,series:c,syncPocketRefAdd:s,syncPocketRefs:n},c.name))]})},Fe=l.lazy(()=>P(()=>import("./NewDistributionForm-DBpe3Zkl.js"),__vite__mapDeps([46,1,2,30,31,9,10,11,12,47,43,38,39,40]))),Be=()=>{const{setSidePanelContent:t}=D(),s=()=>{t("Add distribution",e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(Fe,{})}))};return e.jsx(re,{title:"No mirrors have been added yet",icon:"containers",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"To add a new mirror you must first add a distribution"}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage repositories in Landscape"})]}),cta:[e.jsx(i.Button,{onClick:s,type:"button",children:"Add distribution"},"add-distribution")]})},Qe=({onDistributionsLengthChange:t})=>{const[s,n]=l.useState([]),{getDistributionsQuery:p}=V(),{data:r,isLoading:g}=p({include_latest_sync:!0},{refetchInterval:s.length?1e3:void 0}),u=(r==null?void 0:r.data)??[];l.useEffect(()=>{t(u.length)},[u.length]),l.useEffect(()=>{var d,h;if(s.length)for(const j of s){const _=(h=(d=u.find(({name:x})=>x===j.distributionName))==null?void 0:d.series.find(({name:x})=>x===j.seriesName))==null?void 0:h.pockets.find(({name:x})=>x===j.pocketName);!_||_.mode!=="mirror"&&_.mode!=="pull"||_.last_sync_status==="in progress"||n(x=>x.filter(({distributionName:f})=>f!==j.distributionName))}},[u]);const a=d=>{n(h=>[...h,d])};return e.jsxs(e.Fragment,{children:[g&&e.jsx(b,{}),!g&&u.length===0&&e.jsx(Be,{}),!g&&u.length>0&&u.map(d=>e.jsx(Ae,{distribution:d,syncPocketRefAdd:a,syncPocketRefs:s},d.name))]})},Re=l.lazy(()=>P(()=>import("./NewDistributionForm-DBpe3Zkl.js"),__vite__mapDeps([46,1,2,30,31,9,10,11,12,47,43,38,39,40]))),Le=l.lazy(()=>P(()=>import("./index-BsYpjdlu.js"),__vite__mapDeps([45,1,2,30,15,31,32,33,38,39,40,9,10,11,12,41,43,7,8,13,14,16,17,18,19,5,6,20,21,22,23,24,3,25,26,27]))),Te=()=>{const[t,s]=l.useState(0),[n,p]=l.useState(!1),r=N("(min-width: 620px)"),{setSidePanelContent:g}=D(),u=({className:d})=>e.jsx(i.Button,{onClick:()=>{g("Add distribution",e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(Re,{})}))},onMouseDown:h=>{h.preventDefault()},type:"button",className:k("u-no-margin--right",d),children:"Add distribution"}),a=({className:d})=>e.jsx(i.Button,{appearance:"positive",onClick:()=>{g("Add new mirror",e.jsx(l.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(Le,{})}))},onMouseDown:h=>{h.preventDefault()},type:"button",className:k("u-no-margin--right",d),disabled:t===0,children:"Add mirror"});return e.jsxs(te,{children:[e.jsx(se,{title:"Repository Mirrors",actions:r?[e.jsx(u,{},"add-distribution-button"),e.jsx(a,{},"add-mirror-button")]:[e.jsxs("span",{className:"p-contextual-menu",children:[e.jsx(i.Button,{className:"p-contextual-menu__toggle u-no-margin--bottom","aria-controls":"menu","aria-expanded":n,"aria-haspopup":"true",onClick:()=>{p(d=>!d)},onBlur:()=>{p(!1)},children:"Actions"}),e.jsxs("span",{className:"p-contextual-menu__dropdown",id:"menu","aria-hidden":!n,children:[e.jsx(u,{className:"p-contextual-menu__link"}),e.jsx(a,{className:"p-contextual-menu__link"})]})]},"menu")]}),e.jsx(ne,{children:e.jsx(Qe,{onDistributionsLengthChange:d=>s(d)})})]})},Ee=Te,Je=Object.freeze(Object.defineProperty({__proto__:null,default:Ee},Symbol.toStringTag,{value:"Module"}));export{ge as a,Je as i,ke as u};
