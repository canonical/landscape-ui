const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CS-vyyFG.js","assets/index-Cl3Ng_mk.js","assets/index-DXB7zdRE.css","assets/AssociationBlock-C1rpvall.js","assets/MultiSelectField-C1seasqq.js","assets/MultiSelectField-CD3NDVCz.css","assets/useGetTags-XRsYKuxy.js","assets/AssociationBlock-vsPH8fvb.css","assets/CodeEditor-7d39xRIu.js","assets/index-n-EzgQ0S.js","assets/CodeEditor-KxSGUzo3.css","assets/FileInput-CR95Z8xH.js","assets/SidePanelFormButtons-DGYG3HWU.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/useGetWslInstanceTypes-BH8icgSw.js","assets/useRoles-CILegiw-.js","assets/constants-CGmSpzVx.js","assets/GroupFilter-sxWkdjiX.js","assets/HeaderWithSearch-CESmZ3W6.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/TruncatedCell-KEreQk4I.js","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-D0hstL1U.js","assets/index-BWE5-HG6.css","assets/index-q-FECIPn.js","assets/useGetInstances-C-V4hpoF.js","assets/useSelection-DSw89Q1n.js","assets/index-GpZHO2-p.css","assets/index-ByFuCkDE.js","assets/index-atR0wLzr.js","assets/index-MmTpaC_e.css","assets/index-BNy5A94z.js"])))=>i.map(i=>d[i]);
import{b as v,e as N,f as L,h as $,g as q,n as x,j as e,E,d as u,i as p,v as _,a3 as y,N as T,a7 as M,B as g,p as C,q as w,ad as I,a5 as k,av as U,aH as H,al as z,aI as G,aw as Q,$ as V}from"./index-Cl3Ng_mk.js";import{G as Y}from"./GroupFilter-sxWkdjiX.js";import{H as K}from"./HeaderWithSearch-CESmZ3W6.js";import{T as R}from"./TruncatedCell-KEreQk4I.js";import{u as Z}from"./useExpandableRow-D0hstL1U.js";import{u as J}from"./useRoles-CILegiw-.js";const X={id:6,title:"Noel's Windows Laptop",comment:"",cloud_init:{},hostname:"noel",is_default_child:null,total_memory:1024,total_swap:1024,reboot_required_flag:!1,update_manager_prompt:"normal",clone_id:null,secrets_name:null,last_exchange_time:null,last_ping_time:"2023-11-29T18:24:25Z",tags:["laptop","windows"],access_group:"server",distribution:"10 / 11",cloud_instance_metadata:{},vm_info:null,container_info:null,ubuntu_pro_info:null,is_wsl_instance:!1,children:[{id:11,title:"Bionic WSL",comment:"",cloud_init:{},hostname:"bionic-wsl",is_default_child:null,total_memory:1024,total_swap:1024,reboot_required_flag:!1,update_manager_prompt:"normal",clone_id:null,secrets_name:null,last_exchange_time:null,last_ping_time:"2023-11-29T18:19:25Z",tags:["bionic","wsl"],access_group:"global",distribution:"18.04",cloud_instance_metadata:{},vm_info:null,container_info:null,ubuntu_pro_info:null,is_wsl_instance:!0,distribution_info:{code_name:"bionic",description:"Ubuntu 18.04 LTS",distributor:"Canonical",release:"18.04"},employee_id:null,archived:!1,registered_at:"2023-11-29T18:29:25Z"}],parent:null,distribution_info:{code_name:"windows",description:"Windows 10 / Windows 11",distributor:"Microsoft",release:"10 / 11"},employee_id:null,archived:!1,registered_at:"2023-11-29T18:29:25Z"},ee=()=>{const n=v(),t=N(),{isPending:a,mutateAsync:s}=L({mutationFn:async({parent_id:i,...l})=>n.post(`computers/${i}/delete-children`,{params:l}),onSuccess:async()=>Promise.all([t.invalidateQueries({queryKey:["wsl-hosts"]}),t.invalidateQueries({queryKey:["instances"]})])});return{isUninstallingWslInstances:a,uninstallWslInstances:s}},ne=()=>{const n=v(),t=N(),{isPending:a,mutateAsync:s}=L({mutationFn:async({name:i})=>n.delete(`child-instance-profiles/${i}`),onSuccess:async()=>t.invalidateQueries({queryKey:["wslProfiles"]})});return{deleteWslProfile:s,isDeletingWslProfile:a}},te=(n,t)=>{const a=v(),{currentPage:s,pageSize:i}=$();n=t?.listenToUrlParams??!0?{limit:i,offset:(s-1)*i,...n}:n;const{data:l,isPending:c}=q({queryKey:["wslProfiles",n],queryFn:async()=>a.get("child-instance-profiles",{params:n})});return{wslProfiles:l?.data.results??[],wslProfilesCount:l?.data.count??0,isGettingWslProfiles:c}},se=()=>{const n=v(),{isPending:t,mutateAsync:a}=L({mutationFn:async s=>n.post("child-instance-profiles/make-hosts-compliant",s)});return{isMakingWindowsInstancesCompliant:t,makeWindowsInstancesCompliant:a}},F=()=>{const n=v(),{isPending:t,mutateAsync:a}=L({mutationFn:async({name:s})=>n.post(`child-instance-profiles/${s}:reapply`)});return{reapplyWslProfile:a,isReapplyingWslProfile:t}},ae=p.lazy(()=>y(()=>import("./index-CS-vyyFG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]))),Se=()=>{const{setSidePanelContent:n}=x(),t=()=>{n("Add WSL profile",e.jsx(p.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(ae,{})}))};return e.jsx(E,{title:"No WSL profiles found",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You haven’t added any WSL profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/manage-wsl-instances-in-landscape",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage WSL profiles in Landscape"})]}),cta:[e.jsx(u.Button,{type:"button",appearance:"positive",onClick:t,children:"Add WSL profile"},"add")]})},oe=({wslProfile:n})=>!n.tags.length&&!n.all_computers?e.jsx(T,{}):n.computers.constrained.length?e.jsxs(M,{to:{pathname:"/instances",search:`query=${encodeURIComponent(`profile:wsl:${n.id}`)}`},children:[n.computers.constrained.length," ",g(n.computers.constrained.length,"instance")]}):"0 instances",ie=({wslProfile:n})=>{if(!n.tags.length&&!n.all_computers)return e.jsx(T,{});const t=n.computers.constrained.length-n.computers["non-compliant"].length;return t?e.jsxs(M,{to:{pathname:"/instances",search:`query=${encodeURIComponent(`profile:wsl:${n.id}:compliant`)}`},children:[t," ",g(t,"instance")]}):"0 instances"},le=p.lazy(()=>y(()=>import("./index-q-FECIPn.js"),__vite__mapDeps([25,1,2,21,22,26,27,23,18,19,20,16,28]))),ce=({wslProfile:n})=>{const{setSidePanelContent:t}=x();if(!n.tags.length&&!n.all_computers)return e.jsx(T,{});if(!n.computers["non-compliant"].length)return"0 instances";const a=()=>{t(`Instances not compliant with ${n.title}`,e.jsx(p.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(le,{wslProfile:n})}),"large")};return e.jsxs(u.Button,{className:"u-no-padding--top u-no-margin--bottom",type:"button",appearance:"link",onClick:a,children:[n.computers["non-compliant"].length," ",g(n.computers["non-compliant"].length,"instance")]})},re=({wslProfile:n,...t})=>{const a=C(),{notify:s}=w(),{closeSidePanel:i}=x(),{deleteWslProfile:l,isDeletingWslProfile:c}=ne(),r=async()=>{try{await l({name:n.name}),s.success({message:"Instances created by this profile won't be affected.",title:`You have successfully removed ${n.title}.`})}catch(f){a(f)}finally{t.close(),i()}};return e.jsx(e.Fragment,{children:e.jsx(I,{title:`Remove ${n.title}`,confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:c,confirmButtonLoading:c,onConfirm:r,confirmationText:`remove ${n.title}`,...t,children:e.jsxs("p",{children:["Removing this profile will not remove the WSL child instances associated with it. ",e.jsx("strong",{children:"This action is irreversible."})]})})})},ue=p.lazy(async()=>y(()=>import("./index-ByFuCkDE.js"),__vite__mapDeps([29,1,2,3,4,5,6,7,12,13,14,15,16,17,18,19,20,21,22,23,24]))),de=({profile:n})=>{const{setSidePanelContent:t}=x(),{value:a,setTrue:s,setFalse:i}=k(),l=()=>{t(`Edit "${n.title}" profile`,e.jsx(p.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(ue,{profile:n})}))},c=[{icon:"edit",label:"Edit","aria-label":`Edit ${n.title} profile`,onClick:l}],r=[{icon:"delete",label:"Remove","aria-label":`Remove ${n.title} profile`,onClick:s}];return e.jsxs(e.Fragment,{children:[e.jsx(U,{toggleAriaLabel:`${n.title} profile actions`,actions:c,destructiveActions:r}),e.jsx(re,{isOpen:a,close:i,wslProfile:n})]})},me=n=>({column:t,row:{index:a}})=>{const s={};switch(t.id){case"title":s.role="rowheader";break;case"access_group":s["aria-label"]="Access group";break;case"tags":s["aria-label"]="Tags",n===a&&(s.className="expandedCell");break;case"description":s["aria-label"]="Description";break;case"computers['non-compliant']":s["aria-label"]="Not compliant instances";break;case"computers['pending']":s["aria-label"]="Pending instances";break;case"computers['constrained']":s["aria-label"]="Associated instances";break;case"actions":s["aria-label"]="Actions";break}return s},pe=n=>({index:t,original:a})=>{const s={};return n===t&&(s.className="expandedRow"),s["aria-label"]=`${a.title} wsl profile row`,s},he="_description_3we9f_1",ge="_header_3we9f_12",S={description:he,header:ge},fe=p.lazy(async()=>y(()=>import("./index-atR0wLzr.js"),__vite__mapDeps([30,1,2,18,19,20,21,22,23,16,31]))),Re=()=>{const{expandedRowIndex:n,getTableRowsRef:t,handleExpand:a}=Z(),{search:s}=$(),{setSidePanelContent:i}=x(),{getAccessGroupQuery:l}=J(),{isGettingWslProfiles:c,wslProfiles:r}=te({search:s}),{data:f}=l(),m=f?.data.map(({name:o,title:d})=>({label:d,value:o}))??[],b=p.useMemo(()=>[{...H,Cell:({row:{original:o}})=>{const d=()=>{i(o.title,e.jsx(p.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(fe,{profile:o,accessGroupOptions:m})}))};return e.jsxs(G,{children:[e.jsx(u.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align--left",onClick:d,children:o.title}),e.jsx("span",{className:"u-text--muted",children:o.name})]})}},{accessor:"description",className:S.description,Header:"Description",Cell:({row:{original:o,index:d}})=>{const j=()=>{a(d)};return e.jsx(R,{content:o.description,isExpanded:d===n,onExpand:j})}},{accessor:"access_group",Header:"Access group",Cell:({row:{original:{access_group:o}}})=>m.find(({value:d})=>d===o)?.label??o},{accessor:"tags",Header:"Tags",Cell:({row:{original:o,index:d}})=>{if(o.all_computers)return"All instances";if(!o.tags.length)return e.jsx(T,{});const j=()=>{a(d)};return e.jsx(R,{content:o.tags.map(W=>e.jsx("span",{className:"truncatedItem",children:W},W)),isExpanded:d===n,onExpand:j,showCount:!0})}},{accessor:"computers['constrained']",Header:"Associated parents",Cell:({row:{original:o}})=>e.jsx(oe,{wslProfile:o})},{accessor:"computers['non-compliant']",Header:e.jsxs("div",{className:S.header,children:["Not compliant",e.jsx(u.Tooltip,{position:"btm-left",message:"These instances are not compliant with the profile. They do not have a pending activity to become compliant.",children:e.jsx(u.Icon,{name:"help"})})]}),Cell:({row:{original:o}})=>e.jsx(ce,{wslProfile:o})},{accessor:"computers['compliant']",Header:e.jsxs("div",{className:S.header,children:["Compliant",e.jsx(u.Tooltip,{position:"btm-left",message:"These instances are compliant with the profile.",children:e.jsx(u.Icon,{name:"help"})})]}),Cell:({row:{original:o}})=>e.jsx(ie,{wslProfile:o})},{...z,Cell:({row:{original:o}})=>e.jsx(de,{profile:o})}],[m.length,n]);return c?e.jsx(_,{}):e.jsx("div",{ref:t,children:e.jsx(Q,{columns:b,data:r,emptyMsg:"No WSL profiles found according to your search parameters.",getCellProps:me(n),getRowProps:pe(n),minWidth:1200})})},_e=p.lazy(()=>y(()=>import("./index-CS-vyyFG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]))),Ae=n=>e.jsx(p.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(_e,{...n})}),be=({close:n,instances:t,isOpen:a})=>{const s=C(),{notify:i}=w(),{makeWindowsInstancesCompliant:l}=se(),[c]=t;if(!c)return;const r=g(t.length,c.title,`${t.length} instances`),f=async()=>{try{await l({host_computer_ids:t.map(({id:m})=>m)}),i.success({title:`You have successfully marked ${r} to be compliant.`,message:g(t.length,"An activity has been queued to uninstall, install or reinstall all non-compliant child instances.","Activities have been queued to uninstall, install or reinstall all non-compliant child instances.")})}catch(m){s(m)}finally{n()}};return e.jsxs(I,{isOpen:a,close:n,title:`Make ${r} compliant`,confirmButtonLabel:"Make compliant",confirmButtonAppearance:"negative",confirmButtonDisabled:!1,confirmButtonLoading:!1,confirmationText:`make ${r} compliant`,onConfirm:f,children:[e.jsx("p",{children:"This will:"}),e.jsxs("ol",{children:[e.jsx("li",{children:"Remove all child instances that haven’t been created by Landscape"}),e.jsx("li",{children:"Install the instances according to the profiles the parent is associated with"}),e.jsx("li",{children:"Reinstall instances that already exist but aren’t compliant"})]})]})},xe=({close:n,instances:t,isOpen:a})=>{const s=C(),{notify:i}=w(),{reapplyWslProfile:l}=F(),[c]=t;if(!c)return;const r=g(t.length,c.name,`${t.length} instances`),f=async()=>{try{await Promise.all(t.map(m=>l({name:m.name,computer_ids:[X.id]}))),i.success({title:`You have successfully marked ${r} to be reinstalled.`,message:g(t.length,"An activity has been queued to reinstall it.","Activities have been queued to reinstall them.")})}catch(m){s(m)}finally{n()}};return e.jsx(I,{isOpen:a,close:n,title:`Reinstall ${r}`,confirmButtonLabel:"Reinstall",confirmButtonAppearance:"negative",confirmButtonDisabled:!1,confirmButtonLoading:!1,confirmationText:`reinstall ${r}`,onConfirm:f,children:e.jsx("p",{children:g(t.length,"This will uninstall this instance and create a new one with the same name that is compliant with its profiles.","This will uninstall the selected instances and create new ones with the same names that are compliant with their profiles.")})})},ye=({close:n,instances:t,isOpen:a,onSuccess:s,parentId:i})=>{const l=C(),{notify:c}=w(),{isUninstallingWslInstances:r,uninstallWslInstances:f}=ee(),[m]=t;if(!m)return;const b=g(t.length,m.name,`${t.length} instances`),o=async()=>{try{await f({parent_id:i,child_names:t.map(({name:d})=>d)}),c.success({title:`You have successfully marked ${b} to be uninstalled.`,message:g(t.length,"An activity has been queued to uninstall it.","Activities have been queued to uninstall them.")}),s?.()}catch(d){l(d)}finally{n()}};return e.jsx(I,{isOpen:a,close:n,title:`Uninstall ${b}`,confirmButtonLabel:"Uninstall",confirmButtonAppearance:"negative",confirmButtonDisabled:r,confirmButtonLoading:r,confirmationText:`uninstall ${b}`,onConfirm:o,children:e.jsx("p",{children:g(t.length,"This will permanently uninstall this instance from the Windows host machine and remove it from Landscape.","This will permanently uninstall the selected instances from the Windows host machine and remove them from Landscape.")})})},je="_cta_1o9o6_1",ve="_buttons_1o9o6_7",A={cta:je,buttons:ve},Ce=p.lazy(async()=>y(()=>import("./index-BNy5A94z.js"),__vite__mapDeps([32,1,2,11,12,13,14,15]))),Ne=({selectedWslInstances:n,windowsInstance:t,wslInstances:a})=>{const s=C(),{notify:i}=w(),{setSidePanelContent:l}=x(),{reapplyWslProfile:c}=F(),{value:r,setTrue:f,setFalse:m}=k(),{value:b,setTrue:o,setFalse:d}=k(),{value:j,setTrue:W,setFalse:B}=k(),D=async()=>{try{await Promise.all(n.map(h=>c({name:h.name,computer_ids:[t.id]}))),i.success({title:`You have successfully queued ${g(n.length,`${n[0].name}`,`${n.length} instances`)} to be installed.`,message:"An activity has been queued to install it."})}catch(h){s(h)}},O=()=>{l("Create new WSL instance",e.jsx(p.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(Ce,{})}))},P=a.some(h=>h.profile);return e.jsxs(e.Fragment,{children:[e.jsx(K,{actions:e.jsxs("div",{className:A.cta,children:[P&&e.jsx(Y,{label:"Group by",options:[{label:"None",value:""},{label:"Compliance",value:"compliance"}]}),e.jsxs("div",{className:A.buttons,children:[e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[P&&e.jsxs(u.Button,{type:"button",onClick:D,className:"p-segmented-control__button u-no-margin--bottom",hasIcon:!0,disabled:!n.length||n.some(h=>h.compliance!=="uninstalled"),children:[e.jsx(u.Icon,{name:"begin-downloading"}),e.jsx("span",{children:"Install"})]}),P&&e.jsxs(u.Button,{type:"button",onClick:f,className:"p-segmented-control__button u-no-margin--bottom",hasIcon:!0,disabled:!n.length||n.some(h=>h.compliance!=="noncompliant"),children:[e.jsx(u.Icon,{name:"restart"}),e.jsx("span",{children:"Reinstall"})]}),e.jsxs(u.Button,{type:"button",onClick:o,className:"p-segmented-control__button u-no-margin--bottom",hasIcon:!0,disabled:!n.length||n.some(h=>!h.installed),children:[e.jsx(u.Icon,{name:"close"}),e.jsx("span",{children:"Uninstall"})]})]})}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(u.Button,{type:"button",onClick:O,className:"p-segmented-control__button u-no-margin--bottom",hasIcon:!0,children:[e.jsx(u.Icon,{name:"plus"}),e.jsx("span",{children:"Create new instance"})]}),P&&e.jsxs(u.Button,{type:"button",className:"p-segmented-control__button u-no-margin--bottom",hasIcon:!0,onClick:W,disabled:a.every(h=>h.compliance==="compliant"||h.compliance==="pending"),children:[e.jsx(u.Icon,{name:"security-tick"}),e.jsx("span",{children:"Make compliant"})]})]})})]})]})}),e.jsx(V,{filtersToDisplay:["search"]}),e.jsx(xe,{close:m,instances:n,isOpen:r,windowsInstance:t}),e.jsx(ye,{close:d,instances:n,isOpen:b,parentId:t.id}),e.jsx(be,{close:B,instances:[t],isOpen:j})]})},we=p.lazy(()=>y(()=>import("./index-BNy5A94z.js"),__vite__mapDeps([32,1,2,11,12,13,14,15]))),$e=()=>{const{setSidePanelContent:n}=x(),t=()=>{n("Create new WSL instance",e.jsx(p.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(we,{})}))};return e.jsx(E,{title:"No WSL instances found",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This computer does not have any WSL instances installed. You can install a new instance by clicking the button below."}),e.jsx("a",{href:"https://ubuntu.com/desktop/wsl",target:"_blank",rel:"nofollow noopener noreferrer",children:"Learn more about Ubuntu WSL"})]}),cta:[e.jsx(u.Button,{appearance:"positive",type:"button",onClick:t,children:"Create new WSL instance"},"install-new-instance-button")]})};export{Se as W,Re as a,Ae as b,oe as c,ce as d,ie as e,re as f,be as g,xe as h,ye as i,F as j,Ne as k,$e as l,te as u};
