const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DfTVB_Pt.js","assets/index-TxmzAx1n.js","assets/index-BRwMPVz9.css","assets/useInstances-lQt7962R.js","assets/SidePanelFormButtons--PKHcmBD.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/useRoles-4zz9Rnmf.js","assets/index-A8Gq5wRV.js","assets/ScriptsTabs-CGTccLkO.js","assets/TruncatedCell-DeREExeb.js","assets/TruncatedCell-CoXbu3VM.css","assets/HeaderWithSearch-BkONncYq.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-DZbXZtRh.js","assets/ScriptsTabs-CNG6qEx6.css","assets/DeliveryBlock-DtWc2OSb.js","assets/DeliveryBlock-VExRkUer.css","assets/formikErrors-Bw8iTXYS.js","assets/index-VcH5_59i.js","assets/CodeEditor-DZEJ6VJH.js","assets/CodeEditor-CwlLRp3p.css","assets/ScriptFormAttachments-C2xOLA3m.js","assets/index-Ba_mm9Hr.js","assets/EmployeeGroupIdentityIssuerList-ZavwMWho.js","assets/EmployeeGroupIdentityIssuerList-DJkUyphv.css","assets/EmployeeList-DBfaSHRk.js","assets/EmployeeList-BthGffhq.css","assets/downshift.esm-BBEGCoy_.js","assets/index-CbvjFctk.css"])))=>i.map(i=>d[i]);
import{j as e,n as I,aD as be,r as i,m as n,F as ue,aE as _e,ao as je,o as q,B as ye,a8 as ve,C as Ie,v as ie,a7 as re,N as v,D as Ce,a as Se,y as we,V as Ne,z as Ae,l as Te,b as ke,J as G,I as Be,_ as ee}from"./index-TxmzAx1n.js";import{u as X}from"./useInstances-lQt7962R.js";import{b as Ee}from"./helpers-DBR6uSgW.js";import{u as Re}from"./useRoles-4zz9Rnmf.js";import"./InstancesPageActions-CxuB12ie.js";import{u as De,T as Pe}from"./useTaggedSecurityProfiles-CSggHtP-.js";import{u as Le}from"./WslInstancesHeader-Dhvge4-G.js";import{g as le}from"./formikErrors-Bw8iTXYS.js";import"./HeaderWithSearch-BkONncYq.js";const ze="_infoContainer_1ca11_1",Fe="_amount_1ca11_9",ce={infoContainer:ze,amount:Fe},$e=({isExpanded:t,overflowingChipsAmount:s})=>s>0&&!t&&e.jsx("div",{className:ce.infoContainer,children:e.jsx("span",{className:I("u-text--muted",ce.amount),children:`+${s}`})}),Ve=({containerRef:t,onDismiss:s,onOverflowingItemsAmountChange:l,tagData:d})=>{const h=()=>{if(!t.current)return;const r=t.current.querySelectorAll("span.p-chip");l(Array.from(r).filter(({offsetHeight:x,offsetTop:m})=>m>x).length)};return be("resize",h),i.useEffect(()=>{h()},[d.length]),d.map(r=>e.jsx(n.Chip,{value:r,onDismiss:()=>s(r)},r))},qe="_container_1f6mu_1",Oe="_list_1f6mu_6",Me="_listItem_1f6mu_11",Qe="_search_1f6mu_17",$={container:qe,list:Oe,listItem:Me,search:Qe},He=({onTagClick:t,tags:s})=>s.length?e.jsxs("div",{className:$.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Tags"}),e.jsx("ul",{className:I("p-list--divided u-no-margin--bottom",$.list),children:s.map(l=>e.jsx("li",{children:e.jsx("div",{className:$.listItem,children:e.jsx(n.Button,{type:"button",appearance:"base",className:$.search,onClick:()=>t(l),children:l})})},l))})]}):null,Ue="_container_fqj7b_1",We="_prompt_fqj7b_10",Ze="_saveButton_fqj7b_17",J={container:Ue,prompt:We,saveButton:Ze},Ye=({onTagAdd:t,search:s})=>e.jsx(e.Fragment,{children:s&&e.jsxs("div",{className:J.container,children:[e.jsxs("span",{className:J.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:s}),e.jsx("span",{children:"..."})]}),e.jsx(n.Button,{type:"button",appearance:"link",onClick:t,className:J.saveButton,children:"Add tag"})]})}),de=ue().matches(/^[a-zA-Z]/,{message:"Tag must starts with a letter",excludeEmptyString:!0}).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,{message:"Tag can only contain letters, numbers, hyphens, and underscores",excludeEmptyString:!0}),Ke="_searchContainer_qgkjy_1",Ge="_box_qgkjy_8",Je="_inputContainer_qgkjy_13",Xe="_inputError_qgkjy_18",V={searchContainer:Ke,box:Ge,inputContainer:Je,inputError:Xe},et=({onTagsChange:t,tags:s,label:l,labelClassName:d,required:h})=>{var L;const[r,x]=i.useState(""),[m,b]=i.useState(""),[j,w]=i.useState(!1),[y,N]=i.useState(""),[_,C]=i.useState(!1),[O,M]=i.useState(0),{height:T}=_e(),[Q,k]=i.useState({top:"100%",bottom:"auto"}),{getAllInstanceTagsQuery:H}=X(),S=i.useRef(null),u=i.useRef(null);i.useEffect(()=>{if(!u.current)return;const a=u.current.querySelector("input");a&&N(a.id)},[u.current]),i.useEffect(()=>{!_||!u.current||U()},[T,_,u.current,(L=u.current)==null?void 0:L.clientHeight]);const U=()=>{if(!u.current)return;const{top:a,height:p}=u.current.getBoundingClientRect();a+p+379<T?k({top:"100%",bottom:"auto"}):k({top:"auto",bottom:"100%"})},B=()=>{C(!1)};je(S,B);const W=a=>{t(s.filter(p=>p!==a))},{data:f,isLoading:E}=H(),R=i.useMemo(()=>f?!r&&!s.length?f.data.results:f.data.results.filter(a=>!s.includes(a)).filter(a=>a.toLowerCase().includes(r.trim().toLowerCase())):[],[f,r,s]),D=a=>{t([...s,a])},A=()=>{if(r.trim())try{const a=de.validateSync(r.trim())??"";D(a),x(""),b(""),w(!1)}catch(a){a instanceof Error&&(b(a.message),w(!0))}},Z=a=>{if(x(a.target.value),j)try{de.validateSync(a.target.value),b("")}catch(p){p instanceof Error&&b(p.message)}},P=a=>{const{key:p}=a;_?(p==="Escape"&&B(),p==="Enter"&&A()):p==="Enter"&&C(!0)};return e.jsxs("div",{children:[e.jsx("label",{className:I("p-form__label",{"is-required":h},d),htmlFor:y,children:l||"Tags"}),e.jsxs("div",{className:"p-search-and-filter",ref:S,children:[e.jsxs("div",{className:I("p-search-and-filter__search-container",V.searchContainer),"aria-expanded":_,ref:u,onClick:()=>C(!0),children:[e.jsx(Ve,{containerRef:u,onDismiss:W,onOverflowingItemsAmountChange:a=>M(a),tagData:s}),e.jsx("div",{className:I("p-search-and-filter__box",V.box),children:e.jsx("div",{className:V.inputContainer,children:e.jsx(n.Input,{type:"text",autoComplete:"off",value:r,onChange:Z,placeholder:"Add tags",className:"u-no-margin--bottom",onClick:()=>C(!0),onKeyUp:P,wrapperClassName:m?"is-error":"","aria-errormessage":m?`${y}-error`:void 0,"aria-invalid":!!m})})}),m&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:I("p-form-validation__message",V.inputError),id:`${y}-error`,children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:m})]})}),e.jsx($e,{isExpanded:_,overflowingChipsAmount:O})]}),_&&E&&e.jsx(q,{}),_&&!E&&e.jsxs("div",{className:"p-search-and-filter__panel",style:Q,children:[e.jsx(Ye,{onTagAdd:A,search:r}),e.jsx(He,{onTagClick:D,tags:R})]})]})]})},tt={deliver_after:"",deliverImmediately:!0,action:null},nt=ye().shape({deliver_after:ue().when("deliverImmediately",{is:!1,then:t=>t.required("This field is required").test({message:"Invalid date",test:s=>ie(s).isValid()}).test({message:"Date must be in the future",test:s=>ie(s).isAfter()})}),deliverImmediately:Ie(),action:ve().oneOf(["shutdown","reboot"]).required()}),st=t=>{var l;const s=(l=t.grouped_hardware)==null?void 0:l.network;return!Array.isArray(s)||s.length===0?e.jsx(v,{}):s.filter(({ip:d})=>d!=="Not available").map(({ip:d})=>d).join(", ")||e.jsx(v,{})},at=(t,s)=>{var l,d,h;return[{label:"instance ID",value:t.id},{label:"Hostname",value:t.hostname},{label:"IP Address",value:st(t)},{label:"Serial number",value:((l=t.grouped_hardware)==null?void 0:l.system.serial)??e.jsx(v,{})},{label:"Product identifier",value:((d=t.grouped_hardware)==null?void 0:d.system.model)??e.jsx(v,{})},{label:"Distribution",value:t.distribution??"Unknown"},{label:"Access group",value:((h=s.find(({value:r})=>r===t.access_group))==null?void 0:h.label)||t.access_group},{label:"Last ping time",value:t.last_ping_time&&re(t.last_ping_time).isValid()?re(t.last_ping_time).format(Ce):e.jsx(v,{})},{label:"Annotations",value:t.annotations?Object.entries(t.annotations).map(([r,x],m,b)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:`${r}: ${x}`}),m<b.length-1&&e.jsx("br",{})]})):e.jsx(v,{})},{label:"Comment",value:t.comment||e.jsx(v,{})}]},ot="_titleRow_lxk0r_1",it="_flexContainer_lxk0r_6",rt="_italic_lxk0r_11",lt="_infoRow_lxk0r_15",ct="_tagSection_lxk0r_20",dt="_tagsRow_lxk0r_25",ut="_tagsButton_lxk0r_33",g={titleRow:ot,flexContainer:it,italic:rt,infoRow:lt,tagSection:ct,tagsRow:dt,tagsButton:ut},mt=i.lazy(async()=>ee(()=>import("./index-DfTVB_Pt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),pt=i.lazy(async()=>ee(()=>import("./index-A8Gq5wRV.js"),__vite__mapDeps([8,9,1,2,10,11,12,13,14,15,16,17,4,5,6,18,19,7,20,21,22,23,24])).then(t=>({default:t.RunInstanceScriptForm}))),ht=i.lazy(async()=>ee(()=>import("./index-Ba_mm9Hr.js"),__vite__mapDeps([25,1,2,4,5,6,16,26,12,13,10,11,27,28,29,30,31]))),Ct=({instance:t})=>{const[s,l]=i.useState([...t.tags]),[d,h]=i.useState(!1),r=s.filter(o=>!t.tags.includes(o)),{securityProfiles:x,isSecurityProfilesLoading:m}=De(r,[t]),b=Se(),j=we(),{openActivityDetails:w}=Ne(),{notify:y}=Ae(),{setSidePanelContent:N}=Te(),{getAccessGroupQuery:_}=Re(),{removeInstancesQuery:C,rebootInstancesQuery:O,sanitizeInstanceQuery:M,shutdownInstancesQuery:T}=X(),{deleteChildInstancesQuery:Q}=Le(),{editInstanceQuery:k}=X(),{isFeatureEnabled:H}=ke();i.useEffect(()=>{l([...t.tags])},[t.tags]);const{data:S}=_(),u=(S==null?void 0:S.data.map(({name:o,title:F})=>({label:F,value:o})))??[],{mutateAsync:U,isPending:B}=k,{mutateAsync:W,isPending:f}=C,{mutateAsync:E,isPending:R}=O,{mutateAsync:D,isPending:A}=T,{mutateAsync:Z,isPending:P}=Q,{mutateAsync:L,isPending:a}=M,c=G({initialValues:tt,validationSchema:nt,onSubmit:async o=>{if(!o.action)return;const F={computer_ids:[t.id],deliver_after:o.deliverImmediately?void 0:`${o.deliver_after}:00Z`};try{const{data:K}=o.action==="reboot"?await E(F):await D(F),oe=o.action==="reboot"?"restarted":"shut down";y.success({title:`You queued "${t.title}" to be ${oe}`,message:`Instance "${t.title}" will be ${oe} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{w(K)}}]})}catch(K){j(K)}}}),te=async()=>{try{await W({computer_ids:[t.id]}),b("/instances",{replace:!0})}catch(o){j(o)}},ne=async()=>{try{const{data:o}=await L({computer_id:t.id,computer_title:t.title});y.success({title:`You have successfully initiated Sanitization for ${t.title}`,message:`Sanitizing for ${t.title} has been queued in Activities. The data will be permanently irrecoverable once complete.`,actions:[{label:"View details",onClick:()=>{w(o)}}]})}catch(o){j(o)}},me=G({initialValues:{confirmationText:""},onSubmit:async()=>te()}),Y=G({initialValues:{confirmationText:""},onSubmit:async()=>ne()}),se=()=>{h(!1)},ae=async()=>{try{await U({instanceId:t.id,tags:s}),se(),y.success({title:"Tags updated",message:`"${t.title}" instance tags have been updated successfully`})}catch(o){j(o)}},pe=async()=>{x.length?h(!0):ae()},he=()=>{N("Edit Instance",e.jsx(i.Suspense,{fallback:e.jsx(q,{}),children:e.jsx(mt,{instance:t})}))},fe=()=>{N("Run script",e.jsx(i.Suspense,{fallback:e.jsx(q,{}),children:e.jsx(pt,{query:`id:${t.id}`})}))},ge=()=>{N(`Associate Employee with ${t.title}`,e.jsx(i.Suspense,{fallback:e.jsx(q,{}),children:e.jsx(ht,{instanceTitle:t.title,employeeId:t.employee_id})}))},xe=async()=>{try{await Z({computer_ids:[t.id]}),b("/instances",{replace:!0})}catch(o){j(o)}},z=async o=>{await c.setFieldValue("action",o),c.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:g.titleRow,children:[e.jsxs("div",{className:g.flexContainer,children:[e.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:t.title}),t.is_wsl_instance&&e.jsx("p",{className:I("u-text--muted u-no-margin--bottom",g.italic),children:"WSL Instance"})]}),e.jsxs("div",{className:g.flexContainer,children:[t.is_wsl_instance&&e.jsx(n.ConfirmationButton,{className:"u-no-margin--bottom u-no-margin--right",type:"button",confirmationModalProps:{title:"Delete instance",children:e.jsxs("p",{children:["This will permanently delete the instance"," ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:P,confirmButtonLoading:P,onConfirm:xe},children:"Delete instance"}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:he,children:[e.jsx(n.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),Ee("runScripts",t)&&e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:fe,children:[e.jsx(n.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:f,confirmationModalProps:{title:"Remove instance from Landscape",children:e.jsxs(n.Form,{onSubmit:c.handleSubmit,noValidate:!0,children:[e.jsxs("p",{children:["Removing this ",t.title," will delete all associated data and free up one license slot for another computer to be registered."]}),e.jsxs("p",{children:["Type ",e.jsxs("b",{children:["remove ",t.title]})," to confirm."]}),e.jsx(n.Input,{type:"text",...me.getFieldProps("confirmationText")})]}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:f,confirmButtonLoading:f,onConfirm:te},children:[e.jsx(n.Icon,{name:n.ICONS.delete}),e.jsx("span",{children:"Remove from Landscape"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:a,confirmationModalProps:{title:"Sanitize instance",children:e.jsxs(n.Form,{onSubmit:Y.handleSubmit,noValidate:!0,children:[e.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for ",t.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]}),e.jsxs("p",{children:["Type ",e.jsxs("b",{children:["sanitize ",t.title]})," to confirm."]}),e.jsx(n.Input,{type:"text",...Y.getFieldProps("confirmationText")})]}),confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:a||Y.values.confirmationText!==`sanitize ${t.title}`,confirmButtonLoading:a,onConfirm:ne},children:[e.jsx(n.Icon,{name:"tidy"}),e.jsx("span",{children:"Sanitize"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:f,confirmationModalProps:{title:"Restart instance",children:e.jsxs(n.Form,{onSubmit:async()=>z("reboot"),noValidate:!0,children:[e.jsx(n.CheckboxInput,{label:"Deliver as soon as possible",...c.getFieldProps("deliverImmediately"),checked:c.values.deliverImmediately}),e.jsx(n.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:g.input,placeholder:"Scheduled time",...c.getFieldProps("deliver_after"),disabled:c.values.deliverImmediately,error:le(c,"deliver_after")}),e.jsxs("p",{children:['This will restart "',t.title,'" instance.']})]}),confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonDisabled:R,confirmButtonLoading:R,onConfirm:async()=>z("reboot")},children:[e.jsx(n.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]}),H("employee-management")&&e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:ge,children:[e.jsx(n.Icon,{name:n.ICONS.user}),e.jsx("span",{children:"Associate employee"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:f,confirmationModalProps:{title:"Shut down instance",children:e.jsxs(n.Form,{onSubmit:async()=>z("shutdown"),noValidate:!0,children:[e.jsx(n.CheckboxInput,{label:"Deliver as soon as possible",...c.getFieldProps("deliverImmediately"),checked:c.values.deliverImmediately}),e.jsx(n.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:g.input,placeholder:"Scheduled time",...c.getFieldProps("deliver_after"),disabled:c.values.deliverImmediately,error:le(c,"deliver_after")}),e.jsxs("p",{children:['This will shut down "',t.title,'" instance.']})]}),confirmButtonLabel:"Shutdown",confirmButtonAppearance:"negative",confirmButtonDisabled:A,confirmButtonLoading:A,onConfirm:async()=>z("shutdown")},children:[e.jsx(n.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]})]})},"buttons")]})]}),e.jsx("div",{className:g.infoRow,children:e.jsx(n.Row,{className:"u-no-padding--left u-no-padding--right u-no-max-width",children:at(t,u).map(o=>e.jsx(n.Col,{size:4,children:e.jsx(Be,{...o})},o.label))})}),e.jsx("div",{className:g.tagSection,children:e.jsxs(n.Row,{className:g.tagsRow,children:[e.jsx(n.Col,{size:4,children:e.jsx(et,{labelClassName:"p-text--small p-text--small-caps u-text--muted",onTagsChange:o=>{l(o)},tags:s})}),e.jsx(n.Col,{size:2,className:g.tagsButton,children:e.jsx(n.Button,{type:"button",className:"u-no-margin--bottom",onClick:pe,disabled:m,children:"Update"})})]})}),d&&e.jsx(Pe,{instances:[t],securityProfiles:x,tags:r,onConfirm:ae,confirmButtonDisabled:B,close:se})]})};export{Ct as default};
