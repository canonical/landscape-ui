import{j as e,r as f,P as E,Q as v,ao as P,m as n,X as j,y as S,b as A,a as I,A as U,C as N,R as T,G as w,o as O,U as L}from"./index-2fzpjuii.js";import{u as R,A as B}from"./AuthTemplate-rreWzhwi.js";const k=({methods:s})=>{if(!s)return null;const a=!!(s.standalone_oidc.available&&s.standalone_oidc.enabled),l=!!(s.ubuntu_one.available&&s.ubuntu_one.enabled),i=!!(s.password.available&&s.password.enabled),c=!!(s.pam.available&&s.pam.enabled),m=s.oidc.available?s.oidc.configurations.filter(({enabled:d})=>d):[],o=i||c,b=l||a||s.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[o&&e.jsx(M,{isIdentityAvailable:c}),b&&e.jsx(C,{isStandaloneOidcEnabled:a,isUbuntuOneEnabled:l,oidcProviders:m}),!o&&!b&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},F="_list_9u1s7_1",Q="_button_9u1s7_20",q="_icon_9u1s7_28",u={list:F,button:Q,icon:q},C=({isStandaloneOidcEnabled:s,isUbuntuOneEnabled:a,oidcProviders:l})=>{const[i,c]=f.useState(0),[m]=E(),{invitationId:o}=R(),{getOidcUrlQuery:b,getUbuntuOneUrlQuery:d}=v(),p=m.get("redirect-to"),x=m.has("external"),t={};i>0&&(t.id=i),p&&(t.return_to=p),o&&(t.invitation_id=o),x&&(t.external=!0);const{data:g}=b(t,{enabled:i!==0});f.useEffect(()=>{g&&P(g.data.location)},[g]);const r={};p&&(r.return_to=`${window.origin}${p}`),o&&(r.invitation_id=o),x&&(r.external=!0);const{data:_,refetch:y}=d(r,{enabled:!1});return f.useEffect(()=>{_&&P(_.data.location)},[_]),e.jsxs("ul",{className:u.list,children:[a&&e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:y,className:u.button,children:[e.jsx(n.Icon,{name:j("ubuntu-one"),className:u.icon}),e.jsx("span",{children:"Sign in with Ubuntu One"})]})}),s&&e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:()=>c(-1),className:u.button,children:[e.jsx(n.Icon,{name:j("standalone"),className:u.icon}),e.jsx("span",{children:"Sign in with Enterprise Login"})]})}),l.map(h=>e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:()=>c(h.id),className:u.button,children:[e.jsx(n.Icon,{name:j(h.provider),className:u.icon}),e.jsx("span",{children:`Sign in with ${h.name}`})]})},h.id))]})},$="_buttonRow_f3s21_1",G={buttonRow:$},M=({isIdentityAvailable:s})=>{const[a]=E(),l=S(),{signInWithEmailAndPasswordQuery:i}=v(),{redirectToExternalUrl:c,setAuthLoading:m,setUser:o}=A(),b=I(),d=a.get("redirect-to"),p=a.has("external"),{mutateAsync:x}=i,t=U({initialValues:{email:"",password:""},validationSchema:N().shape({email:s?w().required("This field is required"):w().required("This field is required").email("Please provide a valid email address"),password:w().required("This field is required")}),onSubmit:async g=>{try{const{data:r}=await x({email:g.email,password:g.password});p&&d?c(d,{replace:!0}):("current_account"in r&&(m(!0),o(r)),b(d??T,{replace:!0}))}catch(r){l(r)}}});return e.jsxs(n.Form,{onSubmit:t.handleSubmit,children:[e.jsx(n.Input,{type:"text",label:s?"Identity":"Email",error:t.touched.email&&t.errors.email?t.errors.email:void 0,...t.getFieldProps("email"),"data-testid":"email"}),e.jsx(n.PasswordToggle,{id:"password",label:"Password",error:t.touched.password&&t.errors.password?t.errors.password:void 0,...t.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:G.buttonRow,children:e.jsx(n.Button,{type:"submit",appearance:"positive",disabled:t.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},D=()=>{const{getLoginMethodsQuery:s}=v(),{data:a,isLoading:l,isError:i}=s();return e.jsx(B,{title:"Sign in to Landscape",children:l?e.jsx(O,{}):i?e.jsx("p",{className:"u-no-margin--bottom",children:L}):e.jsx(k,{methods:(a==null?void 0:a.data)??null})})};export{D as default};
