import{j as e,g as d,f as S,h as w}from"./index-aXCRV7My.js";import{u as F}from"./useFetchOld-Dx05gkab.js";import{u as C}from"./useQuery-BbzlNKqA.js";import{u as B}from"./formik.esm-Bnzr9ZOe.js";import{c as k,f as U,d as V}from"./index.esm-eR-gPxEp.js";import{S as _}from"./SidePanelFormButtons-BktUqi6c.js";import"./SidePanelFormButtons.module-DyBJG5lm.js";function f(){const t=F();return{getCsvComplianceData:(n={},s={})=>C({queryKey:["csvComplianceData",n],queryFn:()=>t.get("GetCSVComplianceData",{params:n}),...s}),getInstancesNotUpgraded:(n={},s={})=>C({queryKey:["instancesNotUpgraded",n],queryFn:()=>t.get("GetComputersNotUpgraded",{params:n}),...s}),getNotPingingInstances:(n,s={})=>C({queryKey:["notPingingInstances",n],queryFn:()=>t.get("GetNotPingingComputers",{params:n}),...s}),getUsnTimeToFix:(n={},s={})=>C({queryKey:["usnTimeToFix",n],queryFn:()=>t.get("GetUSNTimeToFix",{params:n}),...s}),getUpgradedInstancesByFrequency:(n={},s={})=>C({queryKey:["upgradedInstancesByFrequency",n],queryFn:()=>t.get("GetUpgradedComputersByFrequency",{params:n}),...s})}}const L="_header_1kqll_1",O="_lineContainer_1kqll_8",G="_line_1kqll_8",$={header:L,lineContainer:O,line:G},y=({currentCount:t,negativeDescription:l,positiveDescription:i,title:a,totalCount:c})=>{const r=(100*t/c).toFixed();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:$.header,children:[e.jsx("span",{children:a}),e.jsx("span",{children:`${r}%`})]}),e.jsx("div",{className:$.lineContainer,children:e.jsx("div",{className:$.line,style:{width:`${r}%`}})}),e.jsx("p",{className:"u-text--muted p-text--small",children:i}),e.jsx("p",{className:"u-text--muted p-text--small u-no-margin--bottom",children:l})]})},K="_tabCta_q14my_1",z="_rowContainer_q14my_7",E="_row_q14my_7",x={tabCta:K,rowContainer:z,row:E},W="_rangeContainer_1qio8_1",P={rangeContainer:W},Q=(t,l)=>{const i=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(i),c=document.createElement("a");c.href=a,c.download=l,document.body.appendChild(c),c.click(),document.body.removeChild(c)},R=({instanceIds:t})=>{const{getCsvComplianceData:l}=f(),{data:i}=l({query:`id:${t.join(" OR id:")}`}),a=B({initialValues:{range:0,reportByCve:!0},validationSchema:k({range:U().required("This field is required"),reportByCve:V()}),onSubmit:()=>Q((i==null?void 0:i.data)||"","report.csv")});return e.jsxs(d.Form,{onSubmit:a.handleSubmit,noValidate:!0,children:[e.jsx(d.CheckboxInput,{label:"Report by CVE",inline:!0,...a.getFieldProps("reportByCve"),checked:a.values.reportByCve}),e.jsxs("div",{className:P.rangeContainer,children:[e.jsx(d.Input,{type:"number",label:"Range",className:"u-no-margin--bottom",style:{maxWidth:"min-content"},...a.getFieldProps("range"),error:a.touched.range&&a.errors.range?a.errors.range:void 0}),e.jsx("span",{children:"Days"})]}),e.jsx(_,{submitButtonDisabled:!1,submitButtonText:"Download"})]})},A=({instanceIds:t})=>{const{setSidePanelContent:l}=S(),{getNotPingingInstances:i,getInstancesNotUpgraded:a,getUsnTimeToFix:c}=f(),{data:r,isLoading:n}=i({since_minutes:5,query:`id:${t.join(" OR id:")}`}),s=r?t.length-r.data.length:0,{data:p,isLoading:q}=a({query:`id:${t.join(" OR id:")}`}),v=p?t.length-p.data.length:0,{data:o,isLoading:b}=c({query:`id:${t.join(" OR id:")}`,fixed_in_days:[2,14,30,60]}),g={month:(o==null?void 0:o.data[30].length)||0,old:(o==null?void 0:o.data[60].length)||0,pending:(o==null?void 0:o.data.pending.length)||0,recent:(o==null?void 0:o.data[2].length)||0,twoWeeks:(o==null?void 0:o.data[14].length)||0},j={recent:2,twoWeeks:14,month:30,old:60},N=(h,m)=>{const u=m==="positive"?g[h]:t.length-g[h];return u!==1?`${u||"No"} instances have${m==="negative"?" not":""} applied USNs in ${j[h]} days or less.`:`1 instance has${m==="negative"?" not":""} applied USNs in ${j[h]} days or less.`},D=()=>{l("Download report as CSV",e.jsx(R,{instanceIds:t}))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:x.rowContainer,children:e.jsxs(d.Row,{className:w("u-no-padding--left u-no-padding--right",x.row),children:[e.jsx(d.Col,{size:6,children:!b&&e.jsx(y,{currentCount:t.length-g.pending,negativeDescription:`${g.pending||"No"} instance${g.pending!==1?"s are":" is"} not yet patched.`,positiveDescription:`${t.length-g.pending||"No"} instance${t.length-g.pending!==1?"s are":" is"} securely patched.`,title:"Securely patched",totalCount:t.length})}),e.jsx(d.Col,{size:6,children:!q&&e.jsx(y,{currentCount:v,negativeDescription:`${(p==null?void 0:p.data.length)||"No"} instance${(p==null?void 0:p.data.length)!==1?"s are":" is"} not covered by upgrade profiles.`,positiveDescription:`${v||"No"} instance${v!==1?"s are":" is"} covered by upgrade profiles.`,title:"Upgrade profiles",totalCount:t.length})}),e.jsx(d.Col,{size:6,children:!n&&e.jsx(y,{currentCount:s,negativeDescription:`${(r==null?void 0:r.data.length)||"No"} instance${(r==null?void 0:r.data.length)!==1?"s have":" has"} not contacted the server within the last 5 minutes.`,positiveDescription:`${s||"No"} instance${s!==1?"s have":" has"} contacted the server within the last 5 minutes.`,title:"Contacted",totalCount:t.length})})]})}),!b&&e.jsxs("div",{className:x.rowContainer,children:[e.jsx("h4",{children:"Security upgrades"}),e.jsx(d.Row,{className:w("u-no-padding--left u-no-padding--right",x.row),children:Object.entries(j).map(([h,m])=>{const u=h;return e.jsx(d.Col,{size:6,children:e.jsx(y,{currentCount:g[u],negativeDescription:N(u,"negative"),positiveDescription:N(u,"positive"),title:`${m} days`,totalCount:t.length})},u)})})]}),e.jsx(_,{submitButtonDisabled:!1,submitButtonText:"Download as CSV",onSubmit:D})]})},T=A;export{T as default};
