import{e as b,n as v,f as T,g as x,j as s,h as a}from"./index-u_EhbhC_.js";import{m as j}from"./moment-BMNhdv00.js";import{M as c}from"./MultiSelectField-ehdSZtl5.js";import{S as F}from"./SidePanelFormButtons-xqQ8httV.js";import{u as $}from"./useInstances-iAR4_yRz.js";import{u as A,D as P}from"./index-D4aOnSXX.js";import{c as _,d as N,a as n,b as m,f as O}from"./index.esm-BQnwAMDD.js";import"./SidePanelFormButtons.module-yv6Qz3cN.js";import"./PageMain-CmLgxdJK.js";import"./useMutation-CrcSbzv3.js";import"./useFetchOld-BBfSXCp-.js";import"./CodeEditor-DBmK6eI_.js";import"./useConfirm-B8tJ1H3c.js";import"./EmptyState-BqInhbHc.js";import"./useRoles-BOXb_ntO.js";import"./moment-C5S46NFB.js";const V={deliverImmediately:!0,deliver_after:"",instanceIds:[],queryType:"tags",tags:[],username:""},k=_().shape({deliverImmediately:N().required("This field is required."),deliver_after:n().when("deliverImmediately",{is:!1,then:r=>r.required("This field is required.")}),instanceIds:m().of(O()).when("queryType",{is:"ids",then:r=>r.min(1,"At least one instance is required.")}),queryType:n().required("This field is required."),tags:m().of(n()).when("queryType",{is:"tags",then:r=>r.min(1,"At least one tag is required.")}),username:n().required("This field is required.")}),D=({script:r})=>{const p=b(),{notify:y}=v(),{closeSidePanel:f}=T(),{getAllInstanceTagsQuery:g,getInstancesQuery:q}=$(),{executeScriptQuery:I}=A(),{mutateAsync:h}=I,e=x({initialValues:V,onSubmit:async t=>{const i={query:t.queryType==="ids"?`id:${t.instanceIds.join(" OR id:")}`:`tag:${t.tags.join(" OR tag:")}`,script_id:r.id,username:t.username};t.deliverImmediately||(i.deliver_after=j(t.deliver_after).toISOString().replace(/\.\d+(?=Z$)/,""));try{await h(i),f(),y.success({message:`"${r.title}" script queued to execute successfully`,title:"Script execution queued"})}catch(S){p(S)}},validationSchema:k}),{data:o}=g(),d=(o==null?void 0:o.data.results.map(t=>({label:t,value:t})))??[],{data:u}=q(),l=(u==null?void 0:u.data.results.map(({title:t,id:i})=>({label:t,value:i})))??[];return s.jsxs(a.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[s.jsx("p",{className:"u-no-margin--bottom",children:"Select instances by:"}),s.jsxs("div",{className:"p-form--inline is-required",children:[s.jsx(a.Input,{type:"radio",label:"Tags",...e.getFieldProps("queryType"),value:"tags",checked:e.values.queryType==="tags"}),s.jsx(a.Input,{type:"radio",label:"Names",...e.getFieldProps("queryType"),value:"ids",checked:e.values.queryType==="ids"})]}),e.values.queryType==="tags"&&s.jsx(c,{variant:"condensed",label:"Tags",required:!0,...e.getFieldProps("tags"),items:d,selectedItems:d.filter(({value:t})=>e.values.tags.includes(t)),onItemsUpdate:t=>e.setFieldValue("tags",t.map(({value:i})=>i)),error:e.touched.tags&&typeof e.errors.tags=="string"?e.errors.tags:void 0}),e.values.queryType==="ids"&&s.jsx(c,{variant:"condensed",label:"Instances",required:!0,...e.getFieldProps("instanceIds"),items:l,selectedItems:l.filter(({value:t})=>e.values.instanceIds.includes(t)),onItemsUpdate:t=>e.setFieldValue("instanceIds",t.map(({value:i})=>i)),error:e.touched.instanceIds&&typeof e.errors.instanceIds=="string"?e.errors.instanceIds:void 0}),s.jsx(a.Input,{type:"text",label:"Run as user",autoComplete:"off",required:!0,...e.getFieldProps("username"),error:e.touched.username&&e.errors.username?e.errors.username:void 0}),s.jsx(P,{formik:e}),s.jsx(F,{submitButtonDisabled:e.isSubmitting,submitButtonText:"Run script"})]})},Y=D;export{Y as default};
