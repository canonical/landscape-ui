import{d as ge,c as _e,e as D,j as e,k as E,l as ee,f as q,r as b,g as i,h as F,p as U,H as ne}from"./index-Ck927htQ.js";import{u as xe}from"./useMutation-qHwpl5BJ.js";import{u as O}from"./useQuery-CVfp-Q20.js";import{E as fe}from"./EmptyState-BoClkKZD.js";import"./TablePagination.module-DLVph1Z1.js";import{T as be}from"./TablePagination-D0UxaJGH.js";import{I as $}from"./InfoItem-CG9Eh7-D.js";import{u as je}from"./formik.esm-BeHAEGbw.js";import{h as w}from"./moment-Cl4UOzQZ.js";import{a as T,f as ve,c as Ce}from"./index.esm-DVEO1SHz.js";import{S as ae}from"./SidePanelFormButtons-Bz2-NFyW.js";import{f as X}from"./helpers-DecRsPS2.js";import{u as Se,D as Ne}from"./downshift.esm-By-85qFQ.js";import{u as se}from"./usePageParams-Cezobf9b.js";import"./InfoItem.module-BZ3tYMsb.js";import"./SidePanelFormButtons.module-DyBJG5lm.js";const P=()=>{const n=ge(),s=_e(),u=D(),m=(c,p={})=>{const{instance_id:a,...o}=c;return O({queryKey:["snaps",{...c}],queryFn:()=>n.get(`computers/${a}/snaps/installed`,{params:o}),...p})},l=(c,p={})=>O({queryKey:["snaps",{...c}],queryFn:()=>n.get(`computers/${c.instance_id}/snaps/available?name_startswith=${c.query}`),...p}),x=(c,p={})=>O({queryKey:["snaps",{...c}],queryFn:()=>n.get(`computers/${c.instance_id}/snaps/${c.name}/info`),...p}),f=xe({mutationKey:["snaps","action"],mutationFn:c=>n.post("snaps",c),onSuccess:()=>{s.invalidateQueries(["snaps"]).catch(u)}});return{getSnapsQuery:m,getAvailableSnapInfo:x,getAvailableSnaps:l,snapsActionQuery:f}},ye="_bold_c3q8d_1",we="_radioGroup_c3q8d_5",$e="_marginTop_c3q8d_10",y={bold:ye,radioGroup:we,marginTop:$e};var r=(n=>(n.Switch="Switch",n.Refresh="Refresh",n.Uninstall="Uninstall",n.Hold="Hold",n.Unhold="Unhold",n))(r||{});const te=n=>n.reduce((s,u)=>(u.held_until!==null?s.held++:s.unheld++,s),{held:0,unheld:0}),le=(n,s)=>n.filter(u=>s.includes(u.snap.id)),R={deliver_immediately:T(),randomize_delivery:T(),deliver_delay_window:ve().min(0,"Delivery delay must be greater than or equal to 0"),deliver_after:T().test({test:n=>n?w(n).isValid():!0,message:"You have to enter a valid date and time"})},Fe=n=>{switch(n){case r.Switch:return{...R,release:T().required("Release is required")};case r.Hold:return{...R,hold:T(),hold_until:T().test({test:s=>s?w(s).isValid():!0,message:"You have to enter a valid date and time"})};default:return{...R}}},Be={single:{[r.Refresh]:"This will update {snapName} to the latest version available. Automatic updates will resume, and {snapName} will be upgraded based on the regular refresh schedule.",[r.Uninstall]:"This will remove the Snap from your system",[r.Hold]:"This will pause automatic updates for that particular snap. {snapName} will maintain the current version",[r.Unhold]:"This will resume automatic updates for that particular Snap. {snapName} will be eligible for the latest version upgrades based on the regular refresh schedule."},multiple:{[r.Refresh]:"This will update the selected snaps to the latest version available. Automatic updates will resume, and the snaps will be upgraded based on the regular refresh schedule.",[r.Uninstall]:"This will remove the selected snaps from your system",[r.Hold]:"Holding a Snap will pause automatic updates for that particular snap.",[r.Unhold]:"Unholding a Snap will resume automatic updates for that particular snap."}},Te=(n,s)=>{if(n===r.Switch)return null;const{held:u,unheld:m}=te(s),l=Be[s.length===1?"single":"multiple"][n].replaceAll("{snapName}",s[0].snap.name);return n===r.Refresh||n===r.Uninstall||s.length===1||u===0||m===0?e.jsx("p",{children:l}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:l}),e.jsxs("span",{children:["You selected ",s.length," snaps. This will:"]}),e.jsxs("ul",{children:[e.jsxs("li",{children:[n===r.Hold?"hold":"unhold"," ",X({count:n===r.Hold?m:u,singular:"snap"})]}),e.jsxs("li",{children:["leave"," ",X({count:n===r.Hold?u:m,singular:"snap"})," ",n===r.Hold?"held":"unheld"]})]})]})},Ie=({installedSnaps:n,type:s})=>{const{instanceId:u}=E(),m=D(),{notify:l}=ee(),{closeSidePanel:x}=q(),{snapsActionQuery:f,getAvailableSnapInfo:c}=P(),p=Number(u),{mutateAsync:a,isLoading:o}=f,{data:g}=c({instance_id:p,name:n[0].snap.name},{enabled:s===r.Switch}),v=b.useMemo(()=>(g==null?void 0:g.data["channel-map"].sort((_,S)=>_.channel.architecture.localeCompare(S.channel.architecture)).map(_=>({label:`${_.channel.name} - ${_.channel.architecture}`,value:`${_.channel.name} - ${_.channel.architecture}`})))??[],[g==null?void 0:g.data]),d=Fe(s),j=n.length===1?n[0]:null,C=j?g==null?void 0:g.data["channel-map"][0]:null,t=je({initialValues:{release:void 0,hold:s===r.Hold?"forever":void 0,hold_until:s===r.Hold?"":void 0,deliver_immediately:!0,randomize_delivery:!1,deliver_delay_window:0,deliver_after:""},validationSchema:Ce().shape(d),onSubmit:async _=>{try{a({computer_ids:[p],action:s===r.Uninstall?"remove":s===r.Switch?"refresh":s.toLowerCase(),snaps:n.map(M=>{var k,V;return{name:M.snap.name,channel:_.release?(k=g==null?void 0:g.data["channel-map"].find(N=>`${N.channel.name} - ${N.channel.architecture}`===_.release))==null?void 0:k.channel.name:void 0,revision:(V=g==null?void 0:g.data["channel-map"].find(N=>`${N.channel.name} - ${N.channel.architecture}`===_.release))==null?void 0:V.revision.toString(),time:_.hold==="forever"?"forever":_.hold_until?w(_.hold_until).format():void 0}}),deliver_after:_.deliver_immediately?void 0:_.deliver_after?w(_.deliver_after).format():void 0,deliver_after_window:_.randomize_delivery?_.deliver_delay_window:void 0}),x();const S=s===r.Hold?"held":s===r.Unhold?"unheld":`${s.toLowerCase()}ed`;l.success({message:`You queued ${j?j.snap.name:`${n.length} snaps`} to be ${S}.`})}catch(S){m(S)}}});b.useEffect(()=>{C&&s===r.Switch&&!t.values.release&&t.setFieldValue("release",`${C.channel.name} - ${C.channel.architecture}`)},[C]);const B=_=>{t.setFieldValue("hold",_.currentTarget.value),_.currentTarget.value==="date"&&t.setFieldValue("hold_until",w().toISOString().slice(0,16))},I=_=>{const S=_.currentTarget.value==="true";t.setFieldValue("deliver_immediately",S),S||t.setFieldValue("deliver_after",w().toISOString().slice(0,16))};return e.jsxs(i.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[Te(s,n),s===r.Switch&&e.jsx(i.Select,{label:"release",labelClassName:"p-text--small p-text--small-caps",options:v,disabled:v.length===0,...t.getFieldProps("release")}),s===r.Hold&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:y.bold,children:"Hold"}),e.jsxs("div",{className:y.radioGroup,children:[e.jsx(i.Input,{type:"radio",label:"Indefinitely",...t.getFieldProps("hold"),onChange:B,checked:t.values.hold==="forever",value:"forever"}),e.jsx(i.Input,{type:"radio",label:"Select date",...t.getFieldProps("hold"),onChange:B,checked:t.values.hold==="date",value:"date"})]}),t.values.hold==="date"&&e.jsx(i.Input,{type:"datetime-local",error:t.touched.hold_until&&t.errors.hold_until?t.errors.hold_until:void 0,...t.getFieldProps("hold_until")})]}),e.jsx("span",{className:F(y.bold,y.marginTop),children:"Delivery time"}),e.jsxs("div",{className:y.radioGroup,children:[e.jsx(i.Input,{type:"radio",label:"As soon as possible",name:"deliver_immediately",value:"true",onChange:I,checked:t.values.deliver_immediately}),e.jsx(i.Input,{type:"radio",label:"Scheduled",name:"deliver_immediately",value:"false",onChange:I,checked:!t.values.deliver_immediately})]}),!t.values.deliver_immediately&&e.jsx(i.Input,{type:"datetime-local",label:"Deliver after",labelClassName:"u-off-screen",...t.getFieldProps("deliver_after"),error:t.touched.deliver_after&&t.errors.deliver_after}),e.jsx("span",{className:F(y.bold,y.marginTop),children:"Randomise delivery over a time window"}),e.jsxs("div",{className:y.radioGroup,children:[e.jsx(i.Input,{type:"radio",label:"No",...t.getFieldProps("randomize_delivery"),onChange:async()=>{await t.setFieldValue("randomize_delivery",!1),await t.setFieldValue("deliver_delay_window",0)},checked:!t.values.randomize_delivery}),e.jsx(i.Input,{type:"radio",label:"Yes",...t.getFieldProps("randomize_delivery"),onChange:()=>t.setFieldValue("randomize_delivery",!0),checked:t.values.randomize_delivery})]}),t.values.randomize_delivery&&e.jsx(i.Input,{type:"number",inputMode:"numeric",min:0,label:"Delivery delay window",labelClassName:"u-off-screen",help:"Time in minutes",...t.getFieldProps("deliver_delay_window"),error:t.touched.deliver_delay_window&&t.errors.deliver_delay_window?t.errors.deliver_delay_window:void 0}),e.jsx(ae,{submitButtonText:s,submitButtonAppearance:s===r.Uninstall?"negative":"positive",submitButtonDisabled:o})]})},ke="_container_1nwlw_1",Ae="_noWrap_1nwlw_5",Y={container:ke,noWrap:Ae},He="_toBeConfirmedCard_t8sqm_1",qe="_toBeConfirmedCard__buttons_t8sqm_6",Ue="_toBeConfirmedCard__confirmButton_t8sqm_11",Pe="_bold_t8sqm_16",L={toBeConfirmedCard:He,toBeConfirmedCard__buttons:qe,toBeConfirmedCard__confirmButton:Ue,bold:Pe},Ve=({name:n,handleDeleteToBeConfirmedItem:s,handleAddToSelectedItems:u,instanceId:m})=>{var v;const[l,x]=b.useState(""),{getAvailableSnapInfo:f}=P(),{data:c,isLoading:p}=f({instance_id:m,name:n}),a=c==null?void 0:c.data,o=b.useMemo(()=>a?a["channel-map"].sort((d,j)=>d.channel.architecture.localeCompare(j.channel.architecture)).map(d=>({label:`${d.channel.name} - ${d.channel.architecture}`,value:`${d.channel.name} - ${d.channel.architecture}`})):[],[a]),g=d=>{x(d)};return b.useEffect(()=>{o.length>0&&x(o[0].value)},[o]),e.jsxs(e.Fragment,{children:[p&&e.jsx(U,{}),a&&e.jsx(i.Form,{name:"add-snap",onSubmit:d=>{d.preventDefault(),u({"snap-id":a["snap-id"],name:a.name,snap:a.snap,revision:a["channel-map"].find(j=>`${j.channel.name} - ${j.channel.architecture}`===l).revision.toString(),channel:a["channel-map"].find(j=>`${j.channel.name} - ${j.channel.architecture}`===l).channel.name})},children:e.jsxs("li",{className:F("p-autocomplete__result p-list__item p-card u-no-margin--bottom u-no-padding--bottom",L.toBeConfirmedCard),children:[e.jsx("div",{className:L.bold,children:a.name}),e.jsx("span",{children:e.jsx("small",{className:"u-text--muted p-text--small",children:a.snap.publisher["display-name"]})}),e.jsx(i.Select,{label:e.jsx("span",{className:"u-text--muted p-text--small",children:"Release"}),required:!0,value:l,options:o,onChange:d=>g(d.currentTarget.value),help:((v=a["channel-map"].find(d=>`${d.channel.name} - ${d.channel.architecture}`===l))==null?void 0:v.confinement)==="classic"?e.jsxs("span",{children:[e.jsx("i",{className:"p-icon--warning"}),"This release requires classic permission."," ",e.jsxs("a",{href:"https://snapcraft.io/docs",target:"_blank",rel:"noreferrer",children:["Learn more",e.jsx("i",{className:"p-icon--external-link"})]})]}):void 0}),e.jsxs("div",{className:L.toBeConfirmedCard__buttons,children:[e.jsx(i.Button,{small:!0,className:L.toBeConfirmedCard__confirmButton,type:"submit",appearance:"positive",children:"Add"}),e.jsx(i.Button,{small:!0,type:"button",appearance:"base",onClick:()=>s(),children:"Cancel"})]})]})})]})},ze="_container_1d6qb_1",Le="_suggestionsContainer_1d6qb_5",De="_pointer_1d6qb_12",Ee="_highlighted_1d6qb_17",Me="_selectedContainer_1d6qb_21",H={container:ze,suggestionsContainer:Le,pointer:De,highlighted:Ee,selectedContainer:Me},Oe=200,Re=(n,s)=>{const u=n.toLowerCase(),m=s.toLowerCase(),l=u.indexOf(m);return l>=0?e.jsxs(e.Fragment,{children:[n.substring(0,l),e.jsx("strong",{children:n.substring(l,l+s.length)}),n.substring(l+s.length)]}):n},Ye=({selectedItems:n,setSelectedItems:s,setConfirming:u})=>{var Q;const{instanceId:m}=E(),l=D(),{getAvailableSnaps:x}=P(),[f,c]=b.useState(""),[p,a]=b.useState(!1),[o,g]=b.useState(),[v,d]=b.useState(""),j=b.useRef(null),C=Number(m),{data:t,isFetching:B}=x({instance_id:C,query:f},{enabled:f.length>2}),I=((Q=t==null?void 0:t.data)==null?void 0:Q.results)??[],_=h=>!n.map(A=>A.name).includes(h),S=I.filter(h=>_(h.name));b.useEffect(()=>{var h;o||(h=j.current)==null||h.focus()},[o]);const M=h=>{s(n.filter(A=>A.name!==h))},k=()=>{g(null),u&&u(!1)},V=()=>{o||a(!1)},N=()=>{d(""),c("")},K=()=>{v.length>2?a(!0):a(!1)},oe=h=>{d(h),h.length>2&&c(h)},ce=Se(()=>{try{K()}catch(h){l(h)}},Oe),de=h=>{s([...n,h]),N(),k()},ue=h=>{h&&(u(!0),g(h))},he=h=>{h.key==="Escape"?h.currentTarget.blur():ce()},W=!p&&v.length<3?"Min 3. characters":I.length===0&&f&&!B?`No snaps found by "${f}"`:null;return e.jsxs("div",{className:H.container,children:[e.jsx(Ne,{onSelect:ue,itemToString:()=>"",isOpen:p,children:({getInputProps:h,getItemProps:A,getMenuProps:me,highlightedIndex:pe})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(i.SearchBox,{...h(),placeholder:"Search for available snaps",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:v,ref:j,disabled:!!o,onChange:oe,onClear:N,onBlur:V,onFocus:K,onKeyUp:he}),W?e.jsx("span",{className:"p-form-help-text",children:W}):null,p&&(S.length>0||B)?e.jsx("ul",{className:F("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",H.suggestionsContainer),...me(),children:o&&C?e.jsx(Ve,{handleAddToSelectedItems:de,handleDeleteToBeConfirmedItem:k,name:o.name,instanceId:C},o["snap-id"]):B?e.jsx(U,{}):S.map((z,J)=>e.jsxs("li",{className:F("p-list__item",H.pointer,{[H.highlighted]:pe===J}),...A({item:z,index:J}),children:[e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:Re(z.name,f)}),e.jsx("div",{children:e.jsx("small",{className:"u-text-muted",children:z.snap.publisher["display-name"]})})]},z["snap-id"]))}):null]})}),e.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:n.length?n.map(h=>e.jsxs("li",{className:F("p-autocomplete__result p-list__item p-card u-no-margin--bottom",H.selectedContainer),children:[e.jsxs("div",{children:[e.jsx("div",{children:h.name}),e.jsx("span",{children:e.jsx("small",{className:"u-text--muted p-text--small",children:`${h.snap.publisher["display-name"]} | ${h.channel}`})})]}),e.jsx(i.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>M(h.name),children:e.jsx("i",{className:"p-icon--delete"})})]},h["snap-id"])):null})]})},ie=()=>{const[n,s]=b.useState([]),[u,m]=b.useState(!1),l=D(),{notify:x}=ee(),{closeSidePanel:f}=q(),{snapsActionQuery:c}=P(),{instanceId:p}=E(),a=Number(p),{mutateAsync:o,isLoading:g}=c,v=async()=>{try{await o({computer_ids:[a],snaps:n.map(d=>({name:d.name,channel:d.channel,revision:d.revision})),action:"install"}),f(),x.success({message:`You queued ${n.length===1?`snap ${n[0].name}`:`${n.length} snaps`} to be installed.`}),s([])}catch(d){l(d)}};return e.jsxs(e.Fragment,{children:[e.jsx(Ye,{selectedItems:n,setSelectedItems:d=>s(d),setConfirming:d=>m(d)}),e.jsx(ae,{submitButtonDisabled:n.length===0||u||g,cancelButtonDisabled:g,submitButtonText:"Install snaps",submitButtonAppearance:"positive",onSubmit:v})]})},re=({selectedSnapIds:n,installedSnaps:s,sidePanel:u=!1})=>{const{setSidePanelContent:m}=q(),l=s.length===1?s[0]:null,x=le(s,n),{held:f,unheld:c}=te(x),p=o=>{const g=o===r.Unhold?f:o===r.Hold?c:n.length,v=l?`${o} ${l.snap.name}${o===r.Switch?"'s channel":""}`:`${o} ${g} ${g===1?"snap":"snaps"}`;m(v,e.jsx(b.Suspense,{fallback:e.jsx(U,{}),children:e.jsx(Ie,{installedSnaps:x,type:o})}))},a=()=>{m("Install snap",e.jsx(ie,{}))};return e.jsxs("div",{className:Y.container,children:[!u&&e.jsxs(i.Button,{type:"button",onClick:a,hasIcon:!0,className:Y.noWrap,children:[e.jsx("i",{className:"p-icon--plus"}),e.jsx("span",{children:"Install"})]}),e.jsxs("div",{className:F("p-segmented-control is-small",Y.noWrap),children:[l&&u&&e.jsxs(i.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:n.length===0,onClick:()=>p(r.Switch),children:[e.jsx("i",{className:"p-icon--fork"}),e.jsx("span",{children:"Switch channel"})]}),e.jsxs(i.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:n.length===0,onClick:()=>{p(r.Uninstall)},children:[e.jsx("i",{className:"p-icon--delete"}),e.jsx("span",{children:"Uninstall"})]}),((l==null?void 0:l.held_until)===null||!u)&&e.jsxs(i.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:c===0,onClick:()=>{p(r.Hold)},children:[e.jsx("i",{className:"p-icon--pause"}),e.jsx("span",{children:"Hold"})]}),((l==null?void 0:l.held_until)!==null||!u)&&e.jsxs(i.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:f===0,onClick:()=>{p(r.Unhold)},children:[e.jsx("i",{className:"p-icon--play"}),e.jsx("span",{children:"Unhold"})]}),e.jsxs(i.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:n.length===0,onClick:()=>{p(r.Refresh)},children:[e.jsx("i",{className:"p-icon--change-version"}),e.jsx("span",{children:"Refresh"})]})]},"buttons")]})},Ge=({installedSnap:n})=>e.jsxs(e.Fragment,{children:[e.jsx(re,{selectedSnapIds:[n.snap.id],installedSnaps:[n],sidePanel:!0}),e.jsxs(i.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(i.Col,{size:12,children:e.jsx($,{label:"snap name",value:n.snap.name})}),e.jsx(i.Col,{size:6,children:e.jsx($,{label:"channel",value:n.tracking_channel})}),e.jsx(i.Col,{size:6,children:e.jsx($,{label:"version",value:n.version})}),e.jsx(i.Col,{size:6,children:e.jsx($,{label:"confinement",value:n.confinement})}),e.jsx(i.Col,{size:6,children:e.jsx($,{label:"held until",value:n.held_until?w(n.held_until).format(ne):"-"})}),e.jsx(i.Col,{size:12,children:e.jsx($,{label:"summary",value:n.snap.summary??"-"})}),e.jsx(i.Col,{size:12,children:e.jsx($,{label:"publisher",value:n.snap.publisher.username})})]})]}),Ke="_details_9i6m6_1",We="_pause_9i6m6_5",Z={details:Ke,pause:We},Qe=({installedSnaps:n,selectedSnapIds:s,isSnapsLoading:u,setSelectedSnapIds:m})=>{const{setSidePanelContent:l}=q(),x=a=>{s.includes(a.original.snap.id)?m(s.filter(o=>o!==a.original.snap.id)):m([...s,a.original.snap.id])},f=()=>{m(s.length!==0?[]:n.map(({snap:a})=>a.id))},c=a=>{l(`${a.snap.name} details`,e.jsx(b.Suspense,{fallback:e.jsx(U,{}),children:e.jsx(Ge,{installedSnap:a})}))},p=b.useMemo(()=>[{Header:e.jsxs(e.Fragment,{children:[e.jsx(i.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:f,checked:s.length===n.length&&n.length!==0,indeterminate:s.length!==0&&s.length<n.length}),e.jsx("span",{children:"Name"})]}),accessor:"name",Cell:({row:a})=>e.jsxs(e.Fragment,{children:[e.jsx(i.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:a.original.snap.name}),inline:!0,checked:s.includes(a.original.snap.id),onChange:()=>{x(a)}}),e.jsx(i.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{c(a.original)},"aria-label":`Show details of snap ${a.original.snap.name}`,children:a.original.snap.name})]})},{Header:"Channel",accessor:"channel",Cell:({row:a})=>e.jsx(e.Fragment,{children:a.original.tracking_channel})},{Header:"Held until",accessor:"held_until",Cell:({row:a})=>e.jsx(e.Fragment,{children:a.original.held_until?w(a.original.held_until).format(ne):"-"})},{Header:"Version",accessor:"version",Cell:({row:a})=>e.jsx(e.Fragment,{children:a.original.held_until?e.jsx(i.Tooltip,{message:"This snap is held",children:a.original.version}):a.original.version}),getCellIcon:({row:a})=>a.original.held_until?`pause ${Z.pause}`:null},{Header:"Summary",accessor:"summary",className:Z.details,Cell:({row:a})=>e.jsx(e.Fragment,{children:a.original.snap.summary})}],[s,n]);return e.jsx(e.Fragment,{children:e.jsx(i.ModularTable,{columns:p,data:n,emptyMsg:u?"Loading...":"No snaps found from the search"})})},Je="_container_1qwn6_1",Xe="_searchContainer_1qwn6_6",Ze="_selectContainer_1qwn6_10",en="_cta_1qwn6_15",G={container:Je,searchContainer:Xe,selectContainer:Ze,cta:en},nn=({handleClearSelection:n,selectedSnapIds:s,installedSnaps:u})=>{const{search:m,setPageParams:l}=se(),[x,f]=b.useState(m),c=()=>{l({search:x}),n()},p=()=>{l({search:""})},a=o=>{o.preventDefault(),c()};return e.jsxs("div",{className:G.container,children:[e.jsx("div",{className:G.searchContainer,children:e.jsx(i.Form,{onSubmit:a,noValidate:!0,children:e.jsx(i.SearchBox,{shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:x,"aria-label":"Snap search",onChange:o=>f(o),onSearch:c,onClear:p})})}),e.jsx("div",{className:G.cta,children:e.jsx(re,{selectedSnapIds:s,installedSnaps:le(u,s)})})]})},an=()=>{var j,C;const[n,s]=b.useState([]),{instanceId:u}=E(),{search:m,currentPage:l,pageSize:x}=se(),{getSnapsQuery:f}=P(),{setSidePanelContent:c}=q(),p=Number(u),{data:a,isLoading:o}=f({instance_id:p,limit:x,offset:(l-1)*x,search:m}),g=()=>{c("Install snap",e.jsx(ie,{}))},v=b.useMemo(()=>{var t;return((t=a==null?void 0:a.data)==null?void 0:t.results)??[]},[a]),d=()=>{s([])};return e.jsxs(e.Fragment,{children:[!m&&o&&l===1&&x===20&&e.jsx(U,{}),!o&&!m&&(!a||a.data.results.length===0)&&e.jsx(fe,{title:"You haven't installed any snaps yet",body:e.jsx("p",{className:"u-no-margin--bottom",children:"Install Snaps by clicking the button below."}),cta:[e.jsx(i.Button,{appearance:"positive",onClick:g,children:"Install Snap"},"empty-state-install-snap")]}),(m||l!==1||x!==20||a&&(a==null?void 0:a.data.results.length)>0)&&e.jsxs(e.Fragment,{children:[e.jsx(nn,{selectedSnapIds:n,installedSnaps:v,handleClearSelection:d}),e.jsx(Qe,{selectedSnapIds:n,setSelectedSnapIds:t=>s(t),installedSnaps:v,isSnapsLoading:o})]}),e.jsx(be,{handleClearSelection:d,totalItems:(j=a==null?void 0:a.data)==null?void 0:j.count,currentItemCount:(C=a==null?void 0:a.data)==null?void 0:C.results.length})]})},vn=an;export{vn as default};
