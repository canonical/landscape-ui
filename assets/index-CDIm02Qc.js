const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-qId8dUkO.js","assets/index-B7B6ilm5.js","assets/index-DM5072WT.css","assets/useInstances-BUtpn7Hb.js","assets/useFetchOld-1Nw_5ixo.js","assets/useRoles-C9ZPoQqW.js","assets/NoData-DuM1zKhh.js","assets/moment-Cevqzlhc.js","assets/index-CoQBeqtS.css","assets/index-lqPuImfn.js","assets/CodeEditor-t7d1sjvd.js","assets/CodeEditor-CA89WJcJ.css","assets/SidePanelFormButtons-DMklau0U.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/moment-C5S46NFB.js","assets/index-CE4J0A4y.css","assets/index-D2lfQa9i.js","assets/useUsns-BMLGaVKP.js","assets/useUsns-CzsIYyKO.css","assets/index-DnijcWoq.js","assets/index-DegjgOfo.css"])))=>i.map(i=>d[i]);
import{c as X,e as D,f as ee,k as M,v as G,C as Y,j as e,g as R,h as o,Z as te,r as g,l as se,m as ne,n as ae,W as re,s as A,L as oe,R as W,G as K,_ as T,i as Z}from"./index-B7B6ilm5.js";import{P as ie,a as ce,b as le}from"./PageMain-B9UunXWw.js";import{S as de}from"./SearchHelpPopup-CFfeml9K.js";import{T as ue}from"./TablePagination-BnMZ3GtV.js";import{u as he}from"./useFetchOld-1Nw_5ixo.js";import{u as J}from"./usePageParams-B293qugv.js";import{u as z}from"./useInstances-BUtpn7Hb.js";import{h as B}from"./moment-C5S46NFB.js";import{N as q}from"./NoData-DuM1zKhh.js";import{S as b}from"./constants-BNohbweP.js";import"./TablePagination.module-CgQ3jx4B.js";const V=()=>{const s=he(),n=X(),a=(i={},p={})=>ee({queryKey:["savedSearches",i],queryFn:()=>s.get("GetSavedSearches",{params:i}),...p}),r=D({mutationFn:i=>s.get("CreateSavedSearch",{params:i}),onSuccess:()=>n.invalidateQueries({queryKey:["savedSearches"]})}),h=D({mutationFn:i=>s.get("EditSavedSearch",{params:i}),onSuccess:()=>n.invalidateQueries({queryKey:["savedSearches"]})}),u=D({mutationFn:i=>s.get("RemoveSavedSearch",{params:i}),onSuccess:()=>n.invalidateQueries({queryKey:["savedSearches"]})});return{getSavedSearchesQuery:a,createSavedSearchQuery:r,editSavedSearchQuery:h,removeSavedSearchQuery:u}},pe="_container_5hvuq_1",me="_list_5hvuq_6",ge="_listItem_5hvuq_11",xe="_search_5hvuq_17",je="_row_5hvuq_25",fe="_truncated_5hvuq_33",k={container:pe,list:me,listItem:ge,search:xe,row:je,truncated:fe},_e=({onSavedSearchClick:s,onSavedSearchRemove:n,savedSearches:a})=>{if(!a.length)return null;const r=M(),{notify:h}=G(),{closeConfirmModal:u,confirmModal:i}=Y(),{removeSavedSearchQuery:p}=V(),{mutateAsync:l}=p,j=async t=>{try{await l({name:t}),n(),h.success({message:`Saved search ${t} successfully removed`,title:"Saved search removed"})}catch(c){r(c)}finally{u()}},y=t=>{i({title:"Remove saved search",body:`This will remove the saved search "${t}"`,buttons:[e.jsx(o.Button,{type:"button",appearance:"negative",onClick:()=>j(t),"aria-label":`Remove ${t} search`,children:"Remove"},"remove")]})};return e.jsxs("div",{className:k.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Saved searches"}),e.jsx("ul",{className:R("p-list--divided u-no-margin--bottom",k.list),children:a.map(t=>e.jsx("li",{children:e.jsxs("div",{className:k.listItem,children:[e.jsx(o.Button,{appearance:"base",className:k.search,onClick:()=>s(t),children:e.jsxs(o.Row,{className:k.row,children:[e.jsx(o.Col,{size:4,children:e.jsx(o.Tooltip,{message:t.name,positionElementClassName:k.truncated,children:e.jsx("span",{children:t.name})})}),e.jsx(o.Col,{size:8,children:e.jsx(o.Tooltip,{message:t.search,positionElementClassName:k.truncated,children:e.jsx("span",{children:t.search})})})]})}),e.jsx(o.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding--bottom u-no-padding--top",onClick:()=>y(t.name),"aria-label":`Remove ${t.title} search`,children:e.jsx(o.Icon,{name:"delete"})})]})},t.name))})]})},be=({containerRef:s,onDismiss:n,onOverflowingItemsAmountChange:a,searchData:r})=>{const h=()=>{if(!s.current)return;const i=s.current.querySelectorAll("span.p-chip");a(Array.from(i).filter(({offsetHeight:p,offsetTop:l})=>l>p).length)};te("resize",h),g.useEffect(()=>{h()},[r.length]);const u=i=>i.title?i.title:i.quoteValue?`'${i.value}'`:i.value;return r.map(i=>e.jsx(o.Chip,{value:u(i),lead:i.lead,onDismiss:()=>n(i.value)},i.value))},ye="_infoContainer_1lzch_1",ve="_amount_1lzch_9",Se="_helpButtonContainer_1lzch_14",Ce="_helpButton_1lzch_14",L={infoContainer:ye,amount:ve,helpButtonContainer:Se,helpButton:Ce},we=({isExpanded:s,onHelpButtonClick:n,overflowingChipsAmount:a})=>e.jsxs("div",{className:L.infoContainer,children:[a>0&&!s&&e.jsx("span",{className:R("u-text--muted",L.amount),children:`+${a}`}),e.jsx("div",{className:L.helpButtonContainer,children:e.jsx(o.Button,{type:"button",appearance:"base",hasIcon:!0,className:L.helpButton,onClick:r=>{r.stopPropagation(),n()},children:e.jsx(o.Icon,{name:"help"})})})]}),Ie=({onClose:s,onSearchSave:n,search:a})=>{const r=M(),{notify:h}=G(),{createSavedSearchQuery:u}=V(),{mutateAsync:i}=u,l=se({initialValues:{name:""},onSubmit:async({name:j})=>{try{await i({search:a,name:j,title:j}),h.success({message:`Saved search ${j} successfully added`,title:"Saved search added"}),n(),s()}catch(y){r(y)}},validationSchema:ne({name:ae().required("This field is required").test({message:"Name must consist of only lowercase alphanumeric characters and hyphens",test:j=>/^[a-z0-9][-a-z0-9]*$/.test(j)})})});return e.jsxs(o.Form,{onSubmit:l.handleSubmit,noValidate:!0,children:[e.jsx(o.Input,{type:"text",autoComplete:"off",autoFocus:!0,label:"Search name",...l.getFieldProps("name"),error:l.touched.name&&l.errors.name?l.errors.name:void 0}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(o.Button,{type:"button",disabled:l.isSubmitting,onClick:s,children:"Cancel"}),e.jsx(o.Button,{type:"submit",disabled:l.isSubmitting,appearance:"positive","aria-label":`Saved search as ${l.values.name}`,children:"Save search"})]})]})},ke="_container_fqj7b_1",Ne="_prompt_fqj7b_10",$e="_saveButton_fqj7b_17",U={container:ke,prompt:Ne,saveButton:$e},Ae=({onSearchSave:s,search:n})=>{const[a,r]=g.useState(!1);return e.jsxs(e.Fragment,{children:[n&&a&&e.jsx(Ie,{onClose:()=>r(!1),onSearchSave:s,search:n}),n&&!a&&e.jsxs("div",{className:U.container,children:[e.jsxs("span",{className:U.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:n}),e.jsx("span",{children:"..."})]}),e.jsx(o.Button,{type:"button",appearance:"link",onClick:()=>r(!0),className:U.saveButton,children:"Save search"})]})]})},Pe="_searchContainer_17q9j_1",Re="_form_17q9j_5",Be="_searchBoxContainer_17q9j_10",qe="_input_17q9j_14",F={searchContainer:Pe,form:Re,searchBoxContainer:Be,input:qe},Le=(s,n)=>s.length===n.length&&s.every((a,r)=>a.value===n[r].value),Fe=(s,n)=>!s||!n?[]:s.split(",").map(a=>{const r=n.find(({name:h})=>h===a);return r?{lead:"search",title:r.name,value:r.name}:{value:a,quoteValue:!0}}),Ee=({onHelpButtonClick:s,returnSearchData:n,existingSearchData:a})=>{const{search:r,setPageParams:h}=J(),[u,i]=g.useState(""),[p,l]=g.useState(!1),[j,y]=g.useState(0),{getSavedSearchesQuery:t}=V(),c=g.useRef(null),d=g.useRef(null);re(c,()=>{l(!1)});const w=x=>{h({search:r.split(",").filter(v=>v!==x).join(",")})},{data:f,isLoading:$}=t(),C=Fe(r,f==null?void 0:f.data);Le(a,C)||n(C);const m=g.useMemo(()=>f?!u&&!C.length?f.data:f.data.filter(({search:x})=>C.every(({value:v})=>v!==x)).filter(({title:x,search:v})=>x.toLowerCase().includes(u.trim().toLowerCase())||v.toLowerCase().includes(u.trim().toLowerCase())):[],[f,u,C]),I=()=>{u&&(h({search:`${r}${r?",":""}${u}`}),i(""))},O=x=>{h({search:`${r}${r?",":""}${x.name}`})},_=x=>{const{key:v}=x;p?(v==="Escape"&&l(!1),v==="Enter"&&I()):v==="Enter"&&l(!0)};return e.jsxs("div",{className:"p-search-and-filter",ref:c,children:[e.jsxs("div",{className:R("p-search-and-filter__search-container",F.searchContainer),"aria-expanded":p,ref:d,onClick:()=>l(!0),children:[e.jsx(be,{containerRef:d,onDismiss:w,onOverflowingItemsAmountChange:x=>y(x),searchData:C}),e.jsx(o.Form,{onSubmit:x=>{x.preventDefault(),I()},className:R("p-search-and-filter__box",F.form),children:e.jsx("div",{className:F.searchBoxContainer,children:e.jsx(o.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autocomplete:"off",className:F.input,value:u,onChange:x=>i(x),onClear:()=>i(""),onSearch:I,onClick:()=>l(!0),onKeyUp:_})})}),e.jsx(we,{isExpanded:p,onHelpButtonClick:s,overflowingChipsAmount:j})]}),p&&$&&e.jsx(A,{}),p&&!$&&e.jsxs("div",{className:"p-search-and-filter__panel",children:[e.jsx(Ae,{onSearchSave:()=>i(""),search:u.trim()}),e.jsx(_e,{onSavedSearchClick:O,onSavedSearchRemove:()=>l(!0),savedSearches:m})]})]})},Te="_checkbox_spblf_1",Oe="_rowHeader_spblf_5",De="_nested_spblf_8",Ue="_restartError_spblf_12",He="_restartWarning_spblf_16",Qe="_statusListItem_spblf_20",Me="_statusContainer_spblf_24",E={checkbox:Te,rowHeader:Oe,nested:De,restartError:Ue,restartWarning:He,statusListItem:Qe,statusContainer:Me},ze=({instances:s,selectedInstances:n,setSelectedInstances:a,groupBy:r})=>{const h=()=>{a(n.length!==0?[]:s)},u=t=>{if(r==="parent"&&t.original.children.length>0){const c=t.original.children.map(({id:d})=>d);n.some(({id:d})=>c.includes(d))?a(n.filter(({id:d})=>!c.includes(d))):a([...n,...t.original.children.map(d=>({...d,parent:t.original,children:[]}))])}else n.some(({id:c})=>c===t.original.id)?a(n.filter(({id:c})=>c!==t.original.id)):a([...n,t.original])},i=g.useMemo(()=>r==="parent"?s.map(t=>({...t,subRows:t.children.map(c=>({...c,parent:t,children:[]}))})):s,[s,r]),p=t=>{const c=n.map(({id:d})=>d);return r==="parent"&&!t.is_wsl_instance&&t.children.length>0?t.children.every(({id:d})=>c.includes(d))?"checked":t.children.some(({id:d})=>c.includes(d))?"indeterminate":"unchecked":c.includes(t.id)?"checked":"unchecked"},l=t=>{if(!t.distribution||!/\d{1,2}\.\d{2}/.test(t.distribution))return{icon:"",label:e.jsx(q,{})};if(!t.upgrades||!t.upgrades.security&&!t.upgrades.regular)return{icon:b.UpToDate.icon.color,label:b.UpToDate.label};if(t.upgrades.security)if(t.upgrades.regular){const c=`${t.upgrades.security} security, ${t.upgrades.regular} regular ${t.upgrades.regular===1?"upgrade":"upgrades"}`;return{icon:b.SecurityUpgradesAlert.icon.color,label:e.jsx(e.Fragment,{children:c})}}else return{icon:b.SecurityUpgradesAlert.icon.color,label:e.jsxs(e.Fragment,{children:[t.upgrades.security," security"," ",t.upgrades.security===1?"upgrade":"upgrades"]})};else return{icon:b.PackageUpgradesAlert.icon.color,label:e.jsxs(e.Fragment,{children:[t.upgrades.regular," regular"," ",t.upgrades.regular===1?"upgrade":"upgrades"]})}},j=t=>{const c=((t==null?void 0:t.alerts)??[]).filter(({type:d})=>!["PackageUpgradesAlert","SecurityUpgradesAlert"].includes(d));return c.length===0?{icon:`${b.Online.icon.color}`,label:b.Online.alternateLabel??b.Online.label}:c.length===1?{icon:`${b[c[0].type].icon.color??b.Unknown.icon.color}`,label:e.jsx(e.Fragment,{children:c[0].summary})}:{label:e.jsx("span",{className:E.statusContainer,children:c.map(({type:d,summary:N})=>{var w;return e.jsx("span",{className:E.statusListItem,children:e.jsx(o.Tooltip,{message:N,children:e.jsx(o.Icon,{className:"u-no-margin--left",name:`${((w=b[d])==null?void 0:w.icon.color)??b.Unknown.icon.color}`})})},d)})})}},y=g.useMemo(()=>[{accessor:"title",Header:e.jsxs(e.Fragment,{children:[e.jsx(o.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,onChange:h,disabled:s.length===0,checked:n.length===s.length&&s.length!==0,indeterminate:n.length!==0&&n.length<s.length}),e.jsx("span",{children:"Name"})]}),Cell:({row:t})=>e.jsxs("div",{className:R(E.rowHeader,{[E.nested]:t.depth>0}),children:[e.jsx(o.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:t.original.title}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:p(t.original)==="checked",indeterminate:p(t.original)==="indeterminate",onChange:()=>{u(t)}}),e.jsx(oe,{to:t.original.parent?`${W}instances/${t.original.parent.id}/${t.original.id}`:`${W}instances/${t.original.id}`,children:t.original.title})]})},{Header:"Status",accessor:"alerts",Cell:({row:{original:t}})=>{const{label:c}=j(t);return c},getCellIcon:({row:{original:t}})=>{const{icon:c}=j(t);return c}},{Header:"Upgrades",Cell:({row:{original:t}})=>{const{label:c}=l(t);return c},getCellIcon:({row:{original:t}})=>{const{icon:c}=l(t);return c}},{accessor:"distribution",Header:"OS",Cell:({row:{original:t}})=>t.distribution?/\d{1,2}\.\d{2}/.test(t.distribution)?`${t.is_wsl_instance?"WSL - ":""}UbuntuÂ ${t.distribution}`:`Windows ${t.distribution}`:e.jsx(q,{})},{accessor:"ubuntu_pro_info",Header:"Ubuntu pro",Cell:({row:t})=>e.jsx(e.Fragment,{children:t.original.ubuntu_pro_info&&B(t.original.ubuntu_pro_info.expires).isValid()?`Exp. ${B(t.original.ubuntu_pro_info.expires).format(K)}`:e.jsx(q,{})})},{Header:"Host name",accessor:"hostname"},{Header:"Last ping time",accessor:"last_ping_time",Cell:({row:t})=>e.jsx(e.Fragment,{children:B(t.original.last_ping_time).isValid()?B(t.original.last_ping_time).format(K):e.jsx(q,{})})}],[n.length,s,r]);return e.jsx(e.Fragment,{children:e.jsx(o.ModularTable,{emptyMsg:"No instances found",columns:y,data:i})})},Ve=[{term:"<keyword>",description:e.jsxs("span",{children:["Instances with the title or hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"distribution:<keyword>",description:e.jsxs("span",{children:["Instances with the installed distribution named"," ",e.jsx("code",{children:"<keyword>"})]})},{term:"needs:reboot",description:"Instances needing a reboot"},{term:"alert:<type>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with outstanding alerts of the specified"," ",e.jsx("code",{children:"<type>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be ",e.jsx("code",{children:"package-upgrades"}),","," ",e.jsx("code",{children:"security-upgrades"}),",",e.jsx("code",{children:"package-profiles"}),","," ",e.jsx("code",{children:"package-reporter"}),", ",e.jsx("code",{children:"esm-disabled"}),","," ",e.jsx("code",{children:"computer-offline"}),",",e.jsx("code",{children:"computer-reboot"}),","," ",e.jsx("code",{children:"computer-duplicates"}),", ",e.jsx("code",{children:"unapproved-activities"}),"."]})]})},{term:"ip:<address>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with IP addresses like ",e.jsx("code",{children:"<address>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<address>"})," can be a fragment or partial IP address representing a subnet such as 91.185.94 to match any instances in the subnet."]})]})},{term:"mac:<address>",description:e.jsxs("span",{children:["Instances with the MAC address ",e.jsx("code",{children:"<address>"})]})},{term:"id:<instance_id>",description:e.jsxs("span",{children:["Instance with the id ",e.jsx("code",{children:"<instance_id>"})]})},{term:"access-group:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," access group"]})},{term:"search:<name>",description:e.jsxs("span",{children:["Instances meeting the terms of the ",e.jsx("code",{children:"<name>"})," saved search"]})},{term:"upgrade-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," upgrade profile"]})},{term:"removal-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," removal profile"]})},{term:"tag:<keyword>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<keyword>"})," tag"]})},{term:"hostname:<keyword>",description:e.jsxs("span",{children:["Instance with the hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"title:<keyword>",description:e.jsxs("span",{children:["Instance with the title ",e.jsx("code",{children:"<keyword>"})]})},{term:"license-id:<license_id>",description:e.jsxs("span",{children:["Search for instances licensed to the specified"," ",e.jsx("code",{children:"<license_id>"})]})},{term:"needs:license OR license-id:none",description:"Search for instances that do not have a Landscape license, and, as a result, are not managed"},{term:"annotation:<key>",description:e.jsxs("span",{children:["Search for instances which define the specified annotation key. Optionally specify ",e.jsx("code",{children:"annotation:<key>:<string>"})," ","which will only return instances whose key matches and value also contains the ",e.jsx("code",{children:"<string>"})," specified"]})}],H=["UpToDate","PackageUpgradesAlert","SecurityUpgradesAlert","PackageProfilesAlert","PackageReporterAlert","EsmDisabledAlert","ComputerOfflineAlert","ComputerOnlineAlert","ComputerRebootAlert","ComputerDuplicateAlert","UnapprovedActivitiesAlert","ChildInstanceProfileAlert"],S={os:{slug:"os",label:"OS",type:"select",options:[{label:"All",value:"",query:""},{label:"Ubuntu",value:"ubuntu",query:"NOT distribution:windows"},{label:"Windows",value:"windows",query:"distribution:windows"}]},groupBy:{slug:"groupBy",label:"Group by",type:"select",options:[{label:"None",value:"",query:""},{label:"Parent",value:"parent",query:"parent"}]},status:{slug:"status",label:"Status",type:"select",options:[{label:"All",value:"",query:""},...Object.values(b).filter(({alertType:s})=>H.includes(s)).sort((s,n)=>H.indexOf(s.alertType)-H.indexOf(n.alertType)).map(({label:s,filterValue:n,query:a})=>({label:s,value:n,query:a}))]}},We="_top_1fge3_1",Ke="_select_1fge3_11",Ge="_searchContainer_1fge3_17",Ye="_widgets_1fge3_21",P={top:We,select:Ke,searchContainer:Ge,widgets:Ye},Ze=g.lazy(()=>T(()=>import("./index-qId8dUkO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),Je=()=>{const{setSidePanelContent:s}=Z(),{getPendingInstancesQuery:n}=z(),{data:a}=n();if(!a||!a.data.length)return null;const r=()=>{s("Review Pending Instances",e.jsx(g.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(Ze,{instances:a.data})}),"large")};return e.jsxs(o.Notification,{severity:"information",title:"Pending instances",children:[e.jsx("span",{children:`You currently have ${a.data.length} pending
          	${a.data.length===1?"instance":"instances"}
          	awaiting your review and approval. `}),e.jsx(o.Button,{type:"button",appearance:"link",onClick:r,children:"Review Pending Instances"})]})},Q=(s,n)=>{var a;return s.type==="select"?((a=s.options.find(r=>r.value===n))==null?void 0:a.query)??"":""},Xe=({selectedInstances:s,setSelectedInstances:n})=>{const[a,r]=g.useState([]),[h,u]=g.useState(!1),{os:i,groupBy:p,status:l,currentPage:j,pageSize:y,setPageParams:t}=J(),{getInstancesQuery:c}=z(),d=Q(S.status,l),N=Q(S.os,i),w=Q(S.groupBy,p),{data:f,isLoading:$}=c({query:`${a.map(({lead:_,value:x,title:v})=>_&&v?`${_}:${v}`:x).join(" ")}${N??""} ${d}`.trim(),root_only:w==="parent",with_alerts:!0,with_upgrades:!0,limit:y,offset:(j-1)*y}),C=(f==null?void 0:f.data.results)??[],m=(f==null?void 0:f.data.count)??0,I=(_,x)=>{t({[_]:x})},O=()=>{n([])};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:P.top,children:[e.jsx("div",{className:P.searchContainer,children:e.jsx(Ee,{existingSearchData:a,onHelpButtonClick:()=>u(!0),returnSearchData:_=>r(_)})}),S.groupBy.type==="select"&&e.jsx(o.Select,{label:S.groupBy.label,wrapperClassName:P.select,className:"u-no-margin--bottom",options:S.groupBy.options,value:p,onChange:_=>I("groupBy",_.target.value)}),S.os.type==="select"&&e.jsx(o.Select,{label:S.os.label,wrapperClassName:P.select,className:"u-no-margin--bottom",options:S.os.options,value:i,onChange:_=>I("os",_.target.value)}),S.status.type==="select"&&e.jsx(o.Select,{label:S.status.label,wrapperClassName:P.select,className:"u-no-margin--bottom",options:S.status.options,value:l,onChange:_=>I("status",_.target.value)})]}),e.jsx(de,{open:h,data:Ve,onClose:()=>{u(!1)}}),e.jsx(Je,{}),$?e.jsx(A,{}):e.jsx(ze,{instances:C,selectedInstances:s,setSelectedInstances:_=>{n(_)},groupBy:p}),e.jsx(ue,{totalItems:m,handleClearSelection:O,currentItemCount:C.length})]})},et="_header_116wp_1",tt={header:et},st=g.lazy(()=>T(()=>import("./index-lqPuImfn.js").then(s=>s.i),__vite__mapDeps([9,1,2,10,11,12,13,14,4,5,15,16])).then(s=>({default:s.RunInstanceScriptForm}))),nt=g.lazy(()=>T(()=>import("./index-D2lfQa9i.js"),__vite__mapDeps([17,1,2,12,13,14,18,4,19,7])).then(s=>({default:s.Upgrades}))),at=g.lazy(()=>T(()=>import("./index-DnijcWoq.js"),__vite__mapDeps([20,1,2,4,12,13,14,21]))),xt=()=>{const[s,n]=g.useState([]),a=M(),{setSidePanelContent:r}=Z(),{confirmModal:h,closeConfirmModal:u}=Y(),{rebootInstancesQuery:i,shutdownInstancesQuery:p}=z(),{mutateAsync:l,isPending:j}=i,{mutateAsync:y,isPending:t}=p,c=async()=>{r("Run script",e.jsx(g.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(st,{query:`id:${s.map(({id:m})=>m).join(" id:")}`})}))},d=async()=>{try{await y({computer_ids:s.map(({id:m})=>m)})}catch(m){a(m)}finally{u()}},N=()=>{h({title:"Shutting down selected instances",body:`Are you sure you want to shutdown ${s.length} ${s.length===1?"instance":"instances"}?`,buttons:[e.jsx(o.Button,{appearance:"negative",onClick:d,children:"Shutdown"},"shutdown")]})},w=async()=>{try{await l({computer_ids:s.map(({id:m})=>m)})}catch(m){a(m)}finally{u()}},f=()=>{h({title:"Restarting selected instances",body:`Are you sure you want to restart ${s.length} ${s.length===1?"instance":"instances"}?`,buttons:[e.jsx(o.Button,{appearance:"negative",onClick:w,children:"Restart"},"restart")]})},$=()=>{r("Upgrades",e.jsx(g.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(nt,{selectedInstances:s})}),"large")},C=()=>{r(`Report for ${s.length===1?s[0].title:`${s.length} instances`}`,e.jsx(g.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(at,{instanceIds:s.map(({id:m})=>m)})}),"medium")};return e.jsxs(ie,{children:[e.jsx(ce,{title:"Instances",className:tt.header,actions:[e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(o.Button,{className:"p-segmented-control__button",type:"button",onClick:N,disabled:t||s.length===0,children:[e.jsx(o.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]}),e.jsxs(o.Button,{className:"p-segmented-control__button",type:"button",onClick:f,disabled:j||s.length===0,children:[e.jsx(o.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]}),e.jsxs(o.Button,{className:"p-segmented-control__button",type:"button",onClick:C,disabled:s.length===0,children:[e.jsx(o.Icon,{name:"status"}),e.jsx("span",{children:"View report"})]}),e.jsxs(o.Button,{className:"p-segmented-control__button",type:"button",onClick:c,disabled:s.length===0,children:[e.jsx(o.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]}),e.jsxs(o.Button,{className:"p-segmented-control__button",type:"button",onClick:$,disabled:s.length===0||s.every(({upgrades:m})=>!m||!m.regular&&!m.security),children:[e.jsx(o.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]})]})},"buttons")]}),e.jsx(le,{children:e.jsx(Xe,{selectedInstances:s,setSelectedInstances:m=>{n(m)}})})]})};export{xt as default};
