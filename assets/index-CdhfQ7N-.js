import{f as T,v as g,w,G as S,z as x,y as q,B as v,C as P,p as C,i as p,an as R,j as i,d as c}from"./index-Dfc97QGW.js";import{F as B}from"./FileInput-Bh7FqDbd.js";import{S as j}from"./SidePanelFormButtons-BdOP5SSP.js";import{u as A}from"./index-S_kjB96R.js";import{g as l}from"./formikErrors-Bw8iTXYS.js";import{u as E}from"./useGetWslInstanceTypes-CLaZ6oyJ.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./NoData-DMN9LLPq.js";import"./ResponsiveTable-ViIMTRR6.js";import"./TablePagination-B0v8QAQr.js";import"./TableFilterChips-DXWGZ6VK.js";import"./useFetchOld-BgGVMMmJ.js";import"./PageParamFilter-C5PJgjVf.js";import"./TableFilter-BmLRyeMD.js";const W=()=>{const a=T(),o=g(),{isPending:r,mutateAsync:s}=w({mutationFn:async({parent_id:u,...d})=>a.post(`computers/${u}/children`,d),onSuccess:async()=>Promise.all([o.invalidateQueries({queryKey:["wsl-hosts"]}),o.invalidateQueries({queryKey:["instances"]})])});return{isCreatingWslInstance:r,createWslInstance:s}},L=[/^ubuntu$/,/^ubuntu-preview$/,/^ubuntu-[0-9]{2}\.[0-9]{2}$/],N=1,_=a=>{if(a)return new Promise((o,r)=>{const s=new FileReader;s.readAsDataURL(a),s.onload=()=>{o(s.result)},s.onerror=u=>{r(u)}})},J=()=>{const{instanceId:a}=S(),o=x(),{closeSidePanel:r}=q(),{notify:s}=v(),{openActivityDetails:u}=A(),{isGettingWslInstanceTypes:d,wslInstanceTypes:y}=E(),{createWslInstance:b}=W(),t=P({initialValues:{instanceType:"Ubuntu",cloudInit:null,instanceName:"",rootfs:""},validationSchema:C({instanceType:p().required("This field is required"),cloudInit:R().nullable().test("file-size","File size must be less than 1MB",e=>e?e.size===void 0?!1:e.size<=N*1024*1024:!0),instanceName:p().when("instanceType",{is:"custom",then:e=>e.required("This field is required").test("not-match-reserved-patterns","Instance name cannot match 'ubuntu', 'ubuntu-preview', or 'ubuntu-<dd>.<dd>'",n=>!L.some(m=>m.test(n.toLowerCase())))}),rootfs:p().url().when("instanceType",{is:"custom",then:e=>e.required("This field is required")})}),onSubmit:async e=>{try{const n=await _(e.cloudInit),m=n?n.split(",")[1]:void 0,{data:F}=await b({parent_id:parseInt(a??""),computer_name:e.instanceType==="custom"?e.instanceName:e.instanceType,rootfs_url:e.instanceType==="custom"?e.rootfs:void 0,cloud_init:m});r(),s.success({title:`You have successfully marked ${e.instanceName} to be installed.`,message:"An activity has been queued to install it.",actions:[{label:"View details",onClick:()=>{u(F)}}]})}catch(n){o(n)}}}),f=[...y.map(({label:e,name:n})=>({label:e,value:n}))||[],{label:"Custom",value:"custom"}],I=async e=>{await t.setFieldValue("cloudInit",e[0])},h=async()=>{await t.setFieldValue("cloudInit",null)};return i.jsxs(c.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[i.jsx(c.Select,{label:"Instance type",required:!0,disabled:d,options:f,...t.getFieldProps("instanceType"),error:l(t,"instanceType")}),t.values.instanceType==="custom"&&i.jsxs(i.Fragment,{children:[i.jsx(c.Input,{label:"Instance name",type:"text",required:!0,...t.getFieldProps("instanceName"),error:l(t,"instanceName")}),i.jsx(c.Input,{label:"rootfs URL",type:"text",required:!0,...t.getFieldProps("rootfs"),error:l(t,"rootfs")})]}),i.jsx(B,{label:"cloud-init",accept:".yaml",...t.getFieldProps("cloudInit"),onFileRemove:h,onFileUpload:I,help:"You can use a cloud-init configuration YAML file under 1MB to register new WSL instances. cloud-init streamlines the setup by automating installation and configuration tasks.",error:l(t,"cloudInit")}),i.jsx(j,{submitButtonDisabled:t.isSubmitting,submitButtonText:"Create",submitButtonAriaLabel:"Create new WSL instance"})]})};export{J as default};
