const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D3X5K3JU.js","assets/index-BYYwtqOb.js","assets/index-Da3lfBeW.css","assets/SidePanelFormButtons-COrpH7DO.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/MultiSelectField-BLoYGbVd.js","assets/MultiSelectField-DOBW8uWL.css","assets/TablePagination-DWPTC5u3.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-B645fm9D.js","assets/helpers-CfKUy-Wc.js","assets/HeaderWithSearch-Bg5cwKr-.js","assets/HeaderWithSearch-DQybm8h_.css","assets/NoData-CGwk0mn8.js","assets/index-Bfw5elNB.js","assets/InfoItem-Cti4fCWB.js","assets/InfoItem-C-lWh_lY.css"])))=>i.map(i=>d[i]);
import{d as Y,c as X,e as j,f as v,v as F,k as T,i as S,l as J,m as Z,n as x,x as ee,j as e,h as n,r as y,_ as q,w as se,g as re,s as w,E as oe}from"./index-BYYwtqOb.js";import{T as te}from"./TablePagination-DWPTC5u3.js";import{S as ne}from"./SidePanelFormButtons-COrpH7DO.js";import{g as ae,r as D,U as E,a as ie}from"./helpers-CfKUy-Wc.js";import{u as K}from"./usePageParams-B645fm9D.js";import{H as ue}from"./HeaderWithSearch-Bg5cwKr-.js";import{N as ce}from"./NoData-CGwk0mn8.js";function A(){const r=Y(),t=X(),i=(o,p={})=>v({queryKey:["users",{...o}],queryFn:()=>r.get("users",{params:o}),...p}),c=j({mutationKey:["users","new"],mutationFn:o=>r.post("users",o),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),l=j({mutationKey:["users","edit"],mutationFn:o=>r.put("users",o),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),d=j({mutationKey:["users","remove"],mutationFn:o=>r.delete("users",{params:o}),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),g=j({mutationKey:["users","lock"],mutationFn:o=>r.post("users/lock",o),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),h=j({mutationKey:["users","unlock"],mutationFn:o=>r.post("users/unlock",o),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),b=(o,p={})=>v({queryKey:["groups",o.computer_id],queryFn:()=>r.get(`computers/${o.computer_id}/groups`),...p}),a=(o,p={})=>v({queryKey:["userGroups",o.computer_id,o.username],queryFn:()=>r.get(`computers/${o.computer_id}/users/${o.username}/groups`),...p}),m=j({mutationKey:["groups","add"],mutationFn:o=>r.post(`computers/${o.computer_id}/usergroups/update_bulk`,o),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),s=j({mutationKey:["groups","remove"],mutationFn:o=>r.post(`computers/${o.computer_id}/usergroups/update_bulk`,o),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})});return{getUsersQuery:i,getGroupsQuery:b,getUserGroupsQuery:a,createUserQuery:c,removeUserQuery:d,editUserQuery:l,lockUserQuery:g,unlockUserQuery:h,addUserToGroupQuery:m,removeUserFromGroupQuery:s}}const le="_actions_1l3g0_1",de={actions:le},M=()=>{const{instanceId:r}=F(),t=T(),{closeSidePanel:i}=S(),{createUserQuery:c,getGroupsQuery:l}=A(),d=Number(r),{mutateAsync:g}=c,{data:h,isLoading:b}=l({computer_id:d}),m=((h==null?void 0:h.data.groups)??[]).map(o=>({label:o.name,value:o.name})),s=J({initialValues:{name:"",username:"",password:"",confirmPassword:"",requirePasswordReset:!1,location:"",homePhoneNumber:"",workPhoneNumber:"",primaryGroupValue:""},validationSchema:Z().shape({name:x().required("This field is required"),username:x().required("This field is required"),password:x().required("This field is required"),confirmPassword:x().required("This field is required").oneOf([ee("password"),""],"Passwords must match"),location:x(),homePhoneNumber:x(),workPhoneNumber:x(),primaryGroupValue:x().required("This field is required")}),onSubmit:async o=>{try{await g({computer_ids:[d],name:o.name,username:o.username,password:o.password,require_password_reset:o.requirePasswordReset,location:o.location,home_phone:o.homePhoneNumber,work_phone:o.workPhoneNumber,primary_groupname:o.primaryGroupValue}),i()}catch(p){t(p)}}});return e.jsxs(n.Form,{noValidate:!0,onSubmit:s.handleSubmit,name:"add-new-user",children:[e.jsx(n.Input,{type:"text",label:"Username",autoComplete:"new-username",required:!0,error:s.touched.username&&s.errors.username?s.errors.username:void 0,...s.getFieldProps("username")}),e.jsx(n.Input,{type:"text",label:"Name",required:!0,error:s.touched.name&&s.errors.name?s.errors.name:void 0,...s.getFieldProps("name")}),e.jsx(n.Input,{type:"password",label:"Passphrase",autoComplete:"new-password",required:!0,error:s.touched.password&&s.errors.password?s.errors.password:void 0,...s.getFieldProps("password")}),e.jsx(n.Input,{type:"password",label:"Confirm passphrase",autoComplete:"new-password",required:!0,error:s.touched.confirmPassword&&s.errors.confirmPassword?s.errors.confirmPassword:void 0,...s.getFieldProps("confirmPassword")}),e.jsx(n.Input,{type:"checkbox",label:"Require passphrase reset",help:"User must change password at first login",...s.getFieldProps("requirePasswordReset"),checked:s.values.requirePasswordReset}),e.jsx(n.Select,{label:"Primary Group",disabled:b,options:[{label:"Select",value:""},...m],...s.getFieldProps("primaryGroupValue"),error:s.touched.primaryGroupValue&&s.errors.primaryGroupValue?s.errors.primaryGroupValue:void 0}),e.jsx(n.Input,{type:"text",label:"Location",error:s.touched.location&&s.errors.location?s.errors.location:void 0,...s.getFieldProps("location")}),e.jsx(n.Input,{type:"text",label:"Home phone",error:s.touched.homePhoneNumber&&s.errors.homePhoneNumber?s.errors.homePhoneNumber:void 0,...s.getFieldProps("homePhoneNumber")}),e.jsx(n.Input,{type:"text",label:"Work phone",error:s.touched.workPhoneNumber&&s.errors.workPhoneNumber?s.errors.workPhoneNumber:void 0,...s.getFieldProps("workPhoneNumber")}),e.jsx(ne,{submitButtonDisabled:s.isSubmitting,submitButtonText:"Add user"})]})},me=y.lazy(()=>q(()=>import("./index-D3X5K3JU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),pe=({selectedUsers:r,handleClearSelection:t,sidePanel:i=!1})=>{const[c,l]=y.useState(!1),{instanceId:d}=F(),g=T(),{notify:h}=se(),{setSidePanelContent:b,closeSidePanel:a}=S(),{removeUserQuery:m,lockUserQuery:s,unlockUserQuery:o}=A(),{mutateAsync:p,isPending:I}=m,{mutateAsync:k,isPending:_}=s,{mutateAsync:N,isPending:f}=o,U=Number(d),u=r.length===1?r[0]:void 0,{locked:B,unlocked:Q}=ae(r),C=async(P,L)=>{try{await P({computer_ids:[U],usernames:ie(r),delete_home:L==="removed"?c:void 0}),t&&t(),a(),h.success({message:`Successfully requested to be ${L}`})}catch(W){g(W)}},G=async()=>{await C(k,"locked")},V=async()=>{await C(N,"unlocked")},H=async()=>{await C(p,"removed")},R=()=>{b("Add new user",e.jsx(M,{}))},O=P=>{b("Edit user",e.jsx(y.Suspense,{fallback:e.jsx(w,{}),children:e.jsx(me,{user:P})}))},z=()=>{l(P=>!P)};return e.jsxs("div",{className:re("p-panel__controls u-no-padding--top",{"u-no-margin--left":i}),children:[!i&&e.jsxs(n.Button,{className:"u-no-margin--right",type:"button",hasIcon:!0,onClick:R,children:[e.jsx(n.Icon,{name:n.ICONS.plus}),e.jsx("span",{children:"Add user"})]}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[((u==null?void 0:u.enabled)||!i)&&e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:Q===0,"aria-disabled":Q===0,confirmationModalProps:{title:`Lock ${u?`user ${u.username}`:`${r.length} users`}`,children:D({user:u,selectedUsers:r,userAction:E.Lock}),confirmButtonLabel:"Lock",confirmButtonAppearance:"positive",confirmButtonLoading:_,confirmButtonDisabled:_,onConfirm:G},children:[e.jsx(n.Icon,{name:"lock-locked"}),e.jsx("span",{children:"Lock"})]}),(!(u!=null&&u.enabled)||!i)&&e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:B===0,"aria-disabled":B===0,confirmationModalProps:{title:`Unlock ${u?`user ${u.username}`:`${r.length} users`}`,children:D({user:u,selectedUsers:r,userAction:E.Unlock}),confirmButtonLabel:"Unlock",confirmButtonAppearance:"positive",confirmButtonLoading:f,confirmButtonDisabled:f,onConfirm:V},children:[e.jsx(n.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlock"})]}),i&&u&&e.jsxs(n.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>O(u),children:[e.jsx(n.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:r.length===0,"aria-disabled":r.length===0,confirmationModalProps:{title:`Delete ${u?u.username:"users"}`,children:e.jsxs("div",{children:[e.jsx("p",{className:"u-no-margin--bottom",children:u?`This will delete user ${u.username}. You can delete this user's home folders at the same time.`:"This will delete selected users. You can delete their home folders as well."}),e.jsx(n.Input,{label:"Delete the home folders as well",type:"checkbox",checked:c,onChange:z})]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonLoading:I,confirmButtonDisabled:I,onConfirm:H},children:[e.jsx(n.Icon,{name:n.ICONS.delete}),e.jsx("span",{children:"Delete"})]})]})})]})},he=(r,t)=>r.filter(i=>t.includes(i.uid)),ge=({selected:r,handleClearSelection:t,users:i})=>{const{setPageParams:c}=K(),l=d=>{c({search:d}),t()};return e.jsx(ue,{onSearch:l,actions:e.jsx("div",{className:de.actions,children:e.jsx(pe,{handleClearSelection:t,selectedUsers:he(i,r)})})})},be="_status_1or9p_1",ye="_actions_1or9p_7",$={status:be,actions:ye},xe=({column:r})=>{const t={};switch(r.id){case"username":t.role="rowheader";break;case"enabled":t["aria-label"]="Status";break;case"uid":t["aria-label"]="User id";break;case"name":t["aria-label"]="Full name";break}return t},je=y.lazy(()=>q(()=>import("./index-D3X5K3JU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),fe=y.lazy(()=>q(()=>import("./index-Bfw5elNB.js"),__vite__mapDeps([16,1,2,17,18,15,8,9,10,11,3,4,5,12,13,14]))),ke=({users:r,selected:t,setSelected:i})=>{const{setSidePanelContent:c}=S(),l=a=>{c("Edit user",e.jsx(y.Suspense,{fallback:e.jsx(w,{}),children:e.jsx(je,{user:a})}))},d=a=>{c("User details",e.jsx(y.Suspense,{fallback:e.jsx(w,{}),children:e.jsx(fe,{user:a})}))},g=()=>{i(t.length!==0?[]:r.map(({uid:a})=>a))},h=a=>{t.includes(a)?i(t.filter(m=>m!==a)):i([...t,a])},b=y.useMemo(()=>[{accessor:"username",Header:e.jsxs(e.Fragment,{children:[e.jsx(n.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:g,checked:r.length>0&&t.length===r.length,indeterminate:t.length>0&&t.length<r.length}),e.jsx("span",{children:"username"})]}),Cell:({row:a})=>e.jsxs(e.Fragment,{children:[e.jsx(n.CheckboxInput,{inline:!0,label:e.jsxs("span",{className:"u-off-screen",children:["Select user ",a.original.username]}),checked:t.includes(a.original.uid),onChange:()=>h(a.original.uid)}),e.jsx(n.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>d(a.original),"aria-label":`Show details of user ${a.original.username}`,children:a.original.username})]})},{Header:"status",accessor:"enabled",sortType:"basic",Cell:({row:a})=>e.jsx("div",{className:$.status,children:a.original.enabled?e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlocked"})]}):e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{name:"lock-locked-active"}),e.jsx("span",{children:"Locked"})]})})},{Header:"UID",accessor:"uid",sortType:"basic"},{Header:"Full Name",accessor:"name",sortType:"basic",Cell:({row:a})=>a.original.name||e.jsx(ce,{})},{accessor:"actions",className:$.actions,Cell:({row:a})=>e.jsx(n.Tooltip,{message:"Edit",position:"btm-center",children:e.jsx(n.Button,{type:"button",small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Edit ${a.original.name} profile`,onClick:()=>l(a.original),children:e.jsx(n.Icon,{name:"edit",className:"u-no-margin--left"})})})}],[r]);return e.jsx(n.ModularTable,{columns:b,data:r,emptyMsg:"No users available",sortable:!0,initialSortDirection:"ascending",initialSortColumn:"username",getCellProps:xe})},_e=(r,t)=>r?t.filter(({username:i,name:c})=>{const l=c==null?void 0:c.toUpperCase().includes(r.toUpperCase()),d=i.toUpperCase().includes(r.toUpperCase());return l||d}):t,Pe=1e3,Ue=()=>{const[r,t]=y.useState([]),{instanceId:i,childInstanceId:c}=F(),{search:l,currentPage:d,pageSize:g}=K(),{setSidePanelContent:h}=S(),{getUsersQuery:b}=A(),a=Number(c??i),{data:m,isLoading:s}=b({computer_id:a,limit:Pe}),o=(m==null?void 0:m.data.results)??[],p=y.useMemo(()=>_e(l,o),[l,o]),k=((f,U)=>p.slice(U,U+f))(g,(d-1)*g),_=()=>{t([])},N=()=>{h("Add new user",e.jsx(M,{}))};return e.jsxs(e.Fragment,{children:[s&&e.jsx(w,{}),!s&&(!m||m.data.results.length===0)&&e.jsx(oe,{title:"No users found",body:"Add new users by clicking the button below",icon:"connected",cta:[e.jsx(n.Button,{type:"button",appearance:"positive",onClick:N,children:"Add user"},"empty-state-add-new-user")]}),(l||!s&&p.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{selected:r,handleClearSelection:_,users:k}),e.jsx(ke,{selected:r,setSelected:f=>t(f),users:k})]}),e.jsx(te,{handleClearSelection:_,totalItems:p.length,currentItemCount:k.length})]})},qe=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));export{pe as U,qe as i,A as u};
