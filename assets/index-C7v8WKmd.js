import{r as h,j as e,g,e as _,b as I,c as f,d as C,o as y,q as F,p as k,m as N,n as S,E as H}from"./index-xYBbIcB9.js";import{T as P}from"./TablePagination-uK77CSDZ.js";import{H as E}from"./HeaderWithSearch-E55KOAJX.js";import{u as T}from"./usePageParams-BPqOE3H2.js";import{T as D}from"./TableFilterChips-DwpzAZz0.js";import"./TablePaginationBase-Cei9bSVz.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="2fada369-7b64-4e53-ba63-dda5b8db8fd5",s._sentryDebugIdIdentifier="sentry-dbid-2fada369-7b64-4e53-ba63-dda5b8db8fd5")}catch{}const M=({processes:s,selectedPids:t,setSelectedPids:o})=>{const c=()=>{o(t.length===0?s.map(({pid:n})=>n):[])},r=h.useMemo(()=>[{accessor:"name",Header:e.jsxs(e.Fragment,{children:[e.jsx(g.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all processes"}),checked:t.length>0&&t.length===s.length,disabled:s.length===0,onChange:c,indeterminate:t.length>0&&t.length<s.length}),e.jsx("span",{children:"Command"})]}),Cell:({row:n})=>e.jsxs(e.Fragment,{children:[e.jsx(g.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:`Select process ${n.original.name}`}),checked:t.includes(n.original.pid),onChange:()=>{o(t.includes(n.original.pid)?t.filter(i=>i!==n.original.pid):[...t,n.original.pid])}}),e.jsx("span",{children:n.original.name})]})},{accessor:"state",Header:"State"},{accessor:"vm_size",Header:"VM size"},{accessor:"cpu_utilization",Header:"CPU (%)",Cell:({row:n})=>e.jsxs(e.Fragment,{children:[(100*n.original.cpu_utilisation).toFixed(1),"%"]})},{accessor:"pid",Header:"PID"},{accessor:"start_time",Header:"Started at"},{accessor:"gid",Header:"Group"}],[s,t]);return e.jsx(g.ModularTable,{columns:r,data:s,emptyMsg:"No processes found"})};function x(){const s=_(),t=I(),o=(n,i={})=>{if(!n)throw new Error("Missing required parameters");const{computer_id:l,...d}=n;return C({queryKey:["processes",n],queryFn:()=>s.get(`/computers/${l}/processes`,{params:d}),...i})},c=f({mutationFn:n=>s.post("processes/terminate",n),onSuccess:()=>t.invalidateQueries({queryKey:["processes"]})}),r=f({mutationFn:n=>s.post("processes/kill",n),onSuccess:()=>t.invalidateQueries({queryKey:["processes"]})});return{getProcessesQuery:o,killProcessQuery:r,terminateProcessQuery:c}}const Q="_actions_1l3g0_1",q={actions:Q},v=({selectedPids:s,handleClearSelection:t})=>{const{instanceId:o}=y(),{notify:c}=F(),r=k(),{killProcessQuery:n,terminateProcessQuery:i}=x(),l=Number(o),{mutateAsync:d}=i,{mutateAsync:a}=n,m=async()=>{try{await d({pids:s,computer_id:l}),c.success({message:`${s.length===1?"Process":"Processes"} successfully ended`}),t()}catch(u){r(u)}},p=async()=>{try{await a({pids:s,computer_id:l}),c.success({message:`${s.length===1?"Process":"Processes"} successfully killed`}),t()}catch(u){r(u)}};return e.jsxs(e.Fragment,{children:[e.jsx(E,{actions:e.jsx("div",{className:N("p-segmented-control",q.actions),children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsx(g.Button,{type:"button",className:"p-segmented-control__button u-no-margin--bottom",disabled:s.length===0,onClick:m,children:"End process"}),e.jsx(g.Button,{type:"button",className:"p-segmented-control__button u-no-margin--bottom",disabled:s.length===0,onClick:p,children:"Kill process"})]})}),afterSearch:t}),e.jsx(D,{filtersToDisplay:["search"]})]})},B=()=>{const[s,t]=h.useState([]),{instanceId:o,childInstanceId:c}=y(),{search:r,currentPage:n,pageSize:i}=T(),{getProcessesQuery:l}=x(),d=Number(c??o),{data:a,isLoading:m}=l({computer_id:d,limit:i,offset:(n-1)*i,search:r}),p=(a==null?void 0:a.data.count)??0,u=h.useMemo(()=>(a==null?void 0:a.data.results)??[],[a]),b=()=>{t([])};return e.jsxs(e.Fragment,{children:[!r&&m&&e.jsx(S,{}),!m&&!r&&(!a||a.data.results.length===0)&&e.jsx(H,{icon:"connected",title:"No processes running"}),(r||!m&&a&&a.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(v,{handleClearSelection:b,selectedPids:s}),e.jsx(M,{processes:u,setSelectedPids:j=>t(j),selectedPids:s})]}),e.jsx(P,{handleClearSelection:b,totalItems:p,currentItemCount:u.length})]})};export{B as default};
