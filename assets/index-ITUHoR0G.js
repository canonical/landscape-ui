const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B1VB5AI2.js","assets/index-DM-5oHlz.js","assets/index-BwHlIK4o.css","assets/SelectAllButton-Pr0SlCLM.js","assets/ExpandableTableFooter-DY7GGslB.js","assets/ExpandableTableFooter-DWm8zyWg.css","assets/usePackages-3-Ma5mzl.js","assets/useFetchOld-BNSMcAIO.js","assets/usePackages-D2X0CFCl.css","assets/usePageParams-CQNbyqOJ.js","assets/index-opcF9JuM.css","assets/index-7gLeGwxh.js","assets/index-DXCgn1fK.css","assets/index-CLKiXd68.js","assets/UsnList-CxvA_9t-.js","assets/NoData-DE1XHMtF.js","assets/TablePagination-D_ICigW5.js","assets/TablePaginationBase-CNcqrm_X.js","assets/TablePaginationBase-CJl3HN1X.css","assets/TruncatedCell-BHFxK405.js","assets/TruncatedCell-CoXbu3VM.css","assets/helpers-BOhsSvkH.js","assets/helpers-CCHFURK6.css","assets/UsnList-B4hAwQmb.css"])))=>i.map(i=>d[i]);
import{j as e,m as E,h as g,r,t as o,k as x,l as v,_ as u,p as A,q as T,f as L,s as D,g as b,M as w,n as C}from"./index-DM-5oHlz.js";import{S as V}from"./SidePanelFormButtons-DAFaAJmg.js";import"./usePageParams-CQNbyqOJ.js";import{h,a as N,b as m}from"./helpers-DsR5SCVm.js";import"./InstancesPageActions--5UNTJMG.js";import{a as R,u as B}from"./usePackages-3-Ma5mzl.js";import"./SidePanelFormButtons.module-tJTvEwdD.js";import"./useInstances-BQmj4mE0.js";import"./useFetchOld-BNSMcAIO.js";import"./index-DtV6ZKLC.js";import"./TablePagination-D_ICigW5.js";import"./TablePaginationBase-CNcqrm_X.js";import"./StatusFilter-jUJsCAig.js";import"./TableFilter-BzmomHXW.js";import"./TableFilterChips-B3H_GiL3.js";import"./NoData-DE1XHMtF.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new s.Error().stack;a&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[a]="e228d8ae-95d8-4d71-a675-e745e5b0dbf8",s._sentryDebugIdIdentifier="sentry-dbid-e228d8ae-95d8-4d71-a675-e745e5b0dbf8")}catch{}const F=({instances:s})=>{const a=s.filter(({alerts:i})=>h(i)).length,c=s.filter(({alerts:i})=>N(i)).length,n=s.filter(({alerts:i})=>!m(i)).length;return e.jsxs("div",{children:[e.jsx("span",{children:"You selected "}),e.jsx("span",{children:e.jsx("b",{children:s.length})}),e.jsx("span",{children:" instances:"}),e.jsxs("ul",{className:E({"u-no-margin--bottom":n>0}),children:[a>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Security upgrades are available for "}),e.jsx("b",{children:a}),e.jsx("span",{children:a!==1?" instances":" instance"})]}),c>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Regular upgrades are available for "}),e.jsx("b",{children:c}),e.jsx("span",{children:c!==1?" instances":" instance"})]})]}),n>0&&e.jsxs("p",{children:[e.jsx("span",{children:"No upgrades for "}),e.jsx("span",{children:e.jsx("b",{children:n})}),e.jsx("span",{children:n!==1?" instances needed.":" instance needed."})]})]})},k=[{id:"tab-link-instances",label:"Instances"},{id:"tab-link-packages",label:"Packages"},{id:"tab-link-usns",label:"USNs"}],p={instances:r.lazy(()=>u(()=>import("./index-B1VB5AI2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),packages:r.lazy(()=>u(()=>import("./index-7gLeGwxh.js"),__vite__mapDeps([11,1,2,6,7,8,9,3,4,5,12]))),usns:r.lazy(()=>u(()=>import("./index-CLKiXd68.js"),__vite__mapDeps([13,1,2,14,9,3,4,5,15,16,17,18,19,20,6,7,8,21,22,23])))},$=g().shape({excludedPackages:o().of(g().shape({id:v().required(),exclude_packages:o().of(x())})),excludedUsns:o().of(x())}),q=({activeTabLinkId:s,onTabLinkClick:a,withUsnsTab:c})=>k.filter(({id:n})=>c||n!=="tab-link-usns").map(({id:n,label:i})=>({id:n,label:i,active:n===s,onClick:()=>a(n),role:"tab"})),O=s=>({excludedPackages:s.map(({id:a})=>({id:a,exclude_packages:[]})),excludedUsns:[]}),ie=({selectedInstances:s})=>{const[a,c]=r.useState(k[0].id),n=s.filter(({alerts:t})=>m(t)),i=n.filter(({alerts:t})=>h(t)),f=A(),{notify:j}=T(),{closeSidePanel:_}=L(),{upgradeInstancesPackagesQuery:y}=R(),{upgradeUsnsQuery:P}=B(),{mutateAsync:U}=y,{mutateAsync:S}=P,I=async t=>{try{a==="tab-link-usns"?await S({computers:i.map(({id:l})=>({id:l,exclude_usns:t.excludedUsns}))}):await U({computers:t.excludedPackages}),_(),j.success({title:"You queued packages to be upgraded",message:`Packages on ${s.length} ${s.length!==1?"instances":"instance"} will be upgraded and are queued in Activities`})}catch(l){f(l)}},d=D({initialValues:O(n),onSubmit:I,validationSchema:$});return e.jsxs(b.Form,{onSubmit:d.handleSubmit,children:[e.jsx(F,{instances:s}),e.jsx(b.Tabs,{links:q({activeTabLinkId:a,onTabLinkClick:t=>c(t),withUsnsTab:i.length>0})}),e.jsx(w,{children:e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":a,children:e.jsxs(r.Suspense,{fallback:e.jsx(C,{}),children:[a==="tab-link-instances"&&e.jsx(p.instances,{excludedPackages:d.values.excludedPackages,instances:n,onExcludedPackagesChange:t=>d.setFieldValue("excludedPackages",t)}),a==="tab-link-packages"&&e.jsx(p.packages,{excludedPackages:d.values.excludedPackages,instances:n,onExcludedPackagesChange:t=>d.setFieldValue("excludedPackages",t)}),a==="tab-link-usns"&&e.jsx(p.usns,{excludedUsns:d.values.excludedUsns,instances:i,onExcludedUsnsChange:t=>d.setFieldValue("excludedUsns",t)})]})})}),e.jsx(V,{submitButtonDisabled:d.isSubmitting,submitButtonText:"Upgrade"})]})};export{ie as Upgrades};
