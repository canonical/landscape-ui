const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CSwfyG3_.js","assets/index-BTMs-AKI.js","assets/index-BGd_Cbys.css","assets/UdebCheckboxInput-oQrQPdfd.js","assets/UdebCheckboxInput-mCgCMP_S.css","assets/debug-Dc5EcUei.js","assets/useGPGKeys-CqISWO4-.js","assets/debug-CHNhm1j1.css","assets/MultiSelectField-DNxZOgBr.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-Dl2Ln5wW.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/constants-CT9L0Hm6.js","assets/constants-DdYMScrr.css"])))=>i.map(i=>d[i]);
import{r as d,j as e,n as c,ah as ie,a6 as de,A as ue,m as ge,o as F,x as me,p as A,$ as fe}from"./index-BTMs-AKI.js";import{S as pe}from"./SidePanelTablePagination-n5_ZX9UB.js";import{f as he}from"./constants-CT9L0Hm6.js";const Pe="_version_sfav3_1",ke="_content_sfav3_5",Q={version:Pe,content:ke},xe=({isUpload:o,packagesToShow:n,search:s,selectedPackages:r,setSelectedPackages:m})=>{const u=d.useMemo(()=>[{accessor:"packageName",Header:({rows:a})=>o?e.jsxs(e.Fragment,{children:[e.jsx(c.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),disabled:!a.length,indeterminate:!!r.length&&r.length<a.length,checked:r.length===a.length&&!!r.length,onChange:()=>{m(i=>i.length?[]:a.map((h,x)=>x))}}),e.jsx("span",{children:"Package"})]}):"Package",Cell:({row:a})=>o?e.jsx(c.CheckboxInput,{inline:!0,label:a.original.packageName,checked:r.includes(a.index),onChange:()=>{m(i=>i.includes(a.index)?i.filter(h=>h!==a.index):[...i,a.index])}}):a.original.packageName},{accessor:"packageVersion",Header:"Version",getCellIcon:({row:a})=>a.original.difference?"warning":!1,className:Q.version,Cell:({row:a})=>a.original.difference?e.jsx(c.Tooltip,{position:"top-center",message:a.original.difference==="delete"?"Package deleted":`Version differs
from parent pocket.
Parent version:
${a.original.newVersion}`,children:e.jsx("span",{children:a.original.packageVersion})}):a.original.packageVersion}],[n,r.length]);return e.jsx(c.ModularTable,{columns:u,data:n,emptyMsg:s?`No packages found with the search: "${s}".`:void 0,className:Q.content,getCellProps:({column:a})=>{switch(a.id){case"packageName":return{role:"rowheader"};case"packageVersion":return{"aria-label":"Version"};default:return{}}}})},je="_ctaRow_qlsck_1",be={ctaRow:je},ye=d.lazy(async()=>fe(()=>import("./index-CSwfyG3_.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),k=1,H=20,Ce=({distributionName:o,pocket:n,seriesName:s})=>{const[r,m]=d.useState(k),[u,a]=d.useState(H),[i,h]=d.useState([]),{value:x,setTrue:O}=ie(),[v,D]=d.useState(""),[j,_]=d.useState(""),[R,U]=d.useState([]),B=de("(max-width: 619px)"),T=ue(),{setSidePanelContent:q,closeSidePanel:K}=ge(),{listPocketQuery:G,diffPullPocketQuery:J,pullPackagesToPocketQuery:W,syncMirrorPocketQuery:X,removePackagesFromPocketQuery:Y,removePocketQuery:Z}=he(),{mutate:N,isPending:E}=X,{mutate:ee,isPending:M}=W,ne=()=>{n.mode==="mirror"?N({name:n.name,series:s,distribution:o}):n.mode==="pull"&&ee({name:n.name,series:s,distribution:o})},ae=()=>{q(`Edit ${n.name} pocket`,e.jsx(d.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(ye,{pocket:n,distributionName:o,seriesName:s})}))},{mutateAsync:te,isPending:S}=Z,oe=async()=>{try{await te({distribution:o,series:s,name:n.name}),K()}catch(t){T(t)}},{mutateAsync:se,isPending:b}=Y,z=!E&&!M&&!b&&!S,{data:C,isLoading:I}=G({name:n.name,series:s,distribution:o,search:j,limit:u,offset:r*u-u},{enabled:z}),$=(C==null?void 0:C.data)??{count:0,results:[]},f=$.results.map(t=>({packageName:t.name,packageVersion:t.version})),{data:y}=J({name:n.name,series:s,distribution:o},{enabled:n.mode==="pull"&&!I&&z});d.useEffect(()=>{const t=(y==null?void 0:y.data)??{},l=[];for(const g in t){const p={add:[],update:[],delete:[],...t[g]};for(const[P,V]of p.add)l.push({packageName:P,newVersion:V,difference:"add"});(p.update.length||p.delete.length)&&O();for(const[P,,V]of p.update)l.push({packageName:P,newVersion:V,difference:"update"});for(const[P]of p.delete)l.push({packageName:P,difference:"delete",newVersion:""})}U(l)},[y]);const ce=()=>x?(f.forEach((t,l)=>{const g=R.find(({packageName:p})=>t.packageName===p);g&&(f[l].difference=g.difference,g.newVersion!==""&&(f[l].newVersion=g.newVersion))}),[...f.filter(({difference:t})=>t),...f.filter(({difference:t})=>!t)]):f,L=d.useMemo(()=>ce(),[r,u,j,x,f.length,R.length]),le=async()=>{const t=L.filter((l,g)=>i.includes(g)).map(({packageName:l})=>l);try{await se({name:n.name,series:s,distribution:o,packages:t})}catch(l){T(l)}},w=!j&&r===k&&u===H&&!$.count,re=n.mode==="upload"?{size:8,medium:4}:{size:6,medium:3};return e.jsxs(e.Fragment,{children:[e.jsxs(c.Row,{className:F("u-no-padding--left u-no-padding--right",be.ctaRow),children:[e.jsx(c.Col,{...re,children:e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[n.mode!=="upload"&&e.jsx(c.Button,{className:"p-segmented-control__button",type:"button",onClick:ne,disabled:E&&M,"aria-label":n.mode==="mirror"?`Synchronize ${n.name} pocket of ${o}/${s}`:`Pull packages to ${n.name} pocket of ${o}/${s}`,children:n.mode==="mirror"?"Sync":"Pull"}),e.jsx(c.Button,{className:"p-segmented-control__button",type:"button",onClick:ae,"aria-label":`Edit ${n.name} pocket of ${o}/${s}`,children:"Edit"}),e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button",type:"button","aria-label":`Remove ${n.name} pocket of ${o}/${s}`,confirmationModalProps:{title:"Deleting pocket",children:e.jsxs("p",{children:["Do you really want to delete ",n.name," pocket from"," ",s," series of ",o," distribution?"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:S,confirmButtonLoading:S,onConfirm:oe},children:"Remove"}),n.mode==="upload"&&e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:!i.length||b,"aria-label":`Remove selected packages from ${n.name} pocket of ${o}/${s}`,confirmationModalProps:{title:"Deleting packages from pocket",children:e.jsxs("p",{children:["This will delete ",i.length," selected"," ",me(i.length,"package")," from"," ",n.name," pocket ",s," series of"," ",o," distribution"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:b,confirmButtonLoading:b,onConfirm:le},children:"Remove packages"})]})})}),n.mode!=="upload"&&!w&&e.jsx(c.Col,{size:6,medium:3,children:e.jsx(c.Form,{onSubmit:t=>{t.preventDefault(),_(v),m(k)},noValidate:!0,children:e.jsx(c.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,"aria-label":"Package search",onChange:t=>{D(t)},value:v,onClear:()=>{D(""),_(""),m(k)},className:F({"is-dense":!B,"u-no-margin--bottom":B}),onSearch:()=>{_(v),m(k)},autocomplete:"off"})})})]}),I?e.jsx(A,{}):w?e.jsx("p",{children:"No packages found"}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{isUpload:n.mode==="upload",packagesToShow:L,search:j,selectedPackages:i,setSelectedPackages:h}),e.jsx(pe,{currentPage:r,totalItems:$.count,paginate:t=>{h([]),m(t)},pageSize:u,setPageSize:t=>{a(t)}})]})]})};export{Ce as default};
