import{r as d,W as h,j as s,H as x,h as p,d as b,f,y as v,t as C}from"./index-CPTwPS4O.js";import{P as E,a as j,b as w}from"./PageMain-B0F_OruQ.js";import{h as y}from"./moment-C5S46NFB.js";import{T as P}from"./TruncatedCell-CF010OW7.js";import"./moment-D6mwQti5.js";import{a as R}from"./helpers-B4Ea794_.js";import{u as _}from"./usePageParams-CUhpjrHp.js";import{H}from"./HeaderWithSearch-Dj52wW-o.js";import{T as L}from"./TablePagination-CmvzfKx-.js";import"./TablePagination.module-CgQ3jx4B.js";const T="_message_1po57_1",S="_expandedCell_1po57_5",F="_expandedRow_1po57_10",u={message:T,expandedCell:S,expandedRow:F},M=o=>({index:t})=>{const n={};return o===t&&(n.className=u.expandedRow),n},I=o=>({column:t,row:{index:n}})=>{const e={};return t.id==="creation_time"?e.role="rowheader":t.id==="person_name"?e["aria-label"]="username":t.id==="entity_type"?e["aria-label"]="entity type":t.id==="entity_name"?e["aria-label"]="entity name":t.id==="message"&&(e["aria-label"]="message",o===n&&(e.className=u.expandedCell)),e},N=({eventsLog:o})=>{const[t,n]=d.useState(""),[e,l]=d.useState(-1),i=d.useRef([]);h({current:e!==-1?i.current[e]:null},()=>l(-1));const r=d.useMemo(()=>[{accessor:"creation_time",Header:"creation time",Cell:({row:a})=>s.jsx(s.Fragment,{children:y(a.original.creation_time).format(x)})},{accessor:"person_name",Header:"username",Cell:({row:a})=>s.jsx(s.Fragment,{children:a.original.person_name})},{accessor:"entity_type",Header:"entity type",Cell:({row:a})=>s.jsx(s.Fragment,{children:a.original.entity_type})},{accessor:"entity_name",Header:"entity name",Cell:({row:a})=>s.jsx(s.Fragment,{children:a.original.entity_name})},{accessor:"message",className:u.message,Header:"event log message",Cell:({row:{original:a,index:c}})=>s.jsx(P,{content:a.message,isExpanded:c===e,onExpand:()=>{n(""),l(t?c-1:c)}})}],[o,e]);return s.jsx("div",{ref:R(i),children:s.jsx(p.ModularTable,{getCellProps:I(e),getRowProps:M(e),columns:r,data:o,sortable:!0,emptyMsg:"No events found"})})},k="_container_1d6rw_1",D="_searchContainer_1d6rw_8",Y="_select_1d6rw_12",A={container:k,searchContainer:D,select:Y},g={days:{slug:"days",label:"Days",type:"select",options:[{label:"1 day",value:"1"},{label:"7 days",value:"7"},{label:"30 days",value:"30"},{label:"90 days",value:"90"},{label:"180 days",value:"180"},{label:"365 days",value:"365"}]}},O=()=>{const{days:o,setPageParams:t}=_(),n=l=>{t({search:l})},e=l=>{t({days:l.target.value})};return s.jsx(H,{onSearch:n,actions:s.jsx(p.Select,{wrapperClassName:A.select,label:g.days.label,labelClassName:"u-no-margin--bottom",options:g.days.options,value:o,onChange:e})})};function $(){const o=b();return{getEventsLog:(n,e={})=>f({queryKey:["events",n],queryFn:()=>o.get("events",{params:n}),...e})}}const B=(o,t)=>{const n=["creation_time","person_id","person_name","entity_type","entity_id","entity_name","message"],l=[["Creation Time","Person ID","Person Name","Entity Type","Entity ID","Entity Name","Message"].join(","),...o.map(c=>n.map(m=>c[m]).join(","))].join(`\r
`),i=new Blob([l],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(i),a=document.createElement("a");a.href=r,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)},X=()=>{const{days:o,search:t,currentPage:n,pageSize:e}=_(),{user:l}=v(),{getEventsLog:i}=$(),{data:r,isLoading:a}=i({days:Number(o),limit:e,offset:(n-1)*e,search:t}),c=d.useMemo(()=>(r==null?void 0:r.data.results.filter(m=>m.message.includes(t)))??[],[r,t]);return s.jsxs(E,{children:[s.jsx(j,{title:"Events log",actions:[s.jsx(p.Button,{type:"button",onClick:()=>B(c,`Event Log - ${l.current_account}-${y().format("YYYY-MM-DDTHH mm ss[Z]")}.csv`),children:"Download as CSV"},"download-as-cv")]}),s.jsxs(w,{children:[s.jsx(O,{}),a&&s.jsx(C,{}),!a&&c&&s.jsx(N,{eventsLog:c}),s.jsx(L,{totalItems:r==null?void 0:r.data.count,currentItemCount:c.length})]})]})};export{X as default};
