const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BHkNRl9-.js","assets/index-DdVy3CIu.js","assets/index-DCq_vsqr.css","assets/SidePanelFormButtons-CKYzlbXP.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/AssociationBlock-DO_p_8Fr.js","assets/MultiSelectField-BiM8Lbq3.js","assets/MultiSelectField-GyNA33om.css","assets/useInstances-uWwQvNUT.js","assets/useFetchOld-CHfQedZ7.js","assets/AssociationBlock-OuvPxND7.css","assets/useAPTSources-L7517z3X.js","assets/useRoles-SNBAHG3A.js","assets/constants-E3Le5af2.js","assets/usePageParams-CcklzBaA.js","assets/NoData-Chqc7NTj.js","assets/index-DTjKue4r.js","assets/TablePagination-DcRP3nto.js","assets/TablePaginationBase-ZnL0qmAy.js","assets/TablePaginationBase-CJl3HN1X.css","assets/StatusFilter-DAfk9Cb4.js","assets/TableFilter-CDgyuP9F.js","assets/TableFilter-CNw_lMaf.css","assets/TableFilterChips-3QiSvy-H.js","assets/TableFilterChips-CHqetGbX.css","assets/index-CRv_aeRB.css","assets/constants-DhXkDRlN.css","assets/tests-DFnZqbNV.js","assets/index-BimGfo9_.css"])))=>i.map(i=>d[i]);
import{b as S,e as A,c as f,d as M,r as p,p as E,f as j,j as e,g as l,n as g,_ as P,E as T}from"./index-DdVy3CIu.js";import{P as w,a as L,b as Q}from"./PageMain-DA_Qn9YT.js";import{u as B}from"./useFetchOld-CHfQedZ7.js";import"./constants-E3Le5af2.js";import{u as O}from"./usePageParams-CcklzBaA.js";import{u as D}from"./useRoles-SNBAHG3A.js";import{N}from"./NoData-Chqc7NTj.js";import{T as k}from"./TableFilterChips-3QiSvy-H.js";import{H}from"./HeaderWithSearch-w77Jjk9W.js";function _(){const o=S(),s=A(),n=B(),r=(t={},a={})=>M({queryKey:["repositoryProfiles",t],queryFn:async()=>s.get("repositoryprofiles",{params:t}),...a}),i=f({mutationFn:async t=>s.post("repositoryprofiles",t),onSuccess:async()=>o.invalidateQueries({queryKey:["repositoryProfiles"]})}),c=f({mutationFn:async({name:t,...a})=>s.put(`repositoryprofiles/${t}`,a),onSuccess:async()=>o.invalidateQueries({queryKey:["repositoryProfiles"]})}),u=f({mutationKey:["repositoryProfiles"],mutationFn:async t=>n.get("RemoveRepositoryProfile",{params:t}),onSuccess:async()=>o.invalidateQueries({queryKey:["repositoryProfiles"]})});return{getRepositoryProfilesQuery:r,createRepositoryProfileQuery:i,editRepositoryProfileQuery:c,removeRepositoryProfileQuery:u}}const I="_toggleButton_bnzrt_1",$="_menu_bnzrt_6",x={toggleButton:I,menu:$},q=p.lazy(()=>P(()=>import("./index-BHkNRl9-.js").then(o=>o.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]))),z=({profile:o})=>{const[s,n]=p.useState(!1),[r,i]=p.useState(""),c=E(),{setSidePanelContent:u}=j(),{removeRepositoryProfileQuery:t}=_(),{mutateAsync:a,isPending:d}=t,b=()=>{u(`Edit ${o.title}`,e.jsx(p.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(q,{action:"edit",profile:o})}))},v=async()=>{try{await a({name:o.name})}catch(m){c(m)}finally{h()}},C=()=>{n(!0)},h=()=>{n(!1)},R=m=>{i(m.target.value)},F=[{children:e.jsxs(e.Fragment,{children:[e.jsx(l.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),"aria-label":`Edit "${o.title}" profile`,hasIcon:!0,onClick:b},{children:e.jsxs(e.Fragment,{children:[e.jsx(l.Icon,{name:l.ICONS.delete}),e.jsx("span",{children:"Remove"})]}),"aria-label":`Remove "${o.title}" repository profile`,hasIcon:!0,onClick:C}];return e.jsxs(e.Fragment,{children:[e.jsx(l.ContextualMenu,{position:"left",className:x.menu,toggleClassName:x.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(l.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${o.title} profile actions`},links:F}),s&&e.jsxs(l.ConfirmationModal,{title:"Remove repository profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:d||r!==`remove ${o.name}`,confirmButtonLoading:d,onConfirm:v,close:h,children:[e.jsxs("p",{children:['This will remove "',o.title,'" profile. This action is irreversible.']}),"Type ",e.jsxs("b",{children:["remove ",o.name]})," to confirm.",e.jsx(l.Input,{type:"text",value:r,onChange:R})]})]})},G=({column:o})=>{const s={};return o.id==="title"?s.role="rowheader":o.id==="description"?s["aria-label"]="Description":o.id==="access_group"?s["aria-label"]="Access group":o.id==="id"&&(s["aria-label"]="Actions"),s},K="_accessGroup_1qgn5_1",V="_description_1qgn5_5",W="_actions_1qgn5_9",y={accessGroup:K,description:V,actions:W},Y=({repositoryProfiles:o})=>{const{search:s}=O(),{getAccessGroupQuery:n}=D(),{data:r}=n(),i=((r==null?void 0:r.data)??[]).map(({name:t,title:a})=>({label:a,value:t})),c=p.useMemo(()=>s?o.filter(t=>t.title.toLowerCase().includes(s.toLowerCase())):o,[o,s]),u=p.useMemo(()=>[{accessor:"title",Header:"Title"},{accessor:"description",Header:"Description",className:y.description,Cell:({row:t})=>t.original.description||e.jsx(N,{})},{accessor:"access_group",Header:"Access group",className:y.accessGroup,Cell:({row:{original:t}})=>{var a;return((a=i.find(({value:d})=>t.access_group===d))==null?void 0:a.label)??t.access_group}},{accessor:"id",className:y.actions,Header:"Actions",Cell:({row:t})=>e.jsx(z,{profile:t.original})}],[c,i]);return e.jsx(l.ModularTable,{columns:u,data:c,getCellProps:G,emptyMsg:`No repository profiles found with the search "${s}"`})},J=()=>e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsx(k,{filtersToDisplay:["search"]})]}),U=p.lazy(()=>P(()=>import("./index-BHkNRl9-.js").then(o=>o.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29])).then(o=>({default:o.RepositoryProfileForm}))),X=()=>{const{setSidePanelContent:o}=j(),{getRepositoryProfilesQuery:s}=_(),{data:n,isLoading:r}=s(),i=(n==null?void 0:n.data.results)??[],c=()=>{o("Add repository profile",e.jsx(p.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(U,{action:"add"})}))};return e.jsxs(w,{children:[e.jsx(L,{title:"Repository profiles",actions:[e.jsx(l.Button,{appearance:"positive",onClick:c,type:"button",children:"Add repository profile"},"new-key-button")]}),e.jsxs(Q,{children:[r&&e.jsx(g,{}),!r&&i.length===0&&e.jsx(T,{title:"No repository profiles found",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You havenâ€™t added any repository profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/manage-repositories-web-portal",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage repositories in Landscape"})]}),cta:[e.jsx(l.Button,{appearance:"positive",onClick:c,type:"button",children:"Add repository profile"},"table-add-new-profile")]}),!r&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(J,{}),e.jsx(Y,{repositoryProfiles:i})]})]})]})},le=Object.freeze(Object.defineProperty({__proto__:null,default:X},Symbol.toStringTag,{value:"Module"}));export{Y as R,J as a,le as i,_ as u};
