import{r as f,a as b,b as P,i as U,j as e,d as h,f as v,R as k,t as _}from"./index-CQs3wXys.js";import{E as $}from"./EmptyState-DNkTeHW1.js";import{u as j}from"./useUsns-PbelDNjT.js";import{T as I}from"./TablePagination-DIiSuGph.js";import{u as L}from"./useConfirm-9PPCxKmU.js";import{U as N}from"./UsnList-BWdRV39e.js";import"./useFetchOld-D-5JyUuM.js";import"./useMutation-D9dT1mhA.js";import"./useQuery-DrwXjJzc.js";import"./moment-DDUBUQL9.js";import"./TruncatedCell-BU0EwnPI.js";import"./ExpandableTableFooter-CeuFA5zV.js";import"./useOnClickOutside-CMkwII5b.js";import"./PageMain-BTzMuvvj.js";const T="_container_viyqm_1",w="_searchContainer_viyqm_5",A="_cta_viyqm_9",C={container:T,searchContainer:w,cta:A},q=({instance:n,onSearch:a,usns:s})=>{const[c,l]=f.useState(""),d=b(),g=P(),{notify:u}=U(),{confirmModal:t,closeConfirmModal:r}=L(),{upgradeUsnPackagesQuery:i}=j(),{mutateAsync:p,isLoading:x}=i,y=()=>{d(`${k}instances/${n.parent?`${n.parent.id}/${n.id}`:n.id}`,{state:{tab:"activities"}}),u.clear()},S=async()=>{try{await p({instanceId:n.id,usns:s}),u.success({title:"You queued packages to be upgraded",message:`Affected packages for ${s.length===1?`"${s[0]}" security issue`:`${s.length} selected security issues`} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:y}]})}catch(m){g(m)}finally{r()}},o=()=>{t({title:"Upgrade affected packages",body:`This will upgrade affected packages for ${s.length===1?`"${s[0]}" security issue`:`${s.length} selected security issues`}.`,buttons:[e.jsx(h.Button,{appearance:"positive",onClick:S,disabled:x,"aria-label":"Upgrade selected packages",children:"Upgrade"},"upgrade")]})};return e.jsxs("div",{className:C.container,children:[e.jsx("div",{className:C.searchContainer,children:e.jsx(h.Form,{onSubmit:m=>{m.preventDefault(),a(c)},noValidate:!0,children:e.jsx(h.SearchBox,{shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:c,onChange:m=>l(m),onSearch:()=>a(c),onClear:()=>{l(""),a("")}})})}),e.jsx("div",{className:v("p-segmented-control",C.cta),children:e.jsxs(h.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:o,disabled:s.length===0,children:[e.jsx(h.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]})})]})},z=({currentPage:n,instance:a,isUsnsLoading:s,onPageChange:c,onPageSizeChange:l,onSearch:d,pageSize:g,search:u,totalUsnCount:t,usns:r})=>{const[i,p]=f.useState([]),x=o=>{c(o),p([])},y=o=>{l(o),p([])},S=o=>{x(1),d(o)};return e.jsxs(e.Fragment,{children:[e.jsx(q,{onSearch:S,instance:a,usns:i.map(({usn:o})=>o)}),e.jsx(N,{tableType:"paginated",instance:a,isUsnsLoading:s,onSelectedUsnsChange:o=>p(o),search:u,selectedUsns:i,usns:r}),r.length>0&&e.jsx(I,{currentPage:n,pageSize:g,paginate:x,setPageSize:y,totalItems:t,currentItemCount:r.length})]})},E=({instance:n})=>{const[a,s]=f.useState(""),[c,l]=f.useState(1),[d,g]=f.useState(20),{getUsnsQuery:u}=j(),{data:t,isLoading:r}=u({computer_ids:[n.id],limit:d,offset:(c-1)*d,search:a,show_packages:!1},{enabled:!!n});return e.jsxs(e.Fragment,{children:[!a&&r&&e.jsx(_,{}),!a&&!r&&(!t||t.data.results.length===0)&&e.jsx($,{icon:"inspector-debug",title:"No security issues found"}),(a||!r&&t&&t.data.results.length>0)&&e.jsx(z,{currentPage:c,instance:n,isUsnsLoading:r,onPageChange:i=>l(i),onPageSizeChange:i=>g(i),onSearch:i=>s(i),pageSize:d,search:a,totalUsnCount:(t==null?void 0:t.data.count)??0,usns:(t==null?void 0:t.data.results)??[]})]})},X=E;export{X as default};
