import{k as q,j as t,s as $,h as i,G as p}from"./index-BYYwtqOb.js";import{h as y}from"./moment-C5S46NFB.js";import{I as s}from"./InfoItem-Cti4fCWB.js";import{u as k,a as C}from"./index-C68HcqAE.js";import{u as O}from"./useInstances-WVnlBmJQ.js";import"./moment-BRVkbQ11.js";import"./TablePagination-DWPTC5u3.js";import"./TablePagination.module-CgQ3jx4B.js";import"./usePageParams-B645fm9D.js";import"./SearchHelpPopup-CQnR1lC2.js";import"./useFetchOld-BTtqmpM9.js";import"./NoData-CGwk0mn8.js";const Y="_statusIcon_1efxa_1",G="_output_1efxa_5",B={statusIcon:Y,output:G},st=({activityId:I})=>{var A,b,h,x,g,_,j;const a=q(),{approveActivitiesQuery:L,cancelActivitiesQuery:D,getSingleActivityQuery:w,redoActivitiesQuery:N,undoActivitiesQuery:P}=k(),{getInstancesQuery:T}=O(),{mutateAsync:z,isPending:r}=L,{mutateAsync:Q,isPending:c}=D,{mutateAsync:R,isPending:l}=N,{mutateAsync:S,isPending:d}=P,{data:u,isLoading:v}=w({activityId:I}),e=u==null?void 0:u.data,{data:m}=T({query:`id:${e==null?void 0:e.computer_id}`,root_only:!1},{enabled:!!(e!=null&&e.computer_id)}),f=m&&m.data.results.length>0?m.data.results[0].title:"",M=async o=>{try{await z({query:`id:${o.id}`})}catch(n){a(n)}},E=async o=>{try{await Q({query:`id:${o.id}`})}catch(n){a(n)}},U=async o=>{try{await R({activity_ids:[o.id]})}catch(n){a(n)}},F=async o=>{try{await S({activity_ids:[o.id]})}catch(n){a(n)}};return t.jsxs(t.Fragment,{children:[v&&t.jsx($,{}),!v&&e&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[((A=e.actions)==null?void 0:A.approvable)&&t.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:r,confirmationModalProps:{title:"Approve activity",children:t.jsxs("p",{children:["Are you sure you want to approve ",e.summary," ","activity?"]}),confirmButtonLabel:"Approve",confirmButtonAppearance:"positive",confirmButtonDisabled:r,confirmButtonLoading:r,onConfirm:()=>M(e)},children:"Approve"}),((b=e.actions)==null?void 0:b.cancelable)&&t.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:c,confirmationModalProps:{title:"Cancel activity",children:t.jsxs("p",{children:["Are you sure you want to cancel ",e.summary," ","activity?"]}),confirmButtonLabel:"Apply",confirmButtonAppearance:"positive",confirmButtonDisabled:c,confirmButtonLoading:c,onConfirm:()=>E(e)},children:!((h=e.actions)!=null&&h.approvable)&&!((x=e.actions)!=null&&x.reappliable)&&!((g=e.actions)!=null&&g.revertable)?"Cancel activity":"Cancel"}),((_=e.actions)==null?void 0:_.revertable)&&t.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:d,confirmationModalProps:{title:"Undo activity",children:t.jsxs("p",{children:["Are you sure you want to undo ",e.summary," ","activity?"]}),confirmButtonLabel:"Undo",confirmButtonAppearance:"positive",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:()=>F(e)},children:"Undo"}),((j=e.actions)==null?void 0:j.reappliable)&&t.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:l,confirmationModalProps:{title:"Redo activity",children:t.jsxs("p",{children:["Are you sure you want to redo ",e.summary," ","activity?"]}),confirmButtonLabel:"Redo",confirmButtonAppearance:"positive",confirmButtonDisabled:l,confirmButtonLoading:l,onConfirm:()=>U(e)},children:"Redo"})]})},"buttons"),t.jsxs(i.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(i.Col,{size:12,children:t.jsx(s,{label:"Description",value:e.summary})}),f&&t.jsx(i.Col,{size:12,children:t.jsx(s,{label:"Instance",value:f})}),t.jsx(i.Col,{size:6,children:t.jsx(s,{label:"Status",value:t.jsxs(t.Fragment,{children:[t.jsx(i.Icon,{name:C[e.activity_status].icon,className:B.statusIcon}),t.jsx("span",{children:C[e.activity_status].label})]})})}),t.jsx(i.Col,{size:6,children:t.jsx(s,{label:"Created at",value:y(e.creation_time).format(p)})}),typeof e.delivery_time=="string"&&t.jsx(i.Col,{size:6,children:t.jsx(s,{label:"Delivered at",value:y(e.delivery_time).format(p)})}),e.completion_time&&t.jsx(i.Col,{size:6,children:t.jsx(s,{label:"Completed at",value:y(e.completion_time).format(p)})}),e.result_text&&t.jsx(i.Col,{size:12,children:t.jsx(s,{label:"Output",type:"snippet",value:e.result_text,className:B.output})})]})]})]})};export{st as default};
