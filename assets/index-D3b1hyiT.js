import{i as x,h as B,r as y,A as j,j as o,n as c,I as v,p as w}from"./index-Dg2qeAM1.js";import{S as A}from"./SidePanelFormButtons-eNiDcGbx.js";import{u as C}from"./useEditScript-Dpgw6WWu.js";import{g as E,e as L,h as P}from"./ScriptsTabs-DVddNbQE.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./TruncatedCell-C6qDfyLZ.js";import"./useRoles-DhxkQ1IG.js";import"./HeaderWithSearch-9LSyOtlV.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./index-OaZZHjlp.js";import"./useExpandableRow-CLRzuV2i.js";const F=({scriptId:n,versionId:e})=>{const r=x(),{data:s,isPending:a}=B({queryKey:["scripts","version",n,e],queryFn:async()=>r.get(`scripts/${n}/versions/${e}`)});return{version:(s==null?void 0:s.data)??null,isVersionLoading:a}},K=({scriptId:n,scriptVersion:e,goBack:r,isArchived:s})=>{const[a,i]=y.useState(!1),p=j(),{version:t,isVersionLoading:f}=F({scriptId:n,versionId:e.version_number}),{editScript:b,isEditing:d}=C(),h=()=>{i(!0)},S=()=>{i(!1)},l=E({code:t==null?void 0:t.code,interpreter:t==null?void 0:t.interpreter}),m=async()=>{try{if(t){const u={code:l,title:t.title},g=P({scriptId:n,values:u});await b(g),r()}}catch(u){i(!1),p(u)}};return o.jsxs(c.Form,{noValidate:!0,onSubmit:m,children:[o.jsx(v,{label:"author",value:L({author:e.created_by.name,date:e.created_at})}),f?o.jsx(w,{}):o.jsx(c.CodeSnippet,{blocks:[{title:"Code",code:l||"",wrapLines:!0,appearance:"numbered"}]}),o.jsx(A,{hasActionButtons:!s,submitButtonAppearance:"secondary",submitButtonText:"Use as new version",onSubmit:h,hasBackButton:!0,onBackButtonPress:r}),a&&o.jsx(c.ConfirmationModal,{title:`Submit new version of ${e.title}`,confirmButtonLabel:"Submit new version",close:S,confirmButtonAppearance:"positive",confirmButtonLoading:d,confirmButtonDisabled:d,onConfirm:m,confirmButtonProps:{type:"button"},cancelButtonProps:{type:"button"},children:o.jsx("p",{children:"All future script runs will be done using the latest version of the code."})})]})};export{K as default};
