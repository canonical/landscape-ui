const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Ck7ftd4L.js","assets/index-DjXnPsWV.js","assets/index-CMPBhKCb.css","assets/MultiSelectField-kUmoIU02.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-oHcEekp6.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/TagsAddConfirmationModal-vGk7aftQ.js","assets/ModalTablePagination-MGJms-26.js","assets/ModalTablePagination-HDr0Q-Wm.css","assets/useGetTags-1g_ZPp3M.js","assets/useRoles-1YhtLlUX.js","assets/AssociationBlock-vsPH8fvb.css","assets/index-DoMwyG7x.js","assets/ScriptsTabs-DBZxc73r.js","assets/constants-CFW2eS4m.js","assets/TextConfirmationModal-DZDP6pzd.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/HeaderWithSearch-DByF44RZ.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-D_HXFdwE.js","assets/ScriptsTabs-DN44MVZt.css","assets/useRunScript-DZKLKa7f.js","assets/DeliveryBlock-C7j36avG.js","assets/RadioGroup-CLRIdzcP.js","assets/RadioGroup-WBbAFTwm.css","assets/ScriptDropdown-DABpdXHG.js","assets/downshift.esm-DtDnRlY7.js","assets/ScriptDropdown-DGqiHs-J.css","assets/index-CarWJpt5.js","assets/CodeEditor-CAs7k84y.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-mdDPm4Si.js","assets/AttachmentFile-od6SyReP.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-CcVPKfaI.js","assets/EmployeeList-H_gItjsx.js","assets/EmployeeList-CnpN88if.css","assets/useGetEmployees-j7gaFWv7.js","assets/index-CzWO0kSt.css","assets/index-CL8cYbjq.js","assets/SidePanelTableFilterChips-ujydKm91.js","assets/SidePanelTablePagination-CRq6YMTf.js","assets/Chip-CauiO733.js","assets/Chip-R6WqXyae.css","assets/InstanceRemoveFromLandscapeModal-CkVeQ2A5.js","assets/useRemoveInstancesFromLandscape-0iO-BM91.js","assets/WslInstancesEmptyState-hoU8xM6a.js","assets/GroupFilter-BVlUEjp5.js","assets/WslInstancesEmptyState-CBT5OoUG.css","assets/index-DWa9RADh.css"])))=>i.map(i=>d[i]);
import{n as d,j as t,K as R,e as l,aK as ve,d as Y,i as _e,k as xe,l as je,R as b,S as Ie,y as we,ar as Se,z as Ce,B as Re,w as k,c as ke,q as Ae,W as Fe,s as Ee,p as Me,H as Te,aL as De,aM as Le,a1 as x,t as Pe,a as C,az as c,P as M,I as o,aI as W,Q,v as K,$ as T}from"./index-DjXnPsWV.js";import{T as Be}from"./TextConfirmationModal-DZDP6pzd.js";import{C as Oe}from"./Chip-CauiO733.js";import"./EmployeeList-H_gItjsx.js";import{u as ze,I as $e}from"./InstanceRemoveFromLandscapeModal-CkVeQ2A5.js";import{u as Ve}from"./useRoles-1YhtLlUX.js";import"./index-D_HXFdwE.js";import{W as Ne,a as qe}from"./WslInstancesEmptyState-hoU8xM6a.js";const Ge="_container_dj78y_1",Ue="_wrapped_dj78y_8",We="_innerContainer_dj78y_13",Qe="_button_dj78y_17",Ke="_titleRow_dj78y_21",w={container:Ge,wrapped:Ue,innerContainer:We,button:Qe,titleRow:Ke},Ye=({actions:{destructive:e=[],nondestructive:i=[]},title:y})=>{e=e.filter(s=>!s.excluded),i=i.filter(s=>!s.excluded);const v=[...i,...e],u={nondestructive:[],destructive:[]},[n,_]=d.useState(v),[f,A]=d.useState(u),[D,S]=d.useState(!1),[L,P]=d.useState(0),j=i.filter(s=>s.collapsed).length+e.filter(s=>s.collapsed).length>1,B=(s,h)=>{if(f.destructive.length||f.nondestructive.length)return;if((!s.lastElementChild||s.lastElementChild.getBoundingClientRect().right<=h.getBoundingClientRect().right)&&!j){S(!1);return}S(!0);const g=[],m={nondestructive:[],destructive:[]};i.forEach((p,I)=>{s.children[I].getBoundingClientRect().right>s.getBoundingClientRect().right||p.collapsed&&j?m.nondestructive.push(p):g.push(p)}),e.forEach((p,I)=>{I+=i.length,s.children[I].getBoundingClientRect().right>s.getBoundingClientRect().right||p.collapsed&&j?m.destructive.push(p):g.push(p)}),_(g),A(m)},F=s=>{const h=s?.parentElement?.parentElement;if(!h)return;B(s,h);const g=new ResizeObserver(()=>{const{width:m}=h.getBoundingClientRect();m!==L&&(_(v),A(u),P(m))});return g.observe(h),()=>{g.disconnect()}};return t.jsxs("div",{className:R(w.titleRow,{[w.wrapped]:!n.length}),children:[y,t.jsxs("div",{className:R(w.container,{[w.wrapped]:!n.length}),children:[t.jsx("div",{className:R(w.innerContainer,"p-segmented-control"),children:t.jsx("div",{ref:F,className:"p-segmented-control__list",children:n.map(({collapsed:s,excluded:h,icon:g,label:m,...p})=>t.jsxs(l.Button,{className:R(w.button,"u-no-margin--bottom p-segmented-control__button"),...p,children:[t.jsx(l.Icon,{name:g}),t.jsx("span",{children:m})]},m))})}),D&&t.jsx(ve,{hasToggleIcon:!0,toggleLabel:n.length?"More actions":"Actions",toggleClassName:"u-no-margin--bottom",toggleDisabled:[...e,...i].every(s=>s.disabled),actions:f.nondestructive,destructiveActions:f.destructive})]})]})},He=()=>{const e=Y(),i=_e(),{mutateAsync:y,isPending:v}=xe({mutationKey:["employee","disassociate"],mutationFn:async({employee_id:u,computer_id:n})=>e.delete(`employees/${u}/computers/${n}`),onSuccess:(u,n)=>{i.invalidateQueries({queryKey:["instances",n.computer_id]})}});return{disassociateEmployeeFromInstance:y,isDisassociating:v}},Ze=(e,i={})=>{const y=Y(),{id:v,...u}=e,{data:n,isLoading:_}=je({queryKey:["employees","employee",e],queryFn:async()=>y.get(`employees/${v}`,{params:u}),...i});return{employee:n?.data,isGettingEmployee:_}},Je=e=>{switch(e.type){case"package":return b.profiles.package({sidePath:["view"],profile:e.name||""});case"reboot":return b.profiles.reboot({sidePath:["view"],profile:e.id.toString()||""});case"removal":return b.profiles.removal({sidePath:["view"],profile:e.id.toString()||""});case"repository":return b.profiles.repository({search:e.title||""});case"script":return b.scripts.root({tab:"profiles",sidePath:["view"],profile:e.id.toString()||""});case"security":return b.profiles.security({sidePath:["view"],profile:e.id.toString()||""});case"upgrade":return b.profiles.upgrade({sidePath:["view"],profile:e.id.toString()||""});case"wsl":return b.profiles.wsl({sidePath:["view"],profile:e.name||""})}},Xe=({profile:e})=>t.jsx(Ie,{to:Je(e),children:e.title}),et={deliver_after:"",deliverImmediately:!0,action:null},tt=we().shape({deliver_after:Re().when("deliverImmediately",{is:!1,then:e=>e.required("This field is required").test({message:"Invalid date",test:i=>k(i).isValid()}).test({message:"Date must be in the future",test:i=>k(i).isAfter()})}),deliverImmediately:Ce(),action:Se().oneOf(["shutdown","reboot"]).required()}),st="_headerContainer_10wnq_1",it="_status_10wnq_6",ot="_heading_10wnq_12",z={headerContainer:st,status:it,heading:ot},at=d.lazy(async()=>T(()=>import("./index-Ck7ftd4L.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),lt=d.lazy(async()=>T(()=>import("./index-DoMwyG7x.js"),__vite__mapDeps([14,15,1,2,16,12,17,18,19,20,21,22,23,24,5,6,7,25,26,27,28,29,30,31,32,33,34,35,36,37,38])).then(e=>({default:e.RunInstanceScriptForm}))),nt=d.lazy(async()=>T(()=>import("./index-CcVPKfaI.js"),__vite__mapDeps([39,1,2,5,6,7,40,16,41,30,42,43]))),rt=d.lazy(async()=>T(()=>import("./index-CL8cYbjq.js"),__vite__mapDeps([44,1,2,45,46,17,18,47,48,40,16,41,49,50,12,23,51,52,19,20,53,54]))),ct=({instance:e})=>{const{isFeatureEnabled:i}=ke(),y=Ae(),v=Fe(),{notify:u}=Ee(),{setSidePanelContent:n}=Me(),{openActivityDetails:_}=Te(),{employee:f,isGettingEmployee:A}=Ze({id:e.employee_id??0},{enabled:!!e.employee_id}),{restartInstances:D,isRestartingInstances:S}=De(),{getAccessGroupQuery:L}=Ve(),{sanitizeInstance:P,isSanitizingInstance:j}=ze(),{shutDownInstances:B,isShuttingDownInstances:F}=Le(),{disassociateEmployeeFromInstance:s,isDisassociating:h}=He(),{value:g,setTrue:m,setFalse:p}=x(),{value:I,setTrue:H,setFalse:Z}=x(),{value:J,setTrue:X,setFalse:ee}=x(),{value:te,setTrue:se,setFalse:ie}=x(),{value:oe,setTrue:ae,setFalse:le}=x(),{value:ne,setTrue:re,setFalse:$}=x(),{value:ce,setTrue:de,setFalse:V}=x(),{data:N,isPending:ue}=L(),r=Pe({initialValues:et,validationSchema:tt,onSubmit:async a=>{if(!a.action)return;const G={computer_ids:[e.id],deliver_after:a.deliverImmediately?void 0:`${a.deliver_after}:00Z`};try{const{data:O}=a.action==="reboot"?await D(G):await B(G),U=a.action==="reboot"?"restarted":"shut down";u.success({title:`You queued "${e.title}" to be ${U}`,message:`Instance "${e.title}" will be ${U} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{_(O)}}]})}catch(O){y(O)}}});if(ue||A)return t.jsx(C,{});const me=async()=>{try{const{data:a}=await P({computer_id:e.id,computer_title:e.title});u.success({title:`You have successfully marked ${e.title} to be sanitized.`,message:"An activity has been queued to sanitize it. The data will be permanently irrecoverable once complete.",actions:[{label:"View details",onClick:()=>{_(a)}}]})}catch(a){y(a)}finally{$()}},pe=()=>{n("Edit instance",t.jsx(d.Suspense,{fallback:t.jsx(C,{}),children:t.jsx(at,{instance:e})}))},he=()=>{n("Run script",t.jsx(d.Suspense,{fallback:t.jsx(C,{}),children:t.jsx(lt,{parentAccessGroup:e.access_group,query:`id:${e.id}`})}))},ge=()=>{n(`Associate employee with ${e.title}`,t.jsx(d.Suspense,{fallback:t.jsx(C,{}),children:t.jsx(nt,{instanceTitle:e.title})}))},ye=()=>{n(`Active profiles associated with ${e.title}`,t.jsx(d.Suspense,{fallback:t.jsx(C,{}),children:t.jsx(rt,{instance:e})}),"medium")},fe=async()=>{try{await s({computer_id:e.id,employee_id:e.employee_id??0}),V(),u.success({title:`You have successfully disassociated ${f?.name??"the employee"}.`,message:`${f?.name??"The employee"} has been successfully disassociated from ${e.title}.`})}catch(a){y(a)}},E=async a=>{await r.setFieldValue("action",a),r.handleSubmit()},q=()=>{v(b.instances.root(),{replace:!0})},be=N?N.data:[];return t.jsxs(t.Fragment,{children:[t.jsx(Ye,{title:t.jsxs("div",{className:z.headerContainer,children:[t.jsx("h2",{className:R("p-heading--4 u-no-padding--top",z.heading),children:e.title}),e.is_wsl_instance&&t.jsx(Oe,{value:"WSL instance"})]}),actions:{nondestructive:[{icon:"edit",label:"Edit",onClick:pe},{icon:"restart",label:"Restart",onClick:m,excluded:!c(e).power},{icon:"power-off",label:"Shut down",onClick:H,excluded:!c(e).power},{icon:"code",label:"Run script",onClick:he,excluded:!c(e).scripts},{icon:l.ICONS.user,label:"Associate employee",onClick:ge,collapsed:!0,excluded:!i("employee-management")||!c(e).employees||e.employee_id!==null},{icon:l.ICONS.user,label:"Disassociate employee",onClick:de,collapsed:!0,excluded:!i("employee-management")||!c(e).employees||e.employee_id===null}],destructive:[{icon:"restart",label:"Reinstall",onClick:X,collapsed:!0,excluded:!c(e).uninstallation},{icon:"close",label:"Uninstall",onClick:se,collapsed:!0,excluded:!c(e).uninstallation},{icon:l.ICONS.delete,label:"Remove from Landscape",onClick:ae,collapsed:!0},{icon:"tidy",label:"Sanitize",onClick:re,collapsed:!0,excluded:!c(e).sanitization}]}},e.employee_id??"no-employee"),t.jsxs(M,{children:[t.jsx(M.Item,{title:"Status",children:t.jsxs(o,{children:[t.jsx(o.Item,{label:"Status",value:t.jsxs("div",{className:z.status,children:[t.jsx(l.Icon,{name:W(e).icon??""}),t.jsx("span",{children:W(e).label})]})}),t.jsx(o.Item,{label:"Last ping time",value:k(e.last_ping_time).isValid()?k(e.last_ping_time).format(Q):null}),t.jsx(o.Item,{label:"Access group",value:be.find(a=>a.name===e.access_group)?.title||e.access_group}),t.jsx(o.Item,{label:"Tags",value:e.tags.join(", ")||null,type:"truncated"}),t.jsx(o.Item,{label:"Profiles",value:e.profiles?.length?e.profiles.length===1?t.jsx(Xe,{profile:e.profiles[0]}):t.jsxs(l.Button,{type:"button",className:"u-no-margin",appearance:"link",onClick:ye,children:[e.profiles.length," profiles"]}):null,type:"truncated"}),c(e).employees&&t.jsx(o.Item,{label:"Associated employee",value:f?.name})]})}),t.jsx(M.Item,{title:"Registration details",children:t.jsxs(o,{children:[t.jsx(o.Item,{label:"Hostname",value:e.hostname}),t.jsx(o.Item,{label:"ID",value:e.id}),c(e).hardware&&t.jsx(o.Item,{label:"Serial number",value:e.grouped_hardware?.system.serial}),c(e).hardware&&t.jsx(o.Item,{label:"Product identifier",value:e.grouped_hardware?.system.model}),t.jsx(o.Item,{label:"OS",value:e.distribution_info?.description}),c(e).hardware&&t.jsx(o.Item,{label:"IP addresses",value:Array.isArray(e.grouped_hardware?.network)?e.grouped_hardware.network.map(a=>a.ip).join(", "):null,type:"truncated"}),t.jsx(o.Item,{label:"Registered",value:k(e.registered_at).format(Q)})]})}),t.jsx(M.Item,{title:"Other",children:t.jsxs(o,{children:[t.jsx(o.Item,{label:"Annotations",value:null}),t.jsx(o.Item,{label:"Comment",value:e.comment||null})]})})]}),g&&t.jsx(l.ConfirmationModal,{close:p,title:"Restart instance",confirmButtonLabel:"Restart",confirmButtonAppearance:"positive",confirmButtonDisabled:S,confirmButtonLoading:S,onConfirm:async()=>E("reboot"),children:t.jsxs(l.Form,{onSubmit:async()=>E("reboot"),noValidate:!0,children:[t.jsx(l.CheckboxInput,{label:"Deliver as soon as possible",...r.getFieldProps("deliverImmediately"),checked:r.values.deliverImmediately}),t.jsx(l.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...r.getFieldProps("deliver_after"),disabled:r.values.deliverImmediately,error:K(r,"deliver_after")}),t.jsxs("p",{children:['This will restart "',e.title,'" instance.']})]})}),I&&t.jsx(l.ConfirmationModal,{close:Z,title:"Shut down instance",confirmButtonLabel:"Shut down",confirmButtonAppearance:"positive",confirmButtonDisabled:F,confirmButtonLoading:F,onConfirm:async()=>E("shutdown"),children:t.jsxs(l.Form,{onSubmit:async()=>E("shutdown"),noValidate:!0,children:[t.jsx(l.CheckboxInput,{label:"Deliver as soon as possible",...r.getFieldProps("deliverImmediately"),checked:r.values.deliverImmediately}),t.jsx(l.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...r.getFieldProps("deliver_after"),disabled:r.values.deliverImmediately,error:K(r,"deliver_after")}),t.jsxs("p",{children:['This will shut down "',e.title,'" instance.']})]})}),ce&&t.jsx(l.ConfirmationModal,{close:V,title:`Disassociate employee from ${e.title}`,confirmButtonLabel:"Disassociate",confirmButtonAppearance:"negative",confirmButtonDisabled:h,confirmButtonLoading:h,onConfirm:fe,children:t.jsxs("p",{children:["You are about to disassociate instance ",e.title," from"," ",f?.name,". This will revoke their access to the instance’s details and recovery key."]})}),e.is_wsl_instance&&t.jsxs(t.Fragment,{children:[t.jsx(Ne,{close:ee,instances:[{name:e.title,computer_id:e.id}],isOpen:J,windowsInstance:e}),t.jsx(qe,{close:ie,instances:[{name:e.title,computer_id:e.id}],isOpen:te,onSuccess:q,parentId:e.parent.id})]}),t.jsx($e,{close:le,instance:e,isOpen:oe,onSuccess:q}),t.jsx(Be,{isOpen:ne,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:j,confirmButtonLoading:j,onConfirm:me,close:$,confirmationText:`sanitize ${e.title}`,title:"Sanitize instance",children:t.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",e.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})},vt=Object.freeze(Object.defineProperty({__proto__:null,default:ct},Symbol.toStringTag,{value:"Module"}));export{Xe as P,vt as i};
