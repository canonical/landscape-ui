const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-wTbBOBlj.js","assets/index-CPTwPS4O.js","assets/index-DEuNBe7s.css","assets/useInstances-DVpyJjsL.js","assets/useFetchOld-DBTHYiky.js","assets/InfoItem-GhEXLtY8.js","assets/InfoItem-C-lWh_lY.css","assets/WslInstancesHeader-BfAA2tcZ.js","assets/HeaderWithSearch-Dj52wW-o.js","assets/HeaderWithSearch-DQybm8h_.css","assets/usePageParams-CUhpjrHp.js","assets/WslInstancesHeader-C2N1H1qb.css","assets/useRoles-BINgFlAH.js","assets/moment-D6mwQti5.js","assets/NoData-BySfm8NG.js","assets/moment-C5S46NFB.js","assets/index-Cf61tzCp.js","assets/TablePagination-CmvzfKx-.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/SearchHelpPopup-BPxfaC-L.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/index-BmoMXq9B.css","assets/index-dkdshLqf.css","assets/index-DUJPoRaF.js","assets/index-CuwdzumK.css","assets/index-CXC9BeVb.js","assets/index-DSOofqg6.css","assets/index-C0j0WShp.js","assets/useUsns-UU2yxY9p.js","assets/useUsns-CzsIYyKO.css","assets/index-Bsb7_DyO.css","assets/index-BpZrN1fp.js","assets/index-BpYhI3Xd.js","assets/PageMain-B0F_OruQ.js","assets/PageMain-BIuYvhUI.css","assets/index-1KdKUBQ3.css","assets/index-H--aI3xB.js","assets/index-DxzApC0N.css","assets/index-XzdPhloK.js","assets/SidePanelFormButtons-CGsmvMYg.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/helpers-DZ2XnYQb.js","assets/index-BAFRWw-h.css","assets/index-DvRUxw_E.js","assets/UsnList-DQJ1MvtG.js","assets/SelectAllButton-9qxmiMWT.js","assets/ExpandableTableFooter-DczdoO6i.js","assets/ExpandableTableFooter-PHbaG9hU.css","assets/TruncatedCell-CF010OW7.js","assets/TruncatedCell-Wu3cG5-r.css","assets/helpers-B4Ea794_.js","assets/helpers-BWt8NEL_.css","assets/UsnList-BtkgdprT.css","assets/index-Bwv5eodB.css","assets/index-CtXiX95b.js","assets/index-D5vdZ5qS.css","assets/index-EVPGvdmZ.js","assets/downshift.esm-DYEEDqWb.js","assets/index-C8S5ex7b.css","assets/index-Cs7uS-bi.js","assets/constants-DP5L2BEE.js","assets/index-_aFDOmw8.css","assets/index-CTCkGU4D.js","assets/constants-Dwl1JGyb.js","assets/index-W_BOD1xP.css","assets/index-D1BYM456.js"])))=>i.map(i=>d[i]);
import{a as K,j as e,E as F,h as b,R as m,r as o,_ as d,i as A,t as x,d as z,c as C,e as T,f as w,v as $,y as N}from"./index-CPTwPS4O.js";import{P as Q,a as B,b as S}from"./PageMain-B0F_OruQ.js";import{u as U,a as q}from"./useUsns-UU2yxY9p.js";import{u as H}from"./useInstances-DVpyJjsL.js";import"./moment-D6mwQti5.js";import{u as M}from"./usePageParams-CUhpjrHp.js";import"./moment-C5S46NFB.js";const G=({childInstanceId:n,instanceId:s})=>{const a=K();return e.jsx(F,{title:"Instance not found",icon:"connected",body:e.jsxs("p",{className:"u-no-margin--bottom",children:[e.jsx("span",{children:"Seems like the instance with id = "}),e.jsx("code",{children:s}),e.jsx("span",{children:" doesn't "}),n?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"have a child instance with id = "}),e.jsx("code",{children:n})]}):e.jsx("span",{children:"exist"})]}),cta:[e.jsx(b.Button,{appearance:"positive",onClick:()=>a(`${m}instances`,{replace:!0}),type:"button","aria-label":"Go back",children:"Back to Instances page"},"go-back-to-instances-page"),e.jsx(b.Button,{onClick:()=>a(`${m}`,{replace:!0}),type:"button","aria-label":"Go back",children:"Home page"},"go-back-to-home-page")]})},W=[{label:"Info",id:"tab-link-info"},{label:"WSL",id:"tab-link-wsl"},{label:"Activities",id:"tab-link-activities"},{label:"Kernel",id:"tab-link-kernel"},{label:"Security issues",id:"tab-link-security-issues"},{label:"Packages",id:"tab-link-packages"},{label:"Snaps",id:"tab-link-snaps"},{label:"Processes",id:"tab-link-processes"},{label:"Ubuntu Pro",id:"tab-link-ubuntu-pro"},{label:"Users",id:"tab-link-users"},{label:"Hardware",id:"tab-link-hardware"}],J=({id:n,label:s,packageCount:a,packagesLoading:u,usnCount:p,usnLoading:_,kernelCount:i,kernelLoading:l})=>n==="tab-link-packages"&&u||n==="tab-link-security-issues"&&_||n==="tab-link-kernel"&&l?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Spinner,{className:"u-no-margin--bottom u-no-padding--top"})]}):n==="tab-link-packages"&&a?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Badge,{value:a})]}):n==="tab-link-security-issues"&&p?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Badge,{value:p,isNegative:!0})]}):n==="tab-link-kernel"&&i?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Badge,{value:i})]}):s,X=({activeTabId:n,instance:s,onActiveTabChange:a,packageCount:u,packagesLoading:p,usnCount:_,usnLoading:i,kernelCount:l,kernelLoading:c})=>W.filter(({id:g})=>!s.distribution||/\d{1,2}\.\d{2}/.test(s.distribution)?g!=="tab-link-wsl":["tab-link-info","tab-link-wsl","tab-link-activities","tab-link-hardware"].includes(g)).map(({label:g,id:r})=>({label:J({label:g,id:r,packageCount:u,packagesLoading:p,usnCount:_,usnLoading:i,kernelCount:l,kernelLoading:c}),id:r,role:"tab",active:r===n,onClick:()=>a(r)})),Y="_tabPanel_1n8p7_1",Z={tabPanel:Y},ee=o.lazy(()=>d(()=>import("./index-wTbBOBlj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]))),ne=o.lazy(()=>d(()=>import("./index-DUJPoRaF.js"),__vite__mapDeps([24,1,2,17,18,19,10,8,9,25]))),te=o.lazy(()=>d(()=>import("./index-CXC9BeVb.js"),__vite__mapDeps([26,1,2,5,6,27]))),ae=o.lazy(()=>d(()=>import("./index-C0j0WShp.js"),__vite__mapDeps([28,1,2,17,18,19,10,29,4,30,8,9,31]))),se=o.lazy(()=>d(()=>import("./index-BpZrN1fp.js"),__vite__mapDeps([32,1,2,16,13,17,18,19,10,20,21,4,14,22]))),re=o.lazy(()=>d(()=>import("./index-BpYhI3Xd.js"),__vite__mapDeps([33,1,2,17,18,19,10,5,6,15,14,34,35,29,4,30,3,13,36]))),ie=o.lazy(()=>d(()=>import("./index-H--aI3xB.js"),__vite__mapDeps([37,1,2,7,3,4,8,9,10,11,38]))),oe=o.lazy(()=>d(()=>import("./index-XzdPhloK.js").then(n=>n.i),__vite__mapDeps([39,1,2,17,18,19,10,40,41,42,43,8,9,14,44]))),le=o.lazy(()=>d(()=>import("./index-DvRUxw_E.js"),__vite__mapDeps([45,1,2,13,10,29,4,30,46,47,48,49,14,17,18,19,50,51,52,53,54,55]))),ce=o.lazy(()=>d(()=>import("./index-CtXiX95b.js"),__vite__mapDeps([56,1,2,5,6,14,15,57]))),de=o.lazy(()=>d(()=>import("./index-EVPGvdmZ.js"),__vite__mapDeps([58,1,2,17,18,19,10,5,6,15,40,41,42,43,59,14,8,9,60]))),ue=({instance:n,packageCount:s,packagesLoading:a,usnCount:u,usnLoading:p,kernelCount:_,kernelLoading:i})=>{const{closeSidePanel:l}=A(),{tab:c,setPageParams:g}=M(),r=c?`tab-link-${c}`:"tab-link-info",t=X({activeTabId:r,instance:n,onActiveTabChange:h=>{g({tab:h.replace("tab-link-","")}),l()},packageCount:s,packagesLoading:a,usnCount:u,usnLoading:p,kernelCount:_,kernelLoading:i});return e.jsxs(e.Fragment,{children:[e.jsx(b.Tabs,{listClassName:"u-no-margin--bottom",links:t}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":r,className:Z.tabPanel,children:e.jsxs(o.Suspense,{fallback:e.jsx(x,{}),children:[r==="tab-link-info"&&e.jsx(ee,{instance:n}),r==="tab-link-wsl"&&e.jsx(ie,{instance:n}),r==="tab-link-activities"&&e.jsx(se,{instanceId:n.id}),r==="tab-link-kernel"&&e.jsx(re,{instanceTitle:n.title}),r==="tab-link-security-issues"&&e.jsx(le,{instance:n}),r==="tab-link-packages"&&e.jsx(ae,{}),r==="tab-link-snaps"&&e.jsx(de,{}),r==="tab-link-processes"&&e.jsx(ne,{}),r==="tab-link-ubuntu-pro"&&e.jsx(ce,{instance:n}),r==="tab-link-users"&&e.jsx(oe,{}),r==="tab-link-hardware"&&e.jsx(te,{instance:n})]})})]})},pe=n=>{if(n)return n.parent?[{label:"Instances",path:`${m}instances`},{label:n.parent.title,path:`${m}instances/${n.parent.id}`},{label:n.title,current:!0}]:[{label:"Instances",path:`${m}instances`},{label:n.title,current:!0}]},be=n=>{if(!(!n||n.length===0))return n[0].Livepatch.Fixes.length},_e="_container_pnq0d_1",ge={container:_e},me=o.lazy(()=>d(()=>import("./index-Cs7uS-bi.js"),__vite__mapDeps([61,1,2,5,6,16,13,17,18,19,10,20,21,4,14,22,15,62,34,35,29,30,3,63]))),he=o.lazy(()=>d(()=>import("./index-CTCkGU4D.js"),__vite__mapDeps([64,1,2,5,6,16,13,17,18,19,10,20,21,4,14,22,15,65,62,34,35,29,30,3,66]))),xe=o.lazy(()=>d(()=>import("./index-D1BYM456.js"),__vite__mapDeps([67,1,2,16,13,17,18,19,10,20,21,4,14,22,3,15,65,34,35,29,30,66]))),Te=({instanceName:n,hasTableData:s,kernelStatuses:a})=>{var r;const{setSidePanelContent:u}=A(),p=((r=a==null?void 0:a.installed)==null?void 0:r.version_rounded)??"",_=(a==null?void 0:a.downgrades)??[],i=(a==null?void 0:a.upgrades)??[],l=()=>{u("Downgrade kernel",e.jsx(o.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(me,{instanceName:n,currentKernelVersion:p,downgradeKernelVersions:_})}))},c=()=>{u("Upgrade kernel",e.jsx(o.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(he,{instanceName:n,currentKernelVersion:p,upgradeKernelVersions:i})}))},g=()=>{var t;u(`Restart ${n}`,e.jsx(o.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(xe,{instanceName:n,showNotification:s,newKernelVersionId:(t=i[0])==null?void 0:t.id})}))};return e.jsxs("div",{className:ge.container,children:[e.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:"Kernel overview"}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:g,children:[e.jsx(b.Icon,{name:"restart"}),e.jsx("span",{children:"Restart instance"})]}),e.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:_.length===0,onClick:l,children:[e.jsx(b.Icon,{name:"begin-downloading"}),e.jsx("span",{children:"Downgrade kernel"})]}),e.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:i.length===0,onClick:c,children:[e.jsx(b.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade kernel"})]})]})},"buttons")]})};function je(){const n=z(),s=C(),a=({id:i},l={})=>w({queryKey:["kernel",i],queryFn:()=>n.get(`computers/${i}/livepatch/kernel`),...l}),u=({id:i,...l},c={})=>w({queryKey:["kernel",{id:i,...l}],queryFn:()=>n.get(`computers/${i}/livepatch/info`,{params:l}),...c}),p=T({mutationKey:["kernel","downgrade"],mutationFn:({id:i,...l})=>n.post(`computers/${i}/kernel/downgrade`,l),onSuccess:()=>s.invalidateQueries({queryKey:["kernel"]})}),_=T({mutationKey:["kernel","upgrade"],mutationFn:({id:i,...l})=>n.post(`computers/${i}/kernel/upgrade`,l),onSuccess:()=>s.invalidateQueries({queryKey:["kernel"]})});return{getKernelQuery:a,getLivepatchInfoQuery:u,downgradeKernelQuery:p,upgradeKernelQuery:_}}const ke=()=>{var y,v,I,P,f,E,L;const{instanceId:n,childInstanceId:s}=$(),{user:a}=N(),u=K(),{getSingleInstanceQuery:p}=H(),{getUsnsQuery:_}=U(),{getInstancePackagesQuery:i}=q(),{getLivepatchInfoQuery:l}=je(),c=o.useRef("");o.useEffect(()=>{a!=null&&a.current_account&&(c.current||(c.current=a.current_account),c.current!==a.current_account&&u(`${m}instances`,{replace:!0}))},[a==null?void 0:a.current_account]);const{data:g,isLoading:r}=p({instanceId:parseInt(s||(n??"")),with_annotations:!0,with_grouped_hardware:!0},{enabled:!!n&&(!c.current||c.current===(a==null?void 0:a.current_account))}),t=(g==null?void 0:g.data)??null,{data:h,isLoading:R}=_({computer_ids:t?[t.id]:[],limit:1},{enabled:!!(t!=null&&t.distribution)&&/\d{1,2}\.\d{2}/.test(t.distribution)&&(!s||((y=t.parent)==null?void 0:y.id)===parseInt(n??""))}),{data:j,isLoading:D}=i({available:!1,upgrade:!0,instance_id:t?t.id:0,limit:1},{enabled:!!(t!=null&&t.distribution)&&/\d{1,2}\.\d{2}/.test(t.distribution)&&(!s||((v=t.parent)==null?void 0:v.id)===parseInt(n??""))}),{data:k,isLoading:O}=l({id:t?t.id:0},{enabled:!!(t!=null&&t.distribution)&&/\d{1,2}\.\d{2}/.test(t.distribution)&&(!s||((I=t.parent)==null?void 0:I.id)===parseInt(n??""))}),V=be((E=(f=(P=k==null?void 0:k.data.livepatch_info)==null?void 0:P.json)==null?void 0:f.output)==null?void 0:E.Status);return e.jsxs(Q,{children:[e.jsx(B,{title:(t==null?void 0:t.title)??"",hideTitle:!0,breadcrumbs:pe(t)}),e.jsxs(S,{children:[r&&e.jsx(x,{}),!r&&(!t||s&&((L=t==null?void 0:t.parent)==null?void 0:L.id)!==parseInt(n??""))&&e.jsx(G,{childInstanceId:s,instanceId:n}),!r&&t&&(!s||t.parent&&t.parent.id===parseInt(n??""))&&e.jsx(ue,{instance:t,packageCount:t.distribution?j==null?void 0:j.data.count:0,packagesLoading:D,usnCount:t.distribution?h==null?void 0:h.data.count:0,usnLoading:R,kernelCount:t.distribution?V:0,kernelLoading:O})]})]})},we=Object.freeze(Object.defineProperty({__proto__:null,default:ke},Symbol.toStringTag,{value:"Module"}));export{Te as K,we as i,je as u};
