import{r as c,U as x,j as e,D as _,g,e as h,d as b,x as w,n as E}from"./index-_k3Mqmx0.js";import{P as j,a as C,b as T}from"./PageMain-CO5O-h8M.js";import{u as v,T as P}from"./TablePagination-h-nQaSEp.js";import{T as I}from"./TruncatedCell-BDbuNuwS.js";import{h as y,u as f,D as u}from"./usePageParams-m1opYj6o.js";import{a as R}from"./helpers-YZmpvnrI.js";import{T as L}from"./TableFilterChips-C10sZkO3.js";import{H as D}from"./HeaderWithSearch-CQut-u_u.js";import{T as F}from"./TableFilter-CgicuUXi.js";import"./TablePaginationBase-Cj111vbq.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="3242fc29-1990-42ca-b0e7-6003daf44e0c",s._sentryDebugIdIdentifier="sentry-dbid-3242fc29-1990-42ca-b0e7-6003daf44e0c")}catch{}const S="_message_1po57_1",H="_expandedCell_1po57_5",M="_expandedRow_1po57_10",p={message:S,expandedCell:H,expandedRow:M},N=s=>({index:t})=>{const o={};return s===t&&(o.className=p.expandedRow),o},O=s=>({column:t,row:{index:o}})=>{const a={};return t.id==="creation_time"?a.role="rowheader":t.id==="person_name"?a["aria-label"]="username":t.id==="entity_type"?a["aria-label"]="entity type":t.id==="entity_name"?a["aria-label"]="entity name":t.id==="message"&&(a["aria-label"]="message",s===o&&(a.className=p.expandedCell)),a},k=({eventsLog:s})=>{const[t,o]=c.useState(""),[a,l]=c.useState(-1),d=c.useRef([]);x({current:a!==-1?d.current[a]:null},()=>l(-1));const r=c.useMemo(()=>[{accessor:"creation_time",Header:"creation time",Cell:({row:n})=>e.jsx(e.Fragment,{children:y(n.original.creation_time).format(_)})},{accessor:"person_name",Header:"username",Cell:({row:n})=>e.jsx(e.Fragment,{children:n.original.person_name})},{accessor:"entity_type",Header:"entity type",Cell:({row:n})=>e.jsx(e.Fragment,{children:n.original.entity_type})},{accessor:"entity_name",Header:"entity name",Cell:({row:n})=>e.jsx(e.Fragment,{children:n.original.entity_name})},{accessor:"message",className:p.message,Header:"message",Cell:({row:{original:n,index:i}})=>e.jsx(I,{content:n.message,isExpanded:i===a,onExpand:()=>{o(""),l(t?i-1:i)}})}],[s,a]);return e.jsx("div",{ref:R(d),children:e.jsx(g.ModularTable,{getCellProps:O(a),getRowProps:N(a),columns:r,data:s,emptyMsg:"No events found according to your search parameters."})})},Y=()=>{const{days:s,setPageParams:t}=f();return v("days",u.map(o=>o.value)),e.jsx(F,{multiple:!1,label:"Days",showSelectionOnToggleLabel:!0,hasToggleIcon:!0,options:u,onItemSelect:o=>t({days:o}),selectedItem:s.toString()})},A=()=>e.jsxs(e.Fragment,{children:[e.jsx(D,{actions:e.jsx(Y,{})}),e.jsx(L,{filtersToDisplay:["search"]})]});function U(){const s=h();return{getEventsLog:(o,a={})=>b({queryKey:["events",o],queryFn:()=>s.get("events",{params:o}),...a})}}const V="_header_116wp_1",$={header:V},B=(s,t)=>{const o=["creation_time","person_id","person_name","entity_type","entity_id","entity_name","message"],l=[["Creation Time","Person ID","Person Name","Entity Type","Entity ID","Entity Name","Message"].join(","),...s.map(i=>o.map(m=>i[m]).join(","))].join(`\r
`),d=new Blob([l],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(d),n=document.createElement("a");n.href=r,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)},se=()=>{const{days:s,search:t,currentPage:o,pageSize:a}=f(),{user:l}=w(),{getEventsLog:d}=U(),{data:r,isLoading:n}=d({days:Number(s),limit:a,offset:(o-1)*a,search:t}),i=c.useMemo(()=>(r==null?void 0:r.data.results.filter(m=>m.message.toLowerCase().includes(t.toLowerCase())))??[],[r,t]);return e.jsxs(j,{children:[e.jsx(C,{className:$.header,title:"Events log",actions:[e.jsx(g.Button,{type:"button",onClick:()=>B(i,`Event Log - ${l.current_account}-${y().format("YYYY-MM-DDTHH mm ss[Z]")}.csv`),children:"Download as CSV"},"download-as-cv")]}),e.jsxs(T,{children:[e.jsx(A,{}),n&&e.jsx(E,{}),!n&&i&&e.jsx(k,{eventsLog:i}),e.jsx(P,{totalItems:r==null?void 0:r.data.count,currentItemCount:i.length})]})]})};export{se as default};
