import{f as v,g as C,j as e,T as w,d as h,h as H,i as K,k as P,l as M,B as R,C as A,p as F,F as V,K as Z,O as U,r as u,n as z,q as D,aa as W,ah as X,au as J,ap as Y,aU as ee,aw as se,aV as te}from"./index-gc_gETRV.js";import{P as ne,a as ae,b as re}from"./PageMain-BI0GhwLg.js";import{F as b,P as oe,I as ie,a as ce}from"./InstancesPageActions-BjC5YnQo.js";import{u as G}from"./useInstances-HAzsZPHe.js";import{u as le}from"./useSelection-Ny1iNKTe.js";import{G as de}from"./GroupFilter-ByuD12kk.js";import{u as he}from"./useRoles-BwARvS0C.js";import"./ResponsiveButtons-CkY3WafE.js";const ue="_label_1i8qt_1",pe={label:ue},me=({options:t,label:n,inline:o=!1})=>{const{disabledColumns:a,setPageParams:i}=v(),r=s=>t.filter(({value:d})=>!s.includes(d)).map(({value:d})=>d);return C("disabledColumns",t.filter(s=>s.canBeHidden).map(s=>s.value)),e.jsx(w,{type:"multiple",showSelectedItemCount:!0,label:e.jsxs(e.Fragment,{children:[e.jsx(h.Icon,{name:"settings"}),e.jsx("span",{className:pe.label,children:n})]}),onItemsSelect:s=>{i({disabledColumns:r(s)})},options:t,disabledOptions:t.filter(({canBeHidden:s})=>!s),selectedItems:r(a),inline:o})},O=()=>{const t=H(),n=K(),o=(s={},d={})=>M({queryKey:["savedSearches",s],queryFn:async()=>t.get("GetSavedSearches",{params:s}),...d}),a=P({mutationFn:async s=>t.get("CreateSavedSearch",{params:s}),onSuccess:async()=>n.invalidateQueries({queryKey:["savedSearches"]})}),i=P({mutationFn:async s=>t.get("EditSavedSearch",{params:s}),onSuccess:async()=>n.invalidateQueries({queryKey:["savedSearches"]})}),r=P({mutationFn:async s=>t.get("RemoveSavedSearch",{params:s}),onSuccess:async()=>n.invalidateQueries({queryKey:["savedSearches"]})});return{getSavedSearchesQuery:o,createSavedSearchQuery:a,editSavedSearchQuery:i,removeSavedSearchQuery:r}},xe="_container_5hvuq_1",fe="_list_5hvuq_6",je="_listItem_5hvuq_11",ge="_search_5hvuq_17",ve="_row_5hvuq_25",ye="_truncated_5hvuq_33",g={container:xe,list:fe,listItem:je,search:ge,row:ve,truncated:ye},Se=({onSavedSearchClick:t,onSavedSearchRemove:n,savedSearches:o})=>{if(!o.length)return null;const a=R(),{notify:i}=A(),{removeSavedSearchQuery:r}=O(),{mutateAsync:s,isPending:d}=r,l=async c=>{try{await s({name:c}),n(),i.success({message:`Saved search ${c} successfully removed`,title:"Saved search removed"})}catch(m){a(m)}};return e.jsxs("div",{className:g.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Saved searches"}),e.jsx("ul",{className:F("p-list--divided u-no-margin--bottom",g.list),children:o.map(c=>e.jsx("li",{children:e.jsxs("div",{className:g.listItem,children:[e.jsx(h.Button,{type:"button",appearance:"base",className:g.search,onClick:()=>t(c),children:e.jsxs(h.Row,{className:g.row,children:[e.jsx(h.Col,{size:4,children:e.jsx(h.Tooltip,{message:c.name,positionElementClassName:g.truncated,children:e.jsx("span",{children:c.name})})}),e.jsx(h.Col,{size:8,children:e.jsx(h.Tooltip,{message:c.search,positionElementClassName:g.truncated,children:e.jsx("span",{children:c.search})})})]})}),e.jsx(h.ConfirmationButton,{className:"has-icon u-no-margin--bottom u-no-padding--bottom u-no-padding--top",type:"button",appearance:"base",confirmationModalProps:{title:"Remove saved search",children:e.jsxs("p",{children:['This will remove the saved search "',c.name,'".']}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:()=>l(c.name)},children:e.jsx(h.Icon,{name:"delete"})})]})},c.name))})]})},_e="_infoContainer_zti77_1",be="_helpButtonContainer_zti77_9",Ce="_helpButton_zti77_9",$={infoContainer:_e,helpButtonContainer:be,helpButton:Ce},we=({onHelpButtonClick:t})=>e.jsx("div",{className:$.infoContainer,children:e.jsx("div",{className:$.helpButtonContainer,children:e.jsx(h.Button,{type:"button",appearance:"base",hasIcon:!0,className:$.helpButton,onClick:n=>{n.stopPropagation(),t()},children:e.jsx(h.Icon,{name:h.ICONS.help})})})}),Ie=({onClose:t,onSearchSave:n,search:o})=>{const a=R(),{notify:i}=A(),{createSavedSearchQuery:r}=O(),{mutateAsync:s}=r,l=V({initialValues:{name:""},onSubmit:async({name:c})=>{try{await s({search:o,name:c,title:c}),i.success({message:`Saved search ${c} successfully added`,title:"Saved search added"}),n(),t()}catch(m){a(m)}},validationSchema:Z({name:U().required("This field is required").test({message:"Name must consist of only lowercase alphanumeric characters and hyphens",test:c=>/^[a-z0-9][-a-z0-9]*$/.test(c)})})});return e.jsxs(h.Form,{onSubmit:l.handleSubmit,noValidate:!0,children:[e.jsx(h.Input,{type:"text",autoComplete:"off",autoFocus:!0,label:"Search name",...l.getFieldProps("name"),error:l.touched.name&&l.errors.name?l.errors.name:void 0}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(h.Button,{type:"button",disabled:l.isSubmitting,onClick:t,children:"Cancel"}),e.jsx(h.Button,{type:"submit",disabled:l.isSubmitting,appearance:"positive","aria-label":`Saved search as ${l.values.name}`,children:"Save search"})]})]})},Ne="_container_fqj7b_1",Be="_prompt_fqj7b_10",ke="_saveButton_fqj7b_17",q={container:Ne,prompt:Be,saveButton:ke},Fe=({onSearchSave:t,search:n})=>{const[o,a]=u.useState(!1);return e.jsxs(e.Fragment,{children:[n&&o&&e.jsx(Ie,{onClose:()=>a(!1),onSearchSave:t,search:n}),n&&!o&&e.jsxs("div",{className:q.container,children:[e.jsxs("span",{className:q.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:n}),e.jsx("span",{children:"..."})]}),e.jsx(h.Button,{type:"button",appearance:"link",onClick:()=>a(!0),className:q.saveButton,children:"Save search"})]})]})},Pe="_searchContainer_t00ki_1",$e="_form_t00ki_8",qe="_searchBoxContainer_t00ki_13",Oe="_input_t00ki_17",B={searchContainer:Pe,form:$e,searchBoxContainer:qe,input:Oe},T=({inputText:t,savedSearches:n,search:o})=>{if(!n)return[];let a=n;if(o){const i=o.split(",").filter(Boolean);a=a.filter(({name:r})=>i.every(s=>s!==`search:${r}`))}return t&&(a=a.filter(({name:i,search:r})=>i.toLowerCase()!==t.trim().toLowerCase()&&r.toLowerCase()!==t.trim().toLowerCase())),a},Te=({onHelpButtonClick:t})=>{const{query:n,setPageParams:o}=v(),[a,i]=u.useState(""),[r,s]=u.useState(!1),{getSavedSearchesQuery:d}=O(),l=u.useRef(null),c=u.useRef(null);z(l,p=>{const j=document.querySelector(".p-modal");j&&j.contains(p.target)||s(!1)});const{data:x,isLoading:I}=d(),N=u.useMemo(()=>T({inputText:a,savedSearches:x==null?void 0:x.data,search:n}),[x,a,n]),y=()=>{if(!a)return;const j=T({inputText:"",savedSearches:x==null?void 0:x.data,search:n}).some(({name:Q})=>Q.toLowerCase()===a.trim().toLowerCase())?"search:":"";o({query:n?`${n},${j}${a}`:`${j}${a}`}),i("")},f=p=>{o({query:n?`${n},search:${p.name}`:`search:${p.name}`})},S=p=>{const{key:j}=p;r?(j==="Escape"&&s(!1),j==="Enter"&&y()):j==="Enter"&&s(!0)};return e.jsxs("div",{className:"p-search-and-filter",ref:l,children:[e.jsxs("div",{className:F("p-search-and-filter__search-container",B.searchContainer),"aria-expanded":r,ref:c,onClick:()=>s(!0),children:[e.jsx(h.Form,{onSubmit:p=>{p.preventDefault(),y()},className:F("p-search-and-filter__box",B.form),children:e.jsx("div",{className:B.searchBoxContainer,children:e.jsx(h.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autocomplete:"off",className:B.input,value:a,onChange:p=>i(p),onClear:()=>i(""),onSearch:y,onClick:()=>s(!0),onKeyUp:S})})}),e.jsx(we,{onHelpButtonClick:t})]}),r&&I&&e.jsx(D,{}),r&&!I&&e.jsxs("div",{className:"p-search-and-filter__panel",children:[e.jsx(Fe,{onSearchSave:()=>i(""),search:a.trim()}),e.jsx(Se,{onSavedSearchClick:f,onSavedSearchRemove:()=>s(!0),savedSearches:N})]})]})},Ee=({options:t,label:n,inline:o=!1})=>{const{accessGroups:a,setPageParams:i}=v();return C("accessGroups",t.map(r=>r.value)),e.jsx(w,{type:"multiple",label:n,hasToggleIcon:!0,hasBadge:!0,options:t,onItemsSelect:r=>{i({accessGroups:r})},selectedItems:a,inline:o})},Le=({options:t,label:n,inline:o=!1})=>{const[a,i]=u.useState(""),{availabilityZones:r,setPageParams:s}=v(),d=t.length>9&&a?t.filter(({value:c})=>c!=="none"&&c.includes(a)):t;C("availabilityZones",d.map(c=>c.value));const l=c=>{c[c.length-1]==="none"?s({availabilityZones:["none"]}):s({availabilityZones:c[0]!=="none"?c:c.filter(m=>m!=="none")})};return e.jsx(w,{type:"multiple",label:n,hasToggleIcon:!0,hasBadge:!0,onSearch:t.length>9?c=>{i(c)}:void 0,options:d,onItemsSelect:l,selectedItems:r,inline:o})},Re=({options:t,label:n,inline:o=!1})=>{const{os:a,setPageParams:i}=v();return C("os",t.map(r=>r.value)),e.jsx(w,{type:"single",hasBadge:!0,label:n,hasToggleIcon:!0,options:t,onItemSelect:r=>{i({os:r})},selectedItem:a,inline:o})},Ae=({options:t,label:n,inline:o=!1})=>{const[a,i]=u.useState(""),{tags:r,setPageParams:s}=v(),d=t.filter(({value:l})=>l.includes(a));return C("tags",d.map(l=>l.value)),e.jsx(w,{type:"multiple",label:n,hasToggleIcon:!0,hasBadge:!0,options:d,onItemsSelect:l=>{s({tags:l})},onSearch:l=>{i(l)},selectedItems:r,inline:o})},ze=[{term:"<keyword>",description:e.jsxs("span",{children:["Instances with the title or hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"distribution:<keyword>",description:e.jsxs("span",{children:["Instances with the installed distribution named"," ",e.jsx("code",{children:"<keyword>"})]})},{term:"needs:reboot",description:"Instances needing a reboot"},{term:"alert:<type>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with outstanding alerts of the specified"," ",e.jsx("code",{children:"<type>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be ",e.jsx("code",{children:"package-upgrades"}),","," ",e.jsx("code",{children:"security-upgrades"}),",",e.jsx("code",{children:"package-profiles"}),","," ",e.jsx("code",{children:"package-reporter"}),", ",e.jsx("code",{children:"esm-disabled"}),","," ",e.jsx("code",{children:"computer-offline"}),",",e.jsx("code",{children:"computer-reboot"}),","," ",e.jsx("code",{children:"computer-duplicates"}),", ",e.jsx("code",{children:"unapproved-activities"}),"."]})]})},{term:"ip:<address>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with IP addresses like ",e.jsx("code",{children:"<address>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<address>"})," can be a fragment or partial IP address representing a subnet such as 91.185.94 to match any instances in the subnet."]})]})},{term:"mac:<address>",description:e.jsxs("span",{children:["Instances with the MAC address ",e.jsx("code",{children:"<address>"})]})},{term:"id:<instance_id>",description:e.jsxs("span",{children:["Instance with the id ",e.jsx("code",{children:"<instance_id>"})]})},{term:"access-group:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," access group"]})},{term:"search:<name>",description:e.jsxs("span",{children:["Instances meeting the terms of the ",e.jsx("code",{children:"<name>"})," saved search"]})},{term:"upgrade-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," upgrade profile"]})},{term:"removal-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," removal profile"]})},{term:"tag:<keyword>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<keyword>"})," tag"]})},{term:"hostname:<keyword>",description:e.jsxs("span",{children:["Instance with the hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"title:<keyword>",description:e.jsxs("span",{children:["Instance with the title ",e.jsx("code",{children:"<keyword>"})]})},{term:"license-id:<license_id>",description:e.jsxs("span",{children:["Search for instances licensed to the specified"," ",e.jsx("code",{children:"<license_id>"})]})},{term:"needs:license OR license-id:none",description:"Search for instances that do not have a Landscape license, and, as a result, are not managed"},{term:"annotation:<key>",description:e.jsxs("span",{children:["Search for instances which define the specified annotation key. Optionally specify ",e.jsx("code",{children:"annotation:<key>:<string>"})," ","which will only return instances whose key matches and value also contains the ",e.jsx("code",{children:"<string>"})," specified"]})},{term:"security-profiles:<security-profile-id>:<pass|fail|in-progress>",description:e.jsxs("span",{children:["Search for the security profiles with a specified id. Optionally specify"," ",e.jsx("code",{children:"security-profiles:<security-profiles-id>:<pass|fail|in-progress>"})," ","which will only return security profiles whose id matches, and value also contains ",e.jsx("code",{children:"pass"}),", ",e.jsx("code",{children:"fail"}),","," ",e.jsx("code",{children:"in-progress"})," as specified"]})}],De="_top_vq47y_1",Ge="_searchContainer_vq47y_13",Qe="_divider_vq47y_22",k={top:De,searchContainer:Ge,divider:Qe},He="_menuContainer_xrtuf_1",Ke="_wrapper_xrtuf_6",E={menuContainer:He,wrapper:Ke},Me="_root_1fm3p_1",Ve="_label_1fm3p_5",Ze="_text_1fm3p_16",Ue="_icon_1fm3p_20",We="_content_1fm3p_24",_={root:Me,label:Ve,text:Ze,icon:Ue,content:We},Xe=({el:t})=>{const[n,o]=u.useState(!1),a=u.useRef(null);z(a,()=>{n&&o(!1)});const i=u.cloneElement(t,{inline:!0});return e.jsxs("div",{ref:a,className:_.root,children:[e.jsxs(h.Button,{type:"button",appearance:"base",className:_.label,onClick:()=>{o(r=>!r)},children:[e.jsx(h.Icon,{name:"chevron-down",className:_.icon}),e.jsx("span",{className:_.text,children:t.props.label})]}),n&&e.jsx("div",{className:`p-contextual-menu__dropdown ${_.content}`,children:i})]})},Je=({filters:t,collapseFrom:n="md",menuLabel:o="Filters",className:a,menuPosition:i="right"})=>{const r=W(`(min-width: ${X[n]}px)`);return e.jsx("div",{className:F(E.wrapper,a),children:r?t.map((s,d)=>e.jsx("span",{children:s},d)):e.jsx(h.ContextualMenu,{position:i,hasToggleIcon:!0,toggleLabel:o,toggleClassName:"u-no-margin--bottom",children:e.jsx("div",{className:E.menuContainer,children:t.map((s,d)=>s.type.name?e.jsx(Xe,{el:s},d):s)})})})},Ye=({columnFilterOptions:t})=>{const[n,o]=u.useState(!1),{getAccessGroupQuery:a}=he(),{getAllInstanceTagsQuery:i,getAvailabilityZonesQuery:r}=G(),{data:s}=i(),d=(s==null?void 0:s.data.results.map(f=>({label:f,value:f})))??[],{data:l}=r(),c=((l==null?void 0:l.data.values)??[]).reduce((f,S)=>(f.push({label:S,value:S}),f),[{label:"Without zones",value:"none",group:"1"}]),{data:m}=a(),x=(m==null?void 0:m.data.map(({name:f,title:S})=>({value:f,label:S})))??[],I=b.groupBy.options,N=b.status.options,y=b.os.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:k.top,children:[e.jsx("div",{className:k.searchContainer,children:e.jsx(Te,{onHelpButtonClick:()=>{o(!0)}})}),e.jsx(Je,{collapseFrom:"xxl",filters:[e.jsx(de,{label:"Group by",options:I},"group"),e.jsx("span",{className:k.divider},"divider-1"),e.jsx(J,{label:"Status",options:N},"status"),e.jsx(Re,{label:"OS",options:y},"os"),e.jsx(Le,{label:"Availability zones",options:c},"availability-zone"),e.jsx(Ee,{label:"Access groups",options:x},"access-group"),e.jsx(Ae,{label:"Tags",options:d},"tag"),e.jsx("span",{className:k.divider},"divider-2"),e.jsx(me,{label:"Columns",options:t},"column")]})]}),e.jsx(Y,{filtersToDisplay:["accessGroups","os","availabilityZones","status","tags","query"],accessGroupOptions:x,availabilityZonesOptions:c,osOptions:y,statusOptions:N,tagOptions:d}),e.jsx(ee,{open:n,data:ze,onClose:()=>{o(!1)}}),e.jsx(oe,{})]})},es=u.memo(function({instanceCount:n,instances:o,isGettingInstances:a,selectedInstances:i,setSelectedInstances:r}){const[s,d]=u.useState([]),l=u.useCallback(()=>{r([])},[]);return e.jsxs(e.Fragment,{children:[e.jsx(Ye,{columnFilterOptions:s}),a?e.jsx(D,{}):e.jsx(ie,{instances:o,selectedInstances:i,setColumnFilterOptions:d,setSelectedInstances:r}),e.jsx(se,{totalItems:n,handleClearSelection:l,currentItemCount:o.length})]})}),L=(t,n)=>{var o;return t.type==="select"?((o=t.options.find(a=>a.value===n))==null?void 0:o.query)??"":""},ss=({accessGroups:t,availabilityZones:n,os:o,query:a,status:i,tags:r})=>{const s=[];return o&&s.push(L(b.os,o)),i&&s.push(L(b.status,i)),a&&s.push(...a.split(",")),r.length&&s.push(`tag:${r.join(" OR tag:")}`),t.length&&s.push(`access-group:${t.join(" OR access-group:")}`),n.length&&s.push(n.includes("none")?"availability-zone:null":`availability-zone:${n.join(" OR availability-zone:")}`),s.join(" ")},ds=()=>{const{currentPage:t,pageSize:n,groupBy:o,...a}=v(),{getInstancesQuery:i}=G(),{data:r,isLoading:s}=i({query:ss(a),root_only:o==="parent",archived_only:a.status==="archived",with_alerts:!0,with_upgrades:te,limit:n,offset:(t-1)*n}),d=(r==null?void 0:r.data.results)??[],{selectedItems:l,setSelectedItems:c}=le(d,s);return e.jsxs(ne,{children:[e.jsx(ae,{title:"Instances",actions:[e.jsx(ce,{isGettingInstances:s,selectedInstances:l},"actions")],sticky:!0}),e.jsx(re,{children:e.jsx(es,{instanceCount:r==null?void 0:r.data.count,instances:d,isGettingInstances:s,selectedInstances:l,setSelectedInstances:c})})]})};export{ds as default};
