import{p as P,e as _,r as k,j as s,N as f,g as i,h as b,o as C}from"./index-CreLYkd7.js";import{P as M,a as $,b as w}from"./PageMain-ChZU1taS.js";import{d as E,s as g}from"./DistributionCard.module-CdGw1YvC.js";import"./InfoItem.module-BZ3tYMsb.js";import"./MultiSelectField.module-D1r8qo_i.js";import"./index.esm-Co3jed-Q.js";import{u as N,c as v}from"./ApiCredentialsTables.module-CFVWLGgF.js";import{I as A}from"./InfoItem-DVjSC8Rv.js";import{u as R}from"./useConfirm-Bodc886s.js";import"./useMutation-CvjNgrEE.js";import"./useQuery-TlFJgfqc.js";import"./formik.esm-C2DYiXJC.js";import"./SidePanelFormButtons.module-DyBJG5lm.js";const G=({user:n,credentials:o})=>{const l=P("(min-width: 620px)"),{confirmModal:u,closeConfirmModal:r}=R(),h=_(),{generateApiCredentials:d}=N(),{mutateAsync:c,isLoading:x}=d,j=async a=>{try{await c({account:a})}catch(e){h(e)}finally{r()}},m=({accountName:a,accountTitle:e,action:t})=>{u({title:`${t} API credentials for ${e}`,body:`${t==="Regenerate"?`${t.slice(0,-1)}ing your API credentials will make your previously used credentials obsolete and deauthenticate any clients using them. `:""}This action will create new credentials for integrating with the ${e} organisation`,buttons:[s.jsxs(i.Button,{appearance:"negative",hasIcon:!0,onClick:()=>j(a),"aria-label":`${t} API credentials confirmation for ${e}`,children:[x&&s.jsx(i.Spinner,{}),t," API credentials"]},"confirm-generate-credentials")]})},I=k.useMemo(()=>[{Header:"Label",accessor:"label"},{Header:"Value",accessor:"value",Cell:({value:a})=>a}],[n,o]);return n.accounts.map(a=>{const e=o.find(p=>p.account_name===a.name),t=[{label:"Name",value:e==null?void 0:e.account_name},{label:"Title",value:e==null?void 0:e.account_title},{label:"Identity",value:s.jsx("code",{children:n.identity})},{label:"Endpoint",value:s.jsx("code",{children:e==null?void 0:e.endpoint})},{label:"Access Key",value:e!=null&&e.access_key?s.jsx("code",{children:e.access_key}):f},{label:"Secret Key",value:e!=null&&e.secret_key?s.jsx("code",{children:e.secret_key}):f},{label:"Roles",value:a.roles.join(", ")}],y=e!=null&&e.secret_key||e!=null&&e.access_key?"Regenerate":"Generate";return s.jsx("div",{className:E.item,children:s.jsxs("div",{className:g.card,children:[s.jsxs("div",{className:g.header,children:[s.jsx("p",{className:g.title,children:a.title}),s.jsx(i.Button,{className:b("u-no-margin--bottom",{"is-small":l}),onClick:()=>m({accountName:a.name,accountTitle:a.title,action:y}),children:s.jsxs("span",{children:[y," API credentials"]})})]}),s.jsx("div",{className:b(g.content,v.tableWrapper),children:l?s.jsx(i.ModularTable,{columns:I,data:t,emptyMsg:"No data available"}):t.map((p,L)=>s.jsxs(i.Row,{className:b("u-no-padding--left u-no-padding--right",v.apiCredentials),children:[s.jsx(i.Col,{size:2,small:2,children:s.jsx(A,{label:"",value:p.label})}),s.jsx(i.Col,{size:2,small:2,children:s.jsx(A,{label:"",value:p.value})})]},L))})]})},a.title)})},K=()=>{var m;const{getUserDetails:n,getUserApiCredentials:o}=N(),{data:l,isLoading:u}=n(),{data:r,isLoading:h}=o(),d=l==null?void 0:l.data,c=(m=r==null?void 0:r.data)==null?void 0:m.credentials,x=d&&c,j=u||h;return s.jsxs(M,{children:[s.jsx($,{title:"API credentials"}),s.jsxs(w,{children:[j&&s.jsx(C,{}),x&&s.jsx(G,{user:d,credentials:c})]})]})},J=K;export{J as default};
