import{s as S,G as x,q as j,t as A,H as E,v as k,j as e,e as n,I as s}from"./index-CmmfIHlE.js";import{K as N}from"./constants-DFg9etwb.js";import{u as w}from"./index-_t0kUPmW.js";import{U as B,a as I,N as R}from"./constants-Dwl1JGyb.js";import{D as O}from"./DeliveryBlock-nIrxIOzT.js";import{R as T}from"./RandomizationBlock-Cai5f0B7.js";import"./PageMain-Cm2imCsJ.js";import"./useGetInstance-CQ4Bi6H1.js";import"./useUsns-BNVM5xxE.js";import"./constants-B3UTGQVM.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./RadioGroup-BCxqBwme.js";const W=({currentKernelVersion:l,upgradeKernelVersions:r,instanceName:c})=>{const m=S(),{instanceId:u}=x(),{closeSidePanel:d}=j(),{notify:p}=A(),{upgradeKernelQuery:_}=w(),{openActivityDetails:f}=E(),{mutateAsync:b,isPending:o}=_,v=[{label:"Select",value:""},...r.map(t=>({label:t.version_rounded,value:t.id.toString()}))],g={deliver_immediately:!0,randomize_delivery:!1,deliver_delay_window:0,deliver_after:"",new_kernel_version_id:r.length===1?r[0].id.toString():"",reboot_after:!1},i=k({initialValues:g,validationSchema:N,onSubmit:async t=>{try{const{data:a}=await b({id:Number(u),kernel_package_id:Number(t.new_kernel_version_id),reboot_after:t.reboot_after,deliver_after:t.deliver_immediately?void 0:t.deliver_after,deliver_delay_window:t.randomize_delivery?t.deliver_delay_window:void 0});d();const y=t.reboot_after?B:I;p.success({title:`You queued kernel upgrade for "${c}"`,message:y,actions:[{label:"View details",onClick:()=>{f(a)}}]})}catch(a){m(a)}}}),h=async()=>{await i.setFieldValue("reboot_after",!0),i.handleSubmit()};return e.jsxs(n.Form,{onSubmit:i.handleSubmit,children:[e.jsx(n.Notification,{severity:"information",title:"Restart recommended",children:e.jsx("span",{children:R})}),e.jsxs(s,{spaced:!0,children:[e.jsx(s.Item,{label:"Current version",value:l}),e.jsx(s.Item,{label:"New version",value:r.length===1?e.jsx("span",{children:r[0].version_rounded}):e.jsx(n.Select,{options:v,...i.getFieldProps("new_kernel_version")})})]}),e.jsx(O,{formik:i}),e.jsx(T,{formik:i}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(n.Button,{type:"button",appearance:"base",onClick:d,children:"Cancel"}),e.jsx(n.ConfirmationButton,{type:"button",confirmationModalProps:{title:"Upgrading kernel and restarting instance",children:e.jsx("p",{children:"Are you sure? This action will upgrade the kernel and restart the instance."}),confirmButtonLabel:"Upgrade and Restart",confirmButtonAppearance:"positive",confirmButtonLoading:o,confirmButtonDisabled:o,onConfirm:h},children:"Upgrade and Restart"}),e.jsx(n.ConfirmationButton,{type:"button",appearance:"positive",confirmationModalProps:{title:"Upgrading kernel",children:e.jsx("p",{children:"Are you sure? This action will upgrade the kernel."}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:o,confirmButtonDisabled:o,type:"submit",onConfirm:()=>{i.handleSubmit()}},children:"Upgrade kernel"})]})]})};export{W as default};
