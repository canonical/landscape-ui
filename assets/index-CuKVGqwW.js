import{G as U,P as j,z as S,B as b,j as t,d as l,x as p,I,R as L,r as P,s as m,D as d,e as E,E as _}from"./index-Dfc97QGW.js";import"./index-S_kjB96R.js";import{u as g}from"./useUsns-DqfdHX4t.js";import{a as v}from"./TableFilterChips-DXWGZ6VK.js";import{H as k}from"./HeaderWithSearch-cCuZhEhs.js";import{U as A}from"./UsnList-CdV8gsGU.js";import"./NoData-DMN9LLPq.js";import"./ResponsiveTable-ViIMTRR6.js";import"./TablePagination-B0v8QAQr.js";import"./useFetchOld-BgGVMMmJ.js";import"./PageParamFilter-C5PJgjVf.js";import"./TableFilter-BmLRyeMD.js";import"./formikErrors-Bw8iTXYS.js";import"./constants-BTpoIHxf.js";import"./InstancesPageActions-Dns4Yse-.js";import"./ListTitle-DsIgCqjQ.js";import"./StaticLink-BNg3qc2M.js";import"./TruncatedCell-Cf7_euhM.js";import"./Truncated-D8EZCoK1.js";import"./useExpandableRow-DYtdXwcw.js";import"./index-DiSNWm9B.js";import"./TextConfirmationModal-O9rtHEfo.js";import"./InfoGrid-CrJbMYy5.js";import"./InfoItem-DImpX37B.js";import"./SelectAllButton-7i8VoFdt.js";import"./ExpandableTableFooter-DCAqkxh9.js";const N="_actions_1l3g0_1",w={actions:N},B=({usns:s})=>{const{instanceId:e,childInstanceId:a}=U(),i=j(),n=S(),{notify:r}=b(),{upgradeInstanceUsnsQuery:o}=g(),c=Number(e),{mutateAsync:h,isPending:u}=o,f=()=>{i(L.instances.details.fromParams({instanceId:e,childInstanceId:a},{tab:"activities"})),r.clear()},y=async()=>{try{await h({instanceId:c,usns:s}),r.success({title:"You queued packages to be upgraded",message:`Affected packages for ${p(s.length,`"${s[0]}" security issue`,`${s.length} selected security issues`)} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:f}]})}catch(x){n(x)}};return t.jsxs(t.Fragment,{children:[t.jsx(k,{actions:t.jsx("div",{className:I("p-segmented-control",w.actions),children:t.jsxs(l.ConfirmationButton,{className:"p-segmented-control__button has-icon u-no-margin--bottom",type:"button",disabled:s.length===0,confirmationModalProps:{title:"Upgrade affected packages",children:t.jsxs("p",{children:["This will upgrade affected packages for"," ",p(s.length,`"${s[0]}" security issue`,`${s.length} selected security issues`),"."]}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:u,confirmButtonDisabled:u,onConfirm:y},children:[t.jsx(l.Icon,{name:"change-version"}),t.jsx("span",{children:"Upgrade"})]})})}),t.jsx(v,{filtersToDisplay:["search"]})]})},C=({instance:s,isUsnsLoading:e,totalUsnCount:a,usns:i})=>{const[n,r]=P.useState([]),{search:o}=m();return t.jsxs(t.Fragment,{children:[t.jsx(B,{usns:n}),t.jsx(A,{tableType:"paginated",instances:[s],isUsnsLoading:e,onSelectedUsnsChange:c=>{r(c)},search:o,selectedUsns:n,totalUsnCount:a,usns:i})]})},D=({currentPage:s,getUsnsQueryLoading:e,pageSize:a,search:i})=>!i&&s===1&&a===d&&e,T=({search:s,currentPage:e,pageSize:a,getUsnsQueryLoading:i,getUsnsQueryResult:n})=>!s&&e===1&&a===d&&!i&&(!n||n.data.results.length===0),F=({currentPage:s,getUsnsQueryLoading:e,getUsnsQueryResult:a,pageSize:i,search:n})=>n||s>1||i!==d||!e&&a&&a.data.results.length>0,us=({instance:s})=>{const{search:e,currentPage:a,pageSize:i}=m(),{getUsnsQuery:n}=g(),{data:r,isLoading:o}=n({computer_ids:[s.id],limit:i,offset:(a-1)*i,search:e,show_packages:!1});return t.jsxs(t.Fragment,{children:[D({search:e,currentPage:a,pageSize:i,getUsnsQueryLoading:o})&&t.jsx(E,{}),T({search:e,currentPage:a,pageSize:i,getUsnsQueryLoading:o,getUsnsQueryResult:r})&&t.jsx(_,{icon:"inspector-debug",title:"No security issues found"}),F({currentPage:a,getUsnsQueryLoading:o,getUsnsQueryResult:r,pageSize:i,search:e})&&t.jsx(C,{instance:s,isUsnsLoading:o,totalUsnCount:r?.data.count??0,usns:r?.data.results??[]})]})};export{us as default};
