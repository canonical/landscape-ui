const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CpmQD6w5.js","assets/index-UpX-dzun.js","assets/index-tBQFzVrl.css","assets/HeaderWithSearch-Brh4C753.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/CellInput-B0QV_DrH.js","assets/SidePanelTablePagination-CnTgzfR7.js","assets/PageMain-B5bGF__y.js","assets/PageMain--v5xNZ5p.css","assets/useRoles-CcEshkSd.js","assets/index-Bd5xryFE.css","assets/index-BcHLIuCd.js","assets/AssociationBlock-A9pFAvtO.js","assets/MultiSelectField-C6gzHj7Y.js","assets/MultiSelectField-GyNA33om.css","assets/useInstances-CCIYSZv0.js","assets/AssociationBlock-DQBJa-xL.css","assets/SidePanelFormButtons-Ba4swt1J.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/index-DUI05Sge.js","assets/index-ByT4mrQt.js","assets/FileInput-zwTPq-Lx.js","assets/PackageProfileConstraintsBlock-DAleXvCi.js","assets/PackageProfileConstraintsBlock-BiZCuDKK.css","assets/index-C9DK3QBb.css"])))=>i.map(i=>d[i]);
import{f as V,i as H,e as B,g as _,h as N,F as E,H as y,M as F,J as K,G as O,a9 as W,r,j as e,o as f,m as c,l as b,_ as j,y as q,z as L,I as v,a2 as w,af as G,ak as U,c as Y,n as J,ab as X,N as Z,aj as ee,E as ae}from"./index-UpX-dzun.js";import{P as se,a as te,b as ne}from"./PageMain-B5bGF__y.js";import{u as D}from"./useRoles-CcEshkSd.js";import{H as R}from"./HeaderWithSearch-Brh4C753.js";import{S as ie}from"./SidePanelTablePagination-CnTgzfR7.js";function T(){const a=V(),s=H(),o=B(),d=(i={},l={})=>N({queryKey:["packageProfiles",i],queryFn:async()=>s.get("packageprofiles",{params:i}),...l}),m=_({mutationFn:async i=>s.post("packageprofiles",i),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),n=_({mutationFn:async i=>s.post("packageprofiles",i),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),p=_({mutationFn:async i=>o.get("RemovePackageProfile",{params:i}),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),g=_({mutationFn:async({name:i,...l})=>s.put(`packageprofiles/${i}`,l),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),k=({instanceId:i,...l},x={})=>N({queryKey:["instancePackageProfiles",{instanceId:i,...l}],queryFn:async()=>s.get(`computers/${i}/packages/profile`,{params:l}),...x}),t=({name:i,...l},x={})=>N({queryKey:["packageProfileConstraints",{name:i,...l}],queryFn:async()=>s.get(`packageprofiles/${i}/constraints`,{params:l}),...x}),u=_({mutationFn:async({name:i,...l})=>s.post(`packageprofiles/${i}/constraints`,l),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),h=_({mutationFn:async({id:i,name:l,...x})=>s.put(`packageprofiles/${l}/constraints/${i}`,x),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),P=_({mutationFn:async({name:i,...l})=>s.delete(`packageprofiles/${i}/constraints`,{params:l}),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])});return{addPackageProfileConstraintsQuery:u,copyPackageProfileQuery:m,createPackageProfileQuery:n,editPackageProfileConstraintQuery:h,editPackageProfileQuery:g,getInstancePackageProfileQuery:k,getPackageProfileConstraintsQuery:t,getPackageProfilesQuery:d,removePackageProfileConstraintsQuery:P,removePackageProfileQuery:p}}const Q={constraint:"",notAnyVersion:!1,package:"",rule:"",version:""},Ve=Object.fromEntries(Object.keys(Q).map(a=>[a,!0])),oe={constraint:"",id:0,package:"loading",rule:"",version:"",notAnyVersion:!1},ce=[{label:"Any",value:""},{label:"Newer or equal to",value:">="},{label:"Newer than",value:">"},{label:"Equal to",value:"="},{label:"Older than",value:"<"},{label:"Older or equal to",value:"<="}],re=[{label:"Select",value:""},{label:"Conflicts with",value:"conflicts"},{label:"Depends on",value:"depends"}],He={access_group:"",all_computers:!1,constraints:[Q],constraintsType:"",csvFile:null,description:"",isCsvFileParsed:!1,material:"",source_computer_id:0,tags:[],title:""},Be=E().shape({access_group:y(),all_computers:O(),constraints:F().when("constraintsType",{is:"manual",then:a=>a.of(E().shape({constraint:y().required("Required."),notAnyVersion:O(),package:y().required("Required."),rule:y().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")}),version:y().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")})})).min(1,"Package profiles must have at least one package constraint.")}),constraintsType:y().required("This field is required."),csvFile:W().nullable().test({name:"mime-type",message:"Invalid file type.",test:a=>!a||a.type==="text/csv"}).when("constraintsType",{is:"material",then:a=>a.required("This field is required.")}),description:y().required("This field is required."),isCsvFileParsed:O(),material:y().when("constraintsType",{is:"material",then:a=>a.required("The file cannot be empty.")}),source_computer_id:K().when("constraintsType",{is:"instance",then:a=>a.min(1,"This field is required.")}),tags:F().of(y()),title:y().required("This field is required.")}),le="_constraint_1lz67_1",de="_hidden_1lz67_5",M={constraint:le,hidden:de},ue=({row:a,column:s})=>{const o={};return a.original.package==="loading"?s.id==="package"?o.colSpan=3:(o.className=M.hidden,o["aria-hidden"]=!0):s.id==="package"?o.role="rowheader":s.id==="constraint"?o["aria-label"]="Constraint":s.id==="rule"?o["aria-label"]="Rule":s.id==="version"&&(o["aria-label"]="Version"),o},pe=({isConstraintsLoading:a,profileConstraints:s,search:o})=>{const d=r.useMemo(()=>a?[oe]:s?s.map(n=>({...n,notAnyVersion:!!n.version})):[],[a,s]),m=r.useMemo(()=>[{accessor:"constraint",className:M.constraint,Header:"Constraint",Cell:({row:{original:n}})=>{var p;return((p=re.find(({value:g})=>g===n.constraint))==null?void 0:p.label)??n.constraint}},{accessor:"package",Header:"Package",Cell:({row:{original:n}})=>n.package==="loading"?e.jsx(f,{}):n.package},{accessor:"version",Header:"Version",Cell:({row:{original:n}})=>{var p;return n.version?`${(p=ce.find(({value:g})=>g===n.rule))==null?void 0:p.label} ${n.version}`:"Any"}}],[d]);return e.jsx(c.ModularTable,{columns:m,data:d,getCellProps:ue,emptyMsg:`No constraints found with the search: "${o}"`})},ge="_actions_nxngq_1",me={actions:ge},he=r.lazy(()=>j(()=>import("./index-CpmQD6w5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),Pe=({profile:a})=>{const[s,o]=r.useState(1),[d,m]=r.useState(20),[n,p]=r.useState(""),{setSidePanelContent:g}=b(),{getPackageProfileConstraintsQuery:k}=T(),{data:t,isLoading:u}=k({name:a.name,limit:d,offset:(s-1)*d,search:n}),h=()=>{g(`Change "${a.title}" profile's constraints`,e.jsx(r.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(he,{profile:a})}),"medium")};return e.jsxs(e.Fragment,{children:[!n&&s===1&&d===20&&u&&e.jsx(f,{}),(n||s!==1||d!==20||!u&&t&&t.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(R,{className:me.actions,onSearch:P=>p(P),actions:e.jsx(c.Button,{className:"u-no-margin--bottom",type:"button",onClick:h,children:"Change package constraints"})}),e.jsx(pe,{isConstraintsLoading:u,profileConstraints:t==null?void 0:t.data.results,search:n}),e.jsx(ie,{currentPage:s,pageSize:d,paginate:P=>o(P),setPageSize:P=>m(P),totalItems:t==null?void 0:t.data.count})]})]})},fe=r.lazy(async()=>j(()=>import("./index-BcHLIuCd.js"),__vite__mapDeps([11,1,2,12,13,14,15,16,17,18,19,9,7,8,3,4,6]))),ye=r.lazy(async()=>j(()=>import("./index-DUI05Sge.js"),__vite__mapDeps([20,1,2,17,18,19,12,13,14,15,16,7,8,9,3,4,6]))),ke=({profile:a})=>{var $,I;const[s,o]=r.useState(!1),d=q(),{notify:m}=L(),{closeSidePanel:n,setSidePanelContent:p}=b(),{removePackageProfileQuery:g}=T(),{getAccessGroupQuery:k}=D(),{data:t}=k(),u=(t==null?void 0:t.data)??[],{mutateAsync:h,isPending:P}=g,i=()=>{o(!0)},l=()=>{o(!1)},x=async()=>{try{await h({name:a.name}),l(),n(),m.success({message:`Package profile "${a.name}" removed successfully.`,title:"Package profile removed"})}catch(A){d(A)}},S=()=>{p("Edit package profile",e.jsx(r.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(ye,{profile:a})}))},z=()=>{p("Duplicate package profile",e.jsx(r.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(fe,{profile:a})}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(c.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:z,children:[e.jsx(c.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate profile"})]}),e.jsxs(c.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:S,children:[e.jsx(c.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(c.Button,{className:"p-segmented-control__button",hasIcon:!0,type:"button",onClick:i,"aria-label":`Remove ${a.title} package profile`,children:[e.jsx(c.Icon,{name:c.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(c.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(c.Col,{size:3,children:e.jsx(v,{label:"Name",value:a.title})}),e.jsx(c.Col,{size:9,children:e.jsx(v,{label:"Description",value:a.description})}),e.jsx(c.Col,{size:3,children:e.jsx(v,{label:"Access group",value:(($=u.find(A=>A.name===a.access_group))==null?void 0:$.title)??a.access_group})}),e.jsx(c.Col,{size:9,children:e.jsx(v,{label:"Tags",value:a.tags.join(", ")})}),e.jsx(c.Col,{size:3,children:e.jsx(v,{label:"Associated to",value:`${a.computers.constrained.length} instances`})}),e.jsx(c.Col,{size:3,children:e.jsx(v,{label:"Pending on",value:`${((I=a.computers.pending)==null?void 0:I.length)??0} instances`})}),e.jsx(c.Col,{size:3,children:e.jsx(v,{label:"Not compliant on",value:`${a.computers["non-compliant"].length} instances`})})]}),e.jsx(Pe,{profile:a}),e.jsx(w,{isOpen:s,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:P,confirmButtonDisabled:P,close:l,confirmationText:`remove ${a.name}`,onConfirm:x,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},xe=r.lazy(async()=>j(()=>import("./index-CpmQD6w5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),je=r.lazy(async()=>j(()=>import("./index-BcHLIuCd.js"),__vite__mapDeps([11,1,2,12,13,14,15,16,17,18,19,9,7,8,3,4,6]))),_e=r.lazy(async()=>j(()=>import("./index-DUI05Sge.js"),__vite__mapDeps([20,1,2,17,18,19,12,13,14,15,16,7,8,9,3,4,6]))),ve=({profile:a})=>{const s=q(),{notify:o}=L(),{setSidePanelContent:d}=b(),{removePackageProfileQuery:m}=T(),{value:n,setTrue:p,setFalse:g}=G(),{mutateAsync:k,isPending:t}=m,u=()=>{d(`Change "${a.title}" profile's constraints`,e.jsx(r.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(xe,{profile:a})}),"medium")},h=()=>{d(`Edit "${a.title}" profile`,e.jsx(r.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(_e,{profile:a})}))},P=()=>{d(`Duplicate "${a.title}" profile`,e.jsx(r.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(je,{profile:a})}))},i=async()=>{try{await k({name:a.name}),g(),o.success({message:`Package profile "${a.title}" removed successfully`,title:"Package profile removed"})}catch(S){s(S)}},l=[{icon:"edit",label:"Edit","aria-label":`Edit ${a.title} profile`,onClick:h},{icon:"applications",label:"Change package constraints","aria-label":`Change ${a.title} package constraints`,onClick:u},{icon:"canvas",label:"Duplicate","aria-label":`Duplicate ${a.title} profile`,onClick:P}],x=[{icon:"delete",label:"Remove","aria-label":`Remove ${a.title} profile`,onClick:p}];return e.jsxs(e.Fragment,{children:[e.jsx(U,{toggleAriaLabel:`${a.title} profile actions`,actions:l,destructiveActions:x}),e.jsx(w,{isOpen:n,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:t,confirmButtonDisabled:t,close:g,confirmationText:`remove ${a.name}`,onConfirm:i,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},be=`These instances are not compliant
with the profile. They do not have a
pending activity to become compliant.`,Ce=`These instances are not compliant
with the profile. They do have a
pending activity to apply its
constraints.`,Te=({column:a})=>{const s={};return a.id==="name"?s.role="rowheader":a.id==="description"?s["aria-label"]="Description":a.id==="access_group"?s["aria-label"]="Access group":a.id==="tags"?s["aria-label"]="Tags":a.id==="computers['non-compliant']"?s["aria-label"]="Not compliant instances":a.id==="computers['pending']"?s["aria-label"]="Pending instances":a.id==="computers['constrained']"?s["aria-label"]="Associated instances":a.id==="actions"&&(s["aria-label"]="Actions"),s},Se="_truncated_16ima_1",Ae="_noWrap_16ima_2",Ne="_description_16ima_11",C={truncated:Se,noWrap:Ae,description:Ne},Oe=({packageProfiles:a})=>{const{search:s}=Y(),{setSidePanelContent:o}=b(),{getAccessGroupQuery:d}=D(),{data:m}=d(),n=(m==null?void 0:m.data.map(({name:t,title:u})=>({label:u,value:t})))??[],p=t=>{o(t.title,e.jsx(ke,{profile:t}),"medium")},g=r.useMemo(()=>s?a.filter(t=>t.title.toLowerCase().includes(s.toLowerCase())):a,[a,s]),k=r.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:{original:t}})=>e.jsx(c.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{p(t)},children:t.title})},{accessor:"description",className:J(C.truncated,C.description),Header:"Description"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:{access_group:t}}})=>{var u;return((u=n.find(({value:h})=>h===t))==null?void 0:u.label)??t}},{accessor:"tags",className:C.truncated,Header:"Tags",Cell:({row:{original:{tags:t}}})=>t.length>0?t.join(", "):e.jsx(Z,{})},{accessor:"computers['non-compliant']",Header:e.jsxs("div",{className:C.noWrap,children:[e.jsx("span",{children:"Not compliant "}),e.jsx(c.Tooltip,{position:"btm-left",message:be,children:e.jsx(c.Icon,{name:"help"})})]}),Cell:({row:{original:t}})=>e.jsx(e.Fragment,{children:`${t.computers["non-compliant"].length} ${t.computers["non-compliant"].length===1?"instance":"instances"}`})},{accessor:"computers['pending']",Header:e.jsxs("div",{className:C.noWrap,children:[e.jsx("span",{children:"Pending "}),e.jsx(c.Tooltip,{position:"btm-left",message:Ce,children:e.jsx(c.Icon,{name:"help"})})]}),Cell:({row:{original:t}})=>{var u,h;return e.jsx(e.Fragment,{children:`${((u=t.computers.pending)==null?void 0:u.length)??0} ${((h=t.computers.pending)==null?void 0:h.length)===1?"instance":"instances"}`})}},{accessor:"computers['constrained']",Header:"Associated",Cell:({row:{original:t}})=>e.jsx(e.Fragment,{children:`${t.computers.constrained.length} ${t.computers.constrained.length===1?"instance":"instances"}`})},{...X,Cell:({row:{original:t}})=>e.jsx(ve,{profile:t})}],[g,n.length]);return e.jsx(c.ModularTable,{columns:k,data:g,emptyMsg:`No package profiles found with the search "${s}"`,getCellProps:Te})},$e=()=>e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsx(ee,{filtersToDisplay:["search"]})]}),Ie=r.lazy(()=>j(()=>import("./index-ByT4mrQt.js").then(a=>a.i),__vite__mapDeps([21,1,2,22,23,5,24,15,9,12,13,14,16,17,18,19,25]))),Ee=()=>{const{setSidePanelContent:a}=b(),s=()=>{a("Add package profile",e.jsx(r.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(Ie,{})}),"medium")};return e.jsx(ae,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You haven’t added any package profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-packages",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage packages in Landscape"})]}),cta:[e.jsx(c.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add")],title:"No package profiles found"})},Fe=({packageProfiles:a=[]})=>e.jsxs(e.Fragment,{children:[e.jsx($e,{}),e.jsx(Oe,{packageProfiles:a})]}),qe=()=>{const{getPackageProfilesQuery:a}=T(),{data:s,isLoading:o}=a();return e.jsxs(e.Fragment,{children:[o&&e.jsx(f,{}),!o&&(!s||s.data.result.length===0)&&e.jsx(Ee,{}),!o&&s&&s.data.result.length>0&&e.jsx(Fe,{packageProfiles:s==null?void 0:s.data.result})]})},Le=r.lazy(()=>j(()=>import("./index-ByT4mrQt.js").then(a=>a.a),__vite__mapDeps([21,1,2,22,23,5,24,15,9,12,13,14,16,17,18,19,25])).then(a=>({default:a.PackageProfileCreateForm}))),we=()=>{const{setSidePanelContent:a}=b(),s=()=>{a("Add package profile",e.jsx(r.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(Le,{})}),"medium")};return e.jsxs(se,{children:[e.jsx(te,{title:"Package profiles",actions:[e.jsx(c.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add-package-profile")]}),e.jsx(ne,{children:e.jsx(qe,{})})]})},Ke=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"}));export{re as C,Q as E,He as I,oe as L,Oe as P,Ve as T,Be as V,ce as a,$e as b,Ee as c,Ke as i,T as u};
