const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CHInTjpF.js","assets/index-B_G_5wPF.js","assets/index-Dm-pTgDZ.css","assets/MultiSelectField-Cuq4qe6H.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-XM1c0Oqk.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/useRoles-CqwO4URy.js","assets/PageMain-oN9SPVR-.js","assets/PageMain-DJy-4N2e.css","assets/HeaderWithSearch-BtAoyXnn.js","assets/HeaderWithSearch-C2lwo0VI.css"])))=>i.map(i=>d[i]);
import{f as z,e as O,i as H,g as f,h as F,A as I,B as P,C as T,J as Q,Q as E,M as $,r as v,j as e,n as u,k as x,I as S,N as B,al as V,ap as K,ah as Y,ao as U,c as W,aq as G,p as _,E as J,a0 as w,w as C,D as N}from"./index-B_G_5wPF.js";import{P as X,a as Z,b as ee}from"./PageMain-oN9SPVR-.js";import{u as D}from"./useRoles-CqwO4URy.js";import{M as q}from"./MultiSelectField-Cuq4qe6H.js";import{S as te}from"./SidePanelFormButtons-XM1c0Oqk.js";import{H as se}from"./HeaderWithSearch-BtAoyXnn.js";function j(){const t=z(),n=O(),i=H(),d=(a,p={})=>F({queryKey:["administrators"],queryFn:async()=>n.get("GetAdministrators"),...p}),m=f({mutationFn:async a=>n.get("InviteAdministrator",{params:a}),onSuccess:async()=>t.invalidateQueries({queryKey:["invitations"]})}),h=f({mutationFn:async a=>n.get("DisableAdministrator",{params:a}),onSuccess:async()=>t.invalidateQueries({queryKey:["administrators"]})}),g=f({mutationFn:async({id:a,...p})=>i.put(`administrators/${a}`,p),onSuccess:async()=>Promise.all([t.invalidateQueries({queryKey:["administrators"]}),t.invalidateQueries({queryKey:["roles"]})])}),r=(a,p={})=>F({queryKey:["invitations",a],queryFn:async()=>i.get("/invitations",{params:a}),...p}),l=f({mutationFn:async a=>i.delete(`/invitations/${a.id}`),onSuccess:async()=>t.invalidateQueries({queryKey:["invitations"]})}),s=f({mutationFn:async a=>i.post(`/invitations/${a.id}`),onSuccess:async()=>t.invalidateQueries({queryKey:["invitations"]})});return{getAdministratorsQuery:d,inviteAdministratorQuery:m,disableAdministratorQuery:h,editAdministratorQuery:g,getInvitationsQuery:r,revokeInvitationQuery:l,resendInvitationQuery:s}}const ne="_footer_nfyyh_1",ae="_multiSelect_nfyyh_7",R={footer:ne,multiSelect:ae},ie=({administrator:t,roleOptions:n})=>{const i=I(),{notify:d}=P(),{editAdministratorQuery:m}=j(),{mutateAsync:h}=m,g=async({roles:l})=>{try{await h({id:t.id,roles:l}),d.success({title:"Permission changes have been queued",message:`You changed ${t.name}'s roles`})}catch(s){i(s)}},r=T({initialValues:{roles:[]},validationSchema:Q().shape({roles:E().of($()).min(1,"At least one role is required")}),onSubmit:g});return v.useEffect(()=>{r.setValues({roles:t.roles})},[t.roles]),e.jsx(u.Form,{onSubmit:r.handleSubmit,noValidate:!0,children:e.jsx(q,{required:!0,variant:"condensed",className:R.multiSelect,items:n,selectedItems:n.filter(({value:l})=>r.values.roles.includes(l)),onItemsUpdate:l=>r.setValues({roles:l.map(({value:s})=>s)}),placeholder:"Select roles",error:r.touched.roles&&typeof r.errors.roles=="string"?r.errors.roles:void 0,dropdownFooter:e.jsxs("div",{className:R.footer,children:[e.jsx(u.Button,{type:"button",dense:!0,small:!0,className:"u-no-margin--bottom",disabled:r.values.roles.length===t.roles.length&&t.roles.every(l=>r.values.roles.includes(l)),onClick:()=>r.setFieldValue("roles",t.roles),children:"Revert"}),e.jsx(u.Button,{type:"submit",dense:!0,small:!0,appearance:"positive",className:"u-no-margin--bottom",disabled:r.values.roles.length===t.roles.length&&t.roles.every(l=>r.values.roles.includes(l)),children:"Save changes"})]})})})},oe=({administrator:t})=>{const[n,i]=v.useState(t);v.useEffect(()=>{i(t)},[t]);const{notify:d}=P(),m=I(),{closeSidePanel:h}=x(),{disableAdministratorQuery:g,editAdministratorQuery:r}=j(),{getRolesQuery:l}=D(),{data:s}=l(),a=(s==null?void 0:s.data.map(({name:b})=>({label:b,value:b})))??[],{mutateAsync:p}=r,{mutateAsync:k,isPending:A}=g,L=async()=>{try{await k({email:n.email}),d.success({title:"Administrator removed",message:`Administrator "${t.name}" has been removed successfully.`}),h()}catch(b){m(b)}},o=async b=>{try{await p({id:t.id,roles:b.roles}),i(y=>({...y,roles:b.roles})),d.success({title:"Permission changes have been queued",message:`You changed ${n.name}'s roles`})}catch(y){m(y)}},c=T({initialValues:{roles:[]},validationSchema:Q().shape({roles:E().of($()).min(1,"At least one role is required")}),onSubmit:o});return v.useEffect(()=>{c.setValues({roles:n.roles})},[n]),e.jsxs(u.Form,{onSubmit:c.handleSubmit,noValidate:!0,children:[e.jsxs(u.ConfirmationButton,{type:"button",className:"has-icon",confirmationModalProps:{title:"Disable Administrator",children:e.jsx("p",{children:"This will remove the administrator from your Landscape organization."}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:A,confirmButtonLoading:A,onConfirm:L},children:[e.jsx(u.Icon,{name:u.ICONS.delete,"aria-hidden":"true"}),e.jsx("span",{children:"Remove"})]}),e.jsxs(u.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(u.Col,{size:6,children:e.jsx(S,{label:"Name",value:n.name})}),e.jsx(u.Col,{size:6,children:e.jsx(S,{label:"Email",value:n.email})}),e.jsx(u.Col,{size:12,children:e.jsx(S,{label:"Timezone",value:e.jsx(B,{})})}),e.jsx(u.Col,{size:12,children:e.jsx(S,{label:"Identity URL",value:e.jsx(B,{})})})]}),e.jsx(q,{variant:"condensed",label:"Roles",items:a,selectedItems:a.filter(({value:b})=>c.values.roles.includes(b)),placeholder:"Select roles",onItemsUpdate:async b=>await c.setFieldValue("roles",b.map(({value:y})=>y)),error:c.touched.roles&&typeof c.errors.roles=="string"?c.errors.roles:void 0}),e.jsx(te,{submitButtonDisabled:c.isSubmitting||c.values.roles.length===n.roles.length&&c.values.roles.every(b=>n.roles.includes(b)),submitButtonText:"Save changes"})]})},re=({administrator:t})=>{const n=I(),{notify:i}=P(),{disableAdministratorQuery:d}=j(),{value:m,setTrue:h,setFalse:g}=V(),{mutateAsync:r,isPending:l}=d,s=async()=>{try{await r({email:t.email}),i.success({title:`You have successfully removed ${t.name} as an administrator.`,message:"They will no longer be able to access this Landscape organization and all permissions have been revoked."})}catch(a){n(a)}finally{g()}};return e.jsxs(e.Fragment,{children:[e.jsx(K,{toggleAriaLabel:`${t.name} administrator actions`,destructiveActions:[{icon:"delete",label:"Remove","aria-label":`Remove "${t.name}" administrator`,onClick:h}]}),m&&e.jsx(u.ConfirmationModal,{close:g,title:`Remove ${t.name}`,confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:l,confirmButtonLoading:l,onConfirm:s,children:e.jsx("p",{children:"This will remove the administrator from your Landscape organization."})})]})},le="_roles_eken9_1",ce="_table_eken9_11",M={roles:le,table:ce},de=({administrators:t,emptyMessage:n,roles:i})=>{const{setSidePanelContent:d}=x(),m=v.useMemo(()=>t,[t]),h=v.useMemo(()=>i.map(({name:s})=>({label:s,value:s})),[i]),g=s=>{d(s.name,e.jsx(oe,{administrator:s}))},r=v.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:s})=>e.jsx(u.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{g(s.original)},children:s.original.name})},{accessor:"email",Header:"Email"},{accessor:"roles",className:M.roles,Header:"Roles",Cell:({row:s})=>e.jsx(ie,{administrator:s.original,roleOptions:h})},{...Y,Cell:({row:s})=>e.jsx(re,{administrator:s.original})}],[m,h]),l=s=>{const a={};return s.column.id==="name"?a.role="rowheader":s.column.id==="email"?a["aria-label"]="Email":s.column.id==="roles"?a["aria-label"]="Roles":s.column.id==="actions"&&(a["aria-label"]="Actions"),a};return e.jsx(u.ModularTable,{columns:r,data:m,getCellProps:l,emptyMsg:n,className:M.table})},me=()=>e.jsxs(e.Fragment,{children:[e.jsx(se,{}),e.jsx(U,{filtersToDisplay:["search"]})]}),ue=({administrators:t})=>{const{search:n,pageSize:i,currentPage:d}=W(),{getRolesQuery:m}=D(),{data:h}=m(),r=(()=>{const s=n.trim().toLowerCase();return s?t.filter(a=>a.email.toLowerCase().includes(s)||a.name.toLowerCase().includes(s)||a.roles.some(p=>p.toLowerCase().includes(s))):t})(),l=r.filter((s,a)=>a>=(d-1)*i&&a<d*i)??[];return e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsx(de,{administrators:l,emptyMessage:n.trim()?`No administrators found with the search: "${n.trim()}"`:"You have no administrators on your Landscape organization",roles:(h==null?void 0:h.data)??[]}),l.length>0&&e.jsx(G,{totalItems:r.length,currentItemCount:l.length})]})},he=v.lazy(()=>w(()=>import("./index-CHInTjpF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),ve=()=>{const{setSidePanelContent:t}=x(),{getAdministratorsQuery:n}=j(),{data:i,isLoading:d}=n(),m=()=>{t("Invite administrator",e.jsx(v.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(he,{})}))};return e.jsxs(e.Fragment,{children:[d&&e.jsx(_,{}),!d&&(!i||!i.data.length)&&e.jsx(J,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no administrators in your Landscape organization."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[e.jsx(u.Button,{type:"button",appearance:"positive",onClick:m,children:"Invite Administrator"},"invite-administrator")],icon:"user",title:"No administrators found"}),!d&&i&&i.data.length>0&&e.jsx(ue,{administrators:i.data})]})},ge=()=>{const t=I(),{notify:n}=P(),{getInvitationsQuery:i,revokeInvitationQuery:d,resendInvitationQuery:m}=j(),{data:h}=i(),g=v.useMemo(()=>(h==null?void 0:h.data.results.sort((o,c)=>C(c.creation_time).diff(C(o.creation_time))))??[],[h]),{mutateAsync:r,isPending:l}=d,{mutateAsync:s,isPending:a}=m,p=async o=>{try{await r({id:o.id}),n.success({message:`${o.name}â€™${o.name.endsWith("s")?"":"s"} invitation has been revoked`,title:"You revoked an administrator invite"})}catch(c){t(c)}},k=async o=>{try{await s({id:o.id}),n.success({message:`${o.name} will receive a new invitation email`,title:"You resent an administrator invite"})}catch(c){t(c)}},A=v.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"email",Header:"Email"},{accessor:"creation_time",Header:"Invited",Cell:({row:o})=>e.jsx("span",{className:"font-monospace",children:C(o.original.creation_time).format(N)})},{accessor:"expiration_time",Header:"Expires",Cell:({row:o})=>e.jsx("span",{className:"font-monospace",children:C(o.original.creation_time).add(14,"days").format(N)})},{accessor:"actions",Cell:({row:o})=>e.jsxs("div",{className:"u-align-text--right",children:[e.jsx(u.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Revoke invitation for ${o.original.name}`,children:e.jsxs("p",{children:["This action will prevent ",o.original.name," from joining your Landscape organization."]}),confirmButtonLabel:"Revoke invitation",confirmButtonAppearance:"negative",confirmButtonDisabled:l,confirmButtonLoading:l,onConfirm:async()=>p(o.original)},children:"Revoke"}),e.jsx(u.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Resend invitation for ${o.original.name}`,children:e.jsxs("p",{children:[o.original.name," will receive a new invitation email."]}),confirmButtonLabel:"Resend invitation",confirmButtonAppearance:"positive",confirmButtonDisabled:a,confirmButtonLoading:a,onConfirm:async()=>k(o.original)},children:"Resend"})]})}],[g]),L=o=>{const c={};return o.column.id==="name"?c.role="rowheader":o.column.id==="email"?c["aria-label"]="Email":o.column.id==="creation_time"?c["aria-label"]="Invited":o.column.id==="expiration_time"?c["aria-label"]="Expires":o.column.id==="actions"&&(c["aria-label"]="Actions"),c};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-text--muted p-text--small",children:"Unclaimed invitations expire after 14 days."}),e.jsx(u.ModularTable,{columns:A,data:g,getCellProps:L,emptyMsg:"You have no unclaimed invitations."})]})},be="_tabPanel_1n8p7_1",pe={tabPanel:be},ye=[{label:"Administrators",id:"tab-link-administrators"},{label:"Invites",id:"tab-link-invites"}],fe=()=>{const{closeSidePanel:t}=x(),[n,i]=v.useState("tab-link-administrators");return e.jsxs(e.Fragment,{children:[e.jsx(u.Tabs,{listClassName:"u-no-margin--bottom",links:ye.map(({label:d,id:m})=>({label:d,id:m,role:"tab",active:m===n,onClick:()=>{i(m),t()}}))}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":n,className:pe.tabPanel,children:e.jsxs(v.Suspense,{fallback:e.jsx(_,{}),children:[n==="tab-link-administrators"&&e.jsx(ve,{}),n==="tab-link-invites"&&e.jsx(ge,{})]})})]})},xe=v.lazy(()=>w(()=>import("./index-CHInTjpF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),je=()=>{const{setSidePanelContent:t}=x(),n=()=>{t("Invite administrator",e.jsx(v.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(xe,{})}))};return e.jsxs(X,{children:[e.jsx(Z,{title:"Administrators",actions:[e.jsx(u.Button,{type:"button",onClick:n,children:"Invite administrator"},"invite-administrator")]}),e.jsx(ee,{children:e.jsx(fe,{})})]})},ke=Object.freeze(Object.defineProperty({__proto__:null,default:je},Symbol.toStringTag,{value:"Module"}));export{ke as i,j as u};
