const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DCKmXZaA.js","assets/index-CGM03hee.js","assets/index-BmrsSOmL.css","assets/UdebCheckboxInput-GlLb0cmn.js","assets/UdebCheckboxInput-mCgCMP_S.css","assets/debug-Ch_6ESpO.js","assets/useGPGKeys-CG6F5whJ.js","assets/debug-CHNhm1j1.css","assets/MultiSelectField-3iTShz40.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-QRtzN-Cq.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/formikErrors-Bw8iTXYS.js","assets/constants-Bh9ptnEI.js","assets/constants-DhXkDRlN.css"])))=>i.map(i=>d[i]);
import{r,j as e,m as c,a2 as ie,y as de,l as ge,n as F,o as A,_ as ue}from"./index-CGM03hee.js";import{S as me}from"./SidePanelTablePagination-XRCiCOIW.js";import{f as fe,p as pe}from"./constants-Bh9ptnEI.js";const he="_version_sfav3_1",Pe="_content_sfav3_5",Q={version:he,content:Pe},ke=({isUpload:o,packagesToShow:n,search:s,selectedPackages:i,setSelectedPackages:m})=>{const g=r.useMemo(()=>[{accessor:"packageName",Header:({rows:a})=>o?e.jsxs(e.Fragment,{children:[e.jsx(c.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),disabled:!a.length,indeterminate:!!i.length&&i.length<a.length,checked:i.length===a.length&&!!i.length,onChange:()=>{m(d=>d.length?[]:a.map((h,x)=>x))}}),e.jsx("span",{children:"Package"})]}):"Package",Cell:({row:a})=>o?e.jsx(c.CheckboxInput,{inline:!0,label:a.original.packageName,checked:i.includes(a.index),onChange:()=>{m(d=>d.includes(a.index)?d.filter(h=>h!==a.index):[...d,a.index])}}):a.original.packageName},{accessor:"packageVersion",Header:"Version",getCellIcon:({row:a})=>a.original.difference?"warning":!1,className:Q.version,Cell:({row:a})=>a.original.difference?e.jsx(c.Tooltip,{position:"top-center",message:a.original.difference==="delete"?"Package deleted":`Version differs
from parent pocket.
Parent version:
${a.original.newVersion}`,children:e.jsx("span",{children:a.original.packageVersion})}):a.original.packageVersion}],[n,i.length]);return e.jsx(c.ModularTable,{columns:g,data:n,emptyMsg:s?`No packages found with the search: "${s}".`:void 0,className:Q.content,getCellProps:({column:a})=>{switch(a.id){case"packageName":return{role:"rowheader"};case"packageVersion":return{"aria-label":"Version"};default:return{}}}})},xe="_ctaRow_qlsck_1",je={ctaRow:xe},be=r.lazy(async()=>ue(()=>import("./index-DCKmXZaA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),k=1,H=20,Se=({distributionName:o,pocket:n,seriesName:s})=>{const[i,m]=r.useState(k),[g,a]=r.useState(H),[d,h]=r.useState([]),[x,O]=r.useState(!1),[_,D]=r.useState(""),[j,v]=r.useState(""),[R,U]=r.useState([]),B=ie("(max-width: 619px)"),E=de(),{setSidePanelContent:q,closeSidePanel:K}=ge(),{listPocketQuery:G,diffPullPocketQuery:J,pullPackagesToPocketQuery:W,syncMirrorPocketQuery:X,removePackagesFromPocketQuery:Y,removePocketQuery:Z}=fe(),{mutate:N,isPending:T}=X,{mutate:ee,isPending:M}=W,ne=()=>{n.mode==="mirror"?N({name:n.name,series:s,distribution:o}):n.mode==="pull"&&ee({name:n.name,series:s,distribution:o})},ae=()=>{q(`Edit ${n.name} pocket`,e.jsx(r.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(be,{pocket:n,distributionName:o,seriesName:s})}))},{mutateAsync:te,isPending:S}=Z,oe=async()=>{try{await te({distribution:o,series:s,name:n.name}),K()}catch(t){E(t)}},{mutateAsync:se,isPending:b}=Y,z=!T&&!M&&!b&&!S,{data:C,isLoading:I}=G({name:n.name,series:s,distribution:o,search:j,limit:g,offset:i*g-g},{enabled:z}),$=(C==null?void 0:C.data)??{count:0,results:[]},f=$.results.map(t=>({packageName:t.name,packageVersion:t.version})),{data:y}=J({name:n.name,series:s,distribution:o},{enabled:n.mode==="pull"&&!I&&z});r.useEffect(()=>{const t=(y==null?void 0:y.data)??{},l=[];for(const u in t){const p={add:[],update:[],delete:[],...t[u]};for(const[P,V]of p.add)l.push({packageName:P,newVersion:V,difference:"add"});(p.update.length||p.delete.length)&&O(!0);for(const[P,,V]of p.update)l.push({packageName:P,newVersion:V,difference:"update"});for(const[P]of p.delete)l.push({packageName:P,difference:"delete",newVersion:""})}U(l)},[y]);const ce=()=>x?(f.forEach((t,l)=>{const u=R.find(({packageName:p})=>t.packageName===p);u&&(f[l].difference=u.difference,u.newVersion!==""&&(f[l].newVersion=u.newVersion))}),[...f.filter(({difference:t})=>t),...f.filter(({difference:t})=>!t)]):f,L=r.useMemo(()=>ce(),[i,g,j,x,f.length,R.length]),le=async()=>{const t=L.filter((l,u)=>d.includes(u)).map(({packageName:l})=>l);try{await se({name:n.name,series:s,distribution:o,packages:t})}catch(l){E(l)}},w=!j&&i===k&&g===H&&!$.count,re=n.mode==="upload"?{size:8,medium:4}:{size:6,medium:3};return e.jsxs(e.Fragment,{children:[e.jsxs(c.Row,{className:F("u-no-padding--left u-no-padding--right",je.ctaRow),children:[e.jsx(c.Col,{...re,children:e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[n.mode!=="upload"&&e.jsx(c.Button,{className:"p-segmented-control__button",type:"button",onClick:ne,disabled:T&&M,"aria-label":n.mode==="mirror"?`Synchronize ${n.name} pocket of ${o}/${s}`:`Pull packages to ${n.name} pocket of ${o}/${s}`,children:n.mode==="mirror"?"Sync":"Pull"}),e.jsx(c.Button,{className:"p-segmented-control__button",type:"button",onClick:ae,"aria-label":`Edit ${n.name} pocket of ${o}/${s}`,children:"Edit"}),e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button",type:"button","aria-label":`Remove ${n.name} pocket of ${o}/${s}`,confirmationModalProps:{title:"Deleting pocket",children:e.jsxs("p",{children:["Do you really want to delete ",n.name," pocket from"," ",s," series of ",o," distribution?"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:S,confirmButtonLoading:S,onConfirm:oe},children:"Remove"}),n.mode==="upload"&&e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:!d.length||b,"aria-label":`Remove selected packages from ${n.name} pocket of ${o}/${s}`,confirmationModalProps:{title:"Deleting packages from pocket",children:e.jsxs("p",{children:["This will delete ",d.length," selected"," ",pe(d.length,"package","packages")," ","from ",n.name," pocket ",s," series of"," ",o," distribution"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:b,confirmButtonLoading:b,onConfirm:le},children:"Remove packages"})]})})}),n.mode!=="upload"&&!w&&e.jsx(c.Col,{size:6,medium:3,children:e.jsx(c.Form,{onSubmit:t=>{t.preventDefault(),v(_),m(k)},noValidate:!0,children:e.jsx(c.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,"aria-label":"Package search",onChange:t=>{D(t)},value:_,onClear:()=>{D(""),v(""),m(k)},className:F({"is-dense":!B,"u-no-margin--bottom":B}),onSearch:()=>{v(_),m(k)},autocomplete:"off"})})})]}),I?e.jsx(A,{}):w?e.jsx("p",{children:"No packages found"}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{isUpload:n.mode==="upload",packagesToShow:L,search:j,selectedPackages:d,setSelectedPackages:h}),e.jsx(me,{currentPage:i,totalItems:$.count,paginate:t=>{h([]),m(t)},pageSize:g,setPageSize:t=>{a(t)}})]})]})};export{Se as default};
