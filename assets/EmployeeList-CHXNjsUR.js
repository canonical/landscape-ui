const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DSVDYGFX.js","assets/index-B1w7_YBY.js","assets/index-Dkc_mJ0y.css","assets/InstancesPageActions-Dv5a7mOF.js","assets/ResponsiveButtons-BiNDbyNl.js","assets/ResponsiveButtons-C56n2q_V.css","assets/useInstances-jgfOrcKU.js","assets/InstancesPageActions-B7AIml_J.css","assets/index-DdrmM_Gj.css"])))=>i.map(i=>d[i]);
import{i as v,f as j,g as _,c as I,h as D,B as L,A as E,j as t,n as d,C as S,k as F,al as T,ap as M,r as h,p as A,a0 as P,l as N,ah as $,aA as w,L as x,N as g,aq as O}from"./index-B1w7_YBY.js";const R=e=>e.is_active?"Active":"Inactive",k=()=>{const e=v(),a=j(),{mutateAsync:s,isPending:o}=_({mutationKey:["employee","patch"],mutationFn:async({id:u,...m})=>e.patch(`employees/${u}`,m),onSuccess:async()=>a.invalidateQueries({queryKey:["employee"]})});return{patchEmployee:s,isPending:o}},B={listenToUrlParams:!0},H=e=>{switch(e){case"active":return!0;case"inactive":return!1;default:return}},ue=(e,a,s={})=>{var y,b;const o=v(),{autoinstallFiles:u,currentPage:m,employeeGroups:n,pageSize:l,search:i,status:r}=I();e={...B,...e};const c={...e.listenToUrlParams?{with_autoinstall_file:!0,with_computers:!0,with_groups:!0,is_active:H(r),employee_group_ids:n.length>0?n:void 0,autoinstall_file_ids:u.length>0?u:void 0,limit:l,offset:(m-1)*l,search:i??void 0}:a},{data:p,isPending:z,isFetching:C}=D({queryKey:["employees",c,e],queryFn:async()=>o.get("employees",{params:c}),...s});return{employees:((y=p==null?void 0:p.data)==null?void 0:y.results)||[],isPending:z,isFetching:C,count:(b=p==null?void 0:p.data)==null?void 0:b.count}},q=()=>{const e=v(),a=j(),{mutateAsync:s,isPending:o}=_({mutationKey:["employee","patch"],mutationFn:async({id:u,...m})=>e.post(`employees/${u}/offboard`,m),onSuccess:async()=>a.invalidateQueries({queryKey:["employee"]})});return{deactivateEmployee:s,isDeactivating:o}},V=({employee:e,handleClose:a})=>{const{notify:s}=L(),o=E(),{patchEmployee:u,isPending:m}=k(),n=async()=>{try{await u({id:e.id,is_active:!0}),s.success({title:`You have successfully activated ${e.name}`,message:`${e.name} will be able to log in to Landscape and register new instances with their account.`}),a()}catch(l){o(l)}};return t.jsx(d.ConfirmationModal,{confirmButtonLabel:"Activate",onConfirm:n,confirmButtonAppearance:"positive",title:`Activate ${e.name}`,close:a,confirmButtonDisabled:m,confirmButtonLoading:m,children:t.jsxs("p",{children:["This will allow ",e.name," to log in to Landscape and register new instances with their account."]})})},G="Irreversibly deletes all data on disks of associated instances. Proceed with caution",K="This will remove all instances associated with this employee from Landscape.",U={sanitizationConfirmationText:"",sanitizeInstances:!1,removeFromLandscapeConfirmationText:"",removeFromLandscape:!1},Y="_title_1azx9_1",Q="_tooltipPositionElement_1azx9_5",W="_additionalActionContainer_1azx9_9",f={title:Y,tooltipPositionElement:Q,additionalActionContainer:W},Z=(e,a)=>a.removeFromLandscape&&a.sanitizeInstances?`Off-board ${e}`:`Deactivate ${e}`,J=e=>e.removeFromLandscape&&e.sanitizeInstances?"Off-board":e.removeFromLandscape?"Deactivate and remove":e.sanitizeInstances?"Deactivate and sanitize":"Deactivate",X=e=>!!(e.sanitizeInstances&&e.sanitizationConfirmationText!=="sanitize instances"||e.removeFromLandscape&&e.removeFromLandscapeConfirmationText!=="remove instances"||e.sanitizeInstances&&e.removeFromLandscape&&e.sanitizationConfirmationText!=="sanitize instances"&&e.removeFromLandscapeConfirmationText!=="remove instances"),ee=(e,a,s)=>a&&s?{notificationTitle:`You have successfully deactivated ${e} and initiated both Sanitization and Removal of their instances`,notificationMessage:"Sanitization and removal of this employee’s instances have been queued. The data will be permanently irrecoverable once complete. To manage the instances again, they will need to be re-registered in Landscape."}:a?{notificationTitle:`You have successfully deactivated ${e} and initiated sanitization of their instances`,notificationMessage:`Sanitization of the ${e}’s instances has been queued in Activities. The data will be permanently irrecoverable once complete.`}:s?{notificationTitle:`You have successfully deactivated ${e} and initiated the Removal of their instances`,notificationMessage:"The removal of this employee’s instances has been queued. This process will delete all stored data. To manage them again, they will need to be re-registered in Landscape."}:{notificationTitle:`You have successfully deactivated ${e}`,notificationMessage:"This employee won’t be able to log in to Landscape or register new instances with their account."},te=({employee:e,handleClose:a})=>{const{notify:s}=L(),o=E(),{deactivateEmployee:u,isDeactivating:m}=q(),n=S({initialValues:U,enableReinitialize:!0,onSubmit:async l=>{if(!(l.sanitizeInstances&&l.sanitizationConfirmationText!=="sanitize instances"||l.removeFromLandscape&&l.removeFromLandscapeConfirmationText!=="remove instances"))try{await u({id:e.id,remove_instances:n.values.removeFromLandscape,sanitize_instances:n.values.sanitizeInstances}),n.resetForm(),a();const{notificationMessage:i,notificationTitle:r}=ee(e.name,n.values.sanitizeInstances,n.values.removeFromLandscape);s.success({title:r,message:i})}catch(i){o(i)}}});return t.jsx(d.ConfirmationModal,{title:Z(e.name,n.values),confirmButtonLabel:J(n.values),confirmButtonProps:{type:"submit"},onConfirm:()=>{n.handleSubmit()},close:a,confirmButtonDisabled:X(n.values)||m,confirmButtonLoading:m,children:t.jsxs(d.Form,{noValidate:!0,onSubmit:l=>{l.preventDefault(),n.handleSubmit()},children:[t.jsxs("p",{children:["This will prevent ",e.name," from logging in to Landscape and from registering any new instances with their account"]}),t.jsx("b",{children:"Additional actions"}),t.jsxs("div",{children:[t.jsx(d.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:f.title,children:"Sanitize associated instances"}),t.jsxs(d.Tooltip,{position:"top-center",message:G,positionElementClassName:f.tooltipPositionElement,children:[t.jsx(d.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...n.getFieldProps("sanitizeInstances"),onChange:async l=>{n.getFieldProps("sanitizeInstances").onChange(l),await n.setFieldValue("sanitizationConfirmationText","")}}),n.values.sanitizeInstances&&t.jsxs("div",{className:f.additionalActionContainer,children:[t.jsx("p",{children:"Sanitization will permanently delete the encryption keys for associated instances, making its data completely irrecoverable. This action cannot be undone. Please confirm you wish to proceed."}),t.jsx(d.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"sanitize instances"})," to confirm"]}),"aria-label":"Sanitization confirmation text",placeholder:"sanitize instances",autoComplete:"off",type:"text",...n.getFieldProps("sanitizationConfirmationText")},"sanitizationConfirmationText")]}),t.jsx(d.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:f.title,children:"Remove associated instances from Landscape"}),t.jsxs(d.Tooltip,{position:"top-center",message:K,positionElementClassName:f.tooltipPositionElement,children:[t.jsx(d.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...n.getFieldProps("removeFromLandscape"),onChange:async l=>{n.getFieldProps("removeFromLandscape").onChange(l),await n.setFieldValue("removeFromLandscapeConfirmationText","")}}),n.values.removeFromLandscape&&t.jsxs("div",{className:f.additionalActionContainer,children:[t.jsx("p",{children:"This will remove all associated instances from Landscape, along with their stored data. To manage them again, you would need to re-register them in Landscape."}),t.jsx(d.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"remove instances"})," to confirm."]}),placeholder:"remove instances",autoComplete:"off","aria-label":"Remove from Landscape confirmation text",type:"text",...n.getFieldProps("removeFromLandscapeConfirmationText")},"removeFromLandscapeConfirmationText")]})]})]})})},se=h.lazy(async()=>P(()=>import("./index-DSVDYGFX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),ae=({employee:e})=>{const{setSidePanelContent:a}=F(),{value:s,setTrue:o,setFalse:u}=T(),{value:m,setTrue:n,setFalse:l}=T(),i=()=>{a("Employee details",t.jsx(h.Suspense,{fallback:t.jsx(A,{}),children:t.jsx(se,{employee:e})}),"medium")},r=[{icon:"file",label:"View details","aria-label":`View ${e.name} employee details`,onClick:i}],c=[];return e.is_active?c.push({icon:"pause",label:"Deactivate","aria-label":`Deactivate ${e.name}`,onClick:n}):r.push({icon:"play",label:"Activate","aria-label":`Activate ${e.name}`,onClick:o}),t.jsxs(t.Fragment,{children:[t.jsx(M,{toggleAriaLabel:`${e.name} actions`,actions:r,destructiveActions:c}),s&&t.jsx(V,{employee:e,handleClose:u}),m&&t.jsx(te,{employee:e,handleClose:l})]})},ie="_autoinstallFileHeaderTitle_fd2dm_1",ne={autoinstallFileHeaderTitle:ie},oe=e=>({index:a})=>{const s={};return((e==null?void 0:e.column)==="computers"||(e==null?void 0:e.column)==="groups")&&e.row===a&&(s.className="expandedRow"),s},ce=e=>({column:a,row:{index:s}})=>{const o={};return a.id==="computers"?(o["aria-label"]="Associated instances",(e==null?void 0:e.column)===a.id&&e.row===s&&(o.className="expandedCell")):a.id==="groups"?(o["aria-label"]="Employee group",(e==null?void 0:e.column)===a.id&&e.row===s&&(o.className="expandedCell")):a.id==="name"?o.role="rowheader":a.id==="email"?o["aria-label"]="Email":a.id==="status"?o["aria-label"]="Status":a.id==="autoinstall_file"?o["aria-label"]="Assigned autoinstall file":a.id==="actions"&&(o["aria-label"]="Actions"),o},re=e=>a=>{a&&(e.current=[...a.querySelectorAll("tbody tr")])},le=h.lazy(async()=>P(()=>import("./index-DSVDYGFX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),de=({employees:e})=>{const{setSidePanelContent:a}=F(),[s,o]=h.useState(null),u=h.useRef([]);N((s==null?void 0:s.column)==="computers"||(s==null?void 0:s.column)==="groups"?{current:u.current[s.row]}:[],i=>{i.target instanceof Element&&!i.target.closest("truncatedItem")&&o(null)});const m=(i,r)=>{o(c=>(c==null?void 0:c.column)===i&&c.row===r?null:{column:i,row:c&&["computers","groups"].includes(c.column)&&c.row<r?r-1:r})},n=i=>{a("Employee details",t.jsx(h.Suspense,{fallback:t.jsx(A,{}),children:t.jsx(le,{employee:i})}),"medium")},l=h.useMemo(()=>[{accessor:"name",Header:"name",Cell:({row:{original:i}})=>t.jsx(d.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{n(i)},"aria-label":`Show details of user ${i.name}`,children:i.name})},{accessor:"email",Header:"email"},{accessor:"groups",Header:"employee group",Cell:({row:{original:i,index:r}})=>i.groups&&i.groups.length>0?t.jsx(w,{content:i.groups.map(c=>t.jsx(x,{to:`/settings/employees?tab=employee-groups&search=${c.name}`,className:"truncatedItem",children:c.name},c.group_id)),isExpanded:(s==null?void 0:s.column)==="groups"&&s.row===r,onExpand:()=>{m("groups",r)}}):t.jsx(g,{})},{accessor:"autoinstall_file",Header:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:ne.autoinstallFileHeaderTitle,children:"assigned autoinstall file"}),t.jsx(d.Tooltip,{message:"This configuration file is assigned based on the highest-priority group the user belongs to.",children:t.jsx(d.Icon,{name:"help"})})]}),Cell:({row:{original:i}})=>{var r,c;return(r=i.autoinstall_file)!=null&&r.filename?t.jsx("span",{children:(c=i.autoinstall_file)==null?void 0:c.filename}):t.jsx(g,{})}},{accessor:"status",Header:"status",Cell:({row:{original:i}})=>t.jsx("span",{children:R(i)}),getCellIcon:({row:{original:{is_active:i}}})=>i?"status-succeeded-small":"status-failed-small"},{accessor:"computers",Header:"associated instances",Cell:({row:{original:i,index:r}})=>{var c;return i.computers&&i.computers.length>0?t.jsx(w,{content:(c=i.computers)==null?void 0:c.map(p=>t.jsx(x,{className:"truncatedItem",to:`/instances/${p.id}`,children:p.title},p.id)),isExpanded:(s==null?void 0:s.column)==="computers"&&s.row===r,onExpand:()=>{m("computers",r)}}):t.jsx(g,{})}},{...$,Cell:({row:{original:i}})=>t.jsx(ae,{employee:i})}],[e,s]);return t.jsx("div",{ref:re(u),children:t.jsx(O,{columns:l,data:e,getCellProps:ce(s),getRowProps:oe(s),emptyMsg:"No employees found according to your search parameters.",minWidth:1200})})};export{V as A,te as D,de as E,R as g,ue as u};
