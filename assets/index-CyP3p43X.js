import{C as N,k as y,r as A,j as e,h as a,i as D,l as v,m as w,n as P,s as S,E as C,g as k}from"./index-DA1zp4UR.js";import{P as G,a as _,b as F}from"./PageMain-I_7Aw35C.js";import{u as f}from"./useRoles-1LwEYUMh.js";import{S as T}from"./SidePanelFormButtons-D2iSfRBl.js";import"./useFetchOld-DxdXVajm.js";import"./SidePanelFormButtons.module-yv6Qz3cN.js";const B="_actions_11z1b_1",M="_name_11z1b_5",j={actions:B,name:M},$=({accessGroupData:l})=>{const{confirmModal:m,closeConfirmModal:n}=N(),{removeAccessGroupQuery:r}=f(),{mutateAsync:o}=r,p=y(),c=(t,i="",g=0)=>{let h=[];return t.filter(b=>b.parent===i).forEach(b=>{h.push({...b,indentLevel:g}),h=h.concat(c(t,b.name,g+1))}),h},u=A.useMemo(()=>{const t=l.sort((i,g)=>i.name.localeCompare(g.name))||[];return c(t)},[l.length]),s=async t=>{try{await o({name:t})}catch(i){p(i)}finally{n()}},d=t=>{m({body:`This will delete '${t}' access group`,title:"Delete access group",buttons:[e.jsx(a.Button,{appearance:"negative",onClick:()=>s(t),"aria-label":`Delete ${t} access group`,children:"Delete"},`delete-access-group-${t}`)]})},x=A.useMemo(()=>[{accessor:"title",Header:"Title",className:j.name},{accessor:"name",Header:"Name",className:j.name},{accessor:"id",className:j.actions,Cell:({row:t})=>e.jsx("div",{className:"divided-blocks",children:e.jsx("div",{className:"divided-blocks__item",children:e.jsx(a.Tooltip,{message:"Delete",children:e.jsx(a.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left p-tooltip--btm-center","aria-label":`Remove ${t.original.name} access group`,onClick:()=>d(t.original.name),children:e.jsx(a.Icon,{name:a.ICONS.delete,className:"u-no-margin--left"})})})})})}],[u]);return e.jsx(e.Fragment,{children:e.jsx(a.ModularTable,{columns:x,data:u,getCellProps:t=>{const i=t.row.original;switch(t.column.id){case"name":return{role:"rowheader"};case"title":return{"aria-label":"Title",style:{paddingLeft:`${i.indentLevel*2}rem`}};case"id":return{"aria-label":"Actions"};default:return{}}}})})},E=()=>{const{createAccessGroupQuery:l,getAccessGroupQuery:m}=f(),{mutateAsync:n}=l,{closeSidePanel:r}=D(),{data:o,isLoading:p}=m(),c=((o==null?void 0:o.data)??[]).map(d=>({label:d.title,value:d.name})),u=y(),s=v({initialValues:{title:"",parent:""},validationSchema:w().shape({title:P().required("This field is required")}),onSubmit:async d=>{try{await n(d),r()}catch(x){u(x)}}});return e.jsxs(a.Form,{noValidate:!0,onSubmit:s.handleSubmit,children:[e.jsx(a.Input,{type:"text",label:"Title",id:"new-access-group-title",required:!0,error:s.touched.title&&s.errors.title?s.errors.title:void 0,...s.getFieldProps("title")}),e.jsx(a.Select,{required:!0,id:"Parent",label:"Parent",disabled:p,options:[...c],...s.getFieldProps("parent")}),e.jsx(T,{submitButtonDisabled:s.isSubmitting,submitButtonText:"Add"})]})},O=()=>{const{setSidePanelContent:l}=D(),{getAccessGroupQuery:m}=f(),{data:n,isLoading:r}=m(),o=(n==null?void 0:n.data)??[],p=()=>{l("Add access group",e.jsx(E,{}))},c=({className:u})=>e.jsx(a.Button,{appearance:"positive",onClick:p,onMouseDown:s=>{s.preventDefault()},type:"button",className:k("u-no-margin--right",u),children:"Add access group"});return e.jsxs(G,{children:[e.jsx(_,{title:"Access groups",actions:[e.jsx(c,{},"add-new-access-group-button")]}),e.jsxs(F,{children:[r&&e.jsx(S,{}),!r&&o.length===0&&e.jsx(C,{title:"No access groups found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any access groups yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/access-groups",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage access groups in Landscape"})]}),cta:[e.jsx(c,{},"empty-state-new-button")]}),!r&&o.length>0&&e.jsx($,{accessGroupData:o})]})]})};export{O as default};
