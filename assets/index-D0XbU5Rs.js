import{d as X,c as J,e as I,k as F,f as S,j as e,g as a,r as b,_ as Q,l as Z,h as ee,o as w}from"./index-DXs1haZl.js";import{E as se}from"./EmptyState-BYL1pVz2.js";import"./TablePagination.module-DLVph1Z1.js";import{T as re}from"./TablePagination-DZ07rvb4.js";import{u as j}from"./useMutation-CoMMCR6r.js";import{u as v}from"./useQuery-DPA9mHwu.js";import{u as oe}from"./useConfirm-C9Ai5vPv.js";import{u as te}from"./formik.esm-CwYJvJSO.js";import{c as ne,a as k,e as ae}from"./index.esm-FGh7VWBq.js";import{S as ie}from"./SidePanelFormButtons-Dtg_vQ52.js";import{g as ce,r as A,U as E,a as ue}from"./helpers-prXd4jbM.js";import{u as T}from"./usePageParams-BJqFm8Ol.js";import{H as le}from"./HeaderWithSearch-OzYSSkOw.js";import{N as de}from"./NoData-BmTO_w1O.js";function q(){const r=X(),t=J(),i=I(),u=(s,g={})=>v({queryKey:["users",{...s}],queryFn:()=>r.get("users",{params:s}),...g}),l=j({mutationKey:["users","new"],mutationFn:s=>r.post("users",s),onSuccess:()=>{t.invalidateQueries(["users"]).catch(i)}}),d=j({mutationKey:["users","edit"],mutationFn:s=>r.put("users",s),onSuccess:()=>{t.invalidateQueries(["users"]).catch(i)}}),h=j({mutationKey:["users","remove"],mutationFn:s=>r.delete("users",{params:s}),onSuccess:()=>{t.invalidateQueries(["users"]).catch(i)}}),x=j({mutationKey:["users","lock"],mutationFn:s=>r.post("users/lock",s),onSuccess:()=>{t.invalidateQueries(["users"]).catch(i)}}),p=j({mutationKey:["users","unlock"],mutationFn:s=>r.post("users/unlock",s),onSuccess:()=>{t.invalidateQueries(["users"]).catch(i)}}),n=(s,g={})=>v({queryKey:["groups",s.computer_id],queryFn:()=>r.get(`computers/${s.computer_id}/groups`),...g}),m=(s,g={})=>v({queryKey:["userGroups",s.computer_id,s.username],queryFn:()=>r.get(`computers/${s.computer_id}/users/${s.username}/groups`),...g}),y=j({mutationKey:["groups","add"],mutationFn:s=>r.post(`computers/${s.computer_id}/usergroups/update_bulk`,s),onSuccess:()=>{t.invalidateQueries(["users"]).catch(i)}}),o=j({mutationKey:["groups","remove"],mutationFn:s=>r.post(`computers/${s.computer_id}/usergroups/update_bulk`,s),onSuccess:()=>{t.invalidateQueries(["users"]).catch(i)}});return{getUsersQuery:u,getGroupsQuery:n,getUserGroupsQuery:m,createUserQuery:l,removeUserQuery:h,editUserQuery:d,lockUserQuery:x,unlockUserQuery:p,addUserToGroupQuery:y,removeUserFromGroupQuery:o}}const me="_actions_1l3g0_1",pe={actions:me},L=()=>{const{instanceId:r}=F(),t=I(),{closeSidePanel:i}=S(),{createUserQuery:u,getGroupsQuery:l}=q(),d=Number(r),{mutateAsync:h,isLoading:x}=u,{data:p,isLoading:n}=l({computer_id:d}),y=((p==null?void 0:p.data.groups)??[]).map(s=>({label:s.name,value:s.name})),o=te({initialValues:{name:"",username:"",password:"",confirmPassword:"",requirePasswordReset:!1,location:"",homePhoneNumber:"",workPhoneNumber:"",primaryGroupValue:""},validationSchema:ne().shape({name:k().required("This field is required"),username:k().required("This field is required"),password:k().required("This field is required"),confirmPassword:k().required("This field is required").oneOf([ae("password"),""],"Passwords must match"),location:k(),homePhoneNumber:k(),workPhoneNumber:k(),primaryGroupValue:k().required("This field is required")}),onSubmit:async s=>{try{await h({computer_ids:[d],name:s.name,username:s.username,password:s.password,require_password_reset:s.requirePasswordReset,location:s.location,home_phone:s.homePhoneNumber,work_phone:s.workPhoneNumber,primary_groupname:s.primaryGroupValue}),i()}catch(g){t(g)}}});return e.jsxs(a.Form,{noValidate:!0,onSubmit:o.handleSubmit,name:"add-new-user",children:[e.jsx(a.Input,{type:"text",label:"Username",autoComplete:"new-username",required:!0,error:o.touched.username&&o.errors.username?o.errors.username:void 0,...o.getFieldProps("username")}),e.jsx(a.Input,{type:"text",label:"Name",required:!0,error:o.touched.name&&o.errors.name?o.errors.name:void 0,...o.getFieldProps("name")}),e.jsx(a.Input,{type:"password",label:"Passphrase",autoComplete:"new-password",required:!0,error:o.touched.password&&o.errors.password?o.errors.password:void 0,...o.getFieldProps("password")}),e.jsx(a.Input,{type:"password",label:"Confirm passphrase",autoComplete:"new-password",required:!0,error:o.touched.confirmPassword&&o.errors.confirmPassword?o.errors.confirmPassword:void 0,...o.getFieldProps("confirmPassword")}),e.jsx(a.Input,{type:"checkbox",label:"Require passphrase reset",help:"User must change password at first login",...o.getFieldProps("requirePasswordReset"),checked:o.values.requirePasswordReset}),e.jsx(a.Select,{label:"Primary Group",disabled:n,options:[{label:"Select",value:""},...y],...o.getFieldProps("primaryGroupValue"),error:o.touched.primaryGroupValue&&o.errors.primaryGroupValue?o.errors.primaryGroupValue:void 0}),e.jsx(a.Input,{type:"text",label:"Location",error:o.touched.location&&o.errors.location?o.errors.location:void 0,...o.getFieldProps("location")}),e.jsx(a.Input,{type:"text",label:"Home phone",error:o.touched.homePhoneNumber&&o.errors.homePhoneNumber?o.errors.homePhoneNumber:void 0,...o.getFieldProps("homePhoneNumber")}),e.jsx(a.Input,{type:"text",label:"Work phone",error:o.touched.workPhoneNumber&&o.errors.workPhoneNumber?o.errors.workPhoneNumber:void 0,...o.getFieldProps("workPhoneNumber")}),e.jsx(ie,{submitButtonDisabled:x,submitButtonText:"Add user"})]})},he=b.lazy(()=>Q(()=>import("./index-CiMQ_5iU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]))),ge=({selectedUsers:r,handleClearSelection:t,sidePanel:i=!1})=>{const[u,l]=b.useState(!1),{instanceId:d}=F(),h=I(),{notify:x}=Z(),{setSidePanelContent:p,closeSidePanel:n}=S(),{confirmModal:m,closeConfirmModal:y}=oe(),{removeUserQuery:o,lockUserQuery:s,unlockUserQuery:g}=q(),{mutateAsync:f}=o,{mutateAsync:P}=s,{mutateAsync:N}=g,_=Number(d),c=r.length===1?r[0]:void 0,{locked:B,unlocked:M}=ce(r),C=async(U,$)=>{try{await U({computer_ids:[_],usernames:ue(r),delete_home:$==="removed"?u:void 0}),t&&t(),n(),x.success({message:`Successfully requested to be ${$}`})}catch(Y){h(Y)}finally{y()}},G=async()=>{await C(P,"locked")},V=async()=>{await C(N,"unlocked")},H=async()=>{await C(f,"removed")},K=()=>{p("Add new user",e.jsx(L,{}))},R=U=>{p("Edit user",e.jsx(b.Suspense,{fallback:e.jsx(w,{}),children:e.jsx(he,{user:U})}))},O=async()=>{m({title:`Delete ${c?c.username:"users"}`,body:e.jsxs("div",{children:[e.jsx("p",{className:"u-no-margin--bottom",children:c?`This will delete user ${c.username}. You can delete this user's home folders at the same time`:"This will delete selected users. You can delete their home folders as well"}),e.jsx(a.Input,{label:"Delete the home folders as well",type:"checkbox",onChange:()=>l(U=>!U)})]}),buttons:[e.jsx(a.Button,{appearance:"negative",onClick:H,children:"Delete"},"remove")]})},z=async()=>{m({title:`Lock ${c?`user ${c.username}`:`${r.length} users`}`,body:A({user:c,selectedUsers:r,userAction:E.Lock}),buttons:[e.jsx(a.Button,{appearance:"positive",onClick:G,children:"Lock"},"lock")]})},W=async()=>{m({title:`Unlock ${c?`user ${c.username}`:`${r.length} users`}`,body:A({user:c,selectedUsers:r,userAction:E.Unlock}),buttons:[e.jsx(a.Button,{appearance:"positive",onClick:V,children:"Unlock"},"unlock")]})};return e.jsxs("div",{className:ee("p-panel__controls u-no-padding--top",{"u-no-margin--left":i}),children:[!i&&e.jsxs(a.Button,{hasIcon:!0,onClick:K,className:"u-no-margin--right",children:[e.jsx(a.Icon,{name:"plus"}),e.jsx("span",{children:"Add user"})]}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[((c==null?void 0:c.enabled)||!i)&&e.jsxs(a.Button,{disabled:M===0,onClick:z,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"lock-locked"}),e.jsx("span",{children:"Lock"})]}),(!(c!=null&&c.enabled)||!i)&&e.jsxs(a.Button,{disabled:B===0,onClick:W,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlock"})]}),i&&c&&e.jsxs(a.Button,{onClick:()=>R(c),className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(a.Button,{disabled:r.length===0,onClick:O,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"delete"}),e.jsx("span",{children:"Delete"})]})]})})]})},be=(r,t)=>r.filter(i=>t.includes(i.uid)),xe=({selected:r,handleClearSelection:t,users:i})=>{const{setPageParams:u}=T(),l=d=>{u({search:d}),t()};return e.jsx(le,{onSearch:l,actions:e.jsx("div",{className:pe.actions,children:e.jsx(ge,{handleClearSelection:t,selectedUsers:be(i,r)})})})},ye="_status_1n2s0_1",ke="_actions_1n2s0_7",D={status:ye,actions:ke},je=({column:r})=>{const t={};switch(r.id){case"username":t.role="rowheader";break;case"enabled":t["aria-label"]="Status";break;case"uid":t["aria-label"]="User id";break;case"name":t["aria-label"]="Full name";break}return t},fe=b.lazy(()=>Q(()=>import("./index-CiMQ_5iU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]))),_e=b.lazy(()=>Q(()=>import("./index-BKXzZieX.js"),__vite__mapDeps([25,1,2,26,27,28,24,11,12,13,14,15,16,17,18,19,3,4,5,6,7,20,21,22,23]))),Ue=({users:r,selected:t,setSelected:i})=>{const{setSidePanelContent:u}=S(),l=n=>{u("Edit user",e.jsx(b.Suspense,{fallback:e.jsx(w,{}),children:e.jsx(fe,{user:n})}))},d=n=>{u("User details",e.jsx(b.Suspense,{fallback:e.jsx(w,{}),children:e.jsx(_e,{user:n})}))},h=()=>{i(t.length!==0?[]:r.map(({uid:n})=>n))},x=n=>{t.includes(n)?i(t.filter(m=>m!==n)):i([...t,n])},p=b.useMemo(()=>[{accessor:"username",Header:e.jsxs(e.Fragment,{children:[e.jsx(a.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:h,checked:r.length>0&&t.length===r.length,indeterminate:t.length>0&&t.length<r.length}),e.jsx("span",{children:"username"})]}),Cell:({row:n})=>e.jsxs(e.Fragment,{children:[e.jsx(a.CheckboxInput,{inline:!0,label:e.jsxs("span",{className:"u-off-screen",children:["Select user ",n.original.username]}),checked:t.includes(n.original.uid),onChange:()=>x(n.original.uid)}),e.jsx(a.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>d(n.original),"aria-label":`Show details of user ${n.original.username}`,children:n.original.username})]})},{Header:"status",accessor:"enabled",sortType:"basic",Cell:({row:n})=>e.jsx("div",{className:D.status,children:n.original.enabled?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"p-icon--lock-unlock"}),e.jsx("span",{children:"Unlocked"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"p-icon--lock-locked-active"}),e.jsx("span",{children:"Locked"})]})})},{Header:"UID",accessor:"uid",sortType:"basic"},{Header:"Full Name",accessor:"name",sortType:"basic",Cell:({row:n})=>n.original.name||e.jsx(de,{})},{accessor:"actions",className:D.actions,Cell:({row:n})=>e.jsx(a.Tooltip,{message:"Edit",position:"btm-center",children:e.jsx(a.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Edit ${n.original.name} profile`,onClick:()=>l(n.original),children:e.jsx("i",{className:"p-icon--edit u-no-margin--left"})})})}],[r]);return e.jsx(a.ModularTable,{columns:p,data:r,emptyMsg:"No users available",sortable:!0,initialSortDirection:"ascending",initialSortColumn:"username",getCellProps:je})},Pe=(r,t)=>r?t.filter(({username:i,name:u})=>{const l=u==null?void 0:u.toUpperCase().includes(r.toUpperCase()),d=i.toUpperCase().includes(r.toUpperCase());return l||d}):t,we=1e3,Se=()=>{const[r,t]=b.useState([]),{instanceId:i,childInstanceId:u}=F(),{search:l,currentPage:d,pageSize:h}=T(),{setSidePanelContent:x}=S(),{getUsersQuery:p}=q(),n=Number(u??i),{data:m,isLoading:y}=p({computer_id:n,limit:we}),o=(m==null?void 0:m.data.results)??[],s=b.useMemo(()=>Pe(l,o),[l,o]),f=((_,c)=>s.slice(c,c+_))(h,(d-1)*h),P=()=>{t([])},N=()=>{x("Add new user",e.jsx(L,{}))};return e.jsxs(e.Fragment,{children:[y&&e.jsx(w,{}),!y&&(!m||m.data.results.length===0)&&e.jsx(se,{title:"No users found",body:"Add new users by clicking the button below",icon:"connected",cta:[e.jsx(a.Button,{appearance:"positive",onClick:N,children:"Add user"},"empty-state-add-new-user")]}),(l||!y&&s.length)&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{selected:r,handleClearSelection:P,users:f}),e.jsx(Ue,{selected:r,setSelected:_=>t(_),users:f})]}),e.jsx(re,{handleClearSelection:P,totalItems:s.length,currentItemCount:f.length})]})},Ne=Se,Ge=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{ge as U,Ge as i,q as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-CiMQ_5iU.js","assets/index-DXs1haZl.js","assets/index-DzLy8aaC.css","assets/formik.esm-CwYJvJSO.js","assets/index.esm-FGh7VWBq.js","assets/SidePanelFormButtons-Dtg_vQ52.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/MultiSelectField-26Sjy70t.js","assets/MultiSelectField.module-D1r8qo_i.js","assets/MultiSelectField-B2rqRhX9.css","assets/EmptyState-BYL1pVz2.js","assets/EmptyState-BNXajmMK.css","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/TablePagination-DZ07rvb4.js","assets/usePageParams-BJqFm8Ol.js","assets/useMutation-CoMMCR6r.js","assets/useQuery-DPA9mHwu.js","assets/useConfirm-C9Ai5vPv.js","assets/helpers-prXd4jbM.js","assets/HeaderWithSearch-OzYSSkOw.js","assets/HeaderWithSearch.module-ByXjIdeN.js","assets/HeaderWithSearch-CCRO5bRP.css","assets/NoData-BmTO_w1O.js","assets/index-BKXzZieX.js","assets/InfoItem-BQPTGwVs.js","assets/InfoItem.module-BZ3tYMsb.js","assets/InfoItem-BbayMzTk.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
