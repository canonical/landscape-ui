import{b as x,i as B,l as v,o as y,j as e,d as c,a1 as j,F as w}from"./index-DvQ7Ypp3.js";import{S as C}from"./SidePanelFormButtons-C0IpdDKq.js";import{u as E}from"./useEditScript-BnhLkgZb.js";import{e as F,g as L,h as P}from"./ScriptsTabs-BCy-qJ_J.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";import"./constants-JemvDXE4.js";import"./useRoles-D4CxwbtV.js";import"./TextConfirmationModal-BnO8D1-m.js";import"./HeaderWithSearch-CxYGZV3d.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./index-ERE8cF63.js";const A=({scriptId:o,versionId:t})=>{const n=x(),{data:r,isPending:a}=B({queryKey:["scripts","version",o,t],queryFn:async()=>n.get(`scripts/${o}/versions/${t}`)});return{version:r?.data??null,isVersionLoading:a}},K=({scriptId:o,scriptVersion:t,goBack:n,isArchived:r})=>{const[a,i]=v.useState(!1),m=y(),{version:s,isVersionLoading:f}=A({scriptId:o,versionId:t.version_number}),{editScript:b,isEditing:d}=E(),h=()=>{i(!0)},S=()=>{i(!1)},l=F({code:s?.code,interpreter:s?.interpreter}),p=async()=>{try{if(s){const u={code:l,title:s.title},g=P({scriptId:o,values:u});await b(g),n()}}catch(u){i(!1),m(u)}};return e.jsxs(c.Form,{noValidate:!0,onSubmit:p,children:[e.jsx(j,{label:"author",value:L({author:t.created_by.name,date:t.created_at})}),f?e.jsx(w,{}):e.jsx(c.CodeSnippet,{blocks:[{title:"Code",code:l||"",wrapLines:!0,appearance:"numbered"}]}),e.jsx(C,{hasActionButtons:!r,submitButtonAppearance:"secondary",submitButtonText:"Use as new version",onSubmit:h,hasBackButton:!0,onBackButtonPress:n}),a&&e.jsx(c.ConfirmationModal,{title:`Submit new version of ${t.title}`,confirmButtonLabel:"Submit new version",close:S,confirmButtonAppearance:"positive",confirmButtonLoading:d,confirmButtonDisabled:d,onConfirm:p,confirmButtonProps:{type:"button"},cancelButtonProps:{type:"button"},children:e.jsx("p",{children:"All future script runs will be done using the latest version of the code."})})]})};export{K as default};
