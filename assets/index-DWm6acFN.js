import{k as _,C as L,j as e,h as a,r as p,L as B,R as w}from"./index-B7TA2mEJ.js";import{u as D,W as k,a as v}from"./WslInstancesHeader-8phLdzPG.js";import{u as N}from"./useInstances--U4VPfdG.js";import{u as $}from"./usePageParams-BUsG_p4E.js";import"./useFetchOld-CJ7nhgRY.js";import"./HeaderWithSearch-BS3edyU1.js";const R="_toggleButton_pmmil_1",S="_actionButton_pmmil_6",u={toggleButton:R,actionButton:S},W=({instance:t,parentId:o})=>{const i=_(),{confirmModal:c,closeConfirmModal:l}=L(),{setDefaultChildInstanceQuery:h,deleteChildInstancesQuery:m}=D(),{removeInstancesQuery:n}=N(),{mutateAsync:s}=h,{mutateAsync:r}=m,{mutateAsync:f}=n,x=async()=>{try{await s({child_id:t.id,parent_id:o})}catch(d){i(d)}finally{l()}},b=()=>{c({title:"Set default instance",body:`Are you sure you want to set ${t.title} as default instance?`,buttons:[e.jsx(a.Button,{appearance:"positive",onClick:x,children:"Set default"},"set-default")]})},C=async()=>{try{await r({computer_ids:[t.id]})}catch(d){i(d)}finally{l()}},j=()=>{c({title:"Delete instance",body:e.jsxs("p",{children:["This will permanently delete the instance ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),buttons:[e.jsx(a.Button,{appearance:"negative",onClick:C,children:"Delete"},"delete")]})},y=async()=>{try{await f({computer_ids:[t.id]})}catch(d){i(d)}finally{l()}},I=()=>{c({title:"Remove instance from Landscape",body:e.jsxs("p",{children:["This will remove the instance ",e.jsx("b",{children:t.title})," from Landscape.",e.jsx("br",{}),e.jsx("br",{}),"It will remain on the parent machine. You can re-register it to Landscape at any time."]}),buttons:[e.jsx(a.Button,{appearance:"negative",onClick:y,children:"Remove"},"remove")]})};return e.jsxs(a.ContextualMenu,{position:"left",toggleClassName:u.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(a.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${t.title} instance actions`},children:[!t.is_default_child&&e.jsx(a.Button,{type:"button",appearance:"base",className:u.actionButton,onClick:b,"aria-label":`Set ${t.title} as default instance`,children:"Set default instance"}),e.jsx(a.Button,{type:"button",appearance:"base",className:u.actionButton,onClick:I,"aria-label":`Remove ${t.title} instance from Landscape`,children:"Remove from Landscape"}),e.jsx(a.Button,{type:"button",appearance:"base",className:u.actionButton,onClick:j,"aria-label":`Delete ${t.title} instance`,children:"Delete instance"})]})},A="_title_vwa4n_1",T="_actions_vwa4n_5",g={title:A,actions:T},M=({instance:t})=>{const[o,i]=p.useState([]),{search:c}=$(),l=p.useMemo(()=>c?t.children.filter(({title:n,hostname:s})=>n.toLowerCase().includes(c.toLowerCase())||(s==null?void 0:s.toLowerCase().includes(c.toLowerCase()))):t.children,[t,c]),h=n=>{i(s=>s.some(({id:r})=>r===n.id)?s.filter(({id:r})=>r!==n.id):[...s,n])},m=p.useMemo(()=>[{accessor:"title",Header:e.jsxs(e.Fragment,{children:[e.jsx(a.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),checked:l.length>0&&o.length===l.length,indeterminate:o.length>0&&o.length<l.length,onChange:()=>{i(o.length>0?[]:l)}}),e.jsx("span",{children:"Title"})]}),Cell:({row:n})=>e.jsxs("div",{className:g.title,children:[e.jsx(a.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${n.original.title} instance`}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:o.some(({id:s})=>s===n.original.id),onChange:()=>h(n.original)}),e.jsx(B,{to:`${w}instances/${t.id}/${n.original.id}`,children:n.original.title})]})},{accessor:"distribution",Header:"OS",Cell:({row:{original:n}})=>n.distribution?`UbuntuÂ ${n.distribution}`:"Unknown"},{accessor:"default",Header:"Default",Cell:({row:{original:n}})=>e.jsx(e.Fragment,{children:n.is_default_child?"Yes":"No"})},{accessor:"actions",className:g.actions,Header:"Actions",Cell:({row:{original:n}})=>e.jsx(W,{instance:n,parentId:t.id})}],[l,o]);return e.jsxs(e.Fragment,{children:[e.jsx(k,{selectedInstances:o}),e.jsx(a.ModularTable,{columns:m,data:l,emptyMsg:"No WSL instances found"})]})},U=({instance:t})=>t.children.length!==0?e.jsx(M,{instance:t}):e.jsx(v,{});export{U as default};
