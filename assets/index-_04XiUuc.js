import{b as O,i as H,f as q,g as B,h as E,o as T,p as k,C as _,j as n,Q as U,Z as v,ap as Y,d as x,k as Q,l as S,aq as G,au as F,F as K,S as z,A as M}from"./index-CDk-Jgvr.js";import{u as V}from"./useGetWslLimits-DSuwba5M.js";import"./index-C_IEMtmD.js";import{L as Z}from"./constants-DRKgEQ0k.js";import{u as J}from"./useSelection-Dmd722FU.js";import{u as X,W as I,a as w,b as ee,c as ne}from"./WslInstancesEmptyState-DtIGASQT.js";import{T as ae}from"./TextConfirmationModal-BxLh3OQM.js";import{u as te}from"./useRemoveInstancesFromLandscape-CCeZZdGE.js";import"./GroupFilter-BbfosWSu.js";import"./HeaderWithSearch-lC_PsP2p.js";const se=({computer_id:s},e)=>{const c=O(),{error:o,data:l,isLoading:t}=H({queryKey:["instances",s,"children"],queryFn:async()=>c.get(`computers/${s}/children`),...e});return{instanceChildren:l?.data.children,instanceChildrenError:o,isLoadingInstanceChildren:t}},le=()=>{const s=q(),e=B(),{isPending:c,mutateAsync:o}=E({mutationFn:async l=>s.get("SetDefaultChildComputer",{params:l}),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["wsl-hosts"]}),e.invalidateQueries({queryKey:["instances"]})])});return{isSettingWslInstanceAsDefault:c,setWslInstanceAsDefault:o}},ie=({close:s,instances:e,isOpen:c,onSuccess:o})=>{const l=T(),{notify:t}=k(),{removeInstancesFromLandscape:r,isRemovingInstancesFromLandscape:p}=te(),[d]=e;if(!d)return;const g=_(e.length,d.name,`${e.length} instances`),u=async()=>{try{if(e.some(({computer_id:m})=>m===null))return;await r({computer_ids:e.map(({computer_id:m})=>m)}),t.success({title:`You have successfully removed ${g} from Landscape.`,message:`${_(e.length,`${g} has been removed from Landscape. To manage it again, you will need to re-register it in Landscape.`,`${g} have been removed from Landscape. To manage them again, you will need to re-register them in Landscape.`)}`}),o?.()}catch(m){l(m)}finally{s()}};return n.jsx(ae,{isOpen:c,close:s,title:`Remove ${g} from Landscape`,confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:p,confirmButtonLoading:p,confirmationText:`remove ${g}`,onConfirm:u,children:n.jsx("p",{children:_(e.length,"This will delete all associated data and free up one license slot for another computer to be registered. It will remain on the parent machine. You can re-register it to Landscape at any time.","This will delete all associated data and free up license slots for other computers to be registered. They will remain on the parent machine. You can re-register them to Landscape at any time.")})})},oe=({windowsInstance:s,wslInstance:e})=>{const c=U(),{notify:o}=k(),l=T(),{value:t,setTrue:r,setFalse:p}=v(),{value:d,setTrue:g,setFalse:u}=v(),{value:m,setTrue:b,setFalse:y}=v(),{value:C,setTrue:L,setFalse:j}=v(),{isSettingWslInstanceAsDefault:a,setWslInstanceAsDefault:i}=le(),{reapplyWslProfile:W}=X();if(e.compliance==="pending")return;const h=async()=>{try{await W({name:e.name,computer_ids:[s.id]}),o.success({title:`You have successfully queued ${e.name} to be installed.`,message:"An activity has been queued to install it."})}catch($){l($)}},N=async()=>{try{if(e.computer_id===null)return;await i({child_id:e.computer_id,parent_id:s.id}),o.success({title:`You have successfully marked ${e.name} to be set as the default instance`,message:"An activity has been queued to set it as the default instance."})}catch($){l($)}finally{p()}},D=e.default?void 0:[{icon:"show",label:"View details",onClick:()=>c(`/instances/${s.id}/${e.computer_id}`),excluded:e.computer_id===null},{icon:"starred",label:"Set as default","aria-label":`Set ${e.name} as default`,onClick:r,excluded:e.computer_id===null},{icon:"begin-downloading",label:"Install","aria-label":`Install ${e.name}`,onClick:h,excluded:e.compliance!=="uninstalled"}],P=[{icon:"restart",label:"Reinstall","aria-label":`Reinstall ${e.name}`,onClick:g,excluded:e.compliance!=="noncompliant"},{icon:"close",label:"Uninstall","aria-label":`Uninstall ${e.name}`,onClick:b,excluded:!e.installed},{icon:"delete",label:"Remove from Landscape","aria-label":`Remove ${e.name} from Landscape`,onClick:L,excluded:e.computer_id===null}];return n.jsxs(n.Fragment,{children:[n.jsx(Y,{toggleAriaLabel:`${e.name} instance actions`,actions:D,destructiveActions:P}),t&&n.jsx(x.ConfirmationModal,{title:`Set ${e.name} as default`,confirmButtonLabel:"Set as default",confirmButtonAppearance:"positive",confirmButtonDisabled:a,confirmButtonLoading:a,onConfirm:N,close:p,children:n.jsxs("p",{children:["Are you sure you want to set ",e.name," as default instance?"]})}),n.jsx(I,{close:u,instances:[e],isOpen:d,windowsInstance:s}),n.jsx(w,{close:y,instances:[e],isOpen:m,parentId:s.id}),n.jsx(ie,{close:j,instances:[e],isOpen:C})]})},re="_label_2xrww_1",ce="_groupHeader_2xrww_9",A={label:re,groupHeader:ce},f=({label:s,selectedWslInstances:e,setSelectedWslInstances:c,wslInstances:o})=>{const l=o.filter(t=>t.compliance!=="pending");return n.jsxs("div",{className:A.groupHeader,children:[n.jsx(x.CheckboxInput,{inline:!0,label:n.jsx("span",{className:"u-off-screen",children:`Toggle "${s}" group`}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:!!l.length&&l.every(t=>e.includes(t)),indeterminate:l.some(t=>e.includes(t))&&!l.every(t=>e.includes(t)),disabled:!l.length,onChange:({currentTarget:{checked:t}})=>{c(t?[...e.filter(r=>!l.includes(r)),...l]:e.filter(r=>!l.includes(r)))}}),n.jsxs("span",{className:A.label,children:[s," (",o.length,")"]})]})},de=s=>{switch(s.compliance){case"compliant":return"Compliant";case"pending":return"Pending installation";case"noncompliant":return"Not compliant";case"uninstalled":return"Not installed";case"unregistered":return"Not created by Landscape"}},ue=s=>{switch(s.compliance){case"compliant":return"success-grey";case"pending":return"status-queued";default:return"warning"}},me="_title_wwid8_1",pe="_indented_wwid8_5",R={title:me,indented:pe},ge=({wslInstances:s,windowsInstance:e})=>{const{groupBy:c,search:o}=Q(),l=S.useMemo(()=>o?s.filter(({name:a})=>a.toLowerCase().includes(o.toLowerCase())):s,[s,o]),{selectedItems:t,setSelectedItems:r}=J(l),p=s.some(a=>a.profile),d=l.filter(a=>a.compliance!=="pending"),g=S.useMemo(()=>[{accessor:"name",Header:n.jsxs(n.Fragment,{children:[n.jsx(x.CheckboxInput,{inline:!0,label:n.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),checked:!!d.length&&t.length===d.length,indeterminate:!!t.length&&t.length<d.length,disabled:!d.length,onChange:()=>{r(t.length<d.length?d:[])}}),n.jsx("span",{children:"Instance name"})]}),Cell:({row:{original:a}})=>a.name},p?{Header:"Compliance",getCellIcon:({row:{original:a}})=>a.complianceIcon,Cell:({row:{original:a}})=>a.compliance}:null,{accessor:"version_id",Header:"OS",Cell:({row:{original:a}})=>a.os},p?{Header:"WSL profile",Cell:({row:{original:a}})=>a.profile}:null,{Header:"Default",Cell:({row:{original:a}})=>a.default},{...Z,Cell:({row:{original:a}})=>a.actions}].filter(a=>a!==null),[d,t,p]),u=a=>a.map(i=>{const W=()=>{r(h=>h.includes(i)?h.filter(N=>N!==i):[...h,i])};return{type:"instance",name:n.jsxs("div",{className:K(R.title,{[R.indented]:c}),children:[n.jsx(x.CheckboxInput,{label:n.jsx("span",{className:"u-off-screen",children:`Toggle ${i.name} instance`}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:t.includes(i),disabled:i.compliance==="pending",onChange:W}),i.computer_id!==null?n.jsx(z,{to:`/instances/${e.id}/${i.computer_id}`,children:i.name}):i.compliance==="uninstalled"||i.compliance==="pending"?n.jsx("span",{className:"u-text--muted",children:i.name}):i.name]}),compliance:de(i),complianceIcon:ue(i),os:i.version_id||n.jsx(F,{}),profile:i.profile||n.jsx(F,{}),default:i.computer_id===null?n.jsx(F,{}):i.default?"Yes":"No",actions:n.jsx(oe,{windowsInstance:e,wslInstance:i})}}),m=l.filter(a=>a.compliance==="noncompliant"),b=l.filter(a=>a.compliance==="uninstalled"),y=l.filter(a=>a.compliance==="compliant"),C=l.filter(a=>a.registered),L=l.filter(a=>a.compliance==="unregistered"),j=l.filter(a=>a.compliance==="pending");return n.jsxs(n.Fragment,{children:[n.jsx(ee,{windowsInstance:e,selectedWslInstances:t,wslInstances:s}),n.jsx(G,{columns:g,data:c==="compliance"?[{name:n.jsx(f,{label:"Not compliant",selectedWslInstances:t,setSelectedWslInstances:r,wslInstances:m})},...u(m),{name:n.jsx(f,{label:"Not installed",selectedWslInstances:t,setSelectedWslInstances:r,wslInstances:b})},...u(b),{name:n.jsx(f,{label:"Compliant",selectedWslInstances:t,setSelectedWslInstances:r,wslInstances:y})},...u(y),{name:n.jsx(f,{label:"Created by Landscape",selectedWslInstances:t,setSelectedWslInstances:r,wslInstances:C})},...u(C),{name:n.jsx(f,{label:"Not created by Landscape",selectedWslInstances:t,setSelectedWslInstances:r,wslInstances:L})},...u(L),{name:n.jsx(f,{label:"Pending installation",selectedWslInstances:t,setSelectedWslInstances:r,wslInstances:j})},...u(j)]:u(l),emptyMsg:"No WSL instances found according to your search parameters."})]})},We=({instance:s})=>{const{instanceChildren:e,instanceChildrenError:c,isLoadingInstanceChildren:o}=se({computer_id:s.id}),{isGettingWslLimits:l,windowsInstanceChildLimit:t}=V();if(o)return n.jsx(M,{});if(e)return e.length?l?n.jsx(M,{}):n.jsxs(n.Fragment,{children:[e.length>=t&&n.jsxs(x.Notification,{inline:!0,title:"Limit reached:",severity:"caution",children:["You've reached the limit of ",t," active WSL child ",_(t,"instance"),". This may be due to too many associated profiles or manually created instances."]}),n.jsx(ge,{wslInstances:e,windowsInstance:s})]}):n.jsx(ne,{});throw new Error(c?.message)};export{We as default};
