const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DyjjGWE-.js","assets/index-CAxb-9CO.js","assets/index-DXB7zdRE.css","assets/HeaderWithSearch-D9EWFI6l.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/CellInput-ryJkIQQE.js","assets/SidePanelTablePagination-CVHlLoEX.js","assets/PageMain-DA-yLzkU.js","assets/PageMain-CIunaku7.css","assets/useRoles-CwlY2G8P.js","assets/TruncatedCell-D7I1Byj1.js","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-Dk4aTLgf.js","assets/index-DkxMn-0U.css","assets/index-D5knLo5v.js","assets/AssociationBlock-Dw3g1JSJ.js","assets/MultiSelectField-DhnvON4Z.js","assets/MultiSelectField-CD3NDVCz.css","assets/useGetTags-Byfqctx7.js","assets/AssociationBlock-vsPH8fvb.css","assets/SidePanelFormButtons-THQX_GYS.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/index-BNJYp0vu.js","assets/index-DsklZivB.js","assets/FileInput-7r8yHwI0.js","assets/useGetInstances-yP-eeW-X.js","assets/PackageProfileConstraintsBlock-DiL3sQgH.js","assets/PackageProfileConstraintsBlock-CdyFUl7u.css","assets/index-CLnfUnnC.css"])))=>i.map(i=>d[i]);
import{e as H,b as B,c as K,f as v,g as N,G as O,aa as G,J as y,Q as $,K as U,H as E,au as W,j as e,N as R,a7 as Y,B as _,i as d,v as h,d as c,n as C,a3 as b,p as w,q as L,I as j,ad as F,a5 as J,av as X,h as Z,aH as ee,al as ae,aI as se,aw as te,$ as ne,E as oe}from"./index-CAxb-9CO.js";import{P as ie,a as re,b as ce}from"./PageMain-DA-yLzkU.js";import{u as q}from"./useRoles-CwlY2G8P.js";import{H as D}from"./HeaderWithSearch-D9EWFI6l.js";import{S as le}from"./SidePanelTablePagination-CVHlLoEX.js";import{T as de}from"./TruncatedCell-D7I1Byj1.js";import{u as ue}from"./useExpandableRow-Dk4aTLgf.js";function T(){const a=H(),s=B(),i=K(),n=(o={},l={})=>N({queryKey:["packageProfiles",o],queryFn:async()=>s.get("packageprofiles",{params:o}),...l}),u=v({mutationFn:async o=>s.post("packageprofiles",o),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),r=v({mutationFn:async o=>s.post("packageprofiles",o),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),p=v({mutationFn:async o=>i.get("RemovePackageProfile",{params:o}),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),P=v({mutationFn:async({name:o,...l})=>s.put(`packageprofiles/${o}`,l),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),f=({instanceId:o,...l},x={})=>N({queryKey:["instancePackageProfiles",{instanceId:o,...l}],queryFn:async()=>s.get(`computers/${o}/packages/profile`,{params:l}),...x}),g=({name:o,...l},x={})=>N({queryKey:["packageProfileConstraints",{name:o,...l}],queryFn:async()=>s.get(`packageprofiles/${o}/constraints`,{params:l}),...x}),m=v({mutationFn:async({name:o,...l})=>s.post(`packageprofiles/${o}/constraints`,l),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),k=v({mutationFn:async({id:o,name:l,...x})=>s.put(`packageprofiles/${l}/constraints/${o}`,x),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),t=v({mutationFn:async({name:o,...l})=>s.delete(`packageprofiles/${o}/constraints`,{params:l}),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])});return{addPackageProfileConstraintsQuery:m,copyPackageProfileQuery:u,createPackageProfileQuery:r,editPackageProfileConstraintQuery:k,editPackageProfileQuery:P,getInstancePackageProfileQuery:f,getPackageProfileConstraintsQuery:g,getPackageProfilesQuery:n,removePackageProfileConstraintsQuery:t,removePackageProfileQuery:p}}const Q={constraint:"",notAnyVersion:!1,package:"",rule:"",version:""},Je=Object.fromEntries(Object.keys(Q).map(a=>[a,!0])),pe={constraint:"",id:0,package:"loading",rule:"",version:"",notAnyVersion:!1},ge=[{label:"Any",value:""},{label:"Newer or equal to",value:">="},{label:"Newer than",value:">"},{label:"Equal to",value:"="},{label:"Older than",value:"<"},{label:"Older or equal to",value:"<="}],me=[{label:"Select",value:""},{label:"Conflicts with",value:"conflicts"},{label:"Depends on",value:"depends"}],Xe={access_group:G,all_computers:!1,constraints:[Q],constraintsType:"",csvFile:null,description:"",isCsvFileParsed:!1,material:"",source_computer_id:0,tags:[],title:""},Ze=O().shape({access_group:y(),all_computers:E(),constraints:$().when("constraintsType",{is:"manual",then:a=>a.of(O().shape({constraint:y().required("Required."),notAnyVersion:E(),package:y().required("Required."),rule:y().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")}),version:y().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")})})).min(1,"Package profiles must have at least one package constraint.")}),constraintsType:y().required("This field is required."),csvFile:W().nullable().test({name:"mime-type",message:"Invalid file type.",test:a=>!a||a.type==="text/csv"}).when("constraintsType",{is:"material",then:a=>a.required("This field is required.")}),description:y().required("This field is required."),isCsvFileParsed:E(),material:y().when("constraintsType",{is:"material",then:a=>a.required("The file cannot be empty.")}),source_computer_id:U().when("constraintsType",{is:"instance",then:a=>a.min(1,"This field is required.")}),tags:$().of(y()),title:y().required("This field is required.")}),z=({packageProfile:a})=>!a.tags.length&&!a.all_computers?e.jsx(R,{}):a.computers.constrained.length?e.jsxs(Y,{to:{pathname:"/instances",search:`query=${encodeURIComponent(`profile:package:${a.id}`)}`},children:[a.computers.constrained.length," ",_(a.computers.constrained.length,"instance")]}):"0 instances",he="_constraint_1lz67_1",Pe="_hidden_1lz67_5",M={constraint:he,hidden:Pe},fe=({row:a,column:s})=>{const i={};return a.original.package==="loading"?s.id==="package"?i.colSpan=3:(i.className=M.hidden,i["aria-hidden"]=!0):s.id==="package"?i.role="rowheader":s.id==="constraint"?i["aria-label"]="Constraint":s.id==="rule"?i["aria-label"]="Rule":s.id==="version"&&(i["aria-label"]="Version"),i},ye=({isConstraintsLoading:a,profileConstraints:s,search:i})=>{const n=d.useMemo(()=>a?[pe]:s?s.map(r=>({...r,notAnyVersion:!!r.version})):[],[a,s]),u=d.useMemo(()=>[{accessor:"constraint",className:M.constraint,Header:"Constraint",Cell:({row:{original:r}})=>me.find(({value:p})=>p===r.constraint)?.label??r.constraint},{accessor:"package",Header:"Package",Cell:({row:{original:r}})=>r.package==="loading"?e.jsx(h,{}):r.package},{accessor:"version",Header:"Version",Cell:({row:{original:r}})=>r.version?`${ge.find(({value:p})=>p===r.rule)?.label} ${r.version}`:"Any"}],[n]);return e.jsx(c.ModularTable,{columns:u,data:n,getCellProps:fe,emptyMsg:`No constraints found with the search: "${i}"`})},ke="_actions_nxngq_1",xe={actions:ke},je=d.lazy(()=>b(()=>import("./index-DyjjGWE-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),be=({profile:a})=>{const[s,i]=d.useState(1),[n,u]=d.useState(20),[r,p]=d.useState(""),{setSidePanelContent:P}=C(),{getPackageProfileConstraintsQuery:f}=T(),{data:g,isLoading:m}=f({name:a.name,limit:n,offset:(s-1)*n,search:r}),k=()=>{P(`Change "${a.title}" profile's constraints`,e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(je,{profile:a})}),"medium")};return e.jsxs(e.Fragment,{children:[!r&&s===1&&n===20&&m&&e.jsx(h,{}),(r||s!==1||n!==20||!m&&g&&g.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(D,{className:xe.actions,onSearch:t=>p(t),actions:e.jsx(c.Button,{className:"u-no-margin--bottom",type:"button",onClick:k,children:"Change package constraints"})}),e.jsx(ye,{isConstraintsLoading:m,profileConstraints:g?.data.results,search:r}),e.jsx(le,{currentPage:s,pageSize:n,paginate:t=>i(t),setPageSize:t=>u(t),totalItems:g?.data.count})]})]})},ve=d.lazy(async()=>b(()=>import("./index-D5knLo5v.js"),__vite__mapDeps([14,1,2,15,16,17,18,19,20,21,22,9,7,8,3,4,6,10,11,12]))),Ce=d.lazy(async()=>b(()=>import("./index-BNJYp0vu.js"),__vite__mapDeps([23,1,2,20,21,22,15,16,17,18,19,7,8,9,3,4,6,10,11,12]))),_e=({profile:a})=>{const[s,i]=d.useState(!1),n=w(),{notify:u}=L(),{closeSidePanel:r,setSidePanelContent:p}=C(),{removePackageProfileQuery:P}=T(),{getAccessGroupQuery:f}=q(),{data:g}=f(),m=g?.data??[],{mutateAsync:k,isPending:t}=P,o=()=>{i(!0)},l=()=>{i(!1)},x=async()=>{try{await k({name:a.name}),l(),r(),u.success({message:`Package profile "${a.name}" removed successfully.`,title:"Package profile removed"})}catch(A){l(),n(A)}},S=()=>{p("Edit package profile",e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Ce,{profile:a})}))},V=()=>{p("Duplicate package profile",e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(ve,{profile:a})}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(c.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:V,children:[e.jsx(c.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate profile"})]}),e.jsxs(c.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:S,children:[e.jsx(c.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(c.Button,{className:"p-segmented-control__button",hasIcon:!0,type:"button",onClick:o,"aria-label":`Remove ${a.title} package profile`,children:[e.jsx(c.Icon,{name:c.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(c.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(c.Col,{size:3,children:e.jsx(j,{label:"Title",value:a.title})}),e.jsx(c.Col,{size:3,children:e.jsx(j,{label:"Name",value:a.name})}),e.jsx(c.Col,{size:9,children:e.jsx(j,{label:"Description",value:a.description})}),e.jsx(c.Col,{size:3,children:e.jsx(j,{label:"Access group",value:m.find(A=>A.name===a.access_group)?.title??a.access_group})}),e.jsx(c.Col,{size:9,children:e.jsx(j,{label:"Tags",...a.tags.length>0?{type:"truncated",value:a.tags.join(", ")}:{value:e.jsx(R,{})}})}),e.jsx(c.Col,{size:3,children:e.jsx(j,{label:"Associated to",value:e.jsx(z,{packageProfile:a})})}),e.jsx(c.Col,{size:3,children:e.jsx(j,{label:"Pending on",value:`${a.computers.pending?.length??0} ${_(a.computers.pending.length,"instance")}`})}),e.jsx(c.Col,{size:3,children:e.jsx(j,{label:"Not compliant on",value:`${a.computers["non-compliant"].length} ${_(a.computers["non-compliant"].length,"instance")}`})})]}),e.jsx(be,{profile:a}),e.jsx(F,{isOpen:s,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:t,confirmButtonDisabled:t,close:l,confirmationText:`remove ${a.title}`,onConfirm:x,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},Te=d.lazy(async()=>b(()=>import("./index-DyjjGWE-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),Se=d.lazy(async()=>b(()=>import("./index-D5knLo5v.js"),__vite__mapDeps([14,1,2,15,16,17,18,19,20,21,22,9,7,8,3,4,6,10,11,12]))),Ae=d.lazy(async()=>b(()=>import("./index-BNJYp0vu.js"),__vite__mapDeps([23,1,2,20,21,22,15,16,17,18,19,7,8,9,3,4,6,10,11,12]))),Ne=({profile:a})=>{const s=w(),{notify:i}=L(),{setSidePanelContent:n}=C(),{removePackageProfileQuery:u}=T(),{value:r,setTrue:p,setFalse:P}=J(),{mutateAsync:f,isPending:g}=u,m=()=>{n(`Change "${a.title}" profile's constraints`,e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Te,{profile:a})}),"medium")},k=()=>{n(`Edit "${a.title}" profile`,e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Ae,{profile:a})}))},t=()=>{n(`Duplicate "${a.title}" profile`,e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Se,{profile:a})}))},o=async()=>{try{await f({name:a.name}),i.success({message:`Package profile "${a.title}" removed successfully`,title:"Package profile removed"})}catch(S){s(S)}finally{P()}},l=[{icon:"edit",label:"Edit","aria-label":`Edit ${a.title} profile`,onClick:k},{icon:"applications",label:"Change package constraints","aria-label":`Change ${a.title} package constraints`,onClick:m},{icon:"canvas",label:"Duplicate","aria-label":`Duplicate ${a.title} profile`,onClick:t}],x=[{icon:"delete",label:"Remove","aria-label":`Remove ${a.title} profile`,onClick:p}];return e.jsxs(e.Fragment,{children:[e.jsx(X,{toggleAriaLabel:`${a.title} profile actions`,actions:l,destructiveActions:x}),e.jsx(F,{isOpen:r,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:g,confirmButtonDisabled:g,close:P,confirmationText:`remove ${a.title}`,onConfirm:o,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},Ee=`These instances are not compliant
with the profile. They do not have a
pending activity to become compliant.`,Ie=`These instances are not compliant
with the profile. They do have a
pending activity to apply its
constraints.`,Re=a=>({column:s,row:{index:i}})=>{const n={};switch(s.id){case"title":n.role="rowheader";break;case"description":n["aria-label"]="Description";break;case"access_group":n["aria-label"]="Access group";break;case"tags":n["aria-label"]="Tags",a===i&&(n.className="expandedCell");break;case"computers['non-compliant']":n["aria-label"]="Not compliant instances";break;case"computers['pending']":n["aria-label"]="Pending instances";break;case"computers['constrained']":n["aria-label"]="Associated instances";break;case"actions":n["aria-label"]="Actions";break}return n},Oe=a=>({index:s,original:i})=>{const n={};return a===s&&(n.className="expandedRow"),n["aria-label"]=`${i.title} package profile row`,n},$e="_description_y3fly_1",we="_noWrap_y3fly_2",I={description:$e,noWrap:we},Le=({packageProfiles:a})=>{const{search:s}=Z(),{setSidePanelContent:i}=C(),{getAccessGroupQuery:n}=q(),{expandedRowIndex:u,handleExpand:r,getTableRowsRef:p}=ue(),{data:P}=n(),f=P?.data.map(({name:t,title:o})=>({label:o,value:t}))??[],g=t=>{i(t.title,e.jsx(_e,{profile:t}),"medium")},m=d.useMemo(()=>s?a.filter(t=>t.title.toLowerCase().includes(s.toLowerCase())):a,[a,s]),k=d.useMemo(()=>[{...ee,Cell:({row:{original:t}})=>e.jsxs(se,{children:[e.jsx(c.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{g(t)},children:t.title}),e.jsx("span",{className:"u-text--muted",children:t.name})]})},{accessor:"description",className:I.description,Header:"Description"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:{access_group:t}}})=>f.find(({value:o})=>o===t)?.label??t},{accessor:"tags",Header:"Tags",Cell:({row:{original:{tags:t},index:o}})=>t.length>0?e.jsx(de,{content:t.map(l=>e.jsx("span",{className:"truncatedItem",children:l},l)),isExpanded:o==u,onExpand:()=>{r(o)},showCount:!0}):e.jsx(R,{})},{accessor:"computers['non-compliant']",Header:e.jsxs("div",{className:I.noWrap,children:[e.jsx("span",{children:"Not compliant "}),e.jsx(c.Tooltip,{position:"btm-left",message:Ee,children:e.jsx(c.Icon,{name:"help"})})]}),Cell:({row:{original:t}})=>e.jsx(e.Fragment,{children:`${t.computers["non-compliant"].length} ${_(t.computers["non-compliant"].length,"instance")}`})},{accessor:"computers['pending']",Header:e.jsxs("div",{className:I.noWrap,children:[e.jsx("span",{children:"Pending "}),e.jsx(c.Tooltip,{position:"btm-left",message:Ie,children:e.jsx(c.Icon,{name:"help"})})]}),Cell:({row:{original:t}})=>e.jsx(e.Fragment,{children:`${t.computers.pending?.length??0} ${_(t.computers.pending.length,"instance")}`})},{accessor:"computers['constrained']",Header:"Associated",Cell:({row:{original:t}})=>e.jsx(z,{packageProfile:t})},{...ae,Cell:({row:{original:t}})=>e.jsx(Ne,{profile:t})}],[f.length,u]);return e.jsx("div",{ref:p,children:e.jsx(te,{columns:k,data:m,emptyMsg:`No package profiles found with the search "${s}"`,getCellProps:Re(u),getRowProps:Oe(u),minWidth:1200})})},Fe=()=>e.jsxs(e.Fragment,{children:[e.jsx(D,{}),e.jsx(ne,{filtersToDisplay:["search"]})]}),qe=d.lazy(()=>b(()=>import("./index-DsklZivB.js").then(a=>a.i),__vite__mapDeps([24,1,2,15,16,17,18,19,20,21,22,9,25,26,27,5,28,29]))),De=()=>{const{setSidePanelContent:a}=C(),s=()=>{a("Add package profile",e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(qe,{})}),"medium")};return e.jsx(oe,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You haven’t added any package profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-packages",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage packages in Landscape"})]}),cta:[e.jsx(c.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add")],title:"No package profiles found"})},Qe=({packageProfiles:a=[]})=>e.jsxs(e.Fragment,{children:[e.jsx(Fe,{}),e.jsx(Le,{packageProfiles:a})]}),ze=()=>{const{getPackageProfilesQuery:a}=T(),{data:s,isLoading:i}=a();return e.jsxs(e.Fragment,{children:[i&&e.jsx(h,{}),!i&&(!s||s.data.result.length===0)&&e.jsx(De,{}),!i&&s&&s.data.result.length>0&&e.jsx(Qe,{packageProfiles:s?.data.result})]})},Me=d.lazy(()=>b(()=>import("./index-DsklZivB.js").then(a=>a.a),__vite__mapDeps([24,1,2,15,16,17,18,19,20,21,22,9,25,26,27,5,28,29])).then(a=>({default:a.PackageProfileCreateForm}))),Ve=()=>{const{setSidePanelContent:a}=C(),s=()=>{a("Add package profile",e.jsx(d.Suspense,{fallback:e.jsx(h,{}),children:e.jsx(Me,{})}),"medium")};return e.jsxs(ie,{children:[e.jsx(re,{title:"Package profiles",actions:[e.jsx(c.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add-package-profile")]}),e.jsx(ce,{children:e.jsx(ze,{})})]})},ea=Object.freeze(Object.defineProperty({__proto__:null,default:Ve},Symbol.toStringTag,{value:"Module"}));export{me as C,Q as E,Xe as I,pe as L,Le as P,Je as T,Ze as V,ge as a,Fe as b,De as c,ea as i,T as u};
