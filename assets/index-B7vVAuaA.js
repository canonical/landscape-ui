import{j as t,d as o,o as p,a6 as S,K as P,O as d,R as m,M as h,P as _,A,B as F,n as C,C as T,k as E}from"./index-ClG4AO4X.js";import{A as U}from"./AssociationBlock-Bz-fQY7q.js";import{S as O}from"./SidePanelFormButtons-BitiQJ8Y.js";import{u as q}from"./useRoles-C3np57d3.js";import{u as w,U as z,a as M,b as B}from"./index-CuSP-292.js";import{M as R}from"./MultiSelectField-DRZZtiuh.js";import{D as y}from"./constants-dW6629jA.js";const V=`If Landscape cannot upgrade the
associated instances by this point,
the upgrade will be canceled.`,$="_container_6ykim_1",G="_radioGroup_6ykim_7",H="_timeContainer_6ykim_13",L="_time_6ykim_13",Q="_timeInput_6ykim_27",Y="_inputDescriptionAfter_6ykim_32",k="_inputDescriptionBefore_6ykim_37",K="_colon_6ykim_42",X="_tooltip_6ykim_48",J="_expiration_6ykim_52",W="_windowInputContainer_6ykim_59",Z="_windowInput_6ykim_59",ee="_windowInputDescription_6ykim_68",n={container:$,radioGroup:G,timeContainer:H,time:L,timeInput:Q,inputDescriptionAfter:Y,inputDescriptionBefore:k,colon:K,tooltip:X,expiration:J,windowInputContainer:W,windowInput:Z,windowInputDescription:ee},te=({formik:e})=>{const i=[e.touched.at_hour&&e.errors.at_hour||void 0,e.touched.at_minute&&e.errors.at_minute||void 0,e.touched.deliver_within&&e.errors.deliver_within||void 0];return t.jsxs("div",{className:n.container,children:[t.jsx("p",{className:"p-heading--5",children:"Schedule"}),t.jsx(R,{variant:"condensed",label:"Days",items:y,selectedItems:y.filter(({value:l})=>e.values.on_days.includes(l)),onItemsUpdate:l=>e.setFieldValue("on_days",l.map(({value:u})=>u)),isSortedAlphabetically:!1,hasSelectedItemsFirst:!1,error:e.touched.on_days&&typeof e.errors.on_days=="string"?e.errors.on_days:void 0}),t.jsxs("div",{className:n.radioGroup,children:[t.jsx(o.RadioInput,{label:"At a specific time",...e.getFieldProps("every"),checked:e.values.every==="week",onChange:()=>e.setFieldValue("every","week")}),t.jsx(o.RadioInput,{label:"Hourly",...e.getFieldProps("every"),checked:e.values.every==="hour",onChange:()=>e.setFieldValue("every","hour")})]}),t.jsxs("div",{className:n.timeContainer,children:[t.jsxs("div",{className:n.time,children:[e.values.every==="week"&&t.jsxs(t.Fragment,{children:[t.jsx(o.Input,{type:"number",label:"Time","aria-label":"at hour",placeholder:"HH",className:n.timeInput,wrapperClassName:p({"is-error":i[0]}),...e.getFieldProps("at_hour"),"aria-errormessage":i[0]?"hour-error":void 0}),t.jsx("span",{className:n.colon,children:":"})]}),e.values.every==="hour"&&t.jsx("span",{className:n.inputDescriptionBefore,children:"at"}),t.jsx(o.Input,{type:"number",label:"At minute",labelClassName:"u-off-screen","aria-label":"at minute",className:n.timeInput,wrapperClassName:p({"is-error":i[1]}),placeholder:"MM",...e.getFieldProps("at_minute"),"aria-errormessage":i[1]?"minute-error":void 0}),e.values.every==="hour"&&t.jsx("span",{className:n.inputDescriptionAfter,children:"minute"}),t.jsx(o.Input,{type:"number",label:t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"Expires after "}),t.jsx(o.Tooltip,{message:V,position:"top-right",tooltipClassName:n.tooltip,children:t.jsx(o.Icon,{name:"help"})})]}),wrapperClassName:p(n.expiration,{"is-error":i[2]}),className:n.timeInput,...e.getFieldProps("deliver_within"),"aria-errormessage":"expires-error"}),t.jsx("span",{className:n.inputDescriptionAfter,children:"hours"})]}),i.filter(Boolean).length>0&&t.jsxs("div",{className:p({"is-error":i.filter(Boolean).length>0}),children:[i[0]&&t.jsx("p",{className:"p-form-validation__message",id:"hour-error",children:t.jsx("span",{children:i[0]})}),i[1]&&t.jsx("p",{className:"p-form-validation__message",id:"minute-error",children:t.jsx("span",{children:i[1]})}),i[2]&&t.jsxs("p",{className:"p-form-validation__message",id:"expires-error",children:[t.jsx("strong",{children:"Error: "}),t.jsx("span",{children:i[2]})]})]})]}),t.jsx("p",{children:"Randomise delivery over a time window"}),t.jsxs("div",{className:n.radioGroup,children:[t.jsx(o.RadioInput,{label:"No",...e.getFieldProps("randomizeDelivery"),checked:!e.values.randomizeDelivery,onChange:async()=>{await e.setFieldValue("randomizeDelivery",!1),await e.setFieldValue("deliver_delay_window","")}}),t.jsx(o.RadioInput,{label:"Yes",...e.getFieldProps("randomizeDelivery"),checked:e.values.randomizeDelivery,onChange:()=>e.setFieldValue("randomizeDelivery",!0)})]}),e.values.randomizeDelivery&&t.jsxs("div",{className:n.windowInputContainer,children:[t.jsx(o.Input,{type:"number",inputMode:"numeric",min:0,label:"Deliver delay window",labelClassName:"u-off-screen",className:n.windowInput,...e.getFieldProps("deliver_delay_window"),error:e.touched.deliver_delay_window&&e.errors.deliver_delay_window?e.errors.deliver_delay_window:void 0}),t.jsx("span",{className:n.windowInputDescription,children:"minutes"})]})]})},ie={add:"Add upgrade profile",edit:"Save changes"},re={access_group:S,all_computers:!1,at_hour:"",at_minute:"",autoremove:!1,deliver_delay_window:"",deliver_within:1,every:"week",on_days:[],randomizeDelivery:!1,tags:[],title:"",upgrade_type:"all"},g={add:"added",edit:"updated"},ae=e=>P().shape({access_group:d(),all_computers:h(),at_hour:_().when("every",{is:"week",then:i=>i.required("Hour is required.").integer("Hour must be an integer.").min(0,"Hour must be between 0 and 23.").max(23,"Hour must be between 0 and 23.")}),at_minute:_().required("Minute is required.").integer("Minute must be an integer.").min(0,"Minute must be between 0 and 59.").max(59,"Minute must be between 0 and 59."),deliver_delay_window:_().when("randomizeDelivery",{is:!0,then:i=>i.required("This field is required.").integer("This field must be an integer.").max(43200,"Deliver delay window in minutes must be a number less than or equal to 30 days (43200 minutes)").test((l,{createError:u,parent:c})=>l<parseInt(c.deliver_within)*60||u({message:`Deliver delay window of '${l}' minutes should be shorter than the 'deliver within' expiration time of ${c.deliver_within} ${c.deliver_within==="1"?"hour":"hours"}.`})).min(0,"Deliver delay window must be at least 0.")}),deliver_within:_().integer("'Expires after' must be an integer.").min(0,"'Expires after' must be at least 0."),every:d().required("This field is required."),on_days:m().of(d()).when("every",{is:"week",then:i=>i.min(1,"At least one day must be selected.")}),randomizeDelivery:h(),tags:m().of(d()),title:d().test({name:"required",message:"This field is required.",params:{action:e},test:i=>!!i||e!=="add"}),upgrade_type:d().required("This field is required.")}),v=e=>{const i=A(),{notify:l}=F(),{closeSidePanel:u}=C(),{createUpgradeProfileQuery:c,editUpgradeProfileQuery:b}=w(),{getAccessGroupQuery:x}=q(),{data:f}=x({},{enabled:e.action==="add"}),I=f?.data.map(({name:a,title:s})=>({label:s,value:a}))??[],{mutateAsync:j}=c,{mutateAsync:N}=b,r=T({initialValues:re,onSubmit:async a=>{const s={access_group:a.access_group,all_computers:a.all_computers,at_minute:a.at_minute,autoremove:a.autoremove,deliver_within:a.deliver_within,every:a.every,on_days:a.on_days,title:a.title,upgrade_type:a.upgrade_type};a.every==="week"&&(s.at_hour=a.at_hour),a.randomizeDelivery&&(s.deliver_delay_window=a.deliver_delay_window),!a.all_computers&&a.tags.length&&(s.tags=a.tags);try{e.action==="edit"?await N({all_computers:s.all_computers,at_hour:s.at_hour,at_minute:s.at_minute,autoremove:s.autoremove,deliver_delay_window:s.deliver_delay_window,deliver_within:s.deliver_within,every:s.every,name:e.profile.name,on_days:s.on_days,tags:s.tags,title:s.title,upgrade_type:s.upgrade_type}):await j(s),u(),l.success({message:`Upgrade profile "${a.title}" has been ${g[e.action]} `,title:`Upgrade profile ${g[e.action]}`})}catch(D){i(D)}},validationSchema:ae(e.action)});return E.useEffect(()=>{e.action!=="edit"||!e.profile||r.setValues({access_group:e.profile.access_group,all_computers:e.profile.all_computers,at_hour:e.profile.at_hour?parseInt(e.profile.at_hour):"",at_minute:parseInt(e.profile.at_minute),autoremove:e.profile.autoremove,deliver_delay_window:parseInt(e.profile.deliver_delay_window),deliver_within:parseInt(e.profile.deliver_within),every:e.profile.every,on_days:e.profile.on_days??[],randomizeDelivery:e.profile.deliver_delay_window!=="0",tags:e.profile.tags,title:e.profile.title,upgrade_type:e.profile.upgrade_type})},[e]),t.jsxs(o.Form,{onSubmit:r.handleSubmit,noValidate:!0,children:[t.jsx(o.Input,{type:"text",required:e.action==="add",label:"Title",...r.getFieldProps("title"),error:r.touched.title&&r.errors.title?r.errors.title:void 0}),t.jsx(o.Input,{type:"checkbox",label:"Only upgrade security issues",help:"Regular upgrades will not be applied",...r.getFieldProps("upgrade_type"),checked:r.values.upgrade_type==="security",onChange:async()=>r.setFieldValue("upgrade_type",r.values.upgrade_type==="all"?"security":"all")}),t.jsx(o.Input,{type:"checkbox",label:"Remove packages that are no longer needed",help:"This will affect packages installed to satisfy dependencies that are no longer required after upgrading.",...r.getFieldProps("autoremove"),checked:r.values.autoremove}),t.jsx(o.Select,{label:"Access group","aria-label":"Access group",options:I,...r.getFieldProps("access_group"),error:r.touched.access_group&&r.errors.access_group?r.errors.access_group:void 0}),t.jsx(te,{formik:r}),t.jsx(U,{formik:r}),t.jsx(O,{submitButtonDisabled:r.isSubmitting,submitButtonText:ie[e.action]})]})},_e=Object.freeze(Object.defineProperty({__proto__:null,default:v},Symbol.toStringTag,{value:"Module"})),me=Object.freeze(Object.defineProperty({__proto__:null,SingleUpgradeProfileForm:v,UpgradeProfileList:z,UpgradeProfilesEmptyState:M,UpgradeProfilesHeader:B,useUpgradeProfiles:w},Symbol.toStringTag,{value:"Module"}));export{me as a,_e as i};
