import{j as e,r as _,P as E,Q as w,ao as P,m as i,X as v,y as A,b as S,a as I,A as U,C as N,R as O,G as j,o as T,U as L}from"./index-CL5bVZIc.js";import{u as R,A as B}from"./AuthTemplate-CCMArWUz.js";const k=({methods:t})=>{if(!t)return null;const n=!!(t.standalone_oidc.available&&t.standalone_oidc.enabled),d=!!(t.ubuntu_one.available&&t.ubuntu_one.enabled),r=!!(t.password.available&&t.password.enabled),u=!!(t.pam.available&&t.pam.enabled),p=t.oidc.available?t.oidc.configurations.filter(({enabled:m})=>m):[],o=r||u,h=d||n||t.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[o&&e.jsx(M,{isIdentityAvailable:u}),h&&e.jsx(q,{isStandaloneOidcEnabled:n,isUbuntuOneEnabled:d,oidcProviders:p}),!o&&!h&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},F="_list_9u1s7_1",Q="_button_9u1s7_20",$="_icon_9u1s7_28",b={list:F,button:Q,icon:$},q=({isStandaloneOidcEnabled:t,isUbuntuOneEnabled:n,oidcProviders:d})=>{const[r,u]=_.useState(0),[p]=E(),{invitationId:o}=R(),{getOidcUrlQuery:h,getUbuntuOneUrlQuery:m}=w(),g=p.get("redirect-to"),x=p.has("external"),s={};r>0&&(s.id=r),g&&(s.return_to=g),o&&(s.invitation_id=o),x&&(s.external=!0);const{data:l}=h(s,{enabled:r!==0});_.useEffect(()=>{l&&P(l.data.location)},[l]);const a={};g&&(a.return_to=`${window.origin}${g}`),o&&(a.invitation_id=o),x&&(a.external=!0);const{data:c,refetch:y}=m(a,{enabled:!1});return _.useEffect(()=>{c&&P(c.data.location)},[c]),e.jsxs("ul",{className:b.list,children:[n&&e.jsx("li",{className:"p-list__item",children:e.jsxs(i.Button,{type:"button",hasIcon:!0,onClick:y,className:b.button,children:[e.jsx(i.Icon,{name:v("ubuntu-one"),className:b.icon}),e.jsx("span",{children:"Sign in with Ubuntu One"})]})}),t&&e.jsx("li",{className:"p-list__item",children:e.jsxs(i.Button,{type:"button",hasIcon:!0,onClick:()=>u(-1),className:b.button,children:[e.jsx(i.Icon,{name:v("standalone"),className:b.icon}),e.jsx("span",{children:"Sign in with Enterprise Login"})]})}),d.map(f=>e.jsx("li",{className:"p-list__item",children:e.jsxs(i.Button,{type:"button",hasIcon:!0,onClick:()=>u(f.id),className:b.button,children:[e.jsx(i.Icon,{name:v(f.provider),className:b.icon}),e.jsx("span",{children:`Sign in with ${f.name}`})]})},f.id))]})},C="_buttonRow_f3s21_1",W={buttonRow:C},M=({isIdentityAvailable:t})=>{const[n]=E(),d=A(),{signInWithEmailAndPasswordQuery:r}=w(),{redirectToExternalUrl:u,setAuthLoading:p,setUser:o}=S(),h=I(),m=n.get("redirect-to"),g=n.has("external"),{mutateAsync:x}=r,s=U({initialValues:{email:"",password:""},validateOnMount:!0,validationSchema:N().shape({email:t?j().required("This field is required"):j().required("This field is required").matches(/^[a-zA-Z0-9-_.]+@[a-zA-Z0-9-.]*[a-zA-Z]$/,"Please provide a valid email address").test({message:"Please provide a valid email address",test:l=>{if(l.match(/\.\./))return!1;const[a,c]=l.split("@");return!(a.startsWith(".")||a.endsWith(".")||!c.includes(".")||c.startsWith(".")||c.startsWith("-")||c.match(/\.-/)||c.match(/-\./))}}),password:j().required("This field is required")}),onSubmit:async l=>{try{const{data:a}=await x({email:l.email,password:l.password});g&&m?u(m,{replace:!0}):("current_account"in a&&(p(!0),o(a)),h(m??O,{replace:!0}))}catch(a){d(a)}}});return e.jsxs(i.Form,{onSubmit:s.handleSubmit,children:[e.jsx(i.Input,{type:"text",label:t?"Identity":"Email",error:s.touched.email&&s.errors.email?s.errors.email:void 0,...s.getFieldProps("email"),"data-testid":"email"}),e.jsx(i.PasswordToggle,{id:"password",label:"Password",error:s.touched.password&&s.errors.password?s.errors.password:void 0,...s.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:W.buttonRow,children:e.jsx(i.Button,{type:"submit",appearance:"positive",disabled:s.isSubmitting||!s.isValid,className:"u-no-margin--bottom",children:"Sign in"})})]})},H=()=>{const{getLoginMethodsQuery:t}=w(),{data:n,isLoading:d,isError:r}=t();return e.jsx(B,{title:"Sign in to Landscape",children:d?e.jsx(T,{}):r?e.jsx("p",{className:"u-no-margin--bottom",children:L}):e.jsx(k,{methods:(n==null?void 0:n.data)??null})})};export{H as default};
