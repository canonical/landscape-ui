const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DyiFP2ru.js","assets/index-ChL2S0eU.js","assets/index-DEuNBe7s.css","assets/HeaderWithSearch-D3S3Vvbl.js","assets/HeaderWithSearch-DQybm8h_.css","assets/CellInput-B5TFkvqn.js","assets/SidePanelTablePagination-D7YIYWyb.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/PageMain-DrEayV7B.js","assets/PageMain-BIuYvhUI.css","assets/useFetchOld-DIiLQM9i.js","assets/InfoItem-B_e41MQz.js","assets/InfoItem-C-lWh_lY.css","assets/useRoles-C6qu8rDV.js","assets/usePageParams-BCQ4b1Cy.js","assets/index-DA6Ed-0S.css","assets/index-x-e6_eGZ.js","assets/AssociationBlock-VPHWwPoa.js","assets/MultiSelectField-Dg_3Yc-_.js","assets/MultiSelectField-DOBW8uWL.css","assets/useInstances-B9hhc9Bb.js","assets/AssociationBlock-Cb2Mr2ww.css","assets/SidePanelFormButtons-BSzys4oQ.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/index-BNk1Lh6M.js","assets/index-DG8224VS.js","assets/FileInput-7qqUgD2x.js","assets/PackageProfileConstraintsBlock-DlyJDiet.js","assets/PackageProfileConstraintsBlock-9pB7ZW9v.css","assets/index-B4ZJ98A_.css"])))=>i.map(i=>d[i]);
import{b as B,c as V,d as _,e as N,k as E,n as x,l as I,w as F,B as H,m as K,r,j as e,o as P,h as n,_ as k,i as b,g as O,q,s as w,E as W}from"./index-ChL2S0eU.js";import{P as G,a as U,b as Y}from"./PageMain-DrEayV7B.js";import{u as J}from"./useFetchOld-DIiLQM9i.js";import{I as C}from"./InfoItem-B_e41MQz.js";import{H as D}from"./HeaderWithSearch-D3S3Vvbl.js";import{S as X}from"./SidePanelTablePagination-D7YIYWyb.js";import{u as Z}from"./useRoles-C6qu8rDV.js";import{u as L}from"./usePageParams-BCQ4b1Cy.js";function T(){const a=B(),s=V(),o=J(),d=(c={},p={})=>N({queryKey:["packageProfiles",c],queryFn:()=>s.get("packageprofiles",{params:c}),...p}),m=_({mutationFn:c=>s.post("packageprofiles",c),onSuccess:()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),i=_({mutationFn:c=>s.post("packageprofiles",c),onSuccess:()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),g=_({mutationFn:c=>o.get("RemovePackageProfile",{params:c}),onSuccess:()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),u=_({mutationFn:({name:c,...p})=>s.put(`packageprofiles/${c}`,p),onSuccess:()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),j=({instanceId:c,...p},y={})=>N({queryKey:["instancePackageProfiles",{instanceId:c,...p}],queryFn:()=>s.get(`computers/${c}/packages/profile`,{params:p}),...y}),t=({name:c,...p},y={})=>N({queryKey:["packageProfileConstraints",{name:c,...p}],queryFn:()=>s.get(`packageprofiles/${c}/constraints`,{params:p}),...y}),l=_({mutationFn:({name:c,...p})=>s.post(`packageprofiles/${c}/constraints`,p),onSuccess:()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),h=_({mutationFn:({id:c,name:p,...y})=>s.put(`packageprofiles/${p}/constraints/${c}`,y),onSuccess:()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),f=_({mutationFn:({name:c,...p})=>s.delete(`packageprofiles/${c}/constraints`,{params:p}),onSuccess:()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])});return{addPackageProfileConstraintsQuery:l,copyPackageProfileQuery:m,createPackageProfileQuery:i,editPackageProfileConstraintQuery:h,editPackageProfileQuery:u,getInstancePackageProfileQuery:j,getPackageProfileConstraintsQuery:t,getPackageProfilesQuery:d,removePackageProfileConstraintsQuery:f,removePackageProfileQuery:g}}const R={constraint:"",notAnyVersion:!1,package:"",rule:"",version:""},Ve=Object.fromEntries(Object.keys(R).map(a=>[a,!0])),ee={constraint:"",id:0,package:"loading",rule:"",version:"",notAnyVersion:!1},ae=[{label:"Any",value:""},{label:"Newer or equal to",value:">="},{label:"Newer than",value:">"},{label:"Equal to",value:"="},{label:"Older than",value:"<"},{label:"Older or equal to",value:"<="}],se=[{label:"Select",value:""},{label:"Conflicts with",value:"conflicts"},{label:"Depends on",value:"depends"}],He={access_group:"",all_computers:!1,constraints:[R],constraintsType:"",csvFile:null,description:"",isCsvFileParsed:!1,material:"",source_computer_id:0,tags:[],title:""},Ke=E().shape({access_group:x(),all_computers:I(),constraints:F().when("constraintsType",{is:"manual",then:a=>a.of(E().shape({constraint:x().required("Required."),notAnyVersion:I(),package:x().required("Required."),rule:x().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")}),version:x().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")})})).min(1,"Package profiles must have at least one package constraint.")}),constraintsType:x().required("This field is required."),csvFile:H().nullable().test({name:"mime-type",message:"Invalid file type.",test:a=>!a||a.type==="text/csv"}).when("constraintsType",{is:"material",then:a=>a.required("This field is required.")}),description:x().required("This field is required."),isCsvFileParsed:I(),material:x().when("constraintsType",{is:"material",then:a=>a.required("The file cannot be empty.")}),source_computer_id:K().when("constraintsType",{is:"instance",then:a=>a.min(1,"This field is required.")}),tags:F().of(x()),title:x().required("This field is required.")}),te="_constraint_1lz67_1",ne="_hidden_1lz67_5",Q={constraint:te,hidden:ne},oe=({row:a,column:s})=>{const o={};return a.original.package==="loading"?s.id==="package"?o.colSpan=3:(o.className=Q.hidden,o["aria-hidden"]=!0):s.id==="package"?o.role="rowheader":s.id==="constraint"?o["aria-label"]="Constraint":s.id==="rule"?o["aria-label"]="Rule":s.id==="version"&&(o["aria-label"]="Version"),o},ie=({isConstraintsLoading:a,profileConstraints:s,search:o})=>{const d=r.useMemo(()=>a?[ee]:s?s.map(i=>({...i,notAnyVersion:!!i.version})):[],[a,s]),m=r.useMemo(()=>[{accessor:"constraint",className:Q.constraint,Header:"Constraint",Cell:({row:{original:i}})=>{var g;return((g=se.find(({value:u})=>u===i.constraint))==null?void 0:g.label)??i.constraint}},{accessor:"package",Header:"Package",Cell:({row:{original:i}})=>i.package==="loading"?e.jsx(P,{}):i.package},{accessor:"version",Header:"Version",Cell:({row:{original:i}})=>{var g;return i.version?`${(g=ae.find(({value:u})=>u===i.rule))==null?void 0:g.label} ${i.version}`:"Any"}}],[d]);return e.jsx(n.ModularTable,{columns:m,data:d,getCellProps:oe,emptyMsg:`No constraints found with the search: "${o}"`})},re="_actions_nxngq_1",ce={actions:re},le=r.lazy(()=>k(()=>import("./index-DyiFP2ru.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),de=({profile:a})=>{const[s,o]=r.useState(1),[d,m]=r.useState(20),[i,g]=r.useState(""),{setSidePanelContent:u}=b(),{getPackageProfileConstraintsQuery:j}=T(),{data:t,isLoading:l}=j({name:a.name,limit:d,offset:(s-1)*d,search:i}),h=()=>{u(`Change "${a.name}" profile's constraints`,e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(le,{profile:a})}),"medium")};return e.jsxs(e.Fragment,{children:[!i&&s===1&&d===20&&l&&e.jsx(P,{}),(i||s!==1||d!==20||!l&&t&&t.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsxs(n.Row,{className:O("u-no-padding--left u-no-padding--right",ce.actions),children:[e.jsx(n.Col,{size:6,children:e.jsx(D,{onSearch:f=>g(f)})}),e.jsx(n.Col,{size:6,className:"u-align-text--right",children:e.jsx(n.Button,{type:"button",onClick:h,children:"Change package constraints"})})]}),e.jsx(ie,{isConstraintsLoading:l,profileConstraints:t==null?void 0:t.data.results,search:i}),e.jsx(X,{currentPage:s,pageSize:d,paginate:f=>o(f),setPageSize:f=>m(f),totalItems:t==null?void 0:t.data.count})]})]})},ue=r.lazy(()=>k(()=>import("./index-x-e6_eGZ.js"),__vite__mapDeps([17,1,2,18,19,20,21,11,22,23,24,25,14,9,10,12,13,3,4,6,7,8,15]))),pe=r.lazy(()=>k(()=>import("./index-BNk1Lh6M.js"),__vite__mapDeps([26,1,2,14,11,23,24,25,18,19,20,21,22,9,10,12,13,3,4,6,7,8,15]))),ge=({profile:a})=>{var h;const s=q(),{notify:o}=w(),{closeSidePanel:d,setSidePanelContent:m}=b(),{removePackageProfileQuery:i}=T(),{mutateAsync:g,isPending:u}=i,j=async()=>{try{await g({name:a.name}),d(),o.success({message:`Package profile "${name}" removed successfully.`,title:"Package profile removed"})}catch(f){s(f)}},t=()=>{m("Edit package profile",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(pe,{profile:a})}))},l=()=>{m("Duplicate package profile",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ue,{profile:a})}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(n.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:l,children:[e.jsx(n.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate profile"})]}),e.jsxs(n.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:t,children:[e.jsx(n.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",confirmationModalProps:{title:"Remove package profile",children:e.jsxs("p",{children:['This will remove "',a.name,'" profile.']}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:u,confirmButtonLoading:u,onConfirm:j},children:[e.jsx(n.Icon,{name:n.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(n.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(n.Col,{size:3,children:e.jsx(C,{label:"Name",value:a.name})}),e.jsx(n.Col,{size:9,children:e.jsx(C,{label:"Description",value:a.description})}),e.jsx(n.Col,{size:3,children:e.jsx(C,{label:"Access group",value:a.access_group})}),e.jsx(n.Col,{size:9,children:e.jsx(C,{label:"Tags",value:a.tags.join(", ")})}),e.jsx(n.Col,{size:3,children:e.jsx(C,{label:"Associated to",value:`${a.computers.constrained.length} instances`})}),e.jsx(n.Col,{size:3,children:e.jsx(C,{label:"Pending on",value:`${((h=a.computers.pending)==null?void 0:h.length)??0} instances`})}),e.jsx(n.Col,{size:3,children:e.jsx(C,{label:"Not compliant on",value:`${a.computers["non-compliant"].length} instances`})})]}),e.jsx(de,{profile:a})]})},me="_noWrap_bjhex_1",he="_toggleButton_bjhex_5",fe="_menu_bjhex_10",A={noWrap:me,toggleButton:he,menu:fe},Pe=r.lazy(()=>k(()=>import("./index-DyiFP2ru.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),xe=r.lazy(()=>k(()=>import("./index-x-e6_eGZ.js"),__vite__mapDeps([17,1,2,18,19,20,21,11,22,23,24,25,14,9,10,12,13,3,4,6,7,8,15]))),je=r.lazy(()=>k(()=>import("./index-BNk1Lh6M.js"),__vite__mapDeps([26,1,2,14,11,23,24,25,18,19,20,21,22,9,10,12,13,3,4,6,7,8,15]))),ke=({profile:a})=>{const[s,o]=r.useState(!1),[d,m]=r.useState(""),i=q(),{notify:g}=w(),{setSidePanelContent:u}=b(),{removePackageProfileQuery:j}=T(),{mutateAsync:t,isPending:l}=j,h=()=>{u(`Change "${a.title}" profile's constraints`,e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Pe,{profile:a})}),"medium")},f=()=>{u(`Edit "${a.title}" profile`,e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(je,{profile:a})}))},c=()=>{u(`Duplicate "${a.title}" profile`,e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(xe,{profile:a})}))},p=async()=>{try{await t({name:a.name}),g.success({message:`Package profile "${a.title}" removed successfully`,title:"Package profile removed"})}catch(S){i(S)}finally{$()}},y=()=>{o(!0)},$=()=>{o(!1)},z=S=>{m(S.target.value)},M=[{children:e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),"aria-label":`Edit ${a.title} profile`,hasIcon:!0,onClick:f},{children:e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{name:"applications"}),e.jsx("span",{className:A.noWrap,children:"Change package constraints"})]}),"aria-label":`Change ${a.title} package constraints`,hasIcon:!0,onClick:h},{children:e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate"})]}),"aria-label":`Duplicate ${a.title} profile`,hasIcon:!0,onClick:c},{children:e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{name:n.ICONS.delete}),e.jsx("span",{children:"Remove"})]}),"aria-label":`Remove ${a.title} profile`,hasIcon:!0,onClick:y}];return e.jsxs(e.Fragment,{children:[e.jsx(n.ContextualMenu,{position:"left",className:A.menu,toggleClassName:A.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(n.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${a.title} profile actions`},links:M}),s&&e.jsxs(n.ConfirmationModal,{title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:l||d!==`remove ${a.name}`,confirmButtonLoading:l,onConfirm:p,close:$,children:[e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is irreversible.']}),"Type ",e.jsxs("b",{children:["remove ",a.name]})," to confirm.",e.jsx(n.Input,{type:"text",value:d,onChange:z})]})]})},ye=`These instances are not compliant
with the profile. They do not have a
pending activity to become compliant.`,_e=`These instances are not compliant
with the profile. They do have a
pending activity to apply its
constraints.`,Ce=({column:a})=>{const s={};return a.id==="name"?s.role="rowheader":a.id==="description"?s["aria-label"]="Description":a.id==="access_group"?s["aria-label"]="Access group":a.id==="tags"?s["aria-label"]="Tags":a.id==="computers['non-compliant']"?s["aria-label"]="Not compliant instances":a.id==="computers['pending']"?s["aria-label"]="Pending instances":a.id==="computers['constrained']"?s["aria-label"]="Associated instances":a.id==="actions"&&(s["aria-label"]="Actions"),s},ve="_truncated_gca7y_1",be="_noWrap_gca7y_2",Te="_actions_gca7y_11",Se="_description_gca7y_19",v={truncated:ve,noWrap:be,actions:Te,description:Se},Ne=({packageProfiles:a})=>{const{search:s}=L(),{setSidePanelContent:o}=b(),{getAccessGroupQuery:d}=Z(),{data:m}=d(),i=(m==null?void 0:m.data.map(({name:t,title:l})=>({label:l,value:t})))??[],g=t=>{o(t.title,e.jsx(ge,{profile:t}),"medium")},u=r.useMemo(()=>s?a.filter(t=>t.title.toLowerCase().includes(s.toLowerCase())):a,[a,s]),j=r.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:{original:t}})=>e.jsx(n.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>g(t),children:t.title})},{accessor:"description",className:O(v.truncated,v.description),Header:"Description"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:{access_group:t}}})=>{var l;return((l=i.find(({value:h})=>h===t))==null?void 0:l.label)??t}},{accessor:"tags",className:v.truncated,Header:"Tags",Cell:({row:{original:{tags:t}}})=>t.join(", ")},{accessor:"computers['non-compliant']",Header:e.jsxs("div",{className:v.noWrap,children:[e.jsx("span",{children:"Not compliant "}),e.jsx(n.Tooltip,{position:"btm-left",message:ye,children:e.jsx(n.Icon,{name:"help"})})]}),Cell:({row:{original:t}})=>e.jsx(e.Fragment,{children:`${t.computers["non-compliant"].length} ${t.computers["non-compliant"].length===1?"instance":"instances"}`})},{accessor:"computers['pending']",Header:e.jsxs("div",{className:v.noWrap,children:[e.jsx("span",{children:"Pending "}),e.jsx(n.Tooltip,{position:"btm-left",message:_e,children:e.jsx(n.Icon,{name:"help"})})]}),Cell:({row:{original:t}})=>{var l,h;return e.jsx(e.Fragment,{children:`${((l=t.computers.pending)==null?void 0:l.length)??0} ${((h=t.computers.pending)==null?void 0:h.length)===1?"instance":"instances"}`})}},{accessor:"computers['constrained']",Header:"Associated",Cell:({row:{original:t}})=>e.jsx(e.Fragment,{children:`${t.computers.constrained.length} ${t.computers.constrained.length===1?"instance":"instances"}`})},{accessor:"actions",className:v.actions,Header:"Actions",Cell:({row:{original:t}})=>e.jsx(ke,{profile:t})}],[u,i.length]);return e.jsx(n.ModularTable,{columns:j,data:u,emptyMsg:`No package profiles found with the search "${s}"`,getCellProps:Ce})},Ie=()=>{const{setPageParams:a}=L(),s=o=>{a({search:o})};return e.jsx(D,{onSearch:s})},Ae=r.lazy(()=>k(()=>import("./index-DG8224VS.js").then(a=>a.i),__vite__mapDeps([27,1,2,28,29,5,30,21,11,14,18,19,20,22,23,24,25,31]))),$e=()=>{const{setSidePanelContent:a}=b(),s=()=>{a("Add package profile",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ae,{})}),"medium")};return e.jsx(W,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You havenâ€™t added any package profile yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-packages",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage packages in Landscape"})]}),cta:[e.jsx(n.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add")],icon:"package-profiles",title:"No package profiles found"})},Ee=({packageProfiles:a=[]})=>e.jsxs(e.Fragment,{children:[e.jsx(Ie,{}),e.jsx(Ne,{packageProfiles:a})]}),Fe=()=>{const{getPackageProfilesQuery:a}=T(),{data:s,isLoading:o}=a();return e.jsxs(e.Fragment,{children:[o&&e.jsx(P,{}),!o&&(!s||s.data.result.length===0)&&e.jsx($e,{}),!o&&s&&s.data.result.length>0&&e.jsx(Ee,{packageProfiles:s==null?void 0:s.data.result})]})},Oe=r.lazy(()=>k(()=>import("./index-DG8224VS.js").then(a=>a.a),__vite__mapDeps([27,1,2,28,29,5,30,21,11,14,18,19,20,22,23,24,25,31])).then(a=>({default:a.PackageProfileCreateForm}))),qe=()=>{const{setSidePanelContent:a}=b(),s=()=>{a("Add package profile",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Oe,{})}),"medium")};return e.jsxs(G,{children:[e.jsx(U,{title:"Package profiles",actions:[e.jsx(n.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add-package-profile")]}),e.jsx(Y,{children:e.jsx(Fe,{})})]})},We=Object.freeze(Object.defineProperty({__proto__:null,default:qe},Symbol.toStringTag,{value:"Module"}));export{se as C,R as E,He as I,ee as L,Ne as P,Ve as T,Ke as V,ae as a,Ie as b,$e as c,We as i,T as u};
