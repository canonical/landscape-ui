const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-ChOaK5-o.js","assets/index-C_124pJU.js","assets/index-tBQFzVrl.css","assets/SidePanelFormButtons-DT43jWWI.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/index-Ba81IojM.css","assets/index-9vbImfya.js","assets/index-DK3-hOdJ.js","assets/downshift.esm-DV7E-buA.js","assets/index-QZipd6RP.css"])))=>i.map(i=>d[i]);
import{f as N,i as F,g as y,h as x,l as P,j as a,al as E,r as p,o as f,_ as C,a as D,K as L,m as h,ac as O,L as w,n as Q,e as A}from"./index-C_124pJU.js";function se(){const e=N(),t=F(),n=(o,m={})=>x({queryKey:["usns",o],queryFn:async()=>t.get("usns",{params:o}),...m}),d=({usn:o,...m},v={})=>x({queryKey:["usnPackages",{usn:o,...m}],queryFn:async()=>t.get(`usns/${o}`,{params:m}),...v}),u=y({mutationFn:async({instanceId:o,...m})=>t.post(`/computers/${o}/usns/upgrade-packages`,m),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])}),r=y({mutationFn:async({instanceId:o,...m})=>t.post(`/computers/${o}/usns/remove-packages`,m),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])}),s=y({mutationFn:async o=>t.post("/computers/usns/upgrade-packages",o),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["usns"]}),e.invalidateQueries({queryKey:["activities"]})])});return{getUsnsQuery:n,getAffectedPackagesQuery:d,upgradeInstanceUsnsQuery:u,removeUsnPackagesQuery:r,upgradeUsnsQuery:s}}const i={downgrade:{appearance:"positive",icon:"begin-downloading",label:"Downgrade",order:4},hold:{appearance:"positive",icon:"pause",label:"Hold",order:2},remove:{appearance:"negative",icon:"delete",label:"Uninstall",order:1},unhold:{appearance:"positive",icon:"play",label:"Unhold",order:3},upgrade:{appearance:"positive",icon:"change-version",label:"Upgrade",order:5}},R=p.lazy(async()=>C(()=>import("./index-ChOaK5-o.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),H=({pkg:e})=>{const{setSidePanelContent:t}=P(),n={remove:!0,hold:e.status!=="held",unhold:e.status==="held",upgrade:!!e.available_version&&e.available_version!==e.current_version,downgrade:e.status!=="held"},d=s=>{t(`${i[s].label} ${e.name}`,a.jsx(p.Suspense,{fallback:a.jsx(f,{}),children:a.jsx(R,{action:s,packages:[e]})}))},u=Object.keys(i).map(s=>s).filter(s=>n[s]&&i[s].appearance=="positive").sort((s,o)=>i[o].order-i[s].order).map(s=>({icon:i[s].icon,label:i[s].label,"aria-label":`${i[s].label} ${e.name} package`,onClick:()=>{d(s)}})),r=Object.keys(i).map(s=>s).filter(s=>n[s]&&i[s].appearance=="negative").sort((s,o)=>i[o].order-i[s].order).map(s=>({icon:i[s].icon,label:i[s].label,"aria-label":`${i[s].label} ${e.name} package`,onClick:()=>{d(s)}}));return a.jsx(E,{toggleAriaLabel:`${e.name} package actions`,actions:u,destructiveActions:r})},V=({onDismiss:e})=>{const t=D(),{instanceId:n,childInstanceId:d}=L();return a.jsxs(h.Notification,{severity:"caution",onDismiss:e,children:[a.jsx("strong",{children:"Some upgrades require Ubuntu Pro: "}),a.jsxs("span",{children:["Your current Ubuntu package upgrades are limited. To unlock full upgrades, please upgrade to Ubuntu Pro."," "]}),a.jsx(h.Button,{type:"button",appearance:"link",onClick:()=>{t(`/instances/${d?`${n}/${d}`:n}`,{state:{tab:"ubuntu-pro"}})},children:"Learn more"})]})},B={available_version:null,current_version:null,id:-1,name:"loading",status:"available",summary:""},M="_checkbox_p36ti_1",W="_details_p36ti_5",z="_tooltipLink_p36ti_9",G="_hidden_p36ti_13",j={checkbox:M,details:W,tooltipLink:z,hidden:G},I=e=>!!e.available_version&&!!e.current_version&&e.available_version.includes("ubuntu-pro"),q=e=>{const t={label:"Unknown",icon:""};return e.status==="available"?(t.label="Available",t.icon="status-queued-small"):e.status==="held"?(t.label="Held",t.icon="status-in-progress-small"):e.status==="security"?(t.label="Security upgrade",t.icon="status-failed-small"):e.status==="installed"&&(e.available_version!==e.current_version?(t.label="Regular upgrade",t.icon="status-waiting-small"):(t.label="Installed",t.icon="status-succeeded-small")),t},Y=({column:e,row:t})=>{const n={};return t.original.name==="loading"?e.id==="name"?n.colSpan=5:(n.className=j.hidden,n["aria-hidden"]=!0):e.id==="checkbox"?n["aria-label"]=`Toggle ${t.original.name} package`:e.id==="name"?n.role="rowheader":e.id==="status"?n["aria-label"]="Status":e.id==="current_version"?n["aria-label"]="Current version":e.id==="available_version"?n["aria-label"]="Available version":e.id==="summary"&&(n["aria-label"]="Details"),n},J=p.lazy(async()=>C(()=>import("./index-9vbImfya.js"),__vite__mapDeps([7,1,2]))),te=({emptyMsg:e,onPackagesSelect:t,packages:n,packagesLoading:d,selectedPackages:u,selectAll:r})=>{const[s,o]=p.useState(!1),[m,v]=p.useState(!1),{instanceId:c,childInstanceId:g}=L(),{setSidePanelContent:_}=P(),K=p.useMemo(()=>d?[B]:n,[n,d]),$=l=>{t(u.some(({name:b})=>b===l.name)?u.filter(({name:b})=>b!==l.name):[...u,l])},k=()=>{t(u.length>0?[]:n.filter(l=>!I(l)))};p.useEffect(()=>{!r||s||!n.length||(k(),o(!0))},[r,n]);const T=l=>{_("Package details",a.jsx(p.Suspense,{fallback:a.jsx(f,{}),children:a.jsx(J,{singlePackage:l})}))},U=p.useMemo(()=>[{accessor:"checkbox",className:j.checkbox,Header:a.jsx(h.CheckboxInput,{inline:!0,label:a.jsx("span",{className:"u-off-screen",children:"Toggle all"}),checked:u.length===n.length&&n.length>0,indeterminate:u.length<n.length&&u.length>0,disabled:n.length===0,onChange:k}),Cell:({row:l})=>I(l.original)?a.jsx(h.Tooltip,{message:a.jsxs("div",{children:[a.jsx("p",{className:"u-no-padding--top",children:"Ubuntu Pro is required"}),a.jsx(w,{to:`/instances/${g?`${c}/${g}`:`${c}`}`,state:{tab:"ubuntu-pro"},className:j.tooltipLink,children:"learn more"})]}),children:a.jsx(h.CheckboxInput,{inline:!0,disabled:!0,label:a.jsx("span",{className:"u-off-screen",children:`Toggle ${l.original.name}`}),checked:u.some(({name:b})=>b===l.original.name),onChange:()=>{$(l.original)}})}):a.jsx(h.CheckboxInput,{inline:!0,label:a.jsx("span",{className:"u-off-screen",children:`Toggle ${l.original.name}`}),checked:u.some(({name:b})=>b===l.original.name),onChange:()=>{$(l.original)}})},{accessor:"name",Header:"Name",Cell:({row:l})=>l.original.name==="loading"?a.jsx(f,{}):a.jsx(h.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{T(l.original)},children:l.original.name})},{accessor:"status",Header:"Status",Cell:({row:{original:l}})=>q(l).label,getCellIcon:({row:{original:l}})=>q(l).icon},{accessor:"current_version",Header:"Current version"},{accessor:"summary",className:j.details,Header:"Details",Cell:({row:{original:l}})=>l.available_version?a.jsxs(a.Fragment,{children:[a.jsx("span",{children:l.summary}),a.jsx("br",{}),a.jsx("span",{children:`available version: ${l.available_version}`})]}):l.summary},{...O,Cell:({row:{original:l}})=>a.jsx(H,{pkg:l})}],[n,u.length]);return a.jsxs(a.Fragment,{children:[!m&&n.some(I)&&a.jsx(V,{onDismiss:()=>{v(!0)}}),a.jsx(h.ModularTable,{columns:U,data:K,getCellProps:Y,emptyMsg:e})]})},X="_container_1nwlw_1",Z="_noWrap_1nwlw_5",S={container:X,noWrap:Z},ee=p.lazy(()=>C(()=>import("./index-ChOaK5-o.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),ae=p.lazy(()=>C(()=>import("./index-DK3-hOdJ.js"),__vite__mapDeps([8,1,2,3,4,5,9,10]))),re=({selectedPackages:e})=>{const{setSidePanelContent:t}=P(),n=r=>{const s=e.length===1?e[0].name:`${e.length} selected packages`;t(`${i[r].label} ${s}`,a.jsx(p.Suspense,{fallback:a.jsx(f,{}),children:a.jsx(ee,{action:r,packages:e})}))},d={remove:e.length===0||e.every(r=>!r.current_version),hold:e.length===0||e.every(r=>r.status==="held"),unhold:e.length===0||e.every(r=>r.status!=="held"),upgrade:e.length===0||e.every(r=>!r.available_version)},u=()=>{t("Install packages",a.jsx(p.Suspense,{fallback:a.jsx(f,{}),children:a.jsx(ae,{})}))};return a.jsxs("div",{className:S.container,children:[a.jsxs(h.Button,{type:"button",onClick:u,hasIcon:!0,className:Q("u-no-margin--bottom",S.noWrap),children:[a.jsx("i",{className:"p-icon--plus"}),a.jsx("span",{children:"Install"})]}),a.jsx("div",{className:Q("p-segmented-control is-small",S.noWrap),children:Object.keys(i).filter(r=>r!=="downgrade").map(r=>r).sort((r,s)=>i[r].order-i[s].order).map(r=>a.jsxs(h.Button,{type:"button",className:"p-segmented-control__button has-icon u-no-margin--bottom",disabled:d[r],onClick:()=>n(r),children:[a.jsx(h.Icon,{name:i[r].icon}),a.jsx("span",{children:i[r].label})]},r))},"buttons")]})};function le(){const e=N(),t=A(),n=F(),d=(c,g={})=>x({queryKey:["packages",c],queryFn:async()=>n.get("packages",{params:c}),...g}),u=({instance_id:c,...g},_={})=>x({queryKey:["packages",{instance_id:c,...g}],queryFn:async()=>n.get(`computers/${c}/packages`,{params:g}),..._}),r=y({mutationFn:async c=>t.get("UpgradePackages",{params:c}),onSuccess:async()=>e.invalidateQueries({queryKey:["packages"]})}),s=y({mutationFn:async c=>n.post("/computers/upgrade-packages",c),onSuccess:async()=>Promise.all([e.invalidateQueries({queryKey:["packages"]}),e.invalidateQueries({queryKey:["instances"]})])}),o=({instanceId:c,packageName:g},_={})=>x({queryKey:["packageDowngradeVersion",{instanceId:c,packageName:g}],queryFn:async()=>n.get(`computers/${c}/packages/installed/${g}/downgrades`),..._}),m=y({mutationFn:async({instanceId:c,...g})=>n.post(`computers/${c}/packages/installed`,g),onSuccess:async()=>e.invalidateQueries({queryKey:["packages"]})}),v=y({mutationFn:async c=>n.post("packages",c),onSuccess:async()=>e.invalidateQueries({queryKey:["packages"]})});return{getPackagesQuery:d,getInstancePackagesQuery:u,upgradePackagesQuery:r,getDowngradePackageVersionsQuery:o,downgradePackageVersionQuery:m,packagesActionQuery:v,upgradeInstancesPackagesQuery:s}}export{i as I,re as P,le as a,te as b,se as u};
