import{r as d,ap as h,j as e,v as u,D as _,m as y,c as x,d as f,ar as g,T as j,ah as E,i as C,h as w,b,o as v,ai as P}from"./index-2fzpjuii.js";import{P as T,a as R,b as L}from"./PageMain-B0lz2oOC.js";import{T as F}from"./TruncatedCell-CgdNfcLB.js";import{a as S}from"./helpers-BonKpxw0.js";import{H}from"./HeaderWithSearch-BIg5d4wD.js";const I="_message_1po57_1",D="_expandedCell_1po57_5",M="_expandedRow_1po57_10",p={message:I,expandedCell:D,expandedRow:M},N=o=>({index:t})=>{const n={};return o===t&&(n.className=p.expandedRow),n},O=o=>({column:t,row:{index:n}})=>{const s={};return t.id==="creation_time"?s.role="rowheader":t.id==="person_name"?s["aria-label"]="username":t.id==="entity_type"?s["aria-label"]="entity type":t.id==="entity_name"?s["aria-label"]="entity name":t.id==="message"&&(s["aria-label"]="message",o===n&&(s.className=p.expandedCell)),s},Y=({eventsLog:o})=>{const[t,n]=d.useState(""),[s,c]=d.useState(-1),l=d.useRef([]);h({current:s!==-1?l.current[s]:null},()=>c(-1));const r=d.useMemo(()=>[{accessor:"creation_time",Header:"creation time",Cell:({row:a})=>e.jsx(e.Fragment,{children:u(a.original.creation_time).format(_)})},{accessor:"person_name",Header:"username",Cell:({row:a})=>e.jsx(e.Fragment,{children:a.original.person_name})},{accessor:"entity_type",Header:"entity type",Cell:({row:a})=>e.jsx(e.Fragment,{children:a.original.entity_type})},{accessor:"entity_name",Header:"entity name",Cell:({row:a})=>e.jsx(e.Fragment,{children:a.original.entity_name})},{accessor:"message",className:p.message,Header:"message",Cell:({row:{original:a,index:i}})=>e.jsx(F,{content:a.message,isExpanded:i===s,onExpand:()=>{n(""),c(t?i-1:i)}})}],[o,s]);return e.jsx("div",{ref:S(l),children:e.jsx(y.ModularTable,{getCellProps:O(s),getRowProps:N(s),columns:r,data:o,emptyMsg:"No events found according to your search parameters."})})},k=()=>{const{days:o,setPageParams:t}=x();return f("days",g.map(n=>n.value)),e.jsx(j,{multiple:!1,label:"Days",showSelectionOnToggleLabel:!0,hasToggleIcon:!0,options:g,onItemSelect:n=>t({days:n}),selectedItem:o.toString()})},A=()=>e.jsxs(e.Fragment,{children:[e.jsx(H,{actions:e.jsx(k,{})}),e.jsx(E,{filtersToDisplay:["search"]})]});function V(){const o=C();return{getEventsLog:(n,s={})=>w({queryKey:["events",n],queryFn:async()=>o.get("events",{params:n}),...s})}}const $="_header_116wp_1",B={header:$},U=(o,t)=>{const n=["creation_time","person_id","person_name","entity_type","entity_id","entity_name","message"],c=[["Creation Time","Person ID","Person Name","Entity Type","Entity ID","Entity Name","Message"].join(","),...o.map(i=>n.map(m=>i[m]).join(","))].join(`\r
`),l=new Blob([c],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(l),a=document.createElement("a");a.href=r,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)},Z=()=>{const{days:o,search:t,currentPage:n,pageSize:s}=x(),{user:c}=b(),{getEventsLog:l}=V(),{data:r,isLoading:a}=l({days:Number(o),limit:s,offset:(n-1)*s,search:t}),i=d.useMemo(()=>(r==null?void 0:r.data.results.filter(m=>m.message.toLowerCase().includes(t.toLowerCase())))??[],[r,t]);return e.jsxs(T,{children:[e.jsx(R,{className:B.header,title:"Events log",actions:[e.jsx(y.Button,{type:"button",onClick:()=>U(i,`Event Log - ${c.current_account}-${u().format("YYYY-MM-DDTHH mm ss[Z]")}.csv`),children:"Download as CSV"},"download-as-cv")]}),e.jsxs(L,{children:[e.jsx(A,{}),a&&e.jsx(v,{}),!a&&i&&e.jsx(Y,{eventsLog:i}),e.jsx(P,{totalItems:r==null?void 0:r.data.count,currentItemCount:i.length})]})]})};export{Z as default};
