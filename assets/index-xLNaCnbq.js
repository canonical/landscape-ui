import{m as G,f as L,ac as Z,bd as H,j as e,V as P,d as h,be as K,w as f,aW as _,aC as w,s as M,t as W,v as B,z as q,B as A,C as V,H as U,o as X,r as p,a$ as J,i as Q,ay as D,b as Y,aZ as g,az as ee,bf as se,bg as te,bh as ne,aA as ae,bi as re,bj as ie}from"./index-BniO5lih.js";import{P as ce,a as oe,b as le}from"./PageMain-DMSiaUeu.js";import{u as de}from"./useGetInstances-CYwqcOV3.js";import{u as he}from"./useSelection-p6Ak6tLO.js";import{u as pe}from"./useGetTags-CPW6gZD2.js";import{u as ue}from"./useRoles-DRKlPdx8.js";const me=()=>{const s=G(),{data:t,isPending:a}=L({queryKey:["availabilityZones"],queryFn:async()=>s.get("computers/availability-zones")});return{availabilityZones:t?.data.values??[],isGettingAvailabilityZones:a}},xe="_menuContainer_xrtuf_1",je="_wrapper_xrtuf_6",R={menuContainer:xe,wrapper:je},fe=({filters:s,collapseFrom:t="md",menuLabel:a="Filters",className:n,menuPosition:c="right",isCollapsed:i=!1})=>{const r=Z(`(min-width: ${H[t]}px)`);return e.jsx("div",{className:P(R.wrapper,n),children:r&&!i?s.map((o,d)=>e.jsx("span",{children:o},d)):e.jsx(h.ContextualMenu,{position:c,hasToggleIcon:!0,toggleLabel:a,toggleClassName:"u-no-margin--bottom",children:e.jsx("div",{className:R.menuContainer,children:s.map((o,d)=>o.type.name?e.jsx(K,{el:o},d):o)})})})},ye="_label_1i8qt_1",ge={label:ye},Se=({options:s,label:t,inline:a=!1})=>{const{disabledColumns:n,setPageParams:c}=f(),i=r=>s.filter(({value:o})=>!r.includes(o)).map(({value:o})=>o);return _("disabledColumns",s.filter(r=>r.canBeHidden).map(r=>r.value)),e.jsx(w,{type:"multiple",showSelectedItemCount:!0,label:e.jsxs(e.Fragment,{children:[e.jsx(h.Icon,{name:"settings"}),e.jsx("span",{className:ge.label,children:t})]}),onItemsSelect:r=>{c({disabledColumns:i(r)})},options:s,disabledOptions:s.filter(({canBeHidden:r})=>!r),selectedItems:i(n),inline:a})},O=()=>{const s=M(),t=W(),a=(r={},o={})=>L({queryKey:["savedSearches",r],queryFn:async()=>s.get("GetSavedSearches",{params:r}),...o}),n=B({mutationFn:async r=>s.get("CreateSavedSearch",{params:r}),onSuccess:async()=>t.invalidateQueries({queryKey:["savedSearches"]})}),c=B({mutationFn:async r=>s.get("EditSavedSearch",{params:r}),onSuccess:async()=>t.invalidateQueries({queryKey:["savedSearches"]})}),i=B({mutationFn:async r=>s.get("RemoveSavedSearch",{params:r}),onSuccess:async()=>t.invalidateQueries({queryKey:["savedSearches"]})});return{getSavedSearchesQuery:a,createSavedSearchQuery:n,editSavedSearchQuery:c,removeSavedSearchQuery:i}},ve="_container_1im0r_1",be="_list_1im0r_6",_e="_listItem_1im0r_11",we="_search_1im0r_18",Ce="_row_1im0r_26",Ie="_truncated_1im0r_34",y={container:ve,list:be,listItem:_e,search:we,row:Ce,truncated:Ie},Fe=({onSavedSearchClick:s,onSavedSearchRemove:t,savedSearches:a})=>{if(!a.length)return null;const n=q(),{notify:c}=A(),{removeSavedSearchQuery:i}=O(),{mutateAsync:r,isPending:o}=i,d=async l=>{try{await r({name:l}),t(),c.success({message:`Saved search ${l} successfully removed`,title:"Saved search removed"})}catch(m){n(m)}};return e.jsxs("div",{className:y.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Saved searches"}),e.jsx("ul",{className:P("p-list--divided u-no-margin--bottom",y.list),children:a.map(l=>e.jsx("li",{children:e.jsxs("div",{className:y.listItem,children:[e.jsx(h.Button,{type:"button",appearance:"base",className:y.search,onClick:()=>{s(l)},children:e.jsxs(h.Row,{className:y.row,children:[e.jsx(h.Col,{size:4,children:e.jsx(h.Tooltip,{message:l.name,positionElementClassName:y.truncated,children:e.jsx("span",{children:l.name})})}),e.jsx(h.Col,{size:8,children:e.jsx(h.Tooltip,{message:l.search,positionElementClassName:y.truncated,children:e.jsx("span",{children:l.search})})})]})}),e.jsx(h.ConfirmationButton,{className:"has-icon u-no-margin--bottom u-no-padding--bottom u-no-padding--top",type:"button",appearance:"base",confirmationModalProps:{title:"Remove saved search",children:e.jsxs("p",{children:['This will remove the saved search "',l.name,'".']}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:o,confirmButtonLoading:o,onConfirm:()=>d(l.name)},children:e.jsx(h.Icon,{name:"delete"})})]})},l.name))})]})},Pe="_infoContainer_zti77_1",Be="_helpButtonContainer_zti77_9",ke="_helpButton_zti77_9",k={infoContainer:Pe,helpButtonContainer:Be,helpButton:ke},Ne=({onHelpButtonClick:s})=>e.jsx("div",{className:k.infoContainer,children:e.jsx("div",{className:k.helpButtonContainer,children:e.jsx(h.Button,{type:"button",appearance:"base",hasIcon:!0,"aria-label":"Search help",className:k.helpButton,onClick:t=>{t.stopPropagation(),s()},children:e.jsx(h.Icon,{name:h.ICONS.help})})})}),Te=({onClose:s,onSearchSave:t,search:a})=>{const n=q(),{notify:c}=A(),{createSavedSearchQuery:i}=O(),{mutateAsync:r}=i,d=V({initialValues:{name:""},onSubmit:async({name:l})=>{try{await r({search:a,name:l,title:l}),c.success({message:`Saved search ${l} successfully added`,title:"Saved search added"}),t(),s()}catch(m){n(m)}},validationSchema:U({name:X().required("This field is required").test({message:"Name must consist of only lowercase alphanumeric characters and hyphens",test:l=>/^[a-z0-9][-a-z0-9]*$/.test(l)})})});return e.jsxs(h.Form,{onSubmit:d.handleSubmit,noValidate:!0,children:[e.jsx(h.Input,{type:"text",autoComplete:"off",autoFocus:!0,label:"Search name",...d.getFieldProps("name"),error:d.touched.name&&d.errors.name?d.errors.name:void 0}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(h.Button,{type:"button",disabled:d.isSubmitting,onClick:s,children:"Cancel"}),e.jsx(h.Button,{type:"submit",disabled:d.isSubmitting,appearance:"positive","aria-label":`Saved search as ${d.values.name}`,children:"Save search"})]})]})},$e="_container_fqj7b_1",Oe="_prompt_fqj7b_10",Re="_saveButton_fqj7b_17",N={container:$e,prompt:Oe,saveButton:Re},Ee=({onSearchSave:s,search:t})=>{const[a,n]=p.useState(!1);return e.jsxs(e.Fragment,{children:[t&&a&&e.jsx(Te,{onClose:()=>{n(!1)},onSearchSave:s,search:t}),t&&!a&&e.jsxs("div",{className:N.container,children:[e.jsxs("span",{className:N.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:t}),e.jsx("span",{children:"..."})]}),e.jsx(h.Button,{type:"button",appearance:"link",onClick:()=>{n(!0)},className:N.saveButton,children:"Save search"})]})]})},Le="_searchContainer_pk8ic_1",qe="_form_pk8ic_8",Ae="_searchBoxContainer_pk8ic_13",Qe="_input_pk8ic_17",F={searchContainer:Le,form:qe,searchBoxContainer:Ae,input:Qe},E=({inputText:s,savedSearches:t,search:a})=>{if(!t)return[];let n=t;if(a){const c=a.split(",").filter(Boolean);n=n.filter(({name:i})=>c.every(r=>r!==`search:${i}`))}return s&&(n=n.filter(({name:c,search:i})=>c.toLowerCase()!==s.trim().toLowerCase()&&i.toLowerCase()!==s.trim().toLowerCase())),n},De=({onHelpButtonClick:s})=>{const{query:t,setPageParams:a}=f(),[n,c]=p.useState(""),[i,r]=p.useState(!1),{getSavedSearchesQuery:o}=O(),d=p.useRef(null),l=p.useRef(null);J(d,u=>{const j=document.querySelector(".p-modal");j&&j.contains(u.target)||r(!1)});const{data:S,isLoading:C}=o(),I=p.useMemo(()=>E({inputText:n,savedSearches:S?.data,search:t}),[S,n,t]),v=()=>{if(!n)return;const j=E({inputText:"",savedSearches:S?.data,search:t}).some(({name:z})=>z.toLowerCase()===n.trim().toLowerCase())?"search:":"";a({query:t?`${t},${j}${n}`:`${j}${n}`}),c("")},x=u=>{a({query:t?`${t},search:${u.name}`:`search:${u.name}`})},b=u=>{const{key:j}=u;i?(j==="Escape"&&r(!1),j==="Enter"&&v()):j==="Enter"&&r(!0)};return e.jsxs("div",{className:"p-search-and-filter",ref:d,children:[e.jsxs("div",{className:P("p-search-and-filter__search-container",F.searchContainer),"aria-expanded":i,ref:l,onClick:()=>{r(!0)},children:[e.jsx(h.Form,{onSubmit:u=>{u.preventDefault(),v()},className:P("p-search-and-filter__box",F.form),children:e.jsx("div",{className:F.searchBoxContainer,children:e.jsx(h.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autocomplete:"off",className:F.input,value:n,onChange:u=>{c(u)},onClear:()=>{c("")},onSearch:v,onClick:()=>{r(!0)},onKeyUp:b})})}),e.jsx(Ne,{onHelpButtonClick:s})]}),i&&C&&e.jsx(Q,{}),i&&!C&&e.jsxs("div",{className:"p-search-and-filter__panel",children:[e.jsx(Ee,{onSearchSave:()=>{c("")},search:n.trim()}),e.jsx(Fe,{onSavedSearchClick:x,onSavedSearchRemove:()=>{r(!0)},savedSearches:I})]})]})},ze=({options:s,label:t,inline:a=!1})=>{const{accessGroups:n,setPageParams:c}=f();return _("accessGroups",s.map(i=>i.value)),e.jsx(w,{type:"multiple",label:t,hasToggleIcon:!0,hasBadge:!0,options:s,onItemsSelect:i=>{c({accessGroups:i})},selectedItems:n,inline:a})},Ge=({options:s,label:t,inline:a=!1})=>{const[n,c]=p.useState(""),{availabilityZones:i,setPageParams:r}=f(),o=s.length>9&&n?s.filter(({value:l})=>l!=="none"&&l.includes(n)):s;_("availabilityZones",o.map(l=>l.value));const d=l=>{l[l.length-1]==="none"?r({availabilityZones:["none"]}):r({availabilityZones:l[0]!=="none"?l:l.filter(m=>m!=="none")})};return e.jsx(w,{type:"multiple",label:t,hasToggleIcon:!0,hasBadge:!0,onSearch:s.length>9?l=>{c(l)}:void 0,options:o,onItemsSelect:d,selectedItems:i,inline:a})},Ze=({options:s,label:t,inline:a=!1})=>e.jsx(D,{pageParamKey:"contractExpiryDays",label:t,options:s,inline:a}),He=({options:s,label:t,inline:a=!1})=>{const{os:n,setPageParams:c}=f();return _("os",s.map(i=>i.value)),e.jsx(w,{type:"single",hasBadge:!0,label:t,hasToggleIcon:!0,options:s,onItemSelect:i=>{c({os:i})},selectedItem:n,inline:a})},Ke=({options:s,label:t,inline:a=!1})=>{const[n,c]=p.useState(""),{tags:i,setPageParams:r}=f(),o=s.filter(({value:d})=>d.includes(n));return _("tags",o.map(d=>d.value)),e.jsx(w,{type:"multiple",label:t,hasToggleIcon:!0,hasBadge:!0,options:o,onItemsSelect:d=>{r({tags:d})},onSearch:d=>{c(d)},selectedItems:i,inline:a})},Me=({label:s,options:t,inline:a=!1})=>{const{wsl:n,setPageParams:c}=f();return _("wsl",["parent","child"]),e.jsx(w,{type:"multiple",label:s,hasToggleIcon:!0,hasBadge:!0,options:t,onItemsSelect:i=>{c({wsl:i})},selectedItems:n,inline:a})},We="_top_1l498_1",Ve="_searchContainer_1l498_13",Ue="_divider_1l498_22",T={top:We,searchContainer:Ve,divider:Ue},Xe=()=>{const{isFeatureEnabled:s}=Y(),t=["package","reboot","removal","repository"];s("script-profiles")&&t.push("script"),s("usg-profiles")&&t.push("security"),t.push("upgrade"),s("wsl-child-instance-profiles")&&t.push("wsl");const a=[{term:"<keyword>",description:e.jsxs("span",{children:["Instances with the title or hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"distribution:<keyword>",description:e.jsxs("span",{children:["Instances with the installed distribution named"," ",e.jsx("code",{children:"<keyword>"})]})},{term:"needs:reboot",description:"Instances needing a reboot"},{term:"alert:<type>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with outstanding alerts of the specified"," ",e.jsx("code",{children:"<type>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be ",e.jsx("code",{children:"package-upgrades"}),","," ",e.jsx("code",{children:"security-upgrades"}),",",e.jsx("code",{children:"package-profiles"}),","," ",e.jsx("code",{children:"package-reporter"}),", ",e.jsx("code",{children:"esm-disabled"}),","," ",e.jsx("code",{children:"computer-offline"}),",",e.jsx("code",{children:"computer-reboot"}),","," ",e.jsx("code",{children:"computer-duplicates"}),", ",e.jsx("code",{children:"unapproved-activities"}),"."]})]})},{term:"ip:<address>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with IP addresses like ",e.jsx("code",{children:"<address>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<address>"})," can be a fragment or partial IP address representing a subnet such as 91.185.94 to match any instances in the subnet."]})]})},{term:"mac:<address>",description:e.jsxs("span",{children:["Instances with the MAC address ",e.jsx("code",{children:"<address>"})]})},{term:"id:<instance_id>",description:e.jsxs("span",{children:["Instance with the id ",e.jsx("code",{children:"<instance_id>"})]})},{term:"access-group:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," access group"]})},{term:"search:<name>",description:e.jsxs("span",{children:["Instances meeting the terms of the ",e.jsx("code",{children:"<name>"})," saved search"]})},{term:"upgrade-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," upgrade profile"]})},{term:"removal-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," removal profile"]})},{term:"tag:<keyword>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<keyword>"})," tag"]})},{term:"hostname:<keyword>",description:e.jsxs("span",{children:["Instance with the hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"title:<keyword>",description:e.jsxs("span",{children:["Instance with the title ",e.jsx("code",{children:"<keyword>"})]})},{term:"license-id:<license_id>",description:e.jsxs("span",{children:["Search for instances licensed to the specified"," ",e.jsx("code",{children:"<license_id>"})]})},{term:"license-type:<license-type>",description:e.jsxs("span",{children:["Instances associated with the specified"," ",e.jsx("code",{children:"<license-type>"}),". The ",e.jsx("code",{children:"license-type"})," must be one of ",e.jsx("code",{children:"unlicensed"}),", ",e.jsx("code",{children:"pro"}),","," ",e.jsx("code",{children:"free_pro"}),", ",e.jsx("code",{children:"legacy"}),"."]})},{term:"contract:<contract-id>",description:e.jsxs("span",{children:["Instances associated with the specified"," ",e.jsx("code",{children:"<contract-id>"}),","]})},{term:"license-expires-within-days:<days>",description:e.jsxs("span",{children:["Instances associated with a Legacy License that expires within"," ",e.jsx("code",{children:"<days>"})," days."]})},{term:"needs:license OR license-id:none",description:"Search for instances that do not have a Landscape license, and, as a result, are not managed"},{term:"has-pro-management:<option>",description:e.jsxs("span",{children:["Instances with pro management enabled if ",e.jsx("code",{children:"<option>"})," ","is a truthy value or disabled if falsy."]})},{term:"annotation:<key>",description:e.jsxs("span",{children:["Search for instances which define the specified annotation key. Optionally specify ",e.jsx("code",{children:"annotation:<key>:<string>"})," ","which will only return instances whose key matches and value also contains the ",e.jsx("code",{children:"<string>"})," specified"]})},{term:"profile:<type>:<profile_id>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances associated with the profile of type"," ",e.jsx("code",{children:"<type>"})," with the id"," ",e.jsx("code",{children:"<profile_id>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be"," ",t.map((n,c)=>e.jsxs(e.Fragment,{children:[e.jsx("code",{children:n},n),c<t.length-1&&", "]}))]})]})}];return s("usg-profiles")&&a.push({term:"profile:security:<profile_id>:<last_audit_result>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances associated with the security profile with the id"," ",e.jsx("code",{children:"<profile_id>"})," with a last security audit result of"," ",e.jsx("code",{children:"<last_audit_result>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<last_audit_result>"})," can be ",e.jsx("code",{children:"pass"}),","," ",e.jsx("code",{children:"fail"}),", ",e.jsx("code",{children:"in-progress"})]})]})}),s("wsl-child-instance-profiles")&&a.push({term:"profile:wsl:<profile_id>:<compliance_status>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances associated with the WSL child instance profile with the id"," ",e.jsx("code",{children:"<profile_id>"})," with a compliance state of"," ",e.jsx("code",{children:"<compliance_status>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<compliance_status>"})," can be ",e.jsx("code",{children:"compliant"}),", ",e.jsx("code",{children:"noncompliant"})]})]})}),a},Je=({columnFilterOptions:s})=>{const t=Xe(),[a,n]=p.useState(!1),{getAccessGroupQuery:c}=ue(),{tags:i}=pe(),r=i.map(x=>({label:x,value:x}))??[],{availabilityZones:o}=me(),d=o.reduce((x,b)=>(x.push({label:b,value:b}),x),[{label:"Without zones",value:"none",group:"1"}]),{data:l}=c(),m=l?.data.map(({name:x,title:b})=>({value:x,label:b}))??[],S=g.status.options,C=g.os.options,I=g.wsl.options,v=g.contractExpiryDays.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:T.top,children:[e.jsx("div",{className:T.searchContainer,children:e.jsx(De,{onHelpButtonClick:()=>{n(!0)}})}),e.jsx(fe,{isCollapsed:!0,filters:[e.jsx(D,{pageParamKey:"status",label:"Status",options:S},"status"),e.jsx(He,{label:"OS",options:C},"os"),e.jsx(Ge,{label:"Availability zones",options:d},"availability-zone"),e.jsx(ze,{label:"Access groups",options:m},"access-group"),e.jsx(Ke,{label:"Tags",options:r},"tag"),e.jsx(Me,{label:"WSL",options:I},"wsl"),e.jsx(Ze,{label:"Contract expiry",options:v},"contract-expiry"),e.jsx("span",{className:T.divider},"divider-2"),e.jsx(Se,{label:"Columns",options:s},"column")]})]}),e.jsx(ee,{filtersToDisplay:["accessGroups","os","availabilityZones","status","tags","query","wsl","contractExpiryDays"],accessGroupOptions:m,availabilityZonesOptions:d,osOptions:C,statusOptions:S,tagOptions:r,wslOptions:I,contractExpiryOptions:v}),e.jsx(se,{open:a,data:t,onClose:()=>{n(!1)}}),e.jsx(te,{})]})},Ye=p.memo(function({instanceCount:t,instances:a,isGettingInstances:n,selectedInstances:c,setSelectedInstances:i}){const[r,o]=p.useState([]),d=p.useCallback(()=>{i([])},[]);return e.jsxs(e.Fragment,{children:[e.jsx(Je,{columnFilterOptions:r}),n?e.jsx(Q,{}):e.jsx(ne,{instances:a,selectedInstances:c,setColumnFilterOptions:o,setSelectedInstances:i}),e.jsx(ae,{totalItems:t,handleClearSelection:d,currentItemCount:a.length})]})}),$=(s,t)=>s.type==="select"?s.options.find(a=>a.value===t)?.query??"":"",es=({accessGroups:s,availabilityZones:t,contractExpiryDays:a,os:n,query:c,status:i,tags:r})=>{const o=[];return n&&o.push($(g.os,n)),i&&o.push($(g.status,i)),a&&o.push($(g.contractExpiryDays,a)),c&&o.push(...c.split(",")),r.length&&o.push(`tag:${r.join(" OR tag:")}`),s.length&&o.push(`access-group:${s.join(" OR access-group:")}`),t.length&&o.push(t.includes("none")?"availability-zone:null":`availability-zone:${t.join(" OR availability-zone:")}`),o.join(" ")},cs=()=>{const{currentPage:s,pageSize:t,wsl:a,...n}=f(),{instances:c,instancesCount:i,isGettingInstances:r,isErrorInstances:o}=de({query:es(n),archived_only:n.status==="archived",with_alerts:!0,with_upgrades:ie,limit:t,offset:(s-1)*t,wsl_children:a.includes("child"),wsl_parents:a.includes("parent")}),{selectedItems:d,setSelectedItems:l}=he(c,r||o);return e.jsxs(ce,{children:[e.jsx(oe,{title:"Instances",actions:[e.jsx(re,{isGettingInstances:r,selectedInstances:d},"actions")],sticky:!0}),e.jsx(le,{children:e.jsx(Ye,{instanceCount:i,instances:c,isGettingInstances:r,selectedInstances:d,setSelectedInstances:l})})]})};export{cs as default};
