import{j as e,r as f,b as y,y as j,U as P,d as n,B as w,q as S,x as U,a as I,t as N,k as T,n as v,R as O,o as A,C as R}from"./index-DnCwBEud.js";import{u as L,A as B}from"./AuthTemplate-DhPyc-wh.js";const k=({methods:s})=>{if(!s)return null;const a=!!(s.standalone_oidc.available&&s.standalone_oidc.enabled),r=!!(s.ubuntu_one.available&&s.ubuntu_one.enabled),i=!!(s.password.available&&s.password.enabled),u=!!(s.pam.available&&s.pam.enabled),p=s.oidc.available?s.oidc.configurations.filter(({enabled:x})=>x):[],o=i||u,l=r||a||s.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[o&&e.jsx(G,{isIdentityAvailable:u}),l&&e.jsx(C,{isStandaloneOidcEnabled:a,isUbuntuOneEnabled:r,oidcProviders:p}),!o&&!l&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},q="_list_9u1s7_1",F="_button_9u1s7_20",$="_icon_9u1s7_28",b={list:q,button:F,icon:$},C=({isStandaloneOidcEnabled:s,isUbuntuOneEnabled:a,oidcProviders:r})=>{const[i,u]=f.useState(0),[p]=y(),{invitationId:o}=L(),{getOidcUrlQuery:l,getUbuntuOneUrlQuery:x}=j(),g=p.get("redirect-to"),t=p.has("external"),c={};i>0&&(c.id=i),g&&(c.return_to=g),o&&(c.invitation_id=o),t&&(c.external=!0);const{data:d}=l(c,{enabled:i!==0});f.useEffect(()=>{d&&P(d.data.location)},[d]);const m={};g&&(m.return_to=`${window.origin}${g}`),o&&(m.invitation_id=o),t&&(m.external=!0);const{data:_,refetch:E}=x(m,{enabled:!1});return f.useEffect(()=>{_&&P(_.data.location)},[_]),e.jsxs("ul",{className:b.list,children:[a&&e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:E,className:b.button,children:[e.jsx(n.Icon,{name:w("ubuntu-one"),className:b.icon}),e.jsx("span",{children:"Sign in with Ubuntu One"})]})}),s&&e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:()=>u(-1),className:b.button,children:[e.jsx(n.Icon,{name:w("standalone"),className:b.icon}),e.jsx("span",{children:"Sign in with Enterprise Login"})]})}),r.map(h=>e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:()=>u(h.id),className:b.button,children:[e.jsx(n.Icon,{name:w(h.provider),className:b.icon}),e.jsx("span",{children:`Sign in with ${h.name}`})]})},h.id))]})},Q="_buttonRow_f3s21_1",M={buttonRow:Q},G=({isIdentityAvailable:s})=>{const[a]=y(),r=S(),{signInWithEmailAndPasswordQuery:i}=j(),{setUser:u,redirectToExternalUrl:p}=U(),o=I(),l=a.get("redirect-to"),x=a.has("external"),{mutateAsync:g}=i,t=N({initialValues:{email:"",password:""},validationSchema:T().shape({email:s?v().required("This field is required"):v().required("This field is required").email("Please provide a valid email address"),password:v().required("This field is required")}),onSubmit:async c=>{try{const{data:d}=await g({email:c.email,password:c.password});if(x&&l)p(l,{replace:!0});else{"current_account"in d&&u(d);const m=new URL(l??`${O}overview`,location.origin);o(m.toString().replace(m.origin,""),{replace:!0})}}catch(d){r(d)}}});return e.jsxs(n.Form,{onSubmit:t.handleSubmit,children:[e.jsx(n.Input,{type:"text",label:s?"Identity":"Email",error:t.touched.email&&t.errors.email?t.errors.email:void 0,...t.getFieldProps("email"),"data-testid":"email"}),e.jsx(n.PasswordToggle,{id:"password",label:"Password",error:t.touched.password&&t.errors.password?t.errors.password:void 0,...t.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:M.buttonRow,children:e.jsx(n.Button,{type:"submit",appearance:"positive",disabled:t.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},D=()=>{const{getLoginMethodsQuery:s}=j(),{data:a,isLoading:r,isError:i}=s();return e.jsx(B,{title:"Sign in to Landscape",children:r?e.jsx(A,{}):i?e.jsx("p",{className:"u-no-margin--bottom",children:R}):e.jsx(k,{methods:(a==null?void 0:a.data)??null})})};export{D as default};
