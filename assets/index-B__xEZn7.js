import{x as r,ab as b,j as e,N as d,d as o,p as N,I as S,r as v,E as j,aq as P,R as k,f as E,q as w,aw as C}from"./index-DVhJuAPo.js";import{u as T,K}from"./index-B_wHs9h6.js";import"./PageMain-ByRZv6hB.js";import"./useUsns-BnJcK0cc.js";import"./ResponsiveButtons-COwbGEdE.js";import"./useInstances-B2occ7OE.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";const F=(t,a)=>{switch(t){case"Fully patched":return"All available kernel security patches have been applied. You have no pending patches.";case"Kernel upgrade available":{const s=r(a);return`A new kernel version is available.${s.isValid()?` The current version is covered by Livepatch until ${s.format(b)}`:""}`}case"Restart required":return"Low and/or medium patches have been installed. You must restart to complete patching.";case"End of life":return"The kernel is no longer covered by Livepatch. It is not getting high and critical security patches.";case"Livepatch disabled":return"Livepatch is disabled. Kernel patches will not be applied automatically until you enabled Livepatch.";default:return"There was an error getting the status."}},R=t=>{switch(t){case"Patched by Livepatch":case"Fully patched":case"Kernel upgrade available":return"status-succeeded-small";case"Restart required":return"status-waiting-small";case"End of life":return"status-failed-small";default:return"status-failed-small"}},q=(t,a)=>{const s=r(a),n=r(),i=s.diff(n,"days");return i<0||!t||!r(a).isValid()?"status-failed-small":i<7?"status-waiting-small":"status-succeeded-small"},B=(t,a)=>{if(!t)return"Livepatch is disabled";const s=r(a),n=r();return s.diff(n,"days")<0?"Expired":`Expires on ${r(a).format(b)}`},A="_statusIcon_wc7kc_1",V="_tooltipIcon_wc7kc_5",H="_container_wc7kc_9",u={statusIcon:A,tooltipIcon:V,container:H},M=({kernelOverview:t})=>{const a=t.status!=="Livepatch disabled",s=[{label:"current kernel version",value:t.currentVersion||e.jsx(d,{})},{label:"kernel status",value:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a?t.status||e.jsx(d,{}):"Not covered by Livepatch"}),e.jsxs(o.Tooltip,{message:F(t.status,t.expirationDate),className:u.tooltipIcon,children:[e.jsx(o.Icon,{name:"help","aria-hidden":!0}),e.jsx("span",{className:"u-off-screen",children:"Help"})]})]})},{label:"livepatch coverage",value:t.expirationDate?B(a,t.expirationDate):e.jsx(d,{})}];return e.jsx(o.Row,{className:N("u-no-padding--left u-no-padding--right u-no-max-width",u.container),children:s.map(({label:n,value:i})=>e.jsxs(o.Col,{size:3,children:[n==="status"&&e.jsx(o.Icon,{name:R(t.status),"aria-hidden":!0,className:u.statusIcon}),n==="livepatch coverage"&&t.expirationDate&&e.jsx(o.Icon,{name:q(a,t.expirationDate),"aria-hidden":!0,className:u.statusIcon}),e.jsx(S,{label:n,value:i})]},n))})},$=`There are no pending kernel security patches to apply at this time.
                Livepatch applies critical and high security patches in the background without requiring a system restart.
                Patches found since last restart and their status will be shown here.`,U=t=>`https://cve.mitre.org/cgi-bin/cvename.cgi?name=${t}`,Y=t=>{const a={};switch(t.column.id){case"Name":a.role="rowheader";break;case"Patched":a["aria-label"]="Status";break;case"Description":a["aria-label"]="Description";break;case"Bug":a["aria-label"]="Bug";break}return a},z="_description_1s9gq_1",Q={description:z},G=({kernelData:t})=>{const a=v.useMemo(()=>[{Header:e.jsx("span",{children:"CVE"}),accessor:"Name",Cell:({row:s})=>e.jsx(o.Link,{href:U(s.original.Name),target:"_blank",rel:"nofollow noopener noreferrer",className:"u-no-margin--bottom u-no-padding--top",children:s.original.Name})},{Header:"Status",accessor:"Patched",Cell:({row:{original:s}})=>s.Patched?"Patched by Livepatch":"Unpatched",getCellIcon:({row:{original:s}})=>s.Patched?"status-succeeded-small":"status-failed-small",disableSortBy:!0},{Header:"Description",accessor:"Description",className:Q.description,Cell:({row:s})=>s.original.Description||e.jsx(d,{}),disableSortBy:!0},{Header:"Bug",accessor:"Bug",Cell:({row:s})=>s.original.Bug||e.jsx(d,{}),disableSortBy:!0}],[]);return e.jsx(e.Fragment,{children:t.length===0?e.jsx(j,{title:"No outstanding kernel patches",body:$}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"p-heading--5 u-no-padding u-no-margin",children:"Patches discovered since last restart"}),e.jsx(P,{columns:a,data:t,getCellProps:Y,sortable:!0,initialSortColumn:"Name",initialSortDirection:"ascending"})]})})},ae=({instanceTitle:t})=>{const{instanceId:a,childInstanceId:s}=k(),{pageSize:n,currentPage:i}=E(),{getKernelQuery:I,getLivepatchInfoQuery:y}=T(),x=Number(s??a),{data:c,isPending:p}=I({id:x}),{data:h}=y({id:x}),l=h?.data.livepatch_info?.json?.output?.Status&&h?.data.livepatch_info?.json?.output?.Status.length>0?h?.data.livepatch_info?.json?.output?.Status[0]:void 0,g=l?.Livepatch.Fixes??[],L=(_,f)=>g.slice(f,f+_),m=v.useMemo(()=>L(n,(i-1)*n),[g,i,n]),D={currentVersion:l?.Kernel??c?.data.installed?.version_rounded??"",expirationDate:l?.UpgradeRequiredDate&&r(l?.UpgradeRequiredDate).isValid()?l.UpgradeRequiredDate:"",status:c?.data.smart_status??""};return e.jsxs(e.Fragment,{children:[p&&e.jsx(w,{}),!p&&!c?.data.installed&&e.jsx(j,{title:"Kernel information unavailable",body:c?.data.message||"No kernel information available"}),!p&&c?.data.installed&&e.jsxs(e.Fragment,{children:[e.jsx(K,{instanceName:t,hasTableData:m.length>0,kernelStatuses:c.data}),e.jsx(M,{kernelOverview:D}),e.jsx(G,{kernelData:m}),e.jsx(C,{totalItems:g.length,currentItemCount:m.length})]})]})};export{ae as default};
