import{r as x,v as U,a as I,k as S,w as C,j as e,h as l,R as _,s as $,E as k}from"./index-BYYwtqOb.js";import"./moment-BRVkbQ11.js";import{u as m}from"./usePageParams-B645fm9D.js";import{u as j}from"./useUsns-DFa-CfgC.js";import{U as L}from"./UsnList-DuKiymXC.js";import"./useFetchOld-BTtqmpM9.js";import"./SelectAllButton-ChxKCOE3.js";import"./ExpandableTableFooter-DY0GYE3C.js";import"./NoData-CGwk0mn8.js";import"./TablePagination-DWPTC5u3.js";import"./TablePagination.module-CgQ3jx4B.js";import"./TruncatedCell-B5EyjKsH.js";import"./helpers-B4Ea794_.js";const N="_container_eu2va_1",w="_searchContainer_eu2va_6",f={container:N,searchContainer:w},A=({onSearch:r,usns:t})=>{const[a,n]=x.useState(""),{instanceId:o,childInstanceId:s}=U(),{setPageParams:i}=m(),u=I(),p=S(),{notify:c}=C(),{upgradeInstanceUsnsQuery:y}=j(),g=Number(o),{mutateAsync:b,isPending:h}=y,v=()=>{u(`${_}instances/${s?`${g}/${s}`:`${g}`}`),i({tab:"activities"}),c.clear()},P=async()=>{try{await b({instanceId:g,usns:t}),c.success({title:"You queued packages to be upgraded",message:`Affected packages for ${t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:v}]})}catch(d){p(d)}};return e.jsxs("div",{className:f.container,children:[e.jsx("div",{className:f.searchContainer,children:e.jsx(l.Form,{onSubmit:d=>{d.preventDefault(),r(a)},noValidate:!0,children:e.jsx(l.SearchBox,{shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:a,onChange:d=>n(d),onSearch:()=>r(a),onClear:()=>{n(""),r("")}})})}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs(l.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:t.length===0,confirmationModalProps:{title:"Upgrade affected packages",children:e.jsxs("p",{children:["This will upgrade affected packages for"," ",t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`,"."]}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:h,confirmButtonDisabled:h,onConfirm:P},children:[e.jsx(l.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]})})]})},B=({instance:r,isUsnsLoading:t,totalUsnCount:a,usns:n})=>{const[o,s]=x.useState([]),{search:i,setPageParams:u}=m(),p=c=>{u({search:c}),s([])};return e.jsxs(e.Fragment,{children:[e.jsx(A,{onSearch:p,usns:o}),e.jsx(L,{tableType:"paginated",instances:[r],isUsnsLoading:t,onSelectedUsnsChange:c=>s(c),search:i,selectedUsns:o,totalUsnCount:a,usns:n})]})},J=({instance:r})=>{const{search:t,currentPage:a,pageSize:n}=m(),{getUsnsQuery:o}=j(),{data:s,isLoading:i}=o({computer_ids:[r.id],limit:n,offset:(a-1)*n,search:t,show_packages:!1});return e.jsxs(e.Fragment,{children:[!t&&a===1&&n===20&&i&&e.jsx($,{}),!t&&a===1&&n===20&&!i&&(!s||s.data.results.length===0)&&e.jsx(k,{icon:"inspector-debug",title:"No security issues found"}),(t||a>1||n!==20||!i&&s&&s.data.results.length>0)&&e.jsx(B,{instance:r,isUsnsLoading:i,totalUsnCount:(s==null?void 0:s.data.count)??0,usns:(s==null?void 0:s.data.results)??[]})]})};export{J as default};
