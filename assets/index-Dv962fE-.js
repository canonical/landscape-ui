const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CMDcV6G_.js","assets/index-DYykpNVa.js","assets/index-hef1aQzf.css","assets/SidePanelFormButtons-Aj5ThB2m.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useRoles-CK1OAvut.js","assets/useFetchOld-BGD2hIpr.js","assets/formikErrors-Bw8iTXYS.js"])))=>i.map(i=>d[i]);
import{ac as x,p as j,i as h,s as b,C as F,j as e,d as p,L as R,x as m,R as D,z as E,B as I,g as O,ab as $,r as u,y as C,e as g,E as k,$ as y}from"./index-DYykpNVa.js";import{P as M,a as B,b as H}from"./PageMain-BnPck7ZK.js";import{u as A}from"./useRoles-CK1OAvut.js";import{P as V}from"./PageParamFilter-LH49uHXA.js";import{a as G}from"./TableFilterChips-DLH4XQ-H.js";import{F as q}from"./InstancesPageActions-nbDXpXLr.js";import"./index-Cbj0Sz5k.js";import{L as z}from"./constants-CXofZZ4i.js";import{N as U}from"./NoData-CT6SeJUX.js";import{u as _}from"./useGetInstances-CQaSwVqm.js";import{T as Q}from"./TextConfirmationModal-DuGXYB1S.js";import{R as Y}from"./ResponsiveTable-C-8YbfBJ.js";const be={title:"",parent:x},Ce=j().shape({title:h().required("This field is required"),parent:h().required("This field is required")}),K="_container_1gmyi_1",J="_searchContainer_1gmyi_7",f={container:K,searchContainer:J},W=()=>{const{search:s,setPageParams:a,createPageParamsSetter:t}=b(),o=t({search:""}),c=l=>{a({search:l.searchText})},n=F({initialValues:{searchText:s},enableReinitialize:!0,validationSchema:j().shape({search:h()}),onSubmit:c}),i=q.groupBy.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:f.container,children:[e.jsx("div",{className:f.searchContainer,children:e.jsx(p.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:e.jsx(p.SearchBox,{autocomplete:"off",externallyControlled:!0,value:n.values.searchText,onChange:async l=>await n.setFieldValue("searchText",l),placeholder:"Search",onSearch:()=>{n.submitForm()},onClear:o})})}),e.jsx(V,{label:"Group by",options:i,pageParamKey:"groupBy"},"group-by-filter")]}),e.jsx(G,{filtersToDisplay:["search"]})]})},X=({accessGroup:s})=>{const{instancesCount:a,isGettingInstances:t}=_({query:`access-group: ${s.name}`,with_alerts:!0,with_upgrades:!0,limit:1});return t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"u-off-screen",children:"Loading..."}),e.jsx(p.Spinner,{"aria-hidden":!0})]}):a?e.jsxs(R,{to:D.instances.root({accessGroups:[s.name]}),children:[a," ",m(a,"instance")]}):"0 instances"},Z=({close:s,opened:a,accessGroup:t,parentAccessGroupTitle:o})=>{const c=E(),{notify:n}=I(),{removeAccessGroupQuery:i}=A(),{mutateAsync:l,isPending:r}=i,T=async()=>{try{await l({name:t.name}),n.success({title:`You have successfully deleted the "${t.title}" access group.`,message:`All entities in this access group will now belong to "${o}".`})}catch(N){c(N)}finally{s()}},{instancesCount:d=0}=_({query:`access-group:${t.name}`,limit:1}),L=`${d} ${m(d,"instance")}`,v=m(d,"it","them"),w=m(d,"this instance","these instances");return e.jsxs(Q,{isOpen:a,title:`Deleting ${t.title} access group`,confirmButtonLabel:"Delete",confirmationText:`delete ${t.title}`,confirmButtonDisabled:r,confirmButtonLoading:r,onConfirm:T,close:s,children:[d>0?e.jsxs("p",{children:['"',t.title,'" is associated with'," ",L,'. Deleting "',t.title,'" will move ',v,' to the parent access group, "',o,'". Any profiles associated with "',o,'" may be applied to'," ",w,"."]}):e.jsxs("p",{children:['Profiles may be associated with "',t.title,'". Deleting "',t.title,'" will move any associated profiles to its parent group, "',o,'".']}),e.jsxs("p",{children:["This action is ",e.jsx("strong",{children:"irreversible"}),"."]})]})},ee=({accessGroup:s,parentAccessGroupTitle:a})=>{const{value:t,setTrue:o,setFalse:c}=O();return e.jsxs(e.Fragment,{children:[e.jsx($,{toggleAriaLabel:`${s.title} access group actions`,destructiveActions:[{icon:"delete",label:"Delete","aria-label":`Delete "${s.title}" access group`,onClick:o}]}),e.jsx(Z,{close:c,opened:t,accessGroup:s,parentAccessGroupTitle:a})]})},se=s=>{const a={};switch(s.column.id){case"title":a.role="rowheader";break;case"name":a["aria-label"]="Name";break;case"instancesCount":a["aria-label"]="Instances count";break;case"parent":a["aria-label"]="Parent";break;case"id":a["aria-label"]="Actions";break}return a},P=(s,a)=>{const t=a.find(o=>o.name===s);return t&&t.parent?[t,...P(t.parent,a)]:t?[t]:[]},S=(s,a)=>a.filter(t=>t.parent===s).map(t=>({...t,instancesCount:0,subRows:S(t.name,a)})),te=({accessGroups:s})=>{const{groupBy:a,search:t}=b(),o=u.useMemo(()=>{const n=t?s.filter(r=>r.name.toLowerCase().includes(t.toLowerCase())||r.title.toLowerCase().includes(t.toLowerCase())):s;if(a!=="parent")return n.map(r=>({...r,instancesCount:0}));const i=Array.from(new Set([...n,...n.flatMap(r=>P(r.parent||"",s))])),l=new Set(i.filter(r=>r.parent).map(r=>r.name));return i.filter(r=>!l.has(r.name)).map(r=>({...r,instancesCount:0,subRows:S(r.name,i)}))},[s,t,a]),c=u.useMemo(()=>[{accessor:"title",Header:"title",Cell:({row:n})=>e.jsx("div",{style:{paddingLeft:`${n.depth*1.25}rem`},children:e.jsx("span",{children:n.original.title})})},{accessor:"name",Header:"name"},{accessor:"instancesCount",Header:"affected instances",sortType:(n,i)=>n.original.instancesCount-i.original.instancesCount,Cell:({row:n})=>e.jsx(X,{accessGroup:n.original})},{accessor:"parent",Header:"parent",Cell:({row:{original:n}})=>s.find(l=>l.name===n.parent)?.title||e.jsx(U,{})},{...z,Cell:({row:n})=>{if(n.original.name===x)return null;const i=s.find(l=>l.name===n.original.parent)?.title||n.original.parent;return e.jsx(ee,{accessGroup:n.original,parentAccessGroupTitle:i})}}],[a,s]);return e.jsx(Y,{columns:c,data:o,sortable:!0,getCellProps:se,emptyMsg:"No access groups found according to your search parameters."})},ae=u.lazy(()=>y(()=>import("./index-CMDcV6G_.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),ne=()=>{const{getAccessGroupQuery:s}=A(),{setSidePanelContent:a}=C(),{data:t,isPending:o}=s(),c=t?.data||[],n=()=>{a("Add access group",e.jsx(u.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(ae,{})}))};return e.jsxs(e.Fragment,{children:[o&&e.jsx(g,{}),!o&&c.length===0&&e.jsx(k,{title:"No access groups found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any access groups yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/access-groups",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage access groups in Landscape"})]}),cta:[e.jsx(p.Button,{appearance:"positive",onClick:n,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),!o&&c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(W,{}),e.jsx(te,{accessGroups:c})]})]})},re=u.lazy(()=>y(()=>import("./index-CMDcV6G_.js").then(s=>s.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(s=>({default:s.NewAccessGroupForm}))),oe=()=>{const{setSidePanelContent:s}=C(),a=()=>{s("Add access group",e.jsx(u.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(re,{})}))};return e.jsxs(M,{children:[e.jsx(B,{title:"Access groups",actions:[e.jsx(p.Button,{appearance:"positive",onClick:a,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),e.jsx(H,{hasTable:!0,children:e.jsx(ne,{})})]})},ye=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"}));export{ne as A,be as I,Ce as V,ye as i};
