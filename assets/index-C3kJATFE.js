import{i as _,h as g,r as p,j as a,m as s,I as o,v as x,D as j,n as w,N as f,L as y}from"./index-CTElUWT8.js";import{f as k}from"./ScriptsTabs-BbEb29ut.js";import"./TruncatedCell-9kQY5eG0.js";import"./HeaderWithSearch-CJoY5Sdd.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./index-Cfr2i4AK.js";const v=({attachmentId:e,scriptId:n},d={enabled:!0})=>{const m=_(),{data:l,isLoading:u,refetch:t}=g({queryKey:["scripts","attachment",e],queryFn:async()=>m.get(`scripts/${n}/attachments/${e}`),...d});return{scriptAttachment:(l==null?void 0:l.data)??null,isScriptAttachmentsLoading:u,refetch:t}},N="_attachmentBlock_1pnu1_1",D="_attachment_1pnu1_1",L="_link_1pnu1_17",R="_downloadButton_1pnu1_21",r={attachmentBlock:N,attachment:D,link:L,downloadButton:R},C=({script:e})=>{const[n,d]=p.useState(null),{isScriptAttachmentsLoading:m,refetch:l}=v({attachmentId:(n==null?void 0:n.id)??0,scriptId:e.id},{enabled:!1});p.useEffect(()=>{(async()=>{if(!n)return;const{data:c}=await l();if(!c)return;const b=new Blob([c.data],{type:"application/octet-stream"}),h=URL.createObjectURL(b),i=document.createElement("a");i.href=h,i.download=n.name,document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(h),d(null)})()},[n,l]);const u=async(t,c)=>{d({id:t,name:c})};return a.jsxs(a.Fragment,{children:[a.jsxs(s.Row,{className:"u-no-padding",children:[a.jsx(s.Col,{size:6,children:a.jsx(o,{label:"name",value:e.title})}),a.jsx(s.Col,{size:6,children:a.jsx(o,{label:"version",value:e.version_number})})]}),a.jsx(s.Row,{className:"u-no-padding",children:a.jsx(o,{label:"status",value:k(e.status)})}),a.jsx(s.Row,{className:"u-no-padding",children:a.jsx(o,{label:"Date created",value:`${x(e.created_at).format(j)} by ${e.created_by.name}`})}),a.jsx(s.Row,{className:"u-no-padding",children:a.jsx(o,{label:"Last modified",value:`${x(e.last_edited_at).format(j)} by ${e.last_edited_by.name}`})}),a.jsx(s.Row,{className:"u-no-padding",children:a.jsx(s.Col,{size:12,children:a.jsx(o,{className:r.attachmentBlock,label:"attachments",value:e.attachments.length>0?e.attachments.map(t=>a.jsxs("span",{className:r.attachment,children:[a.jsx("span",{children:t.filename}),a.jsx(s.Tooltip,{message:"Download",children:a.jsx(s.Button,{className:w("u-no-margin--bottom",r.downloadButton),type:"button",onClick:async()=>u(t.id,t.filename),disabled:m&&(n==null?void 0:n.id)===t.id,appearance:"link","aria-label":`Download ${t.filename}`,children:a.jsx(s.Icon,{name:"begin-downloading"})})})]},t.id)):a.jsx(f,{})})})}),a.jsx(o,{label:"associated profiles",value:e.script_profiles.length>0?e.script_profiles.map((t,c)=>a.jsxs(y,{className:r.link,to:"/scripts?tab=profiles",state:{scriptProfileId:t.id},children:[t.title,c<e.script_profiles.length-1?", ":""," "]},t.id)):a.jsx(f,{})})]})};export{C as default};
