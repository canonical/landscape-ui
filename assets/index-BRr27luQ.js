import{p as j,o as I,f as S,q as N,s as T,j as i,g as r,I as u}from"./index-5gUg1wBm.js";import{u as k}from"./index-DbisUFkN.js";import{h as A}from"./usePageParams-D1oM-inl.js";import{u as C}from"./index-D6ncOnx6.js";import{U as E,a as D,N as F}from"./constants-TVR4NkfW.js";import{K as P}from"./constants-DUJ1vp5u.js";import"./TablePagination-DVMkfoeg.js";import"./TablePaginationBase-ByjrjRdM.js";import"./StatusFilter-DkqdYofZ.js";import"./TableFilter-DG6ceyvn.js";import"./TableFilterChips-DTuS4Wl3.js";import"./useFetchOld-DoJhfK-Q.js";import"./NoData-CkszD9V_.js";import"./PageMain-B2M7d-if.js";import"./usePackages-DwAMlaR2.js";import"./useInstances-Bwh27CFJ.js";import"./helpers-BnRtd78W.js";try{let a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new a.Error().stack;t&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[t]="4011144c-42c0-45ce-a9f5-2a88a558689b",a._sentryDebugIdIdentifier="sentry-dbid-4011144c-42c0-45ce-a9f5-2a88a558689b")}catch{}const R="_radioGroup_1yu2c_1",B="_marginTop_1yu2c_6",s={radioGroup:R,marginTop:B},ee=({currentKernelVersion:a,upgradeKernelVersions:t,instanceName:m})=>{const p=j(),{instanceId:_}=I(),{closeSidePanel:d}=S(),{notify:f}=N(),{upgradeKernelQuery:y}=C(),{openActivityDetails:v}=k(),{mutateAsync:g,isPending:l}=y,b=[{label:"Select",value:""},...t.map(n=>({label:n.version_rounded,value:n.id.toString()}))],h={deliver_immediately:!0,randomize_delivery:!1,deliver_delay_window:0,deliver_after:"",new_kernel_version_id:t.length===1?t[0].id.toString():"",reboot_after:!1},e=T({initialValues:h,validationSchema:P,onSubmit:async n=>{try{const{data:o}=await g({id:Number(_),kernel_package_id:Number(n.new_kernel_version_id),reboot_after:n.reboot_after});d();const x=n.reboot_after?E:D;f.success({title:`You queued kernel upgrade for "${m}"`,message:x,actions:[{label:"View details",onClick:()=>v(o)}]})}catch(o){p(o)}}}),c=async n=>{const o=n.currentTarget.value==="true";await e.setFieldValue("deliver_immediately",o),o||await e.setFieldValue("deliver_after",A().toISOString().slice(0,16))},w=async()=>{await e.setFieldValue("reboot_after",!0),e.handleSubmit()};return i.jsxs(r.Form,{onSubmit:e.handleSubmit,children:[i.jsx(r.Notification,{severity:"information",title:"Restart recommended",children:i.jsx("span",{children:F})}),i.jsxs(r.Row,{className:"u-no-padding--left u-no-padding--right",children:[i.jsx(r.Col,{size:6,children:i.jsx(u,{label:"current version",value:a})}),i.jsx(r.Col,{size:6,children:i.jsx(u,{label:"new version",value:t.length===1?i.jsx("span",{children:t[0].version_rounded}):i.jsx(r.Select,{options:b,...e.getFieldProps("new_kernel_version")})})})]}),i.jsx("strong",{className:s.marginTop,children:"Delivery time"}),i.jsxs("div",{className:s.radioGroup,children:[i.jsx(r.Input,{type:"radio",label:"As soon as possible",name:"deliver_immediately",value:"true",onChange:c,checked:e.values.deliver_immediately}),i.jsx(r.Input,{type:"radio",label:"Scheduled",name:"deliver_immediately",value:"false",onChange:c,checked:!e.values.deliver_immediately})]}),!e.values.deliver_immediately&&i.jsx(r.Input,{type:"datetime-local",label:"Deliver after",labelClassName:"u-off-screen",...e.getFieldProps("deliver_after"),error:e.touched.deliver_after&&e.errors.deliver_after?e.errors.deliver_after:void 0}),i.jsx("strong",{className:s.marginTop,children:"Randomise delivery over a time window"}),i.jsxs("div",{className:s.radioGroup,children:[i.jsx(r.Input,{type:"radio",label:"No",...e.getFieldProps("randomize_delivery"),onChange:async()=>{await e.setFieldValue("randomize_delivery",!1),await e.setFieldValue("deliver_delay_window",0)},checked:!e.values.randomize_delivery}),i.jsx(r.Input,{type:"radio",label:"Yes",...e.getFieldProps("randomize_delivery"),onChange:async()=>await e.setFieldValue("randomize_delivery",!0),checked:e.values.randomize_delivery})]}),e.values.randomize_delivery&&i.jsx(r.Input,{type:"number",inputMode:"numeric",min:0,label:"Delivery delay window",labelClassName:"u-off-screen",help:"Time in minutes",...e.getFieldProps("deliver_delay_window"),error:e.touched.deliver_delay_window&&e.errors.deliver_delay_window?e.errors.deliver_delay_window:void 0}),i.jsxs("div",{className:"form-buttons",children:[i.jsx(r.Button,{type:"button",appearance:"base",onClick:d,children:"Cancel"}),i.jsx(r.ConfirmationButton,{type:"button",confirmationModalProps:{title:"Upgrading kernel and restarting instance",children:i.jsx("p",{children:"Are you sure? This action will upgrade the kernel and restart the instance."}),confirmButtonLabel:"Upgrade and Restart",confirmButtonAppearance:"positive",confirmButtonLoading:l,confirmButtonDisabled:l,onConfirm:w},children:"Upgrade and Restart"}),i.jsx(r.ConfirmationButton,{type:"button",appearance:"positive",confirmationModalProps:{title:"Upgrading kernel",children:i.jsx("p",{children:"Are you sure? This action will upgrade the kernel."}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:l,confirmButtonDisabled:l,type:"submit",onConfirm:()=>e.handleSubmit()},children:"Upgrade kernel"})]})]})};export{ee as default};
