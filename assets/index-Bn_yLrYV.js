const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BoXryeF6.js","assets/index-_GBNEgML.js","assets/index-D8C4EmL5.css","assets/SidePanelFormButtons-DYZse7eg.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useGPGKeys-DBayXIHF.js","assets/tests-DFnZqbNV.js","assets/useRoles-Cu4V5ba4.js","assets/useAPTSources-DvkON6Qf.js","assets/PageMain-Dp-fNxq8.js","assets/PageMain-C_v2-kHh.css","assets/constants-CmAirV7h.js","assets/RepositoryProfileListActions-DpBxZSFW.js","assets/ModalTablePagination-B9bI6mOM.js","assets/ModalTablePagination-HDr0Q-Wm.css","assets/constants-B547GDHb.js","assets/constants-BnrFFkRy.css","assets/index-Cz9CfuJq.css"])))=>i.map(i=>d[i]);
import{h as P,q as b,o as y,p as j,t as i,j as e,c as u,i as c,ah as d,x as v,y as _,ag as S,a6 as L,a5 as M,ac as N,aL as w,w as C,E as F,a3 as R}from"./index-_GBNEgML.js";import{P as O,a as k,b as D}from"./PageMain-Dp-fNxq8.js";import{L as E}from"./constants-CmAirV7h.js";import{u as I}from"./RepositoryProfileListActions-DpBxZSFW.js";import{M as G}from"./ModalTablePagination-B9bI6mOM.js";import"./constants-B547GDHb.js";const B=s=>{const o=P(),{data:t,isPending:r}=b({queryKey:["aptSources",s],queryFn:()=>o.get("repository/apt-source",{params:s})});return{aptSources:t?.data.results??[],isGettingAPTSources:r}},H=()=>{const s=P(),o=y(),{mutateAsync:t,isPending:r}=j({mutationKey:["aptSources","remove"],mutationFn:({id:n,...a})=>s.delete(`repository/apt-source/${n}`,{params:a}),onSuccess:()=>o.invalidateQueries({queryKey:["aptSources"]})});return{removeAPTSource:t,isRemovingAPTSource:r}},$=({repositoryProfilesResult:{isPending:s,data:o,error:t},goToNextPage:r,goToPreviousPage:n,pageNumber:a})=>{const l=i.useMemo(()=>[{Header:"Repository profile",accessor:"title"}],[]);return s?e.jsx(u,{}):o?e.jsxs(e.Fragment,{children:[e.jsx(c.ModularTable,{columns:l,data:o.data.results}),e.jsx(G,{current:a,max:Math.ceil(o.data.count/d),onNext:r,onPrev:n})]}):e.jsxs(c.Notification,{severity:"negative",children:['The associated repository profiles could not be loaded due to an unexpected error: "',t.message,'"']})},q=({aptSource:s,close:o,opened:t})=>{const{removeAPTSource:r,isRemovingAPTSource:n}=H(),{getRepositoryProfilesQuery:a}=I(),l=v(),{notify:h}=_(),{count:p,decrement:f,increment:A}=S(1),m=a({limit:d,offset:(p-1)*d,search:s.profiles},{enabled:!!s.profiles.length&&t}),T=async()=>{try{await r({id:s.id,disassociate_profiles:!0}),h.success({title:`You have successfully deleted the ${s.name} APT source.`,message:s.profiles.length?"It will no longer be available and it has been removed from its associated profiles.":"It will no longer be available to include in repository profiles."})}catch(x){l(x)}finally{o()}};return e.jsx(L,{className:"is-narrow",close:o,title:`Deleting ${s.name} APT source`,confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonLoading:n,confirmButtonDisabled:!!s.profiles.length&&m.isPending,onConfirm:T,isOpen:t,confirmationText:`delete ${s.name}`,children:s.profiles.length?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This APT source belongs to the following repository profiles."}),e.jsxs("p",{children:["If this source is deleted, it will no longer be included in its profiles. ",e.jsx("strong",{children:"This action is irreversible."})]}),e.jsx($,{repositoryProfilesResult:m,goToNextPage:A,goToPreviousPage:f,pageNumber:p})]}):e.jsxs("p",{children:["If this APT source is deleted, it will no longer be available to include in repository profiles."," ",e.jsx("strong",{children:"This action is irreversible."})]})})},Q=({aptSource:s})=>{const{value:o,setTrue:t,setFalse:r}=M();return e.jsxs(e.Fragment,{children:[e.jsx(N,{toggleAriaLabel:`${s.name} APT source actions`,destructiveActions:[{icon:c.ICONS.delete,label:"Delete","aria-label":`Remove ${s.name} APT source`,onClick:t}]}),e.jsx(q,{aptSource:s,close:r,opened:o})]})},K="_line_1odl9_1",z="_accessGroup_1odl9_10",g={line:K,accessGroup:z},U=s=>{const o={};switch(s.column.id){case"name":o.role="rowheader";break;case"access_group":o["aria-label"]="Access group";break;case"line":o["aria-label"]="Line";break;case"id":o["aria-label"]="Actions";break}return o},Y=({items:s})=>{const o=i.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"access_group",Header:"Access group",className:g.accessGroup},{accessor:"line",Header:"Line",className:g.line},{...E,Cell:({row:t})=>e.jsx(Q,{aptSource:t.original})}],[]);return e.jsx(w,{columns:o,data:i.useMemo(()=>s,[s.length]),emptyMsg:"No APT sources yet.",getCellProps:U})},V=i.lazy(async()=>R(()=>import("./index-BoXryeF6.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18])).then(s=>({default:s.NewAPTSourceForm}))),Z=()=>{const{setSidePanelContent:s}=C(),{aptSources:o,isGettingAPTSources:t}=B(),r=()=>{s("Add APT source",e.jsx(i.Suspense,{fallback:e.jsx(u,{}),children:e.jsx(V,{})}))};return e.jsxs(O,{children:[e.jsx(k,{title:"APT sources",actions:[e.jsx(c.Button,{appearance:"positive",onClick:r,type:"button",children:"Add APT source"},"new-key-button")]}),e.jsxs(D,{children:[t&&e.jsx(u,{}),!t&&o.length===0&&e.jsx(F,{title:"No APT sources found",icon:"connected",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You havenâ€™t added any APT sources yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage APT sources in Landscape"})]}),cta:[e.jsx(c.Button,{appearance:"positive",onClick:r,type:"button",children:"Add APT source"},"table-add-new-mirror")]}),!t&&o.length>0&&e.jsx(Y,{items:o})]})]})},te=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));export{Y as A,H as a,te as i,B as u};
