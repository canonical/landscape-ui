const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-NBshKAdU.js","assets/index-DY0yKsFY.js","assets/index-BPqj2aAr.css","assets/formik.esm-CtTAjn9c.js","assets/HeaderWithSearch-B-1gk42X.js","assets/HeaderWithSearch-CCRO5bRP.css","assets/useConfirm-BmebmGkS.js","assets/CellInput-N885blgV.js","assets/index.esm-BFRrLlkL.js","assets/SidePanelTablePagination-wLGk5kQV.js","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/PageMain-CBWka__a.js","assets/PageMain-DyI__TtH.css","assets/useFetchOld-CZMB78f6.js","assets/useMutation-cdyoRliz.js","assets/InfoItem-DDG2wBCh.js","assets/InfoItem-CGVx4EL4.css","assets/EmptyState-Cp7kPxIV.js","assets/EmptyState-BNXajmMK.css","assets/useRoles-A1iSOABi.js","assets/usePageParams-DET2YUzV.js","assets/index-BLslklsG.css","assets/index-Aqcg27Sq.js","assets/AssociationBlock-DtrFLlE1.js","assets/MultiSelectField-DcwazbYY.js","assets/MultiSelectField-B2rqRhX9.css","assets/useInstances-cT_HEEfr.js","assets/AssociationBlock-Cb2Mr2ww.css","assets/SidePanelFormButtons-BMN115EL.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/index-BP2quhyR.js","assets/index-D-o1e51J.js","assets/FileInput-CHv-JX5g.js","assets/PackageProfileConstraintsBlock-SE7x_RUB.js","assets/PackageProfileConstraintsBlock-DcLUUADU.css","assets/index-DC4TaT2g.css"])))=>i.map(i=>d[i]);
import{c as B,d as Q,r as l,j as e,k as P,g as o,_ as j,f as N,h as C,e as F,m as O}from"./index-DY0yKsFY.js";import{u as $,P as z,a as M,b as V}from"./PageMain-CBWka__a.js";import{u as H}from"./useFetchOld-CZMB78f6.js";import{u as b}from"./useMutation-cdyoRliz.js";import{c as A,a as k,d as I,b as E,g as W,f as G}from"./index.esm-BFRrLlkL.js";import{I as v}from"./InfoItem-DDG2wBCh.js";import{u as w}from"./useConfirm-BmebmGkS.js";import{H as D}from"./HeaderWithSearch-B-1gk42X.js";import{S as K}from"./SidePanelTablePagination-wLGk5kQV.js";import{E as U}from"./EmptyState-Cp7kPxIV.js";import{u as Y}from"./useRoles-A1iSOABi.js";import{u as R}from"./usePageParams-DET2YUzV.js";function S(){const a=B(),t=Q(),r=H(),u=(s={},c={})=>$({queryKey:["packageProfiles",s],queryFn:()=>t.get("packageprofiles",{params:s}),...c}),g=b({mutationFn:s=>t.post("packageprofiles",s),onSuccess:()=>a.invalidateQueries(["packageProfiles"])}),i=b({mutationFn:s=>t.post("packageprofiles",s),onSuccess:()=>a.invalidateQueries(["packageProfiles"])}),p=b({mutationFn:s=>r.get("RemovePackageProfile",{params:s}),onSuccess:()=>a.invalidateQueries(["packageProfiles"])}),m=b({mutationFn:({name:s,...c})=>t.put(`packageprofiles/${s}`,c),onSuccess:()=>a.invalidateQueries(["packageProfiles"])}),x=({instanceId:s,...c},_={})=>$({queryKey:["instancePackageProfiles",{instanceId:s,...c}],queryFn:()=>t.get(`computers/${s}/packages/profile`,{params:c}),..._}),n=({name:s,...c},_={})=>$({queryKey:["packageProfileConstraints",{name:s,...c}],queryFn:()=>t.get(`packageprofiles/${s}/constraints`,{params:c}),..._}),d=b({mutationFn:({name:s,...c})=>t.post(`packageprofiles/${s}/constraints`,c),onSuccess:()=>Promise.all([a.invalidateQueries(["packageProfiles"]),a.invalidateQueries(["packageProfileConstraints"])])}),h=b({mutationFn:({id:s,name:c,..._})=>t.put(`packageprofiles/${c}/constraints/${s}`,_),onSuccess:()=>Promise.all([a.invalidateQueries(["packageProfiles"]),a.invalidateQueries(["packageProfileConstraints"])])}),f=b({mutationFn:({name:s,...c})=>t.delete(`packageprofiles/${s}/constraints`,{params:c}),onSuccess:()=>Promise.all([a.invalidateQueries(["packageProfiles"]),a.invalidateQueries(["packageProfileConstraints"])])});return{addPackageProfileConstraintsQuery:d,copyPackageProfileQuery:g,createPackageProfileQuery:i,editPackageProfileConstraintQuery:h,editPackageProfileQuery:m,getInstancePackageProfileQuery:x,getPackageProfileConstraintsQuery:n,getPackageProfilesQuery:u,removePackageProfileConstraintsQuery:f,removePackageProfileQuery:p}}const L={constraint:"",notAnyVersion:!1,package:"",rule:"",version:""},We=Object.fromEntries(Object.keys(L).map(a=>[a,!0])),J={constraint:"",id:0,package:"loading",rule:"",version:"",notAnyVersion:!1},X=[{label:"Any",value:""},{label:"Newer or equal to",value:">="},{label:"Newer than",value:">"},{label:"Equal to",value:"="},{label:"Older than",value:"<"},{label:"Older or equal to",value:"<="}],Z=[{label:"Select",value:""},{label:"Conflicts with",value:"conflicts"},{label:"Depends on",value:"depends"}],Ge={access_group:"",all_computers:!1,constraints:[L],constraintsType:"",csvFile:null,description:"",isCsvFileParsed:!1,material:"",source_computer_id:0,tags:[],title:""},Ke=A().shape({access_group:k(),all_computers:I(),constraints:E().when("constraintsType",{is:"manual",then:a=>a.of(A().shape({constraint:k().required("Required."),notAnyVersion:I(),package:k().required("Required."),rule:k().when("notAnyVersion",{is:!0,then:t=>t.required("Required.")}),version:k().when("notAnyVersion",{is:!0,then:t=>t.required("Required.")})})).min(1,"Package profiles must have at least one package constraint.")}),constraintsType:k().required("This field is required."),csvFile:W().nullable().test({name:"mime-type",message:"Invalid file type.",test:a=>!a||a.type==="text/csv"}).when("constraintsType",{is:"material",then:a=>a.required("This field is required.")}),description:k().required("This field is required."),isCsvFileParsed:I(),material:k().when("constraintsType",{is:"material",then:a=>a.required("The file cannot be empty.")}),source_computer_id:G().when("constraintsType",{is:"instance",then:a=>a.min(1,"This field is required.")}),tags:E().of(k()),title:k().required("This field is required.")}),ee="_constraint_1lz67_1",ae="_hidden_1lz67_5",q={constraint:ee,hidden:ae},te=({row:a,column:t})=>{const r={};return a.original.package==="loading"?t.id==="package"?r.colSpan=3:(r.className=q.hidden,r["aria-hidden"]=!0):t.id==="package"?r.role="rowheader":t.id==="constraint"?r["aria-label"]="Constraint":t.id==="rule"?r["aria-label"]="Rule":t.id==="version"&&(r["aria-label"]="Version"),r},se=({isConstraintsLoading:a,profileConstraints:t,search:r})=>{const u=l.useMemo(()=>a?[J]:t?t.map(i=>({...i,notAnyVersion:!!i.version})):[],[a,t]),g=l.useMemo(()=>[{accessor:"constraint",className:q.constraint,Header:"Constraint",Cell:({row:{original:i}})=>{var p;return((p=Z.find(({value:m})=>m===i.constraint))==null?void 0:p.label)??i.constraint}},{accessor:"package",Header:"Package",Cell:({row:{original:i}})=>i.package==="loading"?e.jsx(P,{}):i.package},{accessor:"version",Header:"Version",Cell:({row:{original:i}})=>{var p;return i.version?`${(p=X.find(({value:m})=>m===i.rule))==null?void 0:p.label} ${i.version}`:"Any"}}],[u]);return e.jsx(o.ModularTable,{columns:g,data:u,getCellProps:te,emptyMsg:`No constraints found with the search: "${r}"`})},ne="_actions_nxngq_1",oe={actions:ne},ie=l.lazy(()=>j(()=>import("./index-NBshKAdU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))),re=({profile:a})=>{const[t,r]=l.useState(1),[u,g]=l.useState(20),[i,p]=l.useState(""),{setSidePanelContent:m}=N(),{getPackageProfileConstraintsQuery:x}=S(),{data:n,isLoading:d}=x({name:a.name,limit:u,offset:(t-1)*u,search:i}),h=()=>{m(`Change "${a.name}" profile's constraints`,e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ie,{profile:a})}),"medium")};return e.jsxs(e.Fragment,{children:[!i&&t===1&&u===20&&d&&e.jsx(P,{}),(i||t!==1||u!==20||!d&&n&&n.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsxs(o.Row,{className:C("u-no-padding--left u-no-padding--right",oe.actions),children:[e.jsx(o.Col,{size:6,children:e.jsx(D,{onSearch:f=>p(f)})}),e.jsx(o.Col,{size:6,className:"u-align-text--right",children:e.jsx(o.Button,{type:"button",onClick:h,children:"Change package constraints"})})]}),e.jsx(se,{isConstraintsLoading:d,profileConstraints:n==null?void 0:n.data.results,search:i}),e.jsx(K,{currentPage:t,pageSize:u,paginate:f=>r(f),setPageSize:f=>g(f),totalItems:n==null?void 0:n.data.count})]})]})},ce=l.lazy(()=>j(()=>import("./index-Aqcg27Sq.js"),__vite__mapDeps([23,1,2,3,24,25,26,27,14,15,12,13,28,29,30,31,20,8,16,17,6,4,5,9,10,11,18,19,21]))),le=l.lazy(()=>j(()=>import("./index-BP2quhyR.js"),__vite__mapDeps([32,1,2,3,20,14,15,12,13,8,29,30,31,24,25,26,27,28,16,17,6,4,5,9,10,11,18,19,21]))),de=({profile:a})=>{var s;const t=F(),{notify:r}=O(),{closeSidePanel:u,setSidePanelContent:g}=N(),{closeConfirmModal:i,confirmModal:p}=w(),{removePackageProfileQuery:m}=S(),{mutateAsync:x}=m,n=async c=>{try{await x({name:c}),u(),r.success({message:`Package profile "${c}" removed successfully.`,title:"Package profile removed"})}catch(_){t(_)}finally{i()}},d=c=>{p({title:"Remove package profile",body:`This will remove "${c}" profile.`,buttons:[e.jsx(o.Button,{type:"button",appearance:"negative",onClick:()=>n(c),"aria-label":`Remove ${c} profile`,children:"Remove"},"remove")]})},h=()=>{g("Edit package profile",e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(le,{profile:a})}))},f=()=>{g("Duplicate package profile",e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ce,{profile:a})}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(o.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:f,children:[e.jsx(o.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate profile"})]}),e.jsxs(o.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:h,children:[e.jsx(o.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(o.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:()=>d(a.name),children:[e.jsx(o.Icon,{name:"delete"}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(o.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(o.Col,{size:3,children:e.jsx(v,{label:"Name",value:a.name})}),e.jsx(o.Col,{size:9,children:e.jsx(v,{label:"Description",value:a.description})}),e.jsx(o.Col,{size:3,children:e.jsx(v,{label:"Access group",value:a.access_group})}),e.jsx(o.Col,{size:9,children:e.jsx(v,{label:"Tags",value:a.tags.join(", ")})}),e.jsx(o.Col,{size:3,children:e.jsx(v,{label:"Associated to",value:`${a.computers.constrained.length} instances`})}),e.jsx(o.Col,{size:3,children:e.jsx(v,{label:"Pending on",value:`${((s=a.computers.pending)==null?void 0:s.length)??0} instances`})}),e.jsx(o.Col,{size:3,children:e.jsx(v,{label:"Not compliant on",value:`${a.computers["non-compliant"].length} instances`})})]}),e.jsx(re,{profile:a})]})},ue="_noWrap_1bvel_1",pe="_toggleButton_1bvel_5",ge="_actionButton_1bvel_10",y={noWrap:ue,toggleButton:pe,actionButton:ge},me=l.lazy(()=>j(()=>import("./index-NBshKAdU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))),he=l.lazy(()=>j(()=>import("./index-Aqcg27Sq.js"),__vite__mapDeps([23,1,2,3,24,25,26,27,14,15,12,13,28,29,30,31,20,8,16,17,6,4,5,9,10,11,18,19,21]))),fe=l.lazy(()=>j(()=>import("./index-BP2quhyR.js"),__vite__mapDeps([32,1,2,3,20,14,15,12,13,8,29,30,31,24,25,26,27,28,16,17,6,4,5,9,10,11,18,19,21]))),Pe=({profile:a})=>{const t=F(),{notify:r}=O(),{closeConfirmModal:u,confirmModal:g}=w(),{setSidePanelContent:i}=N(),{removePackageProfileQuery:p}=S(),{mutateAsync:m}=p,x=s=>()=>{i(`Change "${s.title}" profile's constraints`,e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(me,{profile:s})}),"medium")},n=s=>{i(`Edit "${s.title}" profile`,e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(fe,{profile:s})}))},d=s=>{i(`Duplicate "${s.title}" profile`,e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(he,{profile:s})}))},h=async s=>{try{await m({name:s.name}),r.success({message:`Package profile "${s.title}" removed successfully`,title:"Package profile removed"})}catch(c){t(c)}finally{u()}},f=s=>{g({title:"Remove package profile",body:`This will remove "${s.title}" profile.`,buttons:[e.jsx(o.Button,{type:"button",appearance:"negative",onClick:()=>h(s),"aria-label":`Remove ${s.title} profile`,children:"Remove"},"remove")]})};return e.jsxs(o.ContextualMenu,{position:"left",toggleClassName:y.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(o.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${a.title} profile actions`},children:[e.jsxs(o.Button,{type:"button",appearance:"base",hasIcon:!0,className:C("u-no-margin--bottom u-no-margin--right",y.actionButton),onClick:()=>n(a),"aria-label":`Edit ${a.title} profile`,children:[e.jsx(o.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(o.Button,{type:"button",appearance:"base",hasIcon:!0,className:C("u-no-margin--bottom u-no-margin--right",y.actionButton),onClick:x(a),"aria-label":`Change ${a.title} package constraints`,children:[e.jsx(o.Icon,{name:"applications"}),e.jsx("span",{className:y.noWrap,children:"Change package constraints"})]}),e.jsxs(o.Button,{type:"button",appearance:"base",hasIcon:!0,className:C("u-no-margin--bottom u-no-margin--right",y.actionButton),onClick:()=>d(a),"aria-label":`Duplicate ${a.title} profile`,children:[e.jsx(o.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate"})]}),e.jsxs(o.Button,{type:"button",appearance:"base",hasIcon:!0,className:C("u-no-margin--bottom u-no-margin--right",y.actionButton),onClick:()=>f(a),"aria-label":`Remove ${a.title} profile`,children:[e.jsx(o.Icon,{name:"delete"}),e.jsx("span",{children:"Remove"})]})]})},ke=`These instances are not compliant
with the profile. They do not have a
pending activity to become compliant.`,xe=`These instances are not compliant
with the profile. They do have a
pending activity to apply its
constraints.`,je=({column:a})=>{const t={};return a.id==="name"?t.role="rowheader":a.id==="description"?t["aria-label"]="Description":a.id==="access_group"?t["aria-label"]="Access group":a.id==="tags"?t["aria-label"]="Tags":a.id==="computers['non-compliant']"?t["aria-label"]="Not compliant instances":a.id==="computers['pending']"?t["aria-label"]="Pending instances":a.id==="computers['constrained']"?t["aria-label"]="Associated instances":a.id==="actions"&&(t["aria-label"]="Actions"),t},_e="_truncated_c5ban_1",be="_noWrap_c5ban_2",ve="_actions_c5ban_11",Ce="_description_c5ban_15",T={truncated:_e,noWrap:be,actions:ve,description:Ce},ye=({packageProfiles:a})=>{const{search:t}=R(),{setSidePanelContent:r}=N(),{getAccessGroupQuery:u}=Y(),{data:g}=u(),i=(g==null?void 0:g.data.map(({name:n,title:d})=>({label:d,value:n})))??[],p=n=>{r(n.title,e.jsx(de,{profile:n}),"medium")},m=l.useMemo(()=>t?a.filter(n=>n.title.toLowerCase().includes(t.toLowerCase())):a,[a,t]),x=l.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:{original:n}})=>e.jsx(o.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>p(n),children:n.title})},{accessor:"description",className:C(T.truncated,T.description),Header:"Description"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:{access_group:n}}})=>{var d;return((d=i.find(({value:h})=>h===n))==null?void 0:d.label)??n}},{accessor:"tags",className:T.truncated,Header:"Tags",Cell:({row:{original:{tags:n}}})=>n.join(", ")},{accessor:"computers['non-compliant']",Header:e.jsxs("div",{className:T.noWrap,children:[e.jsx("span",{children:"Not compliant "}),e.jsx(o.Tooltip,{position:"btm-left",message:ke,children:e.jsx(o.Icon,{name:"help"})})]}),Cell:({row:{original:n}})=>e.jsx(e.Fragment,{children:`${n.computers["non-compliant"].length} ${n.computers["non-compliant"].length===1?"instance":"instances"}`})},{accessor:"computers['pending']",Header:e.jsxs("div",{className:T.noWrap,children:[e.jsx("span",{children:"Pending "}),e.jsx(o.Tooltip,{position:"btm-left",message:xe,children:e.jsx(o.Icon,{name:"help"})})]}),Cell:({row:{original:n}})=>{var d,h;return e.jsx(e.Fragment,{children:`${((d=n.computers.pending)==null?void 0:d.length)??0} ${((h=n.computers.pending)==null?void 0:h.length)===1?"instance":"instances"}`})}},{accessor:"computers['constrained']",Header:"Associated",Cell:({row:{original:n}})=>e.jsx(e.Fragment,{children:`${n.computers.constrained.length} ${n.computers.constrained.length===1?"instance":"instances"}`})},{accessor:"actions",className:C("u-align-text--right",T.actions),Header:"Actions",Cell:({row:{original:n}})=>e.jsx(Pe,{profile:n})}],[m,i.length]);return e.jsx(o.ModularTable,{columns:x,data:m,emptyMsg:`No package profiles found with the search "${t}"`,getCellProps:je})},Te=()=>{const{setPageParams:a}=R(),t=r=>{a({search:r})};return e.jsx(D,{onSearch:t})},Ne=l.lazy(()=>j(()=>import("./index-D-o1e51J.js").then(a=>a.i),__vite__mapDeps([33,1,2,3,34,35,7,36,27,14,15,12,13,20,24,25,26,28,29,30,31,37]))),Se=()=>{const{setSidePanelContent:a}=N(),t=()=>{a("Add package profile",e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ne,{})}),"medium")};return e.jsx(U,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You havenâ€™t added any package profile yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-packages",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage packages in Landscape"})]}),cta:[e.jsx(o.Button,{appearance:"positive",onClick:t,children:"Add package profile"},"add")],icon:"package-profiles",title:"No package profiles found"})},$e=({packageProfiles:a=[]})=>e.jsxs(e.Fragment,{children:[e.jsx(Te,{}),e.jsx(ye,{packageProfiles:a})]}),Ie=()=>{const{getPackageProfilesQuery:a}=S(),{data:t,isLoading:r}=a();return e.jsxs(e.Fragment,{children:[r&&e.jsx(P,{}),!r&&(!t||t.data.result.length===0)&&e.jsx(Se,{}),!r&&t&&t.data.result.length>0&&e.jsx($e,{packageProfiles:t==null?void 0:t.data.result})]})},Ae=l.lazy(()=>j(()=>import("./index-D-o1e51J.js").then(a=>a.a),__vite__mapDeps([33,1,2,3,34,35,7,36,27,14,15,12,13,20,24,25,26,28,29,30,31,37])).then(a=>({default:a.PackageProfileCreateForm}))),Ee=()=>{const{setSidePanelContent:a}=N(),t=()=>{a("Add package profile",e.jsx(l.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ae,{})}),"medium")};return e.jsxs(z,{children:[e.jsx(M,{title:"Package profiles",actions:[e.jsx(o.Button,{type:"button",appearance:"positive",onClick:t,children:"Add package profile"},"add-package-profile")]}),e.jsx(V,{children:e.jsx(Ie,{})})]})},Fe=Ee,Ue=Object.freeze(Object.defineProperty({__proto__:null,default:Fe},Symbol.toStringTag,{value:"Module"}));export{Z as C,L as E,Ge as I,J as L,ye as P,We as T,Ke as V,X as a,Te as b,Se as c,Ue as i,S as u};
