import{V as w,j as a,g as l,m as q,I as A,r as E,E as T,o as M,n as V}from"./index-aJwsc68L.js";import{T as H}from"./TablePagination-C3r33z9M.js";import{h as d,u as U}from"./usePageParams-CzH8WT2r.js";import{N as u}from"./NoData-CmSHmpHE.js";import{u as Y,K as $}from"./index-CP_2_3Qx.js";import"./TablePaginationBase-whHu4Pzw.js";import"./PageMain-CZ35nLro.js";import"./usePackages-BAul2i7z.js";import"./useFetchOld-DqwB-ncC.js";import"./useInstances-b1TOjDNw.js";import"./helpers-Drtz9_Bn.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="fc7e8521-809e-4355-b67a-a95a74e911db",e._sentryDebugIdIdentifier="sentry-dbid-fc7e8521-809e-4355-b67a-a95a74e911db")}catch{}const R=(e,t)=>{switch(e){case"Fully patched":return"All available kernel security patches have been applied. You have no pending patches";case"Kernel upgrade available":return`A new kernel version is available. The current version is covered by Livepatch until ${d(t).format(w)}`;case"Restart required":return"Low and/or medium patches have been installed. You must restart to complete patching.";case"End of life":return"The kernel is no longer covered by Livepatch. It is not getting high and critical security patches.";case"Livepatch disabled":return"Livepatch is disabled. Kernel patches will not be applied automatically until you enabled Livepatch.";default:return"There was an error getting the status"}},z=e=>{switch(e){case"Patched by Livepatch":case"Fully patched":case"Kernel upgrade available":return"status-succeeded-small";case"Restart required":return"status-waiting-small";case"End of life":return"status-failed-small";default:return"status-failed-small"}},Q=(e,t)=>{const s=d(t),r=d(),c=s.diff(r,"days");return c<0||!e||!d(t).isValid()?"status-failed-small":c<7?"status-waiting-small":"status-succeeded-small"},G=(e,t)=>{if(!e)return"Livepatch is disabled";const s=d(t),r=d();return s.diff(r,"days")<0?"Expired":`Expires on ${d(t).format(w)}`},J="_statusIcon_s1xwo_1",W="_tooltipIcon_s1xwo_5",X="_container_s1xwo_9",p={statusIcon:J,tooltipIcon:W,container:X},Z=({kernelOverview:e})=>{const t=e.status!=="Livepatch disabled",s=[{label:"current kernel version",value:e.currentVersion||a.jsx(u,{})},{label:"kernel status",value:a.jsxs(a.Fragment,{children:[a.jsx("span",{children:t?e.status||a.jsx(u,{}):"Not covered by Livepatch"}),a.jsxs(l.Tooltip,{message:R(e.status,e.expirationDate),className:p.tooltipIcon,children:[a.jsx(l.Icon,{name:"help","aria-hidden":!0}),a.jsx("span",{className:"u-off-screen",children:"Help"})]})]})},{label:"livepatch coverage",value:e.expirationDate?G(t,e.expirationDate):a.jsx(u,{})}];return a.jsx(l.Row,{className:q("u-no-padding--left u-no-padding--right u-no-max-width",p.container),children:s.map(({label:r,value:c})=>a.jsxs(l.Col,{size:3,children:[r==="status"&&a.jsx(l.Icon,{name:z(e.status),"aria-hidden":!0,className:p.statusIcon}),r==="livepatch coverage"&&e.expirationDate&&a.jsx(l.Icon,{name:Q(t,e.expirationDate),"aria-hidden":!0,className:p.statusIcon}),a.jsx(A,{label:r,value:c})]},r))})},k=`There are no pending kernel security patches to apply at this time.
                Livepatch applies critical and high security patches in the background without requiring a system restart.
                Patches found since last restart and their status will be shown here.`,O=e=>`https://cve.mitre.org/cgi-bin/cvename.cgi?name=${e}`,ee=e=>{const t={};switch(e.column.id){case"Name":t.role="rowheader";break;case"Patched":t["aria-label"]="Status";break;case"Description":t["aria-label"]="Description";break;case"Bug":t["aria-label"]="Bug";break}return t},ae="_description_1s9gq_1",te={description:ae},se=({kernelData:e})=>{const t=E.useMemo(()=>[{Header:a.jsx("span",{children:"CVE"}),accessor:"Name",Cell:({row:s})=>a.jsx(l.Link,{href:O(s.original.Name),target:"_blank",rel:"nofollow noopener noreferrer",className:"u-no-margin--bottom u-no-padding--top",children:s.original.Name})},{Header:"Status",accessor:"Patched",Cell:({row:{original:s}})=>s.Patched?"Patched by Livepatch":"Unpatched",getCellIcon:({row:{original:s}})=>s.Patched?"status-succeeded-small":"status-failed-small",disableSortBy:!0},{Header:"Description",accessor:"Description",className:te.description,Cell:({row:s})=>s.original.Description||a.jsx(u,{}),disableSortBy:!0},{Header:"Bug",accessor:"Bug",Cell:({row:s})=>s.original.Bug||a.jsx(u,{}),disableSortBy:!0}],[]);return a.jsxs(a.Fragment,{children:[a.jsx("h3",{className:"p-heading--5 u-no-padding u-no-margin",children:"Patches discovered since last restart"}),e.length===0?a.jsx(T,{title:"No outstanding kernel patches",body:k}):a.jsx(l.ModularTable,{columns:t,data:e,getCellProps:ee,sortable:!0,initialSortColumn:"Name",initialSortDirection:"ascending"})]})},ge=({instanceTitle:e})=>{var x,f,y,j,v,D,_,I,N,L;const{instanceId:t,childInstanceId:s}=M(),{pageSize:r,currentPage:c}=U(),{getKernelQuery:C,getLivepatchInfoQuery:K}=Y(),b=Number(s??t),{data:n,isPending:h}=C({id:b}),{data:o}=K({id:b}),i=(y=(f=(x=o==null?void 0:o.data.livepatch_info)==null?void 0:x.json)==null?void 0:f.output)!=null&&y.Status&&((D=(v=(j=o==null?void 0:o.data.livepatch_info)==null?void 0:j.json)==null?void 0:v.output)==null?void 0:D.Status.length)>0?(N=(I=(_=o==null?void 0:o.data.livepatch_info)==null?void 0:_.json)==null?void 0:I.output)==null?void 0:N.Status[0]:void 0,m=(i==null?void 0:i.Livepatch.Fixes)??[],F=(B,P)=>m.slice(P,P+B),g=E.useMemo(()=>F(r,(c-1)*r),[m,c,r]),S={currentVersion:(i==null?void 0:i.Kernel)??((L=n==null?void 0:n.data.installed)==null?void 0:L.version_rounded)??"",expirationDate:i!=null&&i.UpgradeRequiredDate&&d(i==null?void 0:i.UpgradeRequiredDate).isValid()?i.UpgradeRequiredDate:"",status:(n==null?void 0:n.data.smart_status)??""};return a.jsxs(a.Fragment,{children:[h&&a.jsx(V,{}),!h&&!(n!=null&&n.data.installed)&&a.jsx(T,{title:"Kernel Information Unavailable",body:(n==null?void 0:n.data.message)||"No kernel information available"}),!h&&(n==null?void 0:n.data.installed)&&a.jsxs(a.Fragment,{children:[a.jsx($,{instanceName:e,hasTableData:g.length>0,kernelStatuses:n.data}),a.jsx(Z,{kernelOverview:S}),a.jsx(se,{kernelData:g}),a.jsx(H,{totalItems:m.length,currentItemCount:g.length})]})]})};export{ge as default};
