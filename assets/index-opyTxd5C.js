const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-i6nHoegU.js","assets/index-Df00U5mw.js","assets/index-DEuNBe7s.css","assets/moment-C5S46NFB.js","assets/InfoItem-DaD1p_MG.js","assets/InfoItem-C-lWh_lY.css","assets/useInstances-DIV4kfrU.js","assets/useFetchOld-CstMzdlw.js","assets/moment-BvtLxrnz.js","assets/TablePagination-BGXmDGH_.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-DCAnICix.js","assets/NoData-CHU5SeIQ.js","assets/index-4jXkfcLF.css"])))=>i.map(i=>d[i]);
import{j as e,E as U,d as c,c as F,r as l,_ as $,h as z,e as Y,i as Q,f as C,g as B,o as T,K as G,q as J,D as X}from"./index-Df00U5mw.js";import{m as Z}from"./moment-BvtLxrnz.js";import{T as ee}from"./TablePagination-BGXmDGH_.js";import{u as te}from"./useFetchOld-CstMzdlw.js";import{u as q}from"./usePageParams-DCAnICix.js";import{N as ie}from"./NoData-CHU5SeIQ.js";const ne=()=>e.jsx(U,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no activities yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage computers in Landscape"})]}),icon:"switcher-environments",title:"No activities found"}),ae="_wrapper_1avtj_1",oe="_search_1avtj_9",se="_buttonContainer_1avtj_13",ce="_button_1avtj_13",re="_icon_1avtj_43",j={wrapper:ae,search:oe,buttonContainer:se,button:ce,icon:re},le=({inputValue:a,onDescriptionClick:t,onInputChange:s,onSearchClick:h,onClear:o})=>e.jsxs("div",{className:j.wrapper,children:[e.jsx(c.SearchBox,{autocomplete:"off",shouldRefocusAfterReset:!0,externallyControlled:!0,value:a,onChange:s,onSearch:h,onClear:o,className:F("u-no-margin--bottom",j.search)}),e.jsx("div",{className:j.buttonContainer,children:e.jsx(c.Button,{type:"button",onClick:t,className:j.button,children:e.jsx(c.Icon,{name:c.ICONS.help,className:j.icon})})})]}),ue="_term_1p61y_1",de={term:ue},me=({open:a,onClose:t,data:s})=>{const h=[{Header:"Term",accessor:"term",className:de.term,Cell:({value:o})=>typeof o=="string"?e.jsx("code",{children:o}):null},{Header:"Description",accessor:"description",Cell:({value:o})=>typeof o=="string"||l.isValidElement(o)?e.jsx("span",{className:"u-text--muted",children:o}):null}];return a&&e.jsxs(c.Modal,{title:"Search help",close:t,children:[e.jsx("p",{children:"Available search terms for use in the search box. If multiple search terms are separated by OR, any of the conditions will match. Otherwise, all conditions must be met for a instance to match. When a term is preceded by NOT, the condition must not match. If the searched value contains spaces or non-ASCII characters, it must be quoted."}),e.jsx(c.ModularTable,{className:"u-no-margin--bottom",columns:l.useMemo(()=>h,[]),data:l.useMemo(()=>s,[])})]})},pe=l.lazy(()=>$(()=>import("./index-i6nHoegU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])));function O(){const a=te(),t=z(),s=Y(),{setSidePanelContent:h}=Q(),o=(i={},u={})=>B({queryKey:["activities",i],queryFn:()=>t.get("activities",{params:i}),...u}),m=({activityId:i,...u},p={})=>B({queryKey:["activities",{activityId:i,...u}],queryFn:()=>t.get(`activities/${i}`,{params:u}),...p}),v=(i={},u={})=>B({queryKey:["activityTypes"],queryFn:()=>a.get("GetActivityTypes",{params:i}),...u}),f=C({mutationKey:["activities","cancel"],mutationFn:i=>a.get("CancelActivities",{params:i}),onSuccess:()=>s.invalidateQueries({queryKey:["activities"]})}),b=C({mutationKey:["activities","approve"],mutationFn:i=>a.get("ApproveActivities",{params:i}),onSuccess:()=>s.invalidateQueries({queryKey:["activities"]})}),g=C({mutationFn:i=>t.post("activities/reapply",i),onSuccess:()=>s.invalidateQueries({queryKey:["activities"]})}),y=C({mutationFn:i=>t.post("activities/revert",i),onSuccess:()=>s.invalidateQueries({queryKey:["activities"]})});return{getActivitiesQuery:o,getSingleActivityQuery:m,getActivityTypesQuery:v,cancelActivitiesQuery:f,approveActivitiesQuery:b,redoActivitiesQuery:g,undoActivitiesQuery:y,openActivityDetails:i=>{h(i.summary,e.jsx(l.Suspense,{fallback:e.jsx(T,{}),children:e.jsx(pe,{activityId:i.id})}))}}}function he(a){const{state:t}=G(),s=t==null?void 0:t.activity;l.useEffect(()=>{t!=null&&t.activity&&(a(t.activity),window.history.replaceState({},""))},[s])}const ve="_container_honpf_1",ge="_searchContainer_honpf_8",ye="_select_honpf_12",fe="_cta_honpf_17",S={container:ve,searchContainer:ge,select:ye,cta:fe},be="_iconError_xphpu_1",_e="_iconWarning_xphpu_5",xe="_iconWarningRed_xphpu_9",E={iconError:be,iconWarning:_e,iconWarningRed:xe},P={succeeded:{icon:"success",label:"Succeeded"},scheduled:{icon:"spinner",label:"Scheduled"},waiting:{icon:"status-waiting",label:"Waiting"},undelivered:{icon:"status-queued",label:"Queued"},delivered:{icon:"status-in-progress",label:"In progress"},blocked:{icon:`warning-grey ${E.iconWarningRed}`,label:"Blocked"},unapproved:{icon:`warning-grey ${E.iconWarning}`,label:"Unapproved"},canceled:{icon:"error-grey",label:"Cancelled"},failed:{icon:`error-grey ${E.iconError}`,label:"Failed"}},Ae=[{term:"id:<activity_id>",description:"Search for activities with a specific ID."},{term:"parent-id:<parent_id>",description:"Search for children activities of a specific ID."},{term:"created-after:<date>",description:e.jsxs("span",{children:["Search for activities created after a specific date or time, specified with the ISO-8601 format. The precision depends on how far you specify, for example ",e.jsx("code",{children:"2011-01"}),", ",e.jsx("code",{children:"2011-01-01"}),","," ",e.jsx("code",{children:"2011-01-01T10:30"})," are valid values."]})},{term:"created-before:<date>",description:"Search for activities created before a specific date or time. The format is the same as created-after."},{term:"creator:<email>",description:"Search for activities created by a particular person (specified by email address)."},{term:"computer:<criteria>",description:"Search for activities related to the given instances. The criteria is itself another query argument to search instances. See Instance Queries for details."},{term:"type:<type>",description:"Search for activities of a specific type."}],je=[{label:"All",value:""},...Object.entries(P).filter(([a])=>a!=="unapproved").map(([a,{label:t}])=>({label:t,value:a}))],Ce=({resetSelectedIds:a,selectedIds:t})=>{const{search:s,status:h,setPageParams:o}=q(),m=J(),{approveActivitiesQuery:v,cancelActivitiesQuery:f,redoActivitiesQuery:b,undoActivitiesQuery:g}=O(),[y,_]=l.useState(s),[i,u]=l.useState(!1),{mutateAsync:p,isPending:x}=v,{mutateAsync:N,isPending:A}=f,{mutateAsync:n,isPending:d}=b,{mutateAsync:w,isPending:D}=g,L=()=>{o({search:y,status:h}),a()},R=r=>{o({status:r})},M=()=>{o({search:""})},I=r=>{r.preventDefault(),L()},H=async()=>{try{await p({query:`id:${t.join(" OR id:")}`})}catch(r){m(r)}},W=async()=>{try{await N({query:`id:${t.join(" OR id:")}`})}catch(r){m(r)}},K=async()=>{try{await n({activity_ids:t})}catch(r){m(r)}},V=async()=>{try{await w({activity_ids:t})}catch(r){m(r)}};return e.jsxs("div",{className:S.container,children:[e.jsxs("div",{className:S.searchContainer,children:[e.jsx(c.Form,{onSubmit:I,noValidate:!0,children:e.jsx(le,{inputValue:y,onInputChange:r=>{_(r)},onSearchClick:L,onDescriptionClick:()=>u(!0),onClear:M})}),e.jsx(me,{open:i,onClose:()=>{u(!1)},data:Ae})]}),e.jsx(c.Select,{label:"Status",labelClassName:"u-no-margin--bottom",wrapperClassName:S.select,className:"u-no-margin--bottom",options:je,onChange:r=>R(r.target.value),value:h}),e.jsx("div",{className:F("p-segmented-control",S.cta),children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",disabled:t.length===0||x,confirmationModalProps:{title:`Approve ${t.length===1?"activity":"activities"}`,children:e.jsxs("p",{children:["Are you sure you want to approve selected"," ",t.length===1?"activity":"activities","?"]}),confirmButtonLabel:"Approve",confirmButtonAppearance:"positive",confirmButtonDisabled:x,confirmButtonLoading:x,onConfirm:H},children:"Approve"}),e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",disabled:t.length===0||A,confirmationModalProps:{title:`Cancel ${t.length===1?"activity":"activities"}`,children:e.jsxs("p",{children:["Are you sure you want to cancel selected"," ",t.length===1?"activity":"activities","?"]}),confirmButtonLabel:"Apply",confirmButtonAppearance:"positive",confirmButtonDisabled:A,confirmButtonLoading:A,onConfirm:W},children:"Cancel"}),e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",disabled:t.length===0||D,confirmationModalProps:{title:`Undo ${t.length===1?"activity":"activities"}`,children:e.jsxs("p",{children:["Are you sure you want to undo selected"," ",t.length===1?"activity":"activities","?"]}),confirmButtonLabel:"Undo",confirmButtonAppearance:"positive",confirmButtonDisabled:D,confirmButtonLoading:D,onConfirm:V},children:"Undo"}),e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",disabled:t.length===0||d,confirmationModalProps:{title:`Redo ${t.length===1?"activity":"activities"}`,children:e.jsxs("p",{children:["Are you sure you want to redo selected"," ",t.length===1?"activity":"activities","?"]}),confirmButtonLabel:"Redo",confirmButtonAppearance:"positive",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:K},children:"Redo"})]})},"buttons")]})},Se="_checkbox_15zhq_1",Te="_description_15zhq_5",k={checkbox:Se,description:Te},Ne=l.lazy(()=>$(()=>import("./index-i6nHoegU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),ke=({instanceId:a})=>{const[t,s]=l.useState([]),{search:h,status:o,currentPage:m,pageSize:v}=q(),{setSidePanelContent:f}=Q(),{getActivitiesQuery:b}=O(),g=`${h}${o?` status:${o}`:""}`,y=n=>{f(n.summary,e.jsx(l.Suspense,{fallback:e.jsx(T,{}),children:e.jsx(Ne,{activityId:n.id})}))};he(y);const _=()=>{s([])},{data:i,isLoading:u}=b({query:`${a?`computer:id:${a}`:""} ${g??""}`.trim(),limit:v,offset:(m-1)*v}),p=l.useMemo(()=>(i==null?void 0:i.data.results)??[],[i]),x=()=>{s(n=>n.length?[]:p.map(({id:d})=>d))},N=n=>{s(d=>d.includes(n)?d.filter(w=>w!==n):[...d,n])},A=l.useMemo(()=>[{accessor:"checkbox",className:k.checkbox,Header:e.jsx(c.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:x,checked:p.length>0&&t.length===p.length,indeterminate:t.length>0&&t.length<p.length}),Cell:({row:n})=>e.jsx(c.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:n.original.summary}),inline:!0,labelClassName:"u-no-margin--bottom u-no-padding--top",checked:t.includes(n.original.id),onChange:()=>{N(n.original.id)}})},{accessor:"summary",className:k.description,Header:"Description",Cell:({row:n})=>e.jsx(c.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>y(n.original),children:n.original.summary})},{accessor:"activity_status",Header:"Status",Cell:({row:{original:{activity_status:n}}})=>P[n].label,getCellIcon:({row:{original:{activity_status:n}}})=>P[n].icon},{accessor:"creation_time",Header:"Created at",Cell:({row:n})=>e.jsx(e.Fragment,{children:Z(n.original.creation_time).format(X)})},{accessor:"creator.name",Header:"Creator",Cell:({row:n})=>{var d;return e.jsx(e.Fragment,{children:((d=n.original.creator)==null?void 0:d.name)??e.jsx(ie,{})})}}],[p,t]);return e.jsxs(e.Fragment,{children:[!g&&m===1&&v===50&&u&&e.jsx(T,{}),!g&&m===1&&v===50&&!u&&(!i||!i.data.count)&&e.jsx(ne,{}),(!!g||m!==1||v!==50||!u&&i&&i.data.count>0)&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{resetSelectedIds:_,selectedIds:t}),e.jsx(c.ModularTable,{emptyMsg:`No activities found with the search ${g}`,columns:A,data:p}),e.jsx(ee,{totalItems:i==null?void 0:i.data.count,currentItemCount:p.length,handleClearSelection:_})]})]})},we=l.lazy(()=>$(()=>import("./index-i6nHoegU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),Fe=a=>e.jsx(l.Suspense,{fallback:e.jsx(T,{}),children:e.jsx(we,{...a})});export{ke as A,me as S,P as a,Fe as b,O as u};
