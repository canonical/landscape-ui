import{m as F,t as P,v as U,r as L,z as q,B as D,y as N,P as R,aj as Q,C as V,H as $,o as E,j as t,d as r,F as I,x as s}from"./index-BniO5lih.js";import{S as M}from"./SidePanelFormButtons-bG-J2X_B.js";import{u as _}from"./useGetInstances-CYwqcOV3.js";function O(){const d=F(),e=P(),h=U({mutationKey:["token","attach"],mutationFn:async c=>d.post("attach-token",c),onSuccess:async()=>e.invalidateQueries({queryKey:["instances"]})}),{mutateAsync:m,isPending:n}=h;return{attachToken:m,isAttachingToken:n}}const G=({children:d,selectedInstances:e,submitButtonText:h,notification:m})=>{const[n,c]=L.useState([]),k=q(),{notify:b}=D(),{closeSidePanel:y}=N(),{openActivityDetails:j}=R(),{attachToken:v,isAttachingToken:f}=O(),T=`${e.map(i=>`id:${i.id}`).join(" OR ")} has-pro-management:false`,{refetchInstances:C}=_({query:T,limit:e.length},{listenToUrlParams:!1},{enabled:!1}),x=async i=>{if(e.length===0){b.info({title:"No instances to attach",message:"No valid instances were selected for token attachment."});return}try{const{data:{activity:o}}=await v({computer_ids:e.map(({id:u})=>u),token:i});y(),b.success({...m,actions:[{label:"View details",onClick:()=>{j(o)}}]})}catch(o){k(o)}},w=async i=>{try{const{data:o}=await C(),u=o?.data?.results??[];c(u.map(S=>S.id)),u.length===0&&await x(i.token)}catch(o){k(o)}},A=e.filter(i=>!n.includes(i.id)),{withToken:l,withoutToken:g}=Q(A),a=V({initialValues:{token:""},validationSchema:$({token:E().required("Token is required")}),onSubmit:w}),B=async()=>{await x(a.values.token)},p=()=>{c([])};return t.jsxs(t.Fragment,{children:[t.jsxs(r.Form,{noValidate:!0,onSubmit:a.handleSubmit,children:[t.jsxs("div",{children:[d,t.jsx(r.Input,{label:"Token",type:"text",placeholder:"Your token",required:!0,...a.getFieldProps("token"),error:I(a,"token")})]}),t.jsx(M,{submitButtonText:h,submitButtonDisabled:!a.isValid||!a.dirty,submitButtonLoading:a.isSubmitting||f,onCancel:y})]}),!!n.length&&(n.length===e.length?t.jsx(r.Modal,{title:`Token attachment unavailable for the selected ${s(e.length,"instance","instances")}`,close:p,buttonRow:t.jsx(r.Button,{type:"button",className:"u-no-margin--bottom",onClick:p,children:"Close"}),children:t.jsxs("p",{children:["Your Ubuntu Pro token can't be attached to the selected"," ",s(e.length,"instance")," because"," ",s(e.length,"it doesn't","they don't")," ","support this feature. This could be because the Landscape Client is out of date."]})}):t.jsxs(r.ConfirmationModal,{title:"Attach Ubuntu Pro token",confirmButtonLabel:"Confirm",confirmButtonAppearance:"positive",confirmButtonLoading:f,onConfirm:B,close:p,children:[t.jsx("p",{className:"u-no-margin--bottom",children:"Confirming this action means:"}),t.jsxs("ul",{children:[g>0&&t.jsxs("li",{children:[t.jsx("strong",{children:g})," ",s(g,"instance")," will be attached to this token"]}),l>0&&t.jsxs("li",{children:[t.jsx("strong",{children:l})," ",s(l,"instance")," will override"," ",s(l,"its","their")," existing token"]}),t.jsxs("li",{children:[t.jsx("strong",{children:n.length})," ",s(n.length,"instance")," will be skipped as"," ",s(n.length,"it does","they do")," not support Ubuntu Pro management"]})]})]}))]})},J="https://ubuntu.com/pro/dashboard";export{G as T,J as U};
