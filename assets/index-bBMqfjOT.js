import{o as b,j as e,e as i,s as A,t as k,n as _,v as $,ag as f,w as T,d as ae,m as se,ba as ne,J as y,K as z,a as O,D as w,a2 as oe,I as S}from"./index-CmmfIHlE.js";import{A as Q}from"./AssociationBlock-B74y9iIC.js";import{S as H}from"./SidePanelFormButtons-DmuqWUSv.js";import{u as W}from"./useRoles-Csuu2CdA.js";import{T as re,C as q,a as D,E as U,u as N,V as ie,I as le,b as ce,L as Y,c as ue,d as de,P as pe,e as ge,f as me,g as he}from"./index-C9SjX_e0.js";import{h as Et,i as Rt,j as Dt}from"./index-C9SjX_e0.js";import{F as Pe}from"./FileInput-B74s4_B1.js";import{u as Ce}from"./useGetInstances-eoVUQy6E.js";import{H as K}from"./HeaderWithSearch-CXndOB4F.js";import{S as J}from"./SidePanelTablePagination-ByPcywwl.js";import{T as be}from"./TextConfirmationModal-DDnptHCt.js";import"./MultiSelectField-C_l77q69.js";import"./useGetTags-CChW5X3w.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./PageMain-Cm2imCsJ.js";import"./constants-B3UTGQVM.js";import"./constants-B3lPHYdf.js";import"./table-CdFwMAPu.js";const L=({onChange:t,value:a,...s})=>{const[n,u]=b.useState(a);return e.jsx(i.Input,{type:"text",autoComplete:"off",...s,value:n,onChange:l=>{u(l.target.value)},onBlur:()=>t(n)})},fe="_action_w93bw_1",xe="_cell_w93bw_7",je="_input_w93bw_18",ye="_inputWrapper_w93bw_26",j={action:fe,cell:xe,input:je,inputWrapper:ye},ve=async(t,a,s,n)=>{await t.setFieldValue(`constraints[${a}]${[s]}`,n),await t.setFieldTouched(`constraints[${a}]${[s]}`,!0),["rule","version"].includes(s)&&(n!==""?await t.setFieldValue(`constraints[${a}].notAnyVersion`,!0):t.values.constraints[a][s==="rule"?"version":"rule"]===""&&await t.setFieldValue(`constraints[${a}].notAnyVersion`,!1))},Se=(t,a,s)=>{if(!t.errors.constraints?.[a]||!t.touched.constraints?.[a]?.[s])return;const n=t.errors.constraints[a];return typeof n!="string"?n[s]:void 0},_e=async(t,a)=>{await t.setFieldValue("constraints",t.values.constraints.filter((s,n)=>n!==a)),t.touched.constraints&&(t.touched.constraints.splice(a,1),await t.setTouched({...t.touched,constraints:t.touched.constraints}))},Ne=t=>({handleConstraintPropChange:async(a,s,n)=>{await ve(t,a,s,n)},handleConstraintRowDelete:async a=>{await _e(t,a)},getConstraintsErrorByIndex:(a,s)=>Se(t,a,s)}),Fe=({column:t})=>{const a={};return a.className=j.cell,t.id==="package_name"?a.role="rowheader":t.id==="action"?a["aria-label"]="Action":t.id==="constraint"?a["aria-label"]="Constraint":t.id==="version"?a["aria-label"]="Version":t.id==="rule"&&(a["aria-label"]="Rule"),a},Z=({formik:t})=>{b.useEffect(()=>{t.submitCount!==0&&(async()=>await t.setTouched({...t.touched,constraints:new Array(t.values.constraints.length).fill(re)}))()},[t.submitCount]);const a=b.useMemo(()=>t.values.constraints,[t.values.constraints]),{handleConstraintPropChange:s,handleConstraintRowDelete:n,getConstraintsErrorByIndex:u}=Ne(t),l=b.useMemo(()=>[{accessor:"constraint",Header:"Constraint",Cell:({row:{index:c}})=>e.jsx(i.Select,{label:"Constraint",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,options:q,...t.getFieldProps(`constraints[${c}].constraint`),onChange:o=>s(c,"constraint",o.target.value),error:u(c,"constraint")})},{accessor:"package",Header:"Package",Cell:({row:{index:c}})=>e.jsx(L,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,...t.getFieldProps(`constraints[${c}].package`),onChange:o=>s(c,"package",o),error:u(c,"package")})},{accessor:"rule",Header:"Rule",Cell:({row:{index:c}})=>e.jsx(i.Select,{label:"Rule",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,...t.getFieldProps(`constraints[${c}].rule`),options:D,onChange:o=>s(c,"rule",o.target.value),error:u(c,"rule")})},{accessor:"version",Header:"Version",Cell:({row:{index:c}})=>e.jsx(L,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:j.input,wrapperClassName:j.inputWrapper,...t.getFieldProps(`constraints[${c}].version`),onChange:o=>s(c,"version",o),error:u(c,"version")})},{accessor:"action",className:j.action,Cell:({row:c})=>e.jsx(i.Button,{type:"button",hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding","aria-label":"Delete constraint row",onClick:()=>n(c.index),children:e.jsx(i.Icon,{name:i.ICONS.delete,className:"u-no-margin--left u-no-margin--right"})})}],[a,t.errors.constraints,t.touched.constraints]),m=async()=>{if(await t.setFieldValue("constraints",[U,...t.values.constraints]),t.touched.constraints){const c=[];for(let o=t.values.constraints.length;o>0;o--)t.touched.constraints[o-1]&&(c[o]=t.touched.constraints[o-1]);await t.setTouched({constraints:c})}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"u-align-text--right",children:e.jsxs(i.Button,{type:"button",hasIcon:!0,onClick:m,children:[e.jsx(i.Icon,{name:i.ICONS.plus,className:"u-no-margin--left"}),e.jsx("span",{children:"Add new constraint"})]})}),e.jsx(i.ModularTable,{columns:l,data:a,getCellProps:Fe,emptyMsg:"No constraints added yet.",className:"u-no-margin--bottom"}),t.touched.constraints&&typeof t.errors.constraints=="string"&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:"p-form-validation__message u-no-margin--top",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:t.errors.constraints})]})})]})},Te=[{label:"Select constraints type",value:""},{label:"From an instance's packages",value:"instance"},{label:"From a CSV file",value:"material"},{label:"Enter manually",value:"manual"}],Ae="_container_vi1gw_1",ke={container:Ae},we=({formik:t})=>{const{instances:a}=Ce(),s=a.map(({id:l,title:m})=>({label:m,value:`${l}`}))??[];s.unshift({label:"Select instance",value:""});const n=async l=>{await t.setFieldValue("csvFile",l[0]);const m=await l[0].text();await t.setFieldValue("material",m)},u=async()=>{await t.setFieldValue("csvFile",null),await t.setFieldValue("material",""),await t.setFieldValue("isCsvFileParsed",!1)};return e.jsxs("div",{className:ke.container,children:[e.jsx(i.Select,{label:"Package constraints",required:!0,options:Te,...t.getFieldProps("constraintsType"),error:t.touched.constraintsType&&t.errors.constraintsType?t.errors.constraintsType:void 0}),t.values.constraintsType==="instance"&&e.jsx(i.Select,{label:"Instance",required:t.values.constraintsType==="instance",options:s,...t.getFieldProps("source_computer_id"),error:t.touched.source_computer_id&&t.errors.source_computer_id?t.errors.source_computer_id:void 0}),t.values.constraintsType==="material"&&e.jsx(Pe,{label:"Upload constraints",accept:".csv",...t.getFieldProps("csvFile"),onFileRemove:u,onFileUpload:n,help:'File should be formatted as either a package profile CSV file or the output of running "dpkg --get-selections" on a computer with desired packages installed.',error:t.touched.csvFile&&t.errors.csvFile||t.touched.material&&t.errors.material||void 0}),t.values.constraintsType==="manual"&&e.jsx(Z,{formik:t})]})},Tt=()=>{const t=A(),{notify:a}=k(),{setPageParams:s}=_(),{getAccessGroupQuery:n}=W(),{createPackageProfileQuery:u}=N(),{data:l,isPending:m}=n(),c=l?.data.map(({name:g,title:h})=>({label:h,value:g}))??[],{mutateAsync:o}=u,p=()=>{s({sidePath:[],profile:""})},d=$({initialValues:le,onSubmit:async g=>{const h={access_group:g.access_group,description:g.description,title:g.title};g.all_computers?h.all_computers=!0:g.tags.length>0&&(h.tags=g.tags),g.constraintsType==="material"?h.material=g.material:g.constraintsType==="instance"?h.source_computer_id=g.source_computer_id:h.constraints=g.constraints.map(({constraint:r,package:C,rule:F,version:I})=>({constraint:r,package:C,rule:F,version:I}));try{await o(h),p(),a.success({message:`Profile "${g.title}" added successfully`,title:"Profile added"})}catch(r){t(r)}},validationSchema:ie,validateOnMount:!0});return m?e.jsx(f.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsx(f.Header,{children:"Add package profile"}),e.jsx(f.Content,{children:e.jsxs(i.Form,{onSubmit:d.handleSubmit,noValidate:!0,children:[e.jsx(i.Input,{type:"text",label:"Title",required:!0,...d.getFieldProps("title"),error:T(d,"title")}),e.jsx(i.Input,{type:"text",label:"Description",required:!0,autoComplete:"off",...d.getFieldProps("description"),error:T(d,"description")}),e.jsx(i.Select,{label:"Access group",...d.getFieldProps("access_group"),options:c,error:T(d,"access_group")}),e.jsx(Q,{formik:d}),e.jsx(we,{formik:d}),e.jsx(H,{submitButtonDisabled:!d.isValid,submitButtonLoading:d.isSubmitting,submitButtonText:"Add package profile",onCancel:p})]})})]})},Ie=t=>{const a=ae(),{data:s,isPending:n,error:u}=se({queryKey:["packageProfile",t],queryFn:async({signal:m})=>a.get("packageprofiles",{params:{names:[t]},signal:m})}),l=s?.data.result[0];return{packageProfile:l,packageProfileError:s&&!l?new Error("The package profile could not be found."):u,isGettingPackageProfile:n}},B=()=>{const{profile:t}=_(),{packageProfile:a,isGettingPackageProfile:s,packageProfileError:n}=Ie(t);if(n)throw n;return s?{packageProfile:void 0,isGettingPackageProfile:!0}:{packageProfile:a,isGettingPackageProfile:!1}},$e=({profile:t})=>{const a=b.useContext(ne),s=A(),{notify:n}=k(),{sidePath:u,popSidePath:l}=_(),{addPackageProfileConstraintsQuery:m}=N(),{mutateAsync:c}=m,p=$({initialValues:{constraints:[U]},onSubmit:async({constraints:P})=>{try{await c({name:t.name,constraints:P.map(({constraint:d,package:g,rule:h,version:r})=>({constraint:d,package:g,rule:h,version:r}))}),l(),n.success({message:`${P.length} package profile ${y(P.length,"constraint")}  added successfully`,title:"Package profile constraints added"})}catch(d){s(d)}},validationSchema:ce,validateOnMount:!0});return e.jsxs(i.Form,{onSubmit:p.handleSubmit,noValidate:!0,children:[e.jsx(Z,{formik:p}),e.jsx(H,{submitButtonDisabled:!p.isValid||p.isValidating,submitButtonLoading:p.isSubmitting,submitButtonText:`Add ${y(p.values.constraints.length,"constraint")}`,submitButtonAriaLabel:`Add ${y(p.values.constraints.length,"constraint")} to "${t.title}" profile`,cancelButtonDisabled:p.isSubmitting,hasBackButton:u.length>1,onBackButtonPress:l,onCancel:a})]})},At=()=>{const{packageProfile:t,isGettingPackageProfile:a}=B();return a?e.jsx(f.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(f.Header,{children:['Add package constraints to "',t.title,'" profile']}),e.jsx(f.Content,{children:e.jsx($e,{profile:t})})]})},Be=[{label:"All",value:""},{label:"Conflicts",value:"conflicts"},{label:"Depends",value:"depends"}],Ve="_container_scrq4_1",Ee={container:Ve},Re=({filter:t,formik:a,onFilterChange:s,profile:n,selectedIds:u,setSelectedIds:l})=>{const m=A(),{notify:c}=k(),{pushSidePath:o}=_(),{removePackageProfileConstraintsQuery:p}=N(),{mutateAsync:P,isPending:d}=p,g=async()=>{try{await P({constraint_ids:u,name:n.name}),l([]),c.success({message:`${u.length} "${n.title}" profile's ${y(u.length,"constraint")} removed successfully`,title:`Package profile ${y(u.length,"constraint")} removed`})}catch(r){m(r)}},h=()=>{o("add-constraints")};return e.jsxs("div",{className:Ee.container,children:[e.jsx(i.Select,{label:"Constraint type",className:"u-no-margin--bottom",labelClassName:"u-no-padding--top",options:Be,value:t,onChange:r=>{s(r.target.value)}}),e.jsxs(i.ConfirmationButton,{className:"has-icon u-no-margin--right u-no-margin--bottom",type:"button",disabled:u.length===0||a.values.id!==0,"aria-label":`Remove selected ${y(u.length,"constraint")}`,confirmationModalProps:{title:`Remove ${y(u.length,"constraint")}`,children:e.jsxs("p",{children:["This will remove ",u.length," ",y(u.length,"constraint"),"."]}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:g},children:[e.jsx(i.Icon,{name:i.ICONS.delete}),e.jsx("span",{children:"Remove"})]}),e.jsxs(i.Button,{className:"u-no-margin--bottom",type:"button",hasIcon:!0,onClick:h,"aria-label":"Add new constraint",children:[e.jsx(i.Icon,{name:i.ICONS.plus}),e.jsx("span",{children:"Add constraints"})]})]})},De="_actionButton_15xpu_1",Le="_tooltip_15xpu_5",R={actionButton:De,tooltip:Le},Oe=({constraint:t,formik:a})=>a.values.id===t.id?e.jsxs(e.Fragment,{children:[e.jsx(i.Button,{type:"button",appearance:"base",hasIcon:!0,className:z("u-no-margin--bottom u-no-padding",R.actionButton),onClick:()=>{a.handleSubmit()},"aria-label":`Save changes to ${t.package} constraint`,children:e.jsx(i.Tooltip,{tooltipClassName:R.tooltip,message:"Save changes",children:e.jsx(i.Icon,{name:"success-grey",className:"u-no-margin--left u-no-margin--right"})})}),e.jsx(i.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>{a.resetForm()},"aria-label":`Cancel editing ${t.package} constraint`,children:e.jsx(i.Tooltip,{tooltipClassName:R.tooltip,message:"Cancel",children:e.jsx(i.Icon,{name:"error-grey",className:"u-no-margin--left u-no-margin--right"})})})]}):e.jsx(i.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>a.setValues(t),disabled:a.values.id!==0,"aria-label":`Edit ${t.package} constraint`,children:e.jsx(i.Tooltip,{tooltipClassName:R.tooltip,message:"Edit constraint",children:e.jsx(i.Icon,{name:"edit",className:"u-no-margin--left u-no-margin--right"})})}),He="_actionsCell_1kvjf_1",Ge="_noPadding_1kvjf_7",Me="_cell_1kvjf_11",Qe="_input_1kvjf_23",We="_inputWrapper_1kvjf_31",qe="_hidden_1kvjf_37",x={actionsCell:He,noPadding:Ge,cell:Me,input:Qe,inputWrapper:We,hidden:qe},ze=async(t,a,s)=>{await t.setFieldValue(`${a}`,s),await t.setFieldTouched(`${a}`,!0),["rule","version"].includes(`${a}`)&&(s!==""?await t.setFieldValue("notAnyVersion",!0):t.values[a==="rule"?"version":"rule"]===""&&await t.setFieldValue("notAnyVersion",!1))},Ue=(t,a)=>{if(!(!t.touched[a]||!t.errors[a]))return t.errors[a]},Ye=t=>({handleConstraintPropChange:(a,s)=>ze(t,a,s),getConstraintPropError:a=>Ue(t,a)}),Ke=({column:t,row:a},s)=>{const n={};return n.className=z(x.cell,{[x.noPadding]:a.original.id===s}),a.original.package==="loading"?t.id==="package"?n.colSpan=5:(n.className=x.hidden,n["aria-hidden"]=!0):t.id==="package"?n.role="rowheader":t.id==="actions"?n["aria-label"]="Actions":t.id==="constraint"?n["aria-label"]="Constraint":t.id==="version"?n["aria-label"]="Version":t.id==="rule"&&(n["aria-label"]="Rule"),n},Je=(t,a)=>{let s="No constraints found";return t&&(s+=` with the constraint type: "${t}"`,a&&(s+=" and")),a&&(s+=` with the search: "${a}"`),s},Ze=({filter:t,formik:a,isConstraintsLoading:s,onSelectedIdsChange:n,pageSize:u,profileConstraints:l,search:m,selectedIds:c})=>{const o=b.useMemo(()=>{if(s)return[Y];if(!l)return[];const r=l.map(C=>({...C,notAnyVersion:!!C.version}));return a.values.id!==-1?r:[a.values,...r].slice(0,u)},[s,l,a.values,u]),p=()=>{n(c.length?[]:o.map(({id:r})=>r))},P=r=>{c.includes(r)?n(c.filter(C=>C!==r)):n([...c,r])},{handleConstraintPropChange:d,getConstraintPropError:g}=Ye(a),h=b.useMemo(()=>[{accessor:"constraint",Header:()=>e.jsxs(e.Fragment,{children:[e.jsx(i.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all constraints"}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0||o.length===0,checked:o.length>0&&o.length===c.length,indeterminate:c.length>0&&c.length<o.length,onChange:p}),e.jsx("span",{children:"Constraint"})]}),Cell:({row:{original:r}})=>a.values.id===r.id?e.jsx(i.Select,{label:"Constraint",labelClassName:"u-off-screen",className:x.input,wrapperClassName:x.inputWrapper,options:q,...a.getFieldProps("constraint"),onChange:C=>d("constraint",C.target.value),error:g("constraint")}):e.jsxs("div",{className:x.checkboxContainer,children:[e.jsx(i.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${r.package} constraint`}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:a.values.id!==0,checked:c.includes(r.id),onChange:()=>{P(r.id)}}),e.jsx("span",{children:r.constraint})]})},{accessor:"package",Header:"Package",Cell:({row:{original:r}})=>a.values.id===r.id?e.jsx(L,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:x.input,wrapperClassName:x.inputWrapper,...a.getFieldProps("package"),onChange:C=>d("package",C),error:g("package")}):r.package!=="loading"?e.jsx(e.Fragment,{children:r.package}):e.jsx(O,{})},{accessor:"rule",Header:"Rule",Cell:({row:{original:r}})=>a.values.id===r.id?e.jsx(i.Select,{label:"Rule",labelClassName:"u-off-screen",className:x.input,wrapperClassName:x.inputWrapper,options:D,...a.getFieldProps("rule"),onChange:C=>d("rule",C.target.value),error:g("rule")}):e.jsx(e.Fragment,{children:D.find(({value:C})=>C===r.rule)?.label??r.rule})},{accessor:"version",Header:"Version",Cell:({row:{original:r}})=>a.values.id===r.id?e.jsx(L,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:x.input,wrapperClassName:x.inputWrapper,...a.getFieldProps("version"),onChange:C=>d("version",C),error:g("version")}):e.jsx(e.Fragment,{children:r.version})},{accessor:"actions",className:x.actionsCell,Cell:({row:{original:r}})=>e.jsx(Oe,{constraint:r,formik:a})}],[o,c.length,a.errors,a.touched]);return e.jsx(i.ModularTable,{columns:h,data:o,getCellProps:r=>Ke(r,a.values.id),className:"u-no-margin--bottom",emptyMsg:Je(t,m)})},Xe="_pagination_15tqa_1",et={pagination:Xe},tt=({profile:t})=>{const[a,s]=b.useState([]),[n,u]=b.useState(1),[l,m]=b.useState(w),[c,o]=b.useState(""),[p,P]=b.useState(""),d=v=>{s([]),u(v)},g=v=>{s([]),m(v)},h=A(),{notify:r}=k(),{editPackageProfileConstraintQuery:C,getPackageProfileConstraintsQuery:F}=N(),{mutateAsync:I}=C,G=$({initialValues:de,onSubmit:async(v,{resetForm:ee})=>{try{await I({constraint:v.constraint,id:v.id,package:v.package,rule:v.rule,version:v.version,name:t.name}),r.success({message:`"${t.title}" package profile's constraint updated successfully`,title:"Package profile constraint updated"}),ee()}catch(te){h(te)}},validationSchema:ue}),{data:E,isLoading:M}=F({constraint_type:p||void 0,limit:l,name:t.name,offset:(n-1)*l,search:c});return e.jsxs(e.Fragment,{children:[!c&&!p&&n===1&&l===w&&M&&e.jsx(O,{}),(c||p||n!==1||l!==w||!M&&E&&E.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(K,{actions:e.jsx(Re,{filter:p,formik:G,onFilterChange:P,profile:t,selectedIds:a,setSelectedIds:s}),onSearch:o,disabled:G.values.id!==0}),e.jsx(Ze,{filter:p,formik:G,isConstraintsLoading:M,onSelectedIdsChange:s,pageSize:l,profileConstraints:E?.data.results,search:c,selectedIds:a}),e.jsx(J,{currentPage:n,pageSize:l,paginate:d,setPageSize:g,totalItems:E?.data.count,className:et.pagination})]})]})},kt=()=>{const{packageProfile:t,isGettingPackageProfile:a}=B();return a?e.jsx(f.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(f.Header,{children:['Change "',t.title,`" profile's constraints`]}),e.jsx(f.Content,{children:e.jsx(tt,{profile:t})})]})},at="_constraint_1lz67_1",st="_hidden_1lz67_5",X={constraint:at,hidden:st},nt=({row:t,column:a})=>{const s={};return t.original.package==="loading"?a.id==="package"?s.colSpan=3:(s.className=X.hidden,s["aria-hidden"]=!0):a.id==="package"?s.role="rowheader":a.id==="constraint"?s["aria-label"]="Constraint":a.id==="rule"?s["aria-label"]="Rule":a.id==="version"&&(s["aria-label"]="Version"),s},ot=({isConstraintsLoading:t,profileConstraints:a,search:s})=>{const n=b.useMemo(()=>t?[Y]:a?a.map(l=>({...l,notAnyVersion:!!l.version})):[],[t,a]),u=b.useMemo(()=>[{accessor:"constraint",className:X.constraint,Header:"Constraint",Cell:({row:{original:l}})=>q.find(({value:m})=>m===l.constraint)?.label??l.constraint},{accessor:"package",Header:"Package",Cell:({row:{original:l}})=>l.package==="loading"?e.jsx(O,{}):l.package},{accessor:"version",Header:"Version",Cell:({row:{original:l}})=>l.version?`${D.find(({value:m})=>m===l.rule)?.label} ${l.version}`:"Any"}],[n]);return e.jsx(i.ModularTable,{columns:u,data:n,getCellProps:nt,emptyMsg:`No constraints found with the search: "${s}"`})},rt="_actions_nxngq_1",it={actions:rt},lt=({profile:t})=>{const[a,s]=b.useState(1),[n,u]=b.useState(w),[l,m]=b.useState(""),{pushSidePath:c}=_(),{getPackageProfileConstraintsQuery:o}=N(),{data:p,isLoading:P}=o({name:t.name,limit:n,offset:(a-1)*n,search:l}),d=()=>{c("edit-constraints")};return e.jsxs(e.Fragment,{children:[!l&&a===1&&n===w&&P&&e.jsx(O,{}),(l||a!==1||n!==w||!P&&p&&p.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(K,{className:it.actions,onSearch:m,actions:e.jsx(i.Button,{className:"u-no-margin--bottom",type:"button",onClick:d,children:"Change package constraints"})}),e.jsx(ot,{isConstraintsLoading:P,profileConstraints:p?.data.results,search:l}),e.jsx(J,{currentPage:a,pageSize:n,paginate:s,setPageSize:u,totalItems:p?.data.count})]})]})},wt=()=>{const t=A(),{notify:a}=k(),{pushSidePath:s,setPageParams:n}=_(),{removePackageProfileQuery:u}=N(),{getAccessGroupQuery:l}=W(),{data:m}=l(),c=m?.data??[],{packageProfile:o,isGettingPackageProfile:p}=B(),{mutateAsync:P,isPending:d}=u,{value:g,setTrue:h,setFalse:r}=oe();if(p)return e.jsx(f.LoadingState,{});const C=async()=>{try{await P({name:o.name}),n({sidePath:[],profile:""}),a.success({message:`Package profile "${o.name}" removed successfully.`,title:"Package profile removed"})}catch(V){t(V)}finally{r()}},F=()=>{s("edit")},I=()=>{s("duplicate")};return e.jsxs(e.Fragment,{children:[e.jsx(f.Header,{children:o.title}),e.jsxs(f.Content,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(i.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button u-no-margin",onClick:I,children:[e.jsx(i.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate profile"})]}),e.jsxs(i.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button u-no-margin",onClick:F,children:[e.jsx(i.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(i.Button,{className:"p-segmented-control__button u-no-margin",hasIcon:!0,type:"button",onClick:h,"aria-label":`Remove ${o.title} package profile`,children:[e.jsx(i.Icon,{name:i.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(S,{spaced:!0,children:[e.jsx(S.Item,{label:"Title",value:o.title}),e.jsx(S.Item,{label:"Name",value:o.name}),e.jsx(S.Item,{label:"Description",value:o.description}),e.jsx(S.Item,{label:"Access group",value:c.find(V=>V.name===o.access_group)?.title??o.access_group}),e.jsx(S.Item,{label:"Tags",large:!0,value:o.tags.join(", ")||null,type:"truncated"}),e.jsx(S.Item,{label:"Associated to",value:e.jsx(pe,{packageProfile:o})}),e.jsx(S.Item,{label:"Pending on",value:`${o.computers.pending?.length??0} ${y(o.computers.pending.length,"instance")}`}),e.jsx(S.Item,{label:"Not compliant on",value:`${o.computers["non-compliant"].length} ${y(o.computers["non-compliant"].length,"instance")}`})]}),e.jsx(lt,{profile:o})]}),e.jsx(be,{isOpen:g,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:d,confirmButtonDisabled:d,close:r,confirmationText:`remove ${o.title}`,onConfirm:C,children:e.jsxs("p",{children:['This will remove "',o.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},ct=({profile:t})=>{const a=A(),{sidePath:s,popSidePath:n,setPageParams:u}=_(),{notify:l}=k(),{getAccessGroupQuery:m}=W(),{copyPackageProfileQuery:c}=N(),{mutateAsync:o}=c,{data:p}=m(),P=p?.data.map(({name:r,title:C})=>({label:C,value:r}))??[],d=()=>{u({sidePath:[],profile:""})},h=$({initialValues:me,onSubmit:async r=>{const C={all_computers:r.all_computers,access_group:r.access_group,copy_from:t.name,description:r.description,title:r.title};!r.all_computers&&r.tags.length>0&&(C.tags=r.tags);try{await o(C),d(),l.success({message:`Profile "${t.title}" duplicated successfully`,title:"Profile duplicated"})}catch(F){a(F)}},validationSchema:ge});return b.useEffect(()=>{h.setValues({access_group:t.access_group,all_computers:t.all_computers,description:t.description,tags:t.tags,title:`${t.title} (copy)`})},[t]),e.jsxs(i.Form,{onSubmit:h.handleSubmit,noValidate:!0,children:[e.jsx(i.Input,{type:"text",label:"Title",required:!0,...h.getFieldProps("title"),error:T(h,"title")}),e.jsx(i.Input,{type:"text",label:"Description",required:!0,autoComplete:"off",...h.getFieldProps("description"),error:T(h,"description")}),e.jsx(i.Select,{label:"Access group",...h.getFieldProps("access_group"),options:P,error:T(h,"access_group")}),e.jsx(Q,{formik:h}),e.jsx(H,{submitButtonLoading:h.isSubmitting,submitButtonText:"Duplicate",hasBackButton:s.length>1,onBackButtonPress:n,onCancel:d})]})},It=()=>{const{packageProfile:t,isGettingPackageProfile:a}=B();return a?e.jsx(f.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(f.Header,{children:["Duplicate ",t.title]}),e.jsx(f.Content,{children:e.jsx(ct,{profile:t})})]})},ut=({profile:t})=>{const a=A(),{sidePath:s,popSidePath:n,setPageParams:u}=_(),{notify:l}=k(),{editPackageProfileQuery:m}=N(),{mutateAsync:c}=m,o=()=>{u({sidePath:[],profile:""})},p=async d=>{try{await c({...d,name:t.name,tags:d.all_computers?[]:d.tags}),o(),l.success({message:`Package profile "${t.title}" updated successfully`,title:"Package profile updated"})}catch(g){a(g)}},P=$({enableReinitialize:!0,initialValues:{all_computers:t.all_computers,description:t.description,tags:t.tags,title:t.title},onSubmit:p,validationSchema:he});return e.jsxs(i.Form,{onSubmit:P.handleSubmit,noValidate:!0,children:[e.jsx(i.Input,{type:"text",label:"Title",...P.getFieldProps("title"),error:T(P,"title")}),e.jsx(i.Input,{type:"text",label:"Description",...P.getFieldProps("description")}),e.jsx(Q,{formik:P}),e.jsx(H,{submitButtonLoading:P.isSubmitting,submitButtonText:"Save changes",hasBackButton:s.length>1,onBackButtonPress:n,onCancel:o})]})},$t=()=>{const{packageProfile:t,isGettingPackageProfile:a}=B();return a?e.jsx(f.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(f.Header,{children:["Edit ",t.title]}),e.jsx(f.Content,{children:e.jsx(ut,{profile:t})})]})};export{Tt as PackageProfileAddSidePanel,At as PackageProfileConstraintsAddSidePanel,kt as PackageProfileConstraintsEditSidePanel,wt as PackageProfileDetailsSidePanel,It as PackageProfileDuplicateSidePanel,$t as PackageProfileEditSidePanel,Et as PackageProfileHeader,Rt as PackageProfileList,Dt as PackageProfilesEmptyState,N as usePackageProfiles};
