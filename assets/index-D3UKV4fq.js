const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CTnMhvmZ.js","assets/index-ZrI-YXGa.js","assets/index-B4iKRl47.css","assets/EmployeeGroupIdentityIssuerList-UOILeaqj.js","assets/HeaderWithSearch-C50tlZ2C.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/index-B4hiEvGi.js","assets/SidePanelTablePagination-B3Wv3Upr.js","assets/EmployeeGroupIdentityIssuerList-CdRpefPn.css"])))=>i.map(i=>d[i]);
import{i as M,c as C,k as I,r as c,B as P,l as z,j as e,d,an as $,az as q,m as D,C as R,q as j,E as Q,aA as H,y as K,a1 as V}from"./index-ZrI-YXGa.js";import{S as Y}from"./SidePanelFormButtons-C71S0UaY.js";import{S as U}from"./SidePanelTablePagination-B3Wv3Upr.js";import"./EmployeeGroupIdentityIssuerList-UOILeaqj.js";import{u as E}from"./useGetEmployeeGroups-CwfSt8JT.js";import{I as G,S as W}from"./SidePanelDescription-DR5xx-Sq.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";import"./HeaderWithSearch-C50tlZ2C.js";import"./index-B4hiEvGi.js";const Z=()=>{const a=M(),r=C(),{mutateAsync:m,isPending:s}=I({mutationFn:async({staged_oidc_group_ids:i,import_all:n})=>r.post("/employee_groups",{staged_oidc_group_ids:i,import_all:n}),onSuccess:async()=>a.invalidateQueries({queryKey:["employeeGroups"]})});return{importEmployeeGroups:m,isEmployeeGroupsImporting:s}},J=({issuerId:a,pageSize:r,currentPage:m,search:s})=>{const{employeeGroupsCount:i}=E(),[n,x]=c.useState(null),g=C(),S=P(),h={import_session_id:n==null?void 0:n.id,exclude_imported:i&&i>0,offset:(m-1)*r,limit:r,search:s},{mutateAsync:b,isPending:f}=I({mutationFn:async({issuer_id:p})=>g.post("/oidc/groups/import_session",{issuer_id:p})});c.useEffect(()=>{b({issuer_id:a}).then(({data:p})=>{x(p)}).catch(S)},[]);const{data:l,isLoading:u}=z({queryKey:["stagedOidcGroups",h],queryFn:async()=>g.get("/oidc/groups/staged",{params:h}),enabled:n!==null});return{stagedOidcGroups:(l==null?void 0:l.data.results)??[],stagedOidcGroupsCount:(l==null?void 0:l.data.count)??0,isStagedOidcGroupsLoading:f||u}},X=()=>{const{employeeGroupsCount:a}=E();return a&&a<=G?null:e.jsx("div",{children:e.jsx(d.Notification,{severity:"negative",title:"Group limit reached",children:`You've reached the limit of ${G.toLocaleString()} groups. Remove excess groups to proceed.`})})},ee="_checkbox_1ksvx_1",_={checkbox:ee},se=c.lazy(async()=>V(()=>import("./index-CTnMhvmZ.js").then(a=>a.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),pe=({issuer:a})=>{const[r,m]=c.useState(""),[s,i]=c.useState([]),{value:n,toggle:x}=$(),[g,S]=c.useState(1),[h,b]=c.useState(q[0].value),{setSidePanelContent:f,closeSidePanel:l}=D(),{stagedOidcGroups:u,stagedOidcGroupsCount:p,isStagedOidcGroupsLoading:y}=J({issuerId:a.id,pageSize:h,currentPage:g,search:r}),k=P(),{notify:v}=R(),{importEmployeeGroups:N,isEmployeeGroupsImporting:O}=Z(),B=t=>{i([]),S(t)},F=t=>{i([]),b(t)},L=async t=>{t.preventDefault();try{const{data:{count:o}}=await N({staged_oidc_group_ids:s,import_all:n});l(),v.success({title:`You've successfully imported ${o} employee ${K(o,"group")}.`,message:"Newly added employee groups can now be managed within Landscape."})}catch(o){k(o)}},T=t=>{i(s.includes(t)?s.filter(o=>o!==t):[...s,t])},w=()=>{f("Choose an identity issuer",e.jsx(c.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(se,{})}))},A=c.useMemo(()=>{const t={accessor:"name",Header:"name",Cell:({row:{original:{name:o}}})=>e.jsx(e.Fragment,{children:e.jsx("span",{children:o})})};return n?[t]:[{accessor:"id",className:"checkbox-column",Header:()=>e.jsx(d.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all employee groups"}),disabled:u.length===0||y,indeterminate:s.length>0&&s.length<u.length,checked:s.length>0&&s.length===u.length,onChange:()=>{i(s.length>0?[]:u.map(({id:o})=>o))}}),Cell:({row:{original:o}})=>e.jsx(d.CheckboxInput,{labelClassName:"u-no-margin--bottom u-no-padding--top",label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${o.name}`}),disabled:y,name:"employee-group-checkbox",checked:s.includes(o.id),onChange:()=>{T(o.id)}})},t]},[s,y,u,n]);return y&&!r?e.jsx(j,{}):!p&&!r?e.jsx(Q,{title:"No employee groups found",body:e.jsx("p",{className:"u-no-margin--bottom",children:`Seems like there are no employee groups to import from ${a.provider.provider_label}.`})}):e.jsxs(e.Fragment,{children:[e.jsx(X,{}),e.jsx(W,{children:"Choose employee groups to import into Landscape. Once imported, you can set their priority, assign autoinstall files, and manage associated employees."}),e.jsx("div",{className:_.checkbox,children:e.jsx(d.CheckboxInput,{label:"Import all groups",onChange:x,checked:n})}),e.jsx(H,{onSearch:t=>{m(t)}}),y?e.jsx(j,{}):e.jsxs(d.Form,{noValidate:!0,onSubmit:L,children:[e.jsx(d.ModularTable,{data:u,columns:A,emptyMsg:`No employee groups found with the search: "${r}"`}),e.jsx(U,{currentPage:g,pageSize:h,paginate:B,setPageSize:F,totalItems:p,className:_.pagination}),e.jsx(Y,{hasBackButton:!0,onBackButtonPress:w,submitButtonText:"Import",submitButtonDisabled:!n&&s.length===0||O})]})]})};export{pe as default};
