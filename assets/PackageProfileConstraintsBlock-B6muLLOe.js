import{r as d,j as n,d as c}from"./index-D0dfKaih.js";import{C}from"./CellInput-Cn7DUT1J.js";import{T as h,C as g,a as w,E as N}from"./index-C6-q8MPv.js";const b="_action_w93bw_1",_="_cell_w93bw_7",v="_input_w93bw_18",P="_inputWrapper_w93bw_26",l={action:b,cell:_,input:v,inputWrapper:P},j=async(s,e,a,o)=>{await s.setFieldValue(`constraints[${e}]${[a]}`,o),await s.setFieldTouched(`constraints[${e}]${[a]}`,!0),["rule","version"].includes(a)&&(o!==""?await s.setFieldValue(`constraints[${e}].notAnyVersion`,!0):s.values.constraints[e][a==="rule"?"version":"rule"]===""&&await s.setFieldValue(`constraints[${e}].notAnyVersion`,!1))},T=(s,e,a)=>{var i,u,p;if(!((i=s.errors.constraints)!=null&&i[e])||!((p=(u=s.touched.constraints)==null?void 0:u[e])!=null&&p[a]))return;const o=s.errors.constraints[e];return typeof o!="string"?o[a]:void 0},y=async(s,e)=>{await s.setFieldValue("constraints",s.values.constraints.filter((a,o)=>o!==e)),s.touched.constraints&&(s.touched.constraints.splice(e,1),await s.setTouched({...s.touched,constraints:s.touched.constraints}))},I=s=>({handleConstraintPropChange:async(e,a,o)=>{await j(s,e,a,o)},handleConstraintRowDelete:async e=>{await y(s,e)},getConstraintsErrorByIndex:(e,a)=>T(s,e,a)}),E=({column:s})=>{const e={};return e.className=l.cell,s.id==="package_name"?e.role="rowheader":s.id==="action"?e["aria-label"]="Action":s.id==="constraint"?e["aria-label"]="Constraint":s.id==="version"?e["aria-label"]="Version":s.id==="rule"&&(e["aria-label"]="Rule"),e},O=({formik:s})=>{d.useEffect(()=>{s.submitCount!==0&&(async()=>await s.setTouched({...s.touched,constraints:new Array(s.values.constraints.length).fill(h)}))()},[s.submitCount]);const e=d.useMemo(()=>s.values.constraints,[s.values.constraints]),{handleConstraintPropChange:a,handleConstraintRowDelete:o,getConstraintsErrorByIndex:i}=I(s),u=d.useMemo(()=>[{accessor:"constraint",Header:"Constraint",Cell:({row:{index:t}})=>n.jsx(c.Select,{label:"Constraint",labelClassName:"u-off-screen",className:l.input,wrapperClassName:l.inputWrapper,options:g,...s.getFieldProps(`constraints[${t}].constraint`),onChange:r=>a(t,"constraint",r.target.value),error:i(t,"constraint")})},{accessor:"package",Header:"Package",Cell:({row:{index:t}})=>n.jsx(C,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:l.input,wrapperClassName:l.inputWrapper,...s.getFieldProps(`constraints[${t}].package`),onChange:r=>a(t,"package",r),error:i(t,"package")})},{accessor:"rule",Header:"Rule",Cell:({row:{index:t}})=>n.jsx(c.Select,{label:"Rule",labelClassName:"u-off-screen",className:l.input,wrapperClassName:l.inputWrapper,...s.getFieldProps(`constraints[${t}].rule`),options:w,onChange:r=>a(t,"rule",r.target.value),error:i(t,"rule")})},{accessor:"version",Header:"Version",Cell:({row:{index:t}})=>n.jsx(C,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:l.input,wrapperClassName:l.inputWrapper,...s.getFieldProps(`constraints[${t}].version`),onChange:r=>a(t,"version",r),error:i(t,"version")})},{accessor:"action",className:l.action,Cell:({row:t})=>n.jsx(c.Button,{type:"button",hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding","aria-label":"Delete constraint row",onClick:()=>o(t.index),children:n.jsx(c.Icon,{name:c.ICONS.delete,className:"u-no-margin--left u-no-margin--right"})})}],[e,s.errors.constraints,s.touched.constraints]),p=async()=>{if(await s.setFieldValue("constraints",[N,...s.values.constraints]),s.touched.constraints){const t=[];for(let r=s.values.constraints.length;r>0;r--)s.touched.constraints[r-1]&&(t[r]=s.touched.constraints[r-1]);await s.setTouched({constraints:t})}};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"u-align-text--right",children:n.jsxs(c.Button,{type:"button",hasIcon:!0,onClick:p,children:[n.jsx(c.Icon,{name:c.ICONS.plus,className:"u-no-margin--left"}),n.jsx("span",{children:"Add new constraint"})]})}),n.jsx(c.ModularTable,{columns:u,data:e,getCellProps:E,emptyMsg:"No constraints added yet.",className:"u-no-margin--bottom"}),s.touched.constraints&&typeof s.errors.constraints=="string"&&n.jsx("div",{className:"is-error",children:n.jsxs("p",{className:"p-form-validation__message u-no-margin--top",children:[n.jsx("strong",{children:"Error: "}),n.jsx("span",{children:s.errors.constraints})]})})]})};export{O as P};
