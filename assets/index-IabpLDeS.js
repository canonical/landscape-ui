const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BXmJspR-.js","assets/index-CNSDWj8Q.js","assets/index-CoB-_C5O.css","assets/SidePanelFormButtons-DIizKTix.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/InstancesPageActions-DL7_pmR1.js","assets/index-D-YBZSy_.js","assets/NoData-6ZK9sV5u.js","assets/TablePagination-CFXNvqsZ.js","assets/TableFilterChips-06YfpJdc.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-CLgA9gvz.css","assets/useFetchOld-BAAs34Op.js","assets/PageParamFilter-ChSwlZqZ.js","assets/TableFilter-2AKF5NjJ.js","assets/TableFilter-B85Stwni.css","assets/formikErrors-Bw8iTXYS.js","assets/ResponsiveTable-BXalKviy.js","assets/ResponsiveTable-DsN8RVSX.css","assets/index-B1ULwG00.css","assets/ListTitle-BUruUKn1.js","assets/ListTitle-CxCHkD9o.css","assets/StaticLink-BEYCGcPv.js","assets/TruncatedCell-BMum6DLZ.js","assets/Truncated-Dtg97i8C.js","assets/Truncated-uqJp6ujM.css","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-B4jhRgod.js","assets/index-CySvbr4l.js","assets/TextConfirmationModal-q88mH05g.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/InfoGrid-3w5mqARw.js","assets/InfoItem-Bt7JBIPo.js","assets/InfoItem-D8nPzgUA.css","assets/InfoGrid-D3QqOHFx.css","assets/InstancesPageActions-h3D4euDx.css","assets/TagsAddConfirmationModal-B9Kwth0Z.js","assets/ModalTablePagination-Bllm121J.js","assets/ModalTablePagination-HDr0Q-Wm.css","assets/useRoles-DYJzr0u4.js","assets/useGetTags-B_HL7bdb.js","assets/index-CuKO3Aa0.css","assets/index-DMJKUZPM.js","assets/ScriptsTabs-DfoExKFg.js","assets/helpers-kPKhnyjI.js","assets/constants-CDnVvJTb.js","assets/HeaderWithSearch-D2tNhOlz.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/ScriptsTabs-DN44MVZt.css","assets/useRunScript-Djv9SBc3.js","assets/DeliveryBlock-B3k_IVND.js","assets/RadioGroup-BVZkBsDq.js","assets/RadioGroup-WBbAFTwm.css","assets/ScriptDropdown-BDpvNfnn.js","assets/downshift.esm-DADdD-V8.js","assets/ScriptDropdown-DGqiHs-J.css","assets/index-D8g_Dy3D.js","assets/CodeEditor-DBPYuwcp.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-1fibiNNB.js","assets/AttachmentFile-CcsxK_w8.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-_dtbyd97.js","assets/EmployeeList-CKLLomOE.js","assets/EmployeeList-CnpN88if.css","assets/useGetEmployees-Bqf4LrXW.js","assets/index-CzWO0kSt.css","assets/index-6vMVic9D.js","assets/SidePanelTablePagination-CaBsUOYn.js","assets/Blocks-yjg-J-3E.js","assets/Blocks-bdK2PNd9.css","assets/Chip-O7cCAuuh.js","assets/Chip-R6WqXyae.css","assets/InstanceRemoveFromLandscapeModal-B5sQZb1c.js","assets/useRemoveInstancesFromLandscape-BuxxHEvw.js","assets/SidePanel-ChyjtMJv.js","assets/SidePanel-C17_jvtU.css","assets/WslInstancesEmptyState-Lmf8S52Y.js","assets/WslInstancesEmptyState-CBT5OoUG.css","assets/index-DWa9RADh.css"])))=>i.map(i=>d[i]);
import{f as O,t as ve,v as be,c as ge,R as d,j as t,k as xe,af as _e,l as Ie,h as je,o as f,u as Se,y as we,N as Fe,z as ke,x as Ae,U as p,B as Ce,e as y,d as a,G as Re,J as E,r as m,_}from"./index-CNSDWj8Q.js";import{T as Me}from"./TextConfirmationModal-q88mH05g.js";import{B as x}from"./Blocks-yjg-J-3E.js";import{C as Te}from"./Chip-O7cCAuuh.js";import{s as De,t as Ee,H as Le,r as n,v as L}from"./InstancesPageActions-DL7_pmR1.js";import{I as s}from"./InfoGrid-3w5mqARw.js";import{u as Pe}from"./index-D-YBZSy_.js";import"./EmployeeList-CKLLomOE.js";import{u as Oe,I as $e}from"./InstanceRemoveFromLandscapeModal-B5sQZb1c.js";import{g as P}from"./formikErrors-Bw8iTXYS.js";import"./index-CySvbr4l.js";import{u as ze}from"./useRoles-DYJzr0u4.js";import"./SidePanel-ChyjtMJv.js";import{W as Be,a as Ne}from"./WslInstancesEmptyState-Lmf8S52Y.js";import{S as Ve}from"./StaticLink-BEYCGcPv.js";const qe=()=>{const e=O(),i=ve(),{mutateAsync:c,isPending:h}=be({mutationKey:["employee","disassociate"],mutationFn:async({employee_id:u,computer_id:r})=>e.delete(`employees/${u}/computers/${r}`),onSuccess:(u,r)=>{i.invalidateQueries({queryKey:["instances",r.computer_id]})}});return{disassociateEmployeeFromInstance:c,isDisassociating:h}},Ge=(e,i={})=>{const c=O(),{id:h,...u}=e,{data:r,isLoading:v}=ge({queryKey:["employees","employee",e],queryFn:async()=>c.get(`employees/${h}`,{params:u}),...i});return{employee:r?.data,isGettingEmployee:v}},Ue=e=>{switch(e.type){case"package":return d.profiles.package({sidePath:["view"],profile:e.name||""});case"reboot":return d.profiles.reboot({sidePath:["view"],profile:e.id.toString()||""});case"removal":return d.profiles.removal({sidePath:["view"],profile:e.id.toString()||""});case"repository":return d.profiles.repository({search:e.title||""});case"script":return d.scripts.root({tab:"profiles",sidePath:["view"],profile:e.id.toString()||""});case"security":return d.profiles.security({sidePath:["view"],profile:e.id.toString()||""});case"upgrade":return d.profiles.upgrade({sidePath:["view"],profile:e.id.toString()||""});case"wsl":return d.profiles.wsl({sidePath:["view"],profile:e.name||""})}},Ke=({profile:e})=>t.jsx(Ve,{to:Ue(e),children:e.title}),Qe={deliver_after:"",deliverImmediately:!0,action:null},Ye=xe().shape({deliver_after:je().when("deliverImmediately",{is:!1,then:e=>e.required("This field is required").test({message:"Invalid date",test:i=>f(i).isValid()}).test({message:"Date must be in the future",test:i=>f(i).isAfter()})}),deliverImmediately:Ie(),action:_e().oneOf(["shutdown","reboot"]).required()}),He=e=>{const i=e.employee_id??"no-employee",c=e.tags.join(",");return`${i}-${c}`},We="_headerContainer_10wnq_1",Je="_status_10wnq_6",Ze="_heading_10wnq_12",j={headerContainer:We,status:Je,heading:Ze},Xe=m.lazy(async()=>_(()=>import("./index-BXmJspR-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42]))),et=m.lazy(async()=>_(()=>import("./index-DMJKUZPM.js"),__vite__mapDeps([43,44,1,2,9,10,11,12,45,46,8,18,19,23,24,25,26,27,28,40,13,30,31,14,15,16,47,48,49,50,29,51,3,4,5,52,17,53,54,55,56,57,58,59,60,61,62,63,64,65])).then(e=>({default:e.RunInstanceScriptForm}))),tt=m.lazy(async()=>_(()=>import("./index-_dtbyd97.js"),__vite__mapDeps([66,1,2,3,4,5,67,46,8,24,25,26,27,18,19,68,57,69,17,70]))),st=m.lazy(async()=>_(()=>import("./index-6vMVic9D.js"),__vite__mapDeps([71,1,2,15,16,10,11,72,9,12,30,31,73,74,75,76,6,7,8,13,14,17,18,19,20,21,22,23,24,25,26,27,28,29,32,33,34,35,36,67,46,68,77,78,40,79,80,81,47,48,82,83]))),ot=({instance:e})=>{const{isFeatureEnabled:i}=Se(),c=we(),h=Fe(),{notify:u}=ke(),{setSidePanelContent:r}=Ae(),{openActivityDetails:v}=Pe(),{employee:b,isGettingEmployee:$}=Ge({id:e.employee_id??0},{enabled:!!e.employee_id}),{restartInstances:z,isRestartingInstances:S}=De(),{getAccessGroupQuery:B}=ze(),{sanitizeInstance:N,isSanitizingInstance:w}=Oe(),{shutDownInstances:V,isShuttingDownInstances:F}=Ee(),{disassociateEmployeeFromInstance:q,isDisassociating:k}=qe(),{value:G,setTrue:U,setFalse:K}=p(),{value:Q,setTrue:Y,setFalse:H}=p(),{value:W,setTrue:J,setFalse:Z}=p(),{value:X,setTrue:ee,setFalse:te}=p(),{value:se,setTrue:oe,setFalse:ae}=p(),{value:ie,setTrue:le,setFalse:A}=p(),{value:ne,setTrue:re,setFalse:C}=p(),{data:R,isPending:ce}=B(),l=Ce({initialValues:Qe,validationSchema:Ye,onSubmit:async o=>{if(!o.action)return;const T={computer_ids:[e.id],deliver_after:o.deliverImmediately?void 0:`${o.deliver_after}:00Z`};try{const{data:I}=o.action==="reboot"?await z(T):await V(T),D=o.action==="reboot"?"restarted":"shut down";u.success({title:`You queued "${e.title}" to be ${D}`,message:`Instance "${e.title}" will be ${D} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{v(I)}}]})}catch(I){c(I)}}});if(ce||$)return t.jsx(y,{});const de=async()=>{try{const{data:o}=await N({computer_id:e.id,computer_title:e.title});u.success({title:`You have successfully marked ${e.title} to be sanitized.`,message:"An activity has been queued to sanitize it. The data will be permanently irrecoverable once complete.",actions:[{label:"View details",onClick:()=>{v(o)}}]})}catch(o){c(o)}finally{A()}},ue=()=>{r("Edit instance",t.jsx(m.Suspense,{fallback:t.jsx(y,{}),children:t.jsx(Xe,{instance:e})}))},me=()=>{r("Run script",t.jsx(m.Suspense,{fallback:t.jsx(y,{}),children:t.jsx(et,{parentAccessGroup:e.access_group,query:`id:${e.id}`})}))},pe=()=>{r(`Associate employee with ${e.title}`,t.jsx(m.Suspense,{fallback:t.jsx(y,{}),children:t.jsx(tt,{instanceTitle:e.title})}))},he=()=>{r(`Active profiles associated with ${e.title}`,t.jsx(m.Suspense,{fallback:t.jsx(y,{}),children:t.jsx(st,{instance:e})}),"medium")},ye=async()=>{try{await q({computer_id:e.id,employee_id:e.employee_id??0}),C(),u.success({title:`You have successfully disassociated ${b?.name??"the employee"}.`,message:`${b?.name??"The employee"} has been successfully disassociated from ${e.title}.`})}catch(o){c(o)}},g=async o=>{await l.setFieldValue("action",o),l.handleSubmit()},M=()=>{h(d.instances.root(),{replace:!0})},fe=R?R.data:[];return t.jsxs(t.Fragment,{children:[t.jsx(Le,{title:t.jsxs("div",{className:j.headerContainer,children:[t.jsx("h2",{className:Re("p-heading--4 u-no-padding--top",j.heading),children:e.title}),e.is_wsl_instance&&t.jsx(Te,{value:"WSL instance"})]}),actions:{nondestructive:[{icon:"edit",label:"Edit",onClick:ue},{icon:"restart",label:"Restart",onClick:U,excluded:!n(e).power},{icon:"power-off",label:"Shut down",onClick:Y,excluded:!n(e).power},{icon:"code",label:"Run script",onClick:me,excluded:!n(e).scripts},{icon:a.ICONS.user,label:"Associate employee",onClick:pe,collapsed:!0,excluded:!i("employee-management")||!n(e).employees||e.employee_id!==null},{icon:a.ICONS.user,label:"Disassociate employee",onClick:re,collapsed:!0,excluded:!i("employee-management")||!n(e).employees||e.employee_id===null}],destructive:[{icon:"restart",label:"Reinstall",onClick:J,collapsed:!0,excluded:!n(e).uninstallation},{icon:"close",label:"Uninstall",onClick:ee,collapsed:!0,excluded:!n(e).uninstallation},{icon:a.ICONS.delete,label:"Remove from Landscape",onClick:oe,collapsed:!0},{icon:"tidy",label:"Sanitize",onClick:le,collapsed:!0,excluded:!n(e).sanitization}]}},He(e)),t.jsxs(x,{children:[t.jsx(x.Item,{title:"Status",children:t.jsxs(s,{children:[t.jsx(s.Item,{label:"Status",value:t.jsxs("div",{className:j.status,children:[t.jsx(a.Icon,{name:L(e).icon??""}),t.jsx("span",{children:L(e).label})]})}),t.jsx(s.Item,{label:"Last ping time",value:f(e.last_ping_time).isValid()?f(e.last_ping_time).format(E):null}),t.jsx(s.Item,{label:"Access group",value:fe.find(o=>o.name===e.access_group)?.title||e.access_group}),t.jsx(s.Item,{label:"Tags",value:e.tags.join(", "),type:"truncated"}),t.jsx(s.Item,{label:"Profiles",value:e.profiles?.length?e.profiles.length===1?t.jsx(Ke,{profile:e.profiles[0]}):t.jsxs(a.Button,{type:"button",className:"u-no-margin",appearance:"link",onClick:he,children:[e.profiles.length," profiles"]}):null,type:"truncated"}),n(e).employees&&t.jsx(s.Item,{label:"Associated employee",value:b?.name})]})}),t.jsx(x.Item,{title:"Registration details",children:t.jsxs(s,{children:[t.jsx(s.Item,{label:"Hostname",value:e.hostname}),t.jsx(s.Item,{label:"ID",value:e.id}),n(e).hardware&&t.jsx(s.Item,{label:"Serial number",value:e.grouped_hardware?.system.serial}),n(e).hardware&&t.jsx(s.Item,{label:"Product identifier",value:e.grouped_hardware?.system.model}),t.jsx(s.Item,{label:"OS",value:e.distribution_info?.description}),n(e).hardware&&t.jsx(s.Item,{label:"IP addresses",value:Array.isArray(e.grouped_hardware?.network)?e.grouped_hardware.network.map(o=>o.ip).join(", "):null,type:"truncated"}),t.jsx(s.Item,{label:"Registered",value:f(e.registered_at).format(E)})]})}),t.jsx(x.Item,{title:"Other",children:t.jsxs(s,{children:[t.jsx(s.Item,{label:"Annotations",value:null}),t.jsx(s.Item,{label:"Comment",value:e.comment})]})})]}),G&&t.jsx(a.ConfirmationModal,{close:K,title:"Restart instance",confirmButtonLabel:"Restart",confirmButtonAppearance:"positive",confirmButtonDisabled:S,confirmButtonLoading:S,onConfirm:async()=>g("reboot"),children:t.jsxs(a.Form,{onSubmit:async()=>g("reboot"),noValidate:!0,children:[t.jsx(a.CheckboxInput,{label:"Deliver as soon as possible",...l.getFieldProps("deliverImmediately"),checked:l.values.deliverImmediately}),t.jsx(a.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...l.getFieldProps("deliver_after"),disabled:l.values.deliverImmediately,error:P(l,"deliver_after")}),t.jsxs("p",{children:['This will restart "',e.title,'" instance.']})]})}),Q&&t.jsx(a.ConfirmationModal,{close:H,title:"Shut down instance",confirmButtonLabel:"Shut down",confirmButtonAppearance:"positive",confirmButtonDisabled:F,confirmButtonLoading:F,onConfirm:async()=>g("shutdown"),children:t.jsxs(a.Form,{onSubmit:async()=>g("shutdown"),noValidate:!0,children:[t.jsx(a.CheckboxInput,{label:"Deliver as soon as possible",...l.getFieldProps("deliverImmediately"),checked:l.values.deliverImmediately}),t.jsx(a.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...l.getFieldProps("deliver_after"),disabled:l.values.deliverImmediately,error:P(l,"deliver_after")}),t.jsxs("p",{children:['This will shut down "',e.title,'" instance.']})]})}),ne&&t.jsx(a.ConfirmationModal,{close:C,title:`Disassociate employee from ${e.title}`,confirmButtonLabel:"Disassociate",confirmButtonAppearance:"negative",confirmButtonDisabled:k,confirmButtonLoading:k,onConfirm:ye,children:t.jsxs("p",{children:["You are about to disassociate instance ",e.title," from"," ",b?.name,". This will revoke their access to the instanceâ€™s details and recovery key."]})}),e.is_wsl_instance&&t.jsxs(t.Fragment,{children:[t.jsx(Be,{close:Z,instances:[{name:e.title,computer_id:e.id}],isOpen:W,windowsInstance:e}),t.jsx(Ne,{close:te,instances:[{name:e.title,computer_id:e.id}],isOpen:X,onSuccess:M,parentId:e.parent.id})]}),t.jsx($e,{close:ae,instance:e,isOpen:se,onSuccess:M}),t.jsx(Me,{isOpen:ie,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:w,confirmButtonLoading:w,onConfirm:de,close:A,confirmationText:`sanitize ${e.title}`,title:"Sanitize instance",children:t.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",e.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})},xt=Object.freeze(Object.defineProperty({__proto__:null,default:ot},Symbol.toStringTag,{value:"Module"}));export{Ke as P,xt as i};
