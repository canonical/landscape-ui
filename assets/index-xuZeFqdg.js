const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-GunHboTf.js","assets/index-DMXNEIi7.js","assets/index-C0ZxZ9J6.css","assets/SidePanelFormButtons-M1h5Bq-w.js","assets/SidePanelFormButtons.module-C5v714vX.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/AssociationBlock-CZ7PZok3.js","assets/MultiSelectField-DWuff7MK.js","assets/MultiSelectField-GyNA33om.css","assets/useInstances-DrDmibvK.js","assets/useFetchOld-CbtR_FJp.js","assets/AssociationBlock-OuvPxND7.css","assets/useAPTSources-BltmwLmv.js","assets/useRoles-B-oVfydv.js","assets/constants-BnQPxCKz.js","assets/moment-C5S46NFB.js","assets/NoData-Bf6AVw5n.js","assets/index-oEfqYCPh.js","assets/moment-BFprfAlu.js","assets/TablePagination-C2Qj9oCi.js","assets/usePageParams-0jCHbpdj.js","assets/TablePaginationBase-ilpj99iv.js","assets/TablePaginationBase-CJl3HN1X.css","assets/TableFilterChips-BAaG34gk.js","assets/TableFilterChips-BAnU27MY.css","assets/index-Eujs1Quf.css","assets/constants-DhXkDRlN.css","assets/tests-DFnZqbNV.js","assets/index-BimGfo9_.css"])))=>i.map(i=>d[i]);
import{b as S,e as A,c as m,d as M,r as p,_ as P,p as E,f as j,j as e,g as l,n as y,E as Q}from"./index-DMXNEIi7.js";import{P as B,a as O,b as L}from"./PageMain-DOWCBSrp.js";import{u as N}from"./useFetchOld-CbtR_FJp.js";import"./constants-BnQPxCKz.js";import"./moment-C5S46NFB.js";import{u as T}from"./useRoles-B-oVfydv.js";import{N as k}from"./NoData-Bf6AVw5n.js";function _(){const o=S(),t=A(),r=N(),i=(s={},u={})=>M({queryKey:["repositoryProfiles",s],queryFn:()=>t.get("repositoryprofiles",{params:s}),...u}),a=m({mutationFn:s=>t.post("repositoryprofiles",s),onSuccess:()=>o.invalidateQueries({queryKey:["repositoryProfiles"]})}),c=m({mutationFn:({name:s,...u})=>t.put(`repositoryprofiles/${s}`,u),onSuccess:()=>o.invalidateQueries({queryKey:["repositoryProfiles"]})}),n=m({mutationKey:["repositoryProfiles"],mutationFn:s=>r.get("RemoveRepositoryProfile",{params:s}),onSuccess:()=>o.invalidateQueries({queryKey:["repositoryProfiles"]})});return{getRepositoryProfilesQuery:i,createRepositoryProfileQuery:a,editRepositoryProfileQuery:c,removeRepositoryProfileQuery:n}}const w="_toggleButton_bnzrt_1",D="_menu_bnzrt_6",x={toggleButton:w,menu:D},I=p.lazy(()=>P(()=>import("./index-GunHboTf.js").then(o=>o.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]))),q=({profile:o})=>{const[t,r]=p.useState(!1),[i,a]=p.useState(""),c=E(),{setSidePanelContent:n}=j(),{removeRepositoryProfileQuery:s}=_(),{mutateAsync:u,isPending:g}=s,b=()=>{n(`Edit ${o.title}`,e.jsx(p.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(I,{action:"edit",profile:o})}))},v=async()=>{try{await u({name:o.name})}catch(d){c(d)}finally{h()}},R=()=>{r(!0)},h=()=>{r(!1)},C=d=>{a(d.target.value)},F=[{children:e.jsxs(e.Fragment,{children:[e.jsx(l.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),"aria-label":`Edit "${o.title}" profile`,hasIcon:!0,onClick:b},{children:e.jsxs(e.Fragment,{children:[e.jsx(l.Icon,{name:l.ICONS.delete}),e.jsx("span",{children:"Remove"})]}),"aria-label":`Remove "${o.title}" repository profile`,hasIcon:!0,onClick:R}];return e.jsxs(e.Fragment,{children:[e.jsx(l.ContextualMenu,{position:"left",className:x.menu,toggleClassName:x.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(l.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${o.title} profile actions`},links:F}),t&&e.jsxs(l.ConfirmationModal,{title:"Remove repository profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:g||i!==`remove ${o.name}`,confirmButtonLoading:g,onConfirm:v,close:h,children:[e.jsxs("p",{children:['This will remove "',o.title,'" profile. This action is irreversible.']}),"Type ",e.jsxs("b",{children:["remove ",o.name]})," to confirm.",e.jsx(l.Input,{type:"text",value:i,onChange:C})]})]})},$=({column:o})=>{const t={};return o.id==="title"?t.role="rowheader":o.id==="description"?t["aria-label"]="Description":o.id==="access_group"?t["aria-label"]="Access group":o.id==="id"&&(t["aria-label"]="Actions"),t},H="_accessGroup_1qgn5_1",z="_description_1qgn5_5",G="_actions_1qgn5_9",f={accessGroup:H,description:z,actions:G},K=({repositoryProfiles:o})=>{const{getAccessGroupQuery:t}=T(),{data:r}=t(),i=((r==null?void 0:r.data)??[]).map(({name:n,title:s})=>({label:s,value:n})),a=p.useMemo(()=>o,[o]),c=p.useMemo(()=>[{accessor:"title",Header:"Title"},{accessor:"description",Header:"Description",className:f.description,Cell:({row:n})=>n.original.description||e.jsx(k,{})},{accessor:"access_group",Header:"Access group",className:f.accessGroup,Cell:({row:{original:n}})=>{var s;return((s=i.find(({value:u})=>n.access_group===u))==null?void 0:s.label)??n.access_group}},{accessor:"id",className:f.actions,Header:"Actions",Cell:({row:n})=>e.jsx(q,{profile:n.original})}],[a,i]);return e.jsx(l.ModularTable,{columns:c,data:a,getCellProps:$,emptyMsg:"No profiles yet."})},V=p.lazy(()=>P(()=>import("./index-GunHboTf.js").then(o=>o.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28])).then(o=>({default:o.RepositoryProfileForm}))),Y=()=>{const{setSidePanelContent:o}=j(),{getRepositoryProfilesQuery:t}=_(),{data:r,isLoading:i}=t(),a=(r==null?void 0:r.data.results)??[],c=()=>{o("Add repository profile",e.jsx(p.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(V,{action:"add"})}))};return e.jsxs(B,{children:[e.jsx(O,{title:"Repository profiles",actions:[e.jsx(l.Button,{appearance:"positive",onClick:c,type:"button",children:"Add repository profile"},"new-key-button")]}),e.jsxs(L,{children:[i&&e.jsx(y,{}),!i&&a.length===0&&e.jsx(Q,{title:"No repository profiles found",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You havenâ€™t added any repository profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/manage-repositories-web-portal",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage repositories in Landscape"})]}),cta:[e.jsx(l.Button,{appearance:"positive",onClick:c,type:"button",children:"Add repository profile"},"table-add-new-profile")]}),!i&&a.length>0&&e.jsx(K,{repositoryProfiles:a})]})]})},te=Object.freeze(Object.defineProperty({__proto__:null,default:Y},Symbol.toStringTag,{value:"Module"}));export{K as R,te as i,_ as u};
