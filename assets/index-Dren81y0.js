import{r as i,j as e,g as p,e as g,E as S,h as C,k as E,x as b}from"./index-8m1ayHDq.js";import{P as N,a as w,b as I}from"./PageMain-BWsEERQe.js";import{h as f}from"./moment-Cl4UOzQZ.js";import{u as y}from"./usePageParams-Ct-CUXom.js";import{u as L}from"./useQuery-DqyaY3P-.js";import"./TablePagination.module-DLVph1Z1.js";import{T}from"./TablePagination-u3H_Anpp.js";const P="_message_1hc9t_1",F={message:P},H="_container_1m3ln_1",M="_truncated_1m3ln_5",A="_hidden_1m3ln_12",O="_expandedString_1m3ln_17",z="_showScroll_1m3ln_21",D="_item_1m3ln_25",R="_count_1m3ln_29",d={container:H,truncated:M,hidden:A,expandedString:O,showScroll:z,item:D,count:R},x=120,$=({items:n})=>{const[c,t]=i.useState(0),[r,u]=i.useState(!1),[m,l]=i.useState(!1),o=n.length===1&&typeof n[0]=="string",s=i.useRef(null),a=()=>{if(!s.current)return;const h=s.current.querySelectorAll(`span.${d.item}`);t(Array.from(h).filter(({offsetHeight:_,offsetTop:j})=>j>_).length)};return i.useEffect(()=>{if(s.current)return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}},[s.current]),i.useEffect(()=>{r&&(s.current&&l(s.current.scrollHeight>s.current.clientHeight),window.removeEventListener("resize",a))},[r]),i.useEffect(()=>{a()},[n]),e.jsxs("div",{className:d.container,children:[e.jsx("div",{ref:s,className:p(d.truncated,{[d.hidden]:!r,[d.expandedString]:o&&r,[d.showScroll]:m}),children:o?e.jsxs(e.Fragment,{children:[n[0].slice(0,x),e.jsx("span",{className:p({[d.hidden]:!r}),children:n[0].slice(x)})]}):n.map((h,_)=>e.jsx("span",{className:d.item,children:h},_))}),(c>0||o&&n[0].length>x)&&!r&&e.jsx(g.Button,{type:"button",appearance:"base",onClick:()=>{u(!0)},className:p("u-no-margin--bottom u-no-padding",d.count),children:o?e.jsx("span",{className:"p-text--small u-text--muted",children:"show more"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"u-text--muted",children:" +"}),e.jsx("span",{className:"u-text--muted",children:c})]})})]})},k=({eventsLog:n})=>{const c=i.useMemo(()=>[{accessor:"creation_time",Header:"creation time",Cell:({row:t})=>e.jsx(e.Fragment,{children:f(t.original.creation_time).format(S)})},{accessor:"person_name",Header:"username",Cell:({row:t})=>e.jsx(e.Fragment,{children:t.original.person_name})},{accessor:"entity_type",Header:"entity type",Cell:({row:t})=>e.jsx(e.Fragment,{children:t.original.entity_type})},{accessor:"entity_name",Header:"entity name",Cell:({row:t})=>e.jsx(e.Fragment,{children:t.original.entity_name})},{accessor:"message",className:F.message,Header:"event log message",Cell:({row:t})=>t.original.message.length<120?e.jsx(e.Fragment,{children:t.original.message}):e.jsx($,{items:[t.original.message]})}],[n]);return e.jsx(g.ModularTable,{columns:c,data:n,sortable:!0,emptyMsg:"No events found"})},Y="_container_r415z_1",B="_searchContainer_r415z_8",U="_select_r415z_12",v={container:Y,searchContainer:B,select:U},V=[{label:"1 day",value:1},{label:"7 days",value:7},{label:"30 days",value:30},{label:"90 days",value:90},{label:"180 days",value:180},{label:"365 days",value:365}],q=()=>{const{search:n,days:c,setPageParams:t}=y(),[r,u]=i.useState(n),m=()=>{t({search:r})},l=()=>{t({search:""})},o=a=>{t({days:a})},s=a=>{a.preventDefault(),m()};return e.jsxs("div",{className:v.container,children:[e.jsx("div",{className:v.searchContainer,children:e.jsx(g.Form,{onSubmit:s,noValidate:!0,children:e.jsx(g.SearchBox,{value:r,onChange:a=>{u(a)},onSearch:m,onClear:l})})}),e.jsx(g.Select,{wrapperClassName:v.select,label:"Days",labelClassName:"u-no-margin--bottom",options:V,value:c,onChange:a=>o(a.target.value)})]})};function G(){const n=C();return{getEventsLog:(t,r={})=>L({queryKey:["events",t],queryFn:()=>n.get("events",{params:t}),...r})}}const K=(n,c)=>{const t=["creation_time","person_id","person_name","entity_type","entity_id","entity_name","message"],u=[["Creation Time","Person ID","Person Name","Entity Type","Entity ID","Entity Name","Message"].join(","),...n.map(s=>t.map(a=>s[a]).join(","))].join(`\r
`),m=new Blob([u],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(m),o=document.createElement("a");o.href=l,o.download=c,document.body.appendChild(o),o.click(),document.body.removeChild(o)},Q=()=>{const{days:n,search:c,currentPage:t,pageSize:r}=y(),{user:u}=E(),{getEventsLog:m}=G(),{data:l,isLoading:o}=m({days:Number(n),limit:r,offset:(t-1)*r,search:c}),s=i.useMemo(()=>(l==null?void 0:l.data.results.filter(a=>a.message.includes(c)))??[],[l,c]);return e.jsxs(N,{children:[e.jsx(w,{title:"Events log",actions:[e.jsx(g.Button,{onClick:()=>K(s,`Event Log - ${u.current_account}-${f().format("YYYY-MM-DDTHH mm ss[Z]")}.csv`),children:"Download as CSV"},"download-as-cv")]}),e.jsxs(I,{children:[e.jsx(q,{}),o?e.jsx(b,{}):e.jsx(k,{eventsLog:s}),e.jsx(T,{totalItems:l==null?void 0:l.data.count,currentItemCount:s.length})]})]})},se=Q;export{se as default};
