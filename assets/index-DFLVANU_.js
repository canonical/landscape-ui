import{d as H,m as E,a0 as Z,o as u,aS as L,j as e,e as h,a5 as K,b4 as M,H as N,n as f,aJ as v,aw as _,i as W,k as V,l as B,s as A,t as Q,v as U,y as J,f as X,a as z,c as Y,as as ee,aN as C,at as se,b5 as te,b6 as ne,b7 as ae,au as re,b8 as ce,b9 as ie}from"./index-B8b5RWTQ.js";import{P as oe,a as le,b as de}from"./PageMain-DY3dIPSH.js";import{u as he}from"./useGetInstances-C4lOlnSV.js";import{u as ue}from"./useSelection-BjyM2rOg.js";import{u as pe}from"./useGetTags-C4nOGNJL.js";import{u as me}from"./useRoles-BQau3qF0.js";const xe=()=>{const s=H(),{data:t,isPending:r}=E({queryKey:["availabilityZones"],queryFn:async()=>s.get("computers/availability-zones")});return{availabilityZones:t?.data.values??[],isGettingAvailabilityZones:r}},je="_menuContainer_xrtuf_1",fe="_wrapper_xrtuf_6",O={menuContainer:je,wrapper:fe},ge="_root_1fm3p_1",ye="_label_1fm3p_5",Se="_text_1fm3p_16",ve="_icon_1fm3p_20",_e="_content_1fm3p_24",w={root:ge,label:ye,text:Se,icon:ve,content:_e},be=({el:s})=>{const{value:t,setFalse:r,toggle:a}=Z(),i=u.useRef(null);L(i,r);const c=u.cloneElement(s,{inline:!0});return e.jsxs("div",{ref:i,className:w.root,children:[e.jsxs(h.Button,{type:"button",appearance:"base",className:w.label,onClick:a,children:[e.jsx(h.Icon,{name:"chevron-down",className:w.icon}),e.jsx("span",{className:w.text,children:s.props.label})]}),t&&e.jsx("div",{className:`p-contextual-menu__dropdown ${w.content}`,children:c})]})},we=({filters:s,collapseFrom:t="md",menuLabel:r="Filters",className:a,menuPosition:i="right"})=>{const c=K(`(min-width: ${M[t]}px)`);return e.jsx("div",{className:N(O.wrapper,a),children:c?s.map((n,d)=>e.jsx("span",{children:n},d)):e.jsx(h.ContextualMenu,{position:i,hasToggleIcon:!0,toggleLabel:r,toggleClassName:"u-no-margin--bottom",children:e.jsx("div",{className:O.menuContainer,children:s.map((n,d)=>n.type.name?e.jsx(be,{el:n},d):n)})})})},Ce="_label_1i8qt_1",Ie={label:Ce},Fe=({options:s,label:t,inline:r=!1})=>{const{disabledColumns:a,setPageParams:i}=f(),c=n=>s.filter(({value:d})=>!n.includes(d)).map(({value:d})=>d);return v("disabledColumns",s.filter(n=>n.canBeHidden).map(n=>n.value)),e.jsx(_,{type:"multiple",showSelectedItemCount:!0,label:e.jsxs(e.Fragment,{children:[e.jsx(h.Icon,{name:"settings"}),e.jsx("span",{className:Ie.label,children:t})]}),onItemsSelect:n=>{i({disabledColumns:c(n)})},options:s,disabledOptions:s.filter(({canBeHidden:n})=>!n),selectedItems:c(a),inline:r})},$=()=>{const s=W(),t=V(),r=(n={},d={})=>E({queryKey:["savedSearches",n],queryFn:async()=>s.get("GetSavedSearches",{params:n}),...d}),a=B({mutationFn:async n=>s.get("CreateSavedSearch",{params:n}),onSuccess:async()=>t.invalidateQueries({queryKey:["savedSearches"]})}),i=B({mutationFn:async n=>s.get("EditSavedSearch",{params:n}),onSuccess:async()=>t.invalidateQueries({queryKey:["savedSearches"]})}),c=B({mutationFn:async n=>s.get("RemoveSavedSearch",{params:n}),onSuccess:async()=>t.invalidateQueries({queryKey:["savedSearches"]})});return{getSavedSearchesQuery:r,createSavedSearchQuery:a,editSavedSearchQuery:i,removeSavedSearchQuery:c}},Ne="_container_1im0r_1",Be="_list_1im0r_6",ke="_listItem_1im0r_11",Pe="_search_1im0r_18",Te="_row_1im0r_26",$e="_truncated_1im0r_34",g={container:Ne,list:Be,listItem:ke,search:Pe,row:Te,truncated:$e},Oe=({onSavedSearchClick:s,onSavedSearchRemove:t,savedSearches:r})=>{if(!r.length)return null;const a=A(),{notify:i}=Q(),{removeSavedSearchQuery:c}=$(),{mutateAsync:n,isPending:d}=c,l=async o=>{try{await n({name:o}),t(),i.success({message:`Saved search ${o} successfully removed`,title:"Saved search removed"})}catch(x){a(x)}};return e.jsxs("div",{className:g.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Saved searches"}),e.jsx("ul",{className:N("p-list--divided u-no-margin--bottom",g.list),children:r.map(o=>e.jsx("li",{children:e.jsxs("div",{className:g.listItem,children:[e.jsx(h.Button,{type:"button",appearance:"base",className:g.search,onClick:()=>{s(o)},children:e.jsxs(h.Row,{className:g.row,children:[e.jsx(h.Col,{size:4,children:e.jsx(h.Tooltip,{message:o.name,positionElementClassName:g.truncated,children:e.jsx("span",{children:o.name})})}),e.jsx(h.Col,{size:8,children:e.jsx(h.Tooltip,{message:o.search,positionElementClassName:g.truncated,children:e.jsx("span",{children:o.search})})})]})}),e.jsx(h.ConfirmationButton,{className:"has-icon u-no-margin--bottom u-no-padding--bottom u-no-padding--top",type:"button",appearance:"base",confirmationModalProps:{title:"Remove saved search",children:e.jsxs("p",{children:['This will remove the saved search "',o.name,'".']}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:()=>l(o.name)},children:e.jsx(h.Icon,{name:"delete"})})]})},o.name))})]})},Re="_infoContainer_zti77_1",qe="_helpButtonContainer_zti77_9",Ee="_helpButton_zti77_9",k={infoContainer:Re,helpButtonContainer:qe,helpButton:Ee},Le=({onHelpButtonClick:s})=>e.jsx("div",{className:k.infoContainer,children:e.jsx("div",{className:k.helpButtonContainer,children:e.jsx(h.Button,{type:"button",appearance:"base",hasIcon:!0,"aria-label":"Search help",className:k.helpButton,onClick:t=>{t.stopPropagation(),s()},children:e.jsx(h.Icon,{name:h.ICONS.help})})})}),Ae=({onClose:s,onSearchSave:t,search:r})=>{const a=A(),{notify:i}=Q(),{createSavedSearchQuery:c}=$(),{mutateAsync:n}=c,l=U({initialValues:{name:""},onSubmit:async({name:o})=>{try{await n({search:r,name:o,title:o}),i.success({message:`Saved search ${o} successfully added`,title:"Saved search added"}),t(),s()}catch(x){a(x)}},validationSchema:J({name:X().required("This field is required").test({message:"Name must consist of only lowercase alphanumeric characters and hyphens",test:o=>/^[a-z0-9][-a-z0-9]*$/.test(o)})})});return e.jsxs(h.Form,{onSubmit:l.handleSubmit,noValidate:!0,children:[e.jsx(h.Input,{type:"text",autoComplete:"off",autoFocus:!0,label:"Search name",...l.getFieldProps("name"),error:l.touched.name&&l.errors.name?l.errors.name:void 0}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(h.Button,{type:"button",disabled:l.isSubmitting,onClick:s,children:"Cancel"}),e.jsx(h.Button,{type:"submit",disabled:l.isSubmitting,appearance:"positive","aria-label":`Saved search as ${l.values.name}`,children:"Save search"})]})]})},Qe="_container_fqj7b_1",ze="_prompt_fqj7b_10",Ge="_saveButton_fqj7b_17",P={container:Qe,prompt:ze,saveButton:Ge},De=({onSearchSave:s,search:t})=>{const[r,a]=u.useState(!1);return e.jsxs(e.Fragment,{children:[t&&r&&e.jsx(Ae,{onClose:()=>{a(!1)},onSearchSave:s,search:t}),t&&!r&&e.jsxs("div",{className:P.container,children:[e.jsxs("span",{className:P.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:t}),e.jsx("span",{children:"..."})]}),e.jsx(h.Button,{type:"button",appearance:"link",onClick:()=>{a(!0)},className:P.saveButton,children:"Save search"})]})]})},He="_searchContainer_pk8ic_1",Ze="_form_pk8ic_8",Ke="_searchBoxContainer_pk8ic_13",Me="_input_pk8ic_17",F={searchContainer:He,form:Ze,searchBoxContainer:Ke,input:Me},R=({inputText:s,savedSearches:t,search:r})=>{if(!t)return[];let a=t;if(r){const i=r.split(",").filter(Boolean);a=a.filter(({name:c})=>i.every(n=>n!==`search:${c}`))}return s&&(a=a.filter(({name:i,search:c})=>i.toLowerCase()!==s.trim().toLowerCase()&&c.toLowerCase()!==s.trim().toLowerCase())),a},We=({onHelpButtonClick:s})=>{const{query:t,setPageParams:r}=f(),[a,i]=u.useState(""),[c,n]=u.useState(!1),{getSavedSearchesQuery:d}=$(),l=u.useRef(null),o=u.useRef(null);L(l,m=>{const j=document.querySelector(".p-modal");j&&j.contains(m.target)||n(!1)});const{data:y,isLoading:b}=d(),I=u.useMemo(()=>R({inputText:a,savedSearches:y?.data,search:t}),[y,a,t]),p=()=>{if(!a)return;const j=R({inputText:"",savedSearches:y?.data,search:t}).some(({name:D})=>D.toLowerCase()===a.trim().toLowerCase())?"search:":"";r({query:t?`${t},${j}${a}`:`${j}${a}`}),i("")},S=m=>{r({query:t?`${t},search:${m.name}`:`search:${m.name}`})},G=m=>{const{key:j}=m;c?(j==="Escape"&&n(!1),j==="Enter"&&p()):j==="Enter"&&n(!0)};return e.jsxs("div",{className:"p-search-and-filter",ref:l,children:[e.jsxs("div",{className:N("p-search-and-filter__search-container",F.searchContainer),"aria-expanded":c,ref:o,onClick:()=>{n(!0)},children:[e.jsx(h.Form,{onSubmit:m=>{m.preventDefault(),p()},className:N("p-search-and-filter__box",F.form),children:e.jsx("div",{className:F.searchBoxContainer,children:e.jsx(h.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autocomplete:"off",className:F.input,value:a,onChange:m=>{i(m)},onClear:()=>{i("")},onSearch:p,onClick:()=>{n(!0)},onKeyUp:G})})}),e.jsx(Le,{onHelpButtonClick:s})]}),c&&b&&e.jsx(z,{}),c&&!b&&e.jsxs("div",{className:"p-search-and-filter__panel",children:[e.jsx(De,{onSearchSave:()=>{i("")},search:a.trim()}),e.jsx(Oe,{onSavedSearchClick:S,onSavedSearchRemove:()=>{n(!0)},savedSearches:I})]})]})},Ve=({options:s,label:t,inline:r=!1})=>{const{accessGroups:a,setPageParams:i}=f();return v("accessGroups",s.map(c=>c.value)),e.jsx(_,{type:"multiple",label:t,hasToggleIcon:!0,hasBadge:!0,options:s,onItemsSelect:c=>{i({accessGroups:c})},selectedItems:a,inline:r})},Ue=({options:s,label:t,inline:r=!1})=>{const[a,i]=u.useState(""),{availabilityZones:c,setPageParams:n}=f(),d=s.length>9&&a?s.filter(({value:o})=>o!=="none"&&o.includes(a)):s;v("availabilityZones",d.map(o=>o.value));const l=o=>{o[o.length-1]==="none"?n({availabilityZones:["none"]}):n({availabilityZones:o[0]!=="none"?o:o.filter(x=>x!=="none")})};return e.jsx(_,{type:"multiple",label:t,hasToggleIcon:!0,hasBadge:!0,onSearch:s.length>9?o=>{i(o)}:void 0,options:d,onItemsSelect:l,selectedItems:c,inline:r})},Je=({options:s,label:t,inline:r=!1})=>{const{os:a,setPageParams:i}=f();return v("os",s.map(c=>c.value)),e.jsx(_,{type:"single",hasBadge:!0,label:t,hasToggleIcon:!0,options:s,onItemSelect:c=>{i({os:c})},selectedItem:a,inline:r})},Xe=({options:s,label:t,inline:r=!1})=>{const[a,i]=u.useState(""),{tags:c,setPageParams:n}=f(),d=s.filter(({value:l})=>l.includes(a));return v("tags",d.map(l=>l.value)),e.jsx(_,{type:"multiple",label:t,hasToggleIcon:!0,hasBadge:!0,options:d,onItemsSelect:l=>{n({tags:l})},onSearch:l=>{i(l)},selectedItems:c,inline:r})},Ye=({label:s,options:t,inline:r=!1})=>{const{wsl:a,setPageParams:i}=f();return v("wsl",["parent","child"]),e.jsx(_,{type:"multiple",label:s,hasToggleIcon:!0,hasBadge:!0,options:t,onItemsSelect:c=>{i({wsl:c})},selectedItems:a,inline:r})},es="_top_1l498_1",ss="_searchContainer_1l498_13",ts="_divider_1l498_22",T={top:es,searchContainer:ss,divider:ts},ns=()=>{const{isFeatureEnabled:s}=Y(),t=["package","reboot","removal","repository"];s("script-profiles")&&t.push("script"),s("usg-profiles")&&t.push("security"),t.push("upgrade"),s("wsl-child-instance-profiles")&&t.push("wsl");const r=[{term:"<keyword>",description:e.jsxs("span",{children:["Instances with the title or hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"distribution:<keyword>",description:e.jsxs("span",{children:["Instances with the installed distribution named"," ",e.jsx("code",{children:"<keyword>"})]})},{term:"needs:reboot",description:"Instances needing a reboot"},{term:"alert:<type>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with outstanding alerts of the specified"," ",e.jsx("code",{children:"<type>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be ",e.jsx("code",{children:"package-upgrades"}),","," ",e.jsx("code",{children:"security-upgrades"}),",",e.jsx("code",{children:"package-profiles"}),","," ",e.jsx("code",{children:"package-reporter"}),", ",e.jsx("code",{children:"esm-disabled"}),","," ",e.jsx("code",{children:"computer-offline"}),",",e.jsx("code",{children:"computer-reboot"}),","," ",e.jsx("code",{children:"computer-duplicates"}),", ",e.jsx("code",{children:"unapproved-activities"}),"."]})]})},{term:"ip:<address>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with IP addresses like ",e.jsx("code",{children:"<address>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<address>"})," can be a fragment or partial IP address representing a subnet such as 91.185.94 to match any instances in the subnet."]})]})},{term:"mac:<address>",description:e.jsxs("span",{children:["Instances with the MAC address ",e.jsx("code",{children:"<address>"})]})},{term:"id:<instance_id>",description:e.jsxs("span",{children:["Instance with the id ",e.jsx("code",{children:"<instance_id>"})]})},{term:"access-group:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," access group"]})},{term:"search:<name>",description:e.jsxs("span",{children:["Instances meeting the terms of the ",e.jsx("code",{children:"<name>"})," saved search"]})},{term:"upgrade-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," upgrade profile"]})},{term:"removal-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," removal profile"]})},{term:"tag:<keyword>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<keyword>"})," tag"]})},{term:"hostname:<keyword>",description:e.jsxs("span",{children:["Instance with the hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"title:<keyword>",description:e.jsxs("span",{children:["Instance with the title ",e.jsx("code",{children:"<keyword>"})]})},{term:"license-id:<license_id>",description:e.jsxs("span",{children:["Search for instances licensed to the specified"," ",e.jsx("code",{children:"<license_id>"})]})},{term:"needs:license OR license-id:none",description:"Search for instances that do not have a Landscape license, and, as a result, are not managed"},{term:"annotation:<key>",description:e.jsxs("span",{children:["Search for instances which define the specified annotation key. Optionally specify ",e.jsx("code",{children:"annotation:<key>:<string>"})," ","which will only return instances whose key matches and value also contains the ",e.jsx("code",{children:"<string>"})," specified"]})},{term:"profile:<type>:<profile_id>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances associated with the profile of type"," ",e.jsx("code",{children:"<type>"})," with the id"," ",e.jsx("code",{children:"<profile_id>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be"," ",t.map((a,i)=>e.jsxs(e.Fragment,{children:[e.jsx("code",{children:a},a),i<t.length-1&&", "]}))]})]})}];return s("usg-profiles")&&r.push({term:"profile:security:<profile_id>:<last_audit_result>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances associated with the security profile with the id"," ",e.jsx("code",{children:"<profile_id>"})," with a last security audit result of"," ",e.jsx("code",{children:"<last_audit_result>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<last_audit_result>"})," can be ",e.jsx("code",{children:"pass"}),","," ",e.jsx("code",{children:"fail"}),", ",e.jsx("code",{children:"in-progress"})]})]})}),s("wsl-child-instance-profiles")&&r.push({term:"profile:wsl:<profile_id>:<compliance_status>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances associated with the WSL child instance profile with the id"," ",e.jsx("code",{children:"<profile_id>"})," with a compliance state of"," ",e.jsx("code",{children:"<compliance_status>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<compliance_status>"})," can be ",e.jsx("code",{children:"compliant"}),", ",e.jsx("code",{children:"noncompliant"})]})]})}),r},as=({columnFilterOptions:s})=>{const t=ns(),[r,a]=u.useState(!1),{getAccessGroupQuery:i}=me(),{tags:c}=pe(),n=c.map(p=>({label:p,value:p}))??[],{availabilityZones:d}=xe(),l=d.reduce((p,S)=>(p.push({label:S,value:S}),p),[{label:"Without zones",value:"none",group:"1"}]),{data:o}=i(),x=o?.data.map(({name:p,title:S})=>({value:p,label:S}))??[],y=C.status.options,b=C.os.options,I=C.wsl.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:T.top,children:[e.jsx("div",{className:T.searchContainer,children:e.jsx(We,{onHelpButtonClick:()=>{a(!0)}})}),e.jsx(we,{collapseFrom:"xxl",filters:[e.jsx(ee,{pageParamKey:"status",label:"Status",options:y},"status"),e.jsx(Je,{label:"OS",options:b},"os"),e.jsx(Ue,{label:"Availability zones",options:l},"availability-zone"),e.jsx(Ve,{label:"Access groups",options:x},"access-group"),e.jsx(Xe,{label:"Tags",options:n},"tag"),e.jsx(Ye,{label:"WSL",options:I},"wsl"),e.jsx("span",{className:T.divider},"divider-2"),e.jsx(Fe,{label:"Columns",options:s},"column")]})]}),e.jsx(se,{filtersToDisplay:["accessGroups","os","availabilityZones","status","tags","query","wsl"],accessGroupOptions:x,availabilityZonesOptions:l,osOptions:b,statusOptions:y,tagOptions:n,wslOptions:I}),e.jsx(te,{open:r,data:t,onClose:()=>{a(!1)}}),e.jsx(ne,{})]})},rs=u.memo(function({instanceCount:t,instances:r,isGettingInstances:a,selectedInstances:i,setSelectedInstances:c}){const[n,d]=u.useState([]),l=u.useCallback(()=>{c([])},[]);return e.jsxs(e.Fragment,{children:[e.jsx(as,{columnFilterOptions:n}),a?e.jsx(z,{}):e.jsx(ae,{instances:r,selectedInstances:i,setColumnFilterOptions:d,setSelectedInstances:c}),e.jsx(re,{totalItems:t,handleClearSelection:l,currentItemCount:r.length})]})}),q=(s,t)=>s.type==="select"?s.options.find(r=>r.value===t)?.query??"":"",cs=({accessGroups:s,availabilityZones:t,os:r,query:a,status:i,tags:c})=>{const n=[];return r&&n.push(q(C.os,r)),i&&n.push(q(C.status,i)),a&&n.push(...a.split(",")),c.length&&n.push(`tag:${c.join(" OR tag:")}`),s.length&&n.push(`access-group:${s.join(" OR access-group:")}`),t.length&&n.push(t.includes("none")?"availability-zone:null":`availability-zone:${t.join(" OR availability-zone:")}`),n.join(" ")},ps=()=>{const{currentPage:s,pageSize:t,wsl:r,...a}=f(),{instances:i,instancesCount:c,isGettingInstances:n,isErrorInstances:d}=he({query:cs(a),archived_only:a.status==="archived",with_alerts:!0,with_upgrades:ce,limit:t,offset:(s-1)*t,wsl_children:r.includes("child"),wsl_parents:r.includes("parent")}),{selectedItems:l,setSelectedItems:o}=ue(i,n||d);return e.jsxs(oe,{children:[e.jsx(le,{title:"Instances",actions:[e.jsx(ie,{isGettingInstances:n,selectedInstances:l},"actions")],sticky:!0}),e.jsx(de,{children:e.jsx(rs,{instanceCount:c,instances:i,isGettingInstances:n,selectedInstances:l,setSelectedInstances:o})})]})};export{ps as default};
