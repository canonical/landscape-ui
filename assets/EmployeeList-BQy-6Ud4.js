const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-lsYx5SX7.js","assets/index-BSTk3ARV.js","assets/index-CeZ3lspp.css","assets/InstanceRemoveFromLandscapeModal-Dmdr7Vcd.js","assets/useRemoveInstancesFromLandscape-BTBGv1cK.js","assets/index-DJG_wlh-.css"])))=>i.map(i=>d[i]);
import{b,e as y,f as T,q as j,p as C,j as t,d as m,s as F,n as w,a4 as g,au as _,i as p,v as L,a2 as E,k as A,ak as z,aF as v,L as x,N as f,av as P}from"./index-BSTk3ARV.js";const I=e=>e.is_active?"Active":"Inactive",D=()=>{const e=b(),a=y(),{mutateAsync:s,isPending:o}=T({mutationKey:["employee","patch"],mutationFn:async({id:u,...d})=>e.patch(`employees/${u}`,d),onSuccess:async()=>a.invalidateQueries({queryKey:["employee"]})});return{patchEmployee:s,isPending:o}},S=()=>{const e=b(),a=y(),{mutateAsync:s,isPending:o}=T({mutationKey:["employee","patch"],mutationFn:async({id:u,...d})=>e.post(`employees/${u}/offboard`,d),onSuccess:async()=>a.invalidateQueries({queryKey:["employee"]})});return{deactivateEmployee:s,isDeactivating:o}},M=({employee:e,handleClose:a})=>{const{notify:s}=j(),o=C(),{patchEmployee:u,isPending:d}=D(),i=async()=>{try{await u({id:e.id,is_active:!0}),s.success({title:`You have successfully activated ${e.name}`,message:`${e.name} will be able to log in to Landscape and register new instances with their account.`}),a()}catch(c){o(c)}};return t.jsx(m.ConfirmationModal,{confirmButtonLabel:"Activate",onConfirm:i,confirmButtonAppearance:"positive",title:`Activate ${e.name}`,close:a,confirmButtonDisabled:d,confirmButtonLoading:d,children:t.jsxs("p",{children:["This will allow ",e.name," to log in to Landscape and register new instances with their account."]})})},$="Irreversibly deletes all data on disks of associated instances. Proceed with caution",N="This will remove all instances associated with this employee from Landscape.",k={sanitizationConfirmationText:"",sanitizeInstances:!1,removeFromLandscapeConfirmationText:"",removeFromLandscape:!1},R="_title_qlqd5_1",O="_tooltipPositionElement_qlqd5_5",q="_additionalActionContainer_qlqd5_9",h={title:R,tooltipPositionElement:O,additionalActionContainer:q},B=(e,a)=>a.removeFromLandscape&&a.sanitizeInstances?`Off-board ${e}`:`Deactivate ${e}`,H=e=>e.removeFromLandscape&&e.sanitizeInstances?"Off-board":e.removeFromLandscape?"Deactivate and remove":e.sanitizeInstances?"Deactivate and sanitize":"Deactivate",V=e=>!!(e.sanitizeInstances&&e.sanitizationConfirmationText!=="sanitize instances"||e.removeFromLandscape&&e.removeFromLandscapeConfirmationText!=="remove instances"||e.sanitizeInstances&&e.removeFromLandscape&&e.sanitizationConfirmationText!=="sanitize instances"&&e.removeFromLandscapeConfirmationText!=="remove instances"),Y=(e,a,s)=>a&&s?{notificationTitle:`You have successfully deactivated ${e} and initiated both Sanitization and Removal of their instances`,notificationMessage:"Sanitization and removal of this employee’s instances have been queued. The data will be permanently irrecoverable once complete. To manage the instances again, they will need to be re-registered in Landscape."}:a?{notificationTitle:`You have successfully deactivated ${e} and initiated sanitization of their instances`,notificationMessage:`Sanitization of the ${e}’s instances has been queued in Activities. The data will be permanently irrecoverable once complete.`}:s?{notificationTitle:`You have successfully deactivated ${e} and initiated the Removal of their instances`,notificationMessage:"The removal of this employee’s instances has been queued. This process will delete all stored data. To manage them again, they will need to be re-registered in Landscape."}:{notificationTitle:`You have successfully deactivated ${e}`,notificationMessage:"This employee won’t be able to log in to Landscape or register new instances with their account."},K=({employee:e,handleClose:a})=>{const{notify:s}=j(),o=C(),{deactivateEmployee:u,isDeactivating:d}=S(),i=F({initialValues:k,enableReinitialize:!0,onSubmit:async c=>{if(!(c.sanitizeInstances&&c.sanitizationConfirmationText!=="sanitize instances"||c.removeFromLandscape&&c.removeFromLandscapeConfirmationText!=="remove instances"))try{await u({id:e.id,remove_instances:i.values.removeFromLandscape,sanitize_instances:i.values.sanitizeInstances}),i.resetForm(),a();const{notificationMessage:n,notificationTitle:r}=Y(e.name,i.values.sanitizeInstances,i.values.removeFromLandscape);s.success({title:r,message:n})}catch(n){o(n)}}});return t.jsx(m.ConfirmationModal,{title:B(e.name,i.values),confirmButtonLabel:H(i.values),confirmButtonProps:{type:"submit"},onConfirm:()=>{i.handleSubmit()},close:a,confirmButtonDisabled:V(i.values)||d,confirmButtonLoading:d,children:t.jsxs(m.Form,{noValidate:!0,onSubmit:c=>{c.preventDefault(),i.handleSubmit()},children:[t.jsxs("p",{children:["This will prevent ",e.name," from logging in to Landscape and from registering any new instances with their account"]}),t.jsx("b",{children:"Additional actions"}),t.jsxs("div",{children:[t.jsx(m.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:h.title,children:"Sanitize associated instances"}),t.jsxs(m.Tooltip,{position:"top-center",message:$,positionElementClassName:h.tooltipPositionElement,children:[t.jsx(m.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...i.getFieldProps("sanitizeInstances"),onChange:async c=>{i.getFieldProps("sanitizeInstances").onChange(c),await i.setFieldValue("sanitizationConfirmationText","")}}),i.values.sanitizeInstances&&t.jsxs("div",{className:h.additionalActionContainer,children:[t.jsx("p",{children:"Sanitization will permanently delete the encryption keys for associated instances, making its data completely irrecoverable. This action cannot be undone. Please confirm you wish to proceed."}),t.jsx(m.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"sanitize instances"})," to confirm"]}),"aria-label":"Sanitization confirmation text",placeholder:"sanitize instances",autoComplete:"off",type:"text",...i.getFieldProps("sanitizationConfirmationText")},"sanitizationConfirmationText")]}),t.jsx(m.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:h.title,children:"Remove associated instances from Landscape"}),t.jsxs(m.Tooltip,{position:"top-center",message:N,positionElementClassName:h.tooltipPositionElement,children:[t.jsx(m.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...i.getFieldProps("removeFromLandscape"),onChange:async c=>{i.getFieldProps("removeFromLandscape").onChange(c),await i.setFieldValue("removeFromLandscapeConfirmationText","")}}),i.values.removeFromLandscape&&t.jsxs("div",{className:h.additionalActionContainer,children:[t.jsx("p",{children:"This will remove all associated instances from Landscape, along with their stored data. To manage them again, you would need to re-register them in Landscape."}),t.jsx(m.Input,{label:t.jsxs("span",{children:["Type ",t.jsx("b",{children:"remove instances"})," to confirm."]}),placeholder:"remove instances",autoComplete:"off","aria-label":"Remove from Landscape confirmation text",type:"text",...i.getFieldProps("removeFromLandscapeConfirmationText")},"removeFromLandscapeConfirmationText")]})]})]})})},Q=p.lazy(async()=>E(()=>import("./index-lsYx5SX7.js"),__vite__mapDeps([0,1,2,3,4,5]))),G=({employee:e})=>{const{setSidePanelContent:a}=w(),{value:s,setTrue:o,setFalse:u}=g(),{value:d,setTrue:i,setFalse:c}=g(),n=()=>{a("Employee details",t.jsx(p.Suspense,{fallback:t.jsx(L,{}),children:t.jsx(Q,{employee:e})}),"medium")},r=[{icon:"show",label:"View details","aria-label":`View ${e.name} employee details`,onClick:n}],l=[];return e.is_active?l.push({icon:"pause",label:"Deactivate","aria-label":`Deactivate ${e.name}`,onClick:i}):r.push({icon:"play",label:"Activate","aria-label":`Activate ${e.name}`,onClick:o}),t.jsxs(t.Fragment,{children:[t.jsx(_,{toggleAriaLabel:`${e.name} actions`,actions:r,destructiveActions:l}),s&&t.jsx(M,{employee:e,handleClose:u}),d&&t.jsx(K,{employee:e,handleClose:c})]})},U="_autoinstallFileHeaderTitle_fd2dm_1",W={autoinstallFileHeaderTitle:U},Z=e=>({index:a})=>{const s={};return(e?.column==="computers"||e?.column==="groups")&&e.row===a&&(s.className="expandedRow"),s},J=e=>({column:a,row:{index:s}})=>{const o={};return a.id==="computers"?(o["aria-label"]="Associated instances",e?.column===a.id&&e.row===s&&(o.className="expandedCell")):a.id==="groups"?(o["aria-label"]="Employee group",e?.column===a.id&&e.row===s&&(o.className="expandedCell")):a.id==="name"?o.role="rowheader":a.id==="email"?o["aria-label"]="Email":a.id==="status"?o["aria-label"]="Status":a.id==="autoinstall_file"?o["aria-label"]="Assigned autoinstall file":a.id==="actions"&&(o["aria-label"]="Actions"),o},X=e=>a=>{a&&(e.current=[...a.querySelectorAll("tbody tr")])},ee=p.lazy(async()=>E(()=>import("./index-lsYx5SX7.js"),__vite__mapDeps([0,1,2,3,4,5]))),ae=({employees:e})=>{const{setSidePanelContent:a}=w(),[s,o]=p.useState(null),u=p.useRef([]);A(s?.column==="computers"||s?.column==="groups"?{current:u.current[s.row]}:[],n=>{n.target instanceof Element&&!n.target.closest("truncatedItem")&&o(null)});const d=(n,r)=>{o(l=>l?.column===n&&l.row===r?null:{column:n,row:l&&["computers","groups"].includes(l.column)&&l.row<r?r-1:r})},i=n=>{a("Employee details",t.jsx(p.Suspense,{fallback:t.jsx(L,{}),children:t.jsx(ee,{employee:n})}),"medium")},c=p.useMemo(()=>[{accessor:"name",Header:"name",Cell:({row:{original:n}})=>t.jsx(m.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{i(n)},"aria-label":`Show details of user ${n.name}`,children:n.name})},{accessor:"email",Header:"email"},{accessor:"groups",Header:"employee group",Cell:({row:{original:n,index:r}})=>n.groups&&n.groups.length>0?t.jsx(v,{content:n.groups.map(l=>t.jsx(x,{to:`/settings/employees?tab=employee-groups&search=${l.name}`,className:"truncatedItem",children:l.name},l.group_id)),isExpanded:s?.column==="groups"&&s.row===r,onExpand:()=>{d("groups",r)}}):t.jsx(f,{})},{accessor:"autoinstall_file",Header:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:W.autoinstallFileHeaderTitle,children:"assigned autoinstall file"}),t.jsx(m.Tooltip,{message:"This configuration file is assigned based on the highest-priority group the user belongs to.",children:t.jsx(m.Icon,{name:"help"})})]}),Cell:({row:{original:n}})=>n.autoinstall_file?.filename?t.jsx("span",{children:n.autoinstall_file?.filename}):t.jsx(f,{})},{accessor:"status",Header:"status",Cell:({row:{original:n}})=>t.jsx("span",{children:I(n)}),getCellIcon:({row:{original:{is_active:n}}})=>n?"status-succeeded-small":"status-failed-small"},{accessor:"computers",Header:"associated instances",Cell:({row:{original:n,index:r}})=>n.computers&&n.computers.length>0?t.jsx(v,{content:n.computers?.map(l=>t.jsx(x,{className:"truncatedItem",to:`/instances/${l.id}`,children:l.title},l.id)),isExpanded:s?.column==="computers"&&s.row===r,onExpand:()=>{d("computers",r)}}):t.jsx(f,{})},{...z,Cell:({row:{original:n}})=>t.jsx(G,{employee:n})}],[e,s]);return t.jsx("div",{ref:X(u),children:t.jsx(P,{columns:c,data:e,getCellProps:J(s),getRowProps:Z(s),emptyMsg:"No employees found according to your search parameters.",minWidth:1200})})};export{M as A,K as D,ae as E,I as g};
