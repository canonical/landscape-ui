import{e as F,h as y,j as e,A as f,C as B,F as k,H as U,m as d,l as L,n as w}from"./index-2fzpjuii.js";import{S as D}from"./SidePanelFormButtons-DAl7F5tV.js";import"./SidePanelFormButtons.module-D2P5PizG.js";function _(){const n=F();return{getCsvComplianceData:(t={},s={})=>y({queryKey:["csvComplianceData",t],queryFn:async()=>n.get("GetCSVComplianceData",{params:t}),...s}),getInstancesNotUpgraded:(t={},s={})=>y({queryKey:["instancesNotUpgraded",t],queryFn:async()=>n.get("GetComputersNotUpgraded",{params:t}),...s}),getNotPingingInstances:(t,s={})=>y({queryKey:["notPingingInstances",t],queryFn:async()=>n.get("GetNotPingingComputers",{params:t}),...s}),getUsnTimeToFix:(t={},s={})=>y({queryKey:["usnTimeToFix",t],queryFn:async()=>n.get("GetUSNTimeToFix",{params:t}),...s}),getUpgradedInstancesByFrequency:(t={},s={})=>y({queryKey:["upgradedInstancesByFrequency",t],queryFn:async()=>n.get("GetUpgradedComputersByFrequency",{params:t}),...s})}}const O="_header_1kqll_1",V="_lineContainer_1kqll_8",G="_line_1kqll_8",$={header:O,lineContainer:V,line:G},C=({currentCount:n,negativeDescription:l,positiveDescription:i,title:o,totalCount:c})=>{const r=(100*n/c).toFixed();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:$.header,children:[e.jsx("span",{children:o}),e.jsx("span",{children:`${r}%`})]}),e.jsx("div",{className:$.lineContainer,children:e.jsx("div",{className:$.line,style:{width:`${r}%`}})}),e.jsx("p",{className:"u-text--muted p-text--small",children:i}),e.jsx("p",{className:"u-text--muted p-text--small u-no-margin--bottom",children:l})]})},K="_rowContainer_q14my_7",z="_row_q14my_7",x={rowContainer:K,row:z},E="_rangeContainer_1omsg_1",W={rangeContainer:E},P=(n,l)=>{const i=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(i),c=document.createElement("a");c.href=o,c.download=l,document.body.appendChild(c),c.click(),document.body.removeChild(c)},A=({instanceIds:n})=>{const{getCsvComplianceData:l}=_(),{data:i}=l({query:`id:${n.join(" OR id:")}`}),o=f({initialValues:{range:0,reportByCve:!0},validationSchema:B({range:U().required("This field is required"),reportByCve:k()}),onSubmit:()=>P((i==null?void 0:i.data)||"","report.csv")});return e.jsxs(d.Form,{onSubmit:o.handleSubmit,noValidate:!0,children:[e.jsx(d.CheckboxInput,{label:"Report by CVE",inline:!0,...o.getFieldProps("reportByCve"),checked:o.values.reportByCve}),e.jsxs("div",{className:W.rangeContainer,children:[e.jsx(d.Input,{type:"number",label:"Range",className:"u-no-margin--bottom",style:{maxWidth:"min-content"},...o.getFieldProps("range"),error:o.touched.range&&o.errors.range?o.errors.range:void 0}),e.jsx("span",{children:"Days"})]}),e.jsx(D,{submitButtonDisabled:!1,submitButtonText:"Download"})]})},M=({instanceIds:n})=>{const{setSidePanelContent:l}=L(),{getNotPingingInstances:i,getInstancesNotUpgraded:o,getUsnTimeToFix:c}=_(),{data:r,isLoading:t}=i({since_minutes:5,query:`id:${n.join(" OR id:")}`}),s=r?n.length-r.data.length:0,{data:g,isLoading:q}=o({query:`id:${n.join(" OR id:")}`}),v=g?n.length-g.data.length:0,{data:a,isLoading:N}=c({query:`id:${n.join(" OR id:")}`,fixed_in_days:[2,14,30,60]}),p={month:(a==null?void 0:a.data[30].length)||0,old:(a==null?void 0:a.data[60].length)||0,pending:(a==null?void 0:a.data.pending.length)||0,recent:(a==null?void 0:a.data[2].length)||0,twoWeeks:(a==null?void 0:a.data[14].length)||0},j={recent:2,twoWeeks:14,month:30,old:60},b=(h,m)=>{const u=m==="positive"?p[h]:n.length-p[h];return u!==1?`${u||"No"} instances have${m==="negative"?" not":""} applied USNs in ${j[h]} days or less.`:`1 instance has${m==="negative"?" not":""} applied USNs in ${j[h]} days or less.`},S=()=>{l("Download report as CSV",e.jsx(A,{instanceIds:n}))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:x.rowContainer,children:e.jsxs(d.Row,{className:w("u-no-padding--left u-no-padding--right",x.row),children:[e.jsx(d.Col,{size:6,children:!N&&e.jsx(C,{currentCount:n.length-p.pending,negativeDescription:`${p.pending||"No"} instance${p.pending!==1?"s are":" is"} not yet patched.`,positiveDescription:`${n.length-p.pending||"No"} instance${n.length-p.pending!==1?"s are":" is"} securely patched.`,title:"Securely patched",totalCount:n.length})}),e.jsx(d.Col,{size:6,children:!q&&e.jsx(C,{currentCount:v,negativeDescription:`${(g==null?void 0:g.data.length)||"No"} instance${(g==null?void 0:g.data.length)!==1?"s are":" is"} not covered by upgrade profiles.`,positiveDescription:`${v||"No"} instance${v!==1?"s are":" is"} covered by upgrade profiles.`,title:"Upgrade profiles",totalCount:n.length})}),e.jsx(d.Col,{size:6,children:!t&&e.jsx(C,{currentCount:s,negativeDescription:`${(r==null?void 0:r.data.length)||"No"} instance${(r==null?void 0:r.data.length)!==1?"s have":" has"} not contacted the server within the last 5 minutes.`,positiveDescription:`${s||"No"} instance${s!==1?"s have":" has"} contacted the server within the last 5 minutes.`,title:"Contacted",totalCount:n.length})})]})}),!N&&e.jsxs("div",{className:x.rowContainer,children:[e.jsx("h4",{children:"Security upgrades"}),e.jsx(d.Row,{className:w("u-no-padding--left u-no-padding--right",x.row),children:Object.entries(j).map(([h,m])=>{const u=h;return e.jsx(d.Col,{size:6,children:e.jsx(C,{currentCount:p[u],negativeDescription:b(u,"negative"),positiveDescription:b(u,"positive"),title:`${m} days`,totalCount:n.length})},u)})})]}),e.jsx(D,{submitButtonDisabled:!1,submitButtonText:"Download as CSV",onSubmit:S})]})};export{M as default};
