import{f as F,t as P,v as U,r as L,y as q,z as D,x as N,B as R,k as Q,h as V,j as t,d as r,w as o}from"./index-CNSDWj8Q.js";import{S as $}from"./SidePanelFormButtons-DIizKTix.js";import{u as E}from"./index-D-YBZSy_.js";import{u as I}from"./useGetInstances-rIFBd_bT.js";import{c as M}from"./InstancesPageActions-DL7_pmR1.js";import{g as _}from"./formikErrors-Bw8iTXYS.js";import"./index-CySvbr4l.js";function O(){const d=F(),e=P(),h=U({mutationKey:["token","attach"],mutationFn:async c=>d.post("attach-token",c),onSuccess:async()=>e.invalidateQueries({queryKey:["instances"]})}),{mutateAsync:m,isPending:n}=h;return{attachToken:m,isAttachingToken:n}}const Z=({children:d,selectedInstances:e,submitButtonText:h,notification:m})=>{const[n,c]=L.useState([]),k=q(),{notify:f}=D(),{closeSidePanel:b}=N(),{openActivityDetails:j}=E(),{attachToken:v,isAttachingToken:y}=O(),T=`${e.map(i=>`id:${i.id}`).join(" OR ")} has-pro-management:false`,{refetchInstances:w}=I({query:T,limit:e.length},{listenToUrlParams:!1},{enabled:!1}),x=async i=>{if(e.length===0){f.info({title:"No instances to attach",message:"No valid instances were selected for token attachment."});return}try{const{data:{activity:a}}=await v({computer_ids:e.map(({id:u})=>u),token:i});b(),f.success({...m,actions:[{label:"View details",onClick:()=>{j(a)}}]})}catch(a){k(a)}},A=async i=>{try{const{data:a}=await w(),u=a?.data?.results??[];c(u.map(S=>S.id)),u.length===0&&await x(i.token)}catch(a){k(a)}},B=e.filter(i=>!n.includes(i.id)),{withToken:l,withoutToken:p}=M(B),s=R({initialValues:{token:""},validationSchema:Q({token:V().required("Token is required")}),onSubmit:A}),C=async()=>{await x(s.values.token)},g=()=>{c([])};return t.jsxs(t.Fragment,{children:[t.jsxs(r.Form,{noValidate:!0,onSubmit:s.handleSubmit,children:[t.jsxs("div",{children:[d,t.jsx(r.Input,{label:"Token",type:"text",placeholder:"Your token",required:!0,...s.getFieldProps("token"),error:_(s,"token")})]}),t.jsx($,{submitButtonText:h,submitButtonDisabled:!s.isValid||!s.dirty,submitButtonLoading:s.isSubmitting||y,onCancel:b})]}),!!n.length&&(n.length===e.length?t.jsx(r.Modal,{title:`Token attachment unavailable for the selected ${o(e.length,"instance","instances")}`,close:g,buttonRow:t.jsx(r.Button,{type:"button",className:"u-no-margin--bottom",onClick:g,children:"Close"}),children:t.jsxs("p",{children:["Your Ubuntu Pro token can't be attached to the selected"," ",o(e.length,"instance")," because"," ",o(e.length,"it doesn't","they don't")," ","support this feature. This could be because the Landscape Client is out of date."]})}):t.jsxs(r.ConfirmationModal,{title:"Attach Ubuntu Pro token",confirmButtonLabel:"Confirm",confirmButtonAppearance:"positive",confirmButtonLoading:y,onConfirm:C,close:g,children:[t.jsx("p",{className:"u-no-margin--bottom",children:"Confirming this action means:"}),t.jsxs("ul",{children:[p>0&&t.jsxs("li",{children:[t.jsx("strong",{children:p})," ",o(p,"instance")," will be attached to this token"]}),l>0&&t.jsxs("li",{children:[t.jsx("strong",{children:l})," ",o(l,"instance")," will override"," ",o(l,"its","their")," existing token"]}),t.jsxs("li",{children:[t.jsx("strong",{children:n.length})," ",o(n.length,"instance")," will be skipped as"," ",o(n.length,"it does","they do")," not support Ubuntu Pro management"]})]})]}))]})},tt="https://ubuntu.com/pro/dashboard";export{Z as T,tt as U};
