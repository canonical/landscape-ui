import{f as F,v as P,w as U,r as L,z as q,B as D,y as N,C as R,p as Q,i as V,j as t,d as r,x as i}from"./index-DYykpNVa.js";import{S as $}from"./SidePanelFormButtons-Aj5ThB2m.js";import{u as E}from"./index-C2TKYmcI.js";import{u as I}from"./useGetInstances-CQaSwVqm.js";import{d as M}from"./InstancesPageActions-nbDXpXLr.js";import"./index-Cbj0Sz5k.js";import{g as _}from"./formikErrors-Bw8iTXYS.js";function O(){const d=F(),e=P(),h=U({mutationKey:["token","attach"],mutationFn:async c=>d.post("attach-token",c),onSuccess:async()=>e.invalidateQueries({queryKey:["instances"]})}),{mutateAsync:m,isPending:n}=h;return{attachToken:m,isAttachingToken:n}}const Z=({children:d,selectedInstances:e,submitButtonText:h,notification:m})=>{const[n,c]=L.useState([]),k=q(),{notify:f}=D(),{closeSidePanel:b}=N(),{openActivityDetails:j}=E(),{attachToken:v,isAttachingToken:y}=O(),T=`${e.map(s=>`id:${s.id}`).join(" OR ")} has-pro-management:false`,{refetchInstances:w}=I({query:T,limit:e.length},{listenToUrlParams:!1},{enabled:!1}),x=async s=>{if(e.length===0){f.info({title:"No instances to attach",message:"No valid instances were selected for token attachment."});return}try{const{data:{activity:a}}=await v({computer_ids:e.map(({id:u})=>u),token:s});b(),f.success({...m,actions:[{label:"View details",onClick:()=>{j(a)}}]})}catch(a){k(a)}},C=async s=>{try{const{data:a}=await w(),u=a?.data?.results??[];c(u.map(S=>S.id)),u.length===0&&await x(s.token)}catch(a){k(a)}},A=e.filter(s=>!n.includes(s.id)),{withToken:l,withoutToken:p}=M(A),o=R({initialValues:{token:""},validationSchema:Q({token:V().required("Token is required")}),onSubmit:C}),B=async()=>{await x(o.values.token)},g=()=>{c([])};return t.jsxs(t.Fragment,{children:[t.jsxs(r.Form,{noValidate:!0,onSubmit:o.handleSubmit,children:[t.jsxs("div",{children:[d,t.jsx(r.Input,{label:"Token",type:"text",placeholder:"Your token",required:!0,...o.getFieldProps("token"),error:_(o,"token")})]}),t.jsx($,{submitButtonText:h,submitButtonDisabled:!o.isValid||!o.dirty,submitButtonLoading:o.isSubmitting||y,onCancel:b})]}),!!n.length&&(n.length===e.length?t.jsx(r.Modal,{title:`Token attachment unavailable for the selected ${i(e.length,"instance","instances")}`,close:g,buttonRow:t.jsx(r.Button,{type:"button",className:"u-no-margin--bottom",onClick:g,children:"Close"}),children:t.jsxs("p",{children:["Your Ubuntu Pro token can't be attached to the selected"," ",i(e.length,"instance")," because"," ",i(e.length,"it doesn't","they don't")," ","support this feature. This could be because the Landscape Client is out of date."]})}):t.jsxs(r.ConfirmationModal,{title:"Attach Ubuntu Pro token",confirmButtonLabel:"Confirm",confirmButtonAppearance:"positive",confirmButtonLoading:y,onConfirm:B,close:g,children:[t.jsx("p",{className:"u-no-margin--bottom",children:"Confirming this action means:"}),t.jsxs("ul",{children:[p>0&&t.jsxs("li",{children:[t.jsx("strong",{children:p})," ",i(p,"instance")," will be attached to this token"]}),l>0&&t.jsxs("li",{children:[t.jsx("strong",{children:l})," ",i(l,"instance")," will override"," ",i(l,"its","their")," existing token"]}),t.jsxs("li",{children:[t.jsx("strong",{children:n.length})," ",i(n.length,"instance")," will be skipped as"," ",i(n.length,"it does","they do")," not support Ubuntu Pro management"]})]})]}))]})},tt="https://ubuntu.com/pro/dashboard";export{Z as T,tt as U};
