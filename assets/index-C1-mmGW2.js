import{p as q,q as U,n as $,a5 as k,j as t,w as b,d as o,I as a,a6 as F,a7 as x,B as v,D as p}from"./index-DZF0LgVk.js";import{u as G}from"./useGetInstance-BRGFM1of.js";const O="_statusIcon_285mx_1",V="_output_285mx_5",_={statusIcon:O,output:V},J=({activityId:j})=>{const c=q(),{notify:r}=U(),{closeSidePanel:l}=$(),{approveActivitiesQuery:I,cancelActivitiesQuery:B,getSingleActivityQuery:C,redoActivitiesQuery:L,undoActivitiesQuery:w}=k(),{mutateAsync:S,isPending:u}=I,{mutateAsync:P,isPending:d}=B,{mutateAsync:D,isPending:m}=L,{mutateAsync:N,isPending:y}=w,{data:f,isPending:T,error:g}=C({activityId:j}),h=f?.data.computer_id,A=h!==void 0,{instance:s,isGettingInstance:Q}=G({instanceId:h},{enabled:A});if(T)return t.jsx(b,{});if(g)throw g;if(A&&Q)return t.jsx(b,{});const R=async i=>{try{await S({query:`id:${i.id}`}),l(),r.success({title:"You have successfully approved an activity.",message:"This activity will be delivered the next time the Landscape server connects with the client."})}catch(n){c(n)}},E=async i=>{try{await P({query:`id:${i.id}`}),l(),r.success({title:"You have successfully canceled an activity.",message:"This activity won't be delivered to the client and will not run."})}catch(n){c(n)}},M=async i=>{try{await D({activity_ids:[i.id]}),l(),r.success({title:"You have successfully redone an activity.",message:"An activity has been queued to re-run this activity."})}catch(n){c(n)}},Y=async i=>{try{await N({activity_ids:[i.id]}),l(),r.success({title:"You have successfully undone an activity.",message:"An activity has been queued to revert the changes delivered by this activity."})}catch(n){c(n)}},e=f.data;return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[e.actions?.approvable&&t.jsx(o.ConfirmationButton,{className:"p-segmented-control__button u-no-margin",type:"button",disabled:u,confirmationModalProps:{title:"Approve activity",children:t.jsxs("p",{children:["Are you sure you want to approve ",e.summary," ","activity?"]}),confirmButtonLabel:"Approve",confirmButtonAppearance:"positive",confirmButtonDisabled:u,confirmButtonLoading:u,onConfirm:async()=>R(e)},children:"Approve"}),e.actions?.cancelable&&t.jsx(o.ConfirmationButton,{className:"p-segmented-control__button u-no-margin",type:"button",disabled:d,confirmationModalProps:{title:"Cancel activity",children:t.jsxs("p",{children:["Are you sure you want to cancel ",e.summary," activity?"]}),confirmButtonLabel:"Apply",confirmButtonAppearance:"positive",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:async()=>E(e)},children:!e.actions?.approvable&&!e.actions?.reappliable&&!e.actions?.revertable?"Cancel activity":"Cancel"}),e.actions?.revertable&&t.jsx(o.ConfirmationButton,{className:"p-segmented-control__button u-no-margin",type:"button",disabled:y,confirmationModalProps:{title:"Undo activity",children:t.jsxs("p",{children:["Are you sure you want to undo ",e.summary," activity?"]}),confirmButtonLabel:"Undo",confirmButtonAppearance:"positive",confirmButtonDisabled:y,confirmButtonLoading:y,onConfirm:async()=>Y(e)},children:"Undo"}),e.actions?.reappliable&&t.jsx(o.ConfirmationButton,{className:"p-segmented-control__button u-no-margin",type:"button",disabled:m,confirmationModalProps:{title:"Redo activity",children:t.jsxs("p",{children:["Are you sure you want to redo ",e.summary," activity?"]}),confirmButtonLabel:"Redo",confirmButtonAppearance:"positive",confirmButtonDisabled:m,confirmButtonLoading:m,onConfirm:async()=>M(e)},children:"Redo"})]})},"buttons"),t.jsxs(a,{spaced:!0,children:[t.jsx(a.Item,{label:"Description",large:!0,value:e.summary}),s&&t.jsx(a.Item,{label:"Instance",large:!0,value:t.jsx(F,{to:`/instances/${s.parent?`${s.parent.id}/${s.id}`:s.id}`,children:s.title})}),t.jsx(a.Item,{label:"Status",value:t.jsxs(t.Fragment,{children:[t.jsx(o.Icon,{name:x[e.activity_status].icon,className:_.statusIcon}),t.jsx("span",{children:x[e.activity_status].label})]})}),t.jsx(a.Item,{label:"Created at",value:v(e.creation_time).format(p)}),typeof e.delivery_time=="string"&&t.jsx(a.Item,{label:"Delivered at",value:v(e.delivery_time).format(p)}),e.completion_time!==null&&t.jsx(a.Item,{label:"Completed at",value:v(e.completion_time).format(p)})]}),e.result_text&&t.jsx(o.CodeSnippet,{className:_.output,blocks:[{title:"Output",code:e.result_text}]})]})};export{J as default};
