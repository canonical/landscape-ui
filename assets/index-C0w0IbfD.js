import{j as e,r as x,k as P,e as w,g as D,h as j,o as H,l as K,f as R}from"./index-DXs1haZl.js";import{S as V}from"./SidePanelFormButtons-Dtg_vQ52.js";import{a as A}from"./useUsns-B3b7Nlk8.js";import{u as Y,D as M}from"./downshift.esm-CJYgPAQU.js";import{u as z}from"./index-BU3-Vm4G.js";import"./SidePanelFormButtons.module-DyBJG5lm.js";import"./useFetchOld-DWTVWZGf.js";import"./useMutation-CoMMCR6r.js";import"./useQuery-DPA9mHwu.js";import"./moment-BF0UQeMK.js";import"./TablePagination.module-DLVph1Z1.js";import"./TablePagination-DZ07rvb4.js";import"./usePageParams-BJqFm8Ol.js";import"./EmptyState-BYL1pVz2.js";import"./SearchHelpPopup-CCs3NejY.js";import"./useConfirm-C9Ai5vPv.js";import"./NoData-BmTO_w1O.js";const G=200,J=(s,l)=>{const a=s.toLowerCase(),c=l.toLowerCase(),n=a.indexOf(c);return n>=0?e.jsxs(e.Fragment,{children:[s.substring(0,n),e.jsx("strong",{children:s.substring(n,n+l.length)}),s.substring(n+l.length)]}):s},W="_container_1d6qb_1",X="_suggestionsContainer_1d6qb_5",Z="_pointer_1d6qb_12",ee="_highlighted_1d6qb_17",te="_selectedContainer_1d6qb_21",g={container:W,suggestionsContainer:X,pointer:Z,highlighted:ee,selectedContainer:te},se=({selectedItems:s,setSelectedItems:l})=>{var I;const[a,c]=x.useState(""),[n,i]=x.useState(!1),[r,m]=x.useState(""),{instanceId:b}=P(),f=w(),{getInstancePackagesQuery:_}=A(),S=Number(b),{data:d,isFetching:o}=_({instance_id:S,available:!0,installed:!1,upgrade:!1,held:!1,limit:50,search:a},{enabled:a.length>2}),p=((I=d==null?void 0:d.data)==null?void 0:I.results)??[],B=t=>!s.map(u=>u.name).includes(t.name),k=p.filter(B),$=t=>{l(s.filter(u=>u.name!==t))},E=()=>{i(!1)},C=()=>{m(""),c("")},N=()=>{r.length>2?i(!0):i(!1)},T=t=>{m(t),t.length>2&&c(t)},q=Y(()=>{try{N()}catch(t){f(t)}},G),F=t=>{l([...s,t]),C()},L=t=>{t&&(F(t),i(!1))},O=t=>{t.key==="Escape"?t.currentTarget.blur():q()},y=!n&&r.length<3?"Min 3. characters":p.length===0&&a&&!o?`No packages found by "${a}"`:null;return e.jsxs("div",{className:g.container,children:[e.jsx(M,{onSelect:L,itemToString:()=>"",isOpen:n,children:({getInputProps:t,getItemProps:u,getMenuProps:Q,highlightedIndex:U})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(D.SearchBox,{...t(),placeholder:"Search for available packages",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:r,onChange:T,onClear:C,onBlur:E,onFocus:N,onKeyUp:O}),y?e.jsx("span",{className:"p-form-help-text",children:y}):null,n&&(k.length>0||o)?e.jsx("ul",{className:j("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",g.suggestionsContainer),...Q(),children:o?e.jsx(H,{}):k.map((h,v)=>e.jsxs("li",{className:j("p-list__item",g.pointer,{[g.highlighted]:U===v}),...u({item:h,index:v}),children:[e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:J(h.name,a)}),e.jsx("div",{children:e.jsx("small",{className:"u-text-muted",children:h.current_version})})]},h.name))}):null]})}),e.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:s.length?s.map(t=>e.jsxs("li",{className:j("p-autocomplete__result p-list__item p-card u-no-margin--bottom",g.selectedContainer),children:[e.jsxs("div",{children:[e.jsx("div",{children:t.name}),e.jsx("span",{children:e.jsx("small",{className:"u-text--muted p-text--small",children:t.current_version})})]}),e.jsx(D.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>$(t.name),children:e.jsx("i",{className:"p-icon--delete"})})]},t.name)):null})]})},ne=()=>{const[s,l]=x.useState([]),{instanceId:a,childInstanceId:c}=P(),n=w(),{notify:i}=K(),{packagesActionQuery:r}=A(),{closeSidePanel:m}=R(),{openActivityDetails:b}=z(),f=Number(c??a),{mutateAsync:_,isLoading:S}=r,d=async()=>{try{const{data:o}=await _({action:"install",computer_ids:[f],package_ids:s.map(({id:p})=>p)});m(),i.success({title:`You queued ${s.length===1?`package ${s[0].name}`:`${s.length} packages`} to be installed.`,message:`${s.length===1?`${s[0].name} package`:`${s.length} selected packages`} will be installed and are queued in Activities.`,actions:[{label:"Details",onClick:()=>b(o)}]})}catch(o){n(o)}};return e.jsxs(e.Fragment,{children:[e.jsx(se,{selectedItems:s,setSelectedItems:o=>l(o)}),e.jsx(V,{submitButtonDisabled:S||s.length===0,submitButtonText:"Install packages",submitButtonAppearance:"positive",onSubmit:d})]})},ke=ne;export{ke as default};
