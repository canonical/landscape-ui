import{d as Z,c as ee,e as F,k as Q,f as C,j as e,g as a,r as j,_ as $,p as se,l as te,h as re,o as P}from"./index-Dt7YhOS0.js";import{E as oe}from"./EmptyState-BG0AupYF.js";import"./TablePagination.module-DLVph1Z1.js";import{T as ne}from"./TablePagination-0eisoSCU.js";import{u as k}from"./useMutation-B0Ge1lYR.js";import{u as I}from"./useQuery-Dlf2yvOE.js";import{u as ae}from"./useConfirm-CR6bT57R.js";import{u as ce}from"./formik.esm-g8btJLb9.js";import{c as ie,a as y,e as ue}from"./index.esm-Cy_yj1Qh.js";import{S as le}from"./SidePanelFormButtons-Cs6mvCpL.js";import{g as de,r as q,U as D,a as me}from"./helpers-BMTj9ldD.js";import{u as T}from"./usePageParams-Du9VpOtH.js";function A(){const o=Z(),n=ee(),c=F(),u=(s,b={})=>I({queryKey:["users",{...s}],queryFn:()=>o.get("users",{params:s}),...b}),l=k({mutationKey:["users","new"],mutationFn:s=>o.post("users",s),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}}),d=k({mutationKey:["users","edit"],mutationFn:s=>o.put("users",s),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}}),h=k({mutationKey:["users","remove"],mutationFn:s=>o.delete("users",{params:s}),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}}),x=k({mutationKey:["users","lock"],mutationFn:s=>o.post("users/lock",s),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}}),m=k({mutationKey:["users","unlock"],mutationFn:s=>o.post("users/unlock",s),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}}),g=(s,b={})=>I({queryKey:["groups",s.computer_id],queryFn:()=>o.get(`computers/${s.computer_id}/groups`),...b}),t=(s,b={})=>I({queryKey:["userGroups",s.computer_id,s.username],queryFn:()=>o.get(`computers/${s.computer_id}/users/${s.username}/groups`),...b}),p=k({mutationKey:["groups","add"],mutationFn:s=>o.post(`computers/${s.computer_id}/usergroups/update_bulk`,s),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}}),r=k({mutationKey:["groups","remove"],mutationFn:s=>o.post(`computers/${s.computer_id}/usergroups/update_bulk`,s),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}});return{getUsersQuery:u,getGroupsQuery:g,getUserGroupsQuery:t,createUserQuery:l,removeUserQuery:h,editUserQuery:d,lockUserQuery:x,unlockUserQuery:m,addUserToGroupQuery:p,removeUserFromGroupQuery:r}}const pe="_headerContainer_j1328_1",he="_searchContainer_j1328_6",L={headerContainer:pe,searchContainer:he},M=()=>{const{instanceId:o}=Q(),n=F(),{closeSidePanel:c}=C(),{createUserQuery:u,getGroupsQuery:l}=A(),d=Number(o),{mutateAsync:h,isLoading:x}=u,{data:m,isLoading:g}=l({computer_id:d}),p=((m==null?void 0:m.data.groups)??[]).map(s=>({label:s.name,value:s.name})),r=ce({initialValues:{name:"",username:"",password:"",confirmPassword:"",requirePasswordReset:!1,location:"",homePhoneNumber:"",workPhoneNumber:"",primaryGroupValue:""},validationSchema:ie().shape({name:y().required("This field is required"),username:y().required("This field is required"),password:y().required("This field is required"),confirmPassword:y().required("This field is required").oneOf([ue("password"),""],"Passwords must match"),location:y(),homePhoneNumber:y(),workPhoneNumber:y(),primaryGroupValue:y().required("This field is required")}),onSubmit:async s=>{try{await h({computer_ids:[d],name:s.name,username:s.username,password:s.password,require_password_reset:s.requirePasswordReset,location:s.location,home_phone:s.homePhoneNumber,work_phone:s.workPhoneNumber,primary_groupname:s.primaryGroupValue}),c()}catch(b){n(b)}}});return e.jsxs(a.Form,{noValidate:!0,onSubmit:r.handleSubmit,name:"add-new-user",children:[e.jsx(a.Input,{type:"text",label:"Username",autoComplete:"new-username",required:!0,error:r.touched.username&&r.errors.username?r.errors.username:void 0,...r.getFieldProps("username")}),e.jsx(a.Input,{type:"text",label:"Name",required:!0,error:r.touched.name&&r.errors.name?r.errors.name:void 0,...r.getFieldProps("name")}),e.jsx(a.Input,{type:"password",label:"Passphrase",autoComplete:"new-password",required:!0,error:r.touched.password&&r.errors.password?r.errors.password:void 0,...r.getFieldProps("password")}),e.jsx(a.Input,{type:"password",label:"Confirm passphrase",autoComplete:"new-password",required:!0,error:r.touched.confirmPassword&&r.errors.confirmPassword?r.errors.confirmPassword:void 0,...r.getFieldProps("confirmPassword")}),e.jsx(a.Input,{type:"checkbox",label:"Require passphrase reset",help:"User must change password at first login",...r.getFieldProps("requirePasswordReset"),checked:r.values.requirePasswordReset}),e.jsx(a.Select,{label:"Primary Group",disabled:g,options:[{label:"Select",value:""},...p],...r.getFieldProps("primaryGroupValue"),error:r.touched.primaryGroupValue&&r.errors.primaryGroupValue?r.errors.primaryGroupValue:void 0}),e.jsx(a.Input,{type:"text",label:"Location",error:r.touched.location&&r.errors.location?r.errors.location:void 0,...r.getFieldProps("location")}),e.jsx(a.Input,{type:"text",label:"Home phone",error:r.touched.homePhoneNumber&&r.errors.homePhoneNumber?r.errors.homePhoneNumber:void 0,...r.getFieldProps("homePhoneNumber")}),e.jsx(a.Input,{type:"text",label:"Work phone",error:r.touched.workPhoneNumber&&r.errors.workPhoneNumber?r.errors.workPhoneNumber:void 0,...r.getFieldProps("workPhoneNumber")}),e.jsx(le,{submitButtonDisabled:x,submitButtonText:"Add user"})]})},ge="_cta_hpksw_1",xe={cta:ge},be=j.lazy(()=>$(()=>import("./index-DkKewtlv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))),je=({selectedUsers:o,handleClearSelection:n,sidePanel:c=!1})=>{const[u,l]=j.useState(!1),{instanceId:d}=Q(),h=se("(min-width: 620px)"),x=F(),{notify:m}=te(),{setSidePanelContent:g,closeSidePanel:t}=C(),{confirmModal:p,closeConfirmModal:r}=ae(),{removeUserQuery:s,lockUserQuery:b,unlockUserQuery:_}=A(),{mutateAsync:w}=s,{mutateAsync:N}=b,{mutateAsync:f}=_,S=Number(d),i=o.length===1?o[0]:void 0,{locked:G,unlocked:V}=de(o),v=async(U,E)=>{try{await U({computer_ids:[S],usernames:me(o),delete_home:E==="removed"?u:void 0}),n&&n(),t(),m.success({message:`Successfully requested to be ${E}`})}catch(J){x(J)}finally{r()}},R=async()=>{await v(N,"locked")},K=async()=>{await v(f,"unlocked")},O=async()=>{await v(w,"removed")},z=()=>{g("Add new user",e.jsx(M,{}))},H=U=>{g("Edit user",e.jsx(j.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(be,{user:U})}))},Y=async()=>{p({title:`Delete ${i?i.username:"users"}`,body:e.jsxs("div",{children:[e.jsx("p",{className:"u-no-margin--bottom",children:i?`This will delete user ${i.username}. You can delete this user's home folders at the same time`:"This will delete selected users. You can delete their home folders as well"}),e.jsx(a.Input,{label:"Delete the home folders as well",type:"checkbox",onChange:()=>l(U=>!U)})]}),buttons:[e.jsx(a.Button,{appearance:"negative",onClick:O,children:"Delete"},"remove")]})},W=async()=>{p({title:`Lock ${i?`user ${i.username}`:`${o.length} users`}`,body:q({user:i,selectedUsers:o,userAction:D.Lock}),buttons:[e.jsx(a.Button,{appearance:"positive",onClick:R,children:"Lock"},"lock")]})},X=async()=>{p({title:`Unlock ${i?`user ${i.username}`:`${o.length} users`}`,body:q({user:i,selectedUsers:o,userAction:D.Unlock}),buttons:[e.jsx(a.Button,{appearance:"positive",onClick:K,children:"Unlock"},"unlock")]})};return e.jsxs("div",{className:re("p-panel__controls u-no-padding--top",{"u-no-margin--left":c,[xe.cta]:!c&&h}),children:[!c&&e.jsxs(a.Button,{hasIcon:!0,onClick:z,className:"u-no-margin--right",children:[e.jsx(a.Icon,{name:"plus"}),e.jsx("span",{children:"Add user"})]}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[((i==null?void 0:i.enabled)||!c)&&e.jsxs(a.Button,{disabled:V===0,onClick:W,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"lock-locked"}),e.jsx("span",{children:"Lock"})]}),(!(i!=null&&i.enabled)||!c)&&e.jsxs(a.Button,{disabled:G===0,onClick:X,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlock"})]}),c&&i&&e.jsxs(a.Button,{onClick:()=>H(i),className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(a.Button,{disabled:o.length===0,onClick:Y,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"delete"}),e.jsx("span",{children:"Delete"})]})]})})]})},ye=(o,n)=>o.filter(c=>n.includes(c.uid)),ke=({selected:o,handleClearSelection:n,users:c})=>{const{search:u,setPageParams:l}=T(),[d,h]=j.useState(u),x=()=>{l({search:d}),n()},m=()=>{l({search:""})},g=t=>{t.preventDefault(),x()};return e.jsxs("div",{className:L.headerContainer,children:[e.jsx("div",{className:L.searchContainer,children:e.jsx(a.Form,{onSubmit:g,noValidate:!0,children:e.jsx(a.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,value:d,onChange:t=>h(t),onClear:m})})}),e.jsx(je,{handleClearSelection:n,selectedUsers:ye(c,o)})]})},_e="_status_1n2s0_1",fe="_actions_1n2s0_7",B={status:_e,actions:fe},Ue=j.lazy(()=>$(()=>import("./index-DkKewtlv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))),we=j.lazy(()=>$(()=>import("./index-xFH56KPs.js"),__vite__mapDeps([21,1,2,22,23,24,11,12,13,14,15,16,17,18,19,3,4,5,6,7,20]))),Se=({users:o,selected:n,setSelected:c})=>{const{setSidePanelContent:u}=C(),l=t=>{u("Edit user",e.jsx(j.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ue,{user:t})}))},d=t=>{u("User details",e.jsx(j.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(we,{user:t})}))},h=()=>{c(n.length!==0?[]:o.map(({uid:t})=>t))},x=t=>{n.includes(t.uid)?c(n.filter(p=>p!==t.uid)):c([...n,t.uid])},m=[{content:e.jsxs(e.Fragment,{children:[e.jsx(a.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),checked:n.length===o.length&&o.length>0,onChange:h,indeterminate:n.length>0&&n.length<o.length}),e.jsx("span",{children:"USERNAME"})]})},{content:"Status",sortKey:"status"},{content:"UID"},{content:"Full Name"},{content:""}],g=o.map(t=>({columns:[{content:e.jsxs(e.Fragment,{children:[e.jsx(a.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:`Select user ${t.username}`}),checked:n.includes(t.uid),onChange:()=>x(t)}),e.jsx(a.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{d(t)},"aria-label":`Show details of user ${t.username}`,children:t.username})]}),role:"rowheader","aria-label":`User ${t.username}`},{content:e.jsx("div",{className:B.status,children:t.enabled?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"p-icon--lock-unlock"}),e.jsx("span",{children:"Unlocked"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"p-icon--lock-locked-active"}),e.jsx("span",{children:"Locked"})]})}),"aria-label":`User ${t.username} status`},{content:t.uid,"aria-label":"uid"},{content:t.name?t.name:"-","aria-label":"full name"},{className:B.actions,content:e.jsxs(a.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left p-tooltip--btm-center","aria-label":`Edit ${t.name} profile`,onClick:()=>l(t),children:[e.jsx("span",{className:"p-tooltip__message",children:"Edit"}),e.jsx("i",{className:"p-icon--edit u-no-margin--left"})]})}],sortData:{status:t.enabled,uid:t.uid,fullname:t.username}}));return e.jsx(a.MainTable,{headers:m,rows:g,sortable:!0})},Pe=(o,n)=>o?n.filter(({username:c,name:u})=>{const l=u==null?void 0:u.toUpperCase().includes(o.toUpperCase()),d=c.toUpperCase().includes(o.toUpperCase());return l||d}):n,Ce=1e3,Ne=()=>{const[o,n]=j.useState([]),{instanceId:c,childInstanceId:u}=Q(),{search:l,currentPage:d,pageSize:h}=T(),{setSidePanelContent:x}=C(),{getUsersQuery:m}=A(),g=Number(u??c),{data:t,isLoading:p}=m({computer_id:g,limit:Ce}),r=(t==null?void 0:t.data.results)??[],s=j.useMemo(()=>Pe(l,r),[l,r]),_=((f,S)=>s.slice(S,S+f))(h,(d-1)*h),w=()=>{n([])},N=()=>{x("Add new user",e.jsx(M,{}))};return e.jsxs(e.Fragment,{children:[p&&e.jsx(P,{}),!p&&(!t||t.data.results.length===0)&&e.jsx(oe,{title:"No users found",body:"Add new users by clicking the button below",icon:"connected",cta:[e.jsx(a.Button,{appearance:"positive",onClick:N,children:"Add user"},"empty-state-add-new-user")]}),!p&&s.length&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{selected:o,handleClearSelection:w,users:_}),e.jsx(Se,{selected:o,setSelected:f=>n(f),users:_})]}),e.jsx(ne,{handleClearSelection:w,totalItems:s.length,currentItemCount:_.length})]})},ve=Ne,Ge=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{je as U,Ge as i,A as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-DkKewtlv.js","assets/index-Dt7YhOS0.js","assets/index-BAlneFez.css","assets/formik.esm-g8btJLb9.js","assets/index.esm-Cy_yj1Qh.js","assets/SidePanelFormButtons-Cs6mvCpL.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/MultiSelectField-jp5PAogY.js","assets/MultiSelectField.module-D1r8qo_i.js","assets/MultiSelectField-B2rqRhX9.css","assets/EmptyState-BG0AupYF.js","assets/EmptyState-BNXajmMK.css","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/TablePagination-0eisoSCU.js","assets/usePageParams-Du9VpOtH.js","assets/useMutation-B0Ge1lYR.js","assets/useQuery-Dlf2yvOE.js","assets/useConfirm-CR6bT57R.js","assets/helpers-BMTj9ldD.js","assets/index-xFH56KPs.js","assets/InfoItem-Mj-XXzjC.js","assets/InfoItem.module-BZ3tYMsb.js","assets/InfoItem-BbayMzTk.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
