import{f,e as x,g as G,j as s,h as r}from"./index-u_EhbhC_.js";import{c as A,a}from"./index.esm-BQnwAMDD.js";import{u as k}from"./useAPTSources-4jsu7l_t.js";import{u as v}from"./useGPGKeys-Cv5hUNvA.js";import{u as j}from"./useRoles-BOXb_ntO.js";import{t as n}from"./tests-DFnZqbNV.js";import{S as F}from"./SidePanelFormButtons-xqQ8httV.js";import"./useFetchOld-BBfSXCp-.js";import"./PageMain-CmLgxdJK.js";import"./useMutation-CrcSbzv3.js";import"./SidePanelFormButtons.module-yv6Qz3cN.js";const V=()=>{const{closeSidePanel:l}=f(),p=x(),{createAPTSourceQuery:m,getAPTSourcesQuery:d}=k(),{getGPGKeysQuery:g}=v(),{data:i,isLoading:b}=g(),{getAccessGroupQuery:y}=j(),{data:u,isLoading:_}=y(),P=((u==null?void 0:u.data)??[]).map(t=>({label:t.title,value:t.name})),S=((i==null?void 0:i.data)??[]).filter(({has_secret:t})=>t).map(({name:t})=>({label:t,value:t})),{mutateAsync:h}=m,{data:o}=d(),e=G({initialValues:{name:"",apt_line:"",gpg_key:"",access_group:""},validationSchema:A().shape({name:a().required("This field is required").test({test:n.test,message:n.message}).test({params:{getAPTSourcesResponse:o},test:t=>!((o==null?void 0:o.data)??[]).map(({name:c})=>c).includes(t),message:"It must be unique within the account."}),apt_line:a().required("This field is required"),gpg_key:a(),access_group:a()}),onSubmit:async t=>{try{await h(t),l()}catch(c){p(c)}}});return s.jsxs(r.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[s.jsx(r.Input,{type:"text",label:"Name",required:!0,error:e.touched.name&&e.errors.name?e.errors.name:void 0,...e.getFieldProps("name")}),s.jsx(r.Input,{type:"text",label:"APT Line",required:!0,error:e.touched.apt_line&&e.errors.apt_line?e.errors.apt_line:void 0,...e.getFieldProps("apt_line")}),s.jsx(r.Select,{label:"GPG key",disabled:b,options:[{label:"Select GPG key",value:""},...S],...e.getFieldProps("gpg_key"),error:e.touched.gpg_key&&e.errors.gpg_key?e.errors.gpg_key:void 0}),s.jsx(r.Select,{label:"Access group",disabled:_,options:[{label:"Select access group",value:""},...P],...e.getFieldProps("access_group"),error:e.touched.access_group&&e.errors.access_group?e.errors.access_group:void 0}),s.jsx(F,{submitButtonDisabled:e.isSubmitting,submitButtonText:"Add APT Source"})]})};export{V as default};
