import{j as e,aE as E,a4 as S,av as N,i,aC as A,M as R,al as F,d as c,a6 as L,aF as P,A as v,D as O,N as y,o as D,v as B,aw as W}from"./index-BuGfZU4X.js";import{u as G}from"./useGetInstances-QZ6MBHVL.js";import{g as M}from"./WslInstancesEmptyState-Bz8mEVJ9.js";import{u as H}from"./useSelection-Dr6uVEOD.js";import{u as U}from"./useExpandableRow-jXFvasf0.js";import"./GroupFilter-Cb9AzGhl.js";import"./HeaderWithSearch-BYz7PPKN.js";import"./useRoles-CBUbXgNW.js";const V=a=>e.jsx(E,{...a}),$="_header_513lp_1",q="_search_513lp_8",j={header:$,search:q},z=({instance:a})=>{const{value:t,setTrue:r,setFalse:d}=S();return e.jsxs(e.Fragment,{children:[e.jsx(N,{destructiveActions:[{icon:"security-tick",label:"Make compliant",onClick:r}],toggleAriaLabel:`${a.title} actions`}),e.jsx(M,{close:d,instances:[a],isOpen:t})]})},Y=a=>({column:t,row:{index:r}})=>t.id==="profiles"&&a===r?{className:"expandedCell"}:{},Z=a=>({index:t})=>a===t?{className:"expandedRow"}:{},ne=({wslProfile:a})=>{const{expandedRowIndex:t,getTableRowsRef:r,handleExpand:d}=U(),[_,u]=i.useState(""),[I]=i.useState(A),[m]=i.useState(R),[h,g]=i.useState(""),{instances:o,isGettingInstances:x}=G({query:[h,`profile:wsl:${a.id}:noncompliant`].filter(Boolean).join(" "),limit:m,offset:(I-1)*m,with_wsl_profiles:!0}),{selectedItems:n,setSelectedItems:f}=H(o,x),{value:w,setTrue:k,setFalse:T}=S(),b=i.useMemo(()=>[{accessor:"title",Header:e.jsxs(e.Fragment,{children:[e.jsx(c.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,disabled:!o.length,indeterminate:!!n.length&&n.length<o.length,checked:!!o.length&&n.length===o.length,onChange:({currentTarget:{checked:s}})=>{f(s?o:[])}}),"Instance name"]}),Cell:({row:{original:s}})=>e.jsxs(e.Fragment,{children:[e.jsx(c.CheckboxInput,{inline:!0,label:e.jsxs("span",{className:"u-off-screen",children:["Select ",s.title]}),checked:n.includes(s),onChange:({currentTarget:{checked:l}})=>{f(l?[...n,s]:n.filter(p=>p!==s))}}),e.jsx(L,{to:`/instances/${s.id}`,children:s.title})]})},{Header:"OS",Cell:({row:{original:s}})=>s.distribution_info?.description},{accessor:"profiles",Header:"WSL profiles",Cell:({row:{original:s,index:l}})=>e.jsx(P,{content:s.wsl_profiles?.map(p=>p.title).join(", "),isExpanded:l===t,onExpand:()=>{d(l)}})},{Header:"Last ping",Cell:({row:{original:s}})=>{const l=v(s.last_ping_time);return l.isValid()?e.jsx("span",{className:"font-monospace",children:l.format(O)}):e.jsx(y,{})}},{...F,Cell:({row:{original:s}})=>e.jsx(z,{instance:s})}],[o,n,t]),C=()=>{u(""),g("")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:j.header,children:[e.jsx(c.SearchBox,{className:D("u-no-margin--bottom",j.search),externallyControlled:!0,value:_,onChange:u,onClear:C,onSearch:g,autoComplete:"off"}),e.jsxs(c.Button,{type:"button",className:"u-no-margin",hasIcon:!0,onClick:k,disabled:!n.length,children:[e.jsx(c.Icon,{name:"security-tick"}),e.jsx("span",{children:"Make compliant"})]})]}),e.jsx(V,{filters:[{label:"Search",item:h||void 0,clear:C}]}),x?e.jsx(B,{}):e.jsx("div",{ref:r,children:e.jsx(W,{columns:b,data:o,emptyMsg:"No Windows instances found according to your search parameters.",getCellProps:Y(t),getRowProps:Z(t)})}),e.jsx(M,{close:T,instances:n,isOpen:w})]})};export{ne as default};
