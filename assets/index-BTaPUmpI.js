import{j as e,D as N,r as p,g as r,p as E,x as S,q as M,f as R,L as Y}from"./index-aJwsc68L.js";import{u as F}from"./useInstances-b1TOjDNw.js";import{u as O}from"./useRoles-njF5h9Nh.js";import{N as k}from"./NoData-CmSHmpHE.js";import{m as U}from"./usePageParams-CzH8WT2r.js";import"./useFetchOld-DqwB-ncC.js";try{let n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new n.Error().stack;a&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[a]="9d7adf9d-6df7-46d1-ab9f-b532343dc3a0",n._sentryDebugIdIdentifier="sentry-dbid-9d7adf9d-6df7-46d1-ab9f-b532343dc3a0")}catch{}const G=({column:{id:n},row:{original:a}})=>{const c={};return n==="title"?c.role="rowheader":n==="checkbox"?c["aria-label"]=`Toggle ${a.title} instance`:n==="hostname"?c["aria-label"]="Hostname":n==="access_group"?c["aria-label"]="Access group":n==="client_tags"?c["aria-label"]="Tags":n==="creation_time"&&(c["aria-label"]="Creation time"),c},Q=(n,a)=>{var c;return a?((c=n.find(({value:o})=>o===a))==null?void 0:c.label)??a:e.jsx(k,{})},v=n=>U(n).utc().calendar({sameElse:`${N} [UTC]`,lastWeek:"[Last] dddd, HH:mm [UTC]",sameDay:"[Today], HH:mm [UTC]",lastDay:"[Yesterday], HH:mm [UTC]"}),q="_checkbox_1jtck_1",z="_truncate_1jtck_5",f={checkbox:q,truncate:z},W=({accessGroupOptions:n,instances:a,onSelectedIdsChange:c,selectedIds:o})=>{const l=p.useMemo(()=>a,[a]),t=p.useMemo(()=>[{accessor:"checkbox",className:f.checkbox,Header:()=>e.jsx(r.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,checked:o.length===l.length,indeterminate:o.length>0&&o.length<l.length,onChange:()=>c(o.length>0?[]:l.map(({id:s})=>s))}),Cell:({row:{original:s}})=>e.jsx(r.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${s.title} instance`}),inline:!0,checked:o.includes(s.id),onChange:()=>c(o.includes(s.id)?o.filter(u=>u!==s.id):[...o,s.id])})},{accessor:"title",Header:"name"},{accessor:"hostname",Header:"Hostname"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:s}})=>Q(n,s.access_group)},{accessor:"client_tags",Header:"Tags",Cell:({row:{original:s}})=>s.client_tags.length?e.jsx(r.Tooltip,{message:s.client_tags.join(", "),positionElementClassName:f.truncate,children:s.client_tags.join(", ")}):e.jsx(k,{})},{accessor:"creation_time",Header:"Pending since",Cell:({row:{original:s}})=>e.jsx(r.Tooltip,{message:v(s.creation_time),positionElementClassName:f.truncate,children:v(s.creation_time)})}],[l,o.length]);return e.jsx(r.ModularTable,{columns:t,data:l,getCellProps:G})},J="_help_h15yn_1",K={help:J},se=({instances:n})=>{var C;const[a,c]=p.useState(!1),[o,l]=p.useState(""),[t,s]=p.useState([]),u=E(),{user:d}=S(),{notify:b}=M(),{closeSidePanel:h,changeSidePanelSize:j}=R(),{getAccessGroupQuery:A}=O(),{acceptPendingInstancesQuery:T,rejectPendingInstancesQuery:P}=F(),g=(C=d==null?void 0:d.accounts.find(i=>i.name===(d==null?void 0:d.current_account)))==null?void 0:C.title,I=()=>{c(!0),j("small")},w=()=>{c(!1),j("large")},{mutateAsync:B,isPending:x}=T,{mutateAsync:H,isPending:y}=P,$=async()=>{try{await H({computer_ids:t}),h(),b.success({message:`${t.length} pending ${t.length===1?"instance":"instances"} have been rejected to add to your ${g} organisation.`,title:`You have rejected ${t.length} pending ${t.length===1?"instance":"instances"}`})}catch(i){u(i)}},D=async()=>{try{await B({access_group:o,computer_ids:t}),h(),b.success({message:`${t.length} pending ${t.length===1?"instance":"instances"} have been successfully added to your ${g} organisation.`,title:`You have approved ${t.length} pending ${t.length===1?"instance":"instances"}`})}catch(i){u(i)}},{data:m}=A(),_=(m==null?void 0:m.data.map(({name:i,title:L})=>({label:L,value:i})))??[];return e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:K.help,children:[e.jsxs("span",{children:["You can automatically register new Landscape Client Instances when theyâ€™re configured using a registration key. This eliminates the need for manual approval of each computer. You can enable this feature in the"," "]}),e.jsx(Y,{to:"/settings/general",children:"Org. settings"}),e.jsx("span",{children:" or "}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"learn more"})]}),a&&e.jsx(r.Select,{label:"Access group",options:_,name:"access_group",value:o,onChange:i=>l(i.target.value)}),!a&&e.jsx(W,{accessGroupOptions:_,instances:n,onSelectedIdsChange:i=>s(i),selectedIds:t}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(r.Button,{type:"button",appearance:"base",onClick:h,children:"Cancel"}),a&&e.jsxs(e.Fragment,{children:[e.jsx(r.Button,{type:"button",onClick:w,children:"Back"}),e.jsx(r.ConfirmationButton,{type:"button",appearance:"positive",disabled:t.length===0,confirmationModalProps:{title:"Approve pending instances",children:e.jsxs("p",{children:["This will approve ",t.length," selected"," ",t.length===1?"instance":"instances"," to add to your ",g," organisation."]}),confirmButtonLabel:"Approve",confirmButtonAppearance:"positive",confirmButtonLoading:x,confirmButtonDisabled:x,onConfirm:D},children:"Approve"})]}),!a&&e.jsxs(e.Fragment,{children:[e.jsx(r.ConfirmationButton,{type:"button",appearance:"negative",disabled:t.length===0,confirmationModalProps:{title:"Reject pending instances",children:e.jsxs("p",{children:["This will reject ",t.length," selected"," ",t.length===1?"instance":"instances"," to add to your ",g," organisation."]}),confirmButtonLabel:"Reject",confirmButtonAppearance:"negative",confirmButtonLoading:y,confirmButtonDisabled:y,onConfirm:$},children:"Reject"}),e.jsx(r.Button,{type:"button",appearance:"positive",disabled:t.length===0,onClick:I,children:"Approve"})]})]})]})};export{se as default};
