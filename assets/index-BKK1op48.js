const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BPVJvAWv.js","assets/index-B9SYUVLW.js","assets/index-CzVsEpc2.css","assets/SidePanelTablePagination--Jj9Te93.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/PageMain-ByGKJOPG.js","assets/PageMain-BIuYvhUI.css","assets/useDistributions-CvFfcltd.js","assets/useFetchOld-CRdEVo4H.js","assets/InfoItem-ChGLySKj.js","assets/InfoItem-C-lWh_lY.css","assets/moment-C5S46NFB.js","assets/NoData-CYO8pz-3.js","assets/index-GZh4ugI2.js","assets/moment-dBlfoK5t.js","assets/TablePagination-CJ7pnsZV.js","assets/usePageParams-iuEoGfRy.js","assets/SearchHelpPopup-Caaddoib.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/index-BmoMXq9B.css","assets/DistributionCard.module-BJwqEI-8.js","assets/DistributionCard-Bupv9j-d.css","assets/index-BqjlXzq9.css","assets/EditPocketForm-G-yCpAmp.js","assets/series-C5Hr5yH8.js","assets/series-Doyz0RCU.css","assets/debug-BAd9Sp0B.js","assets/debug-DTTGxnCx.css","assets/MultiSelectField-8551Ugj_.js","assets/MultiSelectField-DOBW8uWL.css","assets/SidePanelFormButtons-BoZ1OVm_.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/useGPGKeys-GAnltGNO.js","assets/NewPocketForm-9RZNaozY.js","assets/tests-DFnZqbNV.js","assets/DeriveSeriesForm-Ca3ho9DF.js","assets/index-DlNl7Ze9.js","assets/NewDistributionForm-BQgOhd8O.js","assets/useRoles-BSfsI1mU.js"])))=>i.map(i=>d[i]);
import{A as D,i as A,r as d,N as J,j as e,H as X,g as v,h as r,_ as L,t as P,c as z,e as j,f as K,k as R,D as ee,C as ne,E as te}from"./index-B9SYUVLW.js";import{P as ae,a as oe,b as se}from"./PageMain-ByGKJOPG.js";import{u as G}from"./useDistributions-CvFfcltd.js";import{I as F}from"./InfoItem-ChGLySKj.js";import{h as V}from"./moment-C5S46NFB.js";import{N as ie}from"./NoData-CYO8pz-3.js";import{a as H,b as re}from"./index-GZh4ugI2.js";import{u as U}from"./useFetchOld-CRdEVo4H.js";import{s as B,d as Q}from"./DistributionCard.module-BJwqEI-8.js";const le=n=>!n||n==="synced"||n==="in progress"?"":H[n==="queued"?"undelivered":n].icon,ce="_progressContainer_xxjjr_1",de="_progress_xxjjr_1",ue="_progressBarContainer_xxjjr_11",me="_progressBar_xxjjr_11",pe="_iconContainer_xxjjr_27",w={progressContainer:ce,progress:de,progressBarContainer:ue,progressBar:me,iconContainer:pe},I=({pocket:n,syncPocketRefAdd:t,syncPocketRefs:s})=>{const m=D("(min-width: 620px)"),{setSidePanelContent:i}=A();if(d.useEffect(()=>{n.mode!=="mirror"&&n.mode!=="pull"||!n.last_sync_status||n.last_sync_status!=="in progress"||s.find(({distributionName:y})=>y===n.distribution.name)||t({distributionName:n.distribution.name,seriesName:n.series.name,pocketName:n.name})},[n,s]),n.mode==="upload")return J;if(!n.last_sync_status)return e.jsx(ie,{});if(n.last_sync_status==="synced")return V(n.last_sync_time).format(X);if(n.last_sync_status==="in progress")return e.jsxs("div",{className:w.progressContainer,children:[m&&e.jsx("div",{className:w.progressBarContainer,children:e.jsx("div",{className:w.progressBar,style:{width:`${n.last_sync_activity.progress}%`}})}),e.jsx("span",{className:w.progress,children:`${n.last_sync_activity.progress}%`})]});const g=n.last_sync_status==="queued"?"undelivered":n.last_sync_status,o=()=>{i(n.last_sync_activity.summary,e.jsx(re,{activityId:n.last_sync_activity.id}))};return e.jsxs("div",{className:v("p-table__cell--icon-placeholder",w.iconContainer),children:[e.jsx(r.Icon,{name:le(n.last_sync_status)}),e.jsx(r.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:o,children:H[g].label})]})},ge=d.lazy(()=>L(()=>import("./index-BPVJvAWv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]))),q=({distributionName:n,pocket:t,seriesName:s})=>{const{setSidePanelContent:m}=A(),i=()=>{m(`${s} ${t.name}`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ge,{distributionName:n,pocket:t,seriesName:s})}))};return e.jsxs(e.Fragment,{children:[e.jsx(r.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:i,"aria-label":`List ${t.name} pocket of ${n}/${s}`,children:t.name}),t.mode==="pull"&&e.jsx("p",{className:"p-text--small u-text--muted u-no-margin--bottom",children:`pulling from ${t.pull_pocket}`})]})};function ye(){const n=z(),t=U(),s=j({mutationKey:["pockets","create"],mutationFn:a=>t.get("CreatePocket",{params:a}),onSuccess:()=>n.invalidateQueries({queryKey:["distributions"]})}),m=j({mutationKey:["pockets","edit"],mutationFn:a=>t.get("EditPocket",{params:a}),onSuccess:()=>n.invalidateQueries({queryKey:["distributions"]})}),i=j({mutationKey:["pockets","remove"],mutationFn:a=>t.get("RemovePocket",{params:a}),onSuccess:()=>n.invalidateQueries({queryKey:["distributions"]})}),g=j({mutationKey:["pocketPackages","sync"],mutationFn:a=>t.get("SyncMirrorPocket",{params:a}),onSuccess:(a,c)=>Promise.all([n.invalidateQueries({queryKey:["pocketPackages",{...c}]}),n.invalidateQueries({queryKey:["distributions"]})])}),o=j({mutationKey:["pocketPackages","pull"],mutationFn:a=>t.get("PullPackagesToPocket",{params:a}),onSuccess:(a,c)=>Promise.all([n.invalidateQueries({queryKey:["pocketPackages",{...c}]}),n.invalidateQueries({queryKey:["distributions"]})])}),l=j({mutationKey:["pocketPackages","remove"],mutationFn:a=>t.get("RemovePackagesFromPocket",{params:a}),onSuccess:(a,c)=>n.invalidateQueries({queryKey:["pocketPackages",{...c},"list"]})}),y=(a,c={})=>K({queryKey:["pocketPackages",{...a},"difference"],queryFn:()=>t.get("DiffPullPocket",{params:a}),...c}),u=(a,c={})=>K({queryKey:["pocketPackages",{...a},"list"],queryFn:()=>t.get("ListPocket",{params:a}),...c}),_=j({mutationKey:["packageFilters","add"],mutationFn:a=>t.get("AddPackageFiltersToPocket",{params:a}),onSuccess:(a,c)=>Promise.all([n.invalidateQueries({queryKey:["distributions"]}),n.invalidateQueries({queryKey:["pocketPackages",{...c}]})])}),f=j({mutationKey:["packageFilters","remove"],mutationFn:a=>t.get("RemovePackageFiltersFromPocket",{params:a}),onSuccess:(a,c)=>Promise.all([n.invalidateQueries({queryKey:["distributions"]}),n.invalidateQueries({queryKey:["pocketPackages",{...c}]})])}),x=j({mutationKey:["uploaderGPGKeys","add"],mutationFn:a=>t.get("AddUploaderGPGKeysToPocket",{params:a}),onSuccess:(a,c)=>Promise.all([n.invalidateQueries({queryKey:["distributions"]}),n.invalidateQueries({queryKey:["pocketPackages",{...c}]})])}),C=j({mutationKey:["uploaderGPGKeys","remove"],mutationFn:a=>t.get("RemoveUploaderGPGKeysFromPocket",{params:a}),onSuccess:(a,c)=>Promise.all([n.invalidateQueries({queryKey:["distributions"]}),n.invalidateQueries({queryKey:["pocketPackages",{...c}]})])});return{createPocketQuery:s,editPocketQuery:m,syncMirrorPocketQuery:g,pullPackagesToPocketQuery:o,diffPullPocketQuery:y,removePocketQuery:i,listPocketQuery:u,removePackagesFromPocketQuery:l,addPackageFiltersToPocketQuery:_,removePackageFiltersFromPocketQuery:f,addUploaderGPGKeysToPocketQuery:x,removeUploaderGPGKeysFromPocketQuery:C}}const be=d.lazy(()=>L(()=>import("./EditPocketForm-G-yCpAmp.js"),__vite__mapDeps([24,1,2,25,26,27,28,29,30,31,32,33,34,9,6,7,8,10,11,12,13,14,15,16,4,5,17,18,19,20,21,22]))),O=({distributionName:n,pocket:t,seriesName:s,syncPocketRefs:m})=>{const i=D("(min-width: 620px)"),g=R(),{setSidePanelContent:o}=A(),{removePocketQuery:l,syncMirrorPocketQuery:y,pullPackagesToPocketQuery:u}=ye(),{mutateAsync:_,isPending:f}=l,x=async()=>{try{await _({distribution:n,series:s,name:t.name})}catch(h){g(h)}},{mutateAsync:C,isPending:a}=y,{mutateAsync:c,isPending:p}=u,N=async()=>{try{await C({name:t.name,series:s,distribution:n})}catch(h){g(h)}},$=async()=>{try{await c({name:t.name,series:s,distribution:n})}catch(h){g(h)}},S=()=>t.mode==="mirror"?{title:`Synchronizing ${t.name} pocket`,children:e.jsx("p",{children:"Do you want to synchronize packages?"}),confirmButtonLabel:"Sync",confirmButtonAppearance:"positive",confirmButtonDisabled:a,confirmButtonLoading:a,onConfirm:N}:t.mode==="pull"?{title:`Pulling packages to ${t.name} pocket`,children:e.jsxs("p",{children:["Do you want to pull packages from ",t.pull_pocket,"?"]}),confirmButtonLabel:"Pull",confirmButtonAppearance:"positive",confirmButtonDisabled:p,confirmButtonLoading:p,onConfirm:$}:{},b=(h,M)=>{h.currentTarget.blur(),o(`Edit ${M.name} pocket`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(be,{pocket:M,distributionName:n,seriesName:s})}))};return e.jsxs("div",{className:"divided-blocks",children:[(t.mode=="mirror"||t.mode=="pull")&&e.jsx("div",{className:"divided-blocks__item",children:e.jsx(r.ConfirmationButton,{type:"button",className:v("u-no-margin--bottom has-icon",{"u-no-padding--right":i,"is-small":i}),appearance:i?"base":void 0,"aria-label":t.mode==="mirror"?`Synchronize ${t.name} pocket of ${n}/${s}`:`Pull packages to ${t.name} pocket of ${n}/${s}`,disabled:m.some(h=>h.distributionName===n),confirmationModalProps:S(),children:e.jsx(r.Tooltip,{position:"btm-center",message:t.mode==="mirror"?"Sync":"Pull",children:e.jsx(r.Icon,{name:"change-version",className:v({"u-no-margin--right":i})})})})}),e.jsx("div",{className:"divided-blocks__item",children:e.jsx(r.Tooltip,{message:"Edit",position:"btm-center",children:e.jsx(r.Button,{type:"button",small:i,hasIcon:!0,appearance:i?"base":"",className:v("u-no-margin--bottom",{"u-no-padding--right":i}),"aria-label":`Edit ${t.name} pocket of ${n}/${s}`,onClick:h=>b(h,t),disabled:m.some(h=>h.distributionName===n),children:e.jsx(r.Icon,{name:"edit",className:v({"u-no-margin--right":i})})})})}),e.jsx("div",{className:"divided-blocks__item",children:e.jsx(r.ConfirmationButton,{type:"button",className:v("u-no-margin--bottom has-icon",{"u-no-padding--right":i,"is-small":i}),appearance:i?"base":void 0,"aria-label":`Remove ${t.name} pocket of ${n}/${s}`,disabled:m.some(h=>h.distributionName===n),confirmationModalProps:{title:"Deleting pocket",children:e.jsxs("p",{children:["Do you really want to delete ",t.name," pocket from"," ",s," series of ",n," distribution?"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:f,confirmButtonLoading:f,onConfirm:x},children:e.jsx(r.Tooltip,{position:"btm-center",message:"Delete",children:e.jsx(r.Icon,{name:r.ICONS.delete,className:v({"u-no-margin--right":i})})})})})]})},he=({column:n})=>{const t={};return n.id==="name"?t.role="rowheader":n.id==="mode"?t["aria-label"]="Mode":n.id==="last_sync"?t["aria-label"]="Last synced":n.id==="package_count"?t["aria-label"]="Content":n.id==="actions"&&(t["aria-label"]="Actions"),t},_e="_pocketWrapper_596vd_1",xe="_ctaRow_596vd_9",fe="_actions_596vd_13",E={pocketWrapper:_e,ctaRow:xe,actions:fe},ke=({distributionName:n,series:t,syncPocketRefAdd:s,syncPocketRefs:m})=>{const i=D("(min-width: 620px)"),g=d.useMemo(()=>t.pockets,[t.pockets]),o=d.useMemo(()=>[{accessor:"name",Header:"Pocket",Cell:({row:{original:l}})=>e.jsx(q,{distributionName:n,pocket:l,seriesName:t.name})},{accessor:"mode",Header:"Mode"},{accessor:"last_sync",Header:"Last synced",Cell:({row:{original:l}})=>e.jsx(I,{pocket:l,syncPocketRefAdd:s,syncPocketRefs:m})},{accessor:"package_count",Header:"Content",Cell:({row:{original:l}})=>e.jsx(e.Fragment,{children:`${l.package_count} ${l.package_count===1?"package":"packages"}`})},{accessor:"actions",className:E.actions,Cell:({row:{original:l}})=>e.jsx(O,{distributionName:n,pocket:l,seriesName:t.name,syncPocketRefs:m})}],[g,m]);return i?e.jsx(r.ModularTable,{columns:o,data:g,getCellProps:he,emptyMsg:"No pockets yet"}):t.pockets.map((l,y)=>e.jsxs(r.Row,{className:v("u-no-padding--left u-no-padding--right",E.pocketWrapper),children:[e.jsx(r.Col,{size:2,small:2,children:e.jsx(F,{label:"Pocket",value:e.jsx(q,{distributionName:n,pocket:l,seriesName:t.name})})}),e.jsx(r.Col,{size:2,small:2,children:e.jsx(F,{label:"Last synced",value:e.jsx(I,{pocket:l,syncPocketRefAdd:s,syncPocketRefs:m})})}),e.jsx(r.Col,{size:2,small:2,children:e.jsx(F,{label:"Mode",value:l.mode})}),e.jsx(r.Col,{size:2,small:2,children:e.jsx(F,{label:"Content",value:e.jsx(e.Fragment,{children:`${l.package_count} ${l.package_count===1?"package":"packages"}`})})}),e.jsx("div",{className:E.ctaRow,children:e.jsx(O,{distributionName:n,pocket:l,seriesName:t.name,syncPocketRefs:m})})]},y))};function je(){const n=z(),t=U(),s=j({mutationKey:["series","new"],mutationFn:o=>t.get("CreateSeries",{params:o}),onSuccess:()=>n.invalidateQueries({queryKey:["distributions"]})}),m=j({mutationKey:["series","derive"],mutationFn:o=>t.get("DeriveSeries",{params:o}),onSuccess:()=>n.invalidateQueries({queryKey:["distributions"]})}),i=j({mutationKey:["series","remove"],mutationFn:o=>t.get("RemoveSeries",{params:o}),onSuccess:()=>n.invalidateQueries({queryKey:["distributions"]})});return{createSeriesQuery:s,removeSeriesQuery:i,deriveSeriesQuery:m,getRepoInfo:(o,l={})=>K({queryKey:["repoInfo",{queryParams:o}],queryFn:()=>t.get("GetRepoInfo",{params:o}),...l})}}const ve=d.lazy(()=>L(()=>import("./NewPocketForm-9RZNaozY.js"),__vite__mapDeps([35,1,2,25,26,27,28,29,30,31,32,33,34,9,36,6,7,8,10,11,12,13,14,15,16,4,5,17,18,19,20,21,22]))),Pe=d.lazy(()=>L(()=>import("./DeriveSeriesForm-Ca3ho9DF.js"),__vite__mapDeps([37,1,2,36,31,32,33,6,7,8,9,10,11,12,13,14,15,16,4,5,17,18,19,20,21,22]))),Ce=({distribution:n,series:t,syncPocketRefAdd:s,syncPocketRefs:m})=>{const[i,g]=d.useState(!1),[o,l]=d.useState("");d.useEffect(()=>{!t||!t.pockets.length||t.pockets[0].mode!=="mirror"||!t.pockets[0].mirror_uri.startsWith(ee)||l(t.pockets[0].mirror_uri.replace(/^.*\/(\d{8})T\d{6}Z$/,"$1"))},[t]);const y=D("(min-width: 620px)"),{setSidePanelContent:u}=A(),{removeSeriesQuery:_}=je(),f=R(),{mutateAsync:x,isPending:C}=_,a=async()=>{try{await x({name:t.name,distribution:n.name})}catch(k){f(k)}finally{c()}},c=()=>{g(!1)},p=()=>{g(!0)},N=()=>{u("Derive series",e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Pe,{distribution:n,origin:t.name})}))},$=()=>{u(`New pocket for ${t.name}`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ve,{distribution:n,series:t})}))},S=[{label:"Derive series",ariaLabel:`Derive series ${n.name}/${t.name}`,onClick:N},{label:"New pocket",ariaLabel:`Add new pocket for ${n.name}/${t.name}`,onClick:$}],b={label:"Remove",ariaLabel:`Remove ${n.name}/${t.name}`,appearance:"negative",modalTitle:"Remove series",modalBody:e.jsx("p",{children:"Are you sure? This action cannot be undone."}),isLoading:C,onClick:p,onConfirm:a},h=[...S,b],W=[...S.map(k=>e.jsx(r.Button,{type:"button",className:"is-small","aria-label":k.ariaLabel,onMouseDown:Z=>Z.preventDefault(),onClick:k.onClick,children:k.label},`${k.label}-button`)),e.jsx(r.ConfirmationButton,{type:"button",className:"is-small","aria-label":b.ariaLabel,confirmationModalProps:{title:b.modalTitle,children:b.modalBody,confirmButtonLabel:b.label,confirmButtonAppearance:b.appearance,confirmButtonLoading:b.isLoading,confirmButtonDisabled:b.isLoading,onConfirm:b.onConfirm},children:b.label},`${b.label}-button`)],Y=h.map(k=>({children:k.label,"aria-label":k.ariaLabel,onClick:k.onClick})).filter(k=>!(o&&(k.children==="Derive series"||k.children==="New pocket")));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:B.card,children:[e.jsxs("div",{className:B.header,children:[e.jsx("h3",{className:B.title,children:t.name}),!!o&&e.jsx("span",{className:v("u-text--muted",B.snapshot),children:`Snapshot from ${V(o).format(ne)}`}),y?e.jsx("div",{className:B.cta,children:W}):e.jsx(r.ContextualMenu,{position:"left",toggleLabel:"Actions",toggleClassName:"u-no-margin--bottom",links:Y})]}),e.jsx("div",{className:B.content,children:e.jsx(ke,{distributionName:n.name,series:t,syncPocketRefAdd:s,syncPocketRefs:m})})]}),i&&e.jsx(r.ConfirmationModal,{title:b.modalTitle,confirmButtonLabel:b.label,close:c,confirmButtonAppearance:b.appearance,confirmButtonLoading:b.isLoading,confirmButtonDisabled:b.isLoading,onConfirm:b.onConfirm,children:b.modalBody})]})},Se="_card_40gow_1",Le="_header_40gow_5",Ae="_title_40gow_11",Be="_content_40gow_20",T={card:Se,header:Le,title:Ae,content:Be},De=d.lazy(()=>L(()=>import("./index-DlNl7Ze9.js"),__vite__mapDeps([38,1,2,12,25,26,31,32,33,8,9,34,36,6,7,10,11,13,14,15,16,4,5,17,18,19,20,21,22]))),Ne=({distribution:n})=>{const{setSidePanelContent:t}=A();return e.jsxs("div",{className:T.card,children:[e.jsx("div",{className:T.header,children:e.jsx("h3",{className:T.title,children:"No series have been added yet"})}),e.jsxs("div",{className:T.content,children:[e.jsx("p",{className:"u-no-margin--bottom",children:"Add a new mirror or series to get started"}),e.jsx("p",{className:"u-no-margin--top",children:e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage repositories in Landscape"})}),e.jsx(r.Button,{type:"button",appearance:"positive",className:"u-no-margin--bottom",onClick:()=>{t(`Add mirror for ${n.name}`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(De,{distribution:n})}))},"aria-label":`Add mirror for ${n.name}`,children:"Add mirror"})]})]})},$e=d.lazy(()=>L(()=>import("./index-DlNl7Ze9.js"),__vite__mapDeps([38,1,2,12,25,26,31,32,33,8,9,34,36,6,7,10,11,13,14,15,16,4,5,17,18,19,20,21,22]))),we=({distribution:n,syncPocketRefAdd:t,syncPocketRefs:s})=>{const[m,i]=d.useState(!1),{setSidePanelContent:g}=A(),o=D("(min-width: 620px)"),{removeDistributionQuery:l}=G(),y=R(),{mutateAsync:u,isPending:_}=l,f=async()=>{try{await u({name:n.name})}catch(S){y(S)}finally{a()}},x=()=>{g(`Add series to ${n.name}`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx($e,{distribution:n,ctaText:"Add series"})}))},C=()=>{i(!0)},a=()=>{i(!1)},c={label:"Add series",ariaLabel:`Add series to ${n.name}`,onClick:x},p={label:"Remove distribution",ariaLabel:`Remove ${n.name} distribution`,appearance:"negative",modalTitle:`Removing ${n.name} distribution`,modalBody:e.jsx("p",{children:"Are you sure? This action cannot be undone."}),modalActionLabel:"Remove",isLoading:_,onClick:C,onConfirm:f},N=[e.jsx(r.Button,{type:"button",className:"is-small","aria-label":c.ariaLabel,onClick:c.onClick,children:c.label},`${c.label}-button`),e.jsx(r.ConfirmationButton,{type:"button",className:"is-small","aria-label":p.ariaLabel,confirmationModalProps:{title:p.modalTitle,children:p.modalBody,confirmButtonLabel:p.modalActionLabel,confirmButtonAppearance:p.appearance,confirmButtonLoading:_,confirmButtonDisabled:_,onConfirm:p.onConfirm},children:p.label},`${p.label}-button`)],$=[{children:c.label,"aria-label":c.ariaLabel,onClick:c.onClick},{children:p.label,"aria-label":p.ariaLabel,onClick:p.onClick}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:Q.item,children:[e.jsxs("div",{className:Q.titleGroup,children:[e.jsx("h2",{className:v("p-heading--4 u-no-margin--bottom u-no-padding--top",Q.title),children:n.name}),o?e.jsx("div",{children:N}):e.jsx(r.ContextualMenu,{position:"left",toggleLabel:"Actions",toggleProps:{"aria-label":`${n.name} distribution actions`},links:$})]}),n.series.length===0&&e.jsx(Ne,{distribution:n}),n.series.length>0&&n.series.map(S=>e.jsx(Ce,{distribution:n,series:S,syncPocketRefAdd:t,syncPocketRefs:s},S.name))]}),m&&e.jsx(r.ConfirmationModal,{title:p.modalTitle,confirmButtonLabel:p.modalActionLabel,confirmButtonAppearance:p.appearance,confirmButtonDisabled:p.isLoading,confirmButtonLoading:p.isLoading,onConfirm:p.onConfirm,close:a,children:p.modalBody})]})},Fe=d.lazy(()=>L(()=>import("./NewDistributionForm-BQgOhd8O.js"),__vite__mapDeps([39,1,2,8,9,40,36,31,32,33]))),Te=()=>{const{setSidePanelContent:n}=A(),t=()=>{n("Add distribution",e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Fe,{})}))};return e.jsx(te,{title:"No mirrors have been added yet",icon:"containers",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"To add a new mirror you must first add a distribution"}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage repositories in Landscape"})]}),cta:[e.jsx(r.Button,{onClick:t,type:"button",children:"Add distribution"},"add-distribution")]})},Me=({onDistributionsLengthChange:n})=>{const[t,s]=d.useState([]),{getDistributionsQuery:m}=G(),{data:i,isLoading:g}=m({include_latest_sync:!0},{refetchInterval:t.length?1e3:void 0}),o=(i==null?void 0:i.data)??[];d.useEffect(()=>{n(o.length)},[o.length]),d.useEffect(()=>{var y,u;if(t.length)for(const _ of t){const f=(u=(y=o.find(({name:x})=>x===_.distributionName))==null?void 0:y.series.find(({name:x})=>x===_.seriesName))==null?void 0:u.pockets.find(({name:x})=>x===_.pocketName);!f||f.mode!=="mirror"&&f.mode!=="pull"||f.last_sync_status==="in progress"||s(x=>x.filter(({distributionName:C})=>C!==_.distributionName))}},[o]);const l=y=>{s(u=>[...u,y])};return e.jsxs(e.Fragment,{children:[g&&e.jsx(P,{}),!g&&o.length===0&&e.jsx(Te,{}),!g&&o.length>0&&o.map(y=>e.jsx(we,{distribution:y,syncPocketRefAdd:l,syncPocketRefs:t},y.name))]})},Qe=d.lazy(()=>L(()=>import("./NewDistributionForm-BQgOhd8O.js"),__vite__mapDeps([39,1,2,8,9,40,36,31,32,33]))),Ee=d.lazy(()=>L(()=>import("./index-DlNl7Ze9.js"),__vite__mapDeps([38,1,2,12,25,26,31,32,33,8,9,34,36,6,7,10,11,13,14,15,16,4,5,17,18,19,20,21,22]))),Ke=()=>{const[n,t]=d.useState(0),s=D("(min-width: 620px)"),{setSidePanelContent:m}=A(),o=[{label:"Add distribution",ariaLabel:"Add distribution",onClick:()=>{m("Add distribution",e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Qe,{})}))},disabled:!1,appearance:void 0},{label:"Add mirror",ariaLabel:"Add mirror",onClick:()=>{m("Add new mirror",e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ee,{})}))},disabled:n===0,appearance:"positive"}],l=o.map(u=>e.jsx(r.Button,{type:"button",className:"u-no-margin--right","aria-label":u.ariaLabel,onMouseDown:_=>_.preventDefault(),appearance:u.appearance,disabled:u.disabled,onClick:u.onClick,children:u.label},`${u.label}-button`)),y=o.map(u=>({children:u.label,"aria-label":u.ariaLabel,onClick:u.onClick,disabled:u.disabled}));return e.jsxs(ae,{children:[e.jsx(oe,{title:"Repository Mirrors",actions:s?l:[e.jsx(r.ContextualMenu,{toggleLabel:"Actions",toggleClassName:"u-no-margin--bottom",links:y},"menu")]}),e.jsx(se,{children:e.jsx(Me,{onDistributionsLengthChange:u=>t(u)})})]})},We=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"}));export{ye as a,We as i,je as u};
