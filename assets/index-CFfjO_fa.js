const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BSOn7Gk4.js","assets/index-ClG4AO4X.js","assets/index-snvkEeYU.css","assets/EmployeeGroupIdentityIssuerList-DAoDr-x2.js","assets/HeaderWithSearch-HMiSqRye.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/index-CkKa67bu.js","assets/SidePanelTablePagination-CSms0KVO.js","assets/EmployeeGroupIdentityIssuerList-CdRpefPn.css"])))=>i.map(i=>d[i]);
import{g as M,b as C,h as I,k as c,A as P,i as z,j as e,d as p,G as $,ay as D,n as R,B as q,p as j,E as Q,az as H,x as K,a2 as V}from"./index-ClG4AO4X.js";import{S as Y}from"./SidePanelFormButtons-BitiQJ8Y.js";import{S as U}from"./SidePanelTablePagination-CSms0KVO.js";import"./EmployeeGroupIdentityIssuerList-DAoDr-x2.js";import{u as E}from"./useGetEmployeeGroups-BvKFI8F-.js";import{I as G,S as W}from"./SidePanelDescription-CXpa-JUj.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";import"./HeaderWithSearch-HMiSqRye.js";import"./index-CkKa67bu.js";const Z=()=>{const n=M(),r=C(),{mutateAsync:d,isPending:s}=I({mutationFn:async({staged_oidc_group_ids:i,import_all:a})=>r.post("/employee_groups",{staged_oidc_group_ids:i,import_all:a}),onSuccess:async()=>n.invalidateQueries({queryKey:["employeeGroups"]})});return{importEmployeeGroups:d,isEmployeeGroupsImporting:s}},J=({issuerId:n,pageSize:r,currentPage:d,search:s})=>{const{employeeGroupsCount:i}=E(),[a,x]=c.useState(null),m=C(),S=P(),g={import_session_id:a?.id,exclude_imported:i&&i>0,offset:(d-1)*r,limit:r,search:s},{mutateAsync:b,isPending:f}=I({mutationFn:async({issuer_id:u})=>m.post("/oidc/groups/import_session",{issuer_id:u})});c.useEffect(()=>{b({issuer_id:n}).then(({data:u})=>{x(u)}).catch(S)},[]);const{data:y,isLoading:l}=z({queryKey:["stagedOidcGroups",g],queryFn:async()=>m.get("/oidc/groups/staged",{params:g}),enabled:a!==null});return{stagedOidcGroups:y?.data.results??[],stagedOidcGroupsCount:y?.data.count??0,isStagedOidcGroupsLoading:f||l}},X=()=>{const{employeeGroupsCount:n}=E();return n&&n<=G?null:e.jsx("div",{children:e.jsx(p.Notification,{severity:"negative",title:"Group limit reached",children:`You've reached the limit of ${G.toLocaleString()} groups. Remove excess groups to proceed.`})})},ee="_checkbox_1ksvx_1",_={checkbox:ee},se=c.lazy(async()=>V(()=>import("./index-BSOn7Gk4.js").then(n=>n.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),pe=({issuer:n})=>{const[r,d]=c.useState(""),[s,i]=c.useState([]),{value:a,toggle:x}=$(),[m,S]=c.useState(1),[g,b]=c.useState(D[0].value),{setSidePanelContent:f,closeSidePanel:y}=R(),{stagedOidcGroups:l,stagedOidcGroupsCount:u,isStagedOidcGroupsLoading:h}=J({issuerId:n.id,pageSize:g,currentPage:m,search:r}),k=P(),{notify:v}=q(),{importEmployeeGroups:N,isEmployeeGroupsImporting:O}=Z(),B=t=>{i([]),S(t)},F=t=>{i([]),b(t)},L=async t=>{t.preventDefault();try{const{data:{count:o}}=await N({staged_oidc_group_ids:s,import_all:a});y(),v.success({title:`You've successfully imported ${o} employee ${K(o,"group")}.`,message:"Newly added employee groups can now be managed within Landscape."})}catch(o){k(o)}},T=t=>{i(s.includes(t)?s.filter(o=>o!==t):[...s,t])},w=()=>{f("Choose an identity issuer",e.jsx(c.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(se,{})}))},A=c.useMemo(()=>{const t={accessor:"name",Header:"name",Cell:({row:{original:{name:o}}})=>e.jsx(e.Fragment,{children:e.jsx("span",{children:o})})};return a?[t]:[{accessor:"id",className:"checkbox-column",Header:()=>e.jsx(p.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all employee groups"}),disabled:l.length===0||h,indeterminate:s.length>0&&s.length<l.length,checked:s.length>0&&s.length===l.length,onChange:()=>{i(s.length>0?[]:l.map(({id:o})=>o))}}),Cell:({row:{original:o}})=>e.jsx(p.CheckboxInput,{labelClassName:"u-no-margin--bottom u-no-padding--top",label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${o.name}`}),disabled:h,name:"employee-group-checkbox",checked:s.includes(o.id),onChange:()=>{T(o.id)}})},t]},[s,h,l,a]);return h&&!r?e.jsx(j,{}):!u&&!r?e.jsx(Q,{title:"No employee groups found",body:e.jsx("p",{className:"u-no-margin--bottom",children:`Seems like there are no employee groups to import from ${n.provider.provider_label}.`})}):e.jsxs(e.Fragment,{children:[e.jsx(X,{}),e.jsx(W,{children:"Choose employee groups to import into Landscape. Once imported, you can set their priority, assign autoinstall files, and manage associated employees."}),e.jsx("div",{className:_.checkbox,children:e.jsx(p.CheckboxInput,{label:"Import all groups",onChange:x,checked:a})}),e.jsx(H,{onSearch:t=>{d(t)}}),h?e.jsx(j,{}):e.jsxs(p.Form,{noValidate:!0,onSubmit:L,children:[e.jsx(p.ModularTable,{data:l,columns:A,emptyMsg:`No employee groups found with the search: "${r}"`}),e.jsx(U,{currentPage:m,pageSize:g,paginate:B,setPageSize:F,totalItems:u,className:_.pagination}),e.jsx(Y,{hasBackButton:!0,onBackButtonPress:w,submitButtonText:"Import",submitButtonDisabled:!a&&s.length===0||O})]})]})};export{pe as default};
