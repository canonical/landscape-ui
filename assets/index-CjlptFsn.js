import{j as e,r as w,w as y,y as v,Q as P,g as n,B as _,p as S,x as I,a as U,s as N,h as A,l as j,n as T,C as O}from"./index-Bd4iIRe_.js";import{u as L,A as B}from"./AuthTemplate-zZOi6rmB.js";const R=({methods:s})=>{if(!s)return null;const a=!!(s.standalone_oidc.available&&s.standalone_oidc.enabled),l=!!(s.ubuntu_one.available&&s.ubuntu_one.enabled),i=!!(s.password.available&&s.password.enabled),c=!!(s.pam.available&&s.pam.enabled),m=s.oidc.available?s.oidc.configurations.filter(({enabled:d})=>d):[],o=i||c,b=l||a||s.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[o&&e.jsx(M,{isIdentityAvailable:c}),b&&e.jsx(q,{isStandaloneOidcEnabled:a,isUbuntuOneEnabled:l,oidcProviders:m}),!o&&!b&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},k="_list_9u1s7_1",F="_button_9u1s7_20",Q="_icon_9u1s7_28",u={list:k,button:F,icon:Q},q=({isStandaloneOidcEnabled:s,isUbuntuOneEnabled:a,oidcProviders:l})=>{const[i,c]=w.useState(0),[m]=y(),{invitationId:o}=L(),{getOidcUrlQuery:b,getUbuntuOneUrlQuery:d}=v(),p=m.get("redirect-to"),h=m.has("external"),t={};i>0&&(t.id=i),p&&(t.return_to=p),o&&(t.invitation_id=o),h&&(t.external=!0);const{data:g}=b(t,{enabled:i!==0});w.useEffect(()=>{g&&P(g.data.location)},[g]);const r={};p&&(r.return_to=`${window.origin}${p}`),o&&(r.invitation_id=o),h&&(r.external=!0);const{data:x,refetch:E}=d(r,{enabled:!1});return w.useEffect(()=>{x&&P(x.data.location)},[x]),e.jsxs("ul",{className:u.list,children:[a&&e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:E,className:u.button,children:[e.jsx(n.Icon,{name:_("ubuntu-one"),className:u.icon}),e.jsx("span",{children:"Sign in with Ubuntu One"})]})}),s&&e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:()=>c(-1),className:u.button,children:[e.jsx(n.Icon,{name:_("standalone"),className:u.icon}),e.jsx("span",{children:"Sign in with Enterprise Login"})]})}),l.map(f=>e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:()=>c(f.id),className:u.button,children:[e.jsx(n.Icon,{name:_(f.provider),className:u.icon}),e.jsx("span",{children:`Sign in with ${f.name}`})]})},f.id))]})},C="_buttonRow_f3s21_1",$={buttonRow:C},M=({isIdentityAvailable:s})=>{const[a]=y(),l=S(),{signInWithEmailAndPasswordQuery:i}=v(),{redirectToExternalUrl:c,setAuthLoading:m,setUser:o}=I(),b=U(),d=a.get("redirect-to"),p=a.has("external"),{mutateAsync:h}=i,t=N({initialValues:{email:"",password:""},validationSchema:A().shape({email:s?j().required("This field is required"):j().required("This field is required").email("Please provide a valid email address"),password:j().required("This field is required")}),onSubmit:async g=>{try{const{data:r}=await h({email:g.email,password:g.password});if(p&&d)c(d,{replace:!0});else{"current_account"in r&&(m(!0),o(r));const x=new URL(d??"/overview",location.origin);b(x.toString().replace(x.origin,""),{replace:!0})}}catch(r){l(r)}}});return e.jsxs(n.Form,{onSubmit:t.handleSubmit,children:[e.jsx(n.Input,{type:"text",label:s?"Identity":"Email",error:t.touched.email&&t.errors.email?t.errors.email:void 0,...t.getFieldProps("email"),"data-testid":"email"}),e.jsx(n.PasswordToggle,{id:"password",label:"Password",error:t.touched.password&&t.errors.password?t.errors.password:void 0,...t.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:$.buttonRow,children:e.jsx(n.Button,{type:"submit",appearance:"positive",disabled:t.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},D=()=>{const{getLoginMethodsQuery:s}=v(),{data:a,isLoading:l,isError:i}=s();return e.jsx(B,{title:"Sign in to Landscape",children:l?e.jsx(T,{}):i?e.jsx("p",{className:"u-no-margin--bottom",children:O}):e.jsx(R,{methods:(a==null?void 0:a.data)??null})})};export{D as default};
