import{j as a,d as i,p as F,q as S,n as h,s as x}from"./index-BK1uK3Dg.js";import{A as T}from"./AssociationBlock-CLIfH9Pf.js";import{S as v}from"./SidePanelFormButtons-BuwhTVVp.js";import{u as f}from"./useRoles-DLeJCsKJ.js";import{u as g,V as j,I as A,P as I,b as V,c as C}from"./index-BHm_tYS4.js";import{F as O}from"./FileInput-L7-w0Ijs.js";import{u as w}from"./useGetInstances-DZRSt-9q.js";import{P as E}from"./PackageProfileConstraintsBlock-lxzeZz3f.js";const N=[{label:"Select constraints type",value:""},{label:"From an instance's packages",value:"instance"},{label:"From a CSV file",value:"material"},{label:"Enter manually",value:"manual"}],B="_container_vi1gw_1",R={container:B},q=({formik:e})=>{const{instances:n}=w(),l=n.map(({id:o,title:c})=>({label:c,value:`${o}`}))??[];l.unshift({label:"Select instance",value:""});const u=async o=>{await e.setFieldValue("csvFile",o[0]);const c=await o[0].text();await e.setFieldValue("material",c)},p=async()=>{await e.setFieldValue("csvFile",null),await e.setFieldValue("material",""),await e.setFieldValue("isCsvFileParsed",!1)};return a.jsxs("div",{className:R.container,children:[a.jsx(i.Select,{label:"Package constraints",required:!0,options:N,...e.getFieldProps("constraintsType"),error:e.touched.constraintsType&&e.errors.constraintsType?e.errors.constraintsType:void 0}),e.values.constraintsType==="instance"&&a.jsx(i.Select,{label:"Instance",required:e.values.constraintsType==="instance",options:l,...e.getFieldProps("source_computer_id"),error:e.touched.source_computer_id&&e.errors.source_computer_id?e.errors.source_computer_id:void 0}),e.values.constraintsType==="material"&&a.jsx(O,{label:"Upload constraints",accept:".csv",...e.getFieldProps("csvFile"),onFileRemove:p,onFileUpload:u,help:'File should be formatted as either a package profile CSV file or the output of running "dpkg --get-selections" on a computer with desired packages installed.',error:e.touched.csvFile&&e.errors.csvFile||e.touched.material&&e.errors.material||void 0}),e.values.constraintsType==="manual"&&a.jsx(E,{formik:e})]})},m=()=>{const e=F(),{notify:n}=S(),{closeSidePanel:l}=h(),{getAccessGroupQuery:u}=f(),{createPackageProfileQuery:p}=g(),{data:o}=u(),c=o?.data.map(({name:s,title:r})=>({label:r,value:s}))??[],{mutateAsync:P}=p,t=x({initialValues:A,onSubmit:async s=>{const r={access_group:s.access_group,description:s.description,title:s.title};s.all_computers?r.all_computers=!0:s.tags.length>0&&(r.tags=s.tags),s.constraintsType==="material"?r.material=s.material:s.constraintsType==="instance"?r.source_computer_id=s.source_computer_id:r.constraints=s.constraints.map(({constraint:d,package:_,rule:b,version:y})=>({constraint:d,package:_,rule:b,version:y}));try{await P(r),l(),n.success({message:`Profile "${s.title}" added successfully`,title:"Profile added"})}catch(d){e(d)}},validationSchema:j});return a.jsxs(i.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[a.jsx(i.Input,{type:"text",label:"Title",required:!0,...t.getFieldProps("title"),error:t.touched.title&&t.errors.title?t.errors.title:void 0}),a.jsx(i.Input,{type:"text",label:"Description",required:!0,autoComplete:"off",...t.getFieldProps("description"),error:t.touched.description&&t.errors.description?t.errors.description:void 0}),a.jsx(i.Select,{label:"Access group",...t.getFieldProps("access_group"),options:c,error:t.touched.access_group&&t.errors.access_group?t.errors.access_group:void 0}),a.jsx(T,{formik:t}),a.jsx(q,{formik:t}),a.jsx(v,{submitButtonDisabled:t.isSubmitting,submitButtonText:"Add package profile"})]})},Y=Object.freeze(Object.defineProperty({__proto__:null,default:m},Symbol.toStringTag,{value:"Module"})),k=Object.freeze(Object.defineProperty({__proto__:null,PackageProfileCreateForm:m,PackageProfileHeader:V,PackageProfileList:I,PackageProfilesEmptyState:C,usePackageProfiles:g},Symbol.toStringTag,{value:"Module"}));export{k as a,Y as i};
