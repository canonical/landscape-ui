const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DhmgRd4z.js","assets/index-CNSDWj8Q.js","assets/index-CoB-_C5O.css","assets/InfoGrid-3w5mqARw.js","assets/InfoItem-Bt7JBIPo.js","assets/NoData-6ZK9sV5u.js","assets/Truncated-Dtg97i8C.js","assets/Truncated-uqJp6ujM.css","assets/InfoItem-D8nPzgUA.css","assets/InfoGrid-D3QqOHFx.css","assets/index-D-YBZSy_.js","assets/TablePagination-CFXNvqsZ.js","assets/TableFilterChips-06YfpJdc.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-CLgA9gvz.css","assets/useFetchOld-BAAs34Op.js","assets/PageParamFilter-ChSwlZqZ.js","assets/TableFilter-2AKF5NjJ.js","assets/TableFilter-B85Stwni.css","assets/formikErrors-Bw8iTXYS.js","assets/ResponsiveTable-BXalKviy.js","assets/ResponsiveTable-DsN8RVSX.css","assets/index-B1ULwG00.css","assets/constants-CnStqPYr.js","assets/helpers-kPKhnyjI.js","assets/DeliveryBlock-B3k_IVND.js","assets/RadioGroup-BVZkBsDq.js","assets/RadioGroup-WBbAFTwm.css","assets/RandomizationBlock-DfhzodqZ.js","assets/PageMain-C8MVZwda.js","assets/PageMain-C_v2-kHh.css","assets/useGetInstance-BgZN2sNQ.js","assets/InstancesPageActions-DL7_pmR1.js","assets/ListTitle-BUruUKn1.js","assets/ListTitle-CxCHkD9o.css","assets/StaticLink-BEYCGcPv.js","assets/TruncatedCell-BMum6DLZ.js","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-B4jhRgod.js","assets/index-CySvbr4l.js","assets/TextConfirmationModal-q88mH05g.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/InstancesPageActions-h3D4euDx.css","assets/useUsns-dCIdMk13.js","assets/constants-CDnVvJTb.js","assets/useUsns-BR-xUdoS.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-BgoTZNaO.js","assets/constants-Dwl1JGyb.js","assets/index-C86M02iz.js","assets/index-IabpLDeS.js","assets/Blocks-yjg-J-3E.js","assets/Blocks-bdK2PNd9.css","assets/Chip-O7cCAuuh.js","assets/Chip-R6WqXyae.css","assets/EmployeeList-CKLLomOE.js","assets/EmployeeList-CnpN88if.css","assets/InstanceRemoveFromLandscapeModal-B5sQZb1c.js","assets/useRemoveInstancesFromLandscape-BuxxHEvw.js","assets/useRoles-DYJzr0u4.js","assets/SidePanel-ChyjtMJv.js","assets/SidePanel-C17_jvtU.css","assets/WslInstancesEmptyState-Lmf8S52Y.js","assets/HeaderWithSearch-D2tNhOlz.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/WslInstancesEmptyState-CBT5OoUG.css","assets/index-CO4nU9fz.css","assets/index-Ddcol15e.js","assets/index-BzXEPdn_.css","assets/index-0gD9W2gP.js","assets/index-7UrHI2Pp.css","assets/index-CPQSsol5.js","assets/useSelection-BsZpRomB.js","assets/index-B0p01W4u.css","assets/index-BWVJmXyp.js","assets/useGetActivities-D8Cf65ac.js","assets/ActivitiesEmptyState-DADfAFyz.js","assets/index-D1ucvfhf.js","assets/index-BKEuJIL_.css","assets/index-D-nHfR4P.js","assets/useGetWslLimits-BVyD1a37.js","assets/index-BfpW9K9I.css","assets/index-C8xZG_D3.js","assets/SidePanelFormButtons-DIizKTix.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/helpers-CHVZpA7p.js","assets/index-DQLukqVs.css","assets/index-DrrSPHcY.js","assets/UsnList-DuKyK0cc.js","assets/SelectAllButton-DqKWLeLb.js","assets/ExpandableTableFooter-DEy5-E1E.js","assets/ExpandableTableFooter-CF0EpBAN.css","assets/UsnList-C7uwsPil.css","assets/index-CsHgpdRJ.css","assets/index-DUyEcfbY.js","assets/UbuntuProList-BZXPmBGO.js","assets/UbuntuProList-D3Pk1SjQ.css","assets/index-CcvtpUcz.js","assets/downshift.esm-DADdD-V8.js","assets/index-BfWSuliH.css"])))=>i.map(i=>d[i]);
import{x as v,j as e,d as b,r as a,e as c,_ as u,f as T,t as F,v as y,c as I,N as P,E as K,R as j,u as E,q as Q,ae as A,C}from"./index-CNSDWj8Q.js";import{P as D,a as V,b as O}from"./PageMain-C8MVZwda.js";import{u as z}from"./useGetInstance-BgZN2sNQ.js";import{R as U,r as x}from"./InstancesPageActions-DL7_pmR1.js";import"./index-CySvbr4l.js";import"./InfoGrid-3w5mqARw.js";import{u as B,a as N}from"./useUsns-dCIdMk13.js";import"./index-D-YBZSy_.js";import{c as q}from"./SingleInstanceTabs.module-Cm1BYFZQ.js";const $="_container_1n2sa_1",H={container:$},G=a.lazy(async()=>u(()=>import("./index-DhmgRd4z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47]))),M=a.lazy(async()=>u(()=>import("./index-BgoTZNaO.js"),__vite__mapDeps([48,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,49,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47]))),W=a.lazy(async()=>u(()=>import("./index-C86M02iz.js"),__vite__mapDeps([50,1,2,10,5,11,12,13,14,15,16,17,18,19,20,21,22,32,33,34,35,36,6,7,37,38,39,40,41,3,4,8,9,42,49,24,25,26,27,28,29,30,31,43,44,45,46,47]))),Qe=({instanceName:n,hasTableData:s,kernelStatuses:t})=>{const{setSidePanelContent:d}=v(),p=t?.installed?.version_rounded??"",g=t?.downgrades??[],i=t?.upgrades??[],l=()=>{d("Downgrade kernel",e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(G,{instanceName:n,currentKernelVersion:p,downgradeKernelVersions:g})}))},r=()=>{d("Upgrade kernel",e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(M,{instanceName:n,currentKernelVersion:p,upgradeKernelVersions:i})}))},k=()=>{d(`Restart ${n}`,e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(W,{instanceName:n,showNotification:s,newKernelVersionId:i[0]?.id})}))};return e.jsxs("div",{className:H.container,children:[e.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:"Kernel overview"}),e.jsx(U,{collapseFrom:"lg",buttons:[e.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:k,children:[e.jsx(b.Icon,{name:"restart"}),e.jsx("span",{children:"Restart instance"})]},"restart-instance"),e.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:g.length===0,onClick:l,children:[e.jsx(b.Icon,{name:"begin-downloading"}),e.jsx("span",{children:"Downgrade kernel"})]},"downgrade-kernel"),e.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:i.length===0,onClick:r,children:[e.jsx(b.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade kernel"})]},"upgrade-kernel")]})]})};function J(){const n=T(),s=F(),t=({id:i},l={})=>I({queryKey:["kernel",i],queryFn:async()=>n.get(`computers/${i}/livepatch/kernel`),...l}),d=({id:i,...l},r={})=>I({queryKey:["kernel",{id:i,...l}],queryFn:async()=>n.get(`computers/${i}/livepatch/info`,{params:l}),...r}),p=y({mutationKey:["kernel","downgrade"],mutationFn:async({id:i,...l})=>n.post(`computers/${i}/kernel/downgrade`,l),onSuccess:async()=>s.invalidateQueries({queryKey:["kernel"]})}),g=y({mutationKey:["kernel","upgrade"],mutationFn:async({id:i,...l})=>n.post(`computers/${i}/kernel/upgrade`,l),onSuccess:async()=>s.invalidateQueries({queryKey:["kernel"]})});return{getKernelQuery:t,getLivepatchInfoQuery:d,downgradeKernelQuery:p,upgradeKernelQuery:g}}const X=({childInstanceId:n,instanceId:s})=>{const t=P();return e.jsx(K,{title:"Instance not found",icon:"connected",body:e.jsxs("p",{className:"u-no-margin--bottom",children:[e.jsx("span",{children:"Seems like the instance with id = "}),e.jsx("code",{children:s}),e.jsx("span",{children:" doesn't "}),n?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"have a child instance with id = "}),e.jsx("code",{children:n})]}):e.jsx("span",{children:"exist"}),"."]}),cta:[e.jsx(b.Button,{appearance:"positive",onClick:async()=>t(j.instances.root(),{replace:!0}),type:"button","aria-label":"Go back",children:"Back to Instances page"},"go-back-to-instances-page"),e.jsx(b.Button,{onClick:async()=>t(j.root.root(),{replace:!0}),type:"button","aria-label":"Go back",children:"Home page"},"go-back-to-home-page")]})},Y=({id:n,label:s,packageCount:t,packagesLoading:d,usnCount:p,usnLoading:g,kernelCount:i,kernelLoading:l})=>n==="tab-link-packages"&&d||n==="tab-link-security-issues"&&g||n==="tab-link-kernel"&&l?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Spinner,{className:"u-no-margin--bottom u-no-padding--top"})]}):n==="tab-link-packages"&&t?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Badge,{value:t})]}):n==="tab-link-security-issues"&&p?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Badge,{value:p,isNegative:!0})]}):n==="tab-link-kernel"&&i?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Badge,{value:i})]}):s,Z=({activeTabId:n,instance:s,onActiveTabChange:t,packageCount:d,packagesLoading:p,usnCount:g,usnLoading:i,kernelCount:l,kernelLoading:r})=>{const{isFeatureEnabled:k}=E();return[{label:"Info",id:"tab-link-info",included:!0},{label:"WSL",id:"tab-link-wsl",included:x(s).wsl&&k("wsl-child-instance-profiles")},{label:"Activities",id:"tab-link-activities",included:!0},{label:"Kernel",id:"tab-link-kernel",included:x(s).packages},{label:"Security issues",id:"tab-link-security-issues",included:x(s).packages},{label:"Packages",id:"tab-link-packages",included:x(s).packages},{label:"Snaps",id:"tab-link-snaps",included:x(s).snaps},{label:"Processes",id:"tab-link-processes",included:x(s).processes},{label:"Ubuntu Pro",id:"tab-link-ubuntu-pro",included:x(s).pro},{label:"Users",id:"tab-link-users",included:x(s).users},{label:"Hardware",id:"tab-link-hardware",included:x(s).hardware}].filter(h=>h.included).map(({label:h,id:_})=>({label:Y({label:h,id:_,packageCount:d,packagesLoading:p,usnCount:g,usnLoading:i,kernelCount:l,kernelLoading:r}),id:_,role:"tab",active:_===n,onClick:()=>{t(_)}}))},ee=a.lazy(async()=>u(()=>import("./index-IabpLDeS.js").then(n=>n.i),__vite__mapDeps([51,1,2,40,41,52,53,54,55,32,10,5,11,12,13,14,15,16,17,18,19,20,21,22,33,34,35,36,6,7,37,38,39,3,4,8,9,42,56,44,57,58,59,60,61,62,63,64,65,66,67]))),ne=a.lazy(async()=>u(()=>import("./index-Ddcol15e.js"),__vite__mapDeps([68,1,2,11,12,13,14,20,21,64,65,69]))),se=a.lazy(async()=>u(()=>import("./index-0gD9W2gP.js"),__vite__mapDeps([70,1,2,52,53,3,4,5,6,7,8,9,71]))),te=a.lazy(async()=>u(()=>import("./index-CPQSsol5.js"),__vite__mapDeps([72,1,2,11,12,13,14,43,44,32,10,5,15,16,17,18,19,20,21,22,33,34,35,36,6,7,37,38,39,40,41,3,4,8,9,42,45,64,65,73,74]))),ae=a.lazy(async()=>u(()=>import("./index-BWVJmXyp.js"),__vite__mapDeps([75,1,2,10,5,11,12,13,14,15,16,17,18,19,20,21,22,73,76,77]))),re=a.lazy(async()=>u(()=>import("./index-D1ucvfhf.js"),__vite__mapDeps([78,1,2,11,12,13,14,3,4,5,6,7,8,9,20,21,29,30,31,32,10,15,16,17,18,19,22,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,79]))),ie=a.lazy(async()=>u(()=>import("./index-D-nHfR4P.js"),__vite__mapDeps([80,1,2,32,10,5,11,12,13,14,15,16,17,18,19,20,21,22,33,34,35,36,6,7,37,38,39,40,41,3,4,8,9,42,81,61,62,52,53,44,73,63,64,65,66,59,82]))),le=a.lazy(async()=>u(()=>import("./index-C8xZG_D3.js").then(n=>n.i),__vite__mapDeps([83,1,2,11,12,13,14,84,85,86,19,87,32,10,5,15,16,17,18,20,21,22,33,34,35,36,6,7,37,38,39,40,41,3,4,8,9,42,64,65,44,88]))),oe=a.lazy(async()=>u(()=>import("./index-DrrSPHcY.js"),__vite__mapDeps([89,1,2,10,5,11,12,13,14,15,16,17,18,19,20,21,22,43,44,32,33,34,35,36,6,7,37,38,39,40,41,3,4,8,9,42,45,64,65,90,91,92,93,94,95]))),ce=a.lazy(async()=>u(()=>import("./index-DUyEcfbY.js"),__vite__mapDeps([96,1,2,10,5,11,12,13,14,15,16,17,18,19,20,21,22,32,33,34,35,36,6,7,37,38,39,40,41,3,4,8,9,42,97,98]))),ue=a.lazy(async()=>u(()=>import("./index-CcvtpUcz.js"),__vite__mapDeps([99,1,2,11,12,13,14,84,85,86,100,64,65,32,10,5,15,16,17,18,19,20,21,22,33,34,35,36,6,7,37,38,39,40,41,3,4,8,9,42,87,24,25,26,27,28,101]))),de=({instance:n,packageCount:s,packagesLoading:t,usnCount:d,usnLoading:p,kernelCount:g,kernelLoading:i})=>{const{closeSidePanel:l}=v(),{tab:r,setPageParams:k}=Q(),o=r?`tab-link-${r}`:"tab-link-info",h=Z({activeTabId:o,instance:n,onActiveTabChange:_=>{k({tab:_.replace("tab-link-","")}),l()},packageCount:s,packagesLoading:t,usnCount:d,usnLoading:p,kernelCount:g,kernelLoading:i});return e.jsxs(e.Fragment,{children:[e.jsx(b.Tabs,{listClassName:"u-no-margin--bottom",links:h}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":o,className:q.tabPanel,children:e.jsxs(A,{children:[o==="tab-link-info"&&e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(ee,{instance:n})}),o==="tab-link-wsl"&&e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(ie,{instance:n})}),o==="tab-link-activities"&&e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(ae,{instanceId:n.id})}),o==="tab-link-kernel"&&e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(re,{instanceTitle:n.title})}),o==="tab-link-security-issues"&&e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(oe,{instance:n})}),o==="tab-link-packages"&&e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(te,{})}),o==="tab-link-snaps"&&e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(ue,{})}),o==="tab-link-processes"&&e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(ne,{})}),o==="tab-link-ubuntu-pro"&&e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(ce,{instance:n})}),o==="tab-link-users"&&e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(le,{})}),o==="tab-link-hardware"&&e.jsx(a.Suspense,{fallback:e.jsx(c,{}),children:e.jsx(se,{instance:n})})]})})]})},pe=n=>{if(n)return n.parent?[{label:"Instances",path:j.instances.root()},{label:n.parent.title,path:j.instances.details.single(n.parent.id)},{label:n.title,current:!0}]:[{label:"Instances",path:j.instances.root()},{label:n.title,current:!0}]},be=n=>{if(!(!n||n.length===0||!n[0]?.Livepatch?.Fixes))return n[0].Livepatch.Fixes.length},ge=(n,s)=>n.distribution?s:0,xe=(n,s)=>n.distribution?s:0,_e=n=>n?.title??"",ke=(n,s)=>parseInt(s||(n??"")),he=(n,s,t)=>!!n&&(!s||s===t),je=(n,s,t)=>!!n&&x(n).packages&&(!t||n.parent?.id===parseInt(s??"")),me=(n,s,t)=>!!n&&x(n).packages&&(!t||n.parent?.id===parseInt(s??"")),ye=(n,s,t)=>!!n&&x(n).packages&&(!t||n.parent?.id===parseInt(s??"")),Ie=n=>n?[n.id]:[],f=n=>n?n.id:0,fe=(n,s,t)=>n&&(!t||n.parent&&n.parent.id===parseInt(s??"")),ve=()=>{const{instanceId:n,childInstanceId:s}=C(),{user:t}=E(),d=P(),{getUsnsQuery:p}=B(),{getInstancePackagesQuery:g}=N(),{getLivepatchInfoQuery:i}=J(),l=a.useRef("");a.useEffect(()=>{t?.current_account&&(l.current||(l.current=t.current_account),l.current!==t.current_account&&d(j.instances.root(),{replace:!0}))},[t?.current_account]);const{instance:r,isGettingInstance:k}=z({instanceId:ke(n,s),with_annotations:!0,with_grouped_hardware:!0,with_profiles:!0},{enabled:he(n,l.current,t?.current_account)}),{data:o,isLoading:h}=p({computer_ids:Ie(r),limit:1},{enabled:ye(r,n,s)}),{data:_,isLoading:L}=g({available:!1,upgrade:!0,instance_id:f(r),limit:1},{enabled:je(r,n,s)}),{data:S,isLoading:R}=i({id:f(r)},{enabled:me(r,n,s)}),w=be(S?.data.livepatch_info?.json?.output?.Status),m=fe(r,n,s);return e.jsxs(D,{children:[e.jsx(V,{title:_e(r),hideTitle:!0,breadcrumbs:pe(r)}),e.jsx(O,{children:k?e.jsx(c,{}):e.jsxs(e.Fragment,{children:[!m&&e.jsx(X,{childInstanceId:s,instanceId:n}),r&&m&&e.jsx(de,{instance:r,packageCount:ge(r,Number(_?.data.count)),packagesLoading:L,usnCount:xe(r,Number(o?.data.count)),usnLoading:h,kernelCount:r.distribution?w:0,kernelLoading:R})]})})]})},Ae=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{Qe as K,Ae as i,J as u};
