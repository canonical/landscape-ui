import{d as y,j as n,s as S,h as F,i as B,l as k,g as l,f as U,m as $}from"./index-F5ixs2NP.js";import{u as L}from"./useFetchOld-IYQtjqtR.js";import{S as N}from"./SidePanelFormButtons-CsLLCRpy.js";import"./SidePanelFormButtons.module-tJTvEwdD.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},i=new e.Error().stack;i&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[i]="4d33104c-6c5c-43f6-ba19-508ad5fe981c",e._sentryDebugIdIdentifier="sentry-dbid-4d33104c-6c5c-43f6-ba19-508ad5fe981c")}catch{}function D(){const e=L();return{getCsvComplianceData:(t={},s={})=>y({queryKey:["csvComplianceData",t],queryFn:()=>e.get("GetCSVComplianceData",{params:t}),...s}),getInstancesNotUpgraded:(t={},s={})=>y({queryKey:["instancesNotUpgraded",t],queryFn:()=>e.get("GetComputersNotUpgraded",{params:t}),...s}),getNotPingingInstances:(t,s={})=>y({queryKey:["notPingingInstances",t],queryFn:()=>e.get("GetNotPingingComputers",{params:t}),...s}),getUsnTimeToFix:(t={},s={})=>y({queryKey:["usnTimeToFix",t],queryFn:()=>e.get("GetUSNTimeToFix",{params:t}),...s}),getUpgradedInstancesByFrequency:(t={},s={})=>y({queryKey:["upgradedInstancesByFrequency",t],queryFn:()=>e.get("GetUpgradedComputersByFrequency",{params:t}),...s})}}const O="_header_1kqll_1",V="_lineContainer_1kqll_8",E="_line_1kqll_8",b={header:O,lineContainer:V,line:E},C=({currentCount:e,negativeDescription:i,positiveDescription:d,title:a,totalCount:c})=>{const r=(100*e/c).toFixed();return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:b.header,children:[n.jsx("span",{children:a}),n.jsx("span",{children:`${r}%`})]}),n.jsx("div",{className:b.lineContainer,children:n.jsx("div",{className:b.line,style:{width:`${r}%`}})}),n.jsx("p",{className:"u-text--muted p-text--small",children:d}),n.jsx("p",{className:"u-text--muted p-text--small u-no-margin--bottom",children:i})]})},G="_rowContainer_q14my_7",K="_row_q14my_7",x={rowContainer:G,row:K},z="_rangeContainer_1omsg_1",W={rangeContainer:z},I=(e,i)=>{const d=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(d),c=document.createElement("a");c.href=a,c.download=i,document.body.appendChild(c),c.click(),document.body.removeChild(c)},P=({instanceIds:e})=>{const{getCsvComplianceData:i}=D(),{data:d}=i({query:`id:${e.join(" OR id:")}`}),a=S({initialValues:{range:0,reportByCve:!0},validationSchema:F({range:k().required("This field is required"),reportByCve:B()}),onSubmit:()=>I((d==null?void 0:d.data)||"","report.csv")});return n.jsxs(l.Form,{onSubmit:a.handleSubmit,noValidate:!0,children:[n.jsx(l.CheckboxInput,{label:"Report by CVE",inline:!0,...a.getFieldProps("reportByCve"),checked:a.values.reportByCve}),n.jsxs("div",{className:W.rangeContainer,children:[n.jsx(l.Input,{type:"number",label:"Range",className:"u-no-margin--bottom",style:{maxWidth:"min-content"},...a.getFieldProps("range"),error:a.touched.range&&a.errors.range?a.errors.range:void 0}),n.jsx("span",{children:"Days"})]}),n.jsx(N,{submitButtonDisabled:!1,submitButtonText:"Download"})]})},M=({instanceIds:e})=>{const{setSidePanelContent:i}=U(),{getNotPingingInstances:d,getInstancesNotUpgraded:a,getUsnTimeToFix:c}=D(),{data:r,isLoading:t}=d({since_minutes:5,query:`id:${e.join(" OR id:")}`}),s=r?e.length-r.data.length:0,{data:g,isLoading:_}=a({query:`id:${e.join(" OR id:")}`}),j=g?e.length-g.data.length:0,{data:o,isLoading:f}=c({query:`id:${e.join(" OR id:")}`,fixed_in_days:[2,14,30,60]}),p={month:(o==null?void 0:o.data[30].length)||0,old:(o==null?void 0:o.data[60].length)||0,pending:(o==null?void 0:o.data.pending.length)||0,recent:(o==null?void 0:o.data[2].length)||0,twoWeeks:(o==null?void 0:o.data[14].length)||0},v={recent:2,twoWeeks:14,month:30,old:60},w=(h,m)=>{const u=m==="positive"?p[h]:e.length-p[h];return u!==1?`${u||"No"} instances have${m==="negative"?" not":""} applied USNs in ${v[h]} days or less.`:`1 instance has${m==="negative"?" not":""} applied USNs in ${v[h]} days or less.`},q=()=>{i("Download report as CSV",n.jsx(P,{instanceIds:e}))};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:x.rowContainer,children:n.jsxs(l.Row,{className:$("u-no-padding--left u-no-padding--right",x.row),children:[n.jsx(l.Col,{size:6,children:!f&&n.jsx(C,{currentCount:e.length-p.pending,negativeDescription:`${p.pending||"No"} instance${p.pending!==1?"s are":" is"} not yet patched.`,positiveDescription:`${e.length-p.pending||"No"} instance${e.length-p.pending!==1?"s are":" is"} securely patched.`,title:"Securely patched",totalCount:e.length})}),n.jsx(l.Col,{size:6,children:!_&&n.jsx(C,{currentCount:j,negativeDescription:`${(g==null?void 0:g.data.length)||"No"} instance${(g==null?void 0:g.data.length)!==1?"s are":" is"} not covered by upgrade profiles.`,positiveDescription:`${j||"No"} instance${j!==1?"s are":" is"} covered by upgrade profiles.`,title:"Upgrade profiles",totalCount:e.length})}),n.jsx(l.Col,{size:6,children:!t&&n.jsx(C,{currentCount:s,negativeDescription:`${(r==null?void 0:r.data.length)||"No"} instance${(r==null?void 0:r.data.length)!==1?"s have":" has"} not contacted the server within the last 5 minutes.`,positiveDescription:`${s||"No"} instance${s!==1?"s have":" has"} contacted the server within the last 5 minutes.`,title:"Contacted",totalCount:e.length})})]})}),!f&&n.jsxs("div",{className:x.rowContainer,children:[n.jsx("h4",{children:"Security upgrades"}),n.jsx(l.Row,{className:$("u-no-padding--left u-no-padding--right",x.row),children:Object.entries(v).map(([h,m])=>{const u=h;return n.jsx(l.Col,{size:6,children:n.jsx(C,{currentCount:p[u],negativeDescription:w(u,"negative"),positiveDescription:w(u,"positive"),title:`${m} days`,totalCount:e.length})},u)})})]}),n.jsx(N,{submitButtonDisabled:!1,submitButtonText:"Download as CSV",onSubmit:q})]})};export{M as default};
