import{j as e,r as p,B as F,ao as G,p as c,d,q as B}from"./index-DHd_VY7f.js";import{b as H,u as K}from"./ScriptsTabs-BP6MVPvz.js";import"./index-Das6rBfU.js";import{D as V}from"./downshift.esm-Clcb7K1X.js";const Y="_container_h0o6i_1",$="_suggestionsContainer_h0o6i_6",z="_pointer_h0o6i_13",J="_highlighted_h0o6i_18",M="_selectedContainer_h0o6i_22",Q="_marginTop_h0o6i_30",W="_extraPadding_h0o6i_34",X="_removeButton_h0o6i_44",Z="_icon_h0o6i_48",o={container:Y,suggestionsContainer:$,pointer:z,highlighted:J,selectedContainer:M,marginTop:Q,extraPadding:W,removeButton:X,icon:Z},I=200,ee=(n,a)=>{const s=n.toLowerCase(),h=a.toLowerCase(),r=s.indexOf(h);return r>=0?e.jsxs(e.Fragment,{children:[n.substring(0,r),e.jsx("strong",{children:n.substring(r,r+a.length)}),n.substring(r+a.length)]}):n},re=({script:n,setScript:a,existingScriptId:s,errorMessage:h,parentAccessGroup:r})=>{const[l,b]=p.useState(""),[m,u]=p.useState(!1),[g,x]=p.useState(""),{script:i,isScriptLoading:D}=H(s||0,{enabled:!!s});p.useEffect(()=>{s&&(n==null?void 0:n.id)!==(i==null?void 0:i.id)&&a(i)},[i]);const w=F(),{scripts:j,isScriptsLoading:_}=K({listenToUrlParams:!1},{search:l,script_type:"active",limit:20,offset:0,parent_access_group:r},{enabled:l.length>2}),E=t=>(n==null?void 0:n.id)!==t.id,C=j.filter(E),y=()=>{a(null)},L=()=>{u(!1)},N=()=>{x(""),b("")},S=()=>{g.length>2?u(!0):u(!1)},O=t=>{x(t),t.length>2&&b(t)},P=G(()=>{try{S()}catch(t){w(t)}},I),R=t=>{t&&(a(t),u(!1),N())},U=t=>{t.key==="Escape"?t.currentTarget.blur():P()},v=g.length<3?"Min 3. characters":j.length===0&&l&&!_?`No scripts found by "${l}"`:s?"Scripts can't be replaced after the profile has been created.":null;return e.jsxs("div",{className:c(o.container,"p-form__group p-form-validation"),children:[e.jsx("label",{className:"is-required p-form__label",htmlFor:s?"script-selected":"script-search",children:"Script"}),!s&&e.jsx(V,{onSelect:R,itemToString:()=>"",isOpen:m,children:({getInputProps:t,getItemProps:k,getMenuProps:q,highlightedIndex:A})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(d.SearchBox,{...t(),id:s?void 0:"script-search",placeholder:"Search for scripts",required:!0,className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:g,onChange:O,onClear:N,onBlur:L,onFocus:S,onKeyUp:U}),v?e.jsx("span",{className:"p-form-help-text",children:v}):null,h&&!m?e.jsx("div",{className:"is-error",children:e.jsx("span",{className:"p-form-validation__message",id:"script-error",children:e.jsx("span",{children:h})})}):null,m&&(C.length>0||_)?e.jsx("ul",{className:c("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",o.suggestionsContainer),...q(),children:_?e.jsx(B,{}):C.map((f,T)=>e.jsx("li",{className:c("p-list__item",o.pointer,{[o.highlighted]:A===T}),...k({item:f,index:T}),children:e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:ee(f.title,l)})},f.id))}):null]})}),D?e.jsx(B,{}):null,n&&e.jsxs("div",{id:"script-selected",className:c("p-autocomplete__result p-list__item p-card u-no-margin--bottom",o.selectedContainer,{[o.marginTop]:!s,[o.extraPadding]:s}),children:[e.jsx("span",{children:e.jsx("b",{children:n.title})}),s?null:e.jsx(d.Button,{type:"button",appearance:"base",className:c(o.removeButton,"u-no-margin--bottom u-no-margin--right"),onClick:y,children:e.jsx(d.Tooltip,{message:"Remove",children:e.jsx(d.Icon,{name:d.ICONS.delete,className:o.icon})})})]},n.id)]})};export{re as S};
