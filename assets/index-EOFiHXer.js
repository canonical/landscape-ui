const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BeA_W-tX.js","assets/index-s35ejirV.js","assets/index-D38JayDC.css","assets/PackageProfileConstraintsBlock-BtBJITuF.js","assets/CellInput-C2v1Ukzj.js","assets/index-DkHkKWVB.js","assets/PageMain-DeM14AjS.js","assets/PageMain--v5xNZ5p.css","assets/useFetchOld-HMQCoS0J.js","assets/HeaderWithSearch-BvtZsFie.js","assets/usePageParams-DDdJJLtL.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SidePanelTablePagination-djn8RHN0.js","assets/TablePaginationBase-BMVBZ47h.js","assets/TablePaginationBase-CJl3HN1X.css","assets/useRoles-C2DApip-.js","assets/TableFilterChips-CjEBdMMo.js","assets/TableFilterChips-CHqetGbX.css","assets/index-CftlxUAr.css","assets/PackageProfileConstraintsBlock-BiZCuDKK.css","assets/SidePanelFormButtons-BlvwIVvp.js","assets/SidePanelFormButtons.module-tJTvEwdD.js","assets/SidePanelFormButtons-Cl1KfOFD.css"])))=>i.map(i=>d[i]);
import{p as F,q as $,f as O,j as n,g as r,r as C,n as T,_ as B,m as E,h as L,k as v,i as q,l as D,s as H}from"./index-s35ejirV.js";import{H as W}from"./HeaderWithSearch-BvtZsFie.js";import{u as V,L as M,C as z,a as A}from"./index-DkHkKWVB.js";import{C as w}from"./CellInput-C2v1Ukzj.js";import{S as U}from"./SidePanelTablePagination-djn8RHN0.js";import"./usePageParams-DDdJJLtL.js";import"./PageMain-DeM14AjS.js";import"./useFetchOld-HMQCoS0J.js";import"./useRoles-C2DApip-.js";import"./TableFilterChips-CjEBdMMo.js";import"./TablePaginationBase-BMVBZ47h.js";try{let a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new a.Error().stack;e&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[e]="2555f942-202e-44bb-a2d4-6351052028a3",a._sentryDebugIdIdentifier="sentry-dbid-2555f942-202e-44bb-a2d4-6351052028a3")}catch{}const G=[{label:"All",value:""},{label:"Conflicts",value:"conflicts"},{label:"Depends",value:"depends"}],Q="_container_scrq4_1",Y={container:Q},J=C.lazy(()=>B(()=>import("./index-BeA_W-tX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))),K=({filter:a,formik:e,onFilterChange:o,profile:s,selectedIds:d,setSelectedIds:g})=>{const x=F(),{notify:l}=$(),{setSidePanelContent:p}=O(),{removePackageProfileConstraintsQuery:m}=V(),{mutateAsync:N,isPending:h}=m,b=async()=>{try{await N({constraint_ids:d,name:s.name}),g([]),l.success({message:`${d.length} "${s.name}" profile's ${d.length===1?"constraint":"constraints"} removed successfully`,title:`Package profile ${d.length===1?"constraint":"constraints"} removed`})}catch(t){x(t)}},P=()=>{p(`Add package constraints to "${s.name}" profile`,n.jsx(C.Suspense,{fallback:n.jsx(T,{}),children:n.jsx(J,{profile:s})}),"medium")};return n.jsxs("div",{className:Y.container,children:[n.jsx(r.Select,{label:"Constraint type",className:"u-no-margin--bottom",labelClassName:"u-no-padding--top",options:G,value:a,onChange:t=>o(t.target.value)}),n.jsxs(r.ConfirmationButton,{className:"has-icon u-no-margin--right u-no-margin--bottom",type:"button",disabled:d.length===0||e.values.id!==0,"aria-label":`Remove selected ${d.length===1?"constraint":"constraints"}`,confirmationModalProps:{title:`Remove ${d.length===1?"constraint":"constraints"}`,children:n.jsxs("p",{children:["This will remove ",d.length," ",d.length===1?"constraint":"constraints","."]}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:h,confirmButtonLoading:h,onConfirm:b},children:[n.jsx(r.Icon,{name:r.ICONS.delete}),n.jsx("span",{children:"Remove"})]}),n.jsxs(r.Button,{className:"u-no-margin--bottom",type:"button",hasIcon:!0,onClick:P,"aria-label":"Add new constraint",children:[n.jsx(r.Icon,{name:r.ICONS.plus}),n.jsx("span",{children:"Add constraints"})]})]})},X="_actionButton_14uri_1",Z="_tooltip_14uri_5",j={actionButton:X,tooltip:Z},ee=({constraint:a,formik:e})=>e.values.id===a.id?n.jsxs(n.Fragment,{children:[n.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:E("u-no-margin--bottom u-no-padding",j.actionButton),onClick:()=>e.handleSubmit(),children:n.jsx(r.Tooltip,{tooltipClassName:j.tooltip,message:"Save changes",children:n.jsx(r.Icon,{name:"success-grey",className:"u-no-margin--left u-no-margin--right"})})}),n.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>e.resetForm(),"aria-label":`Cancel editing ${a.package} constraint`,children:n.jsx(r.Tooltip,{tooltipClassName:j.tooltip,message:"Cancel",children:n.jsx(r.Icon,{name:"error-grey",className:"u-no-margin--left u-no-margin--right"})})})]}):n.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>e.setValues(a),disabled:e.values.id!==0,"aria-label":`Edit ${a.package} constraint`,children:n.jsx(r.Tooltip,{tooltipClassName:j.tooltip,message:"Edit constraint",children:n.jsx(r.Icon,{name:"edit",className:"u-no-margin--left u-no-margin--right"})})}),ne="_actionsCell_71g5f_1",ae="_noPadding_71g5f_7",te="_cell_71g5f_11",se="_input_71g5f_23",oe="_inputWrapper_71g5f_31",re="_hidden_71g5f_37",u={actionsCell:ne,noPadding:ae,cell:te,input:se,inputWrapper:oe,hidden:re},ie=async(a,e,o)=>{await a.setFieldValue(`${e}`,o),await a.setFieldTouched(`${e}`,!0),["rule","version"].includes(`${e}`)&&(o!==""?await a.setFieldValue("notAnyVersion",!0):a.values[e==="rule"?"version":"rule"]===""&&await a.setFieldValue("notAnyVersion",!1))},le=(a,e)=>{if(!(!a.touched[e]||!a.errors[e]))return a.errors[e]},ce=a=>({handleConstraintPropChange:(e,o)=>ie(a,e,o),getConstraintPropError:e=>le(a,e)}),de=({column:a,row:e},o)=>{const s={};return s.className=E(u.cell,{[u.noPadding]:e.original.id===o}),e.original.package==="loading"?a.id==="package"?s.colSpan=5:(s.className=u.hidden,s["aria-hidden"]=!0):a.id==="package"?s.role="rowheader":a.id==="actions"?s["aria-label"]="Actions":a.id==="constraint"?s["aria-label"]="Constraint":a.id==="version"?s["aria-label"]="Version":a.id==="rule"&&(s["aria-label"]="Rule"),s},ue=(a,e)=>{let o="No constraints found";return a&&(o+=` with the constraint type: "${a}"`,e&&(o+=" and")),e&&(o+=` with the search: "${e}"`),o},ge=({filter:a,formik:e,isConstraintsLoading:o,onSelectedIdsChange:s,pageSize:d,profileConstraints:g,search:x,selectedIds:l})=>{const p=C.useMemo(()=>{if(o)return[M];if(!g)return[];const t=g.map(c=>({...c,notAnyVersion:!!c.version}));return e.values.id!==-1?t:[e.values,...t].slice(0,d)},[o,g,e.values,d]),m=()=>{s(l.length?[]:p.map(({id:t})=>t))},N=t=>{l.includes(t)?s(l.filter(c=>c!==t)):s([...l,t])},{handleConstraintPropChange:h,getConstraintPropError:b}=ce(e),P=C.useMemo(()=>[{accessor:"constraint",Header:()=>n.jsxs(n.Fragment,{children:[n.jsx(r.CheckboxInput,{inline:!0,label:n.jsx("span",{className:"u-off-screen",children:"Toggle all constraints"}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:e.values.id!==0||p.length===0,checked:p.length>0&&p.length===l.length,indeterminate:l.length>0&&l.length<p.length,onChange:m}),n.jsx("span",{children:"Constraint"})]}),Cell:({row:{original:t}})=>e.values.id===t.id?n.jsx(r.Select,{label:"Constraint",labelClassName:"u-off-screen",className:u.input,wrapperClassName:u.inputWrapper,options:z,...e.getFieldProps("constraint"),onChange:c=>h("constraint",c.target.value),error:b("constraint")}):n.jsxs("div",{className:u.checkboxContainer,children:[n.jsx(r.CheckboxInput,{inline:!0,label:n.jsx("span",{className:"u-off-screen",children:`Toggle ${t.package} constraint`}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:e.values.id!==0,checked:l.includes(t.id),onChange:()=>N(t.id)}),n.jsx("span",{children:t.constraint})]})},{accessor:"package",Header:"Package",Cell:({row:{original:t}})=>e.values.id===t.id?n.jsx(w,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:u.input,wrapperClassName:u.inputWrapper,...e.getFieldProps("package"),onChange:c=>h("package",c),error:b("package")}):t.package!=="loading"?n.jsx(n.Fragment,{children:t.package}):n.jsx(T,{})},{accessor:"rule",Header:"Rule",Cell:({row:{original:t}})=>{var c;return e.values.id===t.id?n.jsx(r.Select,{label:"Rule",labelClassName:"u-off-screen",className:u.input,wrapperClassName:u.inputWrapper,options:A,...e.getFieldProps("rule"),onChange:_=>h("rule",_.target.value),error:b("rule")}):n.jsx(n.Fragment,{children:((c=A.find(({value:_})=>_===t.rule))==null?void 0:c.label)??t.rule})}},{accessor:"version",Header:"Version",Cell:({row:{original:t}})=>e.values.id===t.id?n.jsx(w,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:u.input,wrapperClassName:u.inputWrapper,...e.getFieldProps("version"),onChange:c=>h("version",c),error:b("version")}):n.jsx(n.Fragment,{children:t.version})},{accessor:"actions",className:u.actionsCell,Cell:({row:{original:t}})=>n.jsx(ee,{constraint:t,formik:e})}],[p,l.length,e.errors,e.touched]);return n.jsx(r.ModularTable,{columns:P,data:p,getCellProps:t=>de(t,e.values.id),className:"u-no-margin--bottom",emptyMsg:ue(a,x)})},pe={constraint:"",id:0,notAnyVersion:!1,package:"",rule:"",version:""},me=L().shape({constraint:v().required("Required."),id:D(),notAnyVersion:q(),package:v().required("Required."),rule:v().when("notAnyVersion",{is:!0,then:a=>a.required("Required.")}),version:v().when("notAnyVersion",(a,e)=>a[0]?e.required("Required."):e)}),he="_pagination_15tqa_1",Ce={pagination:he},we=({profile:a})=>{const[e,o]=C.useState([]),[s,d]=C.useState(1),[g,x]=C.useState(20),[l,p]=C.useState(""),[m,N]=C.useState(""),h=i=>{o([]),d(i)},b=i=>{o([]),x(i)},P=F(),{notify:t}=$(),{editPackageProfileConstraintQuery:c,getPackageProfileConstraintsQuery:_}=V(),{mutateAsync:I}=c,y=H({initialValues:pe,onSubmit:async(i,{resetForm:R})=>{try{await I({constraint:i.constraint,id:i.id,package:i.package,rule:i.rule,version:i.version,name:a.name}),t.success({message:`"${a.name}" package profile's constraint updated successfully`,title:"Package profile constraint updated"}),R()}catch(k){P(k)}},validationSchema:me}),{data:f,isLoading:S}=_({constraint_type:m||void 0,limit:g,name:a.name,offset:(s-1)*g,search:l});return n.jsxs(n.Fragment,{children:[!l&&!m&&s===1&&g===20&&S&&n.jsx(T,{}),(l||m||s!==1||g!==20||!S&&f&&f.data.results.length>0)&&n.jsxs(n.Fragment,{children:[n.jsx(W,{actions:n.jsx(K,{filter:m,formik:y,onFilterChange:i=>N(i),profile:a,selectedIds:e,setSelectedIds:i=>o(i)}),onSearch:i=>p(i),disabled:y.values.id!==0}),n.jsx(ge,{filter:m,formik:y,isConstraintsLoading:S,onSelectedIdsChange:i=>o(i),pageSize:g,profileConstraints:f==null?void 0:f.data.results,search:l,selectedIds:e}),n.jsx(U,{currentPage:s,pageSize:g,paginate:h,setPageSize:b,totalItems:f==null?void 0:f.data.count,className:Ce.pagination})]})]})};export{we as default};
