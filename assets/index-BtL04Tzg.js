const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CqlIvw3g.js","assets/index-xkxcd68U.js","assets/index-D86Q3Mim.css","assets/MultiSelectField-B0H9m6pK.js","assets/MultiSelectField-CD3NDVCz.css","assets/SidePanelFormButtons-DVg0FMa4.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/TagsAddConfirmationModal-C54vdkEP.js","assets/TagsAddConfirmationModal-HDr0Q-Wm.css","assets/useGetTags-gYakqfiu.js","assets/useRoles--qSWDWl4.js","assets/AssociationBlock-vsPH8fvb.css","assets/index-zE_REO1i.js","assets/ScriptsTabs-41X65xT0.js","assets/constants-CZAKxRr5.js","assets/TextConfirmationModal-378Oyr4m.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/HeaderWithSearch-BqFXLOnt.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-CPfKydLa.js","assets/ScriptsTabs-DN44MVZt.css","assets/useRunScript-C0Prdpxe.js","assets/DeliveryBlock-CCpVnphe.js","assets/RadioGroup-B6AgVTv_.js","assets/RadioGroup-WBbAFTwm.css","assets/ScriptDropdown-D64Ak9FN.js","assets/downshift.esm-BGx9aYA9.js","assets/ScriptDropdown-DwZ4WXvX.css","assets/index-Cr3AqE37.js","assets/CodeEditor-DfH-Br33.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-BMbFBxXP.js","assets/AttachmentFile-1Fc8tXRW.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-BT2k5KlF.js","assets/EmployeeList-BHFXreeV.js","assets/EmployeeList-CnpN88if.css","assets/useGetEmployees-CpYKjxU4.js","assets/index-DiU0noXl.css","assets/index-CgqvnpnG.js","assets/SidePanelTableFilterChips-B3HCWIdV.js","assets/SidePanelTablePagination-CBgxAP5_.js","assets/Chip-DGh_0-SI.js","assets/Chip-R6WqXyae.css","assets/InstanceRemoveFromLandscapeModal-DQx4TzjS.js","assets/useRemoveInstancesFromLandscape-M6vN9dbo.js","assets/WslInstancesEmptyState-C3uMeFsO.js","assets/GroupFilter-5leqqWSo.js","assets/WslInstancesEmptyState-CBT5OoUG.css","assets/index-DWa9RADh.css"])))=>i.map(i=>d[i]);
import{l as d,j as t,J as C,d as l,aH as be,b as Y,g as ve,h as _e,i as xe,S as je,w as Ie,an as we,x as Se,y as Ce,t as R,a as Re,o as Fe,U as ke,p as Ae,n as Ee,C as Me,aI as De,aJ as Te,a0 as _,q as Pe,F as S,ax as c,O as E,I as i,aF as U,P as W,s as Q,_ as M}from"./index-xkxcd68U.js";import{T as Le}from"./TextConfirmationModal-378Oyr4m.js";import{C as Be}from"./Chip-DGh_0-SI.js";import"./EmployeeList-BHFXreeV.js";import{u as $e,I as Oe}from"./InstanceRemoveFromLandscapeModal-DQx4TzjS.js";import{u as ze}from"./useRoles--qSWDWl4.js";import"./index-CPfKydLa.js";import{W as Ve,a as Ne}from"./WslInstancesEmptyState-C3uMeFsO.js";const qe="_container_dj78y_1",Ge="_wrapped_dj78y_8",Ue="_innerContainer_dj78y_13",We="_button_dj78y_17",Qe="_titleRow_dj78y_21",I={container:qe,wrapped:Ge,innerContainer:Ue,button:We,titleRow:Qe},Ye=({actions:{destructive:e=[],nondestructive:a=[]},title:g})=>{e=e.filter(s=>!s.excluded),a=a.filter(s=>!s.excluded);const b=[...a,...e],u={nondestructive:[],destructive:[]},[n,v]=d.useState(b),[f,F]=d.useState(u),[D,w]=d.useState(!1),[T,P]=d.useState(0),x=a.filter(s=>s.collapsed).length+e.filter(s=>s.collapsed).length>1,L=(s,h)=>{if(f.destructive.length||f.nondestructive.length)return;if((!s.lastElementChild||s.lastElementChild.getBoundingClientRect().right<=h.getBoundingClientRect().right)&&!x){w(!1);return}w(!0);const y=[],m={nondestructive:[],destructive:[]};a.forEach((p,j)=>{s.children[j].getBoundingClientRect().right>s.getBoundingClientRect().right||p.collapsed&&x?m.nondestructive.push(p):y.push(p)}),e.forEach((p,j)=>{j+=a.length,s.children[j].getBoundingClientRect().right>s.getBoundingClientRect().right||p.collapsed&&x?m.destructive.push(p):y.push(p)}),v(y),F(m)},k=s=>{const h=s?.parentElement?.parentElement;if(!h)return;L(s,h);const y=new ResizeObserver(()=>{const{width:m}=h.getBoundingClientRect();m!==T&&(v(b),F(u),P(m))});return y.observe(h),()=>{y.disconnect()}};return t.jsxs("div",{className:C(I.titleRow,{[I.wrapped]:!n.length}),children:[g,t.jsxs("div",{className:C(I.container,{[I.wrapped]:!n.length}),children:[t.jsx("div",{className:C(I.innerContainer,"p-segmented-control"),children:t.jsx("div",{ref:k,className:"p-segmented-control__list",children:n.map(({collapsed:s,excluded:h,icon:y,label:m,...p})=>t.jsxs(l.Button,{className:C(I.button,"u-no-margin--bottom p-segmented-control__button"),...p,children:[t.jsx(l.Icon,{name:y}),t.jsx("span",{children:m})]},m))})}),D&&t.jsx(be,{hasToggleIcon:!0,toggleLabel:n.length?"More actions":"Actions",toggleClassName:"u-no-margin--bottom",toggleDisabled:[...e,...a].every(s=>s.disabled),actions:f.nondestructive,destructiveActions:f.destructive})]})]})},He=()=>{const e=Y(),a=ve(),{mutateAsync:g,isPending:b}=_e({mutationKey:["employee","disassociate"],mutationFn:async({employee_id:u,computer_id:n})=>e.delete(`employees/${u}/computers/${n}`),onSuccess:(u,n)=>{a.invalidateQueries({queryKey:["instances",n.computer_id]})}});return{disassociateEmployeeFromInstance:g,isDisassociating:b}},Ke=(e,a={})=>{const g=Y(),{id:b,...u}=e,{data:n,isLoading:v}=xe({queryKey:["employees","employee",e],queryFn:async()=>g.get(`employees/${b}`,{params:u}),...a});return{employee:n?.data,isGettingEmployee:v}},Je=e=>{switch(e.type){case"package":return`/profiles/package?sidePath=view&profile=${e.name}`;case"reboot":return`/profiles/reboot?sidePath=view&profile=${e.id}`;case"removal":return`/profiles/removal?sidePath=view&profile=${e.id}`;case"repository":return`/profiles/repository?search=${e.title}`;case"script":return`/scripts?tab=profiles&sidePath=view&profile=${e.id}`;case"security":return`/profiles/security?sidePath=view&profile=${e.id}`;case"upgrade":return`/profiles/upgrade?sidePath=view&profile=${e.id}`;case"wsl":return`/profiles/wsl?sidePath=view&profile=${e.name}`}},Ze=({profile:e})=>t.jsx(je,{to:Je(e),children:e.title}),Xe={deliver_after:"",deliverImmediately:!0,action:null},et=Ie().shape({deliver_after:Ce().when("deliverImmediately",{is:!1,then:e=>e.required("This field is required").test({message:"Invalid date",test:a=>R(a).isValid()}).test({message:"Date must be in the future",test:a=>R(a).isAfter()})}),deliverImmediately:Se(),action:we().oneOf(["shutdown","reboot"]).required()}),tt="_headerContainer_10wnq_1",st="_status_10wnq_6",at="_heading_10wnq_12",$={headerContainer:tt,status:st,heading:at},it=d.lazy(async()=>M(()=>import("./index-CqlIvw3g.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),ot=d.lazy(async()=>M(()=>import("./index-zE_REO1i.js"),__vite__mapDeps([13,14,1,2,15,11,16,17,18,19,20,21,22,23,5,6,7,24,25,26,27,28,29,30,31,32,33,34,35,36,37])).then(e=>({default:e.RunInstanceScriptForm}))),lt=d.lazy(async()=>M(()=>import("./index-BT2k5KlF.js"),__vite__mapDeps([38,1,2,5,6,7,39,15,40,29,41,42]))),nt=d.lazy(async()=>M(()=>import("./index-CgqvnpnG.js"),__vite__mapDeps([43,1,2,44,45,16,17,46,47,39,15,40,48,49,11,22,50,51,18,19,52,53]))),rt=({instance:e})=>{const{isFeatureEnabled:a}=Re(),g=Fe(),b=ke(),{notify:u}=Ae(),{setSidePanelContent:n}=Ee(),{openActivityDetails:v}=Me(),{employee:f,isGettingEmployee:F}=Ke({id:e.employee_id??0},{enabled:!!e.employee_id}),{restartInstances:D,isRestartingInstances:w}=De(),{getAccessGroupQuery:T}=ze(),{sanitizeInstance:P,isSanitizingInstance:x}=$e(),{shutDownInstances:L,isShuttingDownInstances:k}=Te(),{disassociateEmployeeFromInstance:s,isDisassociating:h}=He(),{value:y,setTrue:m,setFalse:p}=_(),{value:j,setTrue:H,setFalse:K}=_(),{value:J,setTrue:Z,setFalse:X}=_(),{value:ee,setTrue:te,setFalse:se}=_(),{value:ae,setTrue:ie,setFalse:oe}=_(),{value:le,setTrue:ne,setFalse:O}=_(),{value:re,setTrue:ce,setFalse:z}=_(),{data:V,isPending:de}=T(),r=Pe({initialValues:Xe,validationSchema:et,onSubmit:async o=>{if(!o.action)return;const q={computer_ids:[e.id],deliver_after:o.deliverImmediately?void 0:`${o.deliver_after}:00Z`};try{const{data:B}=o.action==="reboot"?await D(q):await L(q),G=o.action==="reboot"?"restarted":"shut down";u.success({title:`You queued "${e.title}" to be ${G}`,message:`Instance "${e.title}" will be ${G} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{v(B)}}]})}catch(B){g(B)}}});if(de||F)return t.jsx(S,{});const ue=async()=>{try{const{data:o}=await P({computer_id:e.id,computer_title:e.title});u.success({title:`You have successfully marked ${e.title} to be sanitized.`,message:"An activity has been queued to sanitize it. The data will be permanently irrecoverable once complete.",actions:[{label:"View details",onClick:()=>{v(o)}}]})}catch(o){g(o)}finally{O()}},me=()=>{n("Edit instance",t.jsx(d.Suspense,{fallback:t.jsx(S,{}),children:t.jsx(it,{instance:e})}))},pe=()=>{n("Run script",t.jsx(d.Suspense,{fallback:t.jsx(S,{}),children:t.jsx(ot,{parentAccessGroup:e.access_group,query:`id:${e.id}`})}))},he=()=>{n(`Associate employee with ${e.title}`,t.jsx(d.Suspense,{fallback:t.jsx(S,{}),children:t.jsx(lt,{instanceTitle:e.title})}))},ye=()=>{n(`Active profiles associated with ${e.title}`,t.jsx(d.Suspense,{fallback:t.jsx(S,{}),children:t.jsx(nt,{instance:e})}),"medium")},ge=async()=>{try{await s({computer_id:e.id,employee_id:e.employee_id??0}),z(),u.success({title:`You have successfully disassociated ${f?.name??"the employee"}.`,message:`${f?.name??"The employee"} has been successfully disassociated from ${e.title}.`})}catch(o){g(o)}},A=async o=>{await r.setFieldValue("action",o),r.handleSubmit()},N=()=>{b("/instances",{replace:!0})},fe=V?V.data:[];return t.jsxs(t.Fragment,{children:[t.jsx(Ye,{title:t.jsxs("div",{className:$.headerContainer,children:[t.jsx("h2",{className:C("p-heading--4 u-no-padding--top",$.heading),children:e.title}),e.is_wsl_instance&&t.jsx(Be,{value:"WSL instance"})]}),actions:{nondestructive:[{icon:"edit",label:"Edit",onClick:me},{icon:"restart",label:"Restart",onClick:m,excluded:!c(e).power},{icon:"power-off",label:"Shut down",onClick:H,excluded:!c(e).power},{icon:"code",label:"Run script",onClick:pe,excluded:!c(e).scripts},{icon:l.ICONS.user,label:"Associate employee",onClick:he,collapsed:!0,excluded:!a("employee-management")||!c(e).employees||e.employee_id!==null},{icon:l.ICONS.user,label:"Disassociate employee",onClick:ce,collapsed:!0,excluded:!a("employee-management")||!c(e).employees||e.employee_id===null}],destructive:[{icon:"restart",label:"Reinstall",onClick:Z,collapsed:!0,excluded:!c(e).uninstallation},{icon:"close",label:"Uninstall",onClick:te,collapsed:!0,excluded:!c(e).uninstallation},{icon:l.ICONS.delete,label:"Remove from Landscape",onClick:ie,collapsed:!0},{icon:"tidy",label:"Sanitize",onClick:ne,collapsed:!0,excluded:!c(e).sanitization}]}},e.employee_id??"no-employee"),t.jsxs(E,{children:[t.jsx(E.Item,{title:"Status",children:t.jsxs(i,{children:[t.jsx(i.Item,{label:"Status",value:t.jsxs("div",{className:$.status,children:[t.jsx(l.Icon,{name:U(e).icon??""}),t.jsx("span",{children:U(e).label})]})}),t.jsx(i.Item,{label:"Last ping time",value:R(e.last_ping_time).isValid()?R(e.last_ping_time).format(W):null}),t.jsx(i.Item,{label:"Access group",value:fe.find(o=>o.name===e.access_group)?.title||e.access_group}),t.jsx(i.Item,{label:"Tags",value:e.tags.join(", ")||null,type:"truncated"}),t.jsx(i.Item,{label:"Profiles",value:e.profiles?.length?e.profiles.length===1?t.jsx(Ze,{profile:e.profiles[0]}):t.jsxs(l.Button,{type:"button",className:"u-no-margin",appearance:"link",onClick:ye,children:[e.profiles.length," profiles"]}):null,type:"truncated"}),c(e).employees&&t.jsx(i.Item,{label:"Associated employee",value:f?.name})]})}),t.jsx(E.Item,{title:"Registration details",children:t.jsxs(i,{children:[t.jsx(i.Item,{label:"Hostname",value:e.hostname}),t.jsx(i.Item,{label:"ID",value:e.id}),c(e).hardware&&t.jsx(i.Item,{label:"Serial number",value:e.grouped_hardware?.system.serial}),c(e).hardware&&t.jsx(i.Item,{label:"Product identifier",value:e.grouped_hardware?.system.model}),t.jsx(i.Item,{label:"OS",value:e.distribution_info?.description}),c(e).hardware&&t.jsx(i.Item,{label:"IP addresses",value:Array.isArray(e.grouped_hardware?.network)?e.grouped_hardware.network.map(o=>o.ip).join(", "):null,type:"truncated"}),t.jsx(i.Item,{label:"Registered",value:R(e.registered_at).format(W)})]})}),t.jsx(E.Item,{title:"Other",children:t.jsxs(i,{children:[t.jsx(i.Item,{label:"Annotations",value:null}),t.jsx(i.Item,{label:"Comment",value:e.comment||null})]})})]}),y&&t.jsx(l.ConfirmationModal,{close:p,title:"Restart instance",confirmButtonLabel:"Restart",confirmButtonAppearance:"positive",confirmButtonDisabled:w,confirmButtonLoading:w,onConfirm:async()=>A("reboot"),children:t.jsxs(l.Form,{onSubmit:async()=>A("reboot"),noValidate:!0,children:[t.jsx(l.CheckboxInput,{label:"Deliver as soon as possible",...r.getFieldProps("deliverImmediately"),checked:r.values.deliverImmediately}),t.jsx(l.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...r.getFieldProps("deliver_after"),disabled:r.values.deliverImmediately,error:Q(r,"deliver_after")}),t.jsxs("p",{children:['This will restart "',e.title,'" instance.']})]})}),j&&t.jsx(l.ConfirmationModal,{close:K,title:"Shut down instance",confirmButtonLabel:"Shut down",confirmButtonAppearance:"positive",confirmButtonDisabled:k,confirmButtonLoading:k,onConfirm:async()=>A("shutdown"),children:t.jsxs(l.Form,{onSubmit:async()=>A("shutdown"),noValidate:!0,children:[t.jsx(l.CheckboxInput,{label:"Deliver as soon as possible",...r.getFieldProps("deliverImmediately"),checked:r.values.deliverImmediately}),t.jsx(l.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...r.getFieldProps("deliver_after"),disabled:r.values.deliverImmediately,error:Q(r,"deliver_after")}),t.jsxs("p",{children:['This will shut down "',e.title,'" instance.']})]})}),re&&t.jsx(l.ConfirmationModal,{close:z,title:`Disassociate employee from ${e.title}`,confirmButtonLabel:"Disassociate",confirmButtonAppearance:"negative",confirmButtonDisabled:h,confirmButtonLoading:h,onConfirm:ge,children:t.jsxs("p",{children:["You are about to disassociate instance ",e.title," from"," ",f?.name,". This will revoke their access to the instance’s details and recovery key."]})}),e.is_wsl_instance&&t.jsxs(t.Fragment,{children:[t.jsx(Ve,{close:X,instances:[{name:e.title,computer_id:e.id}],isOpen:J,windowsInstance:e}),t.jsx(Ne,{close:se,instances:[{name:e.title,computer_id:e.id}],isOpen:ee,onSuccess:N,parentId:e.parent.id})]}),t.jsx(Oe,{close:oe,instance:e,isOpen:ae,onSuccess:N}),t.jsx(Le,{isOpen:le,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:x,confirmButtonLoading:x,onConfirm:ue,close:O,confirmationText:`sanitize ${e.title}`,title:"Sanitize instance",children:t.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",e.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})},bt=Object.freeze(Object.defineProperty({__proto__:null,default:rt},Symbol.toStringTag,{value:"Module"}));export{Ze as P,bt as i};
