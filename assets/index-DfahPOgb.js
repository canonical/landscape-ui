import{O as j,c as l,a as b,A as S,B as I,j as e,o as U,n as g,x as p,an as L,r as P,p as $,E as v}from"./index-Dg2qeAM1.js";import{u as m}from"./useUsns-zV1ws8p5.js";import{H as k}from"./HeaderWithSearch-9LSyOtlV.js";import{U as N}from"./UsnList-DELuvWsQ.js";import"./ResponsiveButtons-CsvMdCrE.js";import"./SelectAllButton-5EEDCO5s.js";import"./ExpandableTableFooter-AnI6_K1y.js";import"./TruncatedCell-C6qDfyLZ.js";const _="_actions_1l3g0_1",w={actions:_},A=({usns:s})=>{const{instanceId:n,childInstanceId:t}=j(),{setPageParams:a}=l(),c=b(),i=S(),{notify:o}=I(),{upgradeInstanceUsnsQuery:r}=m(),d=Number(n),{mutateAsync:h,isPending:u}=r,f=()=>{c(`/instances/${t?`${d}/${t}`:`${d}`}`),a({tab:"activities"}),o.clear()},x=async()=>{try{await h({instanceId:d,usns:s}),o.success({title:"You queued packages to be upgraded",message:`Affected packages for ${p(s.length,`"${s[0]}" security issue`,`${s.length} selected security issues`)} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:f}]})}catch(y){i(y)}};return e.jsxs(e.Fragment,{children:[e.jsx(k,{actions:e.jsx("div",{className:U("p-segmented-control",w.actions),children:e.jsxs(g.ConfirmationButton,{className:"p-segmented-control__button has-icon u-no-margin--bottom",type:"button",disabled:s.length===0,confirmationModalProps:{title:"Upgrade affected packages",children:e.jsxs("p",{children:["This will upgrade affected packages for"," ",p(s.length,`"${s[0]}" security issue`,`${s.length} selected security issues`),"."]}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:u,confirmButtonDisabled:u,onConfirm:x},children:[e.jsx(g.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]})})}),e.jsx(L,{filtersToDisplay:["search"]})]})},B=({instance:s,isUsnsLoading:n,totalUsnCount:t,usns:a})=>{const[c,i]=P.useState([]),{search:o}=l();return e.jsxs(e.Fragment,{children:[e.jsx(A,{usns:c}),e.jsx(N,{tableType:"paginated",instances:[s],isUsnsLoading:n,onSelectedUsnsChange:r=>{i(r)},search:o,selectedUsns:c,totalUsnCount:t,usns:a})]})},C=({currentPage:s,getUsnsQueryLoading:n,pageSize:t,search:a})=>!a&&s===1&&t===20&&n,E=({search:s,currentPage:n,pageSize:t,getUsnsQueryLoading:a,getUsnsQueryResult:c})=>!s&&n===1&&t===20&&!a&&(!c||c.data.results.length===0),D=({currentPage:s,getUsnsQueryLoading:n,getUsnsQueryResult:t,pageSize:a,search:c})=>c||s>1||a!==20||!n&&t&&t.data.results.length>0,W=({instance:s})=>{const{search:n,currentPage:t,pageSize:a}=l(),{getUsnsQuery:c}=m(),{data:i,isLoading:o}=c({computer_ids:[s.id],limit:a,offset:(t-1)*a,search:n,show_packages:!1});return e.jsxs(e.Fragment,{children:[C({search:n,currentPage:t,pageSize:a,getUsnsQueryLoading:o})&&e.jsx($,{}),E({search:n,currentPage:t,pageSize:a,getUsnsQueryLoading:o,getUsnsQueryResult:i})&&e.jsx(v,{icon:"inspector-debug",title:"No security issues found"}),D({currentPage:t,getUsnsQueryLoading:o,getUsnsQueryResult:i,pageSize:a,search:n})&&e.jsx(B,{instance:s,isUsnsLoading:o,totalUsnCount:(i==null?void 0:i.data.count)??0,usns:(i==null?void 0:i.data.results)??[]})]})};export{W as default};
