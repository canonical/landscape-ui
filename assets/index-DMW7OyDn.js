const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BTqeD7ql.js","assets/index-BIsTIai5.js","assets/index-CzVsEpc2.css","assets/useInstances-DFMntizr.js","assets/useFetchOld-HRmeQr3g.js","assets/InfoItem-xo9oVjHw.js","assets/InfoItem-C-lWh_lY.css","assets/WslInstancesHeader-GKL-2MJu.js","assets/HeaderWithSearch-I0C-3nTY.js","assets/HeaderWithSearch-DQybm8h_.css","assets/usePageParams-BqSmX3ty.js","assets/WslInstancesHeader-C2N1H1qb.css","assets/useRoles-CiA_cUkF.js","assets/moment-D3LIs5tk.js","assets/NoData-CyXo1XC7.js","assets/moment-C5S46NFB.js","assets/index-DAXByckc.js","assets/TablePagination-DUbhlort.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/SearchHelpPopup-CAfMS1zB.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/index-BmoMXq9B.css","assets/index-dkdshLqf.css","assets/index-rSMyma5l.js","assets/index-CuwdzumK.css","assets/index-Cyaez1fT.js","assets/index-DSOofqg6.css","assets/index-BTBbpj50.js","assets/useUsns-BRSnlx7h.js","assets/useUsns-CzsIYyKO.css","assets/index-Bsb7_DyO.css","assets/index-CmrvyvZ6.js","assets/index-DGBfvUs3.js","assets/PageMain-DnUnp0lt.js","assets/PageMain-BIuYvhUI.css","assets/index-1KdKUBQ3.css","assets/index-BWioeCA5.js","assets/index-DxzApC0N.css","assets/index-cn2YOALo.js","assets/SidePanelFormButtons-DyeqHEQT.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/helpers-D8WgtaRM.js","assets/index-BAFRWw-h.css","assets/index-Bhfk1ZbK.js","assets/UsnList-BpeOsUDH.js","assets/SelectAllButton-DOBps8Y3.js","assets/ExpandableTableFooter-B-b2lwIW.js","assets/ExpandableTableFooter-PHbaG9hU.css","assets/TruncatedCell-DDZkE_uE.js","assets/TruncatedCell-Wu3cG5-r.css","assets/helpers-B4Ea794_.js","assets/helpers-BWt8NEL_.css","assets/UsnList-BtkgdprT.css","assets/index-Bwv5eodB.css","assets/index-Cl_Xqtvh.js","assets/index-D5vdZ5qS.css","assets/index-B3rppv6D.js","assets/downshift.esm-CzrgwxAR.js","assets/index-CJQz2UGz.css","assets/index-CaNLTuiC.js","assets/constants-D5wf-XZY.js","assets/index-_aFDOmw8.css","assets/index-TU4vw8Qz.js","assets/constants-Dwl1JGyb.js","assets/index-W_BOD1xP.css","assets/index-CfsQT0HL.js"])))=>i.map(i=>d[i]);
import{a as K,j as e,E as V,h as b,R as m,r as o,_ as d,i as A,t as x,d as F,c as z,e as w,f as T,v as $,y as C}from"./index-BIsTIai5.js";import{P as S,a as N,b as Q}from"./PageMain-DnUnp0lt.js";import{u as B,a as U}from"./useUsns-BRSnlx7h.js";import{u as q}from"./useInstances-DFMntizr.js";import"./moment-D3LIs5tk.js";import{u as H}from"./usePageParams-BqSmX3ty.js";import"./moment-C5S46NFB.js";const M=({childInstanceId:n,instanceId:s})=>{const a=K();return e.jsx(V,{title:"Instance not found",icon:"connected",body:e.jsxs("p",{className:"u-no-margin--bottom",children:[e.jsx("span",{children:"Seems like the instance with id = "}),e.jsx("code",{children:s}),e.jsx("span",{children:" doesn't "}),n?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"have a child instance with id = "}),e.jsx("code",{children:n})]}):e.jsx("span",{children:"exist"})]}),cta:[e.jsx(b.Button,{appearance:"positive",onClick:()=>a(`${m}instances`,{replace:!0}),type:"button","aria-label":"Go back",children:"Back to Instances page"},"go-back-to-instances-page"),e.jsx(b.Button,{onClick:()=>a(`${m}`,{replace:!0}),type:"button","aria-label":"Go back",children:"Home page"},"go-back-to-home-page")]})},G=[{label:"Info",id:"tab-link-info"},{label:"WSL",id:"tab-link-wsl"},{label:"Activities",id:"tab-link-activities"},{label:"Kernel",id:"tab-link-kernel"},{label:"Security issues",id:"tab-link-security-issues"},{label:"Packages",id:"tab-link-packages"},{label:"Snaps",id:"tab-link-snaps"},{label:"Processes",id:"tab-link-processes"},{label:"Ubuntu Pro",id:"tab-link-ubuntu-pro"},{label:"Users",id:"tab-link-users"},{label:"Hardware",id:"tab-link-hardware"}],W=({id:n,label:s,packageCount:a,packagesLoading:u,usnCount:p,usnLoading:_,kernelCount:i,kernelLoading:l})=>n==="tab-link-packages"&&u||n==="tab-link-security-issues"&&_||n==="tab-link-kernel"&&l?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Spinner,{className:"u-no-margin--bottom u-no-padding--top"})]}):n==="tab-link-packages"&&a?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Badge,{value:a})]}):n==="tab-link-security-issues"&&p?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Badge,{value:p,isNegative:!0})]}):n==="tab-link-kernel"&&i?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s}),e.jsx(b.Badge,{value:i})]}):s,J=({activeTabId:n,instance:s,onActiveTabChange:a,packageCount:u,packagesLoading:p,usnCount:_,usnLoading:i,kernelCount:l,kernelLoading:c})=>G.filter(({id:g})=>!s.distribution||/\d{1,2}\.\d{2}/.test(s.distribution)?g!=="tab-link-wsl":["tab-link-info","tab-link-wsl","tab-link-activities","tab-link-hardware"].includes(g)).map(({label:g,id:r})=>({label:W({label:g,id:r,packageCount:u,packagesLoading:p,usnCount:_,usnLoading:i,kernelCount:l,kernelLoading:c}),id:r,role:"tab",active:r===n,onClick:()=>a(r)})),X="_tabPanel_1n8p7_1",Y={tabPanel:X},Z=o.lazy(()=>d(()=>import("./index-BTqeD7ql.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]))),ee=o.lazy(()=>d(()=>import("./index-rSMyma5l.js"),__vite__mapDeps([24,1,2,17,18,19,10,8,9,25]))),ne=o.lazy(()=>d(()=>import("./index-Cyaez1fT.js"),__vite__mapDeps([26,1,2,5,6,27]))),te=o.lazy(()=>d(()=>import("./index-BTBbpj50.js"),__vite__mapDeps([28,1,2,17,18,19,10,29,4,30,8,9,31]))),ae=o.lazy(()=>d(()=>import("./index-CmrvyvZ6.js"),__vite__mapDeps([32,1,2,16,13,17,18,19,10,20,21,4,14,22]))),se=o.lazy(()=>d(()=>import("./index-DGBfvUs3.js"),__vite__mapDeps([33,1,2,17,18,19,10,5,6,15,14,34,35,29,4,30,3,13,36]))),re=o.lazy(()=>d(()=>import("./index-BWioeCA5.js"),__vite__mapDeps([37,1,2,7,3,4,8,9,10,11,38]))),ie=o.lazy(()=>d(()=>import("./index-cn2YOALo.js").then(n=>n.i),__vite__mapDeps([39,1,2,17,18,19,10,40,41,42,43,8,9,14,44]))),oe=o.lazy(()=>d(()=>import("./index-Bhfk1ZbK.js"),__vite__mapDeps([45,1,2,13,10,29,4,30,46,47,48,49,14,17,18,19,50,51,52,53,54,55]))),le=o.lazy(()=>d(()=>import("./index-Cl_Xqtvh.js"),__vite__mapDeps([56,1,2,5,6,14,15,57]))),ce=o.lazy(()=>d(()=>import("./index-B3rppv6D.js"),__vite__mapDeps([58,1,2,17,18,19,10,5,6,15,40,41,42,43,59,14,8,9,60]))),de=({instance:n,packageCount:s,packagesLoading:a,usnCount:u,usnLoading:p,kernelCount:_,kernelLoading:i})=>{const{closeSidePanel:l}=A(),{tab:c,setPageParams:g}=H(),r=c?`tab-link-${c}`:"tab-link-info",t=J({activeTabId:r,instance:n,onActiveTabChange:h=>{g({tab:h.replace("tab-link-","")}),l()},packageCount:s,packagesLoading:a,usnCount:u,usnLoading:p,kernelCount:_,kernelLoading:i});return e.jsxs(e.Fragment,{children:[e.jsx(b.Tabs,{listClassName:"u-no-margin--bottom",links:t}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":r,className:Y.tabPanel,children:e.jsxs(o.Suspense,{fallback:e.jsx(x,{}),children:[r==="tab-link-info"&&e.jsx(Z,{instance:n}),r==="tab-link-wsl"&&e.jsx(re,{instance:n}),r==="tab-link-activities"&&e.jsx(ae,{instanceId:n.id}),r==="tab-link-kernel"&&e.jsx(se,{instanceTitle:n.title}),r==="tab-link-security-issues"&&e.jsx(oe,{instance:n}),r==="tab-link-packages"&&e.jsx(te,{}),r==="tab-link-snaps"&&e.jsx(ce,{}),r==="tab-link-processes"&&e.jsx(ee,{}),r==="tab-link-ubuntu-pro"&&e.jsx(le,{instance:n}),r==="tab-link-users"&&e.jsx(ie,{}),r==="tab-link-hardware"&&e.jsx(ne,{instance:n})]})})]})},ue=n=>{if(n)return n.parent?[{label:"Instances",path:`${m}instances`},{label:n.parent.title,path:`${m}instances/${n.parent.id}`},{label:n.title,current:!0}]:[{label:"Instances",path:`${m}instances`},{label:n.title,current:!0}]},pe="_container_pnq0d_1",be={container:pe},_e=o.lazy(()=>d(()=>import("./index-CaNLTuiC.js"),__vite__mapDeps([61,1,2,5,6,16,13,17,18,19,10,20,21,4,14,22,15,62,34,35,29,30,3,63]))),ge=o.lazy(()=>d(()=>import("./index-TU4vw8Qz.js"),__vite__mapDeps([64,1,2,5,6,16,13,17,18,19,10,20,21,4,14,22,15,65,62,34,35,29,30,3,66]))),me=o.lazy(()=>d(()=>import("./index-CfsQT0HL.js"),__vite__mapDeps([67,1,2,16,13,17,18,19,10,20,21,4,14,22,3,15,65,34,35,29,30,66]))),Ee=({instanceName:n,hasTableData:s,kernelStatuses:a})=>{var r;const{setSidePanelContent:u}=A(),p=((r=a==null?void 0:a.installed)==null?void 0:r.version_rounded)??"",_=(a==null?void 0:a.downgrades)??[],i=(a==null?void 0:a.upgrades)??[],l=()=>{u("Downgrade kernel",e.jsx(o.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(_e,{instanceName:n,currentKernelVersion:p,downgradeKernelVersions:_})}))},c=()=>{u("Upgrade kernel",e.jsx(o.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(ge,{instanceName:n,currentKernelVersion:p,upgradeKernelVersions:i})}))},g=()=>{var t;u(`Restart ${n}`,e.jsx(o.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(me,{instanceName:n,showNotification:s,newKernelVersionId:(t=i[0])==null?void 0:t.id})}))};return e.jsxs("div",{className:be.container,children:[e.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:"Kernel overview"}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:g,children:[e.jsx(b.Icon,{name:"restart"}),e.jsx("span",{children:"Restart instance"})]}),e.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:_.length===0,onClick:l,children:[e.jsx(b.Icon,{name:"begin-downloading"}),e.jsx("span",{children:"Downgrade kernel"})]}),e.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:i.length===0,onClick:c,children:[e.jsx(b.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade kernel"})]})]})},"buttons")]})};function he(){const n=F(),s=z(),a=({id:i},l={})=>T({queryKey:["kernel",i],queryFn:()=>n.get(`computers/${i}/livepatch/kernel`),...l}),u=({id:i,...l},c={})=>T({queryKey:["kernel",{id:i,...l}],queryFn:()=>n.get(`computers/${i}/livepatch/info`,{params:l}),...c}),p=w({mutationKey:["kernel","downgrade"],mutationFn:({id:i,...l})=>n.post(`computers/${i}/kernel/downgrade`,l),onSuccess:()=>s.invalidateQueries({queryKey:["kernel"]})}),_=w({mutationKey:["kernel","upgrade"],mutationFn:({id:i,...l})=>n.post(`computers/${i}/kernel/upgrade`,l),onSuccess:()=>s.invalidateQueries({queryKey:["kernel"]})});return{getKernelQuery:a,getLivepatchInfoQuery:u,downgradeKernelQuery:p,upgradeKernelQuery:_}}const xe=()=>{var y,I,v,P,f,E,L;const{instanceId:n,childInstanceId:s}=$(),{user:a}=C(),u=K(),{getSingleInstanceQuery:p}=q(),{getUsnsQuery:_}=B(),{getInstancePackagesQuery:i}=U(),{getLivepatchInfoQuery:l}=he(),c=o.useRef("");o.useEffect(()=>{a!=null&&a.current_account&&(c.current||(c.current=a.current_account),c.current!==a.current_account&&u(`${m}instances`,{replace:!0}))},[a==null?void 0:a.current_account]);const{data:g,isLoading:r}=p({instanceId:parseInt(s||(n??"")),with_annotations:!0,with_grouped_hardware:!0},{enabled:!!n&&(!c.current||c.current===(a==null?void 0:a.current_account))}),t=(g==null?void 0:g.data)??null,{data:h,isLoading:R}=_({computer_ids:t?[t.id]:[],limit:1},{enabled:!!(t!=null&&t.distribution)&&/\d{1,2}\.\d{2}/.test(t.distribution)&&(!s||((y=t.parent)==null?void 0:y.id)===parseInt(n??""))}),{data:j,isLoading:D}=i({available:!1,upgrade:!0,instance_id:t?t.id:0,limit:1},{enabled:!!(t!=null&&t.distribution)&&/\d{1,2}\.\d{2}/.test(t.distribution)&&(!s||((I=t.parent)==null?void 0:I.id)===parseInt(n??""))}),{data:k,isLoading:O}=l({id:t?t.id:0},{enabled:!!(t!=null&&t.distribution)&&/\d{1,2}\.\d{2}/.test(t.distribution)&&(!s||((v=t.parent)==null?void 0:v.id)===parseInt(n??""))});return e.jsxs(S,{children:[e.jsx(N,{title:(t==null?void 0:t.title)??"",hideTitle:!0,breadcrumbs:ue(t)}),e.jsxs(Q,{children:[r&&e.jsx(x,{}),!r&&(!t||s&&((P=t==null?void 0:t.parent)==null?void 0:P.id)!==parseInt(n??""))&&e.jsx(M,{childInstanceId:s,instanceId:n}),!r&&t&&(!s||t.parent&&t.parent.id===parseInt(n??""))&&e.jsx(de,{instance:t,packageCount:t.distribution?j==null?void 0:j.data.count:0,packagesLoading:D,usnCount:t.distribution?h==null?void 0:h.data.count:0,usnLoading:R,kernelCount:t.distribution?(L=(E=(f=k==null?void 0:k.data)==null?void 0:f.livepatch_info)==null?void 0:E.json.output.Status[0].Livepatch.Fixes)==null?void 0:L.length:0,kernelLoading:O})]})]})},Le=Object.freeze(Object.defineProperty({__proto__:null,default:xe},Symbol.toStringTag,{value:"Module"}));export{Ee as K,Le as i,he as u};
