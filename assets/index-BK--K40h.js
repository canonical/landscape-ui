import{a5 as F,k as B,h as _,H as N,m as $,l as O,y as D,z as k,q as j,B as q,j as e,d as r,c as L,U as H,an as M,w as Q}from"./index-CNSDWj8Q.js";import{S as c}from"./SidePanel-ChyjtMJv.js";import{A as U}from"./AssociationBlock-B4LnXWNE.js";import{S as V}from"./SidePanelFormButtons-DIizKTix.js";import{u as S}from"./useRoles-DYJzr0u4.js";import{g as x}from"./formikErrors-Bw8iTXYS.js";import{u as z,R as X}from"./index-DOx9qCZx.js";import{a as ke,b as qe,c as Le}from"./index-DOx9qCZx.js";import{P as K}from"./ProfileAssociationInfo-DMGjDKb4.js";import{B as P}from"./Blocks-yjg-J-3E.js";import{I as d}from"./InfoGrid-3w5mqARw.js";import{u as W}from"./useFetchOld-BAAs34Op.js";import"./MultiSelectField-CqoYdMk0.js";import"./useGetTags-B_HL7bdb.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./PageMain-C8MVZwda.js";import"./TableFilterChips-06YfpJdc.js";import"./ProfileAssociatedInstancesLink-Neer6jGU.js";import"./NoData-6ZK9sV5u.js";import"./StaticLink-BEYCGcPv.js";import"./constants-CDnVvJTb.js";import"./constants-cpRdwKHL.js";import"./ListTitle-BUruUKn1.js";import"./ResponsiveTable-BXalKviy.js";import"./TruncatedCell-BMum6DLZ.js";import"./Truncated-Dtg97i8C.js";import"./useExpandableRow-B4jhRgod.js";import"./TextConfirmationModal-q88mH05g.js";import"./table-CdFwMAPu.js";import"./HeaderWithSearch-D2tNhOlz.js";import"./InfoItem-Bt7JBIPo.js";const R={add:"Add",edit:"updated"},Y={add:"Add removal profile",edit:"Save changes"},J={access_group:F,all_computers:!1,days_without_exchange:"",tags:[],title:""},b=2147483647,Z=t=>B().shape({access_group:_(),all_computers:O(),days_without_exchange:$().test({name:"required",message:"This field is required.",params:{action:t},test:o=>o!=null||t!=="add"}).integer("Timeframe must be an integer value.").min(1,"Timeframe must be at least 1.").max(b,`Timeframe must be at most  ${b}.`),tags:N().of(_()),title:_().test({name:"required",message:"This field is required.",params:{action:t},test:o=>!!o||t!=="add"})}),ee="_inputContainer_v1jo9_1",te="_input_v1jo9_1",ae="_inputDescription_v1jo9_10",v={inputContainer:ee,input:te,inputDescription:ae},A=t=>{const o=D(),{notify:a}=k(),{sidePath:l,popSidePath:p,createPageParamsSetter:u}=j(),{createRemovalProfileQuery:m,editRemovalProfileQuery:f}=z(),{getAccessGroupQuery:g}=S(),{data:h}=g({},{enabled:t.action==="add"}),T=h?.data.map(({name:i,title:n})=>({label:n,value:i}))??[],{mutateAsync:C}=m,{mutateAsync:E}=f,y=u({sidePath:[],profile:""}),G=async i=>{const n={title:i.title,days_without_exchange:i.days_without_exchange,access_group:i.access_group,all_computers:i.all_computers};!i.all_computers&&i.tags.length>0&&(n.tags=i.tags);try{t.action==="edit"?await E({all_computers:n.all_computers,days_without_exchange:n.days_without_exchange,name:t.profile.name,tags:n.tags,title:n.title}):await C(n),y(),a.success({message:`Removal profile ${R[t.action]}`,title:`Removal profile ${i.title} has been ${R[t.action]}`})}catch(w){o(w)}},s=q({initialValues:t.action==="edit"?{all_computers:t.profile.all_computers,days_without_exchange:t.profile.days_without_exchange,tags:t.profile.tags,title:t.profile.title}:J,onSubmit:G,validationSchema:Z(t.action)});return e.jsxs(r.Form,{onSubmit:s.handleSubmit,noValidate:!0,children:[e.jsx(r.Input,{type:"text",label:"Title",required:t.action==="add",...s.getFieldProps("title"),error:x(s,"title")}),e.jsxs("div",{className:v.inputContainer,children:[e.jsx(r.Input,{type:"number",inputMode:"numeric",label:"Removal timeframe",required:t.action==="add",autoComplete:"off",className:v.input,...s.getFieldProps("days_without_exchange"),error:x(s,"days_without_exchange")}),e.jsx("span",{className:v.inputDescription,children:"days"})]}),e.jsx(r.Select,{label:"Access group",options:T,disabled:t.action==="edit",...s.getFieldProps("access_group"),error:x(s,"access_group")}),e.jsx(U,{formik:s}),e.jsx(V,{submitButtonDisabled:s.isSubmitting,submitButtonText:Y[t.action],onCancel:y,hasBackButton:l.length>1,onBackButtonPress:p})]})},Be=()=>e.jsxs(e.Fragment,{children:[e.jsx(c.Header,{children:"Add removal profile"}),e.jsx(c.Content,{children:e.jsx(A,{action:"add"})})]});function oe(t){const o=W(),{data:a,isPending:l,error:p}=L({queryKey:["removalProfile",t],queryFn:async({signal:m})=>o.get("GetRemovalProfiles",{signal:m})}),u=a?.data.find(({id:m})=>m===t);return{removalProfile:u,removalProfileError:a&&!u?new Error("The removal profile could not be found."):p,isGettingRemovalProfile:l}}const I=()=>{const{profile:t}=j(),{isGettingRemovalProfile:o,removalProfile:a,removalProfileError:l}=oe(parseInt(t));if(l)throw l;return o?{removalProfile:void 0,isGettingRemovalProfile:!0}:{removalProfile:a,isGettingRemovalProfile:!1}},Ne=()=>{const{createSidePathPusher:t}=j(),{getAccessGroupQuery:o}=S(),{removalProfile:a,isGettingRemovalProfile:l}=I(),{data:p,isPending:u}=o(),{value:m,setTrue:f,setFalse:g}=H();if(l||u)return e.jsx(c.LoadingState,{});const h=t("edit");return e.jsxs(e.Fragment,{children:[e.jsx(c.Header,{children:a.title}),e.jsxs(c.Content,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(r.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:h,"aria-label":`Edit ${a.title}`,children:[e.jsx(r.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(r.Button,{className:"p-segmented-control__button",hasIcon:!0,type:"button",onClick:f,"aria-label":`Remove ${a.title}`,children:[e.jsx(r.Icon,{name:r.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(P,{children:[e.jsx(P.Item,{children:e.jsxs(d,{children:[e.jsx(d.Item,{label:"Title",value:a.title}),e.jsx(d.Item,{label:"Name",value:a.name}),e.jsx(d.Item,{label:"Access group",value:M(a.access_group,p)}),e.jsx(d.Item,{label:"Removal timeframe",large:!0,value:`${a.days_without_exchange} ${Q(a.days_without_exchange,"day")}`})]})}),e.jsx(P.Item,{title:"Association",children:e.jsx(K,{profile:a,children:e.jsx(d,{children:e.jsx(d.Item,{label:"Tags",large:!0,value:a.tags.join(", "),type:"truncated"})})})})]})]}),e.jsx(X,{close:g,isOpen:m,removalProfile:a})]})},$e=()=>{const{removalProfile:t,isGettingRemovalProfile:o}=I();return o?e.jsx(c.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(c.Header,{children:['Edit "',t.title,'" profile']}),e.jsxs(c.Content,{children:[e.jsx(A,{action:"edit",profile:t}),";"]})]})};export{Be as RemovalProfileAddSidePanel,Ne as RemovalProfileDetailsSidePanel,$e as RemovalProfileEditSidePanel,ke as RemovalProfileList,qe as RemovalProfilesEmptyState,Le as RemovalProfilesHeader,z as useRemovalProfiles};
