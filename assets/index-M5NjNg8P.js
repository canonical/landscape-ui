import{r as d,_ as se,p as le,e as re,f as ce,j as a,g as r,h as M,o as F}from"./index-CreLYkd7.js";import{u as ie}from"./useConfirm-Bodc886s.js";import{a as de}from"./index-DSrY36-b.js";import{S as me}from"./SidePanelTablePagination-D_q1jRwk.js";import"./TablePagination.module-DLVph1Z1.js";import"./PageMain-ChZU1taS.js";import"./useDistributions-Bd7MvkB5.js";import"./useFetchOld-DGjYaeEJ.js";import"./useMutation-CvjNgrEE.js";import"./useQuery-TlFJgfqc.js";import"./InfoItem-DVjSC8Rv.js";import"./InfoItem.module-BZ3tYMsb.js";import"./moment-Cl4UOzQZ.js";import"./NoData-DSmFbKcn.js";import"./index-Ld96KjvL.js";import"./moment-CZq-kU5w.js";import"./TablePagination-Zw7WkUG8.js";import"./usePageParams-MY5k-CLu.js";import"./EmptyState-DAULjSZb.js";import"./SearchHelpPopup-SYLrpuUY.js";import"./DistributionCard.module-CdGw1YvC.js";const ge="_ctaRow_31lfx_1",ue="_version_31lfx_5",fe="_content_31lfx_9",R={ctaRow:ge,version:ue,content:fe},pe=d.lazy(()=>se(()=>import("./EditPocketForm-NBInIaAw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42]))),he=({distributionName:s,pocket:n,seriesName:l})=>{const[f,P]=d.useState(1),[m,z]=d.useState(20),[i,x]=d.useState([]),[V,D]=d.useState(!1),[$,E]=d.useState(""),[g,j]=d.useState(""),w=le("(max-width: 619px)"),T=re(),{closeConfirmModal:B,confirmModal:L}=ie(),{setSidePanelContent:I,closeSidePanel:Q}=ce(),{listPocketQuery:A,diffPullPocketQuery:H,pullPackagesToPocketQuery:O,syncMirrorPocketQuery:U,removePackagesFromPocketQuery:K,removePocketQuery:q}=de(),{mutate:G,isLoading:_}=U,{mutate:J,isLoading:y}=O,W=()=>{n.mode==="mirror"?G({name:n.name,series:l,distribution:s}):n.mode==="pull"&&J({name:n.name,series:l,distribution:s})},X=()=>{I(`Edit ${n.name} pocket`,a.jsx(d.Suspense,{fallback:a.jsx(F,{}),children:a.jsx(pe,{pocket:n,distributionName:s,seriesName:l})}))},{mutateAsync:Y,isLoading:v}=q,Z=async()=>{try{await Y({distribution:s,series:l,name:n.name}),Q()}catch(e){T(e)}finally{B()}},N=()=>{L({body:`Do you really want to delete ${n.name} pocket from ${l} series of ${s} distribution?`,title:"Deleting pocket",buttons:[a.jsx(r.Button,{appearance:"negative",disabled:v,onClick:Z,"aria-label":`Delete ${n.name} pocket of ${s}/${l}`,children:"Delete"},`delete-${n.name}-pocket`)]})},{mutateAsync:ee,isLoading:k}=K,ae=async()=>{const e=S.filter((t,o)=>i.includes(o)).map(({packageName:t})=>t);try{await ee({name:n.name,series:l,distribution:s,packages:e})}catch(t){T(t)}},ne=()=>{L({body:`This will delete ${i.length} selected ${i.length===1?"package":"packages"} from ${n.name} pocket ${l} series of ${s} distribution`,title:"Deleting packages from pocket",buttons:[a.jsx(r.Button,{appearance:"negative",disabled:k,onClick:ae,"aria-label":`Delete selected packages from ${n.name} pocket of ${s}/${l}`,children:"Delete"},"delete-packages-from-pocket")]})},{data:c,isLoading:p}=A({name:n.name,series:l,distribution:s,search:g,limit:m,offset:(f-1)*m},{enabled:!_&&!y&&!k&&!v}),u=[];if(c)for(const e of c.data.results)u.push({packageName:e.name,packageVersion:e.version});const{data:b}=H({name:n.name,series:l,distribution:s},{enabled:n.mode==="pull"&&!p&&!_&&!y&&!k&&!v}),h=[];if(b)for(const e in b.data){const t=b.data[e];if(t.add)for(const o of t.add)h.push({packageName:o[0],newVersion:o[1],difference:"add"});if(t.update){D(!0);for(const o of t.update)h.push({packageName:o[0],newVersion:o[2],difference:"update"})}if(t.delete){D(!0);for(const o of t.delete)h.push({packageName:o[0],difference:"delete",newVersion:""})}}const te=()=>V?(u.forEach((e,t)=>{const o=h.find(({packageName:C})=>e.packageName===C);o&&(u[t].difference=o.difference,o.newVersion!==""&&(u[t].newVersion=o.newVersion))}),u.sort((e,t)=>e.difference&&!t.difference?-1:!e.difference&&t.difference?1:0)):u,S=d.useMemo(()=>te(),[f,m,g,V,u.length,h.length]),oe=d.useMemo(()=>[{accessor:"packageName",Header:({rows:e})=>n.mode==="upload"?a.jsxs(a.Fragment,{children:[a.jsx(r.CheckboxInput,{inline:!0,label:a.jsx("span",{className:"u-off-screen",children:"Toggle all"}),disabled:e.length===0,indeterminate:i.length>0&&i.length<e.length,checked:i.length===e.length&&i.length>0,onChange:()=>{x(t=>t.length>0?[]:e.map((o,C)=>C))}}),a.jsx("span",{children:"Package"})]}):"Package",Cell:({row:e})=>n.mode==="upload"?a.jsx(r.CheckboxInput,{inline:!0,label:e.original.packageName,checked:i.includes(e.index),onChange:()=>{x(t=>t.includes(e.index)?t.filter(o=>o!==e.index):[...t,e.index])}}):e.original.packageName},{accessor:"packageVersion",Header:"Version",getCellIcon:({row:e})=>e.original.difference?"warning":!1,className:R.version,Cell:({row:e})=>{var t;return e.original.difference?a.jsxs(a.Fragment,{children:[a.jsx("span",{children:e.original.packageVersion}),a.jsx("span",{className:"p-tooltip__message",role:"tooltip",children:e.original.difference==="delete"?"Package deleted":`Version differs
from parent pocket.
Parent version:
${(t=e.original)==null?void 0:t.newVersion}`})]}):e.original.packageVersion}}],[S,i.length]);return a.jsxs(a.Fragment,{children:[a.jsxs(r.Row,{className:M("u-no-padding--left u-no-padding--right",R.ctaRow),children:[a.jsx(r.Col,{size:n.mode==="upload"?8:6,medium:n.mode==="upload"?4:3,children:a.jsx("div",{className:"p-segmented-control",children:a.jsxs("div",{className:"p-segmented-control__list",children:[(n.mode=="mirror"||n.mode=="pull")&&a.jsx(r.Button,{className:"p-segmented-control__button",onClick:W,disabled:_&&y,"aria-label":n.mode==="mirror"?`Synchronize ${n.name} pocket of ${s}/${l}`:`Pull packages to ${n.name} pocket of ${s}/${l}`,children:n.mode==="mirror"?"Sync":"Pull"}),a.jsx(r.Button,{className:"p-segmented-control__button",onClick:X,"aria-label":`Edit ${n.name} pocket of ${s}/${l}`,children:"Edit"}),a.jsx(r.Button,{className:"p-segmented-control__button",onClick:N,"aria-label":`Remove ${n.name} pocket of ${s}/${l}`,children:"Remove"}),n.mode==="upload"&&a.jsx(r.Button,{className:"p-segmented-control__button",disabled:i.length===0||k,onClick:ne,"aria-label":`Remove selected packages from ${n.name} pocket of ${s}/${l}`,children:"Remove packages"})]})})}),(n.mode==="pull"||n.mode==="mirror")&&(g||f!==1||m!==20||!p&&c&&c.data.count>0)&&a.jsx(r.Col,{size:6,medium:3,children:a.jsx("form",{onSubmit:e=>{e.preventDefault(),j($),P(1)},noValidate:!0,children:a.jsx(r.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,"aria-label":"Package search",onChange:e=>{E(e)},value:$,onClear:()=>{E(""),j(""),P(1)},className:M({"is-dense":!w,"u-no-margin--bottom":w}),onSearch:()=>{j($),P(1)},autocomplete:"off"})})})]}),p&&a.jsx(F,{}),!g&&f===1&&m===20&&!p&&(!c||!c.data.count)&&a.jsx("p",{children:"No packages found"}),!p&&(g||f!==1||m!==20||c&&c.data.count>0)&&a.jsxs(a.Fragment,{children:[a.jsx(r.ModularTable,{columns:oe,data:S,emptyMsg:g?`No packages found with the search: "${g}".`:void 0,className:R.content,getRowProps:({original:e})=>({className:e.difference?"p-tooltip--top-center":""}),getCellProps:({column:e})=>{switch(e.id){case"packageName":return{role:"rowheader"};case"packageVersion":return{"aria-label":"Version"};default:return{}}}}),a.jsx(me,{currentPage:f,totalItems:c==null?void 0:c.data.count,paginate:e=>{x([]),P(e)},pageSize:m,setPageSize:e=>{z(e)}})]})]})},Be=he;export{Be as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/EditPocketForm-NBInIaAw.js","assets/index-CreLYkd7.js","assets/index-DzLy8aaC.css","assets/formik.esm-C2DYiXJC.js","assets/index.esm-Co3jed-Q.js","assets/series-CovlqkJK.js","assets/series-Doyz0RCU.css","assets/debug-CU0X0Tt1.js","assets/debug-B7PvC2lz.css","assets/MultiSelectField-DVS5b9ca.js","assets/MultiSelectField.module-D1r8qo_i.js","assets/MultiSelectField-B2rqRhX9.css","assets/SidePanelFormButtons-CfVlXCl-.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/useGPGKeys-Cv34TdDO.js","assets/useFetchOld-DGjYaeEJ.js","assets/useMutation-CvjNgrEE.js","assets/useQuery-TlFJgfqc.js","assets/index-DSrY36-b.js","assets/PageMain-ChZU1taS.js","assets/PageMain-DyI__TtH.css","assets/useDistributions-Bd7MvkB5.js","assets/InfoItem-DVjSC8Rv.js","assets/InfoItem.module-BZ3tYMsb.js","assets/InfoItem-BbayMzTk.css","assets/moment-Cl4UOzQZ.js","assets/NoData-DSmFbKcn.js","assets/index-Ld96KjvL.js","assets/moment-CZq-kU5w.js","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/TablePagination-Zw7WkUG8.js","assets/usePageParams-MY5k-CLu.js","assets/EmptyState-DAULjSZb.js","assets/EmptyState-BNXajmMK.css","assets/SearchHelpPopup-SYLrpuUY.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/useConfirm-Bodc886s.js","assets/index-D7AnmhC7.css","assets/DistributionCard.module-CdGw1YvC.js","assets/DistributionCard-CcioRwqI.css","assets/index-BptIfZTM.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
