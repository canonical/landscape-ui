import{h as F,o as S,p as B,t as C,x as P,y as U,w as q,K as D,z as L,F as N,k as Q,ai as R,j as t,i as m,B as V,v as o}from"./index-DJOjDjNm.js";import{S as E}from"./SidePanelFormButtons-DvKehNDS.js";import{u as I}from"./useGetInstances-L54B4d7A.js";function _(){const l=F(),e=S(),u=B({mutationKey:["token","attach"],mutationFn:async r=>l.post("attach-token",r),onSuccess:async()=>e.invalidateQueries({queryKey:["instances"]})}),{mutateAsync:d,isPending:n}=u;return{attachToken:d,isAttachingToken:n}}const z=({children:l,selectedInstances:e,submitButtonText:u,notification:d})=>{const[n,r]=C.useState(0),k=P(),{notify:p}=U(),{closeSidePanel:y}=q(),{openActivityDetails:x}=D(),{attachToken:b,isAttachingToken:g}=_(),j=`${e.map(i=>`id:${i.id}`).join(" OR ")} has-pro-management:false`,{refetchInstances:v}=I({query:j,limit:e.length},{listenToUrlParams:!1},{enabled:!1}),f=async i=>{if(e.length===0){p.info({title:"No instances to attach",message:"No valid instances were selected for token attachment."});return}try{const{data:{activity:s}}=await b({computer_ids:e.map(({id:A})=>A),token:i});y(),p.success({...d,actions:[{label:"View details",onClick:()=>{x(s)}}]})}catch(s){k(s)}},a=L({initialValues:{token:""},validationSchema:N({token:Q().required("Token is required")}),onSubmit:async i=>{try{const{data:s}=await v();r(s?.data.count??0),s?.data.count===0&&await f(i.token)}catch(s){k(s)}}}),T=async()=>{await f(a.values.token)},w=()=>{r(0)},{withToken:c,withoutToken:h}=R(e);return t.jsxs(t.Fragment,{children:[t.jsxs(m.Form,{noValidate:!0,onSubmit:a.handleSubmit,children:[t.jsxs("div",{children:[l,t.jsx(m.Input,{label:"Token",type:"text",placeholder:"Your token",required:!0,...a.getFieldProps("token"),error:V(a,"token")})]}),t.jsx(E,{submitButtonText:u,submitButtonDisabled:!a.isValid||!a.dirty,submitButtonLoading:a.isSubmitting||g,onCancel:y})]}),n?t.jsxs(m.ConfirmationModal,{title:"Attach Ubuntu Pro token",confirmButtonLabel:"Confirm",confirmButtonAppearance:"positive",confirmButtonLoading:g,onConfirm:T,close:w,children:[t.jsx("p",{className:"u-no-margin--bottom",children:"Confirming this action means:"}),t.jsxs("ul",{children:[n!==e.length&&t.jsxs(t.Fragment,{children:[h-n>0&&t.jsxs("li",{children:[t.jsx("strong",{children:h-n})," ",o(h-n,"instance")," ","will be attached to this token"]}),c>0&&t.jsxs("li",{children:[t.jsx("strong",{children:c})," ",o(c,"instance")," will override"," ",o(c,"its","their")," existing token"]})]}),n>0&&t.jsxs("li",{children:[t.jsx("strong",{children:n})," ",o(n,"instance")," will be skipped as ",o(n,"it does","they do")," not support Ubuntu Pro management"]})]})]}):null]})},G="https://ubuntu.com/pro/dashboard";export{z as T,G as U};
