import{r as d,j as s,B as x,g as p,d as h,n as f,k as v}from"./index-BMhnQnvO.js";import{P as b,a as C,b as E}from"./PageMain-Do4tk6tv.js";import{h as y}from"./moment-C5S46NFB.js";import{T as j}from"./TruncatedCell-iDjT0CSt.js";import"./moment-BcE1DmV8.js";import{a as w}from"./helpers-BQ6A_CwO.js";import{u as P}from"./useOnClickOutside-B6njW3aZ.js";import{u as _}from"./usePageParams-C2gko9oh.js";import{H as R}from"./HeaderWithSearch-CYHrik7-.js";import{u as L}from"./useQuery-Dxk6aJEc.js";import{T as H}from"./TablePagination-BdWPaBG6.js";import"./TablePagination.module-DLVph1Z1.js";const T="_message_1po57_1",S="_expandedCell_1po57_5",F="_expandedRow_1po57_10",u={message:T,expandedCell:S,expandedRow:F},M=o=>({index:a})=>{const n={};return o===a&&(n.className=u.expandedRow),n},I=o=>({column:a,row:{index:n}})=>{const e={};return a.id==="creation_time"?e.role="rowheader":a.id==="person_name"?e["aria-label"]="username":a.id==="entity_type"?e["aria-label"]="entity type":a.id==="entity_name"?e["aria-label"]="entity name":a.id==="message"&&(e["aria-label"]="message",o===n&&(e.className=u.expandedCell)),e},N=({eventsLog:o})=>{const[a,n]=d.useState(""),[e,l]=d.useState(-1),i=d.useRef([]);P({current:e!==-1?i.current[e]:null},()=>l(-1));const r=d.useMemo(()=>[{accessor:"creation_time",Header:"creation time",Cell:({row:t})=>s.jsx(s.Fragment,{children:y(t.original.creation_time).format(x)})},{accessor:"person_name",Header:"username",Cell:({row:t})=>s.jsx(s.Fragment,{children:t.original.person_name})},{accessor:"entity_type",Header:"entity type",Cell:({row:t})=>s.jsx(s.Fragment,{children:t.original.entity_type})},{accessor:"entity_name",Header:"entity name",Cell:({row:t})=>s.jsx(s.Fragment,{children:t.original.entity_name})},{accessor:"message",className:u.message,Header:"event log message",Cell:({row:{original:t,index:c}})=>s.jsx(j,{content:t.message,isExpanded:c===e,onExpand:()=>{n(""),l(a?c-1:c)}})}],[o,e]);return s.jsx("div",{ref:w(i),children:s.jsx(p.ModularTable,{getCellProps:I(e),getRowProps:M(e),columns:r,data:o,sortable:!0,emptyMsg:"No events found"})})},k="_container_r415z_1",D="_searchContainer_r415z_8",Y="_select_r415z_12",z={container:k,searchContainer:D,select:Y},g={days:{slug:"days",label:"Days",type:"select",options:[{label:"1 day",value:"1"},{label:"7 days",value:"7"},{label:"30 days",value:"30"},{label:"90 days",value:"90"},{label:"180 days",value:"180"},{label:"365 days",value:"365"}]}},A=()=>{const{days:o,setPageParams:a}=_(),n=l=>{a({search:l})},e=l=>{a({days:l.target.value})};return s.jsx(R,{onSearch:n,actions:s.jsx(p.Select,{wrapperClassName:z.select,label:g.days.label,labelClassName:"u-no-margin--bottom",options:g.days.options,value:o,onChange:e})})};function O(){const o=h();return{getEventsLog:(n,e={})=>L({queryKey:["events",n],queryFn:()=>o.get("events",{params:n}),...e})}}const $=(o,a)=>{const n=["creation_time","person_id","person_name","entity_type","entity_id","entity_name","message"],l=[["Creation Time","Person ID","Person Name","Entity Type","Entity ID","Entity Name","Message"].join(","),...o.map(c=>n.map(m=>c[m]).join(","))].join(`\r
`),i=new Blob([l],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(i),t=document.createElement("a");t.href=r,t.download=a,document.body.appendChild(t),t.click(),document.body.removeChild(t)},B=()=>{const{days:o,search:a,currentPage:n,pageSize:e}=_(),{user:l}=f(),{getEventsLog:i}=O(),{data:r,isLoading:t}=i({days:Number(o),limit:e,offset:(n-1)*e,search:a}),c=d.useMemo(()=>(r==null?void 0:r.data.results.filter(m=>m.message.includes(a)))??[],[r,a]);return s.jsxs(b,{children:[s.jsx(C,{title:"Events log",actions:[s.jsx(p.Button,{onClick:()=>$(c,`Event Log - ${l.current_account}-${y().format("YYYY-MM-DDTHH mm ss[Z]")}.csv`),children:"Download as CSV"},"download-as-cv")]}),s.jsxs(E,{children:[s.jsx(A,{}),t&&s.jsx(v,{}),!t&&c&&s.jsx(N,{eventsLog:c}),s.jsx(H,{totalItems:r==null?void 0:r.data.count,currentItemCount:c.length})]})]})},ae=B;export{ae as default};
