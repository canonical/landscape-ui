const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CX6v6KJ2.js","assets/index-ChL2S0eU.js","assets/index-DEuNBe7s.css","assets/useInstances-B9hhc9Bb.js","assets/useFetchOld-DIiLQM9i.js","assets/InfoItem-B_e41MQz.js","assets/InfoItem-C-lWh_lY.css","assets/WslInstancesHeader-UHkVH_6e.js","assets/HeaderWithSearch-D3S3Vvbl.js","assets/HeaderWithSearch-DQybm8h_.css","assets/usePageParams-BCQ4b1Cy.js","assets/WslInstancesHeader-C2N1H1qb.css","assets/useRoles-C6qu8rDV.js","assets/moment-BLNajCvU.js","assets/NoData-9Q0i8yik.js","assets/moment-C5S46NFB.js","assets/index-CFnR-9aM.js","assets/TablePagination-DNBQxF-y.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/SearchHelpPopup-DQ_hKs0k.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/index-BmoMXq9B.css","assets/index-dkdshLqf.css","assets/index-Bi2ZJJ5s.js","assets/index-CuwdzumK.css","assets/index-DWN2me1b.js","assets/index-DSOofqg6.css","assets/index-XbnnwC0p.js","assets/useUsns-CbRnfw1Q.js","assets/useUsns-CzsIYyKO.css","assets/index-Bsb7_DyO.css","assets/index-_XW1MNdQ.js","assets/index-Bm5XxOKM.js","assets/PageMain-DrEayV7B.js","assets/PageMain-BIuYvhUI.css","assets/index-1KdKUBQ3.css","assets/index-BA1_uWMi.js","assets/index-DxzApC0N.css","assets/index-CuygrTT6.js","assets/SidePanelFormButtons-BSzys4oQ.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/helpers-CJKg3rlA.js","assets/index-BAFRWw-h.css","assets/index-BU2HmRs4.js","assets/UsnList-BkviZVsZ.js","assets/SelectAllButton-WOwznwzs.js","assets/ExpandableTableFooter-C-DWwHrj.js","assets/ExpandableTableFooter-PHbaG9hU.css","assets/TruncatedCell-D8eX3QFV.js","assets/TruncatedCell-Wu3cG5-r.css","assets/helpers-B4Ea794_.js","assets/helpers-BWt8NEL_.css","assets/UsnList-BtkgdprT.css","assets/index-Bwv5eodB.css","assets/index-DziuUg7R.js","assets/index-D5vdZ5qS.css","assets/index-DErE-Lmf.js","assets/downshift.esm-N5hDQyFt.js","assets/index-C8S5ex7b.css","assets/index-Cn_LuUJT.js","assets/constants-BkejW9UZ.js","assets/index-_aFDOmw8.css","assets/index-DNbakA5h.js","assets/constants-Dwl1JGyb.js","assets/index-W_BOD1xP.css","assets/index-CvTQXPJk.js"])))=>i.map(i=>d[i]);
import{a as T,j as t,E as D,h as b,R as m,r as o,_ as d,i as w,o as x,c as O,b as Q,d as f,e as E,p as V,x as C}from"./index-ChL2S0eU.js";import{P as z,a as N,b as $}from"./PageMain-DrEayV7B.js";import{u as B,a as S}from"./useUsns-CbRnfw1Q.js";import{u as U}from"./useInstances-B9hhc9Bb.js";import"./moment-BLNajCvU.js";import{u as q}from"./usePageParams-BCQ4b1Cy.js";import"./moment-C5S46NFB.js";const H=({childInstanceId:e,instanceId:a})=>{const n=T();return t.jsx(D,{title:"Instance not found",icon:"connected",body:t.jsxs("p",{className:"u-no-margin--bottom",children:[t.jsx("span",{children:"Seems like the instance with id = "}),t.jsx("code",{children:a}),t.jsx("span",{children:" doesn't "}),e?t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"have a child instance with id = "}),t.jsx("code",{children:e})]}):t.jsx("span",{children:"exist"})]}),cta:[t.jsx(b.Button,{appearance:"positive",onClick:()=>n(`${m}instances`,{replace:!0}),type:"button","aria-label":"Go back",children:"Back to Instances page"},"go-back-to-instances-page"),t.jsx(b.Button,{onClick:()=>n(`${m}`,{replace:!0}),type:"button","aria-label":"Go back",children:"Home page"},"go-back-to-home-page")]})},M=[{label:"Info",id:"tab-link-info"},{label:"WSL",id:"tab-link-wsl"},{label:"Activities",id:"tab-link-activities"},{label:"Kernel",id:"tab-link-kernel"},{label:"Security issues",id:"tab-link-security-issues"},{label:"Packages",id:"tab-link-packages"},{label:"Snaps",id:"tab-link-snaps"},{label:"Processes",id:"tab-link-processes"},{label:"Ubuntu Pro",id:"tab-link-ubuntu-pro"},{label:"Users",id:"tab-link-users"},{label:"Hardware",id:"tab-link-hardware"}],G=({id:e,label:a,packageCount:n,packagesLoading:r,usnCount:u,usnLoading:g,kernelCount:i,kernelLoading:c})=>e==="tab-link-packages"&&r||e==="tab-link-security-issues"&&g||e==="tab-link-kernel"&&c?t.jsxs(t.Fragment,{children:[t.jsx("span",{children:a}),t.jsx(b.Spinner,{className:"u-no-margin--bottom u-no-padding--top"})]}):e==="tab-link-packages"&&n?t.jsxs(t.Fragment,{children:[t.jsx("span",{children:a}),t.jsx(b.Badge,{value:n})]}):e==="tab-link-security-issues"&&u?t.jsxs(t.Fragment,{children:[t.jsx("span",{children:a}),t.jsx(b.Badge,{value:u,isNegative:!0})]}):e==="tab-link-kernel"&&i?t.jsxs(t.Fragment,{children:[t.jsx("span",{children:a}),t.jsx(b.Badge,{value:i})]}):a,W=({activeTabId:e,instance:a,onActiveTabChange:n,packageCount:r,packagesLoading:u,usnCount:g,usnLoading:i,kernelCount:c,kernelLoading:p})=>M.filter(({id:_})=>!a.distribution||/\d{1,2}\.\d{2}/.test(a.distribution)?_!=="tab-link-wsl":["tab-link-info","tab-link-wsl","tab-link-activities","tab-link-hardware"].includes(_)).map(({label:_,id:s})=>({label:G({label:_,id:s,packageCount:r,packagesLoading:u,usnCount:g,usnLoading:i,kernelCount:c,kernelLoading:p}),id:s,role:"tab",active:s===e,onClick:()=>n(s)})),J="_tabPanel_1n8p7_1",X={tabPanel:J},Y=o.lazy(()=>d(()=>import("./index-CX6v6KJ2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]))),Z=o.lazy(()=>d(()=>import("./index-Bi2ZJJ5s.js"),__vite__mapDeps([24,1,2,17,18,19,10,8,9,25]))),ee=o.lazy(()=>d(()=>import("./index-DWN2me1b.js"),__vite__mapDeps([26,1,2,5,6,27]))),te=o.lazy(()=>d(()=>import("./index-XbnnwC0p.js"),__vite__mapDeps([28,1,2,17,18,19,10,29,4,30,8,9,31]))),ne=o.lazy(()=>d(()=>import("./index-_XW1MNdQ.js"),__vite__mapDeps([32,1,2,16,13,17,18,19,10,20,21,4,14,22]))),ae=o.lazy(()=>d(()=>import("./index-Bm5XxOKM.js"),__vite__mapDeps([33,1,2,17,18,19,10,5,6,15,14,34,35,29,4,30,3,13,36]))),se=o.lazy(()=>d(()=>import("./index-BA1_uWMi.js"),__vite__mapDeps([37,1,2,7,3,4,8,9,10,11,38]))),re=o.lazy(()=>d(()=>import("./index-CuygrTT6.js").then(e=>e.i),__vite__mapDeps([39,1,2,17,18,19,10,40,41,42,43,8,9,14,44]))),ie=o.lazy(()=>d(()=>import("./index-BU2HmRs4.js"),__vite__mapDeps([45,1,2,13,10,29,4,30,46,47,48,49,14,17,18,19,50,51,52,53,54,55]))),oe=o.lazy(()=>d(()=>import("./index-DziuUg7R.js"),__vite__mapDeps([56,1,2,5,6,14,15,57]))),le=o.lazy(()=>d(()=>import("./index-DErE-Lmf.js"),__vite__mapDeps([58,1,2,17,18,19,10,5,6,15,40,41,42,43,59,14,8,9,60]))),ce=({instance:e,packageCount:a,packagesLoading:n,usnCount:r,usnLoading:u,kernelCount:g,kernelLoading:i})=>{const{closeSidePanel:c}=w(),{tab:p,setPageParams:_}=q(),s=p?`tab-link-${p}`:"tab-link-info",l=W({activeTabId:s,instance:e,onActiveTabChange:h=>{_({tab:h.replace("tab-link-","")}),c()},packageCount:a,packagesLoading:n,usnCount:r,usnLoading:u,kernelCount:g,kernelLoading:i});return t.jsxs(t.Fragment,{children:[t.jsx(b.Tabs,{listClassName:"u-no-margin--bottom",links:l}),t.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":s,className:X.tabPanel,children:t.jsxs(o.Suspense,{fallback:t.jsx(x,{}),children:[s==="tab-link-info"&&t.jsx(Y,{instance:e}),s==="tab-link-wsl"&&t.jsx(se,{instance:e}),s==="tab-link-activities"&&t.jsx(ne,{instanceId:e.id}),s==="tab-link-kernel"&&t.jsx(ae,{instanceTitle:e.title}),s==="tab-link-security-issues"&&t.jsx(ie,{instance:e}),s==="tab-link-packages"&&t.jsx(te,{}),s==="tab-link-snaps"&&t.jsx(le,{}),s==="tab-link-processes"&&t.jsx(Z,{}),s==="tab-link-ubuntu-pro"&&t.jsx(oe,{instance:e}),s==="tab-link-users"&&t.jsx(re,{}),s==="tab-link-hardware"&&t.jsx(ee,{instance:e})]})})]})},de=e=>{if(e)return e.parent?[{label:"Instances",path:`${m}instances`},{label:e.parent.title,path:`${m}instances/${e.parent.id}`},{label:e.title,current:!0}]:[{label:"Instances",path:`${m}instances`},{label:e.title,current:!0}]},ue=e=>{if(!(!e||e.length===0))return e[0].Livepatch.Fixes.length},pe=(e,a)=>e.distribution?a:0,be=(e,a)=>e.distribution?a:0,ge=e=>(e==null?void 0:e.title)??"",_e=(e,a)=>parseInt(a||(e??"")),me=(e,a,n)=>!!e&&(!a||a===n),he=(e,a,n)=>{var r;return!!(e!=null&&e.distribution)&&/\d{1,2}\.\d{2}/.test(e.distribution)&&(!n||((r=e.parent)==null?void 0:r.id)===parseInt(a??""))},xe=(e,a,n)=>{var r;return!!(e!=null&&e.distribution)&&/\d{1,2}\.\d{2}/.test(e.distribution)&&(!n||((r=e.parent)==null?void 0:r.id)===parseInt(a??""))},je=(e,a,n)=>{var r;return!!(e!=null&&e.distribution)&&/\d{1,2}\.\d{2}/.test(e.distribution)&&(!n||((r=e.parent)==null?void 0:r.id)===parseInt(a??""))},ke=e=>e?[e.id]:[],L=e=>e?e.id:0,ye=(e,a,n)=>e&&(!n||e.parent&&e.parent.id===parseInt(a??"")),Ie="_container_pnq0d_1",Pe={container:Ie},ve=o.lazy(()=>d(()=>import("./index-Cn_LuUJT.js"),__vite__mapDeps([61,1,2,5,6,16,13,17,18,19,10,20,21,4,14,22,15,62,34,35,29,30,3,63]))),fe=o.lazy(()=>d(()=>import("./index-DNbakA5h.js"),__vite__mapDeps([64,1,2,5,6,16,13,17,18,19,10,20,21,4,14,22,15,65,62,34,35,29,30,3,66]))),Ee=o.lazy(()=>d(()=>import("./index-CvTQXPJk.js"),__vite__mapDeps([67,1,2,16,13,17,18,19,10,20,21,4,14,22,3,15,65,34,35,29,30,66]))),Qe=({instanceName:e,hasTableData:a,kernelStatuses:n})=>{var s;const{setSidePanelContent:r}=w(),u=((s=n==null?void 0:n.installed)==null?void 0:s.version_rounded)??"",g=(n==null?void 0:n.downgrades)??[],i=(n==null?void 0:n.upgrades)??[],c=()=>{r("Downgrade kernel",t.jsx(o.Suspense,{fallback:t.jsx(x,{}),children:t.jsx(ve,{instanceName:e,currentKernelVersion:u,downgradeKernelVersions:g})}))},p=()=>{r("Upgrade kernel",t.jsx(o.Suspense,{fallback:t.jsx(x,{}),children:t.jsx(fe,{instanceName:e,currentKernelVersion:u,upgradeKernelVersions:i})}))},_=()=>{var l;r(`Restart ${e}`,t.jsx(o.Suspense,{fallback:t.jsx(x,{}),children:t.jsx(Ee,{instanceName:e,showNotification:a,newKernelVersionId:(l=i[0])==null?void 0:l.id})}))};return t.jsxs("div",{className:Pe.container,children:[t.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:"Kernel overview"}),t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[t.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:_,children:[t.jsx(b.Icon,{name:"restart"}),t.jsx("span",{children:"Restart instance"})]}),t.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:g.length===0,onClick:c,children:[t.jsx(b.Icon,{name:"begin-downloading"}),t.jsx("span",{children:"Downgrade kernel"})]}),t.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:i.length===0,onClick:p,children:[t.jsx(b.Icon,{name:"change-version"}),t.jsx("span",{children:"Upgrade kernel"})]})]})},"buttons")]})};function Le(){const e=O(),a=Q(),n=({id:i},c={})=>E({queryKey:["kernel",i],queryFn:()=>e.get(`computers/${i}/livepatch/kernel`),...c}),r=({id:i,...c},p={})=>E({queryKey:["kernel",{id:i,...c}],queryFn:()=>e.get(`computers/${i}/livepatch/info`,{params:c}),...p}),u=f({mutationKey:["kernel","downgrade"],mutationFn:({id:i,...c})=>e.post(`computers/${i}/kernel/downgrade`,c),onSuccess:()=>a.invalidateQueries({queryKey:["kernel"]})}),g=f({mutationKey:["kernel","upgrade"],mutationFn:({id:i,...c})=>e.post(`computers/${i}/kernel/upgrade`,c),onSuccess:()=>a.invalidateQueries({queryKey:["kernel"]})});return{getKernelQuery:n,getLivepatchInfoQuery:r,downgradeKernelQuery:u,upgradeKernelQuery:g}}const Te=()=>{var I,P,v;const{instanceId:e,childInstanceId:a}=V(),{user:n}=C(),r=T(),{getSingleInstanceQuery:u}=U(),{getUsnsQuery:g}=B(),{getInstancePackagesQuery:i}=S(),{getLivepatchInfoQuery:c}=Le(),p=o.useRef("");o.useEffect(()=>{n!=null&&n.current_account&&(p.current||(p.current=n.current_account),p.current!==n.current_account&&r(`${m}instances`,{replace:!0}))},[n==null?void 0:n.current_account]);const{data:_,isLoading:s}=u({instanceId:_e(e,a),with_annotations:!0,with_grouped_hardware:!0},{enabled:me(e,p.current,n==null?void 0:n.current_account)}),l=(_==null?void 0:_.data)??null,{data:h,isLoading:K}=g({computer_ids:ke(l),limit:1},{enabled:je(l,e,a)}),{data:j,isLoading:R}=i({available:!1,upgrade:!0,instance_id:L(l),limit:1},{enabled:he(l,e,a)}),{data:k,isLoading:A}=c({id:L(l)},{enabled:xe(l,e,a)}),F=ue((v=(P=(I=k==null?void 0:k.data.livepatch_info)==null?void 0:I.json)==null?void 0:P.output)==null?void 0:v.Status),y=ye(l,e,a);return t.jsxs(z,{children:[t.jsx(N,{title:ge(l),hideTitle:!0,breadcrumbs:de(l)}),t.jsx($,{children:s?t.jsx(x,{}):t.jsxs(t.Fragment,{children:[!y&&t.jsx(H,{childInstanceId:a,instanceId:e}),l&&y&&t.jsx(ce,{instance:l,packageCount:pe(l,Number(j==null?void 0:j.data.count)),packagesLoading:R,usnCount:be(l,Number(h==null?void 0:h.data.count)),usnLoading:K,kernelCount:l.distribution?F:0,kernelLoading:A})]})})]})},Ve=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{Qe as K,Ve as i,Le as u};
