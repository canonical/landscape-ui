import{r as u,_ as f,f as S,j as n,g as c,o as j,a as A,k as F,R as Q,L as B,h as q,c as T,d as E,e as w}from"./index-DXs1haZl.js";import{u as O}from"./useFetchOld-DWTVWZGf.js";import{u as v}from"./useMutation-CoMMCR6r.js";import{u as y}from"./useQuery-DPA9mHwu.js";const g={downgrade:{appearance:"positive",icon:"begin-downloading",label:"Downgrade",order:4},hold:{appearance:"positive",icon:"pause",label:"Hold",order:2},remove:{appearance:"negative",icon:"delete",label:"Uninstall",order:1},unhold:{appearance:"positive",icon:"play",label:"Unhold",order:3},upgrade:{appearance:"positive",icon:"change-version",label:"Upgrade",order:5}},H="_toggleButton_bd7et_1",R="_actionButton_bd7et_6",K={toggleButton:H,actionButton:R},V=u.lazy(()=>f(()=>import("./index-B9x8-8fp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]))),M=({pkg:e})=>{const{setSidePanelContent:a}=S(),s={remove:!0,hold:e.status!=="held",unhold:e.status==="held",upgrade:!!e.available_version&&e.available_version!==e.current_version,downgrade:e.status!=="held"},d=o=>{a(`${g[o].label} ${e.name}`,n.jsx(u.Suspense,{fallback:n.jsx(j,{}),children:n.jsx(V,{action:o,packages:[e]})}))};return n.jsx(c.ContextualMenu,{position:"left",toggleClassName:K.toggleButton,toggleAppearance:"base",toggleLabel:n.jsx(c.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${e.name} package actions`},children:Object.keys(g).map(o=>o).sort((o,t)=>g[t].order-g[o].order).map(o=>n.jsx(u.Fragment,{children:s[o]&&n.jsxs(c.Button,{type:"button",appearance:"base",hasIcon:!0,className:"p-contextual-menu__link",onClick:()=>d(o),"aria-label":`${g[o].label} ${e.name} package`,children:[n.jsx(c.Icon,{name:g[o].icon}),n.jsx("span",{children:g[o].label})]})},o))})},W=({onDismiss:e})=>{const a=A(),{instanceId:s,childInstanceId:d}=F();return n.jsxs(c.Notification,{severity:"caution",onDismiss:e,children:[n.jsx("strong",{children:"Some upgrades require Ubuntu Pro: "}),n.jsxs("span",{children:["Your current Ubuntu package upgrades are limited. To unlock full upgrades, please upgrade to Ubuntu Pro."," "]}),n.jsx(c.Button,{type:"button",appearance:"link",onClick:()=>{a(`${Q}instances/${d?`${s}/${d}`:s}`,{state:{tab:"ubuntu-pro"}})},children:"Learn more"})]})},z={available_version:null,current_version:null,id:-1,name:"loading",status:"available",summary:""},G="_checkbox_1xyx4_1",Y="_details_1xyx4_5",J="_tooltipLink_1xyx4_9",X="_hidden_1xyx4_13",Z="_actions_1xyx4_17",_={checkbox:G,details:Y,tooltipLink:J,hidden:X,actions:Z},I=e=>!!e.available_version&&!!e.current_version&&e.available_version.includes("ubuntu-pro"),N=e=>{const a={label:"Unknown",icon:""};return e.status==="available"?(a.label="Available",a.icon="status-queued-small"):e.status==="held"?(a.label="Held",a.icon="status-in-progress-small"):e.status==="security"?(a.label="Security upgrade",a.icon="status-failed-small"):e.status==="installed"&&(e.available_version?(a.label="Regular upgrade",a.icon="status-waiting-small"):(a.label="Installed",a.icon="status-succeeded-small")),a},ee=({column:e,row:a})=>{const s={};return a.original.name==="loading"?e.id==="name"?s.colSpan=5:(s.className=_.hidden,s["aria-hidden"]=!0):e.id==="checkbox"?s["aria-label"]=`Toggle ${a.original.name} package`:e.id==="name"?s.role="rowheader":e.id==="status"?s["aria-label"]="Status":e.id==="current_version"?s["aria-label"]="Current version":e.id==="available_version"?s["aria-label"]="Available version":e.id==="summary"&&(s["aria-label"]="Details"),s},ne=u.lazy(()=>f(()=>import("./index-HeKOez7b.js"),__vite__mapDeps([29,1,2,8,9,10,21,22,23]))),ge=({emptyMsg:e,onPackagesSelect:a,packages:s,packagesLoading:d,selectedPackages:o,selectAll:t})=>{const[r,m]=u.useState(!1),[b,C]=u.useState(!1),{instanceId:i,childInstanceId:p}=F(),{setSidePanelContent:x}=S(),L=u.useMemo(()=>d?[z]:s,[s,d]),P=l=>{a(o.some(({name:h})=>h===l.name)?o.filter(({name:h})=>h!==l.name):[...o,l])},k=()=>{a(o.length>0?[]:s.filter(l=>!I(l)))};u.useEffect(()=>{!t||r||!s.length||(k(),m(!0))},[t,s]);const U=l=>{x("Package details",n.jsx(u.Suspense,{fallback:n.jsx(j,{}),children:n.jsx(ne,{singlePackage:l})}))},D=u.useMemo(()=>[{accessor:"checkbox",className:_.checkbox,Header:n.jsx(c.CheckboxInput,{inline:!0,label:n.jsx("span",{className:"u-off-screen",children:"Toggle all"}),checked:o.length===s.length&&s.length>0,indeterminate:o.length<s.length&&o.length>0,disabled:s.length===0,onChange:k}),Cell:({row:l})=>I(l.original)?n.jsx(c.Tooltip,{message:n.jsxs("div",{children:[n.jsx("p",{className:"u-no-padding--top",children:"Ubuntu Pro is required"}),n.jsx(B,{to:`${Q}instances/${p?`${i}/${p}`:`${i}`}`,state:{tab:"ubuntu-pro"},className:_.tooltipLink,children:"learn more"})]}),children:n.jsx(c.CheckboxInput,{inline:!0,disabled:!0,label:n.jsx("span",{className:"u-off-screen",children:`Toggle ${l.original.name}`}),checked:o.some(({name:h})=>h===l.original.name),onChange:()=>{P(l.original)}})}):n.jsx(c.CheckboxInput,{inline:!0,label:n.jsx("span",{className:"u-off-screen",children:`Toggle ${l.original.name}`}),checked:o.some(({name:h})=>h===l.original.name),onChange:()=>{P(l.original)}})},{accessor:"name",Header:"Name",Cell:({row:l})=>l.original.name==="loading"?n.jsx(j,{}):n.jsx(c.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{U(l.original)},children:l.original.name})},{accessor:"status",Header:"Status",Cell:({row:{original:l}})=>N(l).label,getCellIcon:({row:{original:l}})=>N(l).icon},{accessor:"current_version",Header:"Current version"},{accessor:"summary",className:_.details,Header:"Details",Cell:({row:{original:l}})=>l.available_version?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:l.summary}),n.jsx("br",{}),n.jsx("span",{children:`available version: ${l.available_version}`})]}):l.summary},{accessor:"actions",className:_.actions,Header:"Actions",Cell:({row:{original:l}})=>n.jsx(M,{pkg:l})}],[s,o.length]);return n.jsxs(n.Fragment,{children:[!b&&s.some(I)&&n.jsx(W,{onDismiss:()=>C(!0)}),n.jsx(c.ModularTable,{columns:D,data:L,getCellProps:ee,emptyMsg:e})]})},se="_container_1nwlw_1",ae="_noWrap_1nwlw_5",$={container:se,noWrap:ae},te=u.lazy(()=>f(()=>import("./index-B9x8-8fp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]))),oe=u.lazy(()=>f(()=>import("./index-C0w0IbfD.js"),__vite__mapDeps([30,1,2,5,6,7,31,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,32]))),me=({selectedPackages:e})=>{const{setSidePanelContent:a}=S(),s=t=>{const r=e.length===1?e[0].name:`${e.length} selected packages`;a(`${g[t].label} ${r}`,n.jsx(u.Suspense,{fallback:n.jsx(j,{}),children:n.jsx(te,{action:t,packages:e})}))},d={remove:e.length===0||e.every(t=>!t.current_version),hold:e.length===0||e.every(t=>t.status==="held"),unhold:e.length===0||e.every(t=>t.status!=="held"),upgrade:e.length===0||e.every(t=>!t.available_version)},o=()=>{a("Install packages",n.jsx(u.Suspense,{fallback:n.jsx(j,{}),children:n.jsx(oe,{})}))};return n.jsxs("div",{className:$.container,children:[n.jsxs(c.Button,{type:"button",onClick:o,hasIcon:!0,className:$.noWrap,children:[n.jsx("i",{className:"p-icon--plus"}),n.jsx("span",{children:"Install"})]}),n.jsx("div",{className:q("p-segmented-control is-small",$.noWrap),children:Object.keys(g).filter(t=>t!=="downgrade").map(t=>t).sort((t,r)=>g[t].order-g[r].order).map(t=>n.jsxs(c.Button,{type:"button",className:"p-segmented-control__button has-icon",disabled:d[t],onClick:()=>s(t),children:[n.jsx(c.Icon,{name:g[t].icon}),n.jsx("span",{children:g[t].label})]},t))},"buttons")]})},le="_selectContainer_ga9b4_1",re="_actions_ga9b4_6",pe={selectContainer:le,actions:re};function he(){const e=T(),a=O(),s=E(),d=w(),o=(i,p={})=>y({queryKey:["packages",i],queryFn:()=>s.get("packages",{params:i}),...p}),t=({instance_id:i,...p},x={})=>y({queryKey:["packages",{instance_id:i,...p}],queryFn:()=>s.get(`computers/${i}/packages`,{params:p}),...x}),r=v({mutationFn:i=>a.get("UpgradePackages",{params:i}),onSuccess:()=>e.invalidateQueries(["packages"])}),m=({instanceId:i,packageName:p},x={})=>y({queryKey:["packageDowngradeVersion",{instanceId:i,packageName:p}],queryFn:()=>s.get(`computers/${i}/packages/installed/${p}/downgrades`),...x}),b=v({mutationFn:({instanceId:i,...p})=>s.post(`computers/${i}/packages/installed`,p),onSuccess:()=>{e.invalidateQueries(["packages"]).catch(d)}}),C=v({mutationFn:i=>s.post("packages",i),onSuccess:()=>e.invalidateQueries(["packages"])});return{getPackagesQuery:o,getInstancePackagesQuery:t,upgradePackagesQuery:r,getDowngradePackageVersionsQuery:m,downgradePackageVersionQuery:b,packagesActionQuery:C}}function be(){const e=T(),a=E(),s=(r,m={})=>y({queryKey:["usns",r],queryFn:()=>a.get("usns",{params:r}),...m}),d=({usn:r,...m},b={})=>y({queryKey:["usnPackages",{usn:r,...m}],queryFn:()=>a.get(`usns/${r}`,{params:m}),...b}),o=v({mutationFn:({instanceId:r,...m})=>a.post(`/computers/${r}/usns/upgrade-packages`,m),onSuccess:()=>Promise.all([e.invalidateQueries(["usns"]),e.invalidateQueries(["activities"])])}),t=v({mutationFn:({instanceId:r,...m})=>a.post(`/computers/${r}/usns/remove-packages`,m),onSuccess:()=>Promise.all([e.invalidateQueries(["usns"]),e.invalidateQueries(["activities"])])});return{getUsnsQuery:s,getAffectedPackagesQuery:d,upgradeUsnPackagesQuery:o,removeUsnPackagesQuery:t}}export{g as I,me as P,he as a,ge as b,pe as c,be as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-B9x8-8fp.js","assets/index-DXs1haZl.js","assets/index-DzLy8aaC.css","assets/formik.esm-CwYJvJSO.js","assets/moment-Cl4UOzQZ.js","assets/SidePanelFormButtons-Dtg_vQ52.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/InfoItem-BQPTGwVs.js","assets/InfoItem.module-BZ3tYMsb.js","assets/InfoItem-BbayMzTk.css","assets/index-BU3-Vm4G.js","assets/moment-BF0UQeMK.js","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/TablePagination-DZ07rvb4.js","assets/usePageParams-BJqFm8Ol.js","assets/EmptyState-BYL1pVz2.js","assets/EmptyState-BNXajmMK.css","assets/SearchHelpPopup-CCs3NejY.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/useFetchOld-DWTVWZGf.js","assets/useMutation-CoMMCR6r.js","assets/useQuery-DPA9mHwu.js","assets/useConfirm-C9Ai5vPv.js","assets/NoData-BmTO_w1O.js","assets/index-D7AnmhC7.css","assets/index.esm-FGh7VWBq.js","assets/index-hMInNede.css","assets/index-HeKOez7b.js","assets/index-C0w0IbfD.js","assets/downshift.esm-CJYgPAQU.js","assets/index-gF7VHP7z.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
