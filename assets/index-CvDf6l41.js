import{r as g,j as e,e as u,h as k,f as v,m as _,l as H,c as E,x as Q}from"./index-7rbqZGOC.js";import{E as M}from"./EmptyState-Z1WsBfRf.js";import"./TablePagination.module-DLVph1Z1.js";import{T}from"./TablePagination-Bvv83kII.js";import{u as y}from"./useMutation-CcXaMJpM.js";import{u as $}from"./useQuery-B9bt25H8.js";import{u as b}from"./usePageParams-Bx_W__hi.js";const z=({processes:t,selectedPids:n,setSelectedPids:c})=>{const r=()=>{c(n.length===0?t.map(({pid:s})=>s):[])},o=g.useMemo(()=>[{accessor:"name",Header:e.jsxs(e.Fragment,{children:[e.jsx(u.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all processes"}),checked:n.length>0&&n.length===t.length,disabled:t.length===0,onChange:r,indeterminate:n.length>0&&n.length<t.length}),e.jsx("span",{children:"Command"})]}),Cell:({row:s})=>e.jsxs(e.Fragment,{children:[e.jsx(u.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:`Select process ${s.original.name}`}),checked:n.includes(s.original.pid),onChange:()=>{c(n.includes(s.original.pid)?n.filter(i=>i!==s.original.pid):[...n,s.original.pid])}}),e.jsx("span",{children:s.original.name})]})},{accessor:"state",Header:"State"},{accessor:"vm_size",Header:"VM size"},{accessor:"cpu_utilization",Header:"CPU (%)",Cell:({row:s})=>e.jsxs(e.Fragment,{children:[(100*s.original.cpu_utilisation).toFixed(1),"%"]})},{accessor:"pid",Header:"PID"},{accessor:"start_time",Header:"Started at"},{accessor:"gid",Header:"Group"}],[t,n]);return e.jsx(u.ModularTable,{columns:o,data:t,emptyMsg:"No processes found"})},P=()=>{const t=k(),n=v(),c=(s,i={})=>{const{computer_id:d,...a}=s;return $({queryKey:["processes",s],queryFn:()=>t.get(`/computers/${d}/processes`,{params:a}),...i})},r=y({mutationFn:s=>t.post("processes/terminate",s),onSuccess:()=>{n.invalidateQueries(["processes"])}}),o=y({mutationFn:s=>t.post("processes/kill",s),onSuccess:()=>{n.invalidateQueries(["processes"])}});return{getProcessesQuery:c,killProcessQuery:o,terminateProcessQuery:r}},A="_container_eu2va_1",B="_searchContainer_eu2va_6",C={container:A,searchContainer:B},D=({selectedPids:t,handleClearSelection:n})=>{const{instanceId:c}=_(),{search:r,setPageParams:o}=b(),{notify:s}=H(),i=E(),{killProcessQuery:d,terminateProcessQuery:a}=P(),[m,x]=g.useState(r),h=Number(c),{mutateAsync:p}=a,{mutateAsync:j}=d,f=()=>{o({search:m}),n()},S=()=>{o({search:""})},I=l=>{l.preventDefault(),f()},N=async()=>{try{await p({pids:t,computer_id:h}),s.success({message:`${t.length===1?"Process":"Processes"} successfully ended`}),n()}catch(l){i(l)}},F=async()=>{try{await j({pids:t,computer_id:h}),s.success({message:`${t.length===1?"Process":"Processes"} successfully killed`}),n()}catch(l){i(l)}};return e.jsxs("div",{className:C.container,children:[e.jsx("div",{className:C.searchContainer,children:e.jsx(u.Form,{onSubmit:I,noValidate:!0,children:e.jsx(u.SearchBox,{shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off","aria-label":"Process search",value:m,onChange:l=>x(l),onSearch:f,onClear:S})})}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsx(u.Button,{className:"p-segmented-control__button",disabled:t.length===0,onClick:N,children:"End process"}),e.jsx(u.Button,{className:"p-segmented-control__button",disabled:t.length===0,onClick:F,children:"Kill process"})]})})]})},K=()=>{const[t,n]=g.useState([]),{instanceId:c}=_(),{search:r,currentPage:o,pageSize:s}=b(),{getProcessesQuery:i}=P(),d=Number(c),{data:a,isLoading:m}=i({computer_id:d,limit:s,offset:(o-1)*s,search:r}),x=(a==null?void 0:a.data.count)??0,h=g.useMemo(()=>(a==null?void 0:a.data.results)??[],[a]),p=()=>{n([])};return e.jsxs(e.Fragment,{children:[!r&&m&&e.jsx(Q,{}),!m&&!r&&(!a||a.data.results.length===0)&&e.jsx(M,{icon:"connected",title:"No processes running"}),(r||!m&&a&&a.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(D,{handleClearSelection:p,selectedPids:t}),e.jsx(z,{processes:h,setSelectedPids:j=>n(j),selectedPids:t})]}),e.jsx(T,{handleClearSelection:p,totalItems:x,currentItemCount:h.length})]})},R=K;export{R as default};
