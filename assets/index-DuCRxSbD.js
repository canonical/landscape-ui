import{r as d,V as y,j as e,D as _,d as m,t as v,k as b,n as f,h as C,g as j,x as E,o as w}from"./index-CSSscRtK.js";import{P as T,a as P,b as S}from"./PageMain-C_EL0_NR.js";import{T as R}from"./TablePagination-Bk6IFP8F.js";import{T as F}from"./TruncatedCell-Chj-DyBS.js";import"./moment-C0lIsxcK.js";import{a as L}from"./helpers-B4Ea794_.js";import{h as x}from"./moment-C5S46NFB.js";import{u as p}from"./usePageParams-DquXj6di.js";import{T as I,a as H}from"./TableFilterChips-D-0Xad7c.js";import"./TablePagination.module-CgQ3jx4B.js";const N="_message_1po57_1",M="_expandedCell_1po57_5",D="_expandedRow_1po57_10",h={message:N,expandedCell:M,expandedRow:D},k=o=>({index:s})=>{const t={};return o===s&&(t.className=h.expandedRow),t},O=o=>({column:s,row:{index:t}})=>{const a={};return s.id==="creation_time"?a.role="rowheader":s.id==="person_name"?a["aria-label"]="username":s.id==="entity_type"?a["aria-label"]="entity type":s.id==="entity_name"?a["aria-label"]="entity name":s.id==="message"&&(a["aria-label"]="message",o===t&&(a.className=h.expandedCell)),a},V=({eventsLog:o})=>{const[s,t]=d.useState(""),[a,r]=d.useState(-1),i=d.useRef([]);y({current:a!==-1?i.current[a]:null},()=>r(-1));const l=d.useMemo(()=>[{accessor:"creation_time",Header:"creation time",Cell:({row:n})=>e.jsx(e.Fragment,{children:x(n.original.creation_time).format(_)})},{accessor:"person_name",Header:"username",Cell:({row:n})=>e.jsx(e.Fragment,{children:n.original.person_name})},{accessor:"entity_type",Header:"entity type",Cell:({row:n})=>e.jsx(e.Fragment,{children:n.original.entity_type})},{accessor:"entity_name",Header:"entity name",Cell:({row:n})=>e.jsx(e.Fragment,{children:n.original.entity_name})},{accessor:"message",className:h.message,Header:"event log message",Cell:({row:{original:n,index:c}})=>e.jsx(F,{content:n.message,isExpanded:c===a,onExpand:()=>{t(""),r(s?c-1:c)}})}],[o,a]);return e.jsx("div",{ref:L(i),children:e.jsx(m.ModularTable,{getCellProps:O(a),getRowProps:k(a),columns:l,data:o,sortable:!0,emptyMsg:"No events found according to your search parameters."})})},Y=[{label:"1 day",value:"1"},{label:"7 days",value:"7"},{label:"30 days",value:"30"},{label:"90 days",value:"90"},{label:"180 days",value:"180"},{label:"365 days",value:"365"}],$=()=>{const{days:o,setPageParams:s}=p();return e.jsx(I,{multiple:!1,label:"Days",hasToggleIcon:!0,options:Y,onItemSelect:t=>s({days:t}),selectedItem:o.toString()})},A="_container_vxbz8_1",z="_searchContainer_vxbz8_11",g={container:A,searchContainer:z},B=()=>{const{search:o,setPageParams:s}=p(),t=()=>{s({search:r.values.searchText})},a=()=>{s({search:""})},r=v({initialValues:{searchText:o},enableReinitialize:!0,validationSchema:b().shape({search:f()}),onSubmit:t});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:g.container,children:[e.jsx("div",{className:g.searchContainer,children:e.jsx(m.Form,{onSubmit:r.handleSubmit,noValidate:!0,children:e.jsx(m.SearchBox,{autocomplete:"off",externallyControlled:!0,value:r.values.searchText,onChange:async i=>await r.setFieldValue("searchText",i),placeholder:"Search",onSearch:t,onClear:a})})}),e.jsx($,{})]}),e.jsx(H,{filtersToDisplay:["search"]})]})};function U(){const o=C();return{getEventsLog:(t,a={})=>j({queryKey:["events",t],queryFn:()=>o.get("events",{params:t}),...a})}}const q="_header_116wp_1",K={header:q},Q=(o,s)=>{const t=["creation_time","person_id","person_name","entity_type","entity_id","entity_name","message"],r=[["Creation Time","Person ID","Person Name","Entity Type","Entity ID","Entity Name","Message"].join(","),...o.map(c=>t.map(u=>c[u]).join(","))].join(`\r
`),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(i),n=document.createElement("a");n.href=l,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n)},oe=()=>{const{days:o,search:s,currentPage:t,pageSize:a}=p(),{user:r}=E(),{getEventsLog:i}=U(),{data:l,isLoading:n}=i({days:Number(o),limit:a,offset:(t-1)*a,search:s}),c=d.useMemo(()=>(l==null?void 0:l.data.results.filter(u=>u.message.toLowerCase().includes(s.toLowerCase())))??[],[l,s]);return e.jsxs(T,{children:[e.jsx(P,{className:K.header,title:"Events log",actions:[e.jsx(m.Button,{type:"button",onClick:()=>Q(c,`Event Log - ${r.current_account}-${x().format("YYYY-MM-DDTHH mm ss[Z]")}.csv`),children:"Download as CSV"},"download-as-cv")]}),e.jsxs(S,{children:[e.jsx(B,{}),n&&e.jsx(w,{}),!n&&c&&e.jsx(V,{eventsLog:c}),e.jsx(R,{totalItems:l==null?void 0:l.data.count,currentItemCount:c.length})]})]})};export{oe as default};
