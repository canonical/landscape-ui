import{j as e,r as _,P as E,Q as w,ao as P,m as i,X as j,y as A,b as S,a as I,A as U,C as N,R as T,G as v,o as O,U as L}from"./index-BnS9w30E.js";import{u as R,A as B}from"./AuthTemplate-BkgnxHfo.js";const k=({methods:s})=>{if(!s)return null;const n=!!(s.standalone_oidc.available&&s.standalone_oidc.enabled),d=!!(s.ubuntu_one.available&&s.ubuntu_one.enabled),r=!!(s.password.available&&s.password.enabled),u=!!(s.pam.available&&s.pam.enabled),p=s.oidc.available?s.oidc.configurations.filter(({enabled:m})=>m):[],o=r||u,h=d||n||s.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[o&&e.jsx(G,{isIdentityAvailable:u}),h&&e.jsx(q,{isStandaloneOidcEnabled:n,isUbuntuOneEnabled:d,oidcProviders:p}),!o&&!h&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},F="_list_9u1s7_1",Q="_button_9u1s7_20",$="_icon_9u1s7_28",b={list:F,button:Q,icon:$},q=({isStandaloneOidcEnabled:s,isUbuntuOneEnabled:n,oidcProviders:d})=>{const[r,u]=_.useState(0),[p]=E(),{invitationId:o}=R(),{getOidcUrlQuery:h,getUbuntuOneUrlQuery:m}=w(),g=p.get("redirect-to"),x=p.has("external"),t={};r>0&&(t.id=r),g&&(t.return_to=g),o&&(t.invitation_id=o),x&&(t.external=!0);const{data:l}=h(t,{enabled:r!==0});_.useEffect(()=>{l&&P(l.data.location)},[l]);const a={};g&&(a.return_to=`${window.origin}${g}`),o&&(a.invitation_id=o),x&&(a.external=!0);const{data:c,refetch:y}=m(a,{enabled:!1});return _.useEffect(()=>{c&&P(c.data.location)},[c]),e.jsxs("ul",{className:b.list,children:[n&&e.jsx("li",{className:"p-list__item",children:e.jsxs(i.Button,{type:"button",hasIcon:!0,onClick:y,className:b.button,children:[e.jsx(i.Icon,{name:j("ubuntu-one"),className:b.icon}),e.jsx("span",{children:"Sign in with Ubuntu One"})]})}),s&&e.jsx("li",{className:"p-list__item",children:e.jsxs(i.Button,{type:"button",hasIcon:!0,onClick:()=>u(-1),className:b.button,children:[e.jsx(i.Icon,{name:j("standalone"),className:b.icon}),e.jsx("span",{children:"Sign in with Enterprise Login"})]})}),d.map(f=>e.jsx("li",{className:"p-list__item",children:e.jsxs(i.Button,{type:"button",hasIcon:!0,onClick:()=>u(f.id),className:b.button,children:[e.jsx(i.Icon,{name:j(f.provider),className:b.icon}),e.jsx("span",{children:`Sign in with ${f.name}`})]})},f.id))]})},C="_buttonRow_f3s21_1",W={buttonRow:C},G=({isIdentityAvailable:s})=>{const[n]=E(),d=A(),{signInWithEmailAndPasswordQuery:r}=w(),{redirectToExternalUrl:u,setAuthLoading:p,setUser:o}=S(),h=I(),m=n.get("redirect-to"),g=n.has("external"),{mutateAsync:x}=r,t=U({initialValues:{email:"",password:""},validationSchema:N().shape({email:s?v().required("This field is required"):v().required("This field is required").matches(/^[a-zA-Z0-9-_.]+@[a-zA-Z0-9-.]*[a-zA-Z]$/,"Please provide a valid email address").test({message:"Please provide a valid email address",test:l=>{if(l.match(/\.\./))return!1;const[a,c]=l.split("@");return!(a.startsWith(".")||a.endsWith(".")||!c.includes(".")||c.startsWith(".")||c.startsWith("-")||c.match(/\.-/)||c.match(/-\./))}}),password:v().required("This field is required")}),onSubmit:async l=>{try{const{data:a}=await x({email:l.email,password:l.password});g&&m?u(m,{replace:!0}):("current_account"in a&&(p(!0),o(a)),h(m??T,{replace:!0}))}catch(a){d(a)}}});return e.jsxs(i.Form,{onSubmit:t.handleSubmit,children:[e.jsx(i.Input,{type:"text",label:s?"Identity":"Email",error:t.touched.email&&t.errors.email?t.errors.email:void 0,...t.getFieldProps("email"),"data-testid":"email"}),e.jsx(i.PasswordToggle,{id:"password",label:"Password",error:t.touched.password&&t.errors.password?t.errors.password:void 0,...t.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:W.buttonRow,children:e.jsx(i.Button,{type:"submit",appearance:"positive",disabled:t.isSubmitting||!t.isValid,className:"u-no-margin--bottom",children:"Sign in"})})]})},H=()=>{const{getLoginMethodsQuery:s}=w(),{data:n,isLoading:d,isError:r}=s();return e.jsx(B,{title:"Sign in to Landscape",children:d?e.jsx(O,{}):r?e.jsx("p",{className:"u-no-margin--bottom",children:L}):e.jsx(k,{methods:(n==null?void 0:n.data)??null})})};export{H as default};
