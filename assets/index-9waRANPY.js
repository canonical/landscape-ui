import{j as e,r as _,V as E,W as w,az as P,n as r,$ as j,A as y,b as S,a as I,C as N,J as U,X as T,M as v,p as O,Y as L}from"./index-DgVvgk8h.js";import{u as B,A as R}from"./AuthTemplate-C5D6I3kg.js";const $=({methods:s})=>{if(!s)return null;const n=!!(s.standalone_oidc.available&&s.standalone_oidc.enabled),d=!!(s.ubuntu_one.available&&s.ubuntu_one.enabled),o=!!(s.password.available&&s.password.enabled),u=!!(s.pam.available&&s.pam.enabled),p=s.oidc.available?s.oidc.configurations.filter(({enabled:m})=>m):[],l=o||u,h=d||n||s.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[l&&e.jsx(M,{isIdentityAvailable:u}),h&&e.jsx(q,{isStandaloneOidcEnabled:n,isUbuntuOneEnabled:d,oidcProviders:p}),!l&&!h&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},k="_list_9u1s7_1",F="_button_9u1s7_20",W="_icon_9u1s7_28",b={list:k,button:F,icon:W},q=({isStandaloneOidcEnabled:s,isUbuntuOneEnabled:n,oidcProviders:d})=>{const[o,u]=_.useState(0),[p]=E(),{invitationId:l}=B(),{getOidcUrlQuery:h,getUbuntuOneUrlQuery:m}=w(),g=p.get("redirect-to"),x=p.has("external"),t={};o>0&&(t.id=o),g&&(t.return_to=g),l&&(t.invitation_id=l),x&&(t.external=!0);const{data:c}=h(t,{enabled:o!==0});_.useEffect(()=>{c&&P(c.data.location)},[c]);const a={};g&&(a.return_to=`${window.origin}${g}`),l&&(a.invitation_id=l),x&&(a.external=!0);const{data:i,refetch:A}=m(a,{enabled:!1});return _.useEffect(()=>{i&&P(i.data.location)},[i]),e.jsxs("ul",{className:b.list,children:[n&&e.jsx("li",{className:"p-list__item",children:e.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:A,className:b.button,children:[e.jsx(r.Icon,{name:j("ubuntu-one"),className:b.icon}),e.jsx("span",{children:"Sign in with Ubuntu One"})]})}),s&&e.jsx("li",{className:"p-list__item",children:e.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:()=>u(-1),className:b.button,children:[e.jsx(r.Icon,{name:j("standalone"),className:b.icon}),e.jsx("span",{children:"Sign in with Enterprise Login"})]})}),d.map(f=>e.jsx("li",{className:"p-list__item",children:e.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:()=>u(f.id),className:b.button,children:[e.jsx(r.Icon,{name:j(f.provider),className:b.icon}),e.jsx("span",{children:`Sign in with ${f.name}`})]})},f.id))]})},C="_buttonRow_f3s21_1",Q={buttonRow:C},M=({isIdentityAvailable:s})=>{const[n]=E(),d=y(),{signInWithEmailAndPasswordQuery:o}=w(),{redirectToExternalUrl:u,setAuthLoading:p,setUser:l}=S(),h=I(),m=n.get("redirect-to"),g=n.has("external"),{mutateAsync:x}=o,t=N({initialValues:{email:"",password:""},validationSchema:U().shape({email:s?v().required("This field is required"):v().required("This field is required").matches(/^[a-zA-Z0-9-_.]+@[a-zA-Z0-9-.]*[a-zA-Z]$/,"Please provide a valid email address").test({message:"Please provide a valid email address",test:c=>{if(c.match(/\.\./))return!1;const[a,i]=c.split("@");return!(!a||!i||a.startsWith(".")||a.endsWith(".")||!i.includes(".")||i.startsWith(".")||i.startsWith("-")||i.match(/\.-/)||i.match(/-\./))}}),password:v().required("This field is required")}),onSubmit:async c=>{try{const{data:a}=await x({email:c.email,password:c.password});g&&m?u(m,{replace:!0}):("current_account"in a&&(p(!0),l(a)),h(m??T,{replace:!0}))}catch(a){d(a)}}});return e.jsxs(r.Form,{onSubmit:t.handleSubmit,children:[e.jsx(r.Input,{type:"text",label:s?"Identity":"Email",error:t.touched.email&&t.errors.email?t.errors.email:void 0,...t.getFieldProps("email"),"data-testid":"email"}),e.jsx(r.PasswordToggle,{id:"password",label:"Password",error:t.touched.password&&t.errors.password?t.errors.password:void 0,...t.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:Q.buttonRow,children:e.jsx(r.Button,{type:"submit",appearance:"positive",disabled:t.isSubmitting||!t.isValid,className:"u-no-margin--bottom",children:"Sign in"})})]})},H=()=>{const{getLoginMethodsQuery:s}=w(),{data:n,isLoading:d,isError:o}=s();return e.jsx(R,{title:"Sign in to Landscape",children:d?e.jsx(O,{}):o?e.jsx("p",{className:"u-no-margin--bottom",children:L}):e.jsx($,{methods:(n==null?void 0:n.data)??null})})};export{H as default};
