import{r as p,j as s,m as g,i as _,f as I,g as y,h as C,J as j,z as F,y as N,n as k,ah as S,c as H,o as P,E,ai as M}from"./index-CmxBU4NC.js";import{H as Q}from"./HeaderWithSearch-BJGK9Eki.js";const v=({processes:t,selectedPids:n,setSelectedPids:r})=>{const o=()=>{r(n.length===0?t.map(({pid:e})=>e):[])},c=p.useMemo(()=>[{accessor:"name",Header:s.jsxs(s.Fragment,{children:[s.jsx(g.CheckboxInput,{inline:!0,label:s.jsx("span",{className:"u-off-screen",children:"Toggle all processes"}),checked:n.length>0&&n.length===t.length,disabled:t.length===0,onChange:o,indeterminate:n.length>0&&n.length<t.length}),s.jsx("span",{children:"Command"})]}),Cell:({row:e})=>s.jsxs(s.Fragment,{children:[s.jsx(g.CheckboxInput,{inline:!0,label:s.jsx("span",{className:"u-off-screen",children:`Select process ${e.original.name}`}),checked:n.includes(e.original.pid),onChange:()=>{r(n.includes(e.original.pid)?n.filter(i=>i!==e.original.pid):[...n,e.original.pid])}}),s.jsx("span",{children:e.original.name})]})},{accessor:"state",Header:"State"},{accessor:"vm_size",Header:"VM size"},{accessor:"cpu_utilization",Header:"CPU (%)",Cell:({row:e})=>s.jsxs(s.Fragment,{children:[(100*e.original.cpu_utilisation).toFixed(1),"%"]})},{accessor:"pid",Header:"PID"},{accessor:"start_time",Header:"Started at"},{accessor:"gid",Header:"Group"}],[t,n]);return s.jsx(g.ModularTable,{columns:c,data:t,emptyMsg:"No processes found"})};function b(){const t=_(),n=I(),r=(e,i={})=>{if(!e)throw new Error("Missing required parameters");const{computer_id:l,...m}=e;return C({queryKey:["processes",e],queryFn:async()=>t.get(`/computers/${l}/processes`,{params:m}),...i})},o=y({mutationFn:async e=>t.post("processes/terminate",e),onSuccess:async()=>n.invalidateQueries({queryKey:["processes"]})}),c=y({mutationFn:async e=>t.post("processes/kill",e),onSuccess:async()=>n.invalidateQueries({queryKey:["processes"]})});return{getProcessesQuery:r,killProcessQuery:c,terminateProcessQuery:o}}const z="_actions_1l3g0_1",K={actions:z},T=({selectedPids:t,handleClearSelection:n})=>{const{instanceId:r}=j(),{notify:o}=F(),c=N(),{killProcessQuery:e,terminateProcessQuery:i}=b(),l=Number(r),{mutateAsync:m}=i,{mutateAsync:a}=e,d=async()=>{try{await m({pids:t,computer_id:l}),o.success({message:`${t.length===1?"Process":"Processes"} successfully ended`}),n()}catch(u){c(u)}},h=async()=>{try{await a({pids:t,computer_id:l}),o.success({message:`${t.length===1?"Process":"Processes"} successfully killed`}),n()}catch(u){c(u)}};return s.jsxs(s.Fragment,{children:[s.jsx(Q,{actions:s.jsx("div",{className:k("p-segmented-control",K.actions),children:s.jsxs("div",{className:"p-segmented-control__list",children:[s.jsx(g.Button,{type:"button",className:"p-segmented-control__button u-no-margin--bottom",disabled:t.length===0,onClick:d,children:"End process"}),s.jsx(g.Button,{type:"button",className:"p-segmented-control__button u-no-margin--bottom",disabled:t.length===0,onClick:h,children:"Kill process"})]})}),afterSearch:n}),s.jsx(S,{filtersToDisplay:["search"]})]})},A=()=>{const[t,n]=p.useState([]),{instanceId:r,childInstanceId:o}=j(),{search:c,currentPage:e,pageSize:i}=H(),{getProcessesQuery:l}=b(),m=Number(o??r),{data:a,isLoading:d}=l({computer_id:m,limit:i,offset:(e-1)*i,search:c}),h=(a==null?void 0:a.data.count)??0,u=p.useMemo(()=>(a==null?void 0:a.data.results)??[],[a]),x=()=>{n([])};return s.jsxs(s.Fragment,{children:[!c&&d&&s.jsx(P,{}),!d&&!c&&(!a||a.data.results.length===0)&&s.jsx(E,{icon:"connected",title:"No processes running"}),(c||!d&&a&&a.data.results.length>0)&&s.jsxs(s.Fragment,{children:[s.jsx(T,{handleClearSelection:x,selectedPids:t}),s.jsx(v,{processes:u,setSelectedPids:f=>n(f),selectedPids:t})]}),s.jsx(M,{handleClearSelection:x,totalItems:h,currentItemCount:u.length})]})};export{A as default};
