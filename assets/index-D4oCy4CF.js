const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DuxXtfyU.js","assets/index-D0eLLMjG.js","assets/index-CMPBhKCb.css","assets/AssociationBlock-BMx2fCuf.js","assets/MultiSelectField-B1geshqK.js","assets/MultiSelectField-GyNA33om.css","assets/useGetTags-XdYzCr2r.js","assets/AssociationBlock-vsPH8fvb.css","assets/SidePanelFormButtons-C-BZcwoC.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useRoles-DO9PSQ2F.js","assets/RandomizationBlock-Zv04cjec.js","assets/RadioGroup-D1ClNkCN.js","assets/RadioGroup-WBbAFTwm.css","assets/TextConfirmationModal-BXLfp-SY.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/PageMain-CkxG3P6U.js","assets/PageMain-C_v2-kHh.css","assets/HeaderWithSearch-B_sdfFvF.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/constants-D7yXN3Pr.js","assets/index-LhlFy-U_.css"])))=>i.map(i=>d[i]);
import{d as R,l as _,i as v,k as C,j as e,ax as j,S,J as w,as as A,q as E,s as T,m as f,a0 as L,a4 as D,aE as k,n as d,e as y,aF as F,w as O,Q as M,aB as I,a as N,E as $,o as B,ac as p,_ as b}from"./index-D0eLLMjG.js";import{P as H,a as Q,b as q}from"./PageMain-CkxG3P6U.js";import{H as z}from"./HeaderWithSearch-B_sdfFvF.js";import{L as V}from"./constants-D7yXN3Pr.js";import{u as G}from"./useRoles-DO9PSQ2F.js";import{T as K}from"./TextConfirmationModal-BXLfp-SY.js";function U(t={}){const s=R(),r=()=>_({queryKey:["rebootprofiles"],queryFn:async({signal:c})=>s.get("rebootprofiles",{signal:c}),...t}),{data:o,isPending:n,error:l}=r();return{rebootProfiles:o?.data.results||[],isPending:n,rebootProfilesError:l}}function Y(){const t=R(),s=v(),r=C({mutationKey:["rebootprofiles","remove"],mutationFn:async l=>t.delete(`rebootprofiles/${l.id}`),onSuccess:async()=>s.invalidateQueries({queryKey:["rebootprofiles"]})}),{mutateAsync:o,isPending:n}=r;return{removeRebootProfile:o,isRemovingRebootProfile:n}}const J=({rebootProfile:t})=>!t.tags.length&&!t.all_computers?e.jsx(j,{}):t.num_computers?e.jsxs(S,{to:{pathname:"/instances",search:`query=${encodeURIComponent(`profile:reboot:${t.id}`)}`},children:[t.num_computers," ",w(t.num_computers,"instance")]}):"0 instances",W=()=>e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx(A,{filtersToDisplay:["search"]})]}),X=({profile:t})=>{const s=E(),{notify:r}=T(),{setPageParams:o}=f(),{value:n,setTrue:l,setFalse:c}=L(),{removeRebootProfile:h,isRemovingRebootProfile:u}=Y(),P=async()=>{try{await h({id:t.id}),r.success({message:`Reboot profile "${t.title}" removed successfully`,title:"Reboot profile removed"})}catch(m){s(m)}finally{c()}},g=()=>{o({sidePath:["edit"],profile:t.id.toString()})},x=()=>{o({sidePath:["duplicate"],profile:t.id.toString()})},a=[{icon:"edit",label:"Edit","aria-label":`Edit "${t.title}" profile`,onClick:g},{icon:"canvas",label:"Duplicate","aria-label":`Duplicate "${t.title}" profile`,onClick:x}],i=[{icon:"delete",label:"Remove","aria-label":`Remove "${t.title}" profile`,onClick:l}];return e.jsxs(e.Fragment,{children:[e.jsx(D,{toggleAriaLabel:`${t.title} profile actions`,actions:a,destructiveActions:i}),e.jsx(K,{isOpen:n,title:"Confirm delete",confirmButtonLabel:"Delete",onConfirm:P,close:c,confirmButtonDisabled:u,confirmButtonLoading:u,confirmButtonAppearance:"negative",confirmationText:`remove ${t.title}`,children:e.jsxs("p",{children:['Are you sure you want to remove "',t.title,'" reboot profile? The removal of "',t.title,'" reboot profile is irreversible and might adversely affect your system.']})})]})},Z=t=>({column:s,row:{index:r}})=>{const o={};switch(s.id){case"title":o.role="rowheader";break;case"access_group":o["aria-label"]="Access group";break;case"tags":o["aria-label"]="Tags",t===r&&(o.className="expandedCell");break;case"associated":o["aria-label"]="Associated instances";break;case"actions":o["aria-label"]="Actions";break}return o},ee=t=>({index:s,original:r})=>{const o={};return t===s&&(o.className="expandedRow"),o["aria-label"]=`${r.title} reboot profile row`,o},te=({profiles:t})=>{const{search:s,setPageParams:r}=f(),{getAccessGroupQuery:o}=G(),{expandedRowIndex:n,handleExpand:l,getTableRowsRef:c}=k(),{data:h}=o(),u=h?.data.map(({name:a,title:i})=>({label:i,value:a}))??[],P=d.useMemo(()=>s?t.filter(a=>a.title.toLowerCase().includes(s.toLowerCase())):t,[t,s]),g=a=>{r({sidePath:["view"],profile:a.id.toString()})},x=d.useMemo(()=>[{accessor:"title",Header:"Title",Cell:({row:{original:a}})=>e.jsx(y.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{g(a)},children:a.title})},{accessor:"access_group",Header:"access group",Cell:({row:{original:a}})=>e.jsx(e.Fragment,{children:u.find(({value:i})=>i===a.access_group)?.label??a.access_group})},{accessor:"tags",Header:"Tags",Cell:({row:{original:a,index:i}})=>a.tags.length>0?e.jsx(F,{content:a.tags.map(m=>e.jsx("span",{className:"truncatedItem",children:m},m)),isExpanded:i==n,onExpand:()=>{l(i)},showCount:!0}):e.jsx(j,{})},{accessor:"associated",Header:"associated",Cell:({row:{original:a}})=>e.jsx(J,{rebootProfile:a})},{accessor:"scheduled_reboot",Header:"scheduled reboot",className:"date-cell",Cell:({row:a})=>e.jsx("span",{className:"font-monospace",children:O(a.original.next_run).format(M)})},{...V,Cell:({row:a})=>e.jsx(X,{profile:a.original})}],[u.length,n]);return e.jsx("div",{ref:c,children:e.jsx(I,{columns:x,data:P,emptyMsg:`No profiles found with the search: "${s}"`,getCellProps:Z(n),getRowProps:ee(n)})})},oe=()=>{const{rebootProfiles:t,isPending:s}=U(),{search:r,setPageParams:o}=f(),n=()=>{o({sidePath:["add"],profile:""})};return e.jsxs(e.Fragment,{children:[s&&e.jsx(N,{}),!s&&t.length===0&&!r&&e.jsx($,{title:"You don't have any Reboot profiles yet",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"Regular reboots keep your system healthy and secure by applying the latest updates. They also help maintain Livepatch coverage. Add a reboot profile to automate this process for your instances."}),e.jsx("a",{href:"https://ubuntu.com/security/livepatch/docs",target:"_blank",rel:"nofollow noopener noreferrer",children:"Learn more about Livepatch."})]}),cta:[e.jsx(y.Button,{appearance:"positive",onClick:n,type:"button",children:"Add reboot profile"},"table-add-new-profile")]}),!s&&t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(W,{}),e.jsx(te,{profiles:t})]})]})},se=d.lazy(async()=>b(()=>import("./index-DuxXtfyU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(t=>({default:t.RebootProfileAddSidePanel}))),ae=d.lazy(async()=>b(()=>import("./index-DuxXtfyU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(t=>({default:t.RebootProfileDetailsSidePanel}))),re=d.lazy(async()=>b(()=>import("./index-DuxXtfyU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(t=>({default:t.RebootProfileDuplicateSidePanel}))),ne=d.lazy(async()=>b(()=>import("./index-DuxXtfyU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(t=>({default:t.RebootProfileEditSidePanel}))),ie=()=>{const{sidePath:t,lastSidePathSegment:s,setPageParams:r}=f();B("sidePath",["add","duplicate","edit","view"]);const o=()=>{r({sidePath:["add"],profile:""})};return e.jsxs(H,{children:[e.jsx(Q,{title:"Reboot profiles",actions:[e.jsx(y.Button,{appearance:"positive",onClick:o,type:"button",children:"Add reboot profile"},"new-key-button")]}),e.jsx(q,{children:e.jsx(oe,{})}),e.jsxs(p,{onClose:()=>{r({sidePath:[],profile:""})},isOpen:!!t.length,children:[s==="add"&&e.jsx(p.Suspense,{children:e.jsx(se,{})},"add"),s==="duplicate"&&e.jsx(p.Suspense,{children:e.jsx(re,{})},"duplicate"),s==="edit"&&e.jsx(p.Suspense,{children:e.jsx(ne,{})},"edit"),s==="view"&&e.jsx(p.Suspense,{children:e.jsx(ae,{})},"view")]},"add")]})},fe=Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"}));export{J as R,oe as a,W as b,te as c,fe as i,Y as u};
