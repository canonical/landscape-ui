const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cq7IpJb0.js","assets/ScriptsTabs-BSK7sb4n.js","assets/index-Dfc97QGW.js","assets/index-CBwtg6kZ.css","assets/TablePagination-B0v8QAQr.js","assets/TableFilterChips-DXWGZ6VK.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-DZURD2KR.css","assets/helpers-BbXQOWxJ.js","assets/constants-BTpoIHxf.js","assets/NoData-DMN9LLPq.js","assets/ResponsiveTable-ViIMTRR6.js","assets/ResponsiveTable-Czda4kFo.css","assets/StaticLink-BNg3qc2M.js","assets/TruncatedCell-Cf7_euhM.js","assets/Truncated-D8EZCoK1.js","assets/Truncated-uqJp6ujM.css","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-DYtdXwcw.js","assets/useRoles-TXLG25Jr.js","assets/useFetchOld-BgGVMMmJ.js","assets/TextConfirmationModal-O9rtHEfo.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/PageParamFilter-C5PJgjVf.js","assets/TableFilter-BmLRyeMD.js","assets/TableFilter-B85Stwni.css","assets/HeaderWithSearch-cCuZhEhs.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-DvhuGYYD.js","assets/SingleInstanceTabs-S4NROY16.css","assets/index-DiSNWm9B.js","assets/ScriptsTabs-DN44MVZt.css","assets/ScriptDropdown-DJ8TKgp3.js","assets/useInfiniteQuery-Dl6Bz4vo.js","assets/downshift.esm-DGSOz4JI.js","assets/ScriptDropdown-rmGnZk9-.css","assets/SidePanelFormButtons-BdOP5SSP.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useRunScript-Yt_xBd8E.js","assets/formikErrors-Bw8iTXYS.js","assets/DeliveryBlock-FX2F7SvQ.js","assets/RadioGroup-DkbRD5zc.js","assets/RadioGroup-WBbAFTwm.css","assets/index-hYwEtP4E.js","assets/CodeEditor-HNBBpJH4.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-8WXYDIyH.js","assets/AttachmentFile-DaL_KzgH.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-xGY2QQQn.js","assets/SidePanel-BVCSOSpO.js","assets/SidePanel-5ugWznou.css","assets/ScriptProfileForm-jsud-xeu.js","assets/AssociationBlock-BvR_yeWx.js","assets/MultiSelectField-fcXogomg.js","assets/MultiSelectField-GyNA33om.css","assets/useGetTags-oA_gPXb8.js","assets/AssociationBlock-vsPH8fvb.css","assets/useGetInstances-Ccq0NH3v.js","assets/InstancesPageActions-Dns4Yse-.js","assets/index-S_kjB96R.js","assets/index-DzMlcK9Q.css","assets/ListTitle-DsIgCqjQ.js","assets/ListTitle-CxCHkD9o.css","assets/InfoGrid-CrJbMYy5.js","assets/InfoItem-DImpX37B.js","assets/InfoItem-D8nPzgUA.css","assets/InfoGrid-D3QqOHFx.css","assets/InstancesPageActions-ChZMRYY_.css","assets/ScriptProfileForm-CqtphJAy.css","assets/ProfileAssociatedInstancesLink-CSFk2VcW.js","assets/index-6vk6EbPT.js","assets/useGetPageScriptProfile-DtK3AzaF.js","assets/index-D_AsmxUd.js","assets/index-CpGGN5YE.css"])))=>i.map(i=>d[i]);
import{f as w,v as H,w as $,c as O,s as g,j as t,d as f,E as L,y as G,r as P,e as _,$ as y,H as E,B as Y,g as F,ab as B,L as W,o as q,N as z,R as V,D as K}from"./index-Dfc97QGW.js";import{S as x}from"./SidePanel-BVCSOSpO.js";import{a as J,u as Q}from"./TableFilterChips-DXWGZ6VK.js";import{a as Z}from"./TablePagination-B0v8QAQr.js";import{u as X}from"./ScriptsTabs-BSK7sb4n.js";import"./helpers-BbXQOWxJ.js";import"./index-DiSNWm9B.js";import{P as ee}from"./PageParamFilter-C5PJgjVf.js";import{H as te}from"./HeaderWithSearch-cCuZhEhs.js";import{L as se}from"./constants-BTpoIHxf.js";import{N as b}from"./NoData-DMN9LLPq.js";import{R as re}from"./ResponsiveTable-ViIMTRR6.js";import{T as ie}from"./TruncatedCell-Cf7_euhM.js";import{u as ae}from"./useExpandableRow-DYtdXwcw.js";import{P as oe}from"./ProfileAssociatedInstancesLink-CSFk2VcW.js";import{T as ne}from"./TextConfirmationModal-O9rtHEfo.js";const ce=()=>{const e=w(),s=H(),{isPending:a,mutateAsync:i}=$({mutationFn:async({id:o})=>e.post(`script-profiles/${o}:archive`),onSuccess:async()=>s.invalidateQueries({queryKey:["scriptProfiles"]})});return{isArchivingScriptProfile:a,archiveScriptProfile:i}},R=()=>{const e=w(),{data:s,isLoading:a}=O({queryKey:["scriptProfileLimits"],queryFn:async()=>e.get("script-profile-limits")});return{scriptProfileLimits:s?.data??null,isGettingScriptProfileLimits:a}},le={listenToUrlParams:!0},C=(e,s)=>{const a=w(),{currentPage:i,pageSize:o,status:c,search:r}=g();e={...le,...e};const n={...e.listenToUrlParams?{limit:o,offset:(i-1)*o,search:r??void 0,archived:c||"active"}:s},{data:l,isPending:p}=O({queryKey:["scriptProfiles",n],queryFn:async()=>a.get("script-profiles",{params:n})});return{scriptProfiles:l?.data.results??[],scriptProfilesCount:l?.data.count,isGettingScriptProfiles:p}},M=({appearance:e})=>{const{createPageParamsSetter:s}=g(),{scriptProfilesCount:a}=C({listenToUrlParams:!1},{archived:"active"}),{scriptProfileLimits:i}=R(),o=s({sidePath:["add"],profile:""});return t.jsxs(f.Button,{type:"button",appearance:e,onClick:o,className:"u-no-margin--bottom",hasIcon:!0,disabled:(a??0)>=(i?.max_num_profiles??0),children:[t.jsx(f.Icon,{name:"plus",light:e==="positive"}),t.jsx("span",{children:"Add profile"})]})},de=()=>t.jsx(L,{title:"You don't have any script profiles yet.",body:t.jsxs(t.Fragment,{children:[t.jsx("p",{children:"Script profiles allow you to automate your script runs based on triggers. Triggers can be either a recurring schedule, on a set date, or before or after an event."}),t.jsx(M,{appearance:"positive"})]})}),ue=P.lazy(async()=>y(()=>import("./index-Cq7IpJb0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50])).then(e=>({default:e.CreateScriptForm}))),pe=()=>{const{setSidePanelContent:e}=G(),s=()=>{e("Add script",t.jsx(P.Suspense,{fallback:t.jsx(_,{}),children:t.jsx(ue,{})}))};return t.jsx(L,{title:"You need at least one script to add a profile.",body:t.jsxs(t.Fragment,{children:[t.jsx("p",{children:"In order to create a script profile, you need to have added a script to your Landscape organization."}),t.jsxs(f.Button,{type:"button",appearance:"positive",onClick:s,className:"u-no-margin--bottom",hasIcon:!0,children:[t.jsx(f.Icon,{name:"plus",light:!0}),t.jsx("span",{children:"Add script"})]})]})})},N=[{label:"All",value:"all"},{label:"Active",value:""},{label:"Archived",value:"archived"}],me="_actions_dhdem_1",he={actions:me},fe=()=>t.jsxs(t.Fragment,{children:[t.jsx(te,{actions:t.jsxs("div",{className:he.actions,children:[t.jsx(ee,{pageParamKey:"status",label:"Status",options:N}),t.jsx(M,{})]})}),t.jsx(J,{filtersToDisplay:["search","status"],statusOptions:N})]}),u={MINUTE:{min:0,max:59},HOUR:{min:0,max:23},DAY_OF_MONTH:{min:1,max:31},MONTH:{min:1,max:12},DAY_OF_WEEK:{min:0,max:6}},ge=e=>{switch(e%100){case 11:case 12:case 13:return"th"}switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},Pe=e=>`${e}${ge(e)}`,T=(e,s)=>s?s.labels[s.offset?e-s.offset:e]:e,I=(e,s)=>e.start==s.min&&e.end==s.max&&e.step==1,S=(e,s,a,i,o)=>{let c="";if(e.some(n=>I(n,s)))return c;i&&(c+=` ${i} `);const r=e.map(n=>{let l="";return(n.step>1||n.start!=n.end)&&(l+="every "),n.step>1&&(l+=`${Pe(n.step)} `),n.start!=n.end||n.step>1?(l+=a,(n.start!=s.min||n.end!=s.max)&&(l+=` from ${T(n.start,o)} through ${T(n.end,o)}`)):o?l+=T(n.start,o):l+=`${a} ${n.start}`,l});return c+=r.slice(0,-1).join(", "),r.length>2&&(c+=","),r.length>1&&(c+=" and "),c+=r.slice(-1),c},A=e=>{const s=parseFloat(e);if(!Number.isSafeInteger(s))throw new Error("Invalid value.");return s},v=(e,s,a={})=>e.split(",").map(i=>{const o={start:Number.NaN,end:Number.NaN,step:1},c=l=>{if(l=="*"){o.start=s.min,o.end=s.max;return}l=l.replaceAll(/[a-zA-Z]+/g,d=>{const h=a[d.toUpperCase()];if(!h)throw new Error("Invalid character.");return h});const[p,m]=l.split("-").map(A);if(p!==void 0&&m!==void 0){if(m<p)throw new Error("The end of a range must not be less than the start.");o.start=p,o.end=m}else{const d=A(l);o.start=d,o.end=d}},[r,n]=i.split("/");if(r!==void 0&&n!==void 0?(o.step=A(n),c(r)):c(i),o.start<s.min||o.end>s.max)throw new Error("Value out of range.");return o}),Se=e=>{const[s,a,i,o,c]=e.trim().split(/ +/);if(!s||!a||!i||!o||!c)throw new Error("Enter a complete interval.");const r=v(s,u.MINUTE),n=v(a,u.HOUR),l=v(i,u.DAY_OF_MONTH),p=v(o,u.MONTH,{JAN:"1",FEB:"2",MAR:"3",APR:"4",MAY:"5",JUN:"6",JUL:"7",AUG:"8",SEP:"9",OCT:"10",NOV:"11",DEC:"12"}),m=v(c,u.DAY_OF_WEEK,{SUN:"0",MON:"1",TUE:"2",WED:"3",THU:"4",FRI:"5",SAT:"6"});let d="at ";r.some(j=>I(j,u.MINUTE))&&(d+="every minute"),E(r)&&r[0].start==r[0].end&&E(n)&&n[0].start==n[0].end?d+=`${n[0].start.toString().padStart(2,"0")}:${r[0].start.toString().padStart(2,"0")}`:(d+=S(r,u.MINUTE,"minute"),d+=S(n,u.HOUR,"hour","past"));const h=S(l,u.DAY_OF_MONTH,"day-of-month","on");return d+=h,d+=S(m,u.DAY_OF_WEEK,"day-of-week",h?"and on":"on",{labels:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}),d+=S(p,u.MONTH,"month","in",{offset:1,labels:["January","February","March","April","May","June","July","August","September","October","November","December"]}),d},ve=e=>e.archived?"Archived":"Active",D=e=>{switch(e.trigger.trigger_type){case"event":return e.trigger.event_type==="post_enrollment"?"Post enrollment":void 0;case"one_time":return"On a date";case"recurring":return"Recurring"}},ze=e=>e.trigger.trigger_type==="recurring"?`Recurring, ${Se(e.trigger.interval)}`:D(e),xe=({scriptProfile:e})=>e.trigger.trigger_type==="event"&&e.trigger.event_type==="post_enrollment"?t.jsx(b,{}):t.jsx(oe,{count:e.computers.num_associated_computers,profile:e,query:`script:${e.id}`}),_e=({profile:e,opened:s,onClose:a})=>{const{notify:i}=Y(),{archiveScriptProfile:o,isArchivingScriptProfile:c}=ce(),r=async()=>{await o({...e}),a(),i.success({title:`You have successfully archived "${e.title}"`,message:"The profile will no longer run on the defined schedule."})};return t.jsx(ne,{isOpen:s,title:`Archive ${e.title}`,confirmButtonLabel:"Archive",confirmButtonDisabled:c,confirmButtonLoading:c,onConfirm:r,close:a,confirmationText:`archive ${e.title}`,children:t.jsxs("p",{children:["Archiving the script will prevent it from running in the future.",t.jsx("br",{}),"This action is ",t.jsx("strong",{children:"irreversible"}),"."]})})},ye=({scriptProfile:e})=>{const{createPageParamsSetter:s}=g(),{value:a,setTrue:i,setFalse:o}=F(),c=[{icon:"show",label:"View details",onClick:s({sidePath:["view"],profile:e.id.toString()})}];e.archived||c.push({icon:"edit",label:"Edit",onClick:s({sidePath:["edit"],profile:e.id.toString()})});const r=e.archived?void 0:[{icon:"archive",label:"Archive",onClick:i}];return t.jsxs(t.Fragment,{children:[t.jsx(B,{toggleAriaLabel:`${e.title} script profile actions`,actions:c,destructiveActions:r}),t.jsx(_e,{onClose:o,opened:a,profile:e})]})},je=e=>({column:s,row:{index:a}})=>{const i={};switch(s.id){case"title":i.role="rowheader";break;case"archived":i["aria-label"]="Status";break;case"all_computers":i["aria-label"]="Associated instances";break;case"tags":i["aria-label"]="Tags",e===a&&(i.className="expandedCell");break;case"trigger":i["aria-label"]="Trigger";break;case"activities.last_activity.creation_time":i["aria-label"]="Last run";break;case"actions":i["aria-label"]="Actions";break}return i},Te=e=>({index:s,original:a})=>{const i={};return e===s&&(i.className="expandedRow"),i["aria-label"]=`${a.title} script profile row`,i},Ae=({profiles:e})=>{const{createPageParamsSetter:s}=g(),{expandedRowIndex:a,handleExpand:i,getTableRowsRef:o}=ae(),c=P.useMemo(()=>[{Header:"Title",accessor:"title",Cell:({row:{original:r}})=>t.jsx(f.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top u-align-text--left",onClick:s({sidePath:["view"],profile:r.id.toString()}),children:r.title})},{Header:"Status",accessor:"archived",Cell:({row:{original:r}})=>ve(r),getCellIcon:({row:{original:{archived:r}}})=>r?"status-queued-small":"status-succeeded-small"},{Header:"Associated instances",accessor:"all_computers",Cell:({row:{original:r}})=>t.jsx(xe,{scriptProfile:r})},{Header:"Tags",accessor:"tags",Cell:({row:{original:r,index:n}})=>r.all_computers?"All instances":r.tags.length===0?t.jsx(b,{}):t.jsx(ie,{content:r.tags.map(l=>t.jsx("span",{className:"truncatedItem",children:l},l)),isExpanded:n==a,onExpand:()=>{i(n)},showCount:!0})},{Header:"Trigger",accessor:"trigger",Cell:({row:{original:r}})=>D(r)},{Header:"Last run",accessor:"activities.last_activity.creation_time",className:"date-cell",Cell:({row:{original:{activities:{last_activity:r}}}})=>r?t.jsxs(W,{className:"font-monospace",to:V.activities.root({query:`parent-id:${r.id}`}),children:[q(r.creation_time).utc().format(z)," "]}):t.jsx(b,{})},{...se,Cell:({row:{original:r}})=>t.jsx(ye,{scriptProfile:r})}],[s,a,i]);return t.jsx(re,{ref:o,columns:c,data:e,emptyMsg:"No script profiles found according to your search parameters.",getCellProps:je(a),getRowProps:Te(a),minWidth:1200})},be=()=>{const{currentPage:e,pageSize:s,search:a,status:i}=g(),{scriptsCount:o,isScriptsLoading:c}=X({listenToUrlParams:!1},{script_type:"active",limit:0,offset:0}),{scriptProfiles:r,scriptProfilesCount:n,isGettingScriptProfiles:l}=C(),{scriptProfilesCount:p,isGettingScriptProfiles:m}=C({listenToUrlParams:!1},{archived:"active"}),{scriptProfileLimits:d,isGettingScriptProfileLimits:h}=R(),{value:j,setFalse:U}=F(!0),k=e===1&&s===K&&l;return m||h||d===null?t.jsx(_,{}):r.length||a||i||k?t.jsxs(t.Fragment,{children:[t.jsx(fe,{}),j&&p&&p>=d.max_num_profiles&&t.jsxs(f.Notification,{inline:!0,title:"Profile limit reached:",severity:"caution",onDismiss:U,children:["You've reached the limit of"," ",d.max_num_profiles," active script profiles. To be able to add new profiles you must archive an active one."]}),l?t.jsx(_,{}):t.jsx(Ae,{profiles:r}),t.jsx(Z,{totalItems:n,currentItemCount:r.length})]}):c?t.jsx(_,{}):o?t.jsx(de,{}):t.jsx(pe,{})},Ce=P.lazy(()=>y(()=>import("./index-xGY2QQQn.js"),__vite__mapDeps([51,2,3,52,53,54,55,56,57,58,59,36,37,38,60,61,62,10,11,12,4,5,6,7,20,23,24,25,40,63,64,65,13,14,15,16,17,18,30,21,22,66,67,68,69,70,8,1,9,19,26,27,28,29,31,32,33,34,35,71,72]))),we=P.lazy(()=>y(()=>import("./index-6vk6EbPT.js"),__vite__mapDeps([73,2,3,52,53,74,54,55,56,57,58,59,36,37,38,60,61,62,10,11,12,4,5,6,7,20,23,24,25,40,63,64,65,13,14,15,16,17,18,30,21,22,66,67,68,69,70,8,1,9,19,26,27,28,29,31,32,33,34,35,71,72]))),Ee=P.lazy(()=>y(()=>import("./index-D_AsmxUd.js"),__vite__mapDeps([75,2,3,52,53,74,5,6,4,7,1,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,72,76]))),Ne=()=>{const{sidePath:e,lastSidePathSegment:s,createPageParamsSetter:a}=g(),i=a({sidePath:[],profile:""});return Q("sidePath",["add","edit","view"]),t.jsxs(t.Fragment,{children:[t.jsx(be,{}),t.jsxs(x,{onClose:i,isOpen:!!e.length,children:[s==="add"&&t.jsx(x.Suspense,{children:t.jsx(Ce,{})},"add"),s==="edit"&&t.jsx(x.Suspense,{children:t.jsx(we,{})},"edit"),s==="view"&&t.jsx(x.Suspense,{children:t.jsx(Ee,{})},"view")]})]})},Ve=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{xe as S,ze as a,_e as b,ve as g,Ve as i,Se as t,R as u};
