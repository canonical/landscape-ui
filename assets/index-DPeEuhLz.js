const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BYNEHrDE.js","assets/index-Dfc97QGW.js","assets/index-CBwtg6kZ.css","assets/CheckboxGroup-CQeNevG2.js","assets/CheckboxGroup-Nf21OKoS.css","assets/debug-Cpavud0K.js","assets/useGPGKeys-B-3j3Nj8.js","assets/useFetchOld-BgGVMMmJ.js","assets/debug-CHNhm1j1.css","assets/MultiSelectField-fcXogomg.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-BdOP5SSP.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/UdebCheckboxInput-Ejv3YYgf.js","assets/UdebCheckboxInput-4dvPTSn-.css","assets/formikErrors-Bw8iTXYS.js","assets/constants-BOGKJCKf.js","assets/constants-BTpoIHxf.js","assets/NoData-DMN9LLPq.js","assets/index-S_kjB96R.js","assets/ResponsiveTable-ViIMTRR6.js","assets/ResponsiveTable-Czda4kFo.css","assets/TablePagination-B0v8QAQr.js","assets/TableFilterChips-DXWGZ6VK.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-DZURD2KR.css","assets/PageParamFilter-C5PJgjVf.js","assets/TableFilter-BmLRyeMD.js","assets/TableFilter-B85Stwni.css","assets/index-DzMlcK9Q.css","assets/constants-BnrFFkRy.css"])))=>i.map(i=>d[i]);
import{r as d,j as e,d as i,g as ce,X as de,z as ue,y as me,x as ge,I as L,e as w,$ as fe}from"./index-Dfc97QGW.js";import{S as pe}from"./SidePanelTablePagination-D0fGsgDJ.js";import{f as he}from"./constants-BOGKJCKf.js";import"./TablePagination-B0v8QAQr.js";import"./TableFilterChips-DXWGZ6VK.js";import"./useFetchOld-BgGVMMmJ.js";import"./constants-BTpoIHxf.js";import"./NoData-DMN9LLPq.js";import"./index-S_kjB96R.js";import"./ResponsiveTable-ViIMTRR6.js";import"./PageParamFilter-C5PJgjVf.js";import"./TableFilter-BmLRyeMD.js";import"./formikErrors-Bw8iTXYS.js";const Pe="_version_sfav3_1",ke="_content_sfav3_5",F={version:Pe,content:ke},xe=({isUpload:o,packagesToShow:n,search:s,selectedPackages:l,setSelectedPackages:m})=>{const u=d.useMemo(()=>[{accessor:"packageName",Header:({rows:a})=>o?e.jsxs(e.Fragment,{children:[e.jsx(i.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),disabled:!a.length,indeterminate:!!l.length&&l.length<a.length,checked:l.length===a.length&&!!l.length,onChange:()=>{m(c=>c.length?[]:a.map((g,x)=>x))}}),e.jsx("span",{children:"Package"})]}):"Package",Cell:({row:a})=>o?e.jsx(i.CheckboxInput,{inline:!0,label:a.original.packageName,checked:l.includes(a.index),onChange:()=>{m(c=>c.includes(a.index)?c.filter(g=>g!==a.index):[...c,a.index])}}):a.original.packageName},{accessor:"packageVersion",Header:"Version",getCellIcon:({row:a})=>a.original.difference?"warning":!1,className:F.version,Cell:({row:a})=>a.original.difference?e.jsx(i.Tooltip,{position:"top-center",message:a.original.difference==="delete"?"Package deleted":`Version differs
from parent pocket.
Parent version:
${a.original.newVersion}`,children:e.jsx("span",{children:a.original.packageVersion})}):a.original.packageVersion}],[n,l.length]);return e.jsx(i.ModularTable,{columns:u,data:n,emptyMsg:s?`No packages found with the search: "${s}".`:void 0,className:F.content,getCellProps:({column:a})=>{switch(a.id){case"packageName":return{role:"rowheader"};case"packageVersion":return{"aria-label":"Version"};default:return{}}}})},ye="_ctaRow_qlsck_1",je={ctaRow:ye},be=d.lazy(async()=>fe(()=>import("./index-BYNEHrDE.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]))),k=1,A=20,Me=({distributionName:o,pocket:n,seriesName:s})=>{const[l,m]=d.useState(k),[u,a]=d.useState(A),[c,g]=d.useState([]),{value:x,setTrue:H}=ce(),[b,$]=d.useState(""),[y,v]=d.useState(""),[R,O]=d.useState([]),V=de("(max-width: 619px)"),D=ue(),{setSidePanelContent:U,closeSidePanel:q}=me(),{listPocketQuery:K,diffPullPocketQuery:X,pullPackagesToPocketQuery:G,syncMirrorPocketQuery:J,removePackagesFromPocketQuery:W,removePocketQuery:Y}=he(),{mutate:Z,isPending:B}=J,{mutate:N,isPending:T}=G,ee=()=>{n.mode==="mirror"?Z({name:n.name,series:s,distribution:o}):n.mode==="pull"&&N({name:n.name,series:s,distribution:o})},ne=()=>{U(`Edit ${n.name} pocket`,e.jsx(d.Suspense,{fallback:e.jsx(w,{}),children:e.jsx(be,{pocket:n,distributionName:o,seriesName:s})}))},{mutateAsync:te,isPending:_}=Y,ae=async()=>{try{await te({distribution:o,series:s,name:n.name}),q()}catch(t){D(t)}},{mutateAsync:oe,isPending:j}=W,E=!B&&!T&&!j&&!_,{data:se,isLoading:z}=K({name:n.name,series:s,distribution:o,search:y,limit:u,offset:l*u-u},{enabled:E}),S=se?.data??{count:0,results:[]},f=S.results.map(t=>({packageName:t.name,packageVersion:t.version})),{data:I}=X({name:n.name,series:s,distribution:o},{enabled:n.mode==="pull"&&!z&&E});d.useEffect(()=>{const t=I?.data??{},r=[];for(const p in t){const h={add:[],update:[],delete:[],...t[p]};for(const[P,C]of h.add)r.push({packageName:P,newVersion:C,difference:"add"});(h.update.length||h.delete.length)&&H();for(const[P,,C]of h.update)r.push({packageName:P,newVersion:C,difference:"update"});for(const[P]of h.delete)r.push({packageName:P,difference:"delete",newVersion:""})}O(r)},[I]);const re=()=>x?(f.forEach(t=>{const r=R.find(({packageName:p})=>t.packageName===p);r&&(t.difference=r.difference,r.newVersion!==""&&(t.newVersion=r.newVersion))}),[...f.filter(({difference:t})=>t),...f.filter(({difference:t})=>!t)]):f,M=d.useMemo(()=>re(),[l,u,y,x,f.length,R.length]),ie=async()=>{const t=M.filter((r,p)=>c.includes(p)).map(({packageName:r})=>r);try{await oe({name:n.name,series:s,distribution:o,packages:t})}catch(r){D(r)}},Q=!y&&l===k&&u===A&&!S.count,le=n.mode==="upload"?{size:8,medium:4}:{size:6,medium:3};return e.jsxs(e.Fragment,{children:[e.jsxs(i.Row,{className:L("u-no-padding--left u-no-padding--right",je.ctaRow),children:[e.jsx(i.Col,{...le,children:e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[n.mode!=="upload"&&e.jsx(i.Button,{className:"p-segmented-control__button",type:"button",onClick:ee,disabled:B&&T,"aria-label":n.mode==="mirror"?`Synchronize ${n.name} pocket of ${o}/${s}`:`Pull packages to ${n.name} pocket of ${o}/${s}`,children:n.mode==="mirror"?"Sync":"Pull"}),e.jsx(i.Button,{className:"p-segmented-control__button",type:"button",onClick:ne,"aria-label":`Edit ${n.name} pocket of ${o}/${s}`,children:"Edit"}),e.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button","aria-label":`Remove ${n.name} pocket of ${o}/${s}`,confirmationModalProps:{title:"Deleting pocket",children:e.jsxs("p",{children:["Do you really want to delete ",n.name," pocket from"," ",s," series of ",o," distribution?"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:_,confirmButtonLoading:_,onConfirm:ae},children:"Remove"}),n.mode==="upload"&&e.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:!c.length||j,"aria-label":`Remove selected packages from ${n.name} pocket of ${o}/${s}`,confirmationModalProps:{title:"Deleting packages from pocket",children:e.jsxs("p",{children:["This will delete ",c.length," selected"," ",ge(c.length,"package")," from"," ",n.name," pocket ",s," series of"," ",o," distribution"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:j,confirmButtonLoading:j,onConfirm:ie},children:"Remove packages"})]})})}),n.mode!=="upload"&&!Q&&e.jsx(i.Col,{size:6,medium:3,children:e.jsx(i.Form,{onSubmit:t=>{t.preventDefault(),v(b),m(k)},noValidate:!0,children:e.jsx(i.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,"aria-label":"Package search",onChange:t=>{$(t)},value:b,onClear:()=>{$(""),v(""),m(k)},className:L({"is-dense":!V,"u-no-margin--bottom":V}),onSearch:()=>{v(b),m(k)},autocomplete:"off"})})})]}),z?e.jsx(w,{}):Q?e.jsx("p",{children:"No packages found"}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{isUpload:n.mode==="upload",packagesToShow:M,search:y,selectedPackages:c,setSelectedPackages:g}),e.jsx(pe,{currentPage:l,totalItems:S.count,paginate:t=>{g([]),m(t)},pageSize:u,setPageSize:t=>{a(t)}})]})]})};export{Me as default};
