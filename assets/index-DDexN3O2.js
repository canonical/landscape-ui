import{j as e,r as j,b as P,y,d as l,q as I,x as S,a as N,t as U,k as O,n as v,R as A,o as L}from"./index-bwXOAcKK.js";import{u as R,A as T}from"./AuthTemplate-XcBgqRtk.js";import{r as _,g as w}from"./helpers-DnWe-7sG.js";const k=({methods:s})=>{if(!s)return null;const a=!!(s.standalone_oidc.available&&s.standalone_oidc.enabled),i=!!(s.ubuntu_one.available&&s.ubuntu_one.enabled),r=!!(s.password.available&&s.password.enabled),c=!!(s.pam.available&&s.pam.enabled),u=s.oidc.available?s.oidc.configurations.filter(({enabled:p})=>p):[],n=r||c,m=i||a||s.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[n&&e.jsx(H,{isIdentityAvailable:c}),m&&e.jsx($,{isStandaloneOidcEnabled:a,isUbuntuOneEnabled:i,oidcProviders:u}),!n&&!m&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},B="_list_9u1s7_1",q="_button_9u1s7_20",F="_icon_9u1s7_28",d={list:B,button:q,icon:F},$=({isStandaloneOidcEnabled:s,isUbuntuOneEnabled:a,oidcProviders:i})=>{const[r,c]=j.useState(0),[u]=P(),{invitationId:n}=R(),{getOidcUrlQuery:m,getUbuntuOneUrlQuery:p}=y(),t=u.get("redirect-to"),g=u.has("external"),o={};r>0&&(o.id=r),t&&(o.return_to=t),n&&(o.invitation_id=n),g&&(o.external=!0);const{data:b}=m(o,{enabled:r!==0});j.useEffect(()=>{b&&_(b.data.location)},[b]);const x={};t&&(x.return_to=`${window.origin}${t}`),n&&(x.invitation_id=n),g&&(x.external=!0);const{data:f,refetch:E}=p(x,{enabled:!1});return j.useEffect(()=>{f&&_(f.data.location)},[f]),e.jsxs("ul",{className:d.list,children:[a&&e.jsx("li",{className:"p-list__item",children:e.jsxs(l.Button,{type:"button",hasIcon:!0,onClick:E,className:d.button,children:[e.jsx(l.Icon,{name:w("ubuntu-one"),className:d.icon}),e.jsx("span",{children:"Sign in with Ubuntu One"})]})}),s&&e.jsx("li",{className:"p-list__item",children:e.jsxs(l.Button,{type:"button",hasIcon:!0,onClick:()=>c(-1),className:d.button,children:[e.jsx(l.Icon,{name:w("standalone"),className:d.icon}),e.jsx("span",{children:"Sign in with Enterprise Login"})]})}),i.map(h=>e.jsx("li",{className:"p-list__item",children:e.jsxs(l.Button,{type:"button",hasIcon:!0,onClick:()=>c(h.id),className:d.button,children:[e.jsx(l.Icon,{name:w(h.provider),className:d.icon}),e.jsx("span",{children:`Sign in with ${h.name}`})]})},h.id))]})},Q="_buttonRow_f3s21_1",C={buttonRow:Q},H=({isIdentityAvailable:s})=>{const[a]=P(),i=I(),{signInWithEmailAndPasswordQuery:r}=y(),{setUser:c}=S(),u=N(),n=a.get("redirect-to"),m=a.has("external"),{mutateAsync:p}=r,t=U({initialValues:{email:"",password:""},validationSchema:O().shape({email:s?v().required("This field is required"):v().required("This field is required").email("Please provide a valid email address"),password:v().required("This field is required")}),onSubmit:async g=>{try{const{data:o}=await p({email:g.email,password:g.password});if(m&&n)_(n,{replace:!0});else{"current_account"in o&&c(o);const b=new URL(n??`${A}overview`,location.origin);u(b.toString().replace(b.origin,""),{replace:!0})}}catch(o){i(o)}}});return e.jsxs(l.Form,{onSubmit:t.handleSubmit,children:[e.jsx(l.Input,{type:"text",label:s?"Identity":"Email",error:t.touched.email&&t.errors.email?t.errors.email:void 0,...t.getFieldProps("email"),"data-testid":"email"}),e.jsx(l.PasswordToggle,{id:"password",label:"Password",error:t.touched.password&&t.errors.password?t.errors.password:void 0,...t.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:C.buttonRow,children:e.jsx(l.Button,{type:"submit",appearance:"positive",disabled:t.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},J=()=>{const{getLoginMethodsQuery:s}=y(),{data:a,isLoading:i,isError:r,error:c}=s();return e.jsxs(T,{title:"Sign in to Landscape",children:[i??e.jsx(L,{}),!i&&r&&e.jsxs("div",{children:[e.jsx("h1",{children:"Error"}),e.jsx("pre",{children:JSON.stringify(c,null,2)})]}),!i&&!r&&e.jsx(k,{methods:(a==null?void 0:a.data)??null})]})};export{J as default};
