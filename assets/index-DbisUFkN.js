const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BbL6VS_e.js","assets/index-5gUg1wBm.js","assets/index-D38JayDC.css","assets/usePageParams-D1oM-inl.js","assets/useInstances-Bwh27CFJ.js","assets/useFetchOld-DoJhfK-Q.js","assets/TablePagination-DVMkfoeg.js","assets/TablePaginationBase-ByjrjRdM.js","assets/TablePaginationBase-CJl3HN1X.css","assets/StatusFilter-DkqdYofZ.js","assets/TableFilter-DG6ceyvn.js","assets/TableFilter-DXBG6q86.css","assets/TableFilterChips-DTuS4Wl3.js","assets/TableFilterChips-CHqetGbX.css","assets/NoData-CkszD9V_.js","assets/index-DlELVwax.css"])))=>i.map(i=>d[i]);
import{j as e,E as Y,g as l,m as P,r as d,e as z,b as U,f as V,c as D,d as I,n as j,_ as q,J as G,s as J,h as X,k as Q,o as Z,L as ee,D as te}from"./index-5gUg1wBm.js";import{u as k,m as se}from"./usePageParams-D1oM-inl.js";import{u as ae,T as ie}from"./TablePagination-DVMkfoeg.js";import{S as ne}from"./StatusFilter-DkqdYofZ.js";import{T as re}from"./TableFilterChips-DTuS4Wl3.js";import{u as oe}from"./useFetchOld-DoJhfK-Q.js";import{t as v,T as ce}from"./TableFilter-DG6ceyvn.js";import{N as H}from"./NoData-CkszD9V_.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="0bfb529d-3987-4779-ac25-ecd732e394ef",s._sentryDebugIdIdentifier="sentry-dbid-0bfb529d-3987-4779-ac25-ecd732e394ef")}catch{}const le=()=>e.jsx(Y,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no activities yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage computers in Landscape"})]}),icon:"switcher-environments",title:"No activities found"}),ue="_wrapper_hov5l_1",de="_formContainer_hov5l_7",pe="_helpButton_hov5l_11",F={wrapper:ue,formContainer:de,helpButton:pe},me=({inputValue:s,onDescriptionClick:t,onInputChange:n,onSearchClick:u,onClear:r})=>{const c=o=>{o.preventDefault(),u()};return e.jsxs("div",{className:F.wrapper,children:[e.jsx("div",{className:F.formContainer,children:e.jsx(l.Form,{onSubmit:c,noValidate:!0,children:e.jsx(l.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,className:"u-no-margin--bottom",autocomplete:"off",value:s,onChange:n,onClear:r,onSearch:u})})}),e.jsx(l.Button,{type:"button",appearance:"base",hasIcon:!0,className:P("u-no-margin--bottom",F.helpButton),onClick:t,"aria-label":"Help",children:e.jsx(l.Icon,{name:l.ICONS.help})})]})},he="_term_1p61y_1",ye={term:he},ge=({open:s,onClose:t,data:n})=>{const u=[{Header:"Term",accessor:"term",className:ye.term,Cell:({value:r})=>typeof r=="string"?e.jsx("code",{children:r}):null},{Header:"Description",accessor:"description",Cell:({value:r})=>typeof r=="string"||d.isValidElement(r)?e.jsx("span",{className:"u-text--muted",children:r}):null}];return s&&e.jsxs(l.Modal,{title:"Search help",close:t,children:[e.jsx("p",{children:"Available search terms for use in the search box. If multiple search terms are separated by OR, any of the conditions will match. Otherwise, all conditions must be met for a instance to match. When a term is preceded by NOT, the condition must not match. If the searched value contains spaces or non-ASCII characters, it must be quoted."}),e.jsx(l.ModularTable,{className:"u-no-margin--bottom",columns:d.useMemo(()=>u,[]),data:d.useMemo(()=>n,[])})]})},fe=d.lazy(()=>q(()=>import("./index-BbL6VS_e.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])));function M(){const s=oe(),t=z(),n=U(),{setSidePanelContent:u}=V(),r=(i={},h={})=>I({queryKey:["activities",i],queryFn:()=>t.get("activities",{params:i}),...h}),c=({activityId:i,...h},_={})=>I({queryKey:["activities",{activityId:i,...h}],queryFn:()=>t.get(`activities/${i}`,{params:h}),..._}),o=(i={},h={})=>I({queryKey:["activityTypes"],queryFn:()=>s.get("GetActivityTypes",{params:i}),...h}),x=D({mutationKey:["activities","cancel"],mutationFn:i=>s.get("CancelActivities",{params:i}),onSuccess:()=>n.invalidateQueries({queryKey:["activities"]})}),y=D({mutationKey:["activities","approve"],mutationFn:i=>s.get("ApproveActivities",{params:i}),onSuccess:()=>n.invalidateQueries({queryKey:["activities"]})}),p=D({mutationFn:i=>t.post("activities/reapply",i),onSuccess:()=>n.invalidateQueries({queryKey:["activities"]})}),S=D({mutationFn:i=>t.post("activities/revert",i),onSuccess:()=>n.invalidateQueries({queryKey:["activities"]})});return{getActivitiesQuery:r,getSingleActivityQuery:c,getActivityTypesQuery:o,cancelActivitiesQuery:x,approveActivitiesQuery:y,redoActivitiesQuery:p,undoActivitiesQuery:S,openActivityDetails:i=>{u(i.summary,e.jsx(d.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(fe,{activityId:i.id})}))}}}function be(s){const{state:t}=G(),n=t==null?void 0:t.activity;d.useEffect(()=>{t!=null&&t.activity&&(s(t.activity),window.history.replaceState({},""))},[n])}const xe="_container_1r60q_1",_e="_buttons_1r60q_6",B={container:xe,buttons:_e},ve=()=>{const[s,t]=d.useState(!1),{setPageParams:n,fromDate:u,toDate:r}=k(),c=J({initialValues:{fromDate:u||"",toDate:r||""},enableReinitialize:!0,validationSchema:X().shape({fromDate:Q(),toDate:Q()}),onSubmit:o=>{n({fromDate:o.fromDate,toDate:o.toDate}),t(!1)}});return e.jsx(l.ContextualMenu,{visible:s,autoAdjust:!0,toggleAppearance:"base",toggleLabel:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Date range"}),e.jsx("span",{className:P(v.badgeContainer),children:u||r?e.jsx(l.Badge,{value:u&&r?2:1,className:v.badge}):null})]}),toggleClassName:v.toggle,toggleProps:{onClick:()=>{t(!s)}},hasToggleIcon:!0,dropdownClassName:v.dropdown,position:"left",children:e.jsxs(l.Form,{onSubmit:c.handleSubmit,noValidate:!0,className:B.container,children:[e.jsxs("div",{className:v.container,children:[e.jsx(l.Input,{type:"datetime-local",label:"From",...c.getFieldProps("fromDate")}),e.jsx(l.Input,{type:"datetime-local",label:"To",...c.getFieldProps("toDate")})]}),e.jsxs("div",{className:B.buttons,children:[e.jsx(l.Button,{small:!0,type:"button",appearance:"base",onClick:()=>{t(!1),c.resetForm()},children:"Cancel"}),e.jsx(l.Button,{small:!0,type:"submit",appearance:"positive",children:"Add"})]})]})})},je=({options:s})=>{const[t,n]=d.useState(""),{setPageParams:u,type:r}=k(),c=s.filter(o=>o.label.toLowerCase().includes(t.toLowerCase()));return ae("type",c.map(o=>o.value)),e.jsx(ce,{multiple:!1,label:"Type",hasToggleIcon:!0,hasBadge:!0,onSearch:o=>n(o),options:c,onItemSelect:o=>u({type:o}),selectedItem:r})},Se="_top_t0kqp_1",Ce="_sticky_t0kqp_8",Te="_filters_t0kqp_14",N={top:Se,sticky:Ce,filters:Te},Ae="_iconError_xphpu_1",De="_iconWarning_xphpu_5",ke="_iconWarningRed_xphpu_9",w={iconError:Ae,iconWarning:De,iconWarningRed:ke},E={succeeded:{icon:"success",label:"Succeeded"},scheduled:{icon:"spinner",label:"Scheduled"},waiting:{icon:"status-waiting",label:"Waiting"},undelivered:{icon:"status-queued",label:"Queued"},delivered:{icon:"status-in-progress",label:"In progress"},blocked:{icon:`warning-grey ${w.iconWarningRed}`,label:"Blocked"},unapproved:{icon:`warning-grey ${w.iconWarning}`,label:"Unapproved"},canceled:{icon:"error-grey",label:"Cancelled"},failed:{icon:`error-grey ${w.iconError}`,label:"Failed"}},Ie=[{term:"id:<activity_id>",description:"Search for activities with a specific ID."},{term:"parent-id:<parent_id>",description:"Search for children activities of a specific ID."},{term:"created-after:<date>",description:e.jsxs("span",{children:["Search for activities created after a specific date or time, specified with the ISO-8601 format. The precision depends on how far you specify, for example ",e.jsx("code",{children:"2011-01"}),", ",e.jsx("code",{children:"2011-01-01"}),","," ",e.jsx("code",{children:"2011-01-01T10:30"})," are valid values."]})},{term:"created-before:<date>",description:"Search for activities created before a specific date or time. The format is the same as created-after."},{term:"creator:<email>",description:"Search for activities created by a particular person (specified by email address)."},{term:"computer:<criteria>",description:"Search for activities related to the given instances. The criteria is itself another query argument to search instances. See Instance Queries for details."},{term:"type:<type>",description:"Search for activities of a specific type."}],L=[{label:"All",value:""},...Object.entries(E).filter(([s])=>s!=="unapproved").map(([s,{label:t}])=>({label:t,value:s}))],Fe=({resetSelectedIds:s})=>{const{query:t,setPageParams:n}=k(),{instanceId:u}=Z(),{getActivityTypesQuery:r}=M(),[c,o]=d.useState(""),[x,y]=d.useState(!1),{data:p}=r(),C=((p==null?void 0:p.data)??[]).map(g=>({label:g,value:g})),i=[{label:"All",value:""},...C],h=!!u,_=()=>{c&&(n({query:t?`${t},${c}`:`${c}`}),o(""),s())},b=()=>{n({query:""})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:P(N.top,{[N.sticky]:!h}),children:[e.jsx(me,{inputValue:c,onInputChange:g=>{o(g)},onSearchClick:_,onDescriptionClick:()=>y(!0),onClear:b}),e.jsxs("div",{className:N.filters,children:[e.jsx(ne,{options:L}),e.jsx(je,{options:i}),e.jsx(ve,{})]})]}),e.jsx(ge,{open:x,data:Ie,onClose:()=>y(!1)}),e.jsx(re,{filtersToDisplay:["status","type","fromDate","toDate","query"],statusOptions:L,typeOptions:i})]})},Ne="_checkbox_19yw3_1",we="_description_19yw3_5",$e="_link_19yw3_9",$={checkbox:Ne,description:we,link:$e},Ee=(s,t)=>s&&t?` created-after:${s} created-before:${t}`:s?` created-after:${s}`:t?` created-before:${t}`:"",Pe=s=>s?` type:${s}`:"",qe=s=>s?` status:${s}`:"",Oe=d.lazy(()=>q(()=>import("./index-BbL6VS_e.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),Ye=({instanceId:s,selectedIds:t,setSelectedIds:n})=>{const{search:u,status:r,fromDate:c,toDate:o,type:x,currentPage:y,pageSize:p}=k(),{setSidePanelContent:S}=V(),{getActivitiesQuery:C}=M(),i=Ee(c,o),h=Pe(x),_=qe(r),b=`${u}${_}${i}${h}`,g=a=>{S(a.summary,e.jsx(d.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(Oe,{activityId:a.id})}))};be(g);const O=()=>{n([])},{data:m,isPending:T}=C({query:`${s?`computer:id:${s}`:""} ${b??""}`.trim(),limit:p,offset:(y-1)*p}),f=d.useMemo(()=>(m==null?void 0:m.data.results)??[],[m]),R=()=>{n(t.length!==0?[]:f.map(({id:a})=>a))},W=a=>{n(t.includes(a)?t.filter(A=>A!==a):[...t,a])},K=d.useMemo(()=>[{accessor:"checkbox",className:$.checkbox,Header:e.jsx(l.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:R,checked:f.length>0&&t.length===f.length,indeterminate:t.length>0&&t.length<f.length}),Cell:({row:a})=>e.jsx(l.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:a.original.summary}),inline:!0,labelClassName:"u-no-margin--bottom u-no-padding--top",checked:t.includes(a.original.id),onChange:()=>{W(a.original.id)}})},{accessor:"summary",className:$.description,Header:"Description",Cell:({row:a})=>e.jsx(l.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>g(a.original),children:a.original.summary})},{accessor:"activity_status",Header:"Status",Cell:({row:{original:{activity_status:a}}})=>E[a].label,getCellIcon:({row:{original:{activity_status:a}}})=>E[a].icon},{accessor:"computer_id",Header:"Instance",Cell:({row:a})=>a.original.computer_id?e.jsxs(ee,{className:$.link,to:`/instances/${a.original.computer_id}`,children:["ID: ",a.original.computer_id]}):e.jsx(H,{})},{accessor:"creation_time",Header:"Created at",Cell:({row:a})=>e.jsx(e.Fragment,{children:se(a.original.creation_time).format(te)})},{accessor:"creator.name",Header:"Creator",Cell:({row:a})=>{var A;return e.jsx(e.Fragment,{children:((A=a.original.creator)==null?void 0:A.name)??e.jsx(H,{})})}}].filter(a=>!s||a.accessor!=="computer_id"),[f,t]);return e.jsxs(e.Fragment,{children:[!b&&y===1&&p===20&&T&&e.jsx(j,{}),!b&&y===1&&p===20&&!T&&(!m||!m.data.count)&&e.jsx(le,{}),(!!b||y!==1||p!==20||!T&&m&&m.data.count>0)&&e.jsxs(e.Fragment,{children:[e.jsx(Fe,{resetSelectedIds:O}),T?e.jsx(j,{}):e.jsx(l.ModularTable,{emptyMsg:"No activities found according to your search parameters.",columns:K,data:f}),e.jsx(ie,{totalItems:m==null?void 0:m.data.count,currentItemCount:f.length,handleClearSelection:O})]})]})},Qe=d.lazy(()=>q(()=>import("./index-BbL6VS_e.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),ze=s=>e.jsx(d.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(Qe,{...s})});export{Ye as A,ge as S,E as a,ze as b,M as u};
