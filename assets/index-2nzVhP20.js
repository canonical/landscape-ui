import{i as y,h as B,r as g,y as j,j as o,m as c,I as v,v as E,D as A,o as L}from"./index-Q7_P6QJX.js";import{S as w}from"./SidePanelFormButtons-BqhcAbDz.js";import{u as D}from"./useEditScript-k0KrgCNl.js";import{g as F}from"./ScriptsTabs-C1EuQqAm.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./TruncatedCell-BL6AAKSM.js";import"./useRoles-D5p8Vk3F.js";import"./HeaderWithSearch-Cgywy_FA.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./index-4HglPIt4.js";const M=({scriptId:s,versionId:e})=>{const a=y(),{data:n,isPending:r}=B({queryKey:["scripts","version",s,e],queryFn:async()=>a.get(`scripts/${s}/versions/${e}`)});return{version:(n==null?void 0:n.data)??null,isVersionLoading:r}},V=({scriptId:s,scriptVersion:e,goBack:a,isArchived:n})=>{const[r,i]=g.useState(!1),p=j(),{version:t,isVersionLoading:f}=M({scriptId:s,versionId:e.version_number}),{editScript:b,isEditing:m}=D(),h=()=>{i(!0)},S=()=>{i(!1)},l=`#!${t==null?void 0:t.interpreter}
`+(t==null?void 0:t.code),d=async()=>{try{if(t){const u={code:l,title:t.title},x=F({scriptId:s,values:u});await b(x),a()}}catch(u){i(!1),p(u)}};return o.jsxs(c.Form,{noValidate:!0,onSubmit:d,children:[o.jsx(v,{label:"author",value:`${E(e.created_at).format(A)}, by ${e.created_by.name}`}),f?o.jsx(L,{}):o.jsx(c.CodeSnippet,{blocks:[{title:"Code",code:l||"",wrapLines:!0,appearance:"numbered"}]}),o.jsx(w,{hasActionButtons:!n,submitButtonAppearance:"secondary",submitButtonText:"Use as new version",onSubmit:h,hasBackButton:!0,onBackButtonPress:a}),r&&o.jsx(c.ConfirmationModal,{title:`Submit new version of ${e.title}`,confirmButtonLabel:"Submit new version",close:S,confirmButtonAppearance:"positive",confirmButtonLoading:m,confirmButtonDisabled:m,onConfirm:d,confirmButtonProps:{type:"button"},children:o.jsx("p",{children:"All future script runs will be done using the latest version of the code."})})]})};export{V as default};
