import{r as i,z as se,j as e,h as v,g as s,p as q,e as G,H as ae,_ as J,a as oe,l as ie,f as re,R as Q}from"./index-CXO_SLS5.js";import{a as X,u as le}from"./useOnClickOutside-B5i2zq8r.js";import{u as k}from"./useInstances-CBTSHyOK.js";import{a as ee,c as ce,d as de}from"./index.esm-BRQBYM2-.js";import{I as ue}from"./InfoItem-DJk_Xuh8.js";import{u as me}from"./WslInstanceList.module-BgnoD6-o.js";import{u as pe}from"./useConfirm-XfcZmvpj.js";import{u as he}from"./useRoles-DFiUqoMz.js";import{u as fe}from"./formik.esm-DTVLILnf.js";import{h as W}from"./moment-Cl4UOzQZ.js";import{m as U}from"./moment-CTEd5BzW.js";import"./useFetchOld-Dm5_rkO6.js";import"./useMutation-CHFXrkAs.js";import"./useQuery-vszun8vi.js";import"./InfoItem.module-BZ3tYMsb.js";import"./EmptyState-DEGoTzO1.js";const _e=typeof window>"u";function ge(t={}){let{initializeWithValue:n=!0}=t;_e&&(n=!1);const[r,l]=i.useState(()=>{if(n)return{width:window.innerWidth,height:window.innerHeight}}),c=()=>{l({width:window.innerWidth,height:window.innerHeight})};return X("resize",c),se(()=>{c()},[]),r}const xe="_infoContainer_1ca11_1",be="_amount_1ca11_9",Z={infoContainer:xe,amount:be},je=({isExpanded:t,overflowingChipsAmount:n})=>n>0&&!t&&e.jsx("div",{className:Z.infoContainer,children:e.jsx("span",{className:v("u-text--muted",Z.amount),children:`+${n}`})}),ve=({containerRef:t,onDismiss:n,onOverflowingItemsAmountChange:r,tagData:l})=>{const c=()=>{if(!t.current)return;const o=t.current.querySelectorAll("span.p-chip");r(Array.from(o).filter(({offsetHeight:p,offsetTop:m})=>m>p).length)};return X("resize",c),i.useEffect(()=>{c()},[l.length]),l.map(o=>e.jsx(s.Chip,{value:o,onDismiss:()=>n(o)},o))},we="_container_1f6mu_1",Ie="_list_1f6mu_6",ye="_listItem_1f6mu_11",Ce="_search_1f6mu_17",E={container:we,list:Ie,listItem:ye,search:Ce},Se=({onTagClick:t,tags:n})=>n.length?e.jsxs("div",{className:E.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Tags"}),e.jsx("ul",{className:v("p-list--divided u-no-margin--bottom",E.list),children:n.map(r=>e.jsx("li",{children:e.jsx("div",{className:E.listItem,children:e.jsx(s.Button,{appearance:"base",className:E.search,onClick:()=>t(r),children:r})})},r))})]}):null,Ne="_container_fqj7b_1",Re="_prompt_fqj7b_10",Te="_saveButton_fqj7b_17",V={container:Ne,prompt:Re,saveButton:Te},Ae=({onTagAdd:t,search:n})=>e.jsx(e.Fragment,{children:n&&e.jsxs("div",{className:V.container,children:[e.jsxs("span",{className:V.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:n}),e.jsx("span",{children:"..."})]}),e.jsx(s.Button,{type:"button",appearance:"link",onClick:t,className:V.saveButton,children:"Add tag"})]})}),Y=ee().matches(/^[a-zA-Z]/,{message:"Tag must starts with a letter",excludeEmptyString:!0}).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,{message:"Tag can only contain letters, numbers, hyphens, and underscores",excludeEmptyString:!0}),Ee="_searchContainer_pn88d_1",De="_box_pn88d_5",ke="_inputContainer_pn88d_10",Le="_inputError_pn88d_15",D={searchContainer:Ee,box:De,inputContainer:ke,inputError:Le},ze=({onTagsChange:t,tags:n,label:r,labelClassName:l,required:c})=>{var M;const[o,p]=i.useState(""),[m,f]=i.useState(""),[d,x]=i.useState(!1),[b,C]=i.useState(""),[g,w]=i.useState(!1),[L,z]=i.useState(0),{height:I}=ge(),[B,S]=i.useState({top:"100%",bottom:"auto"}),{getAllInstanceTagsQuery:$}=k(),N=i.useRef(null),h=i.useRef(null);i.useEffect(()=>{if(!h.current)return;const a=h.current.querySelector("input");a&&C(a.id)},[h.current]),i.useEffect(()=>{!g||!h.current||O()},[I,g,h.current,(M=h.current)==null?void 0:M.clientHeight]);const O=()=>{if(!h.current)return;const{top:a,height:_}=h.current.getBoundingClientRect();a+_+379<I?S({top:"100%",bottom:"auto"}):S({top:"auto",bottom:"100%"})},R=()=>{w(!1)};le(N,R);const P=a=>{t(n.filter(_=>_!==a))},{data:y,isLoading:T}=$(),u=i.useMemo(()=>y?!o&&!n.length?y.data.results:y.data.results.filter(a=>!n.includes(a)).filter(a=>a.toLowerCase().includes(o.trim().toLowerCase())):[],[y,o,n]),A=a=>{t([...n,a])},H=()=>{if(o.trim())try{const a=Y.validateSync(o.trim())??"";A(a),p(""),f(""),x(!1)}catch(a){a instanceof Error&&(f(a.message),x(!0))}},te=a=>{if(p(a.target.value),d)try{Y.validateSync(a.target.value),f("")}catch(_){_ instanceof Error&&f(_.message)}},ne=a=>{const{key:_}=a;g?(_==="Escape"&&R(),_==="Enter"&&H()):_==="Enter"&&w(!0)};return e.jsxs("div",{children:[e.jsx("label",{className:v("p-form__label",{"is-required":c},l),htmlFor:b,children:r||"Tags"}),e.jsxs("div",{className:"p-search-and-filter",ref:N,children:[e.jsxs("div",{className:v("p-search-and-filter__search-container",D.searchContainer),"aria-expanded":g,ref:h,onClick:()=>w(!0),children:[e.jsx(ve,{containerRef:h,onDismiss:P,onOverflowingItemsAmountChange:a=>z(a),tagData:n}),e.jsx("div",{className:v("p-search-and-filter__box",D.box),children:e.jsx("div",{className:D.inputContainer,children:e.jsx(s.Input,{type:"text",autoComplete:"off",value:o,onChange:te,placeholder:"Add tags",className:"u-no-margin--bottom",onClick:()=>w(!0),onKeyUp:ne,wrapperClassName:m?"is-error":"","aria-errormessage":m?`${b}-error`:void 0,"aria-invalid":!!m})})}),m&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:v("p-form-validation__message",D.inputError),id:`${b}-error`,children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:m})]})}),e.jsx(je,{isExpanded:g,overflowingChipsAmount:L})]}),g&&T&&e.jsx(q,{}),g&&!T&&e.jsxs("div",{className:"p-search-and-filter__panel",style:B,children:[e.jsx(Ae,{onTagAdd:H,search:o}),e.jsx(Se,{onTagClick:A,tags:u})]})]})]})},Be={deliver_after:"",deliverImmediately:!0},$e=ce().shape({deliver_after:ee().when("deliverImmediately",{is:!1,then:t=>t.required("This field is required").test({message:"Invalid date",test:n=>W(n).isValid()}).test({message:"Date must be in the future",test:n=>W(n).isAfter()})}),deliverImmediately:de()}),F={shutdown:{ctaLabel:"Shutdown",getDescription:t=>`This will shut down "${t}" instance.`,title:"Shut down instance"},reboot:{ctaLabel:"Restart",getDescription:t=>`This will restart "${t}" instance.`,title:"Restart instance"}},Oe="_wrapper_30z1x_1",Pe="_input_30z1x_5",K={wrapper:Oe,input:Pe},Ve=({action:t,instance:n,onClose:r})=>{const l=G(),{rebootInstancesQuery:c,shutdownInstancesQuery:o}=k(),{mutateAsync:p}=c,{mutateAsync:m}=o,d=fe({initialValues:Be,onSubmit:async x=>{const b={computer_ids:[n.id],deliver_after:x.deliverImmediately?void 0:`${x.deliver_after}:00Z`};try{t==="reboot"?await p(b):await m(b)}catch(C){l(C)}finally{r()}},validationSchema:$e});return e.jsx(s.Form,{onSubmit:d.handleSubmit,noValidate:!0,children:e.jsx(s.Modal,{title:F[t].title,close:r,buttonRow:e.jsx(s.Button,{type:"submit",appearance:"negative",disabled:d.isSubmitting,children:F[t].ctaLabel}),children:e.jsxs("div",{className:K.wrapper,children:[e.jsx(s.CheckboxInput,{label:"Deliver as soon as possible",...d.getFieldProps("deliverImmediately"),checked:d.values.deliverImmediately}),e.jsx(s.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:K.input,placeholder:"Scheduled time",...d.getFieldProps("deliver_after"),disabled:d.values.deliverImmediately,error:d.touched.deliver_after&&d.errors.deliver_after?d.errors.deliver_after:void 0}),e.jsx("p",{children:F[t].getDescription(n.title)})]})})})},Fe=(t,n)=>{var r,l,c;return[{label:"Last ping time",value:t.last_ping_time&&U(t.last_ping_time).isValid()?U(t.last_ping_time).format(ae):"---"},{label:"Hostname",value:t.hostname},{label:"instance ID",value:t.id},{label:"Serial number",value:((r=t.grouped_hardware)==null?void 0:r.system.serial)??"---"},{label:"Product identifier",value:((l=t.grouped_hardware)==null?void 0:l.system.model)??"---"},{label:"Distribution",value:t.distribution??"Unknown"},{label:"Access group",value:((c=n.find(({value:o})=>o===t.access_group))==null?void 0:c.label)||t.access_group},{label:"Annotations",value:t.annotations?Object.entries(t.annotations).map(([o,p],m,f)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:`${o}: ${p}`}),m<f.length-1&&e.jsx("br",{})]})):"---"},{label:"Comment",value:t.comment||"---"}]},qe="_titleRow_fznp8_1",He="_flexContainer_fznp8_6",Me="_italic_fznp8_11",Qe="_infoRow_fznp8_15",We="_tagSection_fznp8_20",Ue="_tagsRow_fznp8_25",Ze="_tagsButton_fznp8_33",j={titleRow:qe,flexContainer:He,italic:Me,infoRow:Qe,tagSection:We,tagsRow:Ue,tagsButton:Ze},Ye=i.lazy(()=>J(()=>import("./index-rGdJYz_x.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),Ke=i.lazy(()=>J(()=>import("./index-BRGDM-dV.js").then(t=>t.i),__vite__mapDeps([13,1,2,14,15,16,17,3,8,5,6,7,12,9,10,11,18,19,20]))),Ge=({instance:t})=>{const[n,r]=i.useState(null),[l,c]=i.useState(t.tags),o=oe(),p=G(),{notify:m}=ie(),{confirmModal:f,closeConfirmModal:d}=pe(),{setSidePanelContent:x}=re(),{removeInstancesQuery:b}=k(),{getAccessGroupQuery:C}=he(),{deleteChildInstancesQuery:g}=me(),{editInstanceQuery:w}=k(),{mutateAsync:L}=w,z=async()=>{try{await L({instanceId:t.id,tags:l}),m.success({title:"Tags updated",message:`"${t.title}" instance tags have been updated successfully`})}catch(u){p(u)}},{data:I}=C(),B=(I==null?void 0:I.data.map(({name:u,title:A})=>({label:A,value:u})))??[],{mutateAsync:S,isLoading:$}=b,N=async()=>{try{await S({computer_ids:[t.id]}),o(`${Q}instances`,{replace:!0})}catch(u){p(u)}finally{d()}},h=()=>{f({title:"Remove instance from Landscape",body:e.jsxs("p",{children:["This will remove the instance ",e.jsx("b",{children:t.title})," from Landscape.",e.jsx("br",{}),e.jsx("br",{}),"It will remain on the parent machine. You can re-register it to Landscape at any time."]}),buttons:[e.jsx(s.Button,{appearance:"negative",onClick:N,children:"Remove"},"remove")]})},O=()=>{x("Edit Instance",e.jsx(i.Suspense,{fallback:e.jsx(q,{}),children:e.jsx(Ye,{instance:t})}))},R=()=>{x("Run script",e.jsx(i.Suspense,{fallback:e.jsx(q,{}),children:e.jsx(Ke,{query:`id:${t.id}`})}))},{mutateAsync:P}=g,y=async()=>{try{await P({computer_ids:[t.id]}),o(`${Q}instances`,{replace:!0})}catch(u){p(u)}finally{d()}},T=async()=>{f({title:"Delete instance",body:e.jsxs("p",{children:["This will permanently delete the instance ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),buttons:[e.jsx(s.Button,{appearance:"negative",onClick:y,children:"Delete"},"delete")]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:j.titleRow,children:[e.jsxs("div",{className:j.flexContainer,children:[e.jsx("p",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:t.title}),t.is_wsl_instance&&e.jsx("p",{className:v("u-text--muted u-no-margin--bottom",j.italic),children:"WSL Instance"})]}),e.jsxs("div",{className:j.flexContainer,children:[t.is_wsl_instance&&e.jsx(s.Button,{type:"button",className:"u-no-margin--bottom u-no-margin--right",onClick:T,children:"Delete instance"}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:O,children:[e.jsx(s.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:R,children:[e.jsx(s.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]}),e.jsxs(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:h,disabled:$,children:[e.jsx(s.Icon,{name:"delete"}),e.jsx("span",{children:"Remove from Landscape"})]}),e.jsxs(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:()=>r("reboot"),children:[e.jsx(s.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]}),e.jsxs(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:()=>r("shutdown"),children:[e.jsx(s.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]})]})},"buttons")]})]}),e.jsx("div",{className:j.infoRow,children:e.jsx(s.Row,{className:"u-no-padding--left u-no-padding--right u-no-max-width",children:Fe(t,B).map(u=>e.jsx(s.Col,{size:4,children:e.jsx(ue,{...u})},u.label))})}),e.jsx("div",{className:j.tagSection,children:e.jsxs(s.Row,{className:j.tagsRow,children:[e.jsx(s.Col,{size:4,children:e.jsx(ze,{labelClassName:"p-text--small p-text--small-caps u-text--muted",onTagsChange:u=>c(u),tags:l})}),e.jsx(s.Col,{size:2,className:j.tagsButton,children:e.jsx(s.Button,{type:"button",className:"u-no-margin--bottom",onClick:z,children:"Update"})})]})}),n&&e.jsx(Ve,{action:n,instance:t,onClose:()=>r(null)})]})},ft=Ge;export{ft as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-rGdJYz_x.js","assets/index-CXO_SLS5.js","assets/index-BAlneFez.css","assets/formik.esm-DTVLILnf.js","assets/useInstances-CBTSHyOK.js","assets/useFetchOld-Dm5_rkO6.js","assets/useMutation-CHFXrkAs.js","assets/useQuery-vszun8vi.js","assets/index.esm-BRQBYM2-.js","assets/SidePanelFormButtons-B2XUHq3s.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/useRoles-DFiUqoMz.js","assets/index-BRGDM-dV.js","assets/index-BHIhRLbz.js","assets/useConfirm-XfcZmvpj.js","assets/EmptyState-DEGoTzO1.js","assets/EmptyState-BNXajmMK.css","assets/index-CRBxSwZU.css","assets/moment-Cl4UOzQZ.js","assets/index-DBZN6KOy.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
