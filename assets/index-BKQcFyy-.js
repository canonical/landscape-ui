import{j as a,d as l,aB as P,r as g,Y as F,R as t,ah as x,G as n,aC as A,L as v,a as H,u as B,a2 as I,a3 as L,W as E,y as M,x as q,g as G,aD as V,aE as W,N as Q,P as K,aF as Y,e as z}from"./index-CNSDWj8Q.js";import{A as Z}from"./SidePanel-ChyjtMJv.js";import{b as J}from"./useGetOverLimitSecurityProfiles-DLUV4TNq.js";import"./InstancesPageActions-DL7_pmR1.js";import"./index-CySvbr4l.js";import"./InfoGrid-3w5mqARw.js";import"./constants-D4uyI-eK.js";import"./helpers-kPKhnyjI.js";import"./Blocks-yjg-J-3E.js";import"./index-D-YBZSy_.js";import{I as X}from"./InfoItem-Bt7JBIPo.js";import{u as aa}from"./useAuthAccounts-C8JMlYtK.js";import"./useFetchOld-BAAs34Op.js";import"./ListTitle-BUruUKn1.js";import"./NoData-6ZK9sV5u.js";import"./ResponsiveTable-BXalKviy.js";import"./StaticLink-BEYCGcPv.js";import"./TruncatedCell-BMum6DLZ.js";import"./Truncated-Dtg97i8C.js";import"./useExpandableRow-B4jhRgod.js";import"./TextConfirmationModal-q88mH05g.js";import"./TablePagination-CFXNvqsZ.js";import"./TableFilterChips-06YfpJdc.js";import"./PageParamFilter-ChSwlZqZ.js";import"./TableFilter-2AKF5NjJ.js";import"./formikErrors-Bw8iTXYS.js";const ea=({hideBanner:e})=>a.jsxs(l.Modal,{close:e,title:"Landscape web portal (Preview)",buttonRow:a.jsx(l.Button,{appearance:"positive",className:"u-no-margin--bottom",onClick:e,children:"Got it!"}),children:[a.jsx("p",{children:"Welcome to the new Landscape web portal (Preview)!"}),a.jsx("p",{children:"This portal is still a work-in-progress. Some features may not be available yet and you may encounter some bugs."}),a.jsxs("p",{children:["You can switch back to the classic portal at any time and"," ",a.jsx("a",{href:P,target:"_blank",rel:"noopener noreferrer",children:"share your feedback with us on Discourse"}),"."]})]}),sa=()=>{const[e,s]=g.useState(!1),i=()=>{s(!1),localStorage.setItem("_landscape_isWelcomePopupClosed","true")};return g.useEffect(()=>{const o=localStorage.getItem("_landscape_isWelcomePopupClosed");s(!o)},[]),e?a.jsx(ea,{hideBanner:i}):null},na="_wrapper_1tquv_1",ta="_secondaryNavigation_1tquv_5",ia="_pageContent_1tquv_9",w={wrapper:na,secondaryNavigation:ta,pageContent:ia},oa=()=>{const{isDarkMode:e,set:s}=F();return a.jsx(l.Switch,{id:"dark-mode-switch",checked:e,onChange:()=>{s(!e)},label:"Dark mode"})},la="_secondaryNavigation_1ag2x_1",ra="_secondaryNavigation__drawer_1ag2x_18",ca="_secondaryNavigation__title_1ag2x_25",da="_secondaryNavigation__link_1ag2x_30",pa="_secondaryNavigation__label_1ag2x_34",ga="_isActive_1ag2x_38",ha="_footer_1ag2x_42",m={secondaryNavigation:la,secondaryNavigation__drawer:ra,secondaryNavigation__title:ca,secondaryNavigation__link:da,secondaryNavigation__label:pa,isActive:ga,footer:ha},C={label:"Account settings",path:t.account.root(),items:[{label:"General",path:t.account.general()},{label:"Alerts",path:t.account.alerts()},{label:"API credentials",path:t.account.apiCredentials()}]},_a=()=>{const e=x();return a.jsxs("div",{className:n("p-side-navigation p-panel is-dark",m.secondaryNavigation),children:[a.jsxs("nav",{className:n("u-padding-top--medium is-dark",m.secondaryNavigation__drawer),"aria-labelledby":"secondary-navigation-title",children:[a.jsx("h2",{className:n("p-heading--4 p-panel__logo-name is-dark u-no-padding--top",m.secondaryNavigation__title),id:"secondary-navigation-title",children:C.label}),a.jsx("ul",{className:"p-side-navigation__list",children:C.items?.map(s=>{const i=A(s.path,e.pathname);return a.jsx("li",{children:a.jsx(v,{"aria-current":i?"page":void 0,className:n("p-side-navigation__link",m.secondaryNavigation__link,{[m.isActive]:i}),to:s.path,children:a.jsx("span",{className:m.secondaryNavigation__label,children:s.label})})},s.path)})})]}),a.jsx("div",{className:m.footer,children:a.jsx(oa,{})})]})},ua="_label_vjkqv_1",ma="_badge_vjkqv_5",va="_hasBadge_vjkqv_9",xa="_link_vjkqv_16",ba="_accordionButton_vjkqv_29",ja="_icon_vjkqv_53",Na="_hasDivider_vjkqv_58",d={label:ua,badge:ma,hasBadge:va,link:xa,accordionButton:ba,icon:ja,hasDivider:Na},T=({item:e})=>a.jsxs("a",{className:n("p-side-navigation__link",d.link),href:e.path,target:"_blank",rel:"nofollow noopener noreferrer",children:[e.icon&&a.jsx("i",{className:n(`p-icon--${e.icon} is-light p-side-navigation__icon`,d.icon)}),a.jsx("span",{className:n("p-side-navigation__label",d.label),children:e.label})]}),O=({item:e,current:s})=>a.jsxs(v,{className:n("p-side-navigation__link",d.link),to:e.path,"aria-current":s?"page":void 0,children:[e.icon&&a.jsx("i",{className:n(`p-icon--${e.icon} is-light p-side-navigation__icon`,d.icon)}),a.jsxs("span",{className:n("p-side-navigation__label",d.label,{[d.hasBadge]:e.badge!==void 0&&e.badge.count>0}),children:[e.label,e.badge!==void 0&&e.badge.count>0&&a.jsx("div",{className:d.badge,children:a.jsx(l.Badge,{value:e.badge.count,isNegative:e.badge.isNegative})})]})]}),fa=[{label:"Repository profiles",path:t.profiles.repository()},{label:"Package profiles",path:t.profiles.package()},{label:"Upgrade profiles",path:t.profiles.upgrade()},{label:"Reboot profiles",path:t.profiles.reboot()},{label:"Removal profiles",path:t.profiles.removal()},{label:"WSL profiles",path:t.profiles.wsl(),requiresFeature:"wsl-child-instance-profiles"},{label:"Security profiles",path:t.profiles.security(),requiresFeature:"usg-profiles"}],ka=[{label:"Mirrors",path:t.repositories.mirrors(),env:"selfHosted"},{label:"GPG Keys",path:t.repositories.gpgKeys()},{label:"APT Sources",path:t.repositories.aptSources()}],ya=[{label:"General",path:t.settings.general()},{label:"Administrators",path:t.settings.administrators()},{label:"Employees",path:t.settings.employees(),requiresFeature:"employee-management"},{label:"Roles",path:t.settings.roles()},{label:"Access groups",path:t.settings.accessGroups()},{label:"Identity providers",path:t.settings.identityProviders(),requiresFeature:"oidc-configuration"}],$=[{label:"Overview",path:t.overview.root(),icon:"switcher-dashboard"},{label:"Instances",path:t.instances.root(),icon:"machines"},{label:"Activities",path:t.activities.root(),icon:"switcher-environments"},{label:"Scripts",path:t.scripts.root(),icon:"code"},{label:"Events log",path:t.eventsLog.root(),icon:"status"},{label:"Profiles",path:t.profiles.root(),icon:"cluster",items:fa},{label:"Repositories",path:t.repositories.root(),icon:"fork",items:ka},{label:"Org. settings",path:t.settings.root(),icon:"settings",items:ya},{label:"Documentation",path:t.external.documentation(),hasDivider:!0},{label:"Support",path:t.external.support()}],D=({isSaas:e,isSelfHosted:s,items:i})=>i.filter(({env:o})=>!e&&o!=="saas"||!s&&o!=="selfHosted").map(o=>o.items?{...o,items:D({items:o.items,isSaas:e,isSelfHosted:s})}:o),R=({isFeatureEnabled:e,items:s})=>s.filter(({requiresFeature:i})=>!i||e(i)).map(i=>i.items?{...i,items:R({items:i.items,isFeatureEnabled:e})}:i),wa=e=>$.filter(({items:s})=>s&&s.length>0).find(({path:s})=>e.startsWith(s))?.path,Sa=({item:e,expanded:s,onClick:i})=>a.jsxs(l.Button,{className:n("p-side-navigation__accordion-button",d.accordionButton),type:"button","aria-expanded":s===e.path,onClick:i,children:[e.icon&&a.jsx("i",{className:n(`p-icon--${e.icon} is-light p-side-navigation__icon`,d.icon)}),a.jsx("span",{className:n("p-side-navigation__label",d.label),children:e.label})]}),Ia=({item:e})=>{const[s,i]=g.useState(""),{pathname:o}=x();return g.useEffect(()=>{const r=wa(o);r&&i(r)},[o]),a.jsxs(a.Fragment,{children:[a.jsx(Sa,{item:e,expanded:s,onClick:()=>{i(s===e.path?"":e.path)}}),e.items&&e.items.length>0&&a.jsx("ul",{className:"p-side-navigation__list","aria-expanded":s===e.path,children:e.items.map(r=>a.jsx("li",{children:r.path.startsWith("http")?a.jsx(T,{item:r}):a.jsx(O,{item:r,current:o===r.path})},r.path))})]})},Ca=({item:e})=>{const{pathname:s}=x();return a.jsx("li",{className:n("p-side-navigation__item",{[d.hasDivider]:e.hasDivider}),children:e.items&&e.items.length>0?a.jsx(Ia,{item:e}):a.jsx(a.Fragment,{children:e.path.startsWith("http")?a.jsx(T,{item:e}):a.jsx(O,{item:e,current:s===e.path})})},e.path)},Ea=20;function Pa(){const{isSaas:e,isSelfHosted:s}=H(),{isFeatureEnabled:i}=B(),{hasOverLimitSecurityProfiles:o,overLimitSecurityProfilesCount:r}=J({limit:Ea,offset:0},{enabled:i("usg-profiles")});return g.useMemo(()=>{const b=D({isSaas:e,isSelfHosted:s,items:$});return R({isFeatureEnabled:i,items:b}).map(h=>!o||h.label!=="Profiles"?h:{...h,items:h.items?.map(u=>u.label==="Security profiles"?{...u,badge:{count:r,isNegative:!0}}:u)})},[e,s,i,o])}const Aa=()=>{const e=Pa();return a.jsx("div",{className:"p-side-navigation--icons is-dark",children:a.jsx("nav",{"aria-label":"Main",children:a.jsx("ul",{className:"u-no-margin--bottom u-no-margin--left u-no-padding--left",children:e.map(s=>a.jsx(Ca,{item:s},s.path))})})})},U="/assets/logo-white-full-C918wjMe.svg",Ba="data:image/svg+xml,%3csvg%20width='31'%20height='56'%20viewBox='0%200%2031%2056'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_316_10103)'%3e%3cpath%20d='M30.4262%200.318237H0.000976562V53.7546H30.4262V0.318237Z'%20fill='%23E9500E'/%3e%3cpath%20d='M23.0382%2043.617H13.9041C13.878%2043.617%2013.852%2043.63%2013.839%2043.6431C13.8259%2043.6561%2013.8129%2043.6822%2013.8129%2043.7082L13.8259%2045.1936C13.8259%2045.2458%2013.865%2045.2849%2013.9302%2045.2849H21.3052V46.8354H12.3144V28.1112C12.3144%2028.0591%2012.2753%2028.007%2012.2102%2028.007H7.40209C7.34997%2028.007%207.29785%2028.046%207.29785%2028.1112V48.4121C7.29785%2048.4642%207.33694%2048.5163%207.40209%2048.5163H8.95267C8.97873%2048.5163%209.00479%2048.5033%209.01782%2048.4903C9.03085%2048.4772%209.04388%2048.4512%209.04388%2048.4251V29.6357L10.6336%2029.6227L10.5814%2048.3469C10.5814%2048.373%2010.5945%2048.399%2010.6075%2048.4121C10.6205%2048.4251%2010.6466%2048.4381%2010.6726%2048.4381H23.0382C23.0903%2048.4381%2023.1424%2048.399%2023.1424%2048.3339V43.7082C23.1294%2043.6561%2023.0903%2043.617%2023.0382%2043.617Z'%20fill='white'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_316_10103'%3e%3crect%20width='31'%20height='55'%20fill='white'%20transform='translate(0%200.318115)'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",La="_container_1gwom_1",Ma="_link_1gwom_7",Ta="_logoImg_1gwom_11",Oa="_logoIcon_1gwom_12",f={container:La,link:Ma,logoImg:Ta,logoIcon:Oa},$a=1.6,Da=({closeMenu:e})=>a.jsxs("div",{className:n("p-panel__header is-sticky u-no-padding--left u-no-padding--right",f.container),children:[a.jsxs(v,{to:t.root.root(),className:f.link,children:[a.jsx("img",{className:n("is-fading-when-collapsed",f.logoImg),src:U,alt:I,width:144}),a.jsx("img",{className:f.logoIcon,src:Ba,alt:I,width:$a*16})]}),a.jsx("div",{className:"u-hide--large",children:a.jsx(l.Button,{type:"button",className:"p-button--base is-dark u-no-margin u-hide--medium",hasIcon:!0,onClick:s=>{e(),s.currentTarget.blur()},"aria-label":"Close navigation",children:a.jsx(l.Icon,{name:"close-sidebar",className:"is-light"})})})]}),Ra=({toggleMenu:e})=>a.jsxs("div",{className:"p-panel__header",children:[a.jsx(v,{to:t.root.root(),children:a.jsx("img",{className:"p-panel__logo-name is-fading-when-collapsed",src:U,alt:I,width:144})}),a.jsx("div",{className:"p-panel__controls u-no-padding--top",children:a.jsx(l.Button,{type:"button",className:"p-panel__toggle",dense:!0,onClick:e,children:"Menu"})})]}),Ua="_container_1ggdj_1",Fa="_navigation_1ggdj_10",Ha="_footer_1ggdj_15",S={container:Ua,navigation:Fa,footer:Ha},qa="_container_93vok_1",Ga="_label_93vok_8",Va="_link_93vok_12",Wa="_icon_93vok_24",Qa="_button_93vok_29",Ka="_accordionButton_93vok_35",c={container:qa,label:Ga,link:Va,icon:Wa,button:Qa,accordionButton:Ka},Ya=()=>{const{user:e,logout:s}=B(),{pathname:i}=x(),o=L("(max-width: 619px)"),{handleLogoutQuery:r}=E(),b=M(),[j,h]=g.useState(!1),{mutateAsync:u}=r,k=async()=>{try{await u(),s()}catch(p){b(p)}};return a.jsx("div",{className:n("p-side-navigation--icons is-dark",c.container),children:a.jsxs("ul",{className:"u-no-margin--bottom u-no-margin--left u-no-padding--left",children:[a.jsxs("li",{className:"p-side-navigation__item",children:[o&&a.jsxs(a.Fragment,{children:[a.jsxs(l.Button,{className:n("p-side-navigation__accordion-button",c.accordionButton),type:"button","aria-expanded":j,onClick:()=>{h(p=>!p)},children:[a.jsx(l.Icon,{name:"account",className:n("is-light p-side-navigation__icon",c.icon)}),a.jsx("span",{className:n("p-side-navigation__label",c.label),children:e?.name??"Unknown user"})]}),a.jsx("ul",{className:"p-side-navigation__list","aria-expanded":j,children:C.items?.map(p=>a.jsx("li",{children:a.jsx(v,{className:n("p-side-navigation__link",c.link),to:p.path,"aria-current":i===p.path?"page":void 0,children:a.jsx("span",{className:n("p-side-navigation__label",c.label),children:p.label})})},p.path))})]}),!o&&a.jsxs(v,{to:t.account.general(),className:n("p-side-navigation__link",c.accordionButton),"aria-expanded":!1,"aria-current":i.includes(t.account.root())?"page":void 0,children:[a.jsx(l.Icon,{name:"account",className:n("is-light p-side-navigation__icon",c.icon)}),a.jsx("span",{className:n("p-side-navigation__label",c.label),children:e?.name??"Unknown user"})]})]}),a.jsx("li",{className:"p-side-navigation__item",children:a.jsxs(v,{className:n("p-side-navigation__link",c.link),to:t.alerts.root(),"aria-current":i===t.alerts.root()?"page":void 0,children:[a.jsx(l.Icon,{name:"bell",className:n("is-light p-side-navigation__icon",c.icon)}),a.jsx("span",{className:n("p-side-navigation__label",c.label),children:"Alerts"})]})}),a.jsx("li",{className:"p-side-navigation__item",children:a.jsxs(l.Button,{type:"button",appearance:"base",className:n("u-no-margin--bottom",c.link,c.button),onClick:k,children:[a.jsx(l.Icon,{name:"logout",className:n("is-light p-side-navigation__icon",c.icon)}),a.jsx("span",{className:n("p-side-navigation__label",c.label),children:"Sign out"})]})})]})})},za="_organisation_1bu4l_1",Za="_container_1bu4l_5",Ja="_marginBottom_1bu4l_17",N={organisation:za,container:Za,marginBottom:Ja},Xa=()=>{const{isOnSubdomain:e,options:s,handleAccountSwitch:i,currentAccount:o}=aa(),r=M(),{closeSidePanel:b}=q(),{switchAccountQuery:j}=E();if(e||s.length===1)return a.jsx("div",{className:n(N.container,N.marginBottom),children:a.jsx(X,{label:"Organization",value:o.title,className:N.organisation})});const{mutateAsync:h}=j,u=async k=>{const p=k.target.value;try{const{data:y}=await h({account_name:p});i(y.token,p),b()}catch(y){r(y)}};return a.jsx("div",{className:N.container,children:a.jsx(l.Select,{label:"Organization",labelClassName:n(N.organisation,"p-text--small p-text--small-caps u-no-margin--bottom"),options:s,value:o.name,onChange:u})})},ae="_container_1r6ks_7",ee="_listItem_1r6ks_14",se="_titleRow_1r6ks_24",ne="_title_1r6ks_24",te="_version_1r6ks_35",ie="_feedbackLink_1r6ks_39",_={container:ae,listItem:ee,titleRow:se,title:ne,version:te,feedbackLink:ie},oe="This portal is still a work-in-progress. Some features may not be available yet and you may encounter some bugs. You can switch back to the classic portal at any time and share your feedback with us on Discourse.",le=()=>{const{getClassicDashboardUrlQuery:e}=E(),{data:s,refetch:i}=e({},{enabled:!1});return g.useEffect(()=>{s&&G(s.data.url)},[s]),a.jsx("div",{className:n("is-fading-when-collapsed",_.container),children:a.jsxs("ul",{className:"p-list p-list--divided u-no-margin--bottom",children:[a.jsx("li",{className:n("p-list__item",_.listItem),children:a.jsxs("span",{className:_.titleRow,children:[a.jsxs("span",{children:[a.jsx("span",{className:_.title,children:"New web portal"}),a.jsx(l.Tooltip,{position:"right",message:oe,children:a.jsx(l.Icon,{name:l.ICONS.help})})]}),a.jsx("span",{className:_.version,children:`v${V}`})]})}),a.jsx("li",{className:n("p-list__item",_.listItem),children:a.jsx("a",{href:P,target:"_blank",rel:"noreferrer noopener nofollow",className:_.feedbackLink,children:"Share your feedback"})}),a.jsx("li",{className:n("p-list__item",_.listItem),children:a.jsx(l.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:i,children:a.jsx("span",{children:"Switch to classic dashboard"})})})]})})},re=()=>{const[e,s]=g.useState(!0);return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"l-navigation-bar",children:a.jsx("div",{className:"p-panel is-dark",children:a.jsx(Ra,{toggleMenu:()=>{s(i=>!i)}})})}),a.jsx("header",{className:n("l-navigation",{"is-collapsed":e}),children:a.jsx("div",{className:"l-navigation__drawer",children:a.jsx("div",{className:"p-panel is-dark",children:a.jsxs("div",{className:S.container,children:[a.jsx(Da,{closeMenu:()=>{s(!0)}}),a.jsxs("div",{className:S.navigation,children:[a.jsx(Xa,{}),a.jsx(Aa,{})]}),a.jsxs("div",{className:S.footer,children:[a.jsx(le,{}),a.jsx(Ya,{})]})]})})})})]})},ce=({children:e})=>{const{pathname:s}=x(),i=A("/account/*",s),o=L("(min-width: 620px)"),r=g.useId();return a.jsxs("div",{id:r,className:"l-application",role:"presentation",children:[a.jsxs(W,{children:[a.jsx(re,{}),a.jsx(Z,{value:r,children:a.jsxs("main",{className:n("l-main",w.wrapper),children:[i&&o&&a.jsx("div",{className:n("l-navigation__drawer",w.secondaryNavigation),children:a.jsx(_a,{})}),a.jsx("div",{className:w.pageContent,children:e})]})})]}),a.jsx(sa,{})]})},Oe=()=>{const e=Q(),{pathname:s}=x();return g.useEffect(()=>{t.root.root()===s&&e(K,{replace:!0})},[s]),a.jsx(ce,{children:a.jsx(g.Suspense,{fallback:a.jsx(z,{}),children:a.jsx(Y,{})})})};export{Oe as default};
