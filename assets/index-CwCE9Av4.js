const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BwxUjkOf.js","assets/index-BMhnQnvO.js","assets/index-BPqj2aAr.css","assets/SelectAllButton-D_BMBSCB.js","assets/ExpandableTableFooter-9RPwl5aD.js","assets/ExpandableTableFooter-PHbaG9hU.css","assets/useUsns-Dw6dj2_v.js","assets/useFetchOld-Cff5y19B.js","assets/useMutation-Diy-BhWO.js","assets/useQuery-Dxk6aJEc.js","assets/useUsns-DiT_06KU.css","assets/index-BCw9BfyL.css","assets/index-DbEAVrBq.js","assets/index-b-w_HXuP.css","assets/index-BO7sKwPL.js","assets/UsnList-DDpKnMX7.js","assets/moment-BcE1DmV8.js","assets/NoData-D_FYardG.js","assets/TablePagination-BdWPaBG6.js","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/usePageParams-C2gko9oh.js","assets/TruncatedCell-iDjT0CSt.js","assets/TruncatedCell-BIhicLLO.css","assets/useConfirm-DBWWlNvT.js","assets/helpers-BQ6A_CwO.js","assets/helpers-iLCaOWqi.css","assets/useOnClickOutside-B6njW3aZ.js","assets/UsnList-BtkgdprT.css"])))=>i.map(i=>d[i]);
import{j as e,h as y,r as o,_ as d,e as v,m as A,f as E,g as m,k as I}from"./index-BMhnQnvO.js";import{u as T}from"./formik.esm-CIbWtvkk.js";import{S as L}from"./SidePanelFormButtons-Sm5GAIF2.js";import{a as C,u as V}from"./useUsns-Dw6dj2_v.js";import"./moment-BcE1DmV8.js";import{c as b,b as u,f as N,a as h}from"./index.esm-Cg6cKhK8.js";import"./SidePanelFormButtons.module-D1MffuBu.js";import"./useFetchOld-Cff5y19B.js";import"./useMutation-Diy-BhWO.js";import"./useQuery-Dxk6aJEc.js";const $=({instances:c})=>{const t=c.filter(({upgrades:n})=>n==null?void 0:n.security).length,l=c.filter(({upgrades:n})=>n==null?void 0:n.regular).length,a=c.filter(({upgrades:n})=>!(n!=null&&n.security)&&!(n!=null&&n.regular)).length;return e.jsxs("div",{children:[e.jsx("span",{children:"You selected "}),e.jsx("span",{children:e.jsx("b",{children:c.length})}),e.jsx("span",{children:" instances:"}),e.jsxs("ul",{className:y({"u-no-margin--bottom":a>0}),children:[t>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Security upgrades are available for "}),e.jsx("b",{children:t}),e.jsx("span",{children:t!==1?" instances":" instance"})]}),l>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Regular upgrades are available for "}),e.jsx("b",{children:l}),e.jsx("span",{children:l!==1?" instances":" instance"})]})]}),a>0&&e.jsxs("p",{children:[e.jsx("span",{children:"No upgrades for "}),e.jsx("span",{children:e.jsx("b",{children:a})}),e.jsx("span",{children:a!==1?" instances needed.":" instance needed."})]})]})},k=[{id:"tab-link-instances",label:"Instances"},{id:"tab-link-packages",label:"Packages"},{id:"tab-link-usns",label:"USNs"}],x={instances:o.lazy(()=>d(()=>import("./index-BwxUjkOf.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),packages:o.lazy(()=>d(()=>import("./index-DbEAVrBq.js"),__vite__mapDeps([12,1,2,6,7,8,9,10,3,4,5,13]))),usns:o.lazy(()=>d(()=>import("./index-BO7sKwPL.js"),__vite__mapDeps([14,1,2,15,16,3,4,5,17,18,19,20,21,22,23,24,6,7,8,9,10,25,26,27,28])))},D=b().shape({excludedPackages:u().of(b().shape({id:N().required(),exclude_packages:u().of(h())})),excludedUsns:u().of(h())}),F=({activeTabLinkId:c,onTabLinkClick:t,withUsnsTab:l})=>k.filter(({id:a})=>l||a!=="tab-link-usns").map(({id:a,label:n})=>({id:a,label:n,active:a===c,onClick:()=>t(a),role:"tab"})),R=c=>({excludedPackages:c.map(({id:t})=>({id:t,exclude_packages:[]})),excludedUsns:[]}),B=({selectedInstances:c})=>{const[t,l]=o.useState(k[0].id),a=c.filter(({upgrades:s})=>(s==null?void 0:s.security)||(s==null?void 0:s.regular)),n=a.filter(({upgrades:s})=>s==null?void 0:s.security),g=v(),{notify:j}=A(),{closeSidePanel:p}=E(),{upgradeInstancesPackagesQuery:f}=C(),{upgradeUsnsQuery:P}=V(),{mutateAsync:_}=f,{mutateAsync:U}=P,S=async s=>{try{t==="tab-link-usns"?await U({computers:n.map(({id:r})=>({id:r,exclude_usns:s.excludedUsns}))}):await _({computers:s.excludedPackages}),p(),j.success({title:"You queued packages to be upgraded",message:`Packages on ${c.length} ${c.length!==1?"instances":"instance"} will be upgraded and are queued in Activities`})}catch(r){g(r)}},i=T({initialValues:R(a),onSubmit:S,validationSchema:D});return e.jsxs(m.Form,{onSubmit:i.handleSubmit,children:[e.jsx($,{instances:c}),e.jsx(m.Tabs,{links:F({activeTabLinkId:t,onTabLinkClick:s=>l(s),withUsnsTab:n.length>0})}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":t,children:e.jsxs(o.Suspense,{fallback:e.jsx(I,{}),children:[t==="tab-link-instances"&&e.jsx(x.instances,{excludedPackages:i.values.excludedPackages,instances:a,onExcludedPackagesChange:s=>i.setFieldValue("excludedPackages",s)}),t==="tab-link-packages"&&e.jsx(x.packages,{excludedPackages:i.values.excludedPackages,instances:a,onExcludedPackagesChange:s=>i.setFieldValue("excludedPackages",s)}),t==="tab-link-usns"&&e.jsx(x.usns,{excludedUsns:i.values.excludedUsns,instances:n,onExcludedUsnsChange:s=>i.setFieldValue("excludedUsns",s)})]})}),e.jsx(L,{submitButtonDisabled:i.isSubmitting,submitButtonText:"Upgrade"})]})},G=B;export{G as Upgrades};
