import{e as L,j as e,g as a,r as p,L as D,R as k}from"./index-DXs1haZl.js";import{u as w,c as u,a as g,W as v,b as $}from"./WslInstanceList.module-ektlF0IO.js";import{u as N}from"./useConfirm-C9Ai5vPv.js";import{u as B}from"./useInstances-B3fQT90b.js";import{u as W}from"./usePageParams-BJqFm8Ol.js";import"./EmptyState-BYL1pVz2.js";import"./useFetchOld-DWTVWZGf.js";import"./useMutation-CoMMCR6r.js";import"./useQuery-DPA9mHwu.js";import"./HeaderWithSearch-OzYSSkOw.js";import"./HeaderWithSearch.module-ByXjIdeN.js";const R=({instance:t,parentId:o})=>{const c=L(),{confirmModal:i,closeConfirmModal:l}=N(),{setDefaultChildInstanceQuery:m,deleteChildInstancesQuery:h}=w(),{removeInstancesQuery:s}=B(),{mutateAsync:n}=m,{mutateAsync:r}=h,{mutateAsync:f}=s,x=async()=>{try{await n({child_id:t.id,parent_id:o})}catch(d){c(d)}finally{l()}},b=()=>{i({title:"Set default instance",body:`Are you sure you want to set ${t.title} as default instance?`,buttons:[e.jsx(a.Button,{appearance:"positive",onClick:x,children:"Set default"},"set-default")]})},C=async()=>{try{await r({computer_ids:[t.id]})}catch(d){c(d)}finally{l()}},j=()=>{i({title:"Delete instance",body:e.jsxs("p",{children:["This will permanently delete the instance ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),buttons:[e.jsx(a.Button,{appearance:"negative",onClick:C,children:"Delete"},"delete")]})},y=async()=>{try{await f({computer_ids:[t.id]})}catch(d){c(d)}finally{l()}},I=()=>{i({title:"Remove instance from Landscape",body:e.jsxs("p",{children:["This will remove the instance ",e.jsx("b",{children:t.title})," from Landscape.",e.jsx("br",{}),e.jsx("br",{}),"It will remain on the parent machine. You can re-register it to Landscape at any time."]}),buttons:[e.jsx(a.Button,{appearance:"negative",onClick:y,children:"Remove"},"remove")]})};return e.jsxs(a.ContextualMenu,{position:"left",toggleClassName:u.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(a.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${t.title} instance actions`},children:[!t.is_default_child&&e.jsx(a.Button,{type:"button",appearance:"base",className:u.actionButton,onClick:b,"aria-label":`Set ${t.title} as default instance`,children:"Set default instance"}),e.jsx(a.Button,{type:"button",appearance:"base",className:u.actionButton,onClick:I,"aria-label":`Remove ${t.title} instance from Landscape`,children:"Remove from Landscape"}),e.jsx(a.Button,{type:"button",appearance:"base",className:u.actionButton,onClick:j,"aria-label":`Delete ${t.title} instance`,children:"Delete instance"})]})},S=({instance:t})=>{const[o,c]=p.useState([]),{search:i}=W(),l=p.useMemo(()=>i?t.children.filter(({title:s,hostname:n})=>s.toLowerCase().includes(i.toLowerCase())||(n==null?void 0:n.toLowerCase().includes(i.toLowerCase()))):t.children,[t,i]),m=s=>{c(n=>n.some(({id:r})=>r===s.id)?n.filter(({id:r})=>r!==s.id):[...n,s])},h=p.useMemo(()=>[{accessor:"title",Header:e.jsxs(e.Fragment,{children:[e.jsx(a.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),checked:l.length>0&&o.length===l.length,indeterminate:o.length>0&&o.length<l.length,onChange:()=>{c(o.length>0?[]:l)}}),e.jsx("span",{children:"Title"})]}),Cell:({row:s})=>e.jsxs("div",{className:g.title,children:[e.jsx(a.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${s.original.title} instance`}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:o.some(({id:n})=>n===s.original.id),onChange:()=>m(s.original)}),e.jsx(D,{to:`${k}instances/${t.id}/${s.original.id}`,children:s.original.title})]})},{accessor:"distribution",Header:"OS",Cell:({row:{original:s}})=>s.distribution?`UbuntuÂ ${s.distribution}`:"Unknown"},{accessor:"default",Header:"Default",Cell:({row:{original:s}})=>e.jsx(e.Fragment,{children:s.is_default_child?"Yes":"No"})},{accessor:"actions",className:g.actions,Header:"Actions",Cell:({row:{original:s}})=>e.jsx(R,{instance:s,parentId:t.id})}],[l,o]);return e.jsxs(e.Fragment,{children:[e.jsx(v,{selectedInstances:o}),e.jsx(a.ModularTable,{columns:h,data:l,emptyMsg:"No WSL instances found"})]})},_=({instance:t})=>t.children.length!==0?e.jsx(S,{instance:t}):e.jsx($,{}),q=_;export{q as default};
