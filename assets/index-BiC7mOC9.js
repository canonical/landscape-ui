import{i as _,h as S,r as u,j as t,Y as h,L as g,v as x,D as m,m as e,o as p,E as y,I as r,N as j}from"./index-2fzpjuii.js";import{S as f}from"./SidePanelTablePagination-BzWZrZMh.js";import{b as A}from"./ScriptsTabs-B4WNvYX2.js";import"./index-0zPblRXu.js";import{u as N}from"./useRoles-Dwt5A3Uj.js";import{g as C,a as I,b as T}from"./index-Bn6cWkNb.js";import"./TruncatedCell-CgdNfcLB.js";import"./HeaderWithSearch-BIg5d4wD.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";const k=({id:s,...i})=>{const a=_(),{data:n,isLoading:c}=S({queryKey:["scriptProfileActivities",{id:s,...i}],queryFn:async()=>a.get(`script-profiles/${s}/activities`,{params:i})});return{activities:(n==null?void 0:n.data.results)??[],activitiesCount:n==null?void 0:n.data.count,isGettingActivities:c}},w="_link_1wvsk_1",P={link:w},L=({activities:s})=>{const i=u.useMemo(()=>[{Header:"Run",Cell:({row:{original:a}})=>t.jsxs(g,{className:P.link,to:`/activities?query=parent-id%3A${a.id}`,children:[x(a.creation_time).utc().format(m)," "]})},{Header:"Status",Cell:({row:{original:a}})=>h[a.activity_status].label,getCellIcon:({row:{original:a}})=>h[a.activity_status].icon}],[s]);return t.jsx(e.ModularTable,{columns:i,data:s})},z=({profile:s})=>{const[i,a]=u.useState(1),[n,c]=u.useState(20),{activities:l,activitiesCount:d,isGettingActivities:o}=k({id:s.id,limit:n,offset:(i-1)*n});return o?t.jsx(p,{}):l.length?t.jsxs(t.Fragment,{children:[t.jsx(L,{activities:l}),t.jsx(f,{currentPage:i,pageSize:n,paginate:a,setPageSize:c,totalItems:d})]}):t.jsx(y,{title:"No runs found",body:"The profile has not run yet."})},E=({actions:s,profile:i})=>i.archived?t.jsxs(e.Notification,{inline:!0,title:"Profile archived:",severity:"caution",children:["The profile was archived on"," ",x(i.last_edited_at).format(m),"."]}):t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[t.jsxs(e.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:s.edit,children:[t.jsx(e.Icon,{name:"edit"}),t.jsx("span",{children:"Edit"})]}),t.jsxs(e.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:s.archive,children:[t.jsx(e.Icon,{name:"archive"}),t.jsx("span",{children:"Archive"})]})]})}),R="_link_1wvsk_1",v={link:R},F=({profile:s})=>{const{script:i,isScriptLoading:a}=A(s.script_id),{getAccessGroupQuery:n}=N(),{data:c,isLoading:l}=n();if(a||l)return t.jsx(p,{});const d=c==null?void 0:c.data.find(b=>b.name==s.access_group);if(!i||!d)throw new Error;const o=s.activities.last_activity;return t.jsxs(t.Fragment,{children:[t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Name",value:s.title})}),t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Status",value:C(s)})})]}),t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Script",value:t.jsx(g,{className:v.link,to:"/scripts?tab=scripts",state:{scriptId:i.id},children:i.title})})}),t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Access group",value:d.title})})]}),t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Run as user",value:s.username})}),t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Time limit",value:`${s.time_limit}s`})})]}),t.jsx("hr",{}),t.jsx(r,{label:"Trigger",value:I(s)}),t.jsxs(e.Row,{className:"u-no-padding",children:[s.trigger.trigger_type!="event"&&t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Next run",value:s.trigger.next_run?`${x(s.trigger.next_run).utc().format(m)}`:t.jsx(j,{})})}),t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Last run",value:o?t.jsxs(g,{className:v.link,to:`/activities?query=parent-id%3A${o.id}`,children:[x(o.creation_time).utc().format(m)," "]}):t.jsx(j,{})})})]}),t.jsx("hr",{}),t.jsx("p",{className:"p-heading--5",children:"Association"}),t.jsx(e.Row,{className:"u-no-padding",children:t.jsx(r,{label:"Associated instances",value:T(s)})}),t.jsx(e.Row,{className:"u-no-padding",children:t.jsx(r,{label:"Tags",value:s.all_computers?"All instances":s.tags.join(", ")||t.jsx(j,{})})})]})},O=({actions:s,profile:i})=>{const[a,n]=u.useState("info"),l=[{label:"Info",id:"info"},{label:"Activity history",id:"activity-history"}].map(({label:d,id:o})=>({label:d,active:a==o,onClick:()=>{n(o)}}));return t.jsxs(t.Fragment,{children:[t.jsx(E,{actions:s,profile:i}),t.jsx(e.Tabs,{listClassName:"u-no-margin--bottom",links:l}),a=="info"&&t.jsx(F,{profile:i}),a=="activity-history"&&t.jsx(z,{profile:i})]})};export{O as default};
