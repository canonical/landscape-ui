const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-emPIDmP2.js","assets/index-CDk-Jgvr.js","assets/index-B4xaleMR.css","assets/CheckboxGroup-qcDpYD9d.js","assets/CheckboxGroup-Nf21OKoS.css","assets/debug-Gd_NOOqE.js","assets/useGPGKeys-CPgUyfhl.js","assets/debug-CHNhm1j1.css","assets/MultiSelectField-U-nhLr2F.js","assets/MultiSelectField-CD3NDVCz.css","assets/SidePanelFormButtons-CsUGQk2E.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/UdebCheckboxInput-m4yPLxP4.js","assets/UdebCheckboxInput-4dvPTSn-.css","assets/constants-BvbQAp1Y.js","assets/constants-DRKgEQ0k.js","assets/constants-BnrFFkRy.css"])))=>i.map(i=>d[i]);
import{l as d,j as e,d as l,Z as ie,a3 as de,o as ue,n as ge,F as I,C as me,A as L,_ as fe}from"./index-CDk-Jgvr.js";import{S as pe}from"./SidePanelTablePagination-ByE4BkY1.js";import{f as Pe}from"./constants-BvbQAp1Y.js";import"./constants-DRKgEQ0k.js";const he="_version_sfav3_1",ke="_content_sfav3_5",w={version:he,content:ke},xe=({isUpload:o,packagesToShow:n,search:s,selectedPackages:r,setSelectedPackages:m})=>{const u=d.useMemo(()=>[{accessor:"packageName",Header:({rows:t})=>o?e.jsxs(e.Fragment,{children:[e.jsx(l.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),disabled:!t.length,indeterminate:!!r.length&&r.length<t.length,checked:r.length===t.length&&!!r.length,onChange:()=>{m(i=>i.length?[]:t.map((P,x)=>x))}}),e.jsx("span",{children:"Package"})]}):"Package",Cell:({row:t})=>o?e.jsx(l.CheckboxInput,{inline:!0,label:t.original.packageName,checked:r.includes(t.index),onChange:()=>{m(i=>i.includes(t.index)?i.filter(P=>P!==t.index):[...i,t.index])}}):t.original.packageName},{accessor:"packageVersion",Header:"Version",getCellIcon:({row:t})=>t.original.difference?"warning":!1,className:w.version,Cell:({row:t})=>t.original.difference?e.jsx(l.Tooltip,{position:"top-center",message:t.original.difference==="delete"?"Package deleted":`Version differs
from parent pocket.
Parent version:
${t.original.newVersion}`,children:e.jsx("span",{children:t.original.packageVersion})}):t.original.packageVersion}],[n,r.length]);return e.jsx(l.ModularTable,{columns:u,data:n,emptyMsg:s?`No packages found with the search: "${s}".`:void 0,className:w.content,getCellProps:({column:t})=>{switch(t.id){case"packageName":return{role:"rowheader"};case"packageVersion":return{"aria-label":"Version"};default:return{}}}})},ye="_ctaRow_qlsck_1",je={ctaRow:ye},be=d.lazy(async()=>fe(()=>import("./index-emPIDmP2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))),k=1,A=20,Re=({distributionName:o,pocket:n,seriesName:s})=>{const[r,m]=d.useState(k),[u,t]=d.useState(A),[i,P]=d.useState([]),{value:x,setTrue:H}=ie(),[b,R]=d.useState(""),[y,_]=d.useState(""),[$,O]=d.useState([]),V=de("(max-width: 619px)"),D=ue(),{setSidePanelContent:U,closeSidePanel:q}=ge(),{listPocketQuery:K,diffPullPocketQuery:Z,pullPackagesToPocketQuery:G,syncMirrorPocketQuery:J,removePackagesFromPocketQuery:W,removePocketQuery:X}=Pe(),{mutate:Y,isPending:B}=J,{mutate:N,isPending:T}=G,ee=()=>{n.mode==="mirror"?Y({name:n.name,series:s,distribution:o}):n.mode==="pull"&&N({name:n.name,series:s,distribution:o})},ne=()=>{U(`Edit ${n.name} pocket`,e.jsx(d.Suspense,{fallback:e.jsx(L,{}),children:e.jsx(be,{pocket:n,distributionName:o,seriesName:s})}))},{mutateAsync:te,isPending:v}=X,ae=async()=>{try{await te({distribution:o,series:s,name:n.name}),q()}catch(a){D(a)}},{mutateAsync:oe,isPending:j}=W,E=!B&&!T&&!j&&!v,{data:se,isLoading:M}=K({name:n.name,series:s,distribution:o,search:y,limit:u,offset:r*u-u},{enabled:E}),S=se?.data??{count:0,results:[]},f=S.results.map(a=>({packageName:a.name,packageVersion:a.version})),{data:Q}=Z({name:n.name,series:s,distribution:o},{enabled:n.mode==="pull"&&!M&&E});d.useEffect(()=>{const a=Q?.data??{},c=[];for(const g in a){const p={add:[],update:[],delete:[],...a[g]};for(const[h,C]of p.add)c.push({packageName:h,newVersion:C,difference:"add"});(p.update.length||p.delete.length)&&H();for(const[h,,C]of p.update)c.push({packageName:h,newVersion:C,difference:"update"});for(const[h]of p.delete)c.push({packageName:h,difference:"delete",newVersion:""})}O(c)},[Q]);const le=()=>x?(f.forEach((a,c)=>{const g=$.find(({packageName:p})=>a.packageName===p);g&&(f[c].difference=g.difference,g.newVersion!==""&&(f[c].newVersion=g.newVersion))}),[...f.filter(({difference:a})=>a),...f.filter(({difference:a})=>!a)]):f,z=d.useMemo(()=>le(),[r,u,y,x,f.length,$.length]),ce=async()=>{const a=z.filter((c,g)=>i.includes(g)).map(({packageName:c})=>c);try{await oe({name:n.name,series:s,distribution:o,packages:a})}catch(c){D(c)}},F=!y&&r===k&&u===A&&!S.count,re=n.mode==="upload"?{size:8,medium:4}:{size:6,medium:3};return e.jsxs(e.Fragment,{children:[e.jsxs(l.Row,{className:I("u-no-padding--left u-no-padding--right",je.ctaRow),children:[e.jsx(l.Col,{...re,children:e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[n.mode!=="upload"&&e.jsx(l.Button,{className:"p-segmented-control__button",type:"button",onClick:ee,disabled:B&&T,"aria-label":n.mode==="mirror"?`Synchronize ${n.name} pocket of ${o}/${s}`:`Pull packages to ${n.name} pocket of ${o}/${s}`,children:n.mode==="mirror"?"Sync":"Pull"}),e.jsx(l.Button,{className:"p-segmented-control__button",type:"button",onClick:ne,"aria-label":`Edit ${n.name} pocket of ${o}/${s}`,children:"Edit"}),e.jsx(l.ConfirmationButton,{className:"p-segmented-control__button",type:"button","aria-label":`Remove ${n.name} pocket of ${o}/${s}`,confirmationModalProps:{title:"Deleting pocket",children:e.jsxs("p",{children:["Do you really want to delete ",n.name," pocket from"," ",s," series of ",o," distribution?"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:v,confirmButtonLoading:v,onConfirm:ae},children:"Remove"}),n.mode==="upload"&&e.jsx(l.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:!i.length||j,"aria-label":`Remove selected packages from ${n.name} pocket of ${o}/${s}`,confirmationModalProps:{title:"Deleting packages from pocket",children:e.jsxs("p",{children:["This will delete ",i.length," selected"," ",me(i.length,"package")," from"," ",n.name," pocket ",s," series of"," ",o," distribution"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:j,confirmButtonLoading:j,onConfirm:ce},children:"Remove packages"})]})})}),n.mode!=="upload"&&!F&&e.jsx(l.Col,{size:6,medium:3,children:e.jsx(l.Form,{onSubmit:a=>{a.preventDefault(),_(b),m(k)},noValidate:!0,children:e.jsx(l.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,"aria-label":"Package search",onChange:a=>{R(a)},value:b,onClear:()=>{R(""),_(""),m(k)},className:I({"is-dense":!V,"u-no-margin--bottom":V}),onSearch:()=>{_(b),m(k)},autocomplete:"off"})})})]}),M?e.jsx(L,{}):F?e.jsx("p",{children:"No packages found"}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{isUpload:n.mode==="upload",packagesToShow:z,search:y,selectedPackages:i,setSelectedPackages:P}),e.jsx(pe,{currentPage:r,totalItems:S.count,paginate:a=>{P([]),m(a)},pageSize:u,setPageSize:a=>{t(a)}})]})]})};export{Re as default};
