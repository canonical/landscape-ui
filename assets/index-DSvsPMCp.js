const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-REOXvvh7.js","assets/index-CSSscRtK.js","assets/index-BMslluac.css","assets/SidePanelFormButtons-0L6kGGLA.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/MultiSelectField-CtDXFQVH.js","assets/MultiSelectField-DOBW8uWL.css","assets/TablePagination-Bk6IFP8F.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-DquXj6di.js","assets/helpers-B7In7lcm.js","assets/HeaderWithSearch-C5kQzeVZ.js","assets/HeaderWithSearch-DQybm8h_.css","assets/NoData-HQm8ZFJm.js","assets/index-PCu0GR0R.js"])))=>i.map(i=>d[i]);
import{h as Y,e as X,f,g as v,p as F,q,i as N,t as J,k as Z,n as y,v as ee,j as e,d as n,r as x,_ as A,s as se,c as oe,o as I,E as re}from"./index-CSSscRtK.js";import{T as te}from"./TablePagination-Bk6IFP8F.js";import{S as ne}from"./SidePanelFormButtons-0L6kGGLA.js";import{g as ae,r as D,U as $,a as ie}from"./helpers-B7In7lcm.js";import{u as M}from"./usePageParams-DquXj6di.js";import{H as ce}from"./HeaderWithSearch-C5kQzeVZ.js";import{N as ue}from"./NoData-HQm8ZFJm.js";function B(){const r=Y(),t=X(),i=(s,p={})=>v({queryKey:["users",{...s}],queryFn:()=>r.get("users",{params:s}),...p}),u=f({mutationKey:["users","new"],mutationFn:s=>r.post("users",s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),l=f({mutationKey:["users","edit"],mutationFn:s=>r.put("users",s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),d=f({mutationKey:["users","remove"],mutationFn:s=>r.delete("users",{params:s}),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),h=f({mutationKey:["users","lock"],mutationFn:s=>r.post("users/lock",s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),g=f({mutationKey:["users","unlock"],mutationFn:s=>r.post("users/unlock",s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),b=(s,p={})=>v({queryKey:["groups",(s==null?void 0:s.computer_id)??""],queryFn:()=>{if(!s)throw new Error("Missing required parameters");return r.get(`computers/${s.computer_id}/groups`)},...p}),a=(s,p={})=>v({queryKey:["userGroups",(s==null?void 0:s.computer_id)??"",(s==null?void 0:s.username)??""],queryFn:()=>{if(!s)throw new Error("Missing required parameters");return r.get(`computers/${s.computer_id}/users/${s.username}/groups`)},...p}),m=f({mutationKey:["groups","add"],mutationFn:s=>r.post(`computers/${s.computer_id}/usergroups/update_bulk`,s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),o=f({mutationKey:["groups","remove"],mutationFn:s=>r.post(`computers/${s.computer_id}/usergroups/update_bulk`,s),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})});return{getUsersQuery:i,getGroupsQuery:b,getUserGroupsQuery:a,createUserQuery:u,removeUserQuery:d,editUserQuery:l,lockUserQuery:h,unlockUserQuery:g,addUserToGroupQuery:m,removeUserFromGroupQuery:o}}const le="_actions_1l3g0_1",de={actions:le},K=()=>{const{instanceId:r}=F(),t=q(),{closeSidePanel:i}=N(),{createUserQuery:u,getGroupsQuery:l}=B(),d=Number(r),{mutateAsync:h}=u,{data:g,isLoading:b}=l({computer_id:d}),m=((g==null?void 0:g.data.groups)??[]).map(s=>({label:s.name,value:s.name})),o=J({initialValues:{name:"",username:"",password:"",confirmPassword:"",requirePasswordReset:!1,location:"",homePhoneNumber:"",workPhoneNumber:"",primaryGroupValue:""},validationSchema:Z().shape({name:y().required("This field is required"),username:y().required("This field is required"),password:y().required("This field is required"),confirmPassword:y().required("This field is required").oneOf([ee("password"),""],"Passwords must match"),location:y(),homePhoneNumber:y(),workPhoneNumber:y(),primaryGroupValue:y().required("This field is required")}),onSubmit:async s=>{try{await h({computer_ids:[d],name:s.name,username:s.username,password:s.password,require_password_reset:s.requirePasswordReset,location:s.location,home_phone:s.homePhoneNumber,work_phone:s.workPhoneNumber,primary_groupname:s.primaryGroupValue}),i()}catch(p){t(p)}}});return e.jsxs(n.Form,{noValidate:!0,onSubmit:o.handleSubmit,name:"add-new-user",children:[e.jsx(n.Input,{type:"text",label:"Username",autoComplete:"new-username",required:!0,error:o.touched.username&&o.errors.username?o.errors.username:void 0,...o.getFieldProps("username")}),e.jsx(n.Input,{type:"text",label:"Name",required:!0,error:o.touched.name&&o.errors.name?o.errors.name:void 0,...o.getFieldProps("name")}),e.jsx(n.Input,{type:"password",label:"Passphrase",autoComplete:"new-password",required:!0,error:o.touched.password&&o.errors.password?o.errors.password:void 0,...o.getFieldProps("password")}),e.jsx(n.Input,{type:"password",label:"Confirm passphrase",autoComplete:"new-password",required:!0,error:o.touched.confirmPassword&&o.errors.confirmPassword?o.errors.confirmPassword:void 0,...o.getFieldProps("confirmPassword")}),e.jsx(n.Input,{type:"checkbox",label:"Require passphrase reset",help:"User must change password at first login",...o.getFieldProps("requirePasswordReset"),checked:o.values.requirePasswordReset}),e.jsx(n.Select,{label:"Primary Group",disabled:b,options:[{label:"Select",value:""},...m],...o.getFieldProps("primaryGroupValue"),error:o.touched.primaryGroupValue&&o.errors.primaryGroupValue?o.errors.primaryGroupValue:void 0}),e.jsx(n.Input,{type:"text",label:"Location",error:o.touched.location&&o.errors.location?o.errors.location:void 0,...o.getFieldProps("location")}),e.jsx(n.Input,{type:"text",label:"Home phone",error:o.touched.homePhoneNumber&&o.errors.homePhoneNumber?o.errors.homePhoneNumber:void 0,...o.getFieldProps("homePhoneNumber")}),e.jsx(n.Input,{type:"text",label:"Work phone",error:o.touched.workPhoneNumber&&o.errors.workPhoneNumber?o.errors.workPhoneNumber:void 0,...o.getFieldProps("workPhoneNumber")}),e.jsx(ne,{submitButtonDisabled:o.isSubmitting,submitButtonText:"Add user"})]})},me=x.lazy(()=>A(()=>import("./index-REOXvvh7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),pe=({selectedUsers:r,handleClearSelection:t,sidePanel:i=!1})=>{const[u,l]=x.useState(!1),{instanceId:d}=F(),h=q(),{notify:g}=se(),{setSidePanelContent:b,closeSidePanel:a}=N(),{removeUserQuery:m,lockUserQuery:o,unlockUserQuery:s}=B(),{mutateAsync:p,isPending:U}=m,{mutateAsync:j,isPending:_}=o,{mutateAsync:P,isPending:k}=s,S=Number(d),c=r.length===1?r[0]:void 0,{locked:Q,unlocked:E}=ae(r),C=async(w,L)=>{try{await w({computer_ids:[S],usernames:ie(r),delete_home:L==="removed"?u:void 0}),t&&t(),a(),g.success({message:`Successfully requested to be ${L}`})}catch(W){h(W)}},G=async()=>{await C(j,"locked")},V=async()=>{await C(P,"unlocked")},H=async()=>{await C(p,"removed")},R=()=>{b("Add new user",e.jsx(K,{}))},O=w=>{b("Edit user",e.jsx(x.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(me,{user:w})}))},z=()=>{l(w=>!w)};return e.jsxs("div",{className:oe("p-panel__controls u-no-padding--top",{"u-no-margin--left":i}),children:[!i&&e.jsxs(n.Button,{className:"u-no-margin--right",type:"button",hasIcon:!0,onClick:R,children:[e.jsx(n.Icon,{name:n.ICONS.plus}),e.jsx("span",{children:"Add user"})]}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[((c==null?void 0:c.enabled)||!i)&&e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:E===0,"aria-disabled":E===0,confirmationModalProps:{title:`Lock ${c?`user ${c.username}`:`${r.length} users`}`,children:D({user:c,selectedUsers:r,userAction:$.Lock}),confirmButtonLabel:"Lock",confirmButtonAppearance:"positive",confirmButtonLoading:_,confirmButtonDisabled:_,onConfirm:G},children:[e.jsx(n.Icon,{name:"lock-locked"}),e.jsx("span",{children:"Lock"})]}),(!(c!=null&&c.enabled)||!i)&&e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:Q===0,"aria-disabled":Q===0,confirmationModalProps:{title:`Unlock ${c?`user ${c.username}`:`${r.length} users`}`,children:D({user:c,selectedUsers:r,userAction:$.Unlock}),confirmButtonLabel:"Unlock",confirmButtonAppearance:"positive",confirmButtonLoading:k,confirmButtonDisabled:k,onConfirm:V},children:[e.jsx(n.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlock"})]}),i&&c&&e.jsxs(n.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>O(c),children:[e.jsx(n.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:r.length===0,"aria-disabled":r.length===0,confirmationModalProps:{title:`Delete ${c?c.username:"users"}`,children:e.jsxs("div",{children:[e.jsx("p",{className:"u-no-margin--bottom",children:c?`This will delete user ${c.username}. You can delete this user's home folders at the same time.`:"This will delete selected users. You can delete their home folders as well."}),e.jsx(n.Input,{label:"Delete the home folders as well",type:"checkbox",checked:u,onChange:z})]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonLoading:U,confirmButtonDisabled:U,onConfirm:H},children:[e.jsx(n.Icon,{name:n.ICONS.delete}),e.jsx("span",{children:"Delete"})]})]})})]})},he=(r,t)=>r.filter(i=>t.includes(i.uid)),ge=({selected:r,handleClearSelection:t,users:i})=>{const{setPageParams:u}=M(),l=d=>{u({search:d}),t()};return e.jsx(ce,{onSearch:l,actions:e.jsx("div",{className:de.actions,children:e.jsx(pe,{handleClearSelection:t,selectedUsers:he(i,r)})})})},be="_status_1or9p_1",xe="_actions_1or9p_7",T={status:be,actions:xe},ye=({column:r})=>{const t={};switch(r.id){case"username":t.role="rowheader";break;case"enabled":t["aria-label"]="Status";break;case"uid":t["aria-label"]="User id";break;case"name":t["aria-label"]="Full name";break}return t},fe=x.lazy(()=>A(()=>import("./index-REOXvvh7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),je=x.lazy(()=>A(()=>import("./index-PCu0GR0R.js"),__vite__mapDeps([16,1,2,15,8,9,10,11,3,4,5,12,13,14]))),ke=({users:r,selected:t,setSelected:i})=>{const{setSidePanelContent:u}=N(),l=a=>{u("Edit user",e.jsx(x.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(fe,{user:a})}))},d=a=>{u("User details",e.jsx(x.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(je,{user:a})}))},h=()=>{i(t.length!==0?[]:r.map(({uid:a})=>a))},g=a=>{t.includes(a)?i(t.filter(m=>m!==a)):i([...t,a])},b=x.useMemo(()=>[{accessor:"username",Header:e.jsxs(e.Fragment,{children:[e.jsx(n.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:h,checked:r.length>0&&t.length===r.length,indeterminate:t.length>0&&t.length<r.length}),e.jsx("span",{children:"username"})]}),Cell:({row:a})=>e.jsxs(e.Fragment,{children:[e.jsx(n.CheckboxInput,{inline:!0,label:e.jsxs("span",{className:"u-off-screen",children:["Select user ",a.original.username]}),checked:t.includes(a.original.uid),onChange:()=>g(a.original.uid)}),e.jsx(n.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>d(a.original),"aria-label":`Show details of user ${a.original.username}`,children:a.original.username})]})},{Header:"status",accessor:"enabled",sortType:"basic",Cell:({row:a})=>e.jsx("div",{className:T.status,children:a.original.enabled?e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlocked"})]}):e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{name:"lock-locked-active"}),e.jsx("span",{children:"Locked"})]})})},{Header:"UID",accessor:"uid",sortType:"basic"},{Header:"Full Name",accessor:"name",sortType:"basic",Cell:({row:a})=>a.original.name||e.jsx(ue,{})},{accessor:"actions",className:T.actions,Cell:({row:a})=>e.jsx(n.Tooltip,{message:"Edit",position:"btm-center",children:e.jsx(n.Button,{type:"button",small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Edit ${a.original.name} profile`,onClick:()=>l(a.original),children:e.jsx(n.Icon,{name:"edit",className:"u-no-margin--left"})})})}],[r,t]);return e.jsx(n.ModularTable,{columns:b,data:r,emptyMsg:"No users available",sortable:!0,initialSortDirection:"ascending",initialSortColumn:"username",getCellProps:ye})},_e=(r,t)=>r?t.filter(({username:i,name:u})=>{const l=u==null?void 0:u.toUpperCase().includes(r.toUpperCase()),d=i.toUpperCase().includes(r.toUpperCase());return l||d}):t,we=1e3,Ue=()=>{const[r,t]=x.useState([]),{instanceId:i,childInstanceId:u}=F(),{search:l,currentPage:d,pageSize:h}=M(),{setSidePanelContent:g}=N(),{getUsersQuery:b}=B(),a=Number(u??i),{data:m,isLoading:o}=b({computer_id:a,limit:we}),s=(m==null?void 0:m.data.results)??[],p=_e(l,s),U=(k,S)=>p.slice(S,S+k),j=x.useMemo(()=>U(h,(d-1)*h),[l,s,d,h]),_=()=>{t([])},P=()=>{g("Add new user",e.jsx(K,{}))};return e.jsxs(e.Fragment,{children:[o&&e.jsx(I,{}),!o&&(!m||m.data.results.length===0)&&e.jsx(re,{title:"No users found",body:"Add new users by clicking the button below",icon:"connected",cta:[e.jsx(n.Button,{type:"button",appearance:"positive",onClick:P,children:"Add user"},"empty-state-add-new-user")]}),(l||!o&&j.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{selected:r,handleClearSelection:_,users:j}),e.jsx(ke,{selected:r,setSelected:k=>t(k),users:j})]}),e.jsx(te,{handleClearSelection:_,totalItems:p.length,currentItemCount:j.length})]})},Ae=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));export{pe as U,Ae as i,B as u};
