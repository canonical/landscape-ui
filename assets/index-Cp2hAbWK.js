const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-fU8Xm8EU.js","assets/index-CDk-Jgvr.js","assets/index-B4xaleMR.css","assets/SidePanelFormButtons-CsUGQk2E.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/useRoles-BvJMVkR7.js"])))=>i.map(i=>d[i]);
import{v as x,a5 as f,x as p,k as j,q as T,j as e,d as u,aH as N,am as F,L as R,C as A,o as k,p as E,Z as G,ap as I,l as d,au as D,aq as M,n as b,A as m,E as $,_ as C}from"./index-CDk-Jgvr.js";import{P as O,a as B,b as H}from"./PageMain-Docc5lp9.js";import{u as _}from"./useRoles-BvJMVkR7.js";import{G as q}from"./GroupFilter-BbfosWSu.js";import{L as V}from"./constants-DRKgEQ0k.js";import{u as y}from"./useGetInstances-B7Kg5hSx.js";const ue={title:"",parent:f},de=x().shape({title:p().required("This field is required"),parent:p().required("This field is required")}),z="_container_xswdx_1",U="_searchContainer_xswdx_11",g={container:z,searchContainer:U},Q=()=>{const{search:s,setPageParams:a}=j(),t=()=>{a({search:o.values.searchText})},i=()=>{a({search:""})},o=T({initialValues:{searchText:s},enableReinitialize:!0,validationSchema:x().shape({search:p()}),onSubmit:t}),n=N.groupBy.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:g.container,children:[e.jsx("div",{className:g.searchContainer,children:e.jsx(u.Form,{onSubmit:o.handleSubmit,noValidate:!0,children:e.jsx(u.SearchBox,{autocomplete:"off",externallyControlled:!0,value:o.values.searchText,onChange:async c=>await o.setFieldValue("searchText",c),placeholder:"Search",onSearch:t,onClear:i})})}),e.jsx(q,{label:"Group by",options:n},"group-by-filter")]}),e.jsx(F,{filtersToDisplay:["search"]})]})},Y=({accessGroup:s})=>{const{instancesCount:a,isGettingInstances:t}=y({query:`access-group: ${s.name}`,with_alerts:!0,with_upgrades:!0,limit:1});return t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"u-off-screen",children:"Loading..."}),e.jsx(u.Spinner,{"aria-hidden":!0})]}):a?e.jsxs(R,{to:`/instances?accessGroups=${s.name}`,children:[a," ",A(a,"instance")]}):"0 instances"},Z=({accessGroup:s,parentAccessGroupTitle:a})=>{const t=k(),{notify:i}=E(),{removeAccessGroupQuery:o}=_(),{value:n,setTrue:c,setFalse:l}=G(),{instancesCount:r=0}=y({query:`access-group: ${s.name}`,with_alerts:!0,with_upgrades:!0,limit:1}),{mutateAsync:L,isPending:h}=o,w=async()=>{try{await L({name:s.name}),i.success({title:`You have successfully deleted the "${s.title}" access group.`,message:`All entities in this access group will now belong to "${a}".`})}catch(P){t(P)}finally{l()}};return e.jsxs(e.Fragment,{children:[e.jsx(I,{toggleAriaLabel:`${s.title} access group actions`,destructiveActions:[{icon:"delete",label:"Delete","aria-label":`Delete "${s.title}" access group`,onClick:c}]}),n&&e.jsxs(u.ConfirmationModal,{title:`Deleting ${s.title} access group`,confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:h,confirmButtonLoading:h,onConfirm:w,close:l,children:[r>0&&e.jsxs("p",{children:["Removing this access group will affect ",r," ",A(r,"instance"),'. They will now belong to "',a,'".']}),e.jsxs("p",{children:["This action is ",e.jsx("b",{children:"irreversible"})]})]})]})},J=s=>{const a={};switch(s.column.id){case"title":a.role="rowheader";break;case"name":a["aria-label"]="Name";break;case"instancesCount":a["aria-label"]="Instances count";break;case"parent":a["aria-label"]="Parent";break;case"id":a["aria-label"]="Actions";break}return a},S=(s,a)=>{const t=a.find(i=>i.name===s);return t&&t.parent?[t,...S(t.parent,a)]:t?[t]:[]},v=(s,a)=>a.filter(t=>t.parent===s).map(t=>({...t,instancesCount:0,subRows:v(t.name,a)})),K=({accessGroups:s})=>{const{groupBy:a,search:t}=j(),i=d.useMemo(()=>{const n=t?s.filter(r=>r.name.toLowerCase().includes(t.toLowerCase())||r.title.toLowerCase().includes(t.toLowerCase())):s;if(a!=="parent")return n.map(r=>({...r,instancesCount:0}));const c=Array.from(new Set([...n,...n.flatMap(r=>S(r.parent||"",s))])),l=new Set(c.filter(r=>r.parent).map(r=>r.name));return c.filter(r=>!l.has(r.name)).map(r=>({...r,instancesCount:0,subRows:v(r.name,c)}))},[s,t,a]),o=d.useMemo(()=>[{accessor:"title",Header:"title",Cell:({row:n})=>e.jsx("div",{style:{paddingLeft:`${n.depth*1.25}rem`},children:e.jsx("span",{children:n.original.title})})},{accessor:"name",Header:"name"},{accessor:"instancesCount",Header:"affected instances",sortType:(n,c)=>n.original.instancesCount-c.original.instancesCount,Cell:({row:n})=>e.jsx(Y,{accessGroup:n.original})},{accessor:"parent",Header:"parent",Cell:({row:{original:n}})=>s.find(l=>l.name===n.parent)?.title||e.jsx(D,{})},{...V,Cell:({row:n})=>{if(n.original.name===f)return null;const c=s.find(l=>l.name===n.original.parent)?.title||n.original.parent;return e.jsx(Z,{accessGroup:n.original,parentAccessGroupTitle:c})}}],[a,s]);return e.jsx(M,{columns:o,data:i,sortable:!0,getCellProps:J,emptyMsg:"No access groups found according to your search parameters."})},W=d.lazy(()=>C(()=>import("./index-fU8Xm8EU.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6]))),X=()=>{const{getAccessGroupQuery:s}=_(),{setSidePanelContent:a}=b(),{data:t,isPending:i}=s(),o=t?.data||[],n=()=>{a("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(m,{}),children:e.jsx(W,{})}))};return e.jsxs(e.Fragment,{children:[i&&e.jsx(m,{}),!i&&o.length===0&&e.jsx($,{title:"No access groups found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any access groups yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/access-groups",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage access groups in Landscape"})]}),cta:[e.jsx(u.Button,{appearance:"positive",onClick:n,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),!i&&o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{}),e.jsx(K,{accessGroups:o})]})]})},ee="_header_1676f_1",se={header:ee},ae=d.lazy(()=>C(()=>import("./index-fU8Xm8EU.js").then(s=>s.a),__vite__mapDeps([0,1,2,3,4,5,6])).then(s=>({default:s.NewAccessGroupForm}))),te=()=>{const{setSidePanelContent:s}=b(),a=()=>{s("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(m,{}),children:e.jsx(ae,{})}))};return e.jsxs(O,{children:[e.jsx(B,{className:se.header,title:"Access groups",actions:[e.jsx(u.Button,{appearance:"positive",onClick:a,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),e.jsx(H,{children:e.jsx(X,{})})]})},pe=Object.freeze(Object.defineProperty({__proto__:null,default:te},Symbol.toStringTag,{value:"Module"}));export{X as A,ue as I,de as V,pe as i};
