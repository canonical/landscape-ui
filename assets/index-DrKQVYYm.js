const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C7lbxh5k.js","assets/index-vDh6p1re.js","assets/index-CjWED4RU.css","assets/usePageParams-C-pi3Kin.js","assets/index-CS00h_Ig.js","assets/TablePagination-s2q42wYR.js","assets/TablePaginationBase-eH-xceTk.js","assets/TablePaginationBase-CJl3HN1X.css","assets/StatusFilter-kNfNcZ7x.js","assets/TableFilter-D9jMhOmC.js","assets/TableFilter-CNw_lMaf.css","assets/TableFilterChips-BgTfFgZ3.js","assets/TableFilterChips-CHqetGbX.css","assets/useFetchOld-Dh4_z9Or.js","assets/NoData-ClqjzLea.js","assets/index-CRv_aeRB.css","assets/useInstances-Df27HUCE.js","assets/index-DlELVwax.css","assets/index-DRqKRre0.js","assets/SidePanelFormButtons-CrzoUcfJ.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/SidePanelTablePagination-IeAfxzKG.js","assets/ScriptsTabs-qWvYCBab.js","assets/TruncatedCell-BRtEnS33.js","assets/TruncatedCell-CoXbu3VM.css","assets/HeaderWithSearch-DZAyAsgS.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-CCmNm2LP.js","assets/ScriptsTabs-CNG6qEx6.css","assets/useRoles-Cobv-tGH.js","assets/index-BwtZ1ers.css","assets/index-BiORki2R.js","assets/AssociationBlock-CzH1Y_Vz.js","assets/MultiSelectField-CYc5ErpZ.js","assets/MultiSelectField-GyNA33om.css","assets/AssociationBlock-OuvPxND7.css","assets/formikErrors-Bw8iTXYS.js","assets/index-Co2G9FLO.css","assets/index-CpIbZVEm.js","assets/DeliveryBlock-B1OGDxaW.js","assets/DeliveryBlock-VExRkUer.css","assets/index-DGU8gor5.js","assets/CodeEditor-CohnhYYz.js","assets/CodeEditor-CwlLRp3p.css","assets/ScriptFormAttachments-BEZtL0vU.js"])))=>i.map(i=>d[i]);
import{f as _,c as N,d as E,e as F,s as w,r as m,j as t,h as p,M as K,g as U,L as W,n as J,D,o as g,_ as j,E as $}from"./index-vDh6p1re.js";import{u as B,h as k}from"./usePageParams-C-pi3Kin.js";import{S as Q}from"./StatusFilter-kNfNcZ7x.js";import{T as Z}from"./TableFilterChips-BgTfFgZ3.js";import{H as X}from"./HeaderWithSearch-DZAyAsgS.js";import{T as tt}from"./TablePagination-s2q42wYR.js";import{u as et}from"./ScriptsTabs-qWvYCBab.js";import"./index-CCmNm2LP.js";import{N as A}from"./NoData-ClqjzLea.js";const st=()=>{const e=_(),i=N(),{isPending:a,mutateAsync:o}=E({mutationFn:async n=>e.post("script-profiles",n),onSuccess:async()=>i.invalidateQueries({queryKey:["scriptProfiles"]})});return{isAddingScriptProfile:a,addScriptProfile:o}},it=()=>{const e=_(),i=N(),{isPending:a,mutateAsync:o}=E({mutationFn:async({id:n})=>e.post(`script-profiles/${n}:archive`),onSuccess:async()=>i.invalidateQueries({queryKey:["scriptProfiles"]})});return{isArchivingScriptProfile:a,archiveScriptProfile:o}},rt=()=>{const e=_(),i=N(),{isPending:a,mutateAsync:o}=E({mutationFn:async({id:n,...u})=>e.patch(`script-profiles/${n}`,u),onSuccess:async()=>i.invalidateQueries({queryKey:["scriptProfiles"]})});return{isEditingScriptProfile:a,editScriptProfile:o}},nt=()=>{const e=_(),{data:i,isLoading:a}=F({queryKey:["scriptProfileLimits"],queryFn:async()=>e.get("script-profile-limits")});return{scriptProfileLimits:(i==null?void 0:i.data)??null,isGettingScriptProfileLimits:a}},at={listenToUrlParams:!0},R=(e,i)=>{const a=_(),{currentPage:o,pageSize:n,status:u,search:c}=B();e={...at,...e};const s={...e.listenToUrlParams?{limit:n,offset:(o-1)*n,search:c??void 0,archived:u||"all"}:i},{data:l,isLoading:f}=F({queryKey:["scriptProfiles",s],queryFn:async()=>a.get("script-profiles",{params:s})});return{scriptProfiles:(l==null?void 0:l.data.results)??[],scriptProfilesCount:(l==null?void 0:l.data.count)??0,isGettingScriptProfiles:f}},ot=(e,i={enabled:!0})=>{const a=_(),{data:o,isPending:n}=F({queryKey:["scriptProfiles","single",e],queryFn:async()=>a.get(`script-profiles/${e.id}`),...i});return{scriptProfile:o==null?void 0:o.data,isGettingScriptProfile:n}},h={MINUTE:{min:0,max:59},HOUR:{min:0,max:23},DAY_OF_MONTH:{min:1,max:31},MONTH:{min:1,max:12},DAY_OF_WEEK:{min:0,max:6}},ct=e=>{switch(e%100){case 11:case 12:case 13:return"th"}switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},lt=e=>`${e}${ct(e)}`,b=(e,i)=>i?i.labels[i.offset?e-i.offset:e]:e,G=(e,i)=>e.start==i.min&&e.end==i.max&&e.step==1,v=(e,i,a,o,n)=>{let u="";if(e.some(s=>G(s,i)))return u;o&&(u+=` ${o} `);const c=e.map(s=>{let l="";return(s.step>1||s.start!=s.end)&&(l+="every "),s.step>1&&(l+=`${lt(s.step)} `),s.start!=s.end||s.step>1?(l+=a,(s.start!=i.min||s.end!=i.max)&&(l+=` from ${b(s.start,n)} through ${b(s.end,n)}`)):n?l+=b(s.start,n):l+=`${a} ${s.start}`,l});return u+=c.slice(0,-1).join(", "),c.length>2&&(u+=","),c.length>1&&(u+=" and "),u+=c.slice(-1),u},C=e=>{const i=parseFloat(e);if(!Number.isSafeInteger(i))throw new Error("Invalid value.");return i},S=(e,i,a={})=>e.split(",").map(o=>{const n={start:Number.NaN,end:Number.NaN,step:1},u=c=>{if(c=="*"){n.start=i.min,n.end=i.max;return}if(c=c.replaceAll(/[a-zA-Z]+/g,s=>{const l=a[s.toUpperCase()];if(!l)throw new Error("Invalid character.");return l}),c.includes("-")){const[s,l]=c.split("-").map(C);if(l<s)throw new Error("The end of a range must not be less than the start.");n.start=s,n.end=l}else{const s=C(c);n.start=s,n.end=s}};if(o.includes("/")){const[c,s]=o.split("/");n.step=C(s),u(c)}else u(o);if(n.start<i.min||n.end>i.max)throw new Error("Value out of range.");return n}),ut=e=>{const[i,a,o,n,u]=e.trim().split(/ +/);if(!i||!a||!o||!n||!u)throw new Error("Enter a complete interval.");const c=S(i,h.MINUTE),s=S(a,h.HOUR),l=S(o,h.DAY_OF_MONTH),f=S(n,h.MONTH,{JAN:"1",FEB:"2",MAR:"3",APR:"4",MAY:"5",JUN:"6",JUL:"7",AUG:"8",SEP:"9",OCT:"10",NOV:"11",DEC:"12"}),r=S(u,h.DAY_OF_WEEK,{SUN:"0",MON:"1",TUE:"2",WED:"3",THU:"4",FRI:"5",SAT:"6"});let d="at ";c.some(T=>G(T,h.MINUTE))&&(d+="every minute"),c.length==1&&c[0].start==c[0].end&&s.length==1&&s[0].start==s[0].end?d+=`${s[0].start.toString().padStart(2,"0")}:${c[0].start.toString().padStart(2,"0")}`:(d+=v(c,h.MINUTE,"minute"),d+=v(s,h.HOUR,"hour","past"));const y=v(l,h.DAY_OF_MONTH,"day-of-month","on");return d+=y,d+=v(r,h.DAY_OF_WEEK,"day-of-week",y?"and on":"on",{labels:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}),d+=v(f,h.MONTH,"month","in",{offset:1,labels:["January","February","March","April","May","June","July","August","September","October","November","December"]}),d},dt=e=>e.archived?"Archived":"Active",Y=e=>{switch(e.trigger.trigger_type){case"event":switch(e.trigger.event_type){case"post_enrollment":return"Post enrollment";default:return}case"one_time":return"On a date";case"recurring":return"Recurring"}},Rt=e=>{switch(e.trigger.trigger_type){case"recurring":return`Recurring, ${ut(e.trigger.interval)}`;default:return Y(e)}},pt="_confirmationPrompt_sd4td_1",mt={confirmationPrompt:pt},ht=({profile:e,removeProfile:i})=>{const{notify:a}=w(),{archiveScriptProfile:o,isArchivingScriptProfile:n}=it(),[u,c]=m.useState("");if(!e)return;const s=()=>{i(),c("")},l=async()=>{e&&(await o({...e}),s(),a.success({title:`You have successfully archived ${e.title}`,message:"The profile will no longer run on the defined schedule."}))};return t.jsxs(p.ConfirmationModal,{title:`Archive ${e.title}`,confirmButtonLabel:"Archive",confirmButtonDisabled:u!=`archive ${e.title}`||n,confirmButtonLoading:n,onConfirm:l,close:s,children:[t.jsxs("p",{children:["Archiving the script will prevent it from running in the future.",t.jsx("br",{}),"This action is ",t.jsx("strong",{children:"irreversible"}),"."]}),t.jsxs("p",{className:mt.confirmationPrompt,children:["Type ",t.jsxs("strong",{children:["archive ",e.title]})," to confirm."]}),t.jsx(p.Input,{type:"text",value:u,autoComplete:"off",placeholder:`archive ${e.title}`,onChange:f=>{c(f.target.value)}})]})},ft="_actions_1jpiy_1",gt="_menu_1jpiy_5",yt="_toggleButton_1jpiy_10",xt="_archive_1jpiy_15",_t="_link_1jpiy_19",x={actions:ft,menu:gt,toggleButton:yt,archive:xt,link:_t};function Pt(e){const{state:i}=K(),a=(i==null?void 0:i.scriptProfileId)||0,{scriptProfile:o}=ot({id:a},{enabled:!!a});m.useEffect(()=>{!a||!o||(e(o),window.history.replaceState({},""))},[a,o])}const vt=m.lazy(async()=>j(()=>import("./index-C7lbxh5k.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))),St=m.lazy(async()=>j(()=>import("./index-DRqKRre0.js"),__vite__mapDeps([18,1,2,19,20,21,4,3,5,6,7,8,9,10,11,12,13,14,15,22,23,24,25,26,27,28,29,30,31,32,33]))),jt=m.lazy(async()=>j(()=>import("./index-BiORki2R.js"),__vite__mapDeps([34,1,2,35,36,37,16,13,38,19,20,21,23,5,3,6,7,14,24,25,8,9,10,11,12,26,27,28,29,30,31,39,40]))),Tt=({profiles:e})=>{const{notify:i}=w(),{setSidePanelContent:a}=U(),{editScriptProfile:o,isEditingScriptProfile:n}=rt(),[u,c]=m.useState(null),s=r=>({archive:()=>{c(r)},edit:()=>{const d=async y=>{o({id:r.id,...y})};a(`Edit ${r.title}`,t.jsx(m.Suspense,{fallback:t.jsx(g,{}),children:t.jsx(jt,{disabledFields:{script_id:!0,trigger_type:!0},initialValues:{...r,interval:"",start_after:"",timestamp:"",...r.trigger},onSubmit:d,onSuccess:y=>{i.success({title:`You have successfully saved changes for ${y.title}`,message:"The changes will be applied to this profile."})},submitButtonText:"Save changes",submitting:n})}))},viewDetails:()=>{a(r.title,t.jsx(m.Suspense,{fallback:t.jsx(g,{}),children:t.jsx(St,{actions:s(r),profile:r})}))}});Pt(r=>{s(r).viewDetails()});const l=m.useMemo(()=>[{Header:"Name",Cell:({row:{original:r}})=>t.jsx(p.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top u-align-text--left",onClick:s(r).viewDetails,children:r.title})},{Header:"Status",Cell:({row:{original:r}})=>dt(r),getCellIcon:({row:{original:{archived:r}}})=>r?"status-queued-small":"status-succeeded-small"},{Header:"Associated instances",Cell:({row:{original:r}})=>r.computers.num_associated_computers?t.jsxs(W,{className:x.link,to:{pathname:"/instances",search:`?tags=${r.tags.join("%2C")}`},children:[r.computers.num_associated_computers," instances"]}):t.jsx(A,{})},{Header:"Tags",Cell:({row:{original:r}})=>r.all_computers?"All instances":r.tags.join(", ")||t.jsx(A,{})},{Header:"Trigger",Cell:({row:{original:r}})=>Y(r)},{Header:"Last run",Cell:({row:{original:{activities:{last_activity:r},...d}}})=>r?t.jsxs(p.Button,{type:"button",appearance:"link",className:J("u-no-margin u-no-padding--top u-align-text--left",x.link),onClick:()=>{a(`${d.title} - ${k(r.creation_time).format(D)}`,t.jsx(m.Suspense,{fallback:t.jsx(g,{}),children:t.jsx(vt,{activityId:r.id})}))},children:[k(r.creation_time).utc().format(D)," "]}):t.jsx(A,{})},{className:x.actions,Header:"Actions",Cell:({row:{original:r}})=>{const d=[{children:t.jsxs(t.Fragment,{children:[t.jsx(p.Icon,{name:"switcher-environments"}),t.jsx("span",{children:"View details"})]}),hasIcon:!0,onClick:s(r).viewDetails}];return r.archived||d.push({children:t.jsxs(t.Fragment,{children:[t.jsx(p.Icon,{name:"edit"}),t.jsx("span",{children:"Edit"})]}),hasIcon:!0,onClick:s(r).edit},{children:t.jsxs(t.Fragment,{children:[t.jsx(p.Icon,{name:"archive--negative"}),t.jsx("span",{className:"u-text--negative",children:"Archive"})]}),hasIcon:!0,onClick:s(r).archive,className:x.archive}),t.jsx(p.ContextualMenu,{className:x.menu,toggleAppearance:"base",toggleClassName:x.toggleButton,toggleLabel:t.jsx(p.Icon,{name:"contextual-menu"}),links:d})}}],[]),f=()=>{c(null)};return t.jsxs(t.Fragment,{children:[t.jsx(p.ModularTable,{columns:l,data:e,emptyMsg:"No script profiles found according to your search parameters."}),t.jsx(ht,{profile:u,removeProfile:f})]})},At="_actions_dhdem_1",bt={actions:At},H=[{label:"All",value:""},{label:"Active",value:"active"},{label:"Archived",value:"archived"}],Ct=m.lazy(async()=>j(()=>import("./index-CpIbZVEm.js"),__vite__mapDeps([41,23,1,2,5,3,6,7,14,24,25,8,9,10,11,12,26,27,28,29,30,31,19,20,21,42,13,43,32,39,44,45,46,47])).then(e=>({default:e.CreateScriptForm}))),Nt=m.lazy(async()=>j(()=>import("./index-BiORki2R.js"),__vite__mapDeps([34,1,2,35,36,37,16,13,38,19,20,21,23,5,3,6,7,14,24,25,8,9,10,11,12,26,27,28,29,30,31,39,40]))),Et=()=>{const{notify:e}=w(),{currentPage:i,pageSize:a,search:o,status:n}=B(),{setSidePanelContent:u}=U(),{scriptsCount:c,isScriptsLoading:s}=et(),{scriptProfiles:l,scriptProfilesCount:f,isGettingScriptProfiles:r}=R(),{addScriptProfile:d,isAddingScriptProfile:y}=st(),{scriptProfilesCount:T,isGettingScriptProfiles:O}=R({listenToUrlParams:!1},{archived:"active"}),{scriptProfileLimits:P,isGettingScriptProfileLimits:M}=nt(),I=i===1&&a===20&&r;if(O||M||P===null)return t.jsx(g,{});const q=()=>{u("Add script profile",t.jsx(m.Suspense,{fallback:t.jsx(g,{}),children:t.jsx(Nt,{initialValues:{all_computers:!1,interval:"",start_after:"",tags:[],time_limit:300,timestamp:"",title:"",trigger_type:"",username:"root"},onSubmit:d,onSuccess:V=>{e.success({title:`You have successfully created ${V.title}`,message:"The profile has been created and associated to the defined instances."})},submitButtonText:"Add profile",submitting:y})}))};if(O||M)return t.jsx(g,{});if(P==null)return;const L=t.jsxs(p.Button,{type:"button",appearance:"positive",onClick:q,className:"u-no-margin--bottom",hasIcon:!0,disabled:T>=P.max_num_profiles,children:[t.jsx(p.Icon,{name:"plus",light:!0}),t.jsx("span",{children:"Add profile"})]});if(l.length||o||n||I)return t.jsxs(t.Fragment,{children:[t.jsx(X,{actions:t.jsxs("div",{className:bt.actions,children:[t.jsx(Q,{options:H}),L]})}),t.jsx(Z,{filtersToDisplay:["search","status"],statusOptions:H}),T>=P.max_num_profiles&&t.jsxs(p.Notification,{inline:!0,title:"Profile limit reached:",severity:"caution",children:["You've reached the limit of"," ",P.max_num_profiles," active script profiles. To be able to add new profiles you must archive an active one."]}),I?t.jsx(g,{}):t.jsxs(t.Fragment,{children:[t.jsx(Tt,{profiles:l}),t.jsx(tt,{totalItems:f,currentItemCount:l.length})]})]});if(s)return t.jsx(g,{});const z=()=>{u("Add script",t.jsx(m.Suspense,{fallback:t.jsx(g,{}),children:t.jsx(Ct,{})}))};return c?t.jsx($,{title:"You don't have any script profiles yet",body:t.jsxs(t.Fragment,{children:[t.jsx("p",{children:"Script profiles allow you to automate your script runs based on triggers. Triggers can be either a recurring schedule, on a set date, or before or after an event."}),L]})}):t.jsx($,{title:"You need at least one script to add a profile",body:t.jsxs(t.Fragment,{children:[t.jsx("p",{children:"In order to create a script profile, you need to have added a script to your Landscape organization."}),t.jsxs(p.Button,{type:"button",appearance:"positive",onClick:z,className:"u-no-margin--bottom",hasIcon:!0,children:[t.jsx(p.Icon,{name:"plus",light:!0}),t.jsx("span",{children:"Add script"})]})]})})},Ht=Object.freeze(Object.defineProperty({__proto__:null,default:Et},Symbol.toStringTag,{value:"Module"}));export{Rt as a,dt as g,Ht as i,ut as t,nt as u};
