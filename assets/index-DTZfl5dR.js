import{j as e,W as x,B as f,X as h,b as P,a as A,F as E,K as j,Y as S,O as g,d as p,q as _,Z as T}from"./index-P16xpB1n.js";import{A as y}from"./AuthTemplate-qkyR0TFC.js";import{A as L}from"./AvailableProviderList-Cc0DT29t.js";const F=({methods:a})=>{if(!a)return null;const t=!!(a.standalone_oidc.available&&a.standalone_oidc.enabled),r=!!(a.ubuntu_one.available&&a.ubuntu_one.enabled),n=!!(a.password.available&&a.password.enabled),c=!!(a.pam.available&&a.pam.enabled),b=a.oidc.available?a.oidc.configurations.filter(({enabled:l})=>l):[],u=n||c,m=r||t||a.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[u&&e.jsx(W,{isIdentityAvailable:c}),m&&e.jsx(L,{isStandaloneOidcEnabled:t,isUbuntuOneEnabled:r,oidcProviders:b}),!u&&!m&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},q="_buttonRow_f3s21_1",O={buttonRow:q},W=({isIdentityAvailable:a})=>{const[t]=x(),r=f(),{signInWithEmailAndPasswordQuery:n}=h(),{redirectToExternalUrl:c,setAuthLoading:b,setUser:u}=P(),m=A(),l=t.get("redirect-to"),v=t.has("external"),{mutateAsync:w}=n,s=E({initialValues:{email:"",password:""},validationSchema:j().shape({email:a?g().required("This field is required"):g().required("This field is required").matches(/^[a-zA-Z0-9-_.]+@[a-zA-Z0-9-.]*[a-zA-Z]$/,"Please provide a valid email address").test({message:"Please provide a valid email address",test:d=>{if(d.match(/\.\./))return!1;const[i,o]=d.split("@");return!(!i||!o||i.startsWith(".")||i.endsWith(".")||!o.includes(".")||o.startsWith(".")||o.startsWith("-")||o.match(/\.-/)||o.match(/-\./))}}),password:g().required("This field is required")}),onSubmit:async d=>{try{const{data:i}=await w({email:d.email,password:d.password});v&&l?c(l,{replace:!0}):("current_account"in i&&(b(!0),u(i)),m(l??S,{replace:!0}))}catch(i){r(i)}}});return e.jsxs(p.Form,{onSubmit:s.handleSubmit,children:[e.jsx(p.Input,{type:"text",label:a?"Identity":"Email",error:s.touched.email&&s.errors.email?s.errors.email:void 0,...s.getFieldProps("email"),"data-testid":"email"}),e.jsx(p.PasswordToggle,{id:"password",label:"Password",error:s.touched.password&&s.errors.password?s.errors.password:void 0,...s.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:O.buttonRow,children:e.jsx(p.Button,{type:"submit",appearance:"positive",disabled:s.isSubmitting||!s.isValid,className:"u-no-margin--bottom",children:"Sign in"})})]})},N=()=>{const{getLoginMethodsQuery:a}=h(),{data:t,isLoading:r,isError:n}=a();return e.jsx(y,{title:"Sign in to Landscape",children:r?e.jsx(_,{}):n?e.jsx("p",{className:"u-no-margin--bottom",children:T}):e.jsx(F,{methods:(t==null?void 0:t.data)??null})})};export{N as default};
