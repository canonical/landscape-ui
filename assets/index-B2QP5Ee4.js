const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B1p-rbLv.js","assets/index-D5hCAEXL.js","assets/index-BJ2QPnO2.css","assets/SidePanelTablePagination-DUDSBiUc.js","assets/Blocks-CzigTbc5.js","assets/Blocks-bdK2PNd9.css","assets/ScriptsTabs-ctloiW2E.js","assets/TruncatedCell-Bau-94An.js","assets/TruncatedCell-DraJKZqh.css","assets/useRoles-C9UVlt5o.js","assets/HeaderWithSearch-cawzUFjI.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-CHr_lV9Y.js","assets/useExpandableRow-BA4CittQ.js","assets/ScriptsTabs-DN44MVZt.css","assets/index-CpGGN5YE.css","assets/index-Cd3OyDLa.js","assets/AssociationBlock-fDPmauRn.js","assets/MultiSelectField-ceY1GdF2.js","assets/MultiSelectField-CD3NDVCz.css","assets/useGetTags-D2MlCcyh.js","assets/AssociationBlock-vsPH8fvb.css","assets/SidePanelFormButtons-CPNoBpWE.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/useGetInstances-BBmTXThU.js","assets/ScriptDropdown-4EXv7F3x.js","assets/downshift.esm-BzeYsFtr.js","assets/ScriptDropdown-DwZ4WXvX.css","assets/index-Cl-VVVj9.css","assets/index-CjuU2Fr0.js","assets/DeliveryBlock-DYVyxKwd.js","assets/DeliveryBlock-VExRkUer.css","assets/index-I8298NCz.js","assets/CodeEditor-B3fPJpJg.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-B63dKR93.js","assets/AttachmentFile-v7VdQzAl.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css"])))=>i.map(i=>d[i]);
import{b as v,e as O,f as F,g as L,h as D,aA as G,i as g,q as M,j as e,O as Y,aC as A,a6 as B,v as z,n as R,al as W,d as P,L as K,B as T,D as V,av as J,aw as Q,w as y,aa as j,_ as w,E as $,az as Z,a0 as X,aB as tt}from"./index-D5hCAEXL.js";import{u as et}from"./ScriptsTabs-ctloiW2E.js";import"./index-CHr_lV9Y.js";import{u as st}from"./useExpandableRow-BA4CittQ.js";import{T as it}from"./TruncatedCell-Bau-94An.js";import{H as rt}from"./HeaderWithSearch-cawzUFjI.js";const at=()=>{const t=v(),s=O(),{isPending:o,mutateAsync:i}=F({mutationFn:async n=>t.post("script-profiles",n),onSuccess:async()=>s.invalidateQueries({queryKey:["scriptProfiles"]})});return{isAddingScriptProfile:o,addScriptProfile:i}},nt=()=>{const t=v(),s=O(),{isPending:o,mutateAsync:i}=F({mutationFn:async({id:n})=>t.post(`script-profiles/${n}:archive`),onSuccess:async()=>s.invalidateQueries({queryKey:["scriptProfiles"]})});return{isArchivingScriptProfile:o,archiveScriptProfile:i}},ot=()=>{const t=v(),s=O(),{isPending:o,mutateAsync:i}=F({mutationFn:async({id:n,...u})=>t.patch(`script-profiles/${n}`,u),onSuccess:async()=>s.invalidateQueries({queryKey:["scriptProfiles"]})});return{isEditingScriptProfile:o,editScriptProfile:i}},k=()=>{const t=v(),{data:s,isLoading:o}=L({queryKey:["scriptProfileLimits"],queryFn:async()=>t.get("script-profile-limits")});return{scriptProfileLimits:s?.data??null,isGettingScriptProfileLimits:o}},ct={listenToUrlParams:!0},N=(t,s)=>{const o=v(),{currentPage:i,pageSize:n,status:u,search:l}=D();t={...ct,...t};const a={...t.listenToUrlParams?{limit:n,offset:(i-1)*n,search:l??void 0,archived:u||"active"}:s},{data:c,isPending:h}=L({queryKey:["scriptProfiles",a],queryFn:async()=>o.get("script-profiles",{params:a})});return{scriptProfiles:c?.data.results??[],scriptProfilesCount:c?.data.count,isGettingScriptProfiles:h}},lt=(t,s={enabled:!0})=>{const o=v(),{data:i,isPending:n}=L({queryKey:["scriptProfiles","single",t],queryFn:async()=>o.get(`script-profiles/${t.id}`),...s});return{scriptProfile:i?.data,isGettingScriptProfile:n}},m={MINUTE:{min:0,max:59},HOUR:{min:0,max:23},DAY_OF_MONTH:{min:1,max:31},MONTH:{min:1,max:12},DAY_OF_WEEK:{min:0,max:6}},ut=t=>{switch(t%100){case 11:case 12:case 13:return"th"}switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},dt=t=>`${t}${ut(t)}`,C=(t,s)=>s?s.labels[s.offset?t-s.offset:t]:t,U=(t,s)=>t.start==s.min&&t.end==s.max&&t.step==1,x=(t,s,o,i,n)=>{let u="";if(t.some(a=>U(a,s)))return u;i&&(u+=` ${i} `);const l=t.map(a=>{let c="";return(a.step>1||a.start!=a.end)&&(c+="every "),a.step>1&&(c+=`${dt(a.step)} `),a.start!=a.end||a.step>1?(c+=o,(a.start!=s.min||a.end!=s.max)&&(c+=` from ${C(a.start,n)} through ${C(a.end,n)}`)):n?c+=C(a.start,n):c+=`${o} ${a.start}`,c});return u+=l.slice(0,-1).join(", "),l.length>2&&(u+=","),l.length>1&&(u+=" and "),u+=l.slice(-1),u},E=t=>{const s=parseFloat(t);if(!Number.isSafeInteger(s))throw new Error("Invalid value.");return s},b=(t,s,o={})=>t.split(",").map(i=>{const n={start:Number.NaN,end:Number.NaN,step:1},u=l=>{if(l=="*"){n.start=s.min,n.end=s.max;return}if(l=l.replaceAll(/[a-zA-Z]+/g,a=>{const c=o[a.toUpperCase()];if(!c)throw new Error("Invalid character.");return c}),l.includes("-")){const[a,c]=l.split("-").map(E);if(c<a)throw new Error("The end of a range must not be less than the start.");n.start=a,n.end=c}else{const a=E(l);n.start=a,n.end=a}};if(i.includes("/")){const[l,a]=i.split("/");n.step=E(a),u(l)}else u(i);if(n.start<s.min||n.end>s.max)throw new Error("Value out of range.");return n}),pt=t=>{const[s,o,i,n,u]=t.trim().split(/ +/);if(!s||!o||!i||!n||!u)throw new Error("Enter a complete interval.");const l=b(s,m.MINUTE),a=b(o,m.HOUR),c=b(i,m.DAY_OF_MONTH),h=b(n,m.MONTH,{JAN:"1",FEB:"2",MAR:"3",APR:"4",MAY:"5",JUN:"6",JUL:"7",AUG:"8",SEP:"9",OCT:"10",NOV:"11",DEC:"12"}),f=b(u,m.DAY_OF_WEEK,{SUN:"0",MON:"1",TUE:"2",WED:"3",THU:"4",FRI:"5",SAT:"6"});let d="at ";l.some(r=>U(r,m.MINUTE))&&(d+="every minute"),l.length==1&&l[0].start==l[0].end&&a.length==1&&a[0].start==a[0].end?d+=`${a[0].start.toString().padStart(2,"0")}:${l[0].start.toString().padStart(2,"0")}`:(d+=x(l,m.MINUTE,"minute"),d+=x(a,m.HOUR,"hour","past"));const S=x(c,m.DAY_OF_MONTH,"day-of-month","on");return d+=S,d+=x(f,m.DAY_OF_WEEK,"day-of-week",S?"and on":"on",{labels:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}),d+=x(h,m.MONTH,"month","in",{offset:1,labels:["January","February","March","April","May","June","July","August","September","October","November","December"]}),d},mt=t=>t.archived?"Archived":"Active",H=t=>{switch(t.trigger.trigger_type){case"event":switch(t.trigger.event_type){case"post_enrollment":return"Post enrollment";default:return}case"one_time":return"On a date";case"recurring":return"Recurring"}},It=t=>{switch(t.trigger.trigger_type){case"recurring":return`Recurring, ${pt(t.trigger.interval)}`;default:return H(t)}};function gt(t){const{state:s}=G(),o=s?.scriptProfileId||0,{scriptProfile:i}=lt({id:o},{enabled:!!o});g.useEffect(()=>{!o||!i||(t(i),window.history.replaceState({},""))},[o,i])}const ft=({profile:t,removeProfile:s})=>{const{notify:o}=M(),{archiveScriptProfile:i,isArchivingScriptProfile:n}=nt(),u=()=>{s()},l=async()=>{await i({...t}),u(),o.success({title:`You have successfully archived "${t.title}"`,message:"The profile will no longer run on the defined schedule."})};return e.jsx(Y,{isOpen:!0,title:`Archive ${t.title}`,confirmButtonLabel:"Archive",confirmButtonDisabled:n,confirmButtonLoading:n,onConfirm:l,close:u,confirmationText:`archive ${t.title}`,children:e.jsxs("p",{children:["Archiving the script will prevent it from running in the future.",e.jsx("br",{}),"This action is ",e.jsx("strong",{children:"irreversible"}),"."]})})},ht=({scriptProfile:t})=>!t.tags.length&&!t.all_computers?e.jsx(A,{}):t.trigger.trigger_type==="event"&&t.trigger.event_type==="post_enrollment"?e.jsx(A,{}):t.computers.num_associated_computers?e.jsxs(B,{to:{pathname:"/instances",search:`query=${encodeURIComponent(`profile:script:${t.id}`)}`},children:[t.computers.num_associated_computers," ",z(t.computers.num_associated_computers,"instance")]}):"0 instances",_t=t=>({column:s,row:{index:o}})=>{const i={};switch(s.id){case"title":i.role="rowheader";break;case"archived":i["aria-label"]="Status";break;case"all_computers":i["aria-label"]="Associated instances";break;case"tags":i["aria-label"]="Tags",t===o&&(i.className="expandedCell");break;case"trigger":i["aria-label"]="Trigger";break;case"activities.last_activity.creation_time":i["aria-label"]="Last run";break;case"actions":i["aria-label"]="Actions";break}return i},yt=t=>({index:s,original:o})=>{const i={};return t===s&&(i.className="expandedRow"),i["aria-label"]=`${o.title} script profile row`,i},St=g.lazy(async()=>w(()=>import("./index-B1p-rbLv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))),Pt=g.lazy(async()=>w(()=>import("./index-Cd3OyDLa.js"),__vite__mapDeps([18,1,2,19,20,21,22,23,24,25,26,27,6,7,8,9,10,11,12,13,14,15,16,28,29,30,31]))),vt=({profiles:t})=>{const{notify:s}=M(),{setSidePanelContent:o}=R(),{expandedRowIndex:i,handleExpand:n,getTableRowsRef:u}=st(),{editScriptProfile:l,isEditingScriptProfile:a}=ot(),[c,h]=g.useState(null),f=r=>({archive:()=>{h(r)},edit:()=>{const _=async p=>{await l({id:r.id,all_computers:p.all_computers,tags:p.tags,time_limit:p.time_limit,title:p.title,trigger:p.trigger,username:p.username})};o(`Edit ${r.title}`,e.jsx(g.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(Pt,{disabledFields:{script_id:!0,trigger_type:!0},initialValues:{...r,interval:"",...r.trigger,start_after:r.trigger.trigger_type=="recurring"?T(r.trigger.start_after).utc().format(j):"",timestamp:r.trigger.trigger_type=="one_time"?T(r.trigger.timestamp).utc().format(j):""},onSubmit:_,onSuccess:p=>{s.success({title:`You have successfully saved changes for ${p.title}`,message:"The changes will be applied to this profile."})},submitButtonText:"Save changes",submitting:a})}))},viewDetails:()=>{o(r.title,e.jsx(g.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(St,{actions:f(r),profile:r})}))}});gt(r=>{f(r).viewDetails()});const d=g.useMemo(()=>[{Header:"Title",accessor:"title",Cell:({row:{original:r}})=>e.jsx(P.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top u-align-text--left",onClick:f(r).viewDetails,children:r.title})},{Header:"Status",accessor:"archived",Cell:({row:{original:r}})=>mt(r),getCellIcon:({row:{original:{archived:r}}})=>r?"status-queued-small":"status-succeeded-small"},{Header:"Associated instances",accessor:"all_computers",Cell:({row:{original:r}})=>e.jsx(ht,{scriptProfile:r})},{Header:"Tags",accessor:"tags",Cell:({row:{original:r,index:_}})=>r.all_computers?"All instances":r.tags.length===0?e.jsx(A,{}):e.jsx(it,{content:r.tags.map(p=>e.jsx("span",{className:"truncatedItem",children:p},p)),isExpanded:_==i,onExpand:()=>{n(_)},showCount:!0})},{Header:"Trigger",accessor:"trigger",Cell:({row:{original:r}})=>H(r)},{Header:"Last run",accessor:"activities.last_activity.creation_time",className:"date-cell",Cell:({row:{original:{activities:{last_activity:r}}}})=>r?e.jsxs(K,{className:"font-monospace",to:`/activities?query=parent-id%3A${r.id}`,children:[T(r.creation_time).utc().format(V)," "]}):e.jsx(A,{})},{...W,Cell:({row:{original:r}})=>{const _=[{icon:"show",label:"View details",onClick:f(r).viewDetails}];r.archived||_.push({icon:"edit",label:"Edit",onClick:f(r).edit});const p=r.archived?void 0:[{icon:"archive",label:"Archive",onClick:f(r).archive}];return e.jsx(J,{toggleAriaLabel:`${r.title} script profile actions`,actions:_,destructiveActions:p})}}],[i]),S=()=>{h(null)};return e.jsxs("div",{ref:u,children:[e.jsx(Q,{columns:d,data:t,emptyMsg:"No script profiles found according to your search parameters.",getCellProps:_t(i),getRowProps:yt(i),minWidth:1200}),c&&e.jsx(ft,{profile:c,removeProfile:S})]})},xt=g.lazy(async()=>w(()=>import("./index-CjuU2Fr0.js"),__vite__mapDeps([32,6,1,2,7,8,9,10,11,12,13,14,15,16,24,25,26,33,34,28,29,30,35,36,37,38,39,40,41])).then(t=>({default:t.CreateScriptForm}))),bt=()=>{const{setSidePanelContent:t}=R(),s=()=>{t("Add script",e.jsx(g.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(xt,{})}))};return e.jsx($,{title:"You need at least one script to add a profile.",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"In order to create a script profile, you need to have added a script to your Landscape organization."}),e.jsxs(P.Button,{type:"button",appearance:"positive",onClick:s,className:"u-no-margin--bottom",hasIcon:!0,children:[e.jsx(P.Icon,{name:"plus",light:!0}),e.jsx("span",{children:"Add script"})]})]})})},Tt=g.lazy(async()=>w(()=>import("./index-Cd3OyDLa.js"),__vite__mapDeps([18,1,2,19,20,21,22,23,24,25,26,27,6,7,8,9,10,11,12,13,14,15,16,28,29,30,31]))),q=({appearance:t})=>{const{notify:s}=M(),{setSidePanelContent:o}=R(),{addScriptProfile:i,isAddingScriptProfile:n}=at(),{scriptProfilesCount:u}=N({listenToUrlParams:!1},{archived:"active"}),{scriptProfileLimits:l}=k(),a=()=>{o("Add script profile",e.jsx(g.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(Tt,{initialValues:{all_computers:!1,interval:"",start_after:T().utc().format(j),tags:[],time_limit:300,timestamp:T().utc().format(j),title:"",trigger_type:"",username:"root",script:null},onSubmit:async c=>{await i({all_computers:c.all_computers,script_id:c.script_id,tags:c.tags,time_limit:c.time_limit,title:c.title,trigger:c.trigger,username:c.username})},onSuccess:c=>{s.success({title:`You have successfully created ${c.title}`,message:"The profile has been created and associated to the defined instances."})},submitButtonText:"Add profile",submitting:n})}))};return e.jsxs(P.Button,{type:"button",appearance:t,onClick:a,className:"u-no-margin--bottom",hasIcon:!0,disabled:(u??0)>=(l?.max_num_profiles??0),children:[e.jsx(P.Icon,{name:"plus",light:t==="positive"}),e.jsx("span",{children:"Add profile"})]})},At=()=>e.jsx($,{title:"You don't have any script profiles yet.",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Script profiles allow you to automate your script runs based on triggers. Triggers can be either a recurring schedule, on a set date, or before or after an event."}),e.jsx(q,{appearance:"positive"})]})}),I=[{label:"All",value:"all"},{label:"Active",value:""},{label:"Archived",value:"archived"}],jt="_actions_dhdem_1",wt={actions:jt},Ct=()=>e.jsxs(e.Fragment,{children:[e.jsx(rt,{actions:e.jsxs("div",{className:wt.actions,children:[e.jsx(Z,{label:"Status",options:I}),e.jsx(q,{})]})}),e.jsx(X,{filtersToDisplay:["search","status"],statusOptions:I})]}),Et=()=>{const{currentPage:t,pageSize:s,search:o,status:i}=D(),{scriptsCount:n,isScriptsLoading:u}=et({listenToUrlParams:!1},{script_type:"active",limit:0,offset:0}),{scriptProfiles:l,scriptProfilesCount:a,isGettingScriptProfiles:c}=N(),{scriptProfilesCount:h,isGettingScriptProfiles:f}=N({listenToUrlParams:!1},{archived:"active"}),{scriptProfileLimits:d,isGettingScriptProfileLimits:S}=k(),r=t===1&&s===20&&c;return f||S||d===null?e.jsx(y,{}):l.length||o||i||r?e.jsxs(e.Fragment,{children:[e.jsx(Ct,{}),h&&h>=d.max_num_profiles&&e.jsxs(P.Notification,{inline:!0,title:"Profile limit reached:",severity:"caution",children:["You've reached the limit of"," ",d.max_num_profiles," active script profiles. To be able to add new profiles you must archive an active one."]}),c?e.jsx(y,{}):e.jsx(vt,{profiles:l}),e.jsx(tt,{totalItems:a,currentItemCount:l.length})]}):u?e.jsx(y,{}):n?e.jsx(At,{}):e.jsx(bt,{})},Dt=Object.freeze(Object.defineProperty({__proto__:null,default:Et},Symbol.toStringTag,{value:"Module"}));export{ht as S,It as a,mt as g,Dt as i,pt as t,k as u};
