const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-3XjMd1uJ.js","assets/index-BhA4J3ko.js","assets/index-DWaf_ZwL.css","assets/useInstances-C6H1-Kjx.js","assets/PageMain-BGNK0xG-.js","assets/PageMain-BIuYvhUI.css","assets/useMutation-D6hW2Vr2.js","assets/useFetchOld-5foHVBsZ.js","assets/index.esm-B8rBEOcC.js","assets/SidePanelFormButtons-7JkHrlOz.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/useRoles-Db1B50uX.js","assets/index-D3bjac_c.js","assets/CodeEditor-DeXfNykg.js","assets/CodeEditor-CA89WJcJ.css","assets/useConfirm-CiNGk-W0.js","assets/EmptyState-C71tSpTG.js","assets/EmptyState-DUn4ZRie.css","assets/moment-C5S46NFB.js","assets/index-CE4J0A4y.css"])))=>i.map(i=>d[i]);
import{j as e,i as I,a0 as ne,r as i,h as n,a1 as ae,M as oe,l as M,e as J,g as re,B as ie,_ as X,a as le,n as ce,f as de,R as U}from"./index-BhA4J3ko.js";import{u as B}from"./useInstances-C6H1-Kjx.js";import{a as ee,c as ue,d as me}from"./index.esm-B8rBEOcC.js";import{I as pe}from"./InfoItem-CWs2RNzA.js";import{u as he}from"./WslInstancesHeader-DVFBVFkw.js";import{u as xe}from"./useConfirm-CiNGk-W0.js";import{u as _e}from"./useRoles-Db1B50uX.js";import{h as W}from"./moment-C5S46NFB.js";import{m as Z}from"./moment-ik4I3HqO.js";import{N as v}from"./NoData-JiBvrZwJ.js";import"./PageMain-BGNK0xG-.js";import"./useMutation-D6hW2Vr2.js";import"./useFetchOld-5foHVBsZ.js";import"./EmptyState-C71tSpTG.js";import"./HeaderWithSearch-DjV1i2rB.js";import"./usePageParams-Cx4Fh8yG.js";const fe="_infoContainer_1ca11_1",ge="_amount_1ca11_9",Y={infoContainer:fe,amount:ge},je=({isExpanded:t,overflowingChipsAmount:s})=>s>0&&!t&&e.jsx("div",{className:Y.infoContainer,children:e.jsx("span",{className:I("u-text--muted",Y.amount),children:`+${s}`})}),be=({containerRef:t,onDismiss:s,onOverflowingItemsAmountChange:r,tagData:l})=>{const h=()=>{if(!t.current)return;const o=t.current.querySelectorAll("span.p-chip");r(Array.from(o).filter(({offsetHeight:m,offsetTop:u})=>u>m).length)};return ne("resize",h),i.useEffect(()=>{h()},[l.length]),l.map(o=>e.jsx(n.Chip,{value:o,onDismiss:()=>s(o)},o))},ve="_container_1f6mu_1",Ie="_list_1f6mu_6",ye="_listItem_1f6mu_11",we="_search_1f6mu_17",E={container:ve,list:Ie,listItem:ye,search:we},Ce=({onTagClick:t,tags:s})=>s.length?e.jsxs("div",{className:E.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Tags"}),e.jsx("ul",{className:I("p-list--divided u-no-margin--bottom",E.list),children:s.map(r=>e.jsx("li",{children:e.jsx("div",{className:E.listItem,children:e.jsx(n.Button,{appearance:"base",className:E.search,onClick:()=>t(r),children:r})})},r))})]}):null,Ne="_container_fqj7b_1",Se="_prompt_fqj7b_10",Ae="_saveButton_fqj7b_17",V={container:Ne,prompt:Se,saveButton:Ae},Re=({onTagAdd:t,search:s})=>e.jsx(e.Fragment,{children:s&&e.jsxs("div",{className:V.container,children:[e.jsxs("span",{className:V.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:s}),e.jsx("span",{children:"..."})]}),e.jsx(n.Button,{type:"button",appearance:"link",onClick:t,className:V.saveButton,children:"Add tag"})]})}),K=ee().matches(/^[a-zA-Z]/,{message:"Tag must starts with a letter",excludeEmptyString:!0}).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,{message:"Tag can only contain letters, numbers, hyphens, and underscores",excludeEmptyString:!0}),Te="_searchContainer_pn88d_1",ke="_box_pn88d_5",Ee="_inputContainer_pn88d_10",De="_inputError_pn88d_15",D={searchContainer:Te,box:ke,inputContainer:Ee,inputError:De},Be=({onTagsChange:t,tags:s,label:r,labelClassName:l,required:h})=>{var H;const[o,m]=i.useState(""),[u,x]=i.useState(""),[c,g]=i.useState(!1),[j,N]=i.useState(""),[f,y]=i.useState(!1),[L,$]=i.useState(0),{height:w}=ae(),[O,S]=i.useState({top:"100%",bottom:"auto"}),{getAllInstanceTagsQuery:P}=B(),A=i.useRef(null),p=i.useRef(null);i.useEffect(()=>{if(!p.current)return;const a=p.current.querySelector("input");a&&N(a.id)},[p.current]),i.useEffect(()=>{!f||!p.current||z()},[w,f,p.current,(H=p.current)==null?void 0:H.clientHeight]);const z=()=>{if(!p.current)return;const{top:a,height:_}=p.current.getBoundingClientRect();a+_+379<w?S({top:"100%",bottom:"auto"}):S({top:"auto",bottom:"100%"})},R=()=>{y(!1)};oe(A,R);const F=a=>{t(s.filter(_=>_!==a))},{data:C,isLoading:T}=P(),d=i.useMemo(()=>C?!o&&!s.length?C.data.results:C.data.results.filter(a=>!s.includes(a)).filter(a=>a.toLowerCase().includes(o.trim().toLowerCase())):[],[C,o,s]),k=a=>{t([...s,a])},Q=()=>{if(o.trim())try{const a=K.validateSync(o.trim())??"";k(a),m(""),x(""),g(!1)}catch(a){a instanceof Error&&(x(a.message),g(!0))}},te=a=>{if(m(a.target.value),c)try{K.validateSync(a.target.value),x("")}catch(_){_ instanceof Error&&x(_.message)}},se=a=>{const{key:_}=a;f?(_==="Escape"&&R(),_==="Enter"&&Q()):_==="Enter"&&y(!0)};return e.jsxs("div",{children:[e.jsx("label",{className:I("p-form__label",{"is-required":h},l),htmlFor:j,children:r||"Tags"}),e.jsxs("div",{className:"p-search-and-filter",ref:A,children:[e.jsxs("div",{className:I("p-search-and-filter__search-container",D.searchContainer),"aria-expanded":f,ref:p,onClick:()=>y(!0),children:[e.jsx(be,{containerRef:p,onDismiss:F,onOverflowingItemsAmountChange:a=>$(a),tagData:s}),e.jsx("div",{className:I("p-search-and-filter__box",D.box),children:e.jsx("div",{className:D.inputContainer,children:e.jsx(n.Input,{type:"text",autoComplete:"off",value:o,onChange:te,placeholder:"Add tags",className:"u-no-margin--bottom",onClick:()=>y(!0),onKeyUp:se,wrapperClassName:u?"is-error":"","aria-errormessage":u?`${j}-error`:void 0,"aria-invalid":!!u})})}),u&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:I("p-form-validation__message",D.inputError),id:`${j}-error`,children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:u})]})}),e.jsx(je,{isExpanded:f,overflowingChipsAmount:L})]}),f&&T&&e.jsx(M,{}),f&&!T&&e.jsxs("div",{className:"p-search-and-filter__panel",style:O,children:[e.jsx(Re,{onTagAdd:Q,search:o}),e.jsx(Ce,{onTagClick:k,tags:d})]})]})]})},Le={deliver_after:"",deliverImmediately:!0},$e=ue().shape({deliver_after:ee().when("deliverImmediately",{is:!1,then:t=>t.required("This field is required").test({message:"Invalid date",test:s=>W(s).isValid()}).test({message:"Date must be in the future",test:s=>W(s).isAfter()})}),deliverImmediately:me()}),q={shutdown:{ctaLabel:"Shutdown",getDescription:t=>`This will shut down "${t}" instance.`,title:"Shut down instance"},reboot:{ctaLabel:"Restart",getDescription:t=>`This will restart "${t}" instance.`,title:"Restart instance"}},Oe="_wrapper_30z1x_1",Pe="_input_30z1x_5",G={wrapper:Oe,input:Pe},ze=({action:t,instance:s,onClose:r})=>{const l=J(),{rebootInstancesQuery:h,shutdownInstancesQuery:o}=B(),{mutateAsync:m}=h,{mutateAsync:u}=o,c=re({initialValues:Le,onSubmit:async g=>{const j={computer_ids:[s.id],deliver_after:g.deliverImmediately?void 0:`${g.deliver_after}:00Z`};try{t==="reboot"?await m(j):await u(j)}catch(N){l(N)}finally{r()}},validationSchema:$e});return e.jsx(n.Form,{onSubmit:c.handleSubmit,noValidate:!0,children:e.jsx(n.Modal,{title:q[t].title,close:r,buttonRow:e.jsx(n.Button,{type:"submit",appearance:"negative",disabled:c.isSubmitting,children:q[t].ctaLabel}),children:e.jsxs("div",{className:G.wrapper,children:[e.jsx(n.CheckboxInput,{label:"Deliver as soon as possible",...c.getFieldProps("deliverImmediately"),checked:c.values.deliverImmediately}),e.jsx(n.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:G.input,placeholder:"Scheduled time",...c.getFieldProps("deliver_after"),disabled:c.values.deliverImmediately,error:c.touched.deliver_after&&c.errors.deliver_after?c.errors.deliver_after:void 0}),e.jsx("p",{children:q[t].getDescription(s.title)})]})})})},Fe=t=>{var r;const s=(r=t.grouped_hardware)==null?void 0:r.network;return!Array.isArray(s)||s.length===0?e.jsx(v,{}):s.filter(({ip:l})=>l!=="Not available").map(({ip:l})=>l).join(", ")||e.jsx(v,{})},Ve=(t,s)=>{var r,l,h;return[{label:"instance ID",value:t.id},{label:"Hostname",value:t.hostname},{label:"IP Address",value:Fe(t)},{label:"Serial number",value:((r=t.grouped_hardware)==null?void 0:r.system.serial)??e.jsx(v,{})},{label:"Product identifier",value:((l=t.grouped_hardware)==null?void 0:l.system.model)??e.jsx(v,{})},{label:"Distribution",value:t.distribution??"Unknown"},{label:"Access group",value:((h=s.find(({value:o})=>o===t.access_group))==null?void 0:h.label)||t.access_group},{label:"Last ping time",value:t.last_ping_time&&Z(t.last_ping_time).isValid()?Z(t.last_ping_time).format(ie):e.jsx(v,{})},{label:"Annotations",value:t.annotations?Object.entries(t.annotations).map(([o,m],u,x)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:`${o}: ${m}`}),u<x.length-1&&e.jsx("br",{})]})):e.jsx(v,{})},{label:"Comment",value:t.comment||e.jsx(v,{})}]},qe="_titleRow_lxk0r_1",Me="_flexContainer_lxk0r_6",Qe="_italic_lxk0r_11",He="_infoRow_lxk0r_15",Ue="_tagSection_lxk0r_20",We="_tagsRow_lxk0r_25",Ze="_tagsButton_lxk0r_33",b={titleRow:qe,flexContainer:Me,italic:Qe,infoRow:He,tagSection:Ue,tagsRow:We,tagsButton:Ze},Ye=i.lazy(()=>X(()=>import("./index-3XjMd1uJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),Ke=i.lazy(()=>X(()=>import("./index-D3bjac_c.js").then(t=>t.i),__vite__mapDeps([13,1,2,14,15,9,10,11,16,4,5,6,7,17,18,12,19,8,20])).then(t=>({default:t.RunInstanceScriptForm}))),ht=({instance:t})=>{const[s,r]=i.useState(null),[l,h]=i.useState(t.tags),o=le(),m=J(),{notify:u}=ce(),{confirmModal:x,closeConfirmModal:c}=xe(),{setSidePanelContent:g}=de(),{removeInstancesQuery:j}=B(),{getAccessGroupQuery:N}=_e(),{deleteChildInstancesQuery:f}=he(),{editInstanceQuery:y}=B(),{mutateAsync:L}=y,$=async()=>{try{await L({instanceId:t.id,tags:l}),u.success({title:"Tags updated",message:`"${t.title}" instance tags have been updated successfully`})}catch(d){m(d)}},{data:w}=N(),O=(w==null?void 0:w.data.map(({name:d,title:k})=>({label:k,value:d})))??[],{mutateAsync:S,isPending:P}=j,A=async()=>{try{await S({computer_ids:[t.id]}),o(`${U}instances`,{replace:!0})}catch(d){m(d)}finally{c()}},p=()=>{x({title:"Remove instance from Landscape",body:e.jsxs("p",{children:["This will remove the instance ",e.jsx("b",{children:t.title})," from Landscape.",e.jsx("br",{}),e.jsx("br",{}),"It will remain on the parent machine. You can re-register it to Landscape at any time."]}),buttons:[e.jsx(n.Button,{appearance:"negative",onClick:A,children:"Remove"},"remove")]})},z=()=>{g("Edit Instance",e.jsx(i.Suspense,{fallback:e.jsx(M,{}),children:e.jsx(Ye,{instance:t})}))},R=()=>{g("Run script",e.jsx(i.Suspense,{fallback:e.jsx(M,{}),children:e.jsx(Ke,{query:`id:${t.id}`})}))},{mutateAsync:F}=f,C=async()=>{try{await F({computer_ids:[t.id]}),o(`${U}instances`,{replace:!0})}catch(d){m(d)}finally{c()}},T=async()=>{x({title:"Delete instance",body:e.jsxs("p",{children:["This will permanently delete the instance ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),buttons:[e.jsx(n.Button,{appearance:"negative",onClick:C,children:"Delete"},"delete")]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:b.titleRow,children:[e.jsxs("div",{className:b.flexContainer,children:[e.jsx("p",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:t.title}),t.is_wsl_instance&&e.jsx("p",{className:I("u-text--muted u-no-margin--bottom",b.italic),children:"WSL Instance"})]}),e.jsxs("div",{className:b.flexContainer,children:[t.is_wsl_instance&&e.jsx(n.Button,{type:"button",className:"u-no-margin--bottom u-no-margin--right",onClick:T,children:"Delete instance"}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:z,children:[e.jsx(n.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:R,children:[e.jsx(n.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:p,disabled:P,children:[e.jsx(n.Icon,{name:"delete"}),e.jsx("span",{children:"Remove from Landscape"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:()=>r("reboot"),children:[e.jsx(n.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:()=>r("shutdown"),children:[e.jsx(n.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]})]})},"buttons")]})]}),e.jsx("div",{className:b.infoRow,children:e.jsx(n.Row,{className:"u-no-padding--left u-no-padding--right u-no-max-width",children:Ve(t,O).map(d=>e.jsx(n.Col,{size:4,children:e.jsx(pe,{...d})},d.label))})}),e.jsx("div",{className:b.tagSection,children:e.jsxs(n.Row,{className:b.tagsRow,children:[e.jsx(n.Col,{size:4,children:e.jsx(Be,{labelClassName:"p-text--small p-text--small-caps u-text--muted",onTagsChange:d=>h(d),tags:l})}),e.jsx(n.Col,{size:2,className:b.tagsButton,children:e.jsx(n.Button,{type:"button",className:"u-no-margin--bottom",onClick:$,children:"Update"})})]})}),s&&e.jsx(ze,{action:s,instance:t,onClose:()=>r(null)})]})};export{ht as default};
