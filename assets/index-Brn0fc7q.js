import{j as e,r as j,f as y,y as P,h as l,q as E,x as I,a as O,t as U,k as N,n as w,R,o as T}from"./index-YVEwVKfb.js";import{u as A,A as L}from"./AuthTemplate-DGTouvMo.js";import{r as _}from"./helpers-Bo73Thd0.js";import{S as v}from"./constants-LFXGfoad.js";const k=({methods:s})=>{if(!s)return null;const a=!!(s.standalone_oidc.available&&s.standalone_oidc.enabled),i=!!(s.ubuntu_one.available&&s.ubuntu_one.enabled),r=!!(s.password.available&&s.password.enabled),c=!!(s.pam.available&&s.pam.enabled),u=s.oidc.available?s.oidc.configurations.filter(({enabled:b})=>b):[],n=r||c,m=i||a||s.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[n&&e.jsx(D,{isIdentityAvailable:c}),m&&e.jsx($,{isStandaloneOidcEnabled:a,isUbuntuOneEnabled:i,oidcProviders:u}),!n&&!m&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},B="_list_9u1s7_1",q="_button_9u1s7_20",F="_icon_9u1s7_28",d={list:B,button:q,icon:F},$=({isStandaloneOidcEnabled:s,isUbuntuOneEnabled:a,oidcProviders:i})=>{const[r,c]=j.useState(0),[u]=y(),{invitationId:n}=A(),{getOidcUrlQuery:m,getUbuntuOneUrlQuery:b}=P(),t=u.get("redirect-to"),g=u.has("external"),o={};r>0&&(o.id=r),t&&(o.return_to=t),n&&(o.invitation_id=n),g&&(o.external=!0);const{data:p}=m(o,{enabled:r!==0});j.useEffect(()=>{p&&_(p.data.location)},[p]);const x={};t&&(x.return_to=`${window.origin}${t}`),n&&(x.invitation_id=n),g&&(x.external=!0);const{data:f,refetch:S}=b(x,{enabled:!1});return j.useEffect(()=>{f&&_(f.data.location)},[f]),e.jsxs("ul",{className:d.list,children:[a&&e.jsx("li",{className:"p-list__item",children:e.jsxs(l.Button,{type:"button",hasIcon:!0,onClick:S,className:d.button,children:[e.jsx(l.Icon,{name:v["ubuntu-one"].icon,className:d.icon}),e.jsx("span",{children:"Sign in with Ubuntu One"})]})}),s&&e.jsx("li",{className:"p-list__item",children:e.jsxs(l.Button,{type:"button",hasIcon:!0,onClick:()=>c(-1),className:d.button,children:[e.jsx(l.Icon,{name:v["standalone-oidc"].icon,className:d.icon}),e.jsx("span",{children:"Sign in with Enterprise Login"})]})}),i.map(h=>e.jsx("li",{className:"p-list__item",children:e.jsxs(l.Button,{type:"button",hasIcon:!0,onClick:()=>c(h.id),className:d.button,children:[e.jsx(l.Icon,{name:v[h.provider].icon,className:d.icon}),e.jsx("span",{children:`Sign in with ${h.name}`})]})},h.id))]})},Q="_buttonRow_f3s21_1",C={buttonRow:Q},D=({isIdentityAvailable:s})=>{const[a]=y(),i=E(),{signInWithEmailAndPasswordQuery:r}=P(),{setUser:c}=I(),u=O(),n=a.get("redirect-to"),m=a.has("external"),{mutateAsync:b}=r,t=U({initialValues:{email:"",password:""},validationSchema:N().shape({email:s?w().required("This field is required"):w().required("This field is required").email("Please provide a valid email address"),password:w().required("This field is required")}),onSubmit:async g=>{try{const{data:o}=await b({email:g.email,password:g.password});if(m&&n)_(n,{replace:!0});else{"current_account"in o&&c(o);const p=new URL(n??`${R}overview`,location.origin);u(p.toString().replace(p.origin,""),{replace:!0})}}catch(o){i(o)}}});return e.jsxs(l.Form,{onSubmit:t.handleSubmit,children:[e.jsx(l.Input,{type:"text",label:s?"Identity":"Email",error:t.touched.email&&t.errors.email?t.errors.email:void 0,...t.getFieldProps("email"),"data-testid":"email"}),e.jsx(l.PasswordToggle,{id:"password",label:"Password",error:t.touched.password&&t.errors.password?t.errors.password:void 0,...t.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:C.buttonRow,children:e.jsx(l.Button,{type:"submit",appearance:"positive",disabled:t.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},J=()=>{const{getLoginMethodsQuery:s}=P(),{data:a,isLoading:i,isError:r,error:c}=s();return e.jsxs(L,{title:"Sign in to Landscape",children:[i??e.jsx(T,{}),!i&&r&&e.jsxs("div",{children:[e.jsx("h1",{children:"Error"}),e.jsx("pre",{children:JSON.stringify(c,null,2)})]}),!i&&!r&&e.jsx(k,{methods:(a==null?void 0:a.data)??null})]})};export{J as default};
