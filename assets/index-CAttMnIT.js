import{k as V,C as H,j as t,s as J,h as s,G as u}from"./index-B7TA2mEJ.js";import{h as p}from"./moment-C5S46NFB.js";import{I as a}from"./InfoItem-BGbjg2ci.js";import{u as K,a as j}from"./index-_nOAvVrS.js";import{u as W}from"./useInstances--U4VPfdG.js";import"./moment-XwcdBKy1.js";import"./TablePagination-DWlHKziY.js";import"./TablePagination.module-CgQ3jx4B.js";import"./usePageParams-BUsG_p4E.js";import"./SearchHelpPopup-DQ0iOBxi.js";import"./useFetchOld-CJ7nhgRY.js";import"./NoData-CEdbf9On.js";const X="_statusIcon_1efxa_1",Z="_output_1efxa_5",C={statusIcon:X,output:Z},pt=({activityId:f})=>{var v,A,b,h,x,g,_;const n=V(),{confirmModal:c,closeConfirmModal:l}=H(),{approveActivitiesQuery:I,cancelActivitiesQuery:k,getSingleActivityQuery:D,redoActivitiesQuery:w,undoActivitiesQuery:N}=K(),{getInstancesQuery:B}=W(),{mutateAsync:L,isPending:R}=I,{mutateAsync:T,isPending:z}=k,{mutateAsync:Q,isPending:S}=w,{mutateAsync:$,isPending:U}=N,{data:r,isLoading:m}=D({activityId:f}),e=r==null?void 0:r.data,{data:d}=B({query:`id:${e==null?void 0:e.computer_id}`,root_only:!1},{enabled:!!(e!=null&&e.computer_id)}),y=d&&d.data.results.length>0?d.data.results[0].title:"",E=async i=>{try{await L({query:`id:${i.id}`})}catch(o){n(o)}finally{l()}},P=i=>{c({title:"Approve activity",body:`Are you sure you want to approve ${i.summary} activity?`,buttons:[t.jsx(s.Button,{appearance:"positive",onClick:()=>E(i),children:"Approve"},"approve")]})},F=async i=>{try{await T({query:`id:${i.id}`})}catch(o){n(o)}finally{l()}},M=i=>{c({title:"Cancel activity",body:`Are you sure you want to cancel ${i.summary} activity?`,buttons:[t.jsx(s.Button,{appearance:"positive",onClick:()=>F(i),children:"Apply"},"cancel")]})},q=async i=>{try{await Q({activity_ids:[i.id]})}catch(o){n(o)}finally{l()}},O=i=>{c({title:"Redo activity",body:`Are you sure you want to redo ${i.summary} activity?`,buttons:[t.jsx(s.Button,{appearance:"positive",onClick:()=>q(i),children:"Redo"},"redo")]})},Y=async i=>{try{await $({activity_ids:[i.id]})}catch(o){n(o)}finally{l()}},G=i=>{c({title:"Undo activity",body:`Are you sure you want to undo ${i.summary} activity?`,buttons:[t.jsx(s.Button,{appearance:"positive",onClick:()=>Y(i),children:"Undo"},"undo")]})};return t.jsxs(t.Fragment,{children:[m&&t.jsx(J,{}),!m&&e&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[((v=e.actions)==null?void 0:v.approvable)&&t.jsx(s.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>P(e),disabled:R,children:"Approve"}),((A=e.actions)==null?void 0:A.cancelable)&&t.jsx(s.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>M(e),disabled:z,children:!((b=e.actions)!=null&&b.approvable)&&!((h=e.actions)!=null&&h.reappliable)&&!((x=e.actions)!=null&&x.revertable)?"Cancel activity":"Cancel"}),((g=e.actions)==null?void 0:g.revertable)&&t.jsx(s.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>G(e),disabled:U,children:"Undo"}),((_=e.actions)==null?void 0:_.reappliable)&&t.jsx(s.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>O(e),disabled:S,children:"Redo"})]})},"buttons"),t.jsxs(s.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(s.Col,{size:12,children:t.jsx(a,{label:"Description",value:e.summary})}),y&&t.jsx(s.Col,{size:12,children:t.jsx(a,{label:"Instance",value:y})}),t.jsx(s.Col,{size:6,children:t.jsx(a,{label:"Status",value:t.jsxs(t.Fragment,{children:[t.jsx(s.Icon,{name:j[e.activity_status].icon,className:C.statusIcon}),t.jsx("span",{children:j[e.activity_status].label})]})})}),t.jsx(s.Col,{size:6,children:t.jsx(a,{label:"Created at",value:p(e.creation_time).format(u)})}),typeof e.delivery_time=="string"&&t.jsx(s.Col,{size:6,children:t.jsx(a,{label:"Delivered at",value:p(e.delivery_time).format(u)})}),e.completion_time&&t.jsx(s.Col,{size:6,children:t.jsx(a,{label:"Completed at",value:p(e.completion_time).format(u)})}),e.result_text&&t.jsx(s.Col,{size:12,children:t.jsx(a,{label:"Output",type:"snippet",value:e.result_text,className:C.output})})]})]})]})};export{pt as default};
