const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CekuL2H1.js","assets/index-Bj3y1t-6.js","assets/index-D38JayDC.css","assets/UdebCheckboxInput-CGwqsW47.js","assets/UdebCheckboxInput-mCgCMP_S.css","assets/debug-DGcPR_wm.js","assets/useGPGKeys-CovwgpEt.js","assets/useFetchOld-BtTLYE3Q.js","assets/debug-CHNhm1j1.css","assets/MultiSelectField-BaWeYjGS.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-dpQcLrQ5.js","assets/SidePanelFormButtons.module-tJTvEwdD.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/formikErrors-Dz7WiKjY.js","assets/constants-kcq_ilI_.js","assets/usePageParams-CXSkxOFx.js","assets/NoData-D4e57A2j.js","assets/index-DQHzbw7N.js","assets/TablePagination-CdVMJYdj.js","assets/TablePaginationBase-CXsMC9fV.js","assets/TablePaginationBase-CJl3HN1X.css","assets/StatusFilter-DVQJH1hk.js","assets/TableFilter-Bt7vmO0n.js","assets/TableFilter-DXBG6q86.css","assets/TableFilterChips-D1Inrseb.js","assets/TableFilterChips-CHqetGbX.css","assets/index-geI-abAU.css","assets/constants-DhXkDRlN.css"])))=>i.map(i=>d[i]);
import{r as g,j as e,g as r,B as re,p as ie,f as le,m as L,n as F,_ as de}from"./index-Bj3y1t-6.js";import{S as ge}from"./SidePanelTablePagination-C9_fTFTY.js";import"./usePageParams-CXSkxOFx.js";import{f as me,p as ue}from"./constants-kcq_ilI_.js";import"./TablePaginationBase-CXsMC9fV.js";import"./useFetchOld-BtTLYE3Q.js";import"./NoData-D4e57A2j.js";import"./index-DQHzbw7N.js";import"./TablePagination-CdVMJYdj.js";import"./StatusFilter-DVQJH1hk.js";import"./TableFilter-Bt7vmO0n.js";import"./TableFilterChips-D1Inrseb.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new t.Error().stack;n&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[n]="66c51bc4-41fa-4566-9a8b-2c0cc39ff440",t._sentryDebugIdIdentifier="sentry-dbid-66c51bc4-41fa-4566-9a8b-2c0cc39ff440")}catch{}const fe="_version_sfav3_1",pe="_content_sfav3_5",A={version:fe,content:pe},he=({isUpload:t,packagesToShow:n,search:s,selectedPackages:l,setSelectedPackages:u})=>{const m=g.useMemo(()=>[{accessor:"packageName",Header:({rows:a})=>t?e.jsxs(e.Fragment,{children:[e.jsx(r.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),disabled:!a.length,indeterminate:!!l.length&&l.length<a.length,checked:l.length===a.length&&!!l.length,onChange:()=>{u(d=>d.length?[]:a.map((p,x)=>x))}}),e.jsx("span",{children:"Package"})]}):"Package",Cell:({row:a})=>t?e.jsx(r.CheckboxInput,{inline:!0,label:a.original.packageName,checked:l.includes(a.index),onChange:()=>{u(d=>d.includes(a.index)?d.filter(p=>p!==a.index):[...d,a.index])}}):a.original.packageName},{accessor:"packageVersion",Header:"Version",getCellIcon:({row:a})=>a.original.difference?"warning":!1,className:A.version,Cell:({row:a})=>a.original.difference?e.jsx(r.Tooltip,{position:"top-center",message:a.original.difference==="delete"?"Package deleted":`Version differs
from parent pocket.
Parent version:
${a.original.newVersion}`,children:e.jsx("span",{children:a.original.packageVersion})}):a.original.packageVersion}],[n,l.length]);return e.jsx(r.ModularTable,{columns:m,data:n,emptyMsg:s?`No packages found with the search: "${s}".`:void 0,className:A.content,getCellProps:({column:a})=>{switch(a.id){case"packageName":return{role:"rowheader"};case"packageVersion":return{"aria-label":"Version"};default:return{}}}})},Pe="_ctaRow_qlsck_1",ke={ctaRow:Pe},xe=g.lazy(async()=>de(()=>import("./index-CekuL2H1.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]))),k=1,Q=20,Ie=({distributionName:t,pocket:n,seriesName:s})=>{const[l,u]=g.useState(k),[m,a]=g.useState(Q),[d,p]=g.useState([]),[x,H]=g.useState(!1),[_,D]=g.useState(""),[b,j]=g.useState(""),V=re("(max-width: 619px)"),R=ie(),{setSidePanelContent:O,closeSidePanel:U}=le(),{listPocketQuery:q,diffPullPocketQuery:K,pullPackagesToPocketQuery:G,syncMirrorPocketQuery:J,removePackagesFromPocketQuery:W,removePocketQuery:X}=me(),{mutate:Y,isPending:B}=J,{mutate:Z,isPending:I}=G,N=()=>{n.mode==="mirror"?Y({name:n.name,series:s,distribution:t}):n.mode==="pull"&&Z({name:n.name,series:s,distribution:t})},ee=()=>{O(`Edit ${n.name} pocket`,e.jsx(g.Suspense,{fallback:e.jsx(F,{}),children:e.jsx(xe,{pocket:n,distributionName:t,seriesName:s})}))},{mutateAsync:ne,isPending:v}=X,te=async()=>{try{await ne({distribution:t,series:s,name:n.name}),U()}catch(o){R(o)}},{mutateAsync:ae,isPending:y}=W,T=!B&&!I&&!y&&!v,{data:S,isLoading:w}=q({name:n.name,series:s,distribution:t,search:b,limit:m,offset:l*m-m},{enabled:T}),C=(S==null?void 0:S.data)??{count:0,results:[]},f=C.results.map(o=>({packageName:o.name,packageVersion:o.version})),{data:$}=K({name:n.name,series:s,distribution:t},{enabled:n.mode==="pull"&&!w&&T}),E=($==null?void 0:$.data)??{},h=[];for(const o in E){const c={add:[],update:[],delete:[],...E[o]};for(const[i,P]of c.add)h.push({packageName:i,newVersion:P,difference:"add"});(c.update.length||c.delete.length)&&H(!0);for(const[i,,P]of c.update)h.push({packageName:i,newVersion:P,difference:"update"});for(const[i]of c.delete)h.push({packageName:i,difference:"delete",newVersion:""})}const oe=()=>x?(f.forEach((o,c)=>{const i=h.find(({packageName:P})=>o.packageName===P);i&&(f[c].difference=i.difference,i.newVersion!==""&&(f[c].newVersion=i.newVersion))}),[...f.filter(({difference:o})=>o),...f.filter(({difference:o})=>!o)]):f,M=g.useMemo(()=>oe(),[l,m,b,x,f.length,h.length]),se=async()=>{const o=M.filter((c,i)=>d.includes(i)).map(({packageName:c})=>c);try{await ae({name:n.name,series:s,distribution:t,packages:o})}catch(c){R(c)}},z=!b&&l===k&&m===Q&&!C.count,ce=n.mode==="upload"?{size:8,medium:4}:{size:6,medium:3};return e.jsxs(e.Fragment,{children:[e.jsxs(r.Row,{className:L("u-no-padding--left u-no-padding--right",ke.ctaRow),children:[e.jsx(r.Col,{...ce,children:e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[n.mode!=="upload"&&e.jsx(r.Button,{className:"p-segmented-control__button",type:"button",onClick:N,disabled:B&&I,"aria-label":n.mode==="mirror"?`Synchronize ${n.name} pocket of ${t}/${s}`:`Pull packages to ${n.name} pocket of ${t}/${s}`,children:n.mode==="mirror"?"Sync":"Pull"}),e.jsx(r.Button,{className:"p-segmented-control__button",type:"button",onClick:ee,"aria-label":`Edit ${n.name} pocket of ${t}/${s}`,children:"Edit"}),e.jsx(r.ConfirmationButton,{className:"p-segmented-control__button",type:"button","aria-label":`Remove ${n.name} pocket of ${t}/${s}`,confirmationModalProps:{title:"Deleting pocket",children:e.jsxs("p",{children:["Do you really want to delete ",n.name," pocket from"," ",s," series of ",t," distribution?"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:v,confirmButtonLoading:v,onConfirm:te},children:"Remove"}),n.mode==="upload"&&e.jsx(r.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:!d.length||y,"aria-label":`Remove selected packages from ${n.name} pocket of ${t}/${s}`,confirmationModalProps:{title:"Deleting packages from pocket",children:e.jsxs("p",{children:["This will delete ",d.length," selected"," ",ue(d.length,"package","packages")," ","from ",n.name," pocket ",s," series of"," ",t," distribution"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:y,confirmButtonLoading:y,onConfirm:se},children:"Remove packages"})]})})}),n.mode!=="upload"&&!z&&e.jsx(r.Col,{size:6,medium:3,children:e.jsx(r.Form,{onSubmit:o=>{o.preventDefault(),j(_),u(k)},noValidate:!0,children:e.jsx(r.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,"aria-label":"Package search",onChange:o=>{D(o)},value:_,onClear:()=>{D(""),j(""),u(k)},className:L({"is-dense":!V,"u-no-margin--bottom":V}),onSearch:()=>{j(_),u(k)},autocomplete:"off"})})})]}),w?e.jsx(F,{}):z?e.jsx("p",{children:"No packages found"}):e.jsxs(e.Fragment,{children:[e.jsx(he,{isUpload:n.mode==="upload",packagesToShow:M,search:b,selectedPackages:d,setSelectedPackages:p}),e.jsx(ge,{currentPage:l,totalItems:C.count,paginate:o=>{p([]),u(o)},pageSize:m,setPageSize:o=>{a(o)}})]})]})};export{Ie as default};
