import{r as i,z as ae,j as e,h as v,g as n,o as H,e as J,B as oe,_ as X,a as ie,l as re,f as le,R as W}from"./index-Dt7YhOS0.js";import{a as ee,u as ce}from"./useOnClickOutside-DG65LNAC.js";import{u as L}from"./useInstances-DayeQdIw.js";import{a as te,c as de,d as ue}from"./index.esm-Cy_yj1Qh.js";import{I as me}from"./InfoItem-Mj-XXzjC.js";import{u as pe}from"./WslInstanceList.module-BaNH1Ff4.js";import{u as he}from"./useConfirm-CR6bT57R.js";import{u as fe}from"./useRoles-C-Re2CJT.js";import{u as _e}from"./formik.esm-g8btJLb9.js";import{h as U}from"./moment-Cl4UOzQZ.js";import{m as Z}from"./moment-DcUn0hwS.js";import{N as S}from"./NoData-CLREO4dl.js";import"./useFetchOld-BGspy5lX.js";import"./useMutation-B0Ge1lYR.js";import"./useQuery-Dlf2yvOE.js";import"./InfoItem.module-BZ3tYMsb.js";import"./EmptyState-BG0AupYF.js";const xe=typeof window>"u";function ge(t={}){let{initializeWithValue:s=!0}=t;xe&&(s=!1);const[r,l]=i.useState(()=>{if(s)return{width:window.innerWidth,height:window.innerHeight}}),c=()=>{l({width:window.innerWidth,height:window.innerHeight})};return ee("resize",c),ae(()=>{c()},[]),r}const je="_infoContainer_1ca11_1",be="_amount_1ca11_9",Y={infoContainer:je,amount:be},ve=({isExpanded:t,overflowingChipsAmount:s})=>s>0&&!t&&e.jsx("div",{className:Y.infoContainer,children:e.jsx("span",{className:v("u-text--muted",Y.amount),children:`+${s}`})}),Ie=({containerRef:t,onDismiss:s,onOverflowingItemsAmountChange:r,tagData:l})=>{const c=()=>{if(!t.current)return;const o=t.current.querySelectorAll("span.p-chip");r(Array.from(o).filter(({offsetHeight:p,offsetTop:m})=>m>p).length)};return ee("resize",c),i.useEffect(()=>{c()},[l.length]),l.map(o=>e.jsx(n.Chip,{value:o,onDismiss:()=>s(o)},o))},we="_container_1f6mu_1",ye="_list_1f6mu_6",Ce="_listItem_1f6mu_11",Se="_search_1f6mu_17",D={container:we,list:ye,listItem:Ce,search:Se},Ne=({onTagClick:t,tags:s})=>s.length?e.jsxs("div",{className:D.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Tags"}),e.jsx("ul",{className:v("p-list--divided u-no-margin--bottom",D.list),children:s.map(r=>e.jsx("li",{children:e.jsx("div",{className:D.listItem,children:e.jsx(n.Button,{appearance:"base",className:D.search,onClick:()=>t(r),children:r})})},r))})]}):null,Re="_container_fqj7b_1",Te="_prompt_fqj7b_10",Ae="_saveButton_fqj7b_17",F={container:Re,prompt:Te,saveButton:Ae},Ee=({onTagAdd:t,search:s})=>e.jsx(e.Fragment,{children:s&&e.jsxs("div",{className:F.container,children:[e.jsxs("span",{className:F.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:s}),e.jsx("span",{children:"..."})]}),e.jsx(n.Button,{type:"button",appearance:"link",onClick:t,className:F.saveButton,children:"Add tag"})]})}),K=te().matches(/^[a-zA-Z]/,{message:"Tag must starts with a letter",excludeEmptyString:!0}).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,{message:"Tag can only contain letters, numbers, hyphens, and underscores",excludeEmptyString:!0}),De="_searchContainer_pn88d_1",ke="_box_pn88d_5",Le="_inputContainer_pn88d_10",ze="_inputError_pn88d_15",k={searchContainer:De,box:ke,inputContainer:Le,inputError:ze},Be=({onTagsChange:t,tags:s,label:r,labelClassName:l,required:c})=>{var Q;const[o,p]=i.useState(""),[m,f]=i.useState(""),[d,g]=i.useState(!1),[j,C]=i.useState(""),[x,I]=i.useState(!1),[z,B]=i.useState(0),{height:w}=ge(),[$,N]=i.useState({top:"100%",bottom:"auto"}),{getAllInstanceTagsQuery:O}=L(),R=i.useRef(null),h=i.useRef(null);i.useEffect(()=>{if(!h.current)return;const a=h.current.querySelector("input");a&&C(a.id)},[h.current]),i.useEffect(()=>{!x||!h.current||P()},[w,x,h.current,(Q=h.current)==null?void 0:Q.clientHeight]);const P=()=>{if(!h.current)return;const{top:a,height:_}=h.current.getBoundingClientRect();a+_+379<w?N({top:"100%",bottom:"auto"}):N({top:"auto",bottom:"100%"})},T=()=>{I(!1)};ce(R,T);const V=a=>{t(s.filter(_=>_!==a))},{data:y,isLoading:A}=O(),u=i.useMemo(()=>y?!o&&!s.length?y.data.results:y.data.results.filter(a=>!s.includes(a)).filter(a=>a.toLowerCase().includes(o.trim().toLowerCase())):[],[y,o,s]),E=a=>{t([...s,a])},M=()=>{if(o.trim())try{const a=K.validateSync(o.trim())??"";E(a),p(""),f(""),g(!1)}catch(a){a instanceof Error&&(f(a.message),g(!0))}},se=a=>{if(p(a.target.value),d)try{K.validateSync(a.target.value),f("")}catch(_){_ instanceof Error&&f(_.message)}},ne=a=>{const{key:_}=a;x?(_==="Escape"&&T(),_==="Enter"&&M()):_==="Enter"&&I(!0)};return e.jsxs("div",{children:[e.jsx("label",{className:v("p-form__label",{"is-required":c},l),htmlFor:j,children:r||"Tags"}),e.jsxs("div",{className:"p-search-and-filter",ref:R,children:[e.jsxs("div",{className:v("p-search-and-filter__search-container",k.searchContainer),"aria-expanded":x,ref:h,onClick:()=>I(!0),children:[e.jsx(Ie,{containerRef:h,onDismiss:V,onOverflowingItemsAmountChange:a=>B(a),tagData:s}),e.jsx("div",{className:v("p-search-and-filter__box",k.box),children:e.jsx("div",{className:k.inputContainer,children:e.jsx(n.Input,{type:"text",autoComplete:"off",value:o,onChange:se,placeholder:"Add tags",className:"u-no-margin--bottom",onClick:()=>I(!0),onKeyUp:ne,wrapperClassName:m?"is-error":"","aria-errormessage":m?`${j}-error`:void 0,"aria-invalid":!!m})})}),m&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:v("p-form-validation__message",k.inputError),id:`${j}-error`,children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:m})]})}),e.jsx(ve,{isExpanded:x,overflowingChipsAmount:z})]}),x&&A&&e.jsx(H,{}),x&&!A&&e.jsxs("div",{className:"p-search-and-filter__panel",style:$,children:[e.jsx(Ee,{onTagAdd:M,search:o}),e.jsx(Ne,{onTagClick:E,tags:u})]})]})]})},$e={deliver_after:"",deliverImmediately:!0},Oe=de().shape({deliver_after:te().when("deliverImmediately",{is:!1,then:t=>t.required("This field is required").test({message:"Invalid date",test:s=>U(s).isValid()}).test({message:"Date must be in the future",test:s=>U(s).isAfter()})}),deliverImmediately:ue()}),q={shutdown:{ctaLabel:"Shutdown",getDescription:t=>`This will shut down "${t}" instance.`,title:"Shut down instance"},reboot:{ctaLabel:"Restart",getDescription:t=>`This will restart "${t}" instance.`,title:"Restart instance"}},Pe="_wrapper_30z1x_1",Ve="_input_30z1x_5",G={wrapper:Pe,input:Ve},Fe=({action:t,instance:s,onClose:r})=>{const l=J(),{rebootInstancesQuery:c,shutdownInstancesQuery:o}=L(),{mutateAsync:p}=c,{mutateAsync:m}=o,d=_e({initialValues:$e,onSubmit:async g=>{const j={computer_ids:[s.id],deliver_after:g.deliverImmediately?void 0:`${g.deliver_after}:00Z`};try{t==="reboot"?await p(j):await m(j)}catch(C){l(C)}finally{r()}},validationSchema:Oe});return e.jsx(n.Form,{onSubmit:d.handleSubmit,noValidate:!0,children:e.jsx(n.Modal,{title:q[t].title,close:r,buttonRow:e.jsx(n.Button,{type:"submit",appearance:"negative",disabled:d.isSubmitting,children:q[t].ctaLabel}),children:e.jsxs("div",{className:G.wrapper,children:[e.jsx(n.CheckboxInput,{label:"Deliver as soon as possible",...d.getFieldProps("deliverImmediately"),checked:d.values.deliverImmediately}),e.jsx(n.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:G.input,placeholder:"Scheduled time",...d.getFieldProps("deliver_after"),disabled:d.values.deliverImmediately,error:d.touched.deliver_after&&d.errors.deliver_after?d.errors.deliver_after:void 0}),e.jsx("p",{children:q[t].getDescription(s.title)})]})})})},qe=(t,s)=>{var r,l,c;return[{label:"Last ping time",value:t.last_ping_time&&Z(t.last_ping_time).isValid()?Z(t.last_ping_time).format(oe):e.jsx(S,{})},{label:"Hostname",value:t.hostname},{label:"instance ID",value:t.id},{label:"Serial number",value:((r=t.grouped_hardware)==null?void 0:r.system.serial)??e.jsx(S,{})},{label:"Product identifier",value:((l=t.grouped_hardware)==null?void 0:l.system.model)??e.jsx(S,{})},{label:"Distribution",value:t.distribution??"Unknown"},{label:"Access group",value:((c=s.find(({value:o})=>o===t.access_group))==null?void 0:c.label)||t.access_group},{label:"Annotations",value:t.annotations?Object.entries(t.annotations).map(([o,p],m,f)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:`${o}: ${p}`}),m<f.length-1&&e.jsx("br",{})]})):e.jsx(S,{})},{label:"Comment",value:t.comment||e.jsx(S,{})}]},He="_titleRow_fznp8_1",Me="_flexContainer_fznp8_6",Qe="_italic_fznp8_11",We="_infoRow_fznp8_15",Ue="_tagSection_fznp8_20",Ze="_tagsRow_fznp8_25",Ye="_tagsButton_fznp8_33",b={titleRow:He,flexContainer:Me,italic:Qe,infoRow:We,tagSection:Ue,tagsRow:Ze,tagsButton:Ye},Ke=i.lazy(()=>X(()=>import("./index-CmejUdV5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),Ge=i.lazy(()=>X(()=>import("./index-C_GwVjC9.js").then(t=>t.i),__vite__mapDeps([13,1,2,3,9,10,11,14,5,6,7,15,16,12,17,8,18])).then(t=>({default:t.RunInstanceScriptForm}))),Je=({instance:t})=>{const[s,r]=i.useState(null),[l,c]=i.useState(t.tags),o=ie(),p=J(),{notify:m}=re(),{confirmModal:f,closeConfirmModal:d}=he(),{setSidePanelContent:g}=le(),{removeInstancesQuery:j}=L(),{getAccessGroupQuery:C}=fe(),{deleteChildInstancesQuery:x}=pe(),{editInstanceQuery:I}=L(),{mutateAsync:z}=I,B=async()=>{try{await z({instanceId:t.id,tags:l}),m.success({title:"Tags updated",message:`"${t.title}" instance tags have been updated successfully`})}catch(u){p(u)}},{data:w}=C(),$=(w==null?void 0:w.data.map(({name:u,title:E})=>({label:E,value:u})))??[],{mutateAsync:N,isLoading:O}=j,R=async()=>{try{await N({computer_ids:[t.id]}),o(`${W}instances`,{replace:!0})}catch(u){p(u)}finally{d()}},h=()=>{f({title:"Remove instance from Landscape",body:e.jsxs("p",{children:["This will remove the instance ",e.jsx("b",{children:t.title})," from Landscape.",e.jsx("br",{}),e.jsx("br",{}),"It will remain on the parent machine. You can re-register it to Landscape at any time."]}),buttons:[e.jsx(n.Button,{appearance:"negative",onClick:R,children:"Remove"},"remove")]})},P=()=>{g("Edit Instance",e.jsx(i.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(Ke,{instance:t})}))},T=()=>{g("Run script",e.jsx(i.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(Ge,{query:`id:${t.id}`})}))},{mutateAsync:V}=x,y=async()=>{try{await V({computer_ids:[t.id]}),o(`${W}instances`,{replace:!0})}catch(u){p(u)}finally{d()}},A=async()=>{f({title:"Delete instance",body:e.jsxs("p",{children:["This will permanently delete the instance ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),buttons:[e.jsx(n.Button,{appearance:"negative",onClick:y,children:"Delete"},"delete")]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:b.titleRow,children:[e.jsxs("div",{className:b.flexContainer,children:[e.jsx("p",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:t.title}),t.is_wsl_instance&&e.jsx("p",{className:v("u-text--muted u-no-margin--bottom",b.italic),children:"WSL Instance"})]}),e.jsxs("div",{className:b.flexContainer,children:[t.is_wsl_instance&&e.jsx(n.Button,{type:"button",className:"u-no-margin--bottom u-no-margin--right",onClick:A,children:"Delete instance"}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:P,children:[e.jsx(n.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:T,children:[e.jsx(n.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:h,disabled:O,children:[e.jsx(n.Icon,{name:"delete"}),e.jsx("span",{children:"Remove from Landscape"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:()=>r("reboot"),children:[e.jsx(n.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:()=>r("shutdown"),children:[e.jsx(n.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]})]})},"buttons")]})]}),e.jsx("div",{className:b.infoRow,children:e.jsx(n.Row,{className:"u-no-padding--left u-no-padding--right u-no-max-width",children:qe(t,$).map(u=>e.jsx(n.Col,{size:4,children:e.jsx(me,{...u})},u.label))})}),e.jsx("div",{className:b.tagSection,children:e.jsxs(n.Row,{className:b.tagsRow,children:[e.jsx(n.Col,{size:4,children:e.jsx(Be,{labelClassName:"p-text--small p-text--small-caps u-text--muted",onTagsChange:u=>c(u),tags:l})}),e.jsx(n.Col,{size:2,className:b.tagsButton,children:e.jsx(n.Button,{type:"button",className:"u-no-margin--bottom",onClick:B,children:"Update"})})]})}),s&&e.jsx(Fe,{action:s,instance:t,onClose:()=>r(null)})]})},xt=Je;export{xt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-CmejUdV5.js","assets/index-Dt7YhOS0.js","assets/index-BAlneFez.css","assets/formik.esm-g8btJLb9.js","assets/useInstances-DayeQdIw.js","assets/useFetchOld-BGspy5lX.js","assets/useMutation-B0Ge1lYR.js","assets/useQuery-Dlf2yvOE.js","assets/index.esm-Cy_yj1Qh.js","assets/SidePanelFormButtons-Cs6mvCpL.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/useRoles-C-Re2CJT.js","assets/index-C_GwVjC9.js","assets/useConfirm-CR6bT57R.js","assets/EmptyState-BG0AupYF.js","assets/EmptyState-BNXajmMK.css","assets/moment-Cl4UOzQZ.js","assets/index-CnWz5K0S.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
