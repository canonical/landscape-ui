import{j as e,r as _,Q as A,B,ao as K,d as f,p as N,q as R,C as V,m as Y,a2 as z,y}from"./index-D-slOBCE.js";import{S as M}from"./SidePanelFormButtons-h_5nkg-t.js";import{a as E}from"./useUsns-DPpW7cJK.js";import{D as G}from"./downshift.esm-D8AxhPNu.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";import"./ResponsiveButtons-BQd3E-Y1.js";const J=200,W=(s,l)=>{const a=s.toLowerCase(),c=l.toLowerCase(),n=a.indexOf(c);return n>=0?e.jsxs(e.Fragment,{children:[s.substring(0,n),e.jsx("strong",{children:s.substring(n,n+l.length)}),s.substring(n+l.length)]}):s},X="_container_113js_1",Z="_suggestionsContainer_113js_5",ee="_pointer_113js_12",te="_highlighted_113js_17",se="_selectedContainer_113js_21",m={container:X,suggestionsContainer:Z,pointer:ee,highlighted:te,selectedContainer:se},ne=({selectedItems:s,setSelectedItems:l})=>{var P;const[a,c]=_.useState(""),[n,i]=_.useState(!1),[r,p]=_.useState(""),{instanceId:j}=A(),S=B(),{getInstancePackagesQuery:k}=E(),C=Number(j),{data:u,isFetching:o}=k({instance_id:C,available:!0,installed:!1,upgrade:!1,held:!1,limit:50,search:a},{enabled:a.length>2}),d=((P=u==null?void 0:u.data)==null?void 0:P.results)??[],g=t=>!s.map(h=>h.name).includes(t.name),x=d.filter(g),T=t=>{l(s.filter(h=>h.name!==t))},$=()=>{i(!1)},v=()=>{p(""),c("")},I=()=>{r.length>2?i(!0):i(!1)},F=t=>{p(t),t.length>2&&c(t)},O=K(()=>{try{I()}catch(t){S(t)}},J),L=t=>{l([...s,t]),v()},Q=t=>{t&&(L(t),i(!1))},q=t=>{t.key==="Escape"?t.currentTarget.blur():O()},D=!n&&r.length<3?"Min 3. characters":d.length===0&&a&&!o?`No packages found by "${a}"`:null;return e.jsxs("div",{className:m.container,children:[e.jsx(G,{onSelect:Q,itemToString:()=>"",isOpen:n,children:({getInputProps:t,getItemProps:h,getMenuProps:U,highlightedIndex:H})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(f.SearchBox,{...t(),placeholder:"Search for available packages",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:r,onChange:F,onClear:v,onBlur:$,onFocus:I,onKeyUp:q}),D?e.jsx("span",{className:"p-form-help-text",children:D}):null,n&&(x.length>0||o)?e.jsx("ul",{className:N("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",m.suggestionsContainer),...U(),children:o?e.jsx(R,{}):x.map((b,w)=>e.jsxs("li",{className:N("p-list__item",m.pointer,{[m.highlighted]:H===w}),...h({item:b,index:w}),children:[e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:W(b.name,a)}),e.jsx("div",{children:e.jsx("small",{className:"u-text-muted",children:b.available_version})})]},b.name))}):null]})}),e.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:s.length?s.map(t=>e.jsxs("li",{className:N("p-autocomplete__result p-list__item p-card u-no-margin--bottom",m.selectedContainer),children:[e.jsxs("div",{children:[e.jsx("div",{children:t.name}),e.jsx("small",{className:"u-text--muted p-text--small",children:t.available_version})]}),e.jsx(f.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom",onClick:()=>{T(t.name)},children:e.jsx(f.Icon,{name:f.ICONS.delete})})]},t.name)):null})]})},de=()=>{const[s,l]=_.useState([]),{instanceId:a,childInstanceId:c}=A(),n=B(),{notify:i}=V(),{packagesActionQuery:r}=E(),{closeSidePanel:p}=Y(),{openActivityDetails:j}=z(),S=Number(c??a),{mutateAsync:k,isPending:C}=r,u=async()=>{var o,d;try{const{data:g}=await k({action:"install",computer_ids:[S],package_ids:s.map(({id:x})=>x)});p(),i.success({title:`You queued ${y(s.length,`package ${((o=s[0])==null?void 0:o.name)??""}`,`${s.length} packages`)} to be installed.`,message:`${y(s.length,`${((d=s[0])==null?void 0:d.name)??""} package`,`${s.length} selected packages`)} will be installed and ${y(s.length,"is","are")} queued in Activities.`,actions:[{label:"Details",onClick:()=>{j(g)}}]})}catch(g){n(g)}};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{selectedItems:s,setSelectedItems:o=>{l(o)}}),e.jsx(M,{submitButtonDisabled:C||s.length===0,submitButtonText:"Install packages",submitButtonAppearance:"positive",onSubmit:u})]})};export{de as default};
