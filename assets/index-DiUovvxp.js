import{j as e,N as v,as as D,D as R,r as p,d as i,B as S,b as E,C as M,o as z,L as Y,y as l}from"./index-D0u57Pxb.js";import{u as F}from"./useInstances-B2gUDXxz.js";import{u as G}from"./useRoles-HG8FT5w2.js";const O=({column:{id:a},row:{original:c}})=>{const s={};return a==="title"?s.role="rowheader":a==="checkbox"?s["aria-label"]=`Toggle ${c.title} instance`:a==="hostname"?s["aria-label"]="Hostname":a==="access_group"?s["aria-label"]="Access group":a==="client_tags"?s["aria-label"]="Tags":a==="creation_time"&&(s["aria-label"]="Creation time"),s},Q=(a,c)=>c?a.find(({value:s})=>s===c)?.label??c:e.jsx(v,{}),C=a=>D(a).utc().calendar({sameElse:`${R} [UTC]`,lastWeek:"[Last] dddd, HH:mm [UTC]",sameDay:"[Today], HH:mm [UTC]",lastDay:"[Yesterday], HH:mm [UTC]"}),U="_checkbox_1jtck_1",W="_truncate_1jtck_5",m={checkbox:U,truncate:W},q=({accessGroupOptions:a,instances:c,onSelectedIdsChange:s,selectedIds:o})=>{const u=p.useMemo(()=>c,[c]),n=p.useMemo(()=>[{accessor:"checkbox",className:m.checkbox,Header:()=>e.jsx(i.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,checked:o.length===u.length,indeterminate:o.length>0&&o.length<u.length,onChange:()=>s(o.length>0?[]:u.map(({id:t})=>t))}),Cell:({row:{original:t}})=>e.jsx(i.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${t.title} instance`}),inline:!0,checked:o.includes(t.id),onChange:()=>s(o.includes(t.id)?o.filter(g=>g!==t.id):[...o,t.id])})},{accessor:"title",Header:"name"},{accessor:"hostname",Header:"Hostname"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:t}})=>Q(a,t.access_group)},{accessor:"client_tags",Header:"Tags",Cell:({row:{original:t}})=>t.client_tags.length?e.jsx(i.Tooltip,{message:t.client_tags.join(", "),positionElementClassName:m.truncate,children:t.client_tags.join(", ")}):e.jsx(v,{})},{accessor:"creation_time",Header:"Pending since",Cell:({row:{original:t}})=>e.jsx(i.Tooltip,{message:C(t.creation_time),positionElementClassName:m.truncate,children:C(t.creation_time)})}],[u,o.length]);return e.jsx(i.ModularTable,{columns:n,data:u,getCellProps:O})},J="_help_h15yn_1",K={help:J},ee=({instances:a})=>{const[c,s]=p.useState(!1),[o,u]=p.useState(""),[n,t]=p.useState([]),g=S(),{user:f}=E(),{notify:j}=M(),{closeSidePanel:h,changeSidePanelSize:b}=z(),{getAccessGroupQuery:A}=G(),{acceptPendingInstancesQuery:k,rejectPendingInstancesQuery:P}=F(),d=f?.accounts.find(r=>r.name===f?.current_account)?.title,T=()=>{s(!0),b("small")},B=()=>{s(!1),b("large")},{mutateAsync:$,isPending:x}=k,{mutateAsync:H,isPending:y}=P,I=async()=>{try{await H({computer_ids:n}),h(),j.success({message:`${n.length} pending ${l(n.length,"instance")} ${l(n.length,"has","have")} been rejected to add to your ${d} organization.`,title:`You have rejected ${n.length} pending ${l(n.length,"instance")}`})}catch(r){g(r)}},w=async()=>{try{await $({access_group:o,computer_ids:n}),h(),j.success({message:`${n.length} pending ${l(n.length,"instance")} ${l(n.length,"has","have")} been successfully added to your ${d} organization.`,title:`You have approved ${n.length} pending ${l(n.length,"instance")}`})}catch(r){g(r)}},{data:L}=A(),_=L?.data.map(({name:r,title:N})=>({label:N,value:r}))??[];return e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:K.help,children:[e.jsxs("span",{children:["You can automatically register new Landscape Client Instances when theyâ€™re configured using a registration key. This eliminates the need for manual approval of each computer. You can enable this feature in the"," "]}),e.jsx(Y,{to:"/settings/general",children:"Org. settings"}),e.jsx("span",{children:" or "}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"learn more"})]}),c&&e.jsx(i.Select,{label:"Access group",options:_,name:"access_group",value:o,onChange:r=>{u(r.target.value)}}),!c&&e.jsx(q,{accessGroupOptions:_,instances:a,onSelectedIdsChange:r=>{t(r)},selectedIds:n}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(i.Button,{type:"button",appearance:"base",onClick:h,children:"Cancel"}),c&&e.jsxs(e.Fragment,{children:[e.jsx(i.Button,{type:"button",onClick:B,children:"Back"}),e.jsx(i.ConfirmationButton,{type:"button",appearance:"positive",disabled:n.length===0,confirmationModalProps:{title:"Approve pending instances",children:e.jsxs("p",{children:["This will approve ",n.length," selected"," ",l(n.length,"instance")," to add to your"," ",d," organization."]}),confirmButtonLabel:"Approve",confirmButtonAppearance:"positive",confirmButtonLoading:x,confirmButtonDisabled:x,onConfirm:w},children:"Approve"})]}),!c&&e.jsxs(e.Fragment,{children:[e.jsx(i.ConfirmationButton,{type:"button",appearance:"negative",disabled:n.length===0,confirmationModalProps:{title:"Reject pending instances",children:e.jsxs("p",{children:["This will reject ",n.length," selected"," ",l(n.length,"instance")," to add to your"," ",d," organization."]}),confirmButtonLabel:"Reject",confirmButtonAppearance:"negative",confirmButtonLoading:y,confirmButtonDisabled:y,onConfirm:I},children:"Reject"}),e.jsx(i.Button,{type:"button",appearance:"positive",disabled:n.length===0,onClick:T,children:"Approve"})]})]})]})};export{ee as default};
