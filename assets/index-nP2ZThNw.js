import{r as p,_ as M,c as k,d as E,j as e,e as i,x as S,l as I}from"./index-7rbqZGOC.js";import{u as C}from"./useAlerts-ClgRsTFR.js";import{b as O}from"./output-BGPkZwlr.js";import{u as U}from"./useConfirm-B_JFtESx.js";import{u as w}from"./formik.esm-CYdaNCDR.js";import{c as R,d as V,b as H,a as z}from"./index.esm-Dndhfijq.js";import{S as Q}from"./SidePanelFormButtons-CjpyfPYH.js";import{C as G}from"./CheckboxGroup-Dw0q81-f.js";const q="_titleRow_w5npm_1",J={titleRow:q},K="_actions_1ansh_10",W="_description_1ansh_15",X="_name_1ansh_19",y={"u-off-screen":"_u-off-screen_1ansh_1",switch:"_switch_1ansh_1",actions:K,description:W,name:X},Y=p.lazy(()=>M(()=>Promise.resolve().then(()=>ae),void 0)),Z=p.lazy(()=>M(()=>import("./index-C2PsMBBP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))),ee=({alerts:t,selectedAlerts:a,setSelectedAlerts:n})=>{const r=k(),{setSidePanelContent:b}=E(),{unsubscribeQuery:m,subscribeQuery:u}=C(),{mutateAsync:_}=u,{mutateAsync:f}=m,j=s=>{b(`Edit ${s.label}`,e.jsx(p.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Y,{alert:s})}))},o=s=>{b(s.label,e.jsx(p.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Z,{alert:s})}))},l=async s=>{const h=s.subscribed?f:_;try{await h({alert_type:s.alert_type})}catch(N){r(N)}},d=()=>{n(a.length!==0?[]:t.map(({alert_type:s})=>s))},g=s=>{a.includes(s.original.alert_type)?n(a.filter(h=>h!==s.original.alert_type)):n([...a,s.original.alert_type])},A=p.useMemo(()=>t,[t]),c=p.useMemo(()=>[{Header:e.jsxs(e.Fragment,{children:[e.jsx(i.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:d,checked:a.length===t.length&&t.length!==0,indeterminate:a.length!==0&&a.length<t.length}),e.jsx("span",{children:"Name"})]}),accessor:"label",className:y.name,Cell:({row:s})=>e.jsxs(e.Fragment,{children:[e.jsx(i.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:s.original.label}),inline:!0,checked:a.includes(s.original.alert_type),onChange:()=>g(s)}),e.jsx(i.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>o(s.original),"aria-label":`List subscribers of alert ${s.original.label}`,children:s.original.label})]})},{Header:"Status",accessor:"status",Cell:({row:s})=>e.jsx(e.Fragment,{children:s.original.status})},{Header:"Enabled for",accessor:"all_computers",Cell:({row:s})=>{const h=s.original.tags.length>0?s.original.tags.join(", "):"";return s.original.all_computers?e.jsx(e.Fragment,{children:"All instances"}):s.original.tags.length>0?e.jsxs(e.Fragment,{children:["Instances tagged with ",h]}):e.jsx(e.Fragment,{children:"Account"})}},{Header:"Subscribed",accessor:"subscribed",Cell:({row:s})=>e.jsx("div",{className:y.switch,children:e.jsx(i.Switch,{label:O(s.original.subscribed),defaultChecked:s.original.subscribed,onChange:()=>l(s.original)})})},{Header:"Description",accessor:"description",className:y.description,Cell:({row:s})=>e.jsx(e.Fragment,{children:s.original.description})},{accessor:"alert_type",className:y.actions,Cell:({row:s})=>e.jsxs(i.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left p-tooltip--btm-center","aria-label":`Edit ${s.original.label}`,onClick:()=>j(s.original),children:[e.jsx("span",{className:"p-tooltip__message",children:"Edit"}),e.jsx("i",{className:"p-icon--edit u-no-margin--left"})]})}],[a,t]);return e.jsx(i.ModularTable,{emptyMsg:"No alerts found",columns:c,data:A})};function se(t,a){const n=new Set(a);return t.filter(r=>!n.has(r))}const te=({alert:t})=>{const a=t.tags.map(l=>({label:l,value:l})),{closeSidePanel:n}=E(),{associateAlert:r,disassociateAlert:b}=C(),{mutateAsync:m,isLoading:u}=r,{mutateAsync:_,isLoading:f}=b,j=k(),o=w({initialValues:{all_instances:t.all_computers,tags:t.tags},validationSchema:R().shape({all_instances:V(),tags:H().of(z())}),onSubmit:async l=>{try{const d=se(t.tags,l.tags),g=[];l.all_instances?g.push(m({name:t.alert_type,tags:void 0,all_computers:l.all_instances})):g.push(_({name:t.alert_type,tags:void 0,all_computers:!0})),d.length>0&&g.push(_({name:t.alert_type,tags:d,all_computers:!1})),await Promise.all(g),n()}catch(d){j(d)}}});return e.jsxs(i.Form,{noValidate:!0,onSubmit:o.handleSubmit,children:[e.jsx(i.CheckboxInput,{label:"All instances",checked:o.values.all_instances,...o.getFieldProps("all_instances"),onChange:l=>{o.getFieldProps("all_instances").onChange(l),o.setFieldValue("tags",a.map(d=>d.value))}}),t.tags.length>0?e.jsx(G,{label:"Tags",disabled:o.values.all_instances,options:a,...o.getFieldProps("tags"),onChange:l=>{o.setFieldValue("tags",l)}}):e.jsx("p",{children:"No tags applied to this alert"}),e.jsx(Q,{submitButtonDisabled:u||f,submitButtonText:"Save changes"})]})},B=te,ae=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"})),ne=({alerts:t,sidePanel:a=!1,setSelectedAlerts:n})=>{const{notify:r}=I(),b=k(),{confirmModal:m,closeConfirmModal:u}=U(),{setSidePanelContent:_,closeSidePanel:f}=E(),{subscribeQuery:j,unsubscribeQuery:o}=C(),{mutateAsync:l,isLoading:d}=j,{mutateAsync:g,isLoading:A}=o,c=t[0],s=t.length===1,h=t.every(x=>x.subscribed),N=t.every(x=>!x.subscribed),L=()=>{_(`Edit ${c.label}`,e.jsx(p.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(B,{alert:c})}))},v=async x=>{const T=x?l:g;try{await Promise.all(t.map(async $=>{try{await T({alert_type:$.alert_type})}catch(D){b(D)}})),r.success({message:`Successfully ${x?`subscribed to the alert${s?` ${c.label}`:"s"}`:`unsubscribed from the alert${s?` ${c.label}`:"s"}`}`}),n&&n([])}catch($){b($)}finally{u(),a&&f()}},F=async()=>{m({title:`Subscribing to the selected alert${s?"":"s"}`,body:`Are you sure you want to subscribe to ${s?c.label:"the alerts"}?`,buttons:[e.jsx(i.Button,{disabled:d,appearance:"positive",onClick:()=>v(!0),children:"Confirm"},"subscribe")]})},P=async()=>{m({title:`Unsubscribing from the selected alert${s?"":"s"}`,body:`Are you sure you want to unsubscribe from ${s?c.label:"the alerts"}?`,buttons:[e.jsx(i.Button,{disabled:A,appearance:"positive",onClick:()=>v(!1),children:"Confirm"},"unsubscribe")]})};return e.jsx("div",{className:"p-segmented-control",children:e.jsx("div",{className:"p-segmented-control__list",children:a?e.jsxs(e.Fragment,{children:[e.jsx(i.Button,{className:"p-segmented-control__button",onClick:L,"aria-label":`Edit ${c.label}`,children:"Edit"}),c.subscribed?e.jsx(i.Button,{className:"p-segmented-control__button",onClick:P,"aria-label":`Unsubscribe from ${c.label}`,children:"Unsubscribe"}):e.jsx(i.Button,{className:"p-segmented-control__button",onClick:F,"aria-label":`Subscribe to ${c.label}`,children:"Subscribe"})]}):e.jsxs(e.Fragment,{children:[e.jsx(i.Button,{className:"p-segmented-control__button",onClick:P,"aria-label":"Unsubscribe from alerts",disabled:N,children:"Unsubscribe"}),e.jsx(i.Button,{className:"p-segmented-control__button",onClick:F,"aria-label":"Subscribe to alerts",disabled:h,children:"Subscribe"})]})})})},ie=(t,a)=>t.filter(n=>a.includes(n.alert_type)),le=()=>{const{getAlertsQuery:t}=C(),[a,n]=p.useState([]),{data:r,isLoading:b}=t(),m=(r==null?void 0:r.data.filter(u=>!u.alert_type.toUpperCase().includes("LICENSE")))??[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:J.titleRow,children:[e.jsx("h2",{className:"p-heading--4 u-no-margin--bottom u-no-padding--top",children:"Alerts"}),e.jsx(ne,{alerts:ie(m,a),setSelectedAlerts:u=>n(u)})]}),b?e.jsx(S,{}):e.jsx(ee,{alerts:m,selectedAlerts:a,setSelectedAlerts:u=>n(u)})]})},oe=le,he=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"}));export{ne as A,he as i};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-C2PsMBBP.js","assets/index-7rbqZGOC.js","assets/index-57O3pXzM.css","assets/SidePanelTablePagination-DggXOV9Y.js","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/useAlerts-ClgRsTFR.js","assets/useFetchOld-DEPeqKqM.js","assets/useMutation-CcXaMJpM.js","assets/useQuery-B9bt25H8.js","assets/output-BGPkZwlr.js","assets/useConfirm-B_JFtESx.js","assets/formik.esm-CYdaNCDR.js","assets/index.esm-Dndhfijq.js","assets/SidePanelFormButtons-CjpyfPYH.js","assets/SidePanelFormButtons.module-CoxOjuX8.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/CheckboxGroup-Dw0q81-f.js","assets/CheckboxGroup-B4JHQ1cp.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
