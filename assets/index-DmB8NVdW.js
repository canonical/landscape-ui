const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DK_u7bsI.js","assets/index-CSSscRtK.js","assets/index-BMslluac.css","assets/SidePanelFormButtons-0L6kGGLA.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/AssociationBlock-CBTS8Eer.js","assets/MultiSelectField-CtDXFQVH.js","assets/MultiSelectField-DOBW8uWL.css","assets/useInstances-DdQJ33Q8.js","assets/useFetchOld-Bg7OzTFV.js","assets/AssociationBlock-Cb2Mr2ww.css","assets/useAPTSources-CXvMllfa.js","assets/useRoles-d-hhyBKL.js","assets/constants-B-aIeWz-.js","assets/moment-C5S46NFB.js","assets/NoData-HQm8ZFJm.js","assets/index-kinc5XAu.js","assets/moment-C0lIsxcK.js","assets/TablePagination-Bk6IFP8F.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-DquXj6di.js","assets/TableFilterChips-D-0Xad7c.js","assets/TableFilterChips-Bkpu0rSB.css","assets/index-WbRrN-Yr.css","assets/constants-B49u5tpu.css","assets/tests-DFnZqbNV.js","assets/index-Cbgi0rQx.css"])))=>i.map(i=>d[i]);
import{e as S,h as A,f as m,g as M,r as p,_ as P,q as E,i as j,j as e,d as l,o as y,E as Q}from"./index-CSSscRtK.js";import{P as B,a as O,b as L}from"./PageMain-C_EL0_NR.js";import{u as N}from"./useFetchOld-Bg7OzTFV.js";import"./constants-B-aIeWz-.js";import"./moment-C5S46NFB.js";import{u as T}from"./useRoles-d-hhyBKL.js";import{N as k}from"./NoData-HQm8ZFJm.js";function _(){const o=S(),t=A(),r=N(),i=(s={},u={})=>M({queryKey:["repositoryProfiles",s],queryFn:()=>t.get("repositoryprofiles",{params:s}),...u}),a=m({mutationFn:s=>t.post("repositoryprofiles",s),onSuccess:()=>o.invalidateQueries({queryKey:["repositoryProfiles"]})}),c=m({mutationFn:({name:s,...u})=>t.put(`repositoryprofiles/${s}`,u),onSuccess:()=>o.invalidateQueries({queryKey:["repositoryProfiles"]})}),n=m({mutationKey:["repositoryProfiles"],mutationFn:s=>r.get("RemoveRepositoryProfile",{params:s}),onSuccess:()=>o.invalidateQueries({queryKey:["repositoryProfiles"]})});return{getRepositoryProfilesQuery:i,createRepositoryProfileQuery:a,editRepositoryProfileQuery:c,removeRepositoryProfileQuery:n}}const q="_toggleButton_bnzrt_1",w="_menu_bnzrt_6",x={toggleButton:q,menu:w},D=p.lazy(()=>P(()=>import("./index-DK_u7bsI.js").then(o=>o.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]))),I=({profile:o})=>{const[t,r]=p.useState(!1),[i,a]=p.useState(""),c=E(),{setSidePanelContent:n}=j(),{removeRepositoryProfileQuery:s}=_(),{mutateAsync:u,isPending:g}=s,b=()=>{n(`Edit ${o.title}`,e.jsx(p.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(D,{action:"edit",profile:o})}))},v=async()=>{try{await u({name:o.name})}catch(d){c(d)}finally{h()}},R=()=>{r(!0)},h=()=>{r(!1)},C=d=>{a(d.target.value)},F=[{children:e.jsxs(e.Fragment,{children:[e.jsx(l.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),"aria-label":`Edit "${o.title}" profile`,hasIcon:!0,onClick:b},{children:e.jsxs(e.Fragment,{children:[e.jsx(l.Icon,{name:l.ICONS.delete}),e.jsx("span",{children:"Remove"})]}),"aria-label":`Remove "${o.title}" repository profile`,hasIcon:!0,onClick:R}];return e.jsxs(e.Fragment,{children:[e.jsx(l.ContextualMenu,{position:"left",className:x.menu,toggleClassName:x.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(l.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${o.title} profile actions`},links:F}),t&&e.jsxs(l.ConfirmationModal,{title:"Remove repository profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:g||i!==`remove ${o.name}`,confirmButtonLoading:g,onConfirm:v,close:h,children:[e.jsxs("p",{children:['This will remove "',o.title,'" profile. This action is irreversible.']}),"Type ",e.jsxs("b",{children:["remove ",o.name]})," to confirm.",e.jsx(l.Input,{type:"text",value:i,onChange:C})]})]})},$=({column:o})=>{const t={};return o.id==="title"?t.role="rowheader":o.id==="description"?t["aria-label"]="Description":o.id==="access_group"?t["aria-label"]="Access group":o.id==="id"&&(t["aria-label"]="Actions"),t},H="_accessGroup_1qgn5_1",z="_description_1qgn5_5",G="_actions_1qgn5_9",f={accessGroup:H,description:z,actions:G},K=({repositoryProfiles:o})=>{const{getAccessGroupQuery:t}=T(),{data:r}=t(),i=((r==null?void 0:r.data)??[]).map(({name:n,title:s})=>({label:s,value:n})),a=p.useMemo(()=>o,[o]),c=p.useMemo(()=>[{accessor:"title",Header:"Title"},{accessor:"description",Header:"Description",className:f.description,Cell:({row:n})=>n.original.description||e.jsx(k,{})},{accessor:"access_group",Header:"Access group",className:f.accessGroup,Cell:({row:{original:n}})=>{var s;return((s=i.find(({value:u})=>n.access_group===u))==null?void 0:s.label)??n.access_group}},{accessor:"id",className:f.actions,Header:"Actions",Cell:({row:n})=>e.jsx(I,{profile:n.original})}],[a,i]);return e.jsx(l.ModularTable,{columns:c,data:a,getCellProps:$,emptyMsg:"No profiles yet."})},V=p.lazy(()=>P(()=>import("./index-DK_u7bsI.js").then(o=>o.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28])).then(o=>({default:o.RepositoryProfileForm}))),Y=()=>{const{setSidePanelContent:o}=j(),{getRepositoryProfilesQuery:t}=_(),{data:r,isLoading:i}=t(),a=(r==null?void 0:r.data.results)??[],c=()=>{o("Add repository profile",e.jsx(p.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(V,{action:"add"})}))};return e.jsxs(B,{children:[e.jsx(O,{title:"Repository profiles",actions:[e.jsx(l.Button,{appearance:"positive",onClick:c,type:"button",children:"Add repository profile"},"new-key-button")]}),e.jsxs(L,{children:[i&&e.jsx(y,{}),!i&&a.length===0&&e.jsx(Q,{title:"No repository profiles found",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You havenâ€™t added any repository profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/manage-repositories-web-portal",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage repositories in Landscape"})]}),cta:[e.jsx(l.Button,{appearance:"positive",onClick:c,type:"button",children:"Add repository profile"},"table-add-new-profile")]}),!i&&a.length>0&&e.jsx(K,{repositoryProfiles:a})]})]})},te=Object.freeze(Object.defineProperty({__proto__:null,default:Y},Symbol.toStringTag,{value:"Module"}));export{K as R,te as i,_ as u};
