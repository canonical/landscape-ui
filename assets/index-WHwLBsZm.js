const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DCZvnloC.js","assets/index-u_EhbhC_.js","assets/index-DWaf_ZwL.css","assets/index.esm-BQnwAMDD.js","assets/SidePanelFormButtons-xqQ8httV.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/MultiSelectField-ehdSZtl5.js","assets/MultiSelectField-DOBW8uWL.css","assets/EmptyState-BqInhbHc.js","assets/EmptyState-DUn4ZRie.css","assets/TablePagination-B-hCaI46.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-TkE3cuN_.js","assets/PageMain-CmLgxdJK.js","assets/PageMain-BIuYvhUI.css","assets/useMutation-CrcSbzv3.js","assets/useConfirm-B8tJ1H3c.js","assets/helpers-BrQYpof6.js","assets/HeaderWithSearch-8K0RDNyY.js","assets/HeaderWithSearch-DQybm8h_.css","assets/NoData-BfY2RoAl.js","assets/index-DizMkz5F.js","assets/InfoItem-DfMbt4qK.js","assets/InfoItem-C-lWh_lY.css"])))=>i.map(i=>d[i]);
import{d as X,c as J,m as v,e as D,f as w,g as Z,j as e,h as n,r as y,_ as I,n as ee,i as se,l as P}from"./index-u_EhbhC_.js";import{E as re}from"./EmptyState-BqInhbHc.js";import{T as oe}from"./TablePagination-B-hCaI46.js";import{u as C}from"./PageMain-CmLgxdJK.js";import{u as j}from"./useMutation-CrcSbzv3.js";import{u as te}from"./useConfirm-B8tJ1H3c.js";import{c as ne,a as x,e as ae}from"./index.esm-BQnwAMDD.js";import{S as ie}from"./SidePanelFormButtons-xqQ8httV.js";import{g as ce,r as $,U as A,a as ue}from"./helpers-BrQYpof6.js";import{u as T}from"./usePageParams-TkE3cuN_.js";import{H as le}from"./HeaderWithSearch-8K0RDNyY.js";import{N as de}from"./NoData-BfY2RoAl.js";function F(){const o=X(),t=J(),i=(r,p={})=>C({queryKey:["users",{...r}],queryFn:()=>o.get("users",{params:r}),...p}),u=j({mutationKey:["users","new"],mutationFn:r=>o.post("users",r),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),l=j({mutationKey:["users","edit"],mutationFn:r=>o.put("users",r),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),m=j({mutationKey:["users","remove"],mutationFn:r=>o.delete("users",{params:r}),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),g=j({mutationKey:["users","lock"],mutationFn:r=>o.post("users/lock",r),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),h=j({mutationKey:["users","unlock"],mutationFn:r=>o.post("users/unlock",r),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),b=(r,p={})=>C({queryKey:["groups",r.computer_id],queryFn:()=>o.get(`computers/${r.computer_id}/groups`),...p}),a=(r,p={})=>C({queryKey:["userGroups",r.computer_id,r.username],queryFn:()=>o.get(`computers/${r.computer_id}/users/${r.username}/groups`),...p}),d=j({mutationKey:["groups","add"],mutationFn:r=>o.post(`computers/${r.computer_id}/usergroups/update_bulk`,r),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})}),s=j({mutationKey:["groups","remove"],mutationFn:r=>o.post(`computers/${r.computer_id}/usergroups/update_bulk`,r),onSuccess:()=>t.invalidateQueries({queryKey:["users"]})});return{getUsersQuery:i,getGroupsQuery:b,getUserGroupsQuery:a,createUserQuery:u,removeUserQuery:m,editUserQuery:l,lockUserQuery:g,unlockUserQuery:h,addUserToGroupQuery:d,removeUserFromGroupQuery:s}}const me="_actions_1l3g0_1",pe={actions:me},K=()=>{const{instanceId:o}=v(),t=D(),{closeSidePanel:i}=w(),{createUserQuery:u,getGroupsQuery:l}=F(),m=Number(o),{mutateAsync:g}=u,{data:h,isLoading:b}=l({computer_id:m}),d=((h==null?void 0:h.data.groups)??[]).map(r=>({label:r.name,value:r.name})),s=Z({initialValues:{name:"",username:"",password:"",confirmPassword:"",requirePasswordReset:!1,location:"",homePhoneNumber:"",workPhoneNumber:"",primaryGroupValue:""},validationSchema:ne().shape({name:x().required("This field is required"),username:x().required("This field is required"),password:x().required("This field is required"),confirmPassword:x().required("This field is required").oneOf([ae("password"),""],"Passwords must match"),location:x(),homePhoneNumber:x(),workPhoneNumber:x(),primaryGroupValue:x().required("This field is required")}),onSubmit:async r=>{try{await g({computer_ids:[m],name:r.name,username:r.username,password:r.password,require_password_reset:r.requirePasswordReset,location:r.location,home_phone:r.homePhoneNumber,work_phone:r.workPhoneNumber,primary_groupname:r.primaryGroupValue}),i()}catch(p){t(p)}}});return e.jsxs(n.Form,{noValidate:!0,onSubmit:s.handleSubmit,name:"add-new-user",children:[e.jsx(n.Input,{type:"text",label:"Username",autoComplete:"new-username",required:!0,error:s.touched.username&&s.errors.username?s.errors.username:void 0,...s.getFieldProps("username")}),e.jsx(n.Input,{type:"text",label:"Name",required:!0,error:s.touched.name&&s.errors.name?s.errors.name:void 0,...s.getFieldProps("name")}),e.jsx(n.Input,{type:"password",label:"Passphrase",autoComplete:"new-password",required:!0,error:s.touched.password&&s.errors.password?s.errors.password:void 0,...s.getFieldProps("password")}),e.jsx(n.Input,{type:"password",label:"Confirm passphrase",autoComplete:"new-password",required:!0,error:s.touched.confirmPassword&&s.errors.confirmPassword?s.errors.confirmPassword:void 0,...s.getFieldProps("confirmPassword")}),e.jsx(n.Input,{type:"checkbox",label:"Require passphrase reset",help:"User must change password at first login",...s.getFieldProps("requirePasswordReset"),checked:s.values.requirePasswordReset}),e.jsx(n.Select,{label:"Primary Group",disabled:b,options:[{label:"Select",value:""},...d],...s.getFieldProps("primaryGroupValue"),error:s.touched.primaryGroupValue&&s.errors.primaryGroupValue?s.errors.primaryGroupValue:void 0}),e.jsx(n.Input,{type:"text",label:"Location",error:s.touched.location&&s.errors.location?s.errors.location:void 0,...s.getFieldProps("location")}),e.jsx(n.Input,{type:"text",label:"Home phone",error:s.touched.homePhoneNumber&&s.errors.homePhoneNumber?s.errors.homePhoneNumber:void 0,...s.getFieldProps("homePhoneNumber")}),e.jsx(n.Input,{type:"text",label:"Work phone",error:s.touched.workPhoneNumber&&s.errors.workPhoneNumber?s.errors.workPhoneNumber:void 0,...s.getFieldProps("workPhoneNumber")}),e.jsx(ie,{submitButtonDisabled:s.isSubmitting,submitButtonText:"Add user"})]})},he=y.lazy(()=>I(()=>import("./index-DCZvnloC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))),ge=({selectedUsers:o,handleClearSelection:t,sidePanel:i=!1})=>{const[u,l]=y.useState(!1),{instanceId:m}=v(),g=D(),{notify:h}=ee(),{setSidePanelContent:b,closeSidePanel:a}=w(),{confirmModal:d,closeConfirmModal:s}=te(),{removeUserQuery:r,lockUserQuery:p,unlockUserQuery:q}=F(),{mutateAsync:k}=r,{mutateAsync:U}=p,{mutateAsync:S}=q,f=Number(m),c=o.length===1?o[0]:void 0,{locked:L,unlocked:B}=ce(o),N=async(_,Q)=>{try{await _({computer_ids:[f],usernames:ue(o),delete_home:Q==="removed"?u:void 0}),t&&t(),a(),h.success({message:`Successfully requested to be ${Q}`})}catch(Y){g(Y)}finally{s()}},M=async()=>{await N(U,"locked")},G=async()=>{await N(S,"unlocked")},V=async()=>{await N(k,"removed")},H=()=>{b("Add new user",e.jsx(K,{}))},R=_=>{b("Edit user",e.jsx(y.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(he,{user:_})}))},O=async()=>{d({title:`Delete ${c?c.username:"users"}`,body:e.jsxs("div",{children:[e.jsx("p",{className:"u-no-margin--bottom",children:c?`This will delete user ${c.username}. You can delete this user's home folders at the same time`:"This will delete selected users. You can delete their home folders as well"}),e.jsx(n.Input,{label:"Delete the home folders as well",type:"checkbox",onChange:()=>l(_=>!_)})]}),buttons:[e.jsx(n.Button,{appearance:"negative",onClick:V,children:"Delete"},"remove")]})},z=async()=>{d({title:`Lock ${c?`user ${c.username}`:`${o.length} users`}`,body:$({user:c,selectedUsers:o,userAction:A.Lock}),buttons:[e.jsx(n.Button,{appearance:"positive",onClick:M,children:"Lock"},"lock")]})},W=async()=>{d({title:`Unlock ${c?`user ${c.username}`:`${o.length} users`}`,body:$({user:c,selectedUsers:o,userAction:A.Unlock}),buttons:[e.jsx(n.Button,{appearance:"positive",onClick:G,children:"Unlock"},"unlock")]})};return e.jsxs("div",{className:se("p-panel__controls u-no-padding--top",{"u-no-margin--left":i}),children:[!i&&e.jsxs(n.Button,{hasIcon:!0,onClick:H,className:"u-no-margin--right",children:[e.jsx(n.Icon,{name:"plus"}),e.jsx("span",{children:"Add user"})]}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[((c==null?void 0:c.enabled)||!i)&&e.jsxs(n.Button,{disabled:B===0,onClick:z,className:"p-segmented-control__button",children:[e.jsx(n.Icon,{name:"lock-locked"}),e.jsx("span",{children:"Lock"})]}),(!(c!=null&&c.enabled)||!i)&&e.jsxs(n.Button,{disabled:L===0,onClick:W,className:"p-segmented-control__button",children:[e.jsx(n.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlock"})]}),i&&c&&e.jsxs(n.Button,{onClick:()=>R(c),className:"p-segmented-control__button",children:[e.jsx(n.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(n.Button,{disabled:o.length===0,onClick:O,className:"p-segmented-control__button",children:[e.jsx(n.Icon,{name:"delete"}),e.jsx("span",{children:"Delete"})]})]})})]})},be=(o,t)=>o.filter(i=>t.includes(i.uid)),ye=({selected:o,handleClearSelection:t,users:i})=>{const{setPageParams:u}=T(),l=m=>{u({search:m}),t()};return e.jsx(le,{onSearch:l,actions:e.jsx("div",{className:pe.actions,children:e.jsx(ge,{handleClearSelection:t,selectedUsers:be(i,o)})})})},xe="_status_1or9p_1",je="_actions_1or9p_7",E={status:xe,actions:je},ke=({column:o})=>{const t={};switch(o.id){case"username":t.role="rowheader";break;case"enabled":t["aria-label"]="Status";break;case"uid":t["aria-label"]="User id";break;case"name":t["aria-label"]="Full name";break}return t},fe=y.lazy(()=>I(()=>import("./index-DCZvnloC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))),_e=y.lazy(()=>I(()=>import("./index-DizMkz5F.js"),__vite__mapDeps([23,1,2,24,25,22,9,10,11,12,13,14,15,16,17,18,3,4,5,6,19,20,21]))),Ue=({users:o,selected:t,setSelected:i})=>{const{setSidePanelContent:u}=w(),l=a=>{u("Edit user",e.jsx(y.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(fe,{user:a})}))},m=a=>{u("User details",e.jsx(y.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(_e,{user:a})}))},g=()=>{i(t.length!==0?[]:o.map(({uid:a})=>a))},h=a=>{t.includes(a)?i(t.filter(d=>d!==a)):i([...t,a])},b=y.useMemo(()=>[{accessor:"username",Header:e.jsxs(e.Fragment,{children:[e.jsx(n.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:g,checked:o.length>0&&t.length===o.length,indeterminate:t.length>0&&t.length<o.length}),e.jsx("span",{children:"username"})]}),Cell:({row:a})=>e.jsxs(e.Fragment,{children:[e.jsx(n.CheckboxInput,{inline:!0,label:e.jsxs("span",{className:"u-off-screen",children:["Select user ",a.original.username]}),checked:t.includes(a.original.uid),onChange:()=>h(a.original.uid)}),e.jsx(n.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>m(a.original),"aria-label":`Show details of user ${a.original.username}`,children:a.original.username})]})},{Header:"status",accessor:"enabled",sortType:"basic",Cell:({row:a})=>e.jsx("div",{className:E.status,children:a.original.enabled?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"p-icon--lock-unlock"}),e.jsx("span",{children:"Unlocked"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"p-icon--lock-locked-active"}),e.jsx("span",{children:"Locked"})]})})},{Header:"UID",accessor:"uid",sortType:"basic"},{Header:"Full Name",accessor:"name",sortType:"basic",Cell:({row:a})=>a.original.name||e.jsx(de,{})},{accessor:"actions",className:E.actions,Cell:({row:a})=>e.jsx(n.Tooltip,{message:"Edit",position:"btm-center",children:e.jsx(n.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Edit ${a.original.name} profile`,onClick:()=>l(a.original),children:e.jsx("i",{className:"p-icon--edit u-no-margin--left"})})})}],[o]);return e.jsx(n.ModularTable,{columns:b,data:o,emptyMsg:"No users available",sortable:!0,initialSortDirection:"ascending",initialSortColumn:"username",getCellProps:ke})},Pe=(o,t)=>o?t.filter(({username:i,name:u})=>{const l=u==null?void 0:u.toUpperCase().includes(o.toUpperCase()),m=i.toUpperCase().includes(o.toUpperCase());return l||m}):t,we=1e3,Se=()=>{const[o,t]=y.useState([]),{instanceId:i,childInstanceId:u}=v(),{search:l,currentPage:m,pageSize:g}=T(),{setSidePanelContent:h}=w(),{getUsersQuery:b}=F(),a=Number(u??i),{data:d,isLoading:s}=b({computer_id:a,limit:we}),r=(d==null?void 0:d.data.results)??[],p=y.useMemo(()=>Pe(l,r),[l,r]),k=((f,c)=>p.slice(c,c+f))(g,(m-1)*g),U=()=>{t([])},S=()=>{h("Add new user",e.jsx(K,{}))};return e.jsxs(e.Fragment,{children:[s&&e.jsx(P,{}),!s&&(!d||d.data.results.length===0)&&e.jsx(re,{title:"No users found",body:"Add new users by clicking the button below",icon:"connected",cta:[e.jsx(n.Button,{appearance:"positive",onClick:S,children:"Add user"},"empty-state-add-new-user")]}),(l||!s&&p.length)&&e.jsxs(e.Fragment,{children:[e.jsx(ye,{selected:o,handleClearSelection:U,users:k}),e.jsx(Ue,{selected:o,setSelected:f=>t(f),users:k})]}),e.jsx(oe,{handleClearSelection:U,totalItems:p.length,currentItemCount:k.length})]})},Ne=Se,Le=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{ge as U,Le as i,F as u};
