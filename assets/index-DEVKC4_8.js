const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-vsz7RMCk.js","assets/index-czR6w9lm.js","assets/index-D38JayDC.css","assets/useInstances-CS4GBVs7.js","assets/useFetchOld-CEj2k1CT.js","assets/SidePanelFormButtons-CfWEYvbx.js","assets/SidePanelFormButtons.module-tJTvEwdD.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/useRoles-DBOAY-4X.js","assets/index-BMX8NuUK.js","assets/CodeEditor-DL8qJdCQ.js","assets/CodeEditor-Dykd0T8L.css","assets/usePageParams-CTGLrWb_.js","assets/index-C4ym0nfD.css"])))=>i.map(i=>d[i]);
import{j as e,m as y,Z as ee,r as l,g as a,k as J,$ as te,U as ne,n as H,D as se,h as ae,G as oe,i as re,a as ie,p as le,q as ce,f as de,s as ue,I as me,_ as X}from"./index-czR6w9lm.js";import{u as U}from"./useInstances-CS4GBVs7.js";import{u as pe}from"./WslInstancesHeader-D4BYILgV.js";import{m as W,h as Y}from"./usePageParams-CTGLrWb_.js";import{u as he}from"./useRoles-DBOAY-4X.js";import{N as v}from"./NoData-lrj3YC8M.js";import{u as fe}from"./index-BgtlemhL.js";import{c as ge}from"./helpers-D4lnOe3H.js";import"./InstancesPageActions-CRVwrtns.js";import"./useFetchOld-CEj2k1CT.js";import"./HeaderWithSearch-BwHeuIPk.js";import"./TableFilterChips-DvqzXX1K.js";import"./TablePagination-lSfBZTnC.js";import"./TablePaginationBase-PYbQPdg1.js";import"./StatusFilter-D-xdwg2t.js";import"./TableFilter-CyJVthnU.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new t.Error().stack;n&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[n]="26372603-3fb3-4d48-99a4-1b8d973e213e",t._sentryDebugIdIdentifier="sentry-dbid-26372603-3fb3-4d48-99a4-1b8d973e213e")}catch{}const xe="_infoContainer_1ca11_1",_e="_amount_1ca11_9",G={infoContainer:xe,amount:_e},be=({isExpanded:t,overflowingChipsAmount:n})=>n>0&&!t&&e.jsx("div",{className:G.infoContainer,children:e.jsx("span",{className:y("u-text--muted",G.amount),children:`+${n}`})}),je=({containerRef:t,onDismiss:n,onOverflowingItemsAmountChange:c,tagData:d})=>{const p=()=>{if(!t.current)return;const i=t.current.querySelectorAll("span.p-chip");c(Array.from(i).filter(({offsetHeight:g,offsetTop:h})=>h>g).length)};return ee("resize",p),l.useEffect(()=>{p()},[d.length]),d.map(i=>e.jsx(a.Chip,{value:i,onDismiss:()=>n(i)},i))},ve="_container_1f6mu_1",ye="_list_1f6mu_6",Ie="_listItem_1f6mu_11",we="_search_1f6mu_17",E={container:ve,list:ye,listItem:Ie,search:we},Ce=({onTagClick:t,tags:n})=>n.length?e.jsxs("div",{className:E.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Tags"}),e.jsx("ul",{className:y("p-list--divided u-no-margin--bottom",E.list),children:n.map(c=>e.jsx("li",{children:e.jsx("div",{className:E.listItem,children:e.jsx(a.Button,{type:"button",appearance:"base",className:E.search,onClick:()=>t(c),children:c})})},c))})]}):null,Se="_container_fqj7b_1",Ne="_prompt_fqj7b_10",Ae="_saveButton_fqj7b_17",Q={container:Se,prompt:Ne,saveButton:Ae},ke=({onTagAdd:t,search:n})=>e.jsx(e.Fragment,{children:n&&e.jsxs("div",{className:Q.container,children:[e.jsxs("span",{className:Q.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:n}),e.jsx("span",{children:"..."})]}),e.jsx(a.Button,{type:"button",appearance:"link",onClick:t,className:Q.saveButton,children:"Add tag"})]})}),K=J().matches(/^[a-zA-Z]/,{message:"Tag must starts with a letter",excludeEmptyString:!0}).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,{message:"Tag can only contain letters, numbers, hyphens, and underscores",excludeEmptyString:!0}),Re="_searchContainer_qgkjy_1",Te="_box_qgkjy_8",Be="_inputContainer_qgkjy_13",De="_inputError_qgkjy_18",L={searchContainer:Re,box:Te,inputContainer:Be,inputError:De},Ee=({onTagsChange:t,tags:n,label:c,labelClassName:d,required:p})=>{var o;const[i,g]=l.useState(""),[h,_]=l.useState(""),[P,S]=l.useState(!1),[w,$]=l.useState(""),[x,b]=l.useState(!1),[q,F]=l.useState(0),{height:N}=te(),[j,A]=l.useState({top:"100%",bottom:"auto"}),{getAllInstanceTagsQuery:k}=U(),R=l.useRef(null),m=l.useRef(null);l.useEffect(()=>{if(!m.current)return;const s=m.current.querySelector("input");s&&$(s.id)},[m.current]),l.useEffect(()=>{!x||!m.current||O()},[N,x,m.current,(o=m.current)==null?void 0:o.clientHeight]);const O=()=>{if(!m.current)return;const{top:s,height:u}=m.current.getBoundingClientRect();s+u+379<N?A({top:"100%",bottom:"auto"}):A({top:"auto",bottom:"100%"})},C=()=>{b(!1)};ne(R,C);const Z=s=>{t(n.filter(u=>u!==s))},{data:r,isLoading:T}=k(),V=l.useMemo(()=>r?!i&&!n.length?r.data.results:r.data.results.filter(s=>!n.includes(s)).filter(s=>s.toLowerCase().includes(i.trim().toLowerCase())):[],[r,i,n]),B=s=>{t([...n,s])},D=()=>{if(i.trim())try{const s=K.validateSync(i.trim())??"";B(s),g(""),_(""),S(!1)}catch(s){s instanceof Error&&(_(s.message),S(!0))}},z=s=>{if(g(s.target.value),P)try{K.validateSync(s.target.value),_("")}catch(u){u instanceof Error&&_(u.message)}},I=s=>{const{key:u}=s;x?(u==="Escape"&&C(),u==="Enter"&&D()):u==="Enter"&&b(!0)};return e.jsxs("div",{children:[e.jsx("label",{className:y("p-form__label",{"is-required":p},d),htmlFor:w,children:c||"Tags"}),e.jsxs("div",{className:"p-search-and-filter",ref:R,children:[e.jsxs("div",{className:y("p-search-and-filter__search-container",L.searchContainer),"aria-expanded":x,ref:m,onClick:()=>b(!0),children:[e.jsx(je,{containerRef:m,onDismiss:Z,onOverflowingItemsAmountChange:s=>F(s),tagData:n}),e.jsx("div",{className:y("p-search-and-filter__box",L.box),children:e.jsx("div",{className:L.inputContainer,children:e.jsx(a.Input,{type:"text",autoComplete:"off",value:i,onChange:z,placeholder:"Add tags",className:"u-no-margin--bottom",onClick:()=>b(!0),onKeyUp:I,wrapperClassName:h?"is-error":"","aria-errormessage":h?`${w}-error`:void 0,"aria-invalid":!!h})})}),h&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:y("p-form-validation__message",L.inputError),id:`${w}-error`,children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:h})]})}),e.jsx(be,{isExpanded:x,overflowingChipsAmount:q})]}),x&&T&&e.jsx(H,{}),x&&!T&&e.jsxs("div",{className:"p-search-and-filter__panel",style:j,children:[e.jsx(ke,{onTagAdd:D,search:i}),e.jsx(Ce,{onTagClick:B,tags:V})]})]})]})},Le=t=>{var c;const n=(c=t.grouped_hardware)==null?void 0:c.network;return!Array.isArray(n)||n.length===0?e.jsx(v,{}):n.filter(({ip:d})=>d!=="Not available").map(({ip:d})=>d).join(", ")||e.jsx(v,{})},Pe=(t,n)=>{var c,d,p;return[{label:"instance ID",value:t.id},{label:"Hostname",value:t.hostname},{label:"IP Address",value:Le(t)},{label:"Serial number",value:((c=t.grouped_hardware)==null?void 0:c.system.serial)??e.jsx(v,{})},{label:"Product identifier",value:((d=t.grouped_hardware)==null?void 0:d.system.model)??e.jsx(v,{})},{label:"Distribution",value:t.distribution??"Unknown"},{label:"Access group",value:((p=n.find(({value:i})=>i===t.access_group))==null?void 0:p.label)||t.access_group},{label:"Last ping time",value:t.last_ping_time&&W(t.last_ping_time).isValid()?W(t.last_ping_time).format(se):e.jsx(v,{})},{label:"Annotations",value:t.annotations?Object.entries(t.annotations).map(([i,g],h,_)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:`${i}: ${g}`}),h<_.length-1&&e.jsx("br",{})]})):e.jsx(v,{})},{label:"Comment",value:t.comment||e.jsx(v,{})}]},$e="_titleRow_lxk0r_1",qe="_flexContainer_lxk0r_6",Fe="_italic_lxk0r_11",Oe="_infoRow_lxk0r_15",Ve="_tagSection_lxk0r_20",ze="_tagsRow_lxk0r_25",Me="_tagsButton_lxk0r_33",f={titleRow:$e,flexContainer:qe,italic:Fe,infoRow:Oe,tagSection:Ve,tagsRow:ze,tagsButton:Me},Qe={deliver_after:"",deliverImmediately:!0,action:null},He=ae().shape({deliver_after:J().when("deliverImmediately",{is:!1,then:t=>t.required("This field is required").test({message:"Invalid date",test:n=>Y(n).isValid()}).test({message:"Date must be in the future",test:n=>Y(n).isAfter()})}),deliverImmediately:re(),action:oe().oneOf(["shutdown","reboot"]).required()}),Ue=l.lazy(()=>X(()=>import("./index-vsz7RMCk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),Ze=l.lazy(()=>X(()=>import("./index-BMX8NuUK.js").then(t=>t.i),__vite__mapDeps([9,1,2,10,11,5,6,7,4,8,12,13])).then(t=>({default:t.RunInstanceScriptForm}))),dt=({instance:t})=>{const[n,c]=l.useState(t.tags),d=ie(),p=le(),{openActivityDetails:i}=fe(),{notify:g}=ce(),{setSidePanelContent:h}=de(),{getAccessGroupQuery:_}=he(),{removeInstancesQuery:P,rebootInstancesQuery:S,shutdownInstancesQuery:w}=U(),{deleteChildInstancesQuery:$}=pe(),{editInstanceQuery:x}=U();l.useEffect(()=>{c(t.tags)},[t.tags]);const{data:b}=_(),q=(b==null?void 0:b.data.map(({name:o,title:s})=>({label:s,value:o})))??[],{mutateAsync:F}=x,{mutateAsync:N,isPending:j}=P,{mutateAsync:A,isPending:k}=S,{mutateAsync:R,isPending:m}=w,{mutateAsync:O,isPending:C}=$,r=ue({initialValues:Qe,validationSchema:He,onSubmit:async o=>{if(!o.action)return;const s={computer_ids:[t.id],deliver_after:o.deliverImmediately?void 0:`${o.deliver_after}:00Z`};try{const{data:u}=o.action==="reboot"?await A(s):await R(s),M=o.action==="reboot"?"restarted":"shut down";g.success({title:`You queued "${t.title}" to be ${M}`,message:`Instance "${t.title}" will be ${M} and is queued in Activities`,actions:[{label:"View details",onClick:()=>i(u)}]})}catch(u){p(u)}}}),T=async()=>{try{await F({instanceId:t.id,tags:n}),g.success({title:"Tags updated",message:`"${t.title}" instance tags have been updated successfully`})}catch(o){p(o)}},V=async()=>{try{await N({computer_ids:[t.id]}),d("/instances",{replace:!0})}catch(o){p(o)}},B=()=>{h("Edit Instance",e.jsx(l.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(Ue,{instance:t})}))},D=()=>{h("Run script",e.jsx(l.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(Ze,{query:`id:${t.id}`})}))},z=async()=>{try{await O({computer_ids:[t.id]}),d("/instances",{replace:!0})}catch(o){p(o)}},I=async o=>{await r.setFieldValue("action",o),r.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:f.titleRow,children:[e.jsxs("div",{className:f.flexContainer,children:[e.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:t.title}),t.is_wsl_instance&&e.jsx("p",{className:y("u-text--muted u-no-margin--bottom",f.italic),children:"WSL Instance"})]}),e.jsxs("div",{className:f.flexContainer,children:[t.is_wsl_instance&&e.jsx(a.ConfirmationButton,{className:"u-no-margin--bottom u-no-margin--right",type:"button",confirmationModalProps:{title:"Delete instance",children:e.jsxs("p",{children:["This will permanently delete the instance"," ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:C,confirmButtonLoading:C,onConfirm:z},children:"Delete instance"}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(a.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:B,children:[e.jsx(a.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),ge("runScripts",t)&&e.jsxs(a.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:D,children:[e.jsx(a.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]}),e.jsxs(a.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:j,confirmationModalProps:{title:"Remove instance from Landscape",children:e.jsxs("p",{children:["This will remove the instance ",e.jsx("b",{children:t.title})," from Landscape.",e.jsx("br",{}),e.jsx("br",{}),"It will remain on the parent machine. You can re-register it to Landscape at any time."]}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:j,confirmButtonLoading:j,onConfirm:V},children:[e.jsx(a.Icon,{name:a.ICONS.delete}),e.jsx("span",{children:"Remove from Landscape"})]}),e.jsxs(a.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:j,confirmationModalProps:{title:"Restart instance",children:e.jsxs(a.Form,{onSubmit:()=>I("reboot"),noValidate:!0,children:[e.jsx(a.CheckboxInput,{label:"Deliver as soon as possible",...r.getFieldProps("deliverImmediately"),checked:r.values.deliverImmediately}),e.jsx(a.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:f.input,placeholder:"Scheduled time",...r.getFieldProps("deliver_after"),disabled:r.values.deliverImmediately,error:r.touched.deliver_after&&r.errors.deliver_after?r.errors.deliver_after:void 0}),e.jsxs("p",{children:['This will restart "',t.title,'" instance.']})]}),confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonDisabled:k,confirmButtonLoading:k,onConfirm:()=>I("reboot")},children:[e.jsx(a.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]}),e.jsxs(a.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:j,confirmationModalProps:{title:"Shut down instance",children:e.jsxs(a.Form,{onSubmit:()=>I("shutdown"),noValidate:!0,children:[e.jsx(a.CheckboxInput,{label:"Deliver as soon as possible",...r.getFieldProps("deliverImmediately"),checked:r.values.deliverImmediately}),e.jsx(a.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:f.input,placeholder:"Scheduled time",...r.getFieldProps("deliver_after"),disabled:r.values.deliverImmediately,error:r.touched.deliver_after&&r.errors.deliver_after?r.errors.deliver_after:void 0}),e.jsxs("p",{children:['This will shut down "',t.title,'" instance.']})]}),confirmButtonLabel:"Shutdown",confirmButtonAppearance:"negative",confirmButtonDisabled:m,confirmButtonLoading:m,onConfirm:()=>I("shutdown")},children:[e.jsx(a.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]})]})},"buttons")]})]}),e.jsx("div",{className:f.infoRow,children:e.jsx(a.Row,{className:"u-no-padding--left u-no-padding--right u-no-max-width",children:Pe(t,q).map(o=>e.jsx(a.Col,{size:4,children:e.jsx(me,{...o})},o.label))})}),e.jsx("div",{className:f.tagSection,children:e.jsxs(a.Row,{className:f.tagsRow,children:[e.jsx(a.Col,{size:4,children:e.jsx(Ee,{labelClassName:"p-text--small p-text--small-caps u-text--muted",onTagsChange:o=>c(o),tags:n})}),e.jsx(a.Col,{size:2,className:f.tagsButton,children:e.jsx(a.Button,{type:"button",className:"u-no-margin--bottom",onClick:T,children:"Update"})})]})})]})};export{dt as default};
