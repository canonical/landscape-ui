import{j as t,r as u,l as I,m as n,y as T,z as $,a as k,W as E,ax as N,ak as w,a2 as m,ab as L,L as R,E as P,I as l,N as D}from"./index-DMPyBbUQ.js";import{D as M,A as O,g as B}from"./EmployeeList-DPLTNY7w.js";import{g as p}from"./helpers-BW0L5q5z.js";import"./InstancesPageActions-CIEDHOxk.js";import{u as H}from"./useInstances-C4ctbvWq.js";import"./TruncatedCell-DDahLPtM.js";import"./helpers-C7W_HUXn.js";const V=e=>e.employee.is_active?t.jsx(M,{...e}):t.jsx(O,{...e}),Y=({employee:e})=>{const[i,a]=u.useState(!1),{closeSidePanel:s}=I(),c=()=>{a(!0)},d=()=>{a(!1),s()};return t.jsxs("div",{children:[t.jsxs(n.Button,{hasIcon:!0,onClick:c,children:[t.jsx(n.Icon,{name:e.is_active?"pause":"play"}),t.jsx("span",{children:e.is_active?"Deactivate":"Activate"})]}),i&&t.jsx(V,{employee:e,handleClose:d})]})},F=({instance:e})=>{const[i,a]=u.useState(""),s=T(),{notify:c}=$(),d=k(),{openActivityDetails:f}=E(),{removeInstancesQuery:g,sanitizeInstanceQuery:x}=H(),{mutateAsync:b,isPending:y}=g,{mutateAsync:j,isPending:C}=x,r=()=>{a("")},A=async()=>{try{const{data:o}=await j({computer_id:e.id,computer_title:e.title});r(),c.success({title:`You have successfully initiated Sanitization for ${e.title}`,message:`Sanitizing for ${e.title} has been queued in Activities. The data will be permanently irrecoverable once complete.`,actions:[{label:"View details",onClick:()=>{f(o)}}]})}catch(o){s(o)}},S=async()=>{try{await b({computer_ids:[e.id]}),r(),c.success({title:`You have successfully removed ${e.title}`,message:`${e.title} has been removed from Landscape. To manage it again, you will need to re-register it in Landscape.`})}catch(o){s(o)}},_=[{icon:"machines",label:"View details","aria-label":`View ${e.title} instance details`,onClick:async()=>d(`${N}instances/${e.id}`)}],z=[{icon:"tidy",label:"Sanitize","aria-label":`Sanitize ${e.title} instance`,onClick:()=>{a("sanitize")}},{icon:n.ICONS.delete,label:"Remove from Landscape","aria-label":"Remove from Landscape",onClick:()=>{a("remove")}}];return t.jsxs(t.Fragment,{children:[t.jsx(w,{toggleAriaLabel:`${e.title} profile actions`,actions:_,destructiveActions:z}),t.jsx(m,{isOpen:i==="remove",title:`Remove ${e.title} instance`,confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:y,onConfirm:S,close:r,confirmationText:`remove ${e.title}`,children:t.jsxs("p",{children:["Removing this ",e.title," will delete all associated data and free up one license slot for another computer to be registered."]})}),t.jsx(m,{isOpen:i==="sanitize",title:`Sanitize "${e.title}" instance`,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:C,onConfirm:A,close:r,confirmationText:`sanitize ${e.title}`,children:t.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",e.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})},v={title:"No instances found",body:"There are no instances associated with this employee"},Q="_container_nv9rn_1",q="_link_nv9rn_7",h={container:Q,link:q},U=()=>({column:e})=>{const i={};return e.id==="name"?i.role="rowheader":e.id==="status"?i["aria-label"]="Status":e.id==="recovery_key"?i["aria-label"]="Recovery key":e.id==="actions"&&(i["aria-label"]="Actions"),i},W=({instances:e})=>{const i=u.useMemo(()=>[{accessor:"name",Header:"name",Cell:({row:a})=>t.jsx(R,{className:h.link,to:a.original.parent?`/instances/${a.original.parent.id}/${a.original.id}`:`/instances/${a.original.id}`,children:a.original.title})},{accessor:"status",Header:"status",Cell:({row:{original:a}})=>{const{label:s}=p(a);return s},getCellIcon:({row:{original:a}})=>{const{icon:s}=p(a);return s}},{accessor:"recovery_key",Header:"recovery key",Cell:()=>"****************"},{...L,Cell:({row:{original:a}})=>t.jsx(F,{instance:a})}],[e]);return t.jsxs("div",{className:h.container,children:[t.jsx("h4",{className:"p-heading--5",children:"Instances associated"}),e&&e.length>0?t.jsx(n.ModularTable,{data:e,columns:i,getCellProps:U()}):t.jsx(P,{title:v.title,body:v.body})]})},ae=({employee:e})=>{var i,a;return t.jsxs(t.Fragment,{children:[t.jsx(Y,{employee:e}),t.jsxs(n.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(n.Col,{size:6,children:t.jsx(l,{label:"name",value:e.name})}),t.jsx(n.Col,{size:6,children:t.jsx(l,{label:"email",value:e.email})})]}),t.jsxs(n.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(n.Col,{size:6,children:t.jsx(l,{label:"employee groups",value:((a=(i=e.groups)==null?void 0:i.map(s=>s.name))==null?void 0:a.join(", "))||"N/A",type:"truncated"})}),t.jsx(n.Col,{size:6,children:t.jsx(l,{label:"status",value:B(e)})})]}),t.jsx(l,{label:"autoinstall file",value:e.autoinstall_file?`${e.autoinstall_file.filename}, v${e.autoinstall_file.version}`:t.jsx(D,{})}),t.jsx(W,{instances:e.computers})]})};export{ae as default};
