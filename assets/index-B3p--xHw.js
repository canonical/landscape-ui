const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-WNHYFP2o.js","assets/index-Bkui-3Ps.js","assets/index-_FhOAPYM.css","assets/SidePanelFormButtons-BYwQgslj.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/useRoles-Bx6xSQdj.js"])))=>i.map(i=>d[i]);
import{H as j,a3 as A,K as h,c as b,C as k,j as e,n as u,an as F,L as E,x as C,A as $,B as I,ak as M,ao as D,r as d,ag as B,N as O,m as _,p as g,E as R,$ as y}from"./index-Bkui-3Ps.js";import{P as G,a as H,b as V}from"./PageMain-C8X4eiG_.js";import{u as v}from"./useRoles-Bx6xSQdj.js";import{G as z}from"./GroupFilter-DBNiKsIr.js";import{F as q}from"./InstancesPageActions-CBbW2jcI.js";import{u as S}from"./useInstances-DRKAQXvM.js";const me={title:"",parent:A},he=j().shape({title:h().required("This field is required"),parent:h().required("This field is required")}),U="_container_vxbz8_1",Q="_searchContainer_vxbz8_11",f={container:U,searchContainer:Q},Y=()=>{const{search:s,setPageParams:t}=b(),a=()=>{t({search:o.values.searchText})},c=()=>{t({search:""})},o=k({initialValues:{searchText:s},enableReinitialize:!0,validationSchema:j().shape({search:h()}),onSubmit:a}),n=q.groupBy.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:f.container,children:[e.jsx("div",{className:f.searchContainer,children:e.jsx(u.Form,{onSubmit:o.handleSubmit,noValidate:!0,children:e.jsx(u.SearchBox,{autocomplete:"off",externallyControlled:!0,value:o.values.searchText,onChange:async i=>await o.setFieldValue("searchText",i),placeholder:"Search",onSearch:a,onClear:c})})}),e.jsx(z,{options:n},"group-by-filter")]}),e.jsx(F,{filtersToDisplay:["search"]})]})},K="_link_1wvsk_1",J={link:K},W=({accessGroup:s})=>{const{getInstancesQuery:t}=S(),{data:a,isPending:c}=t({query:`access-group: ${s.name}`,root_only:!1,with_alerts:!0,with_upgrades:!0,limit:1});if(c)return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"u-off-screen",children:"Loading..."}),e.jsx(u.Spinner,{"aria-hidden":!0})]});const o=a==null?void 0:a.data.count;return o?e.jsxs(E,{className:J.link,to:`/instances?accessGroups=${s.name}`,children:[o," ",C(o,"instance")]}):"0 instances"},X=({accessGroup:s,parentAccessGroupTitle:t})=>{const a=$(),{notify:c}=I(),{removeAccessGroupQuery:o}=v(),{getInstancesQuery:n}=S(),{value:i,setTrue:l,setFalse:r}=M(),{data:p}=n({query:`access-group: ${s.name}`,root_only:!1,with_alerts:!0,with_upgrades:!0,limit:1}),m=(p==null?void 0:p.data.count)||0,{mutateAsync:w,isPending:x}=o,T=async()=>{try{await w({name:s.name}),c.success({title:`You have successfully deleted the "${s.title}" access group.`,message:`All entities in this access group will now belong to "${t}".`})}catch(N){a(N)}finally{r()}};return e.jsxs(e.Fragment,{children:[e.jsx(D,{toggleAriaLabel:`${s.title} access group actions`,destructiveActions:[{icon:"delete",label:"Delete","aria-label":`Delete "${s.title}" access group`,onClick:l}]}),i&&e.jsxs(u.ConfirmationModal,{title:`Deleting ${s.title} access group`,confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:x,confirmButtonLoading:x,onConfirm:T,close:r,children:[m>0&&e.jsxs("p",{children:["Removing this access group will affect ",m," ",C(m,"instance"),'. They will now belong to "',t,'".']}),e.jsxs("p",{children:["This action is ",e.jsx("b",{children:"irreversible"})]})]})]})},Z=s=>{const t={};switch(s.column.id){case"title":t.role="rowheader";break;case"name":t["aria-label"]="Name";break;case"instancesCount":t["aria-label"]="Instances count";break;case"parent":t["aria-label"]="Parent";break;case"id":t["aria-label"]="Actions";break}return t},L=(s,t)=>{const a=t.find(c=>c.name===s);return a&&a.parent?[a,...L(a.parent,t)]:a?[a]:[]},P=(s,t)=>t.filter(a=>a.parent===s).map(a=>({...a,instancesCount:0,subRows:P(a.name,t)})),ee=({accessGroups:s})=>{const{groupBy:t,search:a}=b(),c=d.useMemo(()=>{const n=a?s.filter(r=>r.name.toLowerCase().includes(a.toLowerCase())||r.title.toLowerCase().includes(a.toLowerCase())):s;if(t!=="parent")return n.map(r=>({...r,instancesCount:0}));const i=Array.from(new Set([...n,...n.flatMap(r=>L(r.parent||"",s))])),l=new Set(i.filter(r=>r.parent).map(r=>r.name));return i.filter(r=>!l.has(r.name)).map(r=>({...r,instancesCount:0,subRows:P(r.name,i)}))},[s,a,t]),o=d.useMemo(()=>[{accessor:"title",Header:"title",Cell:({row:n})=>e.jsx("div",{style:{paddingLeft:`${n.depth*1.25}rem`},children:e.jsx("span",{children:n.original.title})})},{accessor:"name",Header:"name"},{accessor:"instancesCount",Header:"affected instances",sortType:(n,i)=>n.original.instancesCount-i.original.instancesCount,Cell:({row:n})=>e.jsx(W,{accessGroup:n.original})},{accessor:"parent",Header:"parent",Cell:({row:{original:n}})=>{var l;return((l=s.find(r=>r.name===n.parent))==null?void 0:l.title)||e.jsx(O,{})}},{...B,Cell:({row:n})=>{var l;if(n.original.name===A)return null;const i=((l=s.find(r=>r.name===n.original.parent))==null?void 0:l.title)||n.original.parent;return e.jsx(X,{accessGroup:n.original,parentAccessGroupTitle:i})}}],[t,s]);return e.jsx(e.Fragment,{children:e.jsx(u.ModularTable,{columns:o,data:c,sortable:!0,getCellProps:Z,emptyMsg:"No access groups found according to your search parameters."})})},se=d.lazy(()=>y(()=>import("./index-WNHYFP2o.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6]))),ae=()=>{const{getAccessGroupQuery:s}=v(),{setSidePanelContent:t}=_(),{data:a,isPending:c}=s(),o=(a==null?void 0:a.data)||[],n=()=>{t("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(se,{})}))};return e.jsxs(e.Fragment,{children:[c&&e.jsx(g,{}),!c&&o.length===0&&e.jsx(R,{title:"No access groups found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any access groups yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/access-groups",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage access groups in Landscape"})]}),cta:[e.jsx(u.Button,{appearance:"positive",onClick:n,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),!c&&o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{}),e.jsx(ee,{accessGroups:o})]})]})},te="_header_116wp_1",ne={header:te},re=d.lazy(()=>y(()=>import("./index-WNHYFP2o.js").then(s=>s.a),__vite__mapDeps([0,1,2,3,4,5,6])).then(s=>({default:s.NewAccessGroupForm}))),oe=()=>{const{setSidePanelContent:s}=_(),t=()=>{s("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(re,{})}))};return e.jsxs(G,{children:[e.jsx(H,{className:ne.header,title:"Access groups",actions:[e.jsx(u.Button,{appearance:"positive",onClick:t,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),e.jsx(V,{children:e.jsx(ae,{})})]})},ge=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"}));export{ae as A,me as I,he as V,ge as i};
