const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D1Af0lyD.js","assets/index-F5ixs2NP.js","assets/index-D38JayDC.css","assets/SidePanelFormButtons-CsLLCRpy.js","assets/SidePanelFormButtons.module-tJTvEwdD.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/useRoles-Cwy1oMtZ.js","assets/useFetchOld-IYQtjqtR.js"])))=>i.map(i=>d[i]);
import{h as b,k as h,s as S,j as e,g as i,L as w,p as k,r as d,f as x,n as f,E as T,_ as j}from"./index-F5ixs2NP.js";import{P as L,a as I,b as F}from"./PageMain-CxdJyWEW.js";import{u as _}from"./useRoles-Cwy1oMtZ.js";import{G as D}from"./GroupFilter-BIiB3x6O.js";import{u as y}from"./usePageParams-ByN77I-a.js";import{T as E}from"./TableFilterChips-5N5Oo-yw.js";import{F as G}from"./InstancesPageActions-ZWiagQKD.js";import{N as $}from"./NoData-D5--INTl.js";import{u as B}from"./useInstances-ilOChO3j.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new s.Error().stack;n&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[n]="3fc5a9a6-df5c-4fd4-8142-11c2dfbbf60b",s._sentryDebugIdIdentifier="sentry-dbid-3fc5a9a6-df5c-4fd4-8142-11c2dfbbf60b")}catch{}const de={title:"",parent:""},ue=b().shape({title:h().required("This field is required"),parent:h().required("This field is required")}),H="_container_vxbz8_1",M="_searchContainer_vxbz8_11",g={container:H,searchContainer:M},R=()=>{const{search:s,setPageParams:n}=y(),a=()=>{n({search:c.values.searchText})},o=()=>{n({search:""})},c=S({initialValues:{searchText:s},enableReinitialize:!0,validationSchema:b().shape({search:h()}),onSubmit:a}),u=G.groupBy.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:g.container,children:[e.jsx("div",{className:g.searchContainer,children:e.jsx(i.Form,{onSubmit:c.handleSubmit,noValidate:!0,children:e.jsx(i.SearchBox,{autocomplete:"off",externallyControlled:!0,value:c.values.searchText,onChange:async p=>await c.setFieldValue("searchText",p),placeholder:"Search",onSearch:a,onClear:o})})}),e.jsx(D,{options:u},"group-by-filter")]}),e.jsx(E,{filtersToDisplay:["search"]})]})},V="_link_1wvsk_1",O={link:V},z=({accessGroup:s})=>{const{getInstancesQuery:n}=B(),{data:a,isPending:o}=n({query:`access-group: ${s.name}`,root_only:!1,with_alerts:!0,with_upgrades:!0,limit:1});return a!=null&&a.data&&s.instancesCount!==a.data.count&&(s.instancesCount=a.data.count||0),o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"u-off-screen",children:"Loading..."}),e.jsx(i.Spinner,{"aria-hidden":!0})]}):a!=null&&a.data.count?e.jsx(w,{className:O.link,to:`/instances?accessGroups=${s.name}`,children:a.data.count}):e.jsx(e.Fragment,{children:"0"})},q="_actions_1hh74_1",U={actions:q},Y=s=>{const n={};switch(s.column.id){case"title":n.role="rowheader";break;case"name":n["aria-label"]="Name";break;case"instancesCount":n["aria-label"]="Instances count";break;case"parent":n["aria-label"]="Parent";break;case"id":n["aria-label"]="Actions";break}return n},C=(s,n)=>{const a=n.find(o=>o.name===s);return a&&a.parent?[a,...C(a.parent,n)]:a?[a]:[]},A=(s,n)=>n.filter(a=>a.parent===s).map(a=>({...a,instancesCount:0,subRows:A(a.name,n)})),J=({accessGroups:s})=>{const{groupBy:n,search:a}=y(),{removeAccessGroupQuery:o}=_(),c=k(),{mutateAsync:u,isPending:p}=o,v=d.useMemo(()=>{const t=a?s.filter(r=>r.name.toLowerCase().includes(a.toLowerCase())||r.title.toLowerCase().includes(a.toLowerCase())):s;if(n!=="parent")return t.map(r=>({...r,instancesCount:0}));const l=Array.from(new Set([...t,...t.flatMap(r=>C(r.parent||"",s))])),m=new Set(l.filter(r=>r.parent).map(r=>r.name));return l.filter(r=>!m.has(r.name)).map(r=>({...r,instancesCount:0,subRows:A(r.name,l)}))},[s,a,n]),N=async t=>{try{await u({name:t})}catch(l){c(l)}},P=d.useMemo(()=>[{accessor:"title",Header:"title",Cell:({row:t})=>e.jsx("div",{style:{paddingLeft:`${t.depth*1.25}rem`},children:e.jsx("span",{children:t.original.title})})},{accessor:"name",Header:"name"},{accessor:"instancesCount",Header:"affected instances",sortType:(t,l)=>t.original.instancesCount-l.original.instancesCount,Cell:({row:t})=>e.jsx(z,{accessGroup:t.original})},{accessor:"parent",Header:"parent",Cell:({row:{original:t}})=>{var m;return((m=s.find(r=>r.name===t.parent))==null?void 0:m.title)||e.jsx($,{})}},{accessor:"id",className:U.actions,Cell:({row:t})=>t.original.name==="global"?null:e.jsx("div",{className:"divided-blocks",children:e.jsx("div",{className:"divided-blocks__item",children:e.jsx(i.ConfirmationButton,{className:"u-no-margin--bottom u-no-padding--left is-small has-icon",type:"button",appearance:"base","aria-label":`Remove ${t.original.name} access group`,confirmationModalProps:{title:`Deleting ${t.original.name} access group`,children:e.jsx("p",{children:"Are you sure?"}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:p,confirmButtonLoading:p,onConfirm:()=>N(t.original.name)},children:e.jsx(i.Tooltip,{position:"btm-center",message:"Delete",children:e.jsx(i.Icon,{name:i.ICONS.delete})})})})})}],[n,s]);return e.jsx(i.ModularTable,{columns:P,data:v,sortable:!0,getCellProps:Y,emptyMsg:"No access groups found according to your search parameters."})},K=d.lazy(()=>j(()=>import("./index-D1Af0lyD.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6,7]))),Q=()=>{const{getAccessGroupQuery:s}=_(),{setSidePanelContent:n}=x(),{data:a,isPending:o}=s(),c=(a==null?void 0:a.data)||[],u=()=>{n("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(K,{})}))};return e.jsxs(e.Fragment,{children:[o&&e.jsx(f,{}),!o&&c.length===0&&e.jsx(T,{title:"No access groups found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any access groups yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/access-groups",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage access groups in Landscape"})]}),cta:[e.jsx(i.Button,{appearance:"positive",onClick:u,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),!o&&c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsx(J,{accessGroups:c})]})]})},W="_header_116wp_1",X={header:W},Z=d.lazy(()=>j(()=>import("./index-D1Af0lyD.js").then(s=>s.a),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(s=>({default:s.NewAccessGroupForm}))),ee=()=>{const{setSidePanelContent:s}=x(),n=()=>{s("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(Z,{})}))};return e.jsxs(L,{children:[e.jsx(I,{className:X.header,title:"Access groups",actions:[e.jsx(i.Button,{appearance:"positive",onClick:n,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),e.jsx(F,{children:e.jsx(Q,{})})]})},pe=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{Q as A,de as I,ue as V,pe as i};
