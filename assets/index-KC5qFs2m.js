const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DmUSJRUt.js","assets/index-CNysL-N9.js","assets/index-CeZ3lspp.css","assets/index-C-Cemkxt.css"])))=>i.map(i=>d[i]);
import{n as h,j as e,d as i,i as c,v as S,a2 as C,G as k,J as a,H as q,p as F,a1 as B,s as N}from"./index-CNysL-N9.js";const A="_container_1yori_1",E="_backButton_1yori_14",T="_chevronIcon_1yori_19",l={container:A,backButton:E,chevronIcon:T},V=c.lazy(()=>C(()=>import("./index-DmUSJRUt.js"),__vite__mapDeps([0,1,2,3]))),L=({action:o})=>{const{closeSidePanel:r,setSidePanelContent:n}=h(),u=()=>{n("Choose an identity provider",e.jsx(c.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(V,{})}))};return e.jsxs("div",{className:l.container,children:[o==="add"&&e.jsxs(i.Button,{type:"button",hasIcon:!0,onClick:u,className:l.backButton,children:[e.jsx(i.Icon,{name:"chevron-up",className:l.chevronIcon}),e.jsx("span",{children:"Back"})]}),e.jsx(i.Button,{type:"button",onClick:r,appearance:"base",className:"u-no-margin--bottom",children:"Cancel"}),e.jsx(i.Button,{type:"submit",appearance:"positive",className:"u-no-margin--bottom",children:o==="edit"?"Save changes":"Add ID provider"})]})},w={client_id:"",client_secret:"",enabled:!1,issuer:"",name:""},D=o=>k().shape({client_id:o?.provider==="ubuntu-one"?a():a().required("This field is required"),client_secret:o?.provider==="ubuntu-one"?a():a().required("This field is required"),enabled:q(),issuer:o?.provider==="ubuntu-one"?a():a().url().required("This field is required"),name:o?.provider==="ubuntu-one"?a():a().required("This field is required")}),Q="_urlContainer_1l27h_1",R="_url_1l27h_1",b={urlContainer:Q,url:R},O=o=>{const{action:r,provider:n}=o,u=F(),{closeSidePanel:_}=h(),{getSingleProviderQuery:v,addProviderQuery:f,updateProviderQuery:x,toggleUbuntuOneQuery:g}=B(),{data:s}=v({providerId:r==="edit"?n.id:0},{enabled:r==="edit"&&n.provider!=="ubuntu-one"}),{mutateAsync:y}=f,{mutateAsync:j}=x,{mutateAsync:I}=g,t=N({initialValues:w,onSubmit:async d=>{const m={configuration:{issuer:d.issuer,client_id:d.client_id,client_secret:d.client_secret,name:d.name,provider:r==="add"?n.provider_slug:n.provider},enabled:d.enabled};try{r==="add"?await y(m):n.provider==="ubuntu-one"?await I({ubuntu_one:d.enabled}):await j({...m,providerId:n.id}),_()}catch(P){u(P)}},validationSchema:D(r==="edit"?n:null)});c.useEffect(()=>{r!=="edit"||n.provider!=="ubuntu-one"||t.setFieldValue("enabled",n.enabled)},[r,n]),c.useEffect(()=>{s&&t.setValues({client_id:s.data.configuration.client_id,client_secret:s.data.configuration.client_secret,enabled:s.data.enabled,issuer:s.data.configuration.issuer,name:s.data.configuration.name})},[s]);const p=r==="edit"&&!o.canBeDisabled&&s?.data.enabled;return e.jsxs(i.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[(r!=="edit"||n.provider!=="ubuntu-one")&&e.jsxs("div",{className:b.urlContainer,children:[e.jsx("span",{children:"Redirect URL "}),e.jsx(i.Icon,{name:"information"}),e.jsx("code",{className:b.url,children:r==="add"?n.redirect_uri:s?.data.redirect_uri}),e.jsx("p",{className:"p-text--small u-text--muted u-no-margin--bottom",children:"You will need to set this in the configuration of your identity provider."})]}),e.jsx(i.Tooltip,{message:p&&"At least one identity provider must be active on the Landscape account.",children:e.jsx(i.Input,{type:"checkbox",label:"Enabled",...t.getFieldProps("enabled"),checked:t.values.enabled,disabled:p,help:`If checked the identity provider will be enabled. ${r==="add"?"when it is created.":"for logging in."}`})}),(r!=="edit"||n.provider!=="ubuntu-one")&&e.jsxs(e.Fragment,{children:[e.jsx(i.Input,{type:"text",label:"Name",required:!0,...t.getFieldProps("name"),autoComplete:"off",error:t.touched.name&&t.errors.name?t.errors.name:void 0}),e.jsx(i.Input,{type:"text",label:"Client ID",required:!0,...t.getFieldProps("client_id"),autoComplete:"off",error:t.touched.client_id&&t.errors.client_id?t.errors.client_id:void 0}),e.jsx(i.Input,{type:"text",label:"Client Secret",required:!0,...t.getFieldProps("client_secret"),autoComplete:"off",error:t.touched.client_secret&&t.errors.client_secret?t.errors.client_secret:void 0}),e.jsx(i.Input,{type:"url",label:"Issuer",required:!0,...t.getFieldProps("issuer"),autoComplete:"off",error:t.touched.issuer&&t.errors.issuer?t.errors.issuer:void 0})]}),e.jsx(L,{action:r})]})};export{O as default};
