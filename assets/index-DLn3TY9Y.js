const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C3vD92xs.js","assets/index-B6Stkoqq.js","assets/index-CQO7y1Gd.css","assets/SelectAllButton-5idAC0po.js","assets/ExpandableTableFooter-D80h2AUi.js","assets/ExpandableTableFooter-DWm8zyWg.css","assets/useUsns-Ck9Sz1MS.js","assets/ResponsiveButtons-BHBlJ0TB.js","assets/ResponsiveButtons-C56n2q_V.css","assets/useUsns-DQKyxlHf.css","assets/index-opcF9JuM.css","assets/index-CD_yx7vy.js","assets/index-CjP374E6.css","assets/index-Bd2JxC64.js","assets/UsnList-W1gIMjIW.js","assets/TruncatedCell-6W0QX6-c.js","assets/TruncatedCell-CoXbu3VM.css","assets/UsnList-DXlgO95i.css"])))=>i.map(i=>d[i]);
import{j as e,o as E,x as d,H as x,r,P as o,K as h,M as I,$ as p,A as T,B as L,m as C,C as V,n as b,am as N,p as B}from"./index-B6Stkoqq.js";import{S as R}from"./SidePanelFormButtons-BPgz_Exx.js";import{h as k,a as $,b as m}from"./ResponsiveButtons-BHBlJ0TB.js";import"./InstancesPageActions-CN2y99Ow.js";import{a as D,u as F}from"./useUsns-Ck9Sz1MS.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./useInstances-Q4ZUS1W9.js";const w=({instances:t})=>{const a=t.filter(({alerts:c})=>k(c)).length,l=t.filter(({alerts:c})=>$(c)).length,s=t.filter(({alerts:c})=>!m(c)).length;return e.jsxs("div",{children:[e.jsx("span",{children:"You selected "}),e.jsx("span",{children:e.jsx("b",{children:t.length})}),e.jsx("span",{children:" instances:"}),e.jsxs("ul",{className:E({"u-no-margin--bottom":s>0}),children:[a>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Security upgrades are available for "}),e.jsx("b",{children:a}),e.jsx("span",{children:d(a,"instance")})]}),l>0&&e.jsxs("li",{children:[e.jsx("span",{children:"Regular upgrades are available for "}),e.jsx("b",{children:l}),e.jsx("span",{children:d(l,"instance")})]})]}),s>0&&e.jsxs("p",{children:[e.jsx("span",{children:"No upgrades for "}),e.jsx("span",{children:e.jsx("b",{children:s})}),e.jsxs("span",{children:[d(s,"instance")," needed."]})]})]})},j=[{id:"tab-link-instances",label:"Instances"},{id:"tab-link-packages",label:"Packages"},{id:"tab-link-usns",label:"USNs"}],g={instances:r.lazy(()=>p(()=>import("./index-C3vD92xs.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),packages:r.lazy(()=>p(()=>import("./index-CD_yx7vy.js"),__vite__mapDeps([11,1,2,6,7,8,9,3,4,5,12]))),usns:r.lazy(()=>p(()=>import("./index-Bd2JxC64.js"),__vite__mapDeps([13,1,2,14,3,4,5,15,16,6,7,8,9,17])))},z=x().shape({excludedPackages:o().of(x().shape({id:I().required(),exclude_packages:o().of(h())})),excludedUsns:o().of(h())}),O=({activeTabLinkId:t,onTabLinkClick:a,withUsnsTab:l})=>j.filter(({id:s})=>l||s!=="tab-link-usns").map(({id:s,label:c})=>({id:s,label:c,active:s===t,onClick:()=>a(s),role:"tab"})),q=t=>({excludedPackages:t.map(({id:a})=>({id:a,exclude_packages:[]})),excludedUsns:[]}),J=({selectedInstances:t})=>{const[a,l]=r.useState(j[0].id),s=t.filter(({alerts:n})=>m(n)),c=s.filter(({alerts:n})=>k(n)),f=T(),{notify:P}=L(),{closeSidePanel:_}=C(),{upgradeInstancesPackagesQuery:U}=D(),{upgradeUsnsQuery:S}=F(),{mutateAsync:y}=U,{mutateAsync:A}=S,v=async n=>{try{a==="tab-link-usns"?await A({computers:c.map(({id:u})=>({id:u,exclude_usns:n.excludedUsns}))}):await y({computers:n.excludedPackages}),_(),P.success({title:"You queued packages to be upgraded",message:`Packages on ${t.length} ${d(t.length,"instance")} will be upgraded and are queued in Activities`})}catch(u){f(u)}},i=V({initialValues:q(s),onSubmit:v,validationSchema:z});return e.jsxs(b.Form,{onSubmit:i.handleSubmit,children:[e.jsx(w,{instances:t}),e.jsx(b.Tabs,{links:O({activeTabLinkId:a,onTabLinkClick:n=>{l(n)},withUsnsTab:c.length>0})}),e.jsx(N,{children:e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":a,children:e.jsxs(r.Suspense,{fallback:e.jsx(B,{}),children:[a==="tab-link-instances"&&e.jsx(g.instances,{excludedPackages:i.values.excludedPackages,instances:s,onExcludedPackagesChange:async n=>i.setFieldValue("excludedPackages",n)}),a==="tab-link-packages"&&e.jsx(g.packages,{excludedPackages:i.values.excludedPackages,instances:s,onExcludedPackagesChange:async n=>i.setFieldValue("excludedPackages",n)}),a==="tab-link-usns"&&e.jsx(g.usns,{excludedUsns:i.values.excludedUsns,instances:c,onExcludedUsnsChange:async n=>i.setFieldValue("excludedUsns",n)})]})})}),e.jsx(R,{submitButtonDisabled:i.isSubmitting,submitButtonText:"Upgrade"})]})};export{J as Upgrades};
