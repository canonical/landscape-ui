import{d as q,i as M,k as O,j as e,n as f,q as w,ak as P,K as d,e as h,a as K,G as R,s as V,p as L,t as U,y as C,B as W,ao as Y,v as G}from"./index-DN_YS9_3.js";import{S as H}from"./SidePanelFormButtons-CeIrPige.js";import"./EmployeeList-Dy6Qa0qO.js";import{D as Q}from"./downshift.esm-C0nL96mt.js";import{u as z}from"./useGetEmployees-BYUQC9ps.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./constants-DtLZBNBu.js";const J=()=>{const s=q(),a=M(),{mutateAsync:i,isPending:o}=O({mutationKey:["employee","associate"],mutationFn:async({employee_id:n,...c})=>s.post(`employees/${n}/computers`,c),onSuccess:(n,c)=>{a.invalidateQueries({queryKey:["instances",c.computer_id]})}});return{associateEmployeeWithInstance:i,isAssociating:o}},X="_container_t3heu_1",Z="_suggestionsContainer_t3heu_5",ee="_pointer_t3heu_13",te="_highlighted_t3heu_18",se="_selectedEmployee__container_t3heu_22",ne="_selectedEmployee__name_t3heu_30",oe="_selectedEmployee__button_t3heu_35",ae="_selectedEmployee__icon_t3heu_44",le="_errorMessage_t3heu_48",r={container:X,suggestionsContainer:Z,pointer:ee,highlighted:te,selectedEmployee__container:se,selectedEmployee__name:ne,selectedEmployee__button:oe,selectedEmployee__icon:ae,errorMessage:le},ie=200,ce=(s,a)=>{const i=s.toLowerCase(),o=a.toLowerCase(),n=i.indexOf(o);return n>=0?e.jsxs(e.Fragment,{children:[s.substring(0,n),e.jsx("strong",{children:s.substring(n,n+a.length)}),s.substring(n+a.length)]}):s},re=({employee:s,setEmployee:a,error:i})=>{const[o,n]=f.useState(""),[c,m]=f.useState(!1),[p,_]=f.useState(""),g=w(),{employees:u,isFetching:l}=z({listenToUrlParams:!1},{search:o},{enabled:o.length>2}),y=t=>s?.id!==t.id,x=u.filter(y),I=()=>{a(null)},F=()=>{m(!1)},E=()=>{_(""),n("")},S=()=>{p.length>2?m(!0):m(!1)},D=t=>{_(t),t.length>2&&n(t)},k=P(()=>{try{S()}catch(t){g(t)}},ie),A=t=>{t&&(a(t),m(!1),E())},B=t=>{t.key==="Escape"?t.currentTarget.blur():k()},j=!c&&p.length<3?"Min 3. characters":u.length===0&&o&&!l?`No employees found by "${o}"`:null;return e.jsxs("div",{className:d(r.container,{"is-error":!!i}),children:[e.jsx(Q,{onSelect:A,itemToString:()=>"",isOpen:c,children:({getInputProps:t,getItemProps:T,getMenuProps:v,highlightedIndex:$})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx("label",{className:"p-form__label",htmlFor:"employee-searchbox",id:"employee-searchbox-label",children:"Employee"}),e.jsx(h.SearchBox,{...t(),id:"employee-searchbox",placeholder:"Search for an employee",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:p,onChange:D,onClear:E,onBlur:F,onFocus:S,onKeyUp:B}),j?e.jsx("span",{className:"p-form-help-text",children:j}):null,c&&(x.length>0||l)?e.jsx("ul",{className:d("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",r.suggestionsContainer),...v(),children:l?e.jsx(K,{}):x.map((b,N)=>e.jsx("li",{className:d("p-list__item",r.pointer,{[r.highlighted]:$===N}),...T({item:b,index:N}),children:e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:ce(b.name,o)})},b.id))}):null]})}),!!i&&e.jsx("p",{className:d(r.errorMessage,"p-form-validation__message is-error"),children:i}),s&&e.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:e.jsxs("li",{className:d("p-autocomplete__result p-list__item p-card u-no-margin--bottom",r.selectedEmployee__container),children:[e.jsx("span",{className:r.selectedEmployee__name,children:s.name}),e.jsx(h.Button,{type:"button",title:"Remove",appearance:"link",className:d("u-no-margin--bottom",r.selectedEmployee__button),onClick:I,children:e.jsx(h.Icon,{name:h.ICONS.delete,className:r.selectedEmployee__icon})})]},s.id)})]})},be=({instanceTitle:s})=>{const{instanceId:a,childInstanceId:i}=R(),o=w(),{notify:n}=V(),{closeSidePanel:c}=L(),m=Number(i??a),{associateEmployeeWithInstance:p,isAssociating:_}=J(),g=async l=>{if(l.employee)try{await p({computer_id:m,employee_id:l.employee.id}),c(),n.success({title:`You have successfully associated ${l.employee.name}`,message:`${l.employee.name} has been successfully associated with ${s}.`})}catch(y){o(y)}},u=U({initialValues:{employee:null},validationSchema:C().shape({employee:C().shape({id:Y().required(),name:W().required()}).nullable().required("This field is required.")}),enableReinitialize:!0,onSubmit:g});return e.jsxs(h.Form,{noValidate:!0,onSubmit:u.handleSubmit,children:[e.jsx("p",{children:"You can associate the instance with the selected employee, allowing them to view its details and recovery key."}),e.jsx(re,{employee:u.values.employee,setEmployee:async l=>await u.setFieldValue("employee",l),error:G(u,"employee")}),e.jsx(H,{submitButtonDisabled:_,submitButtonText:"Associate",submitButtonAppearance:"positive"})]})};export{be as default};
