import{e as L,j as e,g as n,r as h,L as D,R as k}from"./index-BtF_YtUH.js";import{u as v,c as m,a as x,W as w,b as $}from"./WslInstanceList.module-jIyNz5AF.js";import{u as B}from"./useConfirm-DuPebGn3.js";import{u as N}from"./useInstances-lNNVV6pA.js";import"./EmptyState-DEWIlzdx.js";import"./useFetchOld-BGOduMhT.js";import"./useMutation-BYbif-23.js";import"./useQuery-BwHZd3cH.js";const S=({instance:s,parentId:a})=>{const c=L(),{confirmModal:o,closeConfirmModal:r}=B(),{setDefaultChildInstanceQuery:i,deleteChildInstancesQuery:p}=v(),{removeInstancesQuery:g}=N(),{mutateAsync:t}=i,{mutateAsync:l}=p,{mutateAsync:d}=g,b=async()=>{try{await t({child_id:s.id,parent_id:a})}catch(u){c(u)}finally{r()}},f=()=>{o({title:"Set default instance",body:`Are you sure you want to set ${s.title} as default instance?`,buttons:[e.jsx(n.Button,{appearance:"positive",onClick:b,children:"Set default"},"set-default")]})},C=async()=>{try{await l({computer_ids:[s.id]})}catch(u){c(u)}finally{r()}},j=()=>{o({title:"Delete instance",body:e.jsxs("p",{children:["This will permanently delete the instance ",e.jsx("b",{children:s.title})," from both the Windows host machine and Landscape."]}),buttons:[e.jsx(n.Button,{appearance:"negative",onClick:C,children:"Delete"},"delete")]})},y=async()=>{try{await d({computer_ids:[s.id]})}catch(u){c(u)}finally{r()}},I=()=>{o({title:"Remove instance from Landscape",body:e.jsxs("p",{children:["This will remove the instance ",e.jsx("b",{children:s.title})," from Landscape.",e.jsx("br",{}),e.jsx("br",{}),"It will remain on the parent machine. You can re-register it to Landscape at any time."]}),buttons:[e.jsx(n.Button,{appearance:"negative",onClick:y,children:"Remove"},"remove")]})};return e.jsxs(n.ContextualMenu,{position:"left",toggleClassName:m.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(n.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${s.title} instance actions`},children:[e.jsx(n.Button,{type:"button",appearance:"base",className:m.actionButton,onClick:f,"aria-label":`Set ${s.title} as default instance`,children:"Set default instance"}),e.jsx(n.Button,{type:"button",appearance:"base",className:m.actionButton,onClick:I,"aria-label":`Remove ${s.title} instance from Landscape`,children:"Remove from Landscape"}),e.jsx(n.Button,{type:"button",appearance:"base",className:m.actionButton,onClick:j,"aria-label":`Delete ${s.title} instance`,children:"Delete instance"})]})},R=({instance:s})=>{const[a,c]=h.useState([]),[o,r]=h.useState(""),i=h.useMemo(()=>o?s.children.filter(({title:t,hostname:l})=>t.toLowerCase().includes(o.toLowerCase())||l.toLowerCase().includes(o.toLowerCase())):s.children,[s,o]),p=t=>{c(l=>l.some(({id:d})=>d===t.id)?l.filter(({id:d})=>d!==t.id):[...l,t])},g=h.useMemo(()=>[{accessor:"title",Header:e.jsxs(e.Fragment,{children:[e.jsx(n.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),checked:i.length>0&&a.length===i.length,indeterminate:a.length>0&&a.length<i.length,onChange:()=>{c(a.length>0?[]:i)}}),e.jsx("span",{children:"Title"})]}),Cell:({row:t})=>e.jsxs("div",{className:x.title,children:[e.jsx(n.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${t.original.title} instance`}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:a.some(({id:l})=>l===t.original.id),onChange:()=>p(t.original)}),e.jsx(D,{to:`${k}instances/${s.id}/${t.original.id}`,children:t.original.title})]})},{accessor:"distribution",Header:"OS",Cell:({row:{original:t}})=>t.distribution?`UbuntuÂ ${t.distribution}`:"Unknown"},{accessor:"default",Header:"Default",Cell:({row:t})=>e.jsx("span",{children:t.original.title===s.default_child?"Yes":"No"})},{accessor:"actions",className:x.actions,Header:"Actions",Cell:({row:{original:t}})=>e.jsx(S,{instance:t,parentId:s.id})}],[i,a]);return e.jsxs(e.Fragment,{children:[e.jsx(w,{resetQuery:()=>r(""),selectedInstances:a,setQuery:t=>r(t)}),e.jsx(n.ModularTable,{columns:g,data:i})]})},W=({instance:s})=>s.children.length!==0?e.jsx(R,{instance:s}):e.jsx($,{}),P=W;export{P as default};
