const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-qbcerr2f.js","assets/index-CmxBU4NC.js","assets/index-DBjrXwEZ.css","assets/HeaderWithSearch-BJGK9Eki.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/CellInput-DJTcL1mN.js","assets/SidePanelTablePagination-C4GrRKtm.js","assets/PageMain-HAy_3diO.js","assets/PageMain--v5xNZ5p.css","assets/useRoles-M8RXtHI6.js","assets/index-Bd5xryFE.css","assets/index-BtQOMQ1O.js","assets/AssociationBlock-iFZJw_ml.js","assets/MultiSelectField-CHpOCeBs.js","assets/MultiSelectField-GyNA33om.css","assets/useInstances-DESvaoOy.js","assets/AssociationBlock-DQBJa-xL.css","assets/SidePanelFormButtons-mHwZFPQl.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/index-wHHhBgHF.js","assets/index-CJxPaa5c.js","assets/FileInput-CFdG3j2-.js","assets/PackageProfileConstraintsBlock-DqqtSIr7.js","assets/PackageProfileConstraintsBlock-BiZCuDKK.css","assets/index-C9DK3QBb.css"])))=>i.map(i=>d[i]);
import{f as R,i as M,e as Q,g as _,h as S,C as A,G as j,K as O,H as z,F as I,a9 as B,r,j as e,o as P,m as t,l as b,_ as k,y as F,z as E,I as v,a1 as q,c as H,n as V,N as K,ah as W,E as G}from"./index-CmxBU4NC.js";import{P as U,a as Y,b as J}from"./PageMain-HAy_3diO.js";import{H as D}from"./HeaderWithSearch-BJGK9Eki.js";import{S as X}from"./SidePanelTablePagination-C4GrRKtm.js";import{u as Z}from"./useRoles-M8RXtHI6.js";function T(){const a=R(),s=M(),c=Q(),u=(i={},l={})=>S({queryKey:["packageProfiles",i],queryFn:async()=>s.get("packageprofiles",{params:i}),...l}),m=_({mutationFn:async i=>s.post("packageprofiles",i),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),o=_({mutationFn:async i=>s.post("packageprofiles",i),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),p=_({mutationFn:async i=>c.get("RemovePackageProfile",{params:i}),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),g=_({mutationFn:async({name:i,...l})=>s.put(`packageprofiles/${i}`,l),onSuccess:async()=>a.invalidateQueries({queryKey:["packageProfiles"]})}),x=({instanceId:i,...l},y={})=>S({queryKey:["instancePackageProfiles",{instanceId:i,...l}],queryFn:async()=>s.get(`computers/${i}/packages/profile`,{params:l}),...y}),n=({name:i,...l},y={})=>S({queryKey:["packageProfileConstraints",{name:i,...l}],queryFn:async()=>s.get(`packageprofiles/${i}/constraints`,{params:l}),...y}),d=_({mutationFn:async({name:i,...l})=>s.post(`packageprofiles/${i}/constraints`,l),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),h=_({mutationFn:async({id:i,name:l,...y})=>s.put(`packageprofiles/${l}/constraints/${i}`,y),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])}),f=_({mutationFn:async({name:i,...l})=>s.delete(`packageprofiles/${i}/constraints`,{params:l}),onSuccess:async()=>Promise.all([a.invalidateQueries({queryKey:["packageProfiles"]}),a.invalidateQueries({queryKey:["packageProfileConstraints"]})])});return{addPackageProfileConstraintsQuery:d,copyPackageProfileQuery:m,createPackageProfileQuery:o,editPackageProfileConstraintQuery:h,editPackageProfileQuery:g,getInstancePackageProfileQuery:x,getPackageProfileConstraintsQuery:n,getPackageProfilesQuery:u,removePackageProfileConstraintsQuery:f,removePackageProfileQuery:p}}const w={constraint:"",notAnyVersion:!1,package:"",rule:"",version:""},Qe=Object.fromEntries(Object.keys(w).map(a=>[a,!0])),ee={constraint:"",id:0,package:"loading",rule:"",version:"",notAnyVersion:!1},ae=[{label:"Any",value:""},{label:"Newer or equal to",value:">="},{label:"Newer than",value:">"},{label:"Equal to",value:"="},{label:"Older than",value:"<"},{label:"Older or equal to",value:"<="}],se=[{label:"Select",value:""},{label:"Conflicts with",value:"conflicts"},{label:"Depends on",value:"depends"}],ze={access_group:"",all_computers:!1,constraints:[w],constraintsType:"",csvFile:null,description:"",isCsvFileParsed:!1,material:"",source_computer_id:0,tags:[],title:""},Be=A().shape({access_group:j(),all_computers:I(),constraints:O().when("constraintsType",{is:"manual",then:a=>a.of(A().shape({constraint:j().required("Required."),notAnyVersion:I(),package:j().required("Required."),rule:j().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")}),version:j().when("notAnyVersion",{is:!0,then:s=>s.required("Required.")})})).min(1,"Package profiles must have at least one package constraint.")}),constraintsType:j().required("This field is required."),csvFile:B().nullable().test({name:"mime-type",message:"Invalid file type.",test:a=>!a||a.type==="text/csv"}).when("constraintsType",{is:"material",then:a=>a.required("This field is required.")}),description:j().required("This field is required."),isCsvFileParsed:I(),material:j().when("constraintsType",{is:"material",then:a=>a.required("The file cannot be empty.")}),source_computer_id:z().when("constraintsType",{is:"instance",then:a=>a.min(1,"This field is required.")}),tags:O().of(j()),title:j().required("This field is required.")}),ne="_constraint_1lz67_1",te="_hidden_1lz67_5",L={constraint:ne,hidden:te},oe=({row:a,column:s})=>{const c={};return a.original.package==="loading"?s.id==="package"?c.colSpan=3:(c.className=L.hidden,c["aria-hidden"]=!0):s.id==="package"?c.role="rowheader":s.id==="constraint"?c["aria-label"]="Constraint":s.id==="rule"?c["aria-label"]="Rule":s.id==="version"&&(c["aria-label"]="Version"),c},ie=({isConstraintsLoading:a,profileConstraints:s,search:c})=>{const u=r.useMemo(()=>a?[ee]:s?s.map(o=>({...o,notAnyVersion:!!o.version})):[],[a,s]),m=r.useMemo(()=>[{accessor:"constraint",className:L.constraint,Header:"Constraint",Cell:({row:{original:o}})=>{var p;return((p=se.find(({value:g})=>g===o.constraint))==null?void 0:p.label)??o.constraint}},{accessor:"package",Header:"Package",Cell:({row:{original:o}})=>o.package==="loading"?e.jsx(P,{}):o.package},{accessor:"version",Header:"Version",Cell:({row:{original:o}})=>{var p;return o.version?`${(p=ae.find(({value:g})=>g===o.rule))==null?void 0:p.label} ${o.version}`:"Any"}}],[u]);return e.jsx(t.ModularTable,{columns:m,data:u,getCellProps:oe,emptyMsg:`No constraints found with the search: "${c}"`})},ce="_actions_nxngq_1",re={actions:ce},le=r.lazy(()=>k(()=>import("./index-qbcerr2f.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),de=({profile:a})=>{const[s,c]=r.useState(1),[u,m]=r.useState(20),[o,p]=r.useState(""),{setSidePanelContent:g}=b(),{getPackageProfileConstraintsQuery:x}=T(),{data:n,isLoading:d}=x({name:a.name,limit:u,offset:(s-1)*u,search:o}),h=()=>{g(`Change "${a.title}" profile's constraints`,e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(le,{profile:a})}),"medium")};return e.jsxs(e.Fragment,{children:[!o&&s===1&&u===20&&d&&e.jsx(P,{}),(o||s!==1||u!==20||!d&&n&&n.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(D,{className:re.actions,onSearch:f=>p(f),actions:e.jsx(t.Button,{className:"u-no-margin--bottom",type:"button",onClick:h,children:"Change package constraints"})}),e.jsx(ie,{isConstraintsLoading:d,profileConstraints:n==null?void 0:n.data.results,search:o}),e.jsx(X,{currentPage:s,pageSize:u,paginate:f=>c(f),setPageSize:f=>m(f),totalItems:n==null?void 0:n.data.count})]})]})},ue=r.lazy(async()=>k(()=>import("./index-BtQOMQ1O.js"),__vite__mapDeps([11,1,2,12,13,14,15,16,17,18,19,9,7,8,3,4,6]))),pe=r.lazy(async()=>k(()=>import("./index-wHHhBgHF.js"),__vite__mapDeps([20,1,2,17,18,19,12,13,14,15,16,7,8,3,4,6,9]))),ge=({profile:a})=>{var y;const[s,c]=r.useState(!1),u=F(),{notify:m}=E(),{closeSidePanel:o,setSidePanelContent:p}=b(),{removePackageProfileQuery:g}=T(),{mutateAsync:x,isPending:n}=g,d=()=>{c(!0)},h=()=>{c(!1)},f=async()=>{try{await x({name:a.name}),h(),o(),m.success({message:`Package profile "${a.name}" removed successfully.`,title:"Package profile removed"})}catch(N){u(N)}},i=()=>{p("Edit package profile",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(pe,{profile:a})}))},l=()=>{p("Duplicate package profile",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ue,{profile:a})}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(t.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:l,children:[e.jsx(t.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate profile"})]}),e.jsxs(t.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:i,children:[e.jsx(t.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(t.Button,{className:"p-segmented-control__button",hasIcon:!0,type:"button",onClick:d,"aria-label":`Remove ${a.title} package profile`,children:[e.jsx(t.Icon,{name:t.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(t.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(t.Col,{size:3,children:e.jsx(v,{label:"Name",value:a.title})}),e.jsx(t.Col,{size:9,children:e.jsx(v,{label:"Description",value:a.description})}),e.jsx(t.Col,{size:3,children:e.jsx(v,{label:"Access group",value:a.access_group})}),e.jsx(t.Col,{size:9,children:e.jsx(v,{label:"Tags",value:a.tags.join(", ")})}),e.jsx(t.Col,{size:3,children:e.jsx(v,{label:"Associated to",value:`${a.computers.constrained.length} instances`})}),e.jsx(t.Col,{size:3,children:e.jsx(v,{label:"Pending on",value:`${((y=a.computers.pending)==null?void 0:y.length)??0} instances`})}),e.jsx(t.Col,{size:3,children:e.jsx(v,{label:"Not compliant on",value:`${a.computers["non-compliant"].length} instances`})})]}),e.jsx(de,{profile:a}),e.jsx(q,{isOpen:s,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:n,confirmButtonDisabled:n,close:h,confirmationText:`remove ${a.name}`,onConfirm:f,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},me="_noWrap_bjhex_1",he="_toggleButton_bjhex_5",fe="_menu_bjhex_10",$={noWrap:me,toggleButton:he,menu:fe},Pe=r.lazy(async()=>k(()=>import("./index-qbcerr2f.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),xe=r.lazy(async()=>k(()=>import("./index-BtQOMQ1O.js"),__vite__mapDeps([11,1,2,12,13,14,15,16,17,18,19,9,7,8,3,4,6]))),ye=r.lazy(async()=>k(()=>import("./index-wHHhBgHF.js"),__vite__mapDeps([20,1,2,17,18,19,12,13,14,15,16,7,8,3,4,6,9]))),je=({profile:a})=>{const[s,c]=r.useState(!1),u=F(),{notify:m}=E(),{setSidePanelContent:o}=b(),{removePackageProfileQuery:p}=T(),{mutateAsync:g,isPending:x}=p,n=()=>{o(`Change "${a.title}" profile's constraints`,e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Pe,{profile:a})}),"medium")},d=()=>{o(`Edit "${a.title}" profile`,e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ye,{profile:a})}))},h=()=>{o(`Duplicate "${a.title}" profile`,e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(xe,{profile:a})}))},f=()=>{c(!0)},i=()=>{c(!1)},l=async()=>{try{await g({name:a.name}),i(),m.success({message:`Package profile "${a.title}" removed successfully`,title:"Package profile removed"})}catch(N){u(N)}},y=[{children:e.jsxs(e.Fragment,{children:[e.jsx(t.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),"aria-label":`Edit ${a.title} profile`,hasIcon:!0,onClick:d},{children:e.jsxs(e.Fragment,{children:[e.jsx(t.Icon,{name:"applications"}),e.jsx("span",{className:$.noWrap,children:"Change package constraints"})]}),"aria-label":`Change ${a.title} package constraints`,hasIcon:!0,onClick:n},{children:e.jsxs(e.Fragment,{children:[e.jsx(t.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate"})]}),"aria-label":`Duplicate ${a.title} profile`,hasIcon:!0,onClick:h},{children:e.jsxs(e.Fragment,{children:[e.jsx(t.Icon,{name:t.ICONS.delete}),e.jsx("span",{children:"Remove"})]}),"aria-label":`Remove ${a.title} profile`,hasIcon:!0,onClick:f}];return e.jsxs(e.Fragment,{children:[e.jsx(t.ContextualMenu,{position:"left",className:$.menu,toggleClassName:$.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(t.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${a.title} profile actions`},links:y}),e.jsx(q,{isOpen:s,title:"Remove package profile",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonLoading:x,confirmButtonDisabled:x,close:i,confirmationText:`remove ${a.name}`,onConfirm:l,children:e.jsxs("p",{children:['This will remove "',a.title,'" profile. This action is'," ",e.jsx("b",{children:"irreversible"}),"."]})})]})},ke=`These instances are not compliant
with the profile. They do not have a
pending activity to become compliant.`,_e=`These instances are not compliant
with the profile. They do have a
pending activity to apply its
constraints.`,ve=({column:a})=>{const s={};return a.id==="name"?s.role="rowheader":a.id==="description"?s["aria-label"]="Description":a.id==="access_group"?s["aria-label"]="Access group":a.id==="tags"?s["aria-label"]="Tags":a.id==="computers['non-compliant']"?s["aria-label"]="Not compliant instances":a.id==="computers['pending']"?s["aria-label"]="Pending instances":a.id==="computers['constrained']"?s["aria-label"]="Associated instances":a.id==="actions"&&(s["aria-label"]="Actions"),s},Ce="_truncated_gca7y_1",be="_noWrap_gca7y_2",Te="_actions_gca7y_11",Ne="_description_gca7y_19",C={truncated:Ce,noWrap:be,actions:Te,description:Ne},Se=({packageProfiles:a})=>{const{search:s}=H(),{setSidePanelContent:c}=b(),{getAccessGroupQuery:u}=Z(),{data:m}=u(),o=(m==null?void 0:m.data.map(({name:n,title:d})=>({label:d,value:n})))??[],p=n=>{c(n.title,e.jsx(ge,{profile:n}),"medium")},g=r.useMemo(()=>s?a.filter(n=>n.title.toLowerCase().includes(s.toLowerCase())):a,[a,s]),x=r.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:{original:n}})=>e.jsx(t.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{p(n)},children:n.title})},{accessor:"description",className:V(C.truncated,C.description),Header:"Description"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:{access_group:n}}})=>{var d;return((d=o.find(({value:h})=>h===n))==null?void 0:d.label)??n}},{accessor:"tags",className:C.truncated,Header:"Tags",Cell:({row:{original:{tags:n}}})=>n.length>0?n.join(", "):e.jsx(K,{})},{accessor:"computers['non-compliant']",Header:e.jsxs("div",{className:C.noWrap,children:[e.jsx("span",{children:"Not compliant "}),e.jsx(t.Tooltip,{position:"btm-left",message:ke,children:e.jsx(t.Icon,{name:"help"})})]}),Cell:({row:{original:n}})=>e.jsx(e.Fragment,{children:`${n.computers["non-compliant"].length} ${n.computers["non-compliant"].length===1?"instance":"instances"}`})},{accessor:"computers['pending']",Header:e.jsxs("div",{className:C.noWrap,children:[e.jsx("span",{children:"Pending "}),e.jsx(t.Tooltip,{position:"btm-left",message:_e,children:e.jsx(t.Icon,{name:"help"})})]}),Cell:({row:{original:n}})=>{var d,h;return e.jsx(e.Fragment,{children:`${((d=n.computers.pending)==null?void 0:d.length)??0} ${((h=n.computers.pending)==null?void 0:h.length)===1?"instance":"instances"}`})}},{accessor:"computers['constrained']",Header:"Associated",Cell:({row:{original:n}})=>e.jsx(e.Fragment,{children:`${n.computers.constrained.length} ${n.computers.constrained.length===1?"instance":"instances"}`})},{accessor:"actions",className:C.actions,Header:"Actions",Cell:({row:{original:n}})=>e.jsx(je,{profile:n})}],[g,o.length]);return e.jsx(t.ModularTable,{columns:x,data:g,emptyMsg:`No package profiles found with the search "${s}"`,getCellProps:ve})},Ie=()=>e.jsxs(e.Fragment,{children:[e.jsx(D,{}),e.jsx(W,{filtersToDisplay:["search"]})]}),$e=r.lazy(()=>k(()=>import("./index-CJxPaa5c.js").then(a=>a.i),__vite__mapDeps([21,1,2,22,23,5,24,15,9,12,13,14,16,17,18,19,25]))),Ae=()=>{const{setSidePanelContent:a}=b(),s=()=>{a("Add package profile",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx($e,{})}),"medium")};return e.jsx(G,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You haven’t added any package profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-packages",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage packages in Landscape"})]}),cta:[e.jsx(t.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add")],title:"No package profiles found"})},Oe=({packageProfiles:a=[]})=>e.jsxs(e.Fragment,{children:[e.jsx(Ie,{}),e.jsx(Se,{packageProfiles:a})]}),Fe=()=>{const{getPackageProfilesQuery:a}=T(),{data:s,isLoading:c}=a();return e.jsxs(e.Fragment,{children:[c&&e.jsx(P,{}),!c&&(!s||s.data.result.length===0)&&e.jsx(Ae,{}),!c&&s&&s.data.result.length>0&&e.jsx(Oe,{packageProfiles:s==null?void 0:s.data.result})]})},Ee=r.lazy(()=>k(()=>import("./index-CJxPaa5c.js").then(a=>a.a),__vite__mapDeps([21,1,2,22,23,5,24,15,9,12,13,14,16,17,18,19,25])).then(a=>({default:a.PackageProfileCreateForm}))),qe=()=>{const{setSidePanelContent:a}=b(),s=()=>{a("Add package profile",e.jsx(r.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ee,{})}),"medium")};return e.jsxs(U,{children:[e.jsx(Y,{title:"Package profiles",actions:[e.jsx(t.Button,{type:"button",appearance:"positive",onClick:s,children:"Add package profile"},"add-package-profile")]}),e.jsx(J,{children:e.jsx(Fe,{})})]})},He=Object.freeze(Object.defineProperty({__proto__:null,default:qe},Symbol.toStringTag,{value:"Module"}));export{se as C,w as E,ze as I,ee as L,Se as P,Qe as T,Be as V,ae as a,Ie as b,Ae as c,He as i,T as u};
