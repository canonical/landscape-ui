import{b as w,e as P,f as T,j as e,i as D,p as $,ao as V,d,o as I,v,P as L,q as R,n as U,s as Q}from"./index-CNysL-N9.js";import{S as W}from"./SidePanelFormButtons-M1anpLEA.js";import"./index-DFOXV98U.js";import"./AutoinstallFileVersionHistory-CI7mysYb.js";import"./EmployeeList-DQbEg6gQ.js";import{u as Y}from"./index-D6EAQGig.js";import{D as G}from"./downshift.esm-NCfJqLaf.js";import{u as H}from"./useGetEmployees-3AZP353b.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";import"./HeaderWithSearch-CvedKTiw.js";import"./SidePanelTablePagination-CiKesZiF.js";import"./InstanceRemoveFromLandscapeModal-BOZEvTxX.js";import"./useRemoveInstancesFromLandscape-DMxb7EIB.js";import"./useRoles-DskEo6KR.js";import"./WslInstancesEmptyState-BImifQ_s.js";import"./GroupFilter-BzYr0gmU.js";import"./useExpandableRow-DxiOSS1-.js";const M=()=>{const s=w(),o=P(),{mutateAsync:r,isPending:c}=T({mutationKey:["employee","associate"],mutationFn:async({employee_id:t,...i})=>s.post(`employees/${t}/computers`,i),onSuccess:(t,i)=>{o.invalidateQueries({queryKey:["instances",i.computer_id]})}});return{associateEmployeeWithInstance:r,isAssociating:c}},z=()=>{const s=w(),o=P(),{mutateAsync:r,isPending:c}=T({mutationKey:["employee","disassociate"],mutationFn:async({employee_id:t,computer_id:i})=>s.delete(`employees/${t}/computers/${i}`),onSuccess:(t,i)=>{o.invalidateQueries({queryKey:["instances",i.computer_id]})}});return{disassociateEmployeeFromInstance:r,isDisassociating:c}},J="_container_cafe2_1",X="_suggestionsContainer_cafe2_5",Z="_pointer_cafe2_12",ee="_highlighted_cafe2_17",se="_selectedContainer_cafe2_21",g={container:J,suggestionsContainer:X,pointer:Z,highlighted:ee,selectedContainer:se},te=200,ae=(s,o)=>{const r=s.toLowerCase(),c=o.toLowerCase(),t=r.indexOf(c);return t>=0?e.jsxs(e.Fragment,{children:[s.substring(0,t),e.jsx("strong",{children:s.substring(t,t+o.length)}),s.substring(t+o.length)]}):s},ne=({employee:s,setEmployee:o,loadingExistingEmployee:r})=>{const[c,t]=D.useState(""),[i,u]=D.useState(!1),[m,y]=D.useState(""),_=$(),{employees:f,isFetching:p}=H({listenToUrlParams:!1},{search:c,with_groups:!0},{enabled:c.length>2}),S=a=>s?.id!==a.id,b=f.filter(S),j=()=>{o(null)},C=()=>{u(!1)},N=()=>{y(""),t("")},l=()=>{m.length>2?u(!0):u(!1)},E=a=>{y(a),a.length>2&&t(a)},n=V(()=>{try{l()}catch(a){_(a)}},te),h=a=>{a&&(o(a),u(!1),N())},B=a=>{a.key==="Escape"?a.currentTarget.blur():n()},F=!i&&m.length<3?"Min 3. characters":f.length===0&&c&&!p?`No employees found by "${c}"`:null;return e.jsxs("div",{className:g.container,children:[e.jsx(G,{onSelect:h,itemToString:()=>"",isOpen:i,children:({getInputProps:a,getItemProps:O,getMenuProps:k,highlightedIndex:K})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(d.SearchBox,{...a(),placeholder:"Search for employees",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:m,onChange:E,onClear:N,onBlur:C,onFocus:l,onKeyUp:B}),F?e.jsx("span",{className:"p-form-help-text",children:F}):null,i&&(b.length>0||p)?e.jsx("ul",{className:I("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",g.suggestionsContainer),...k(),children:p?e.jsx(v,{}):b.map((x,A)=>e.jsxs("li",{className:I("p-list__item",g.pointer,{[g.highlighted]:K===A}),...O({item:x,index:A}),children:[e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:ae(x.name,c)}),e.jsx("small",{className:"u-text-muted",children:x.groups?.map(q=>q.name).join(", ")})]},x.id))}):null]})}),r&&e.jsx(v,{}),s&&e.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:e.jsxs("li",{className:I("p-autocomplete__result p-list__item p-card u-no-margin--bottom",g.selectedContainer),children:[e.jsxs("div",{children:[e.jsx("div",{children:s.name}),e.jsx("span",{children:e.jsx("small",{className:"u-text--muted p-text--small",children:s.groups?.map(a=>a.name).join(", ")})})]}),e.jsx(d.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom",onClick:j,children:e.jsx(d.Icon,{name:d.ICONS.delete})})]},s.id)})]})},oe=[{label:"Associate",value:"associate"},{label:"Disassociate",value:"disassociate"}],Ne=({instanceTitle:s,employeeId:o})=>{const{instanceId:r,childInstanceId:c}=L(),t=$(),{notify:i}=R(),{closeSidePanel:u}=U(),m=Number(c??r),{associateEmployeeWithInstance:y,isAssociating:_}=M(),{disassociateEmployeeFromInstance:f,isDisassociating:p}=z(),{employee:S,isPending:b}=Y({id:o||0},{enabled:!!o}),j=async n=>{try{await y({computer_id:m,employee_id:n.id}),u(),i.success({title:`You have successfully associated ${n.name}`,message:`${n.name} has been successfully associated with ${s}.`})}catch(h){t(h)}},C=async n=>{try{await f({computer_id:m,employee_id:n.id}),u(),i.success({title:`You have successfully disassociated ${n.name}`,message:`${n.name} has been successfully disassociated from ${s}.`})}catch(h){t(h)}},l=Q({initialValues:{action:"associate",employee:S||null},enableReinitialize:!0,onSubmit:async n=>{n.employee&&(n.action==="associate"?await j(n.employee):await C(n.employee))}}),E=!l.values.employee&&l.values.action==="associate"||_||p;return e.jsxs(d.Form,{noValidate:!0,onSubmit:l.handleSubmit,children:[e.jsx(d.Select,{label:"Associate or disassociate an employee",labelClassName:"u-off-screen",options:oe,...l.getFieldProps("action")}),l.values.action==="associate"&&e.jsx(ne,{employee:l.values.employee,setEmployee:async n=>await l.setFieldValue("employee",n),loadingExistingEmployee:o?b:!1}),e.jsx(W,{submitButtonDisabled:E,submitButtonText:l.values.action==="associate"?"Associate":"Disassociate",submitButtonAppearance:"positive"})]})};export{Ne as default};
