import{c as O,d as Y,r as h,l as N,e as R,j as e,g as i,f as $,_ as w,p as P,H as L}from"./index-Bwv21umG.js";import{P as U,a as K,b as G}from"./PageMain-e3QUHu3w.js";import{E as W}from"./EmptyState-BVaENBo3.js";import{u as J}from"./useFetchOld-CLIuhBjP.js";import{u as S}from"./useMutation-J8RvGgz_.js";import{u as M}from"./useQuery-Dt9EUPCN.js";import"./TablePagination.module-DLVph1Z1.js";import{T as X}from"./TablePagination-B0poA3Ik.js";import{u as E}from"./useRoles-CEVrDnUF.js";import{u as Q}from"./useConfirm-C8SdOzvQ.js";import{u as D}from"./formik.esm-1BnXfl6u.js";import{c as B,b as z,a as V}from"./index.esm-BNxcffbw.js";import{S as Z}from"./SidePanelFormButtons-CYk-y39P.js";import{I}from"./InfoItem-BANgRWDI.js";import{M as H}from"./MultiSelectField-DzfkgJ8Q.js";import{u as q}from"./usePageParams-DNXnArI_.js";import{h as k}from"./moment-Cl4UOzQZ.js";function _(){const s=O(),a=J(),r=Y(),c=(l,g={})=>M({queryKey:["administrators"],queryFn:()=>a.get("GetAdministrators"),...g}),m=S({mutationFn:l=>a.get("InviteAdministrator",{params:l}),onSuccess:()=>s.invalidateQueries(["invitations"])}),p=S({mutationFn:l=>a.get("DisableAdministrator",{params:l}),onSuccess:()=>s.invalidateQueries(["administrators"])}),b=S({mutationFn:({id:l,...g})=>r.put(`administrators/${l}`,g),onSuccess:()=>Promise.all([s.invalidateQueries(["administrators"]),s.invalidateQueries(["roles"])])}),o=(l,g={})=>M({queryKey:["invitations",l],queryFn:()=>r.get("/invitations",{params:l}),...g}),d=S({mutationFn:l=>r.delete(`/invitations/${l.id}`),onSuccess:()=>s.invalidateQueries(["invitations"])}),u=S({mutationFn:l=>r.post(`/invitations/${l.id}`),onSuccess:()=>s.invalidateQueries(["invitations"])});return{getAdministratorsQuery:c,inviteAdministratorQuery:m,disableAdministratorQuery:p,editAdministratorQuery:b,getInvitationsQuery:o,revokeInvitationQuery:d,resendInvitationQuery:u}}const ee=({administrator:s})=>{const[a,r]=h.useState(s);h.useEffect(()=>{r(s)},[s]);const{notify:c}=N(),m=R(),{confirmModal:p,closeConfirmModal:b}=Q(),{disableAdministratorQuery:o,editAdministratorQuery:d}=_(),{getRolesQuery:u}=E(),{data:l}=u(),g=(l==null?void 0:l.data.map(({name:v})=>({label:v,value:v})))??[],{mutateAsync:f}=d,{mutateAsync:x,isLoading:y}=o,j=async()=>{try{await x({email:a.email})}catch(v){m(v)}finally{b()}},A=()=>{p({title:"Disable Administrator",body:"This will remove the administrator from your Landscape organization.",buttons:[e.jsxs(i.Button,{onClick:j,appearance:"negative",hasIcon:!0,"aria-label":`Remove ${a.name}`,children:[y&&e.jsx(i.Spinner,{}),"Remove"]},"remove-administrator")]})},t=async v=>{try{await f({id:s.id,roles:v.roles}),r(C=>({...C,roles:v.roles})),c.success({title:"Permission changes have been queued",message:`You changed ${a.name}'s roles`})}catch(C){m(C)}},n=D({initialValues:{roles:[]},validationSchema:B().shape({roles:z().of(V()).min(1,"At least one role is required")}),onSubmit:t});return h.useEffect(()=>{n.setValues({roles:a.roles})},[a]),e.jsxs(i.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:[e.jsxs(i.Button,{type:"button",hasIcon:!0,onClick:A,children:[e.jsx("i",{className:"p-icon--delete","aria-hidden":"true"}),e.jsx("span",{children:"Remove"})]}),e.jsxs(i.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(i.Col,{size:6,children:e.jsx(I,{label:"Name",value:a.name})}),e.jsx(i.Col,{size:6,children:e.jsx(I,{label:"Email",value:a.email})}),e.jsx(i.Col,{size:12,children:e.jsx(I,{label:"Timezone",value:"---"})}),e.jsx(i.Col,{size:12,children:e.jsx(I,{label:"Identity URL",value:"---"})})]}),e.jsx(H,{variant:"condensed",label:"Roles",items:g,selectedItems:g.filter(({value:v})=>n.values.roles.includes(v)),placeholder:"Select roles",onItemsUpdate:v=>n.setFieldValue("roles",v.map(({value:C})=>C)),error:n.touched.roles&&typeof n.errors.roles=="string"?n.errors.roles:void 0}),e.jsx(Z,{submitButtonDisabled:n.isSubmitting||n.values.roles.length===a.roles.length&&n.values.roles.every(v=>a.roles.includes(v)),submitButtonText:"Save changes"})]})},te="_footer_i9cyy_1",se="_multiSelect_i9cyy_7",T={footer:te,multiSelect:se},ae=({administrator:s,roleOptions:a})=>{const r=R(),{notify:c}=N(),{editAdministratorQuery:m}=_(),{mutateAsync:p}=m,b=async({roles:d})=>{try{await p({id:s.id,roles:d}),c.success({title:"Permission changes have been queued",message:`You changed ${s.name}'s roles`})}catch(u){r(u)}},o=D({initialValues:{roles:[]},validationSchema:B().shape({roles:z().of(V()).min(1,"At least one role is required")}),onSubmit:b});return h.useEffect(()=>{o.setValues({roles:s.roles})},[s.roles]),e.jsx(i.Form,{onSubmit:o.handleSubmit,noValidate:!0,children:e.jsx(H,{required:!0,variant:"condensed",className:T.multiSelect,items:a,selectedItems:a.filter(({value:d})=>o.values.roles.includes(d)),onItemsUpdate:d=>o.setValues({roles:d.map(({value:u})=>u)}),placeholder:"Select roles",error:o.touched.roles&&typeof o.errors.roles=="string"?o.errors.roles:void 0,dropdownFooter:e.jsxs("div",{className:T.footer,children:[e.jsx(i.Button,{type:"button",dense:!0,small:!0,className:"u-no-margin--bottom",disabled:o.values.roles.length===s.roles.length&&s.roles.every(d=>o.values.roles.includes(d)),onClick:()=>o.setFieldValue("roles",s.roles),children:"Revert"}),e.jsx(i.Button,{type:"submit",dense:!0,small:!0,appearance:"positive",className:"u-no-margin--bottom",disabled:o.values.roles.length===s.roles.length&&s.roles.every(d=>o.values.roles.includes(d)),children:"Save changes"})]})})})},ne="_roles_1fjlo_1",ie="_actions_1fjlo_2",oe="_table_1fjlo_6",F={roles:ne,actions:ie,table:oe},re=({administrators:s,emptyMessage:a,roles:r})=>{const c=R(),{setSidePanelContent:m}=$(),{confirmModal:p,closeConfirmModal:b}=Q(),{disableAdministratorQuery:o}=_(),{mutateAsync:d,isLoading:u}=o,l=h.useMemo(()=>s,[s]),g=h.useMemo(()=>r.map(({name:t})=>({label:t,value:t})),[r]),f=async t=>{try{await d({email:t})}catch(n){c(n)}finally{b()}},x=t=>{p({body:"This will remove the administrator from your Landscape organisation.",title:`Remove ${t.name}`,buttons:[e.jsxs(i.Button,{appearance:"negative",hasIcon:!0,onClick:()=>f(t.email),"aria-label":`Remove ${t.name}`,children:[u&&e.jsx(i.Spinner,{}),e.jsx("span",{children:"Remove"})]},`remove-administrator-${t.id}`)]})},y=t=>{m(t.name,e.jsx(ee,{administrator:t}))},j=h.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:t})=>e.jsx(i.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{y(t.original)},children:t.original.name})},{accessor:"email",Header:"Email"},{accessor:"roles",className:F.roles,Header:"Roles",Cell:({row:t})=>e.jsx(ae,{administrator:t.original,roleOptions:g})},{accessor:"actions",className:F.actions,Cell:({row:t})=>e.jsxs(i.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left p-tooltip--top-center","aria-label":`Remove ${t.original.name}`,onClick:()=>x(t.original),children:[e.jsx("span",{className:"p-tooltip__message",children:"Remove"}),e.jsx(i.Icon,{name:i.ICONS.delete,className:"u-no-margin--left"})]})}],[l,g]),A=t=>{const n={};return t.column.id==="name"?n.role="rowheader":t.column.id==="email"?n["aria-label"]="Email":t.column.id==="roles"?n["aria-label"]="Roles":t.column.id==="actions"&&(n["aria-label"]="Actions"),n};return e.jsx(i.ModularTable,{columns:j,data:l,getCellProps:A,emptyMsg:a,className:F.table})},le=()=>{const{search:s,setPageParams:a}=q(),[r,c]=h.useState(s),m=()=>{a({search:r})},p=()=>{a({search:""})},b=o=>{o.preventDefault(),m()};return e.jsx(i.Row,{className:"u-no-padding--left u-no-padding--right u-no-margin--left u-no-margin--right",children:e.jsx(i.Col,{size:6,children:e.jsx(i.Form,{onSubmit:b,noValidate:!0,children:e.jsx(i.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,value:r,onChange:o=>c(o),onSearch:m,onClear:p,autocomplete:"off"})})})})},ce=({administrators:s})=>{const{search:a,pageSize:r,currentPage:c}=q(),{getRolesQuery:m}=E(),{data:p}=m(),o=(()=>{const u=a.trim().toLowerCase();return u?s.filter(l=>l.email.toLowerCase().includes(u)||l.name.toLowerCase().includes(u)||l.roles.some(g=>g.toLowerCase().includes(u))):s})(),d=o.filter((u,l)=>l>=(c-1)*r&&l<c*r)??[];return e.jsxs(e.Fragment,{children:[e.jsx(le,{}),e.jsx(re,{administrators:d,emptyMessage:a.trim()?`No administrators found with the search: "${a.trim()}"`:"You have no administrators on your Landscape organisation",roles:(p==null?void 0:p.data)??[]}),d.length>0&&e.jsx(X,{totalItems:o.length,currentItemCount:d.length})]})},de=h.lazy(()=>w(()=>import("./index-DGy-2egG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),me=()=>{const{setSidePanelContent:s}=$(),{getAdministratorsQuery:a}=_(),{data:r,isLoading:c}=a(),m=()=>{s("Invite administrator",e.jsx(h.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(de,{})}))};return e.jsxs(e.Fragment,{children:[c&&e.jsx(P,{}),!c&&(!r||!r.data.length)&&e.jsx(W,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no administrators in your Landscape organization."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[e.jsx(i.Button,{type:"button",appearance:"positive",onClick:m,children:"Invite Administrator"},"invite-administrator")],icon:"user",title:"No administrators found"}),!c&&r&&r.data.length>0&&e.jsx(ce,{administrators:r.data})]})},ue=()=>{const s=R(),{notify:a}=N(),{confirmModal:r,closeConfirmModal:c}=Q(),{getInvitationsQuery:m,revokeInvitationQuery:p,resendInvitationQuery:b}=_(),{data:o}=m(),d=h.useMemo(()=>(o==null?void 0:o.data.results.sort((t,n)=>k(n.creation_time).diff(k(t.creation_time))))??[],[o]),{mutateAsync:u}=p,{mutateAsync:l}=b,g=async t=>{try{await u({id:t.id}),a.success({message:`${t.name}â€™${t.name.endsWith("s")?"":"s"} invitation has been revoked`,title:"You revoked an administrator invite"})}catch(n){s(n)}finally{c()}},f=t=>{r({title:`Revoke invitation for ${t.name}`,body:`This action will prevent ${t.name} from joining your Landscape organisation.`,buttons:[e.jsx(i.Button,{appearance:"negative",onClick:()=>g(t),children:"Revoke invitation"},"revoke")]})},x=async t=>{try{await l({id:t.id}),a.success({message:`${t.name} will receive a new invitation email`,title:"You resent an administrator invite"})}catch(n){s(n)}finally{c()}},y=t=>{r({title:`Resend invitation for ${t.name}`,body:`${t.name} will receive a new invitation email`,buttons:[e.jsx(i.Button,{appearance:"positive",onClick:()=>x(t),children:"Resend invitation"},"resend")]})},j=h.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"email",Header:"Email"},{accessor:"creation_time",Header:"Invited",Cell:({row:t})=>k(t.original.creation_time).format(L)},{accessor:"expiration_time",Header:"Expires",Cell:({row:t})=>k(t.original.creation_time).add(14,"days").format(L)},{accessor:"actions",Cell:({row:t})=>e.jsxs("div",{className:"u-align-text--right",children:[e.jsx(i.Button,{dense:!0,small:!0,className:"u-no-margin--bottom",onClick:()=>f(t.original),children:"Revoke"}),e.jsx(i.Button,{dense:!0,small:!0,className:"u-no-margin--bottom",onClick:()=>y(t.original),children:"Resend"})]})}],[d]),A=t=>{const n={};return t.column.id==="name"?n.role="rowheader":t.column.id==="email"?n["aria-label"]="Email":t.column.id==="creation_time"?n["aria-label"]="Invited":t.column.id==="expiration_time"?n["aria-label"]="Expires":t.column.id==="actions"&&(n["aria-label"]="Actions"),n};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-text--muted p-text--small",children:"Unclaimed invitations expire after 14 days."}),e.jsx(i.ModularTable,{columns:j,data:d,getCellProps:A,emptyMsg:"You have no unclaimed invitations."})]})},he="_tabPanel_ai56l_1",pe={tabPanel:he},ge=[{label:"Administrators",id:"tab-link-administrators"},{label:"Invites",id:"tab-link-invites"}],ve=()=>{const[s,a]=h.useState("tab-link-administrators");return e.jsxs(e.Fragment,{children:[e.jsx(i.Tabs,{listClassName:"u-no-margin--bottom",links:ge.map(({label:r,id:c})=>({label:r,id:c,role:"tab",active:c===s,onClick:()=>a(c)}))}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":s,className:pe.tabPanel,children:e.jsxs(h.Suspense,{fallback:e.jsx(P,{}),children:[s==="tab-link-administrators"&&e.jsx(me,{}),s==="tab-link-invites"&&e.jsx(ue,{})]})})]})},be=h.lazy(()=>w(()=>import("./index-DGy-2egG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),fe=()=>{const{setSidePanelContent:s}=$(),a=()=>{s("Invite administrator",e.jsx(h.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(be,{})}))};return e.jsxs(U,{children:[e.jsx(K,{title:"Administrators",actions:[e.jsx(i.Button,{type:"button",onClick:a,children:"Invite administrator"},"invite-administrator")]}),e.jsx(G,{children:e.jsx(ve,{})})]})},xe=fe,we=Object.freeze(Object.defineProperty({__proto__:null,default:xe},Symbol.toStringTag,{value:"Module"}));export{we as i,_ as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-DGy-2egG.js","assets/index-Bwv21umG.js","assets/index-BAlneFez.css","assets/formik.esm-1BnXfl6u.js","assets/MultiSelectField-DzfkgJ8Q.js","assets/MultiSelectField.module-D1r8qo_i.js","assets/MultiSelectField-B2rqRhX9.css","assets/SidePanelFormButtons-CYk-y39P.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/useRoles-CEVrDnUF.js","assets/useFetchOld-CLIuhBjP.js","assets/useMutation-J8RvGgz_.js","assets/useQuery-Dt9EUPCN.js","assets/index.esm-BNxcffbw.js","assets/PageMain-e3QUHu3w.js","assets/PageMain-DyI__TtH.css","assets/EmptyState-BVaENBo3.js","assets/EmptyState-BNXajmMK.css","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/TablePagination-B0poA3Ik.js","assets/usePageParams-DNXnArI_.js","assets/useConfirm-C8SdOzvQ.js","assets/InfoItem-BANgRWDI.js","assets/InfoItem.module-BZ3tYMsb.js","assets/InfoItem-BbayMzTk.css","assets/moment-Cl4UOzQZ.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
