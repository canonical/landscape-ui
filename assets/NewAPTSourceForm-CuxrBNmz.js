import{f as x,e as G,j as r,g as s}from"./index-aXCRV7My.js";import{u as A}from"./formik.esm-Bnzr9ZOe.js";import{c as k,a}from"./index.esm-eR-gPxEp.js";import{u as v}from"./useAPTSources-BcdfgnZg.js";import{u as j}from"./useGPGKeys-C2PmG2Zt.js";import{u as F}from"./useRoles-Du5Mu2uk.js";import{t as n}from"./tests-DFnZqbNV.js";import{S as T}from"./SidePanelFormButtons-BktUqi6c.js";import"./useFetchOld-Dx05gkab.js";import"./useMutation-DTawIE4_.js";import"./useQuery-BbzlNKqA.js";import"./SidePanelFormButtons.module-DyBJG5lm.js";const D=()=>{const{closeSidePanel:l}=x(),p=G(),{createAPTSourceQuery:m,getAPTSourcesQuery:d}=v(),{getGPGKeysQuery:g}=j(),{data:i,isLoading:y}=g(),{getAccessGroupQuery:b}=F(),{data:u,isLoading:_}=b(),P=((u==null?void 0:u.data)??[]).map(t=>({label:t.title,value:t.name})),S=((i==null?void 0:i.data)??[]).filter(({has_secret:t})=>t).map(({name:t})=>({label:t,value:t})),{mutateAsync:f,isLoading:h}=m,{data:o}=d(),e=A({initialValues:{name:"",apt_line:"",gpg_key:"",access_group:""},validationSchema:k().shape({name:a().required("This field is required").test({test:n.test,message:n.message}).test({params:{getAPTSourcesResponse:o},test:t=>!((o==null?void 0:o.data)??[]).map(({name:c})=>c).includes(t),message:"It must be unique within the account."}),apt_line:a().required("This field is required"),gpg_key:a(),access_group:a()}),onSubmit:async t=>{try{await f(t),l()}catch(c){p(c)}}});return r.jsxs(s.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[r.jsx(s.Input,{type:"text",label:"Name",required:!0,error:e.touched.name&&e.errors.name?e.errors.name:void 0,...e.getFieldProps("name")}),r.jsx(s.Input,{type:"text",label:"APT Line",required:!0,error:e.touched.apt_line&&e.errors.apt_line?e.errors.apt_line:void 0,...e.getFieldProps("apt_line")}),r.jsx(s.Select,{label:"GPG key",disabled:y,options:[{label:"Select GPG key",value:""},...S],...e.getFieldProps("gpg_key"),error:e.touched.gpg_key&&e.errors.gpg_key?e.errors.gpg_key:void 0}),r.jsx(s.Select,{label:"Access group",disabled:_,options:[{label:"Select access group",value:""},...P],...e.getFieldProps("access_group"),error:e.touched.access_group&&e.errors.access_group?e.errors.access_group:void 0}),r.jsx(T,{submitButtonDisabled:h,submitButtonText:"Add APT Source"})]})};export{D as default};
