import{C as k,y as _,z as q,x as T,B as A,k as B,H as C,h as s,I as M,j as t,d as a}from"./index-CNSDWj8Q.js";import{S as Q}from"./SidePanelFormButtons-DIizKTix.js";import{M as D}from"./MultiSelectField-CqoYdMk0.js";import{u as E}from"./index-C8xZG_D3.js";import{g as i}from"./formikErrors-Bw8iTXYS.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./TablePagination-CFXNvqsZ.js";import"./TableFilterChips-06YfpJdc.js";import"./helpers-CHVZpA7p.js";import"./InstancesPageActions-DL7_pmR1.js";import"./index-D-YBZSy_.js";import"./NoData-6ZK9sV5u.js";import"./useFetchOld-BAAs34Op.js";import"./PageParamFilter-ChSwlZqZ.js";import"./TableFilter-2AKF5NjJ.js";import"./ResponsiveTable-BXalKviy.js";import"./ListTitle-BUruUKn1.js";import"./StaticLink-BEYCGcPv.js";import"./TruncatedCell-BMum6DLZ.js";import"./Truncated-Dtg97i8C.js";import"./useExpandableRow-B4jhRgod.js";import"./index-CySvbr4l.js";import"./TextConfirmationModal-q88mH05g.js";import"./InfoGrid-3w5mqARw.js";import"./InfoItem-Bt7JBIPo.js";import"./HeaderWithSearch-D2tNhOlz.js";import"./constants-CDnVvJTb.js";const ge=({user:n})=>{const{instanceId:g}=k(),h=_(),{notify:b}=q(),{closeSidePanel:w}=T(),{editUserQuery:y,getGroupsQuery:P,getUserGroupsQuery:f,addUserToGroupQuery:G,removeUserFromGroupQuery:x}=E(),u=Number(g),{data:F,isLoading:S}=P({computer_id:u}),{data:V}=f({username:n.username,computer_id:u}),{mutateAsync:I}=y,{mutateAsync:N}=G,{mutateAsync:j}=x,l=F?.data.groups??[],p=l.map(e=>({label:e.name,value:String(e.gid)})),d=V?.data.groups.map(e=>String(e.gid))||[],r=A({initialValues:{name:n.name??"",username:n.username,password:"",confirmPassword:"",location:n.location??"",homePhoneNumber:n.home_phone??"",workPhoneNumber:n.work_phone??"",primaryGroupValue:String(n.primary_gid),additionalGroupValue:d},validationSchema:B().shape({username:s().required("This field is required"),name:s(),password:s(),confirmPassword:s().when("password",([e],m)=>e&&e.length>0?m.trim().required("Confirm password is required").oneOf([M("password"),""],"Passwords must match"):m.notRequired()),location:s(),homePhoneNumber:s(),workPhoneNumber:s(),primaryGroupValue:s().required("This field is required"),additionalGroupValue:C().of(s())}),onSubmit:async e=>{const m=e.additionalGroupValue.filter(o=>!d.includes(o)),U=d.filter(o=>!e.additionalGroupValue.includes(o)),c=l.filter(o=>m.includes(String(o.gid))).map(o=>o.name);try{const o=[];m.length&&o.push(N({computer_id:u,groupnames:c,usernames:[e.username],action:"add"})),U.length&&o.push(j({computer_id:u,groupnames:c,usernames:[e.username],action:"remove"})),o.push(I({computer_ids:[u],name:e.name,username:e.username,password:e.password,location:e.location,home_phone:e.homePhoneNumber,work_phone:e.workPhoneNumber,primary_groupname:e.primaryGroupValue})),await Promise.all(o),w(),b.success({message:"User updated successfully"})}catch(o){h(o)}}});return t.jsxs(a.Form,{onSubmit:r.handleSubmit,noValidate:!0,name:"edit-user",children:[t.jsx(a.Input,{type:"text",label:"Username",required:!0,autoComplete:"new-username",error:i(r,"username"),...r.getFieldProps("username")}),t.jsx(a.Input,{type:"text",label:"Name",error:i(r,"name"),...r.getFieldProps("name")}),t.jsx(a.Input,{type:"password",label:"Password",autoComplete:"new-password",error:i(r,"password"),...r.getFieldProps("password")}),t.jsx(a.Input,{type:"password",label:"Confirm password",autoComplete:"new-password",error:i(r,"confirmPassword"),...r.getFieldProps("confirmPassword")}),t.jsx(a.Select,{"data-testid":"primaryGroupValue",label:"Primary Group",required:!0,disabled:S,options:p,...r.getFieldProps("primaryGroupValue"),error:i(r,"primaryGroupValue")}),t.jsx(D,{variant:"condensed",placeholder:"Select groups",label:"Additional Groups",items:p,selectedItems:p.filter(({value:e})=>r.values.additionalGroupValue.includes(e)),onItemsUpdate:e=>{r.setFieldValue("additionalGroupValue",e.map(({value:m})=>m))},error:i(r,"additionalGroupValue")}),t.jsx(a.Input,{type:"text",label:"Location",error:i(r,"location"),...r.getFieldProps("location")}),t.jsx(a.Input,{type:"text",label:"Home phone",error:i(r,"homePhoneNumber"),...r.getFieldProps("homePhoneNumber")}),t.jsx(a.Input,{type:"text",label:"Work phone",error:i(r,"workPhoneNumber"),...r.getFieldProps("workPhoneNumber")}),t.jsx(Q,{submitButtonDisabled:r.isSubmitting,submitButtonText:"Save changes"})]})};export{ge as default};
