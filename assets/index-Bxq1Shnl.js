import{i as I,f as B,g as T,h as Q,j as e,r as F,A as O,am as R,n as d,o as D,p as $,P as U,B as W,k as Y,C as G}from"./index-DKN0tqRa.js";import{S as H}from"./SidePanelFormButtons-CzpJzypN.js";import"./index-C9Wdxdf8.js";import"./EmployeeGroupIdentityIssuerList-DOKPAds5.js";import{u as M}from"./EmployeeList-DzSk1owK.js";import{D as z}from"./downshift.esm-BKItabxJ.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./HeaderWithSearch-OZEH1uHG.js";import"./SidePanelTablePagination-DoIInzCU.js";const J=()=>{const s=I(),o=B(),{mutateAsync:l,isPending:c}=T({mutationKey:["employee","associate"],mutationFn:async({employee_id:t,...n})=>s.post(`employees/${t}/computers`,n),onSuccess:(t,n)=>{o.invalidateQueries({queryKey:["instances",n.computer_id]})}});return{associateEmployeeWithInstance:l,isAssociating:c}},X=()=>{const s=I(),o=B(),{mutateAsync:l,isPending:c}=T({mutationKey:["employee","disassociate"],mutationFn:async({employee_id:t,computer_id:n})=>s.delete(`employees/${t}/computers/${n}`),onSuccess:(t,n)=>{o.invalidateQueries({queryKey:["instances",n.computer_id]})}});return{disassociateEmployeeFromInstance:l,isDisassociating:c}},Z=(s,o={})=>{const l=I(),{id:c,...t}=s,{data:n,isPending:u}=Q({queryKey:["employee",s],queryFn:async()=>l.get(`employees/${c}`,{params:t}),...o});return{employee:n==null?void 0:n.data,isPending:u}},ee="_container_1a977_1",se="_suggestionsContainer_1a977_5",te="_pointer_1a977_12",ne="_highlighted_1a977_17",ae="_selectedContainer_1a977_21",g={container:ee,suggestionsContainer:se,pointer:te,highlighted:ne,selectedContainer:ae},oe=200,ie=(s,o)=>{const l=s.toLowerCase(),c=o.toLowerCase(),t=l.indexOf(c);return t>=0?e.jsxs(e.Fragment,{children:[s.substring(0,t),e.jsx("strong",{children:s.substring(t,t+o.length)}),s.substring(t+o.length)]}):s},ce=({employee:s,setEmployee:o,loadingExistingEmployee:l})=>{var w;const[c,t]=F.useState(""),[n,u]=F.useState(!1),[m,y]=F.useState(""),_=O(),{employees:f,isFetching:p}=M({listenToUrlParams:!1},{search:c,with_groups:!0},{enabled:c.length>2}),S=a=>(s==null?void 0:s.id)!==a.id,b=f.filter(S),j=()=>{o(null)},C=()=>{u(!1)},N=()=>{y(""),t("")},r=()=>{m.length>2?u(!0):u(!1)},E=a=>{y(a),a.length>2&&t(a)},i=R(()=>{try{r()}catch(a){_(a)}},oe),h=a=>{a&&(o(a),u(!1),N())},k=a=>{a.key==="Escape"?a.currentTarget.blur():i()},A=!n&&m.length<3?"Min 3. characters":f.length===0&&c&&!p?`No employees found by "${c}"`:null;return e.jsxs("div",{className:g.container,children:[e.jsx(z,{onSelect:h,itemToString:()=>"",isOpen:n,children:({getInputProps:a,getItemProps:K,getMenuProps:q,highlightedIndex:V})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(d.SearchBox,{...a(),placeholder:"Search for employees",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:m,onChange:E,onClear:N,onBlur:C,onFocus:r,onKeyUp:k}),A?e.jsx("span",{className:"p-form-help-text",children:A}):null,n&&(b.length>0||p)?e.jsx("ul",{className:D("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",g.suggestionsContainer),...q(),children:p?e.jsx($,{}):b.map((x,v)=>{var P;return e.jsxs("li",{className:D("p-list__item",g.pointer,{[g.highlighted]:V===v}),...K({item:x,index:v}),children:[e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:ie(x.name,c)}),e.jsx("small",{className:"u-text-muted",children:(P=x.groups)==null?void 0:P.map(L=>L.name).join(", ")})]},x.id)})}):null]})}),l&&e.jsx($,{}),s&&e.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:e.jsxs("li",{className:D("p-autocomplete__result p-list__item p-card u-no-margin--bottom",g.selectedContainer),children:[e.jsxs("div",{children:[e.jsx("div",{children:s.name}),e.jsx("span",{children:e.jsx("small",{className:"u-text--muted p-text--small",children:(w=s.groups)==null?void 0:w.map(a=>a.name).join(", ")})})]}),e.jsx(d.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom",onClick:j,children:e.jsx(d.Icon,{name:d.ICONS.delete})})]},s.id)})]})},le=[{label:"Associate",value:"associate"},{label:"Disassociate",value:"disassociate"}],xe=({instanceTitle:s,employeeId:o})=>{const{instanceId:l,childInstanceId:c}=U(),t=O(),{notify:n}=W(),{closeSidePanel:u}=Y(),m=Number(c??l),{associateEmployeeWithInstance:y,isAssociating:_}=J(),{disassociateEmployeeFromInstance:f,isDisassociating:p}=X(),{employee:S,isPending:b}=Z({id:o||0},{enabled:!!o}),j=async i=>{try{await y({computer_id:m,employee_id:i.id}),u(),n.success({title:`You have successfully associated ${i.name}`,message:`${i.name} has been successfully associated with ${s}.`})}catch(h){t(h)}},C=async i=>{try{await f({computer_id:m,employee_id:i.id}),u(),n.success({title:`You have successfully disassociated ${i.name}`,message:`${i.name} has been successfully disassociated from ${s}.`})}catch(h){t(h)}},r=G({initialValues:{action:"associate",employee:S||null},enableReinitialize:!0,onSubmit:async i=>{i.employee&&(i.action==="associate"?await j(i.employee):await C(i.employee))}}),E=!r.values.employee&&r.values.action==="associate"||_||p;return e.jsxs(d.Form,{noValidate:!0,onSubmit:r.handleSubmit,children:[e.jsx(d.Select,{label:"Associate or disassociate an employee",labelClassName:"u-off-screen",options:le,...r.getFieldProps("action")}),r.values.action==="associate"&&e.jsx(ce,{employee:r.values.employee,setEmployee:async i=>await r.setFieldValue("employee",i),loadingExistingEmployee:o?b:!1}),e.jsx(H,{submitButtonDisabled:E,submitButtonText:r.values.action==="associate"?"Associate":"Disassociate",submitButtonAppearance:"positive"})]})};export{xe as default};
