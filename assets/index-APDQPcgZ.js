const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DHJG9Jgp.js","assets/index-P7aY8_ih.js","assets/index-D86Q3Mim.css","assets/AssociationBlock-DhzdWX6s.js","assets/MultiSelectField-D04ckKNL.js","assets/MultiSelectField-CD3NDVCz.css","assets/useGetTags-Bw8JBcJb.js","assets/AssociationBlock-vsPH8fvb.css","assets/SidePanelFormButtons-CfC2kumX.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/useRoles-CiHskr-F.js","assets/RandomizationBlock-CcuC1iIo.js","assets/RadioGroup-DKJHZL_u.js","assets/RadioGroup-WBbAFTwm.css","assets/TextConfirmationModal-ALqYLh0P.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/PageMain-BfWG-qpd.js","assets/PageMain-CIunaku7.css","assets/HeaderWithSearch-qGmhTnPt.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/constants-BwD2f_1_.js","assets/index-C8M75lnL.css"])))=>i.map(i=>d[i]);
import{b as R,i as _,g as v,h as C,j as e,aw as j,S,H as w,ap as A,o as E,p as T,k as f,a0 as L,as as D,aD as k,l as d,d as y,aE as F,t as O,P as M,at as I,F as N,E as $,m as H,a9 as p,_ as b}from"./index-P7aY8_ih.js";import{P as B,a as Q,b as z}from"./PageMain-BfWG-qpd.js";import{H as q}from"./HeaderWithSearch-qGmhTnPt.js";import{L as V}from"./constants-BwD2f_1_.js";import{u as G}from"./useRoles-CiHskr-F.js";import{T as K}from"./TextConfirmationModal-ALqYLh0P.js";function U(t={}){const s=R(),r=()=>_({queryKey:["rebootprofiles"],queryFn:async({signal:c})=>s.get("rebootprofiles",{signal:c}),...t}),{data:o,isPending:i,error:l}=r();return{rebootProfiles:o?.data.results||[],isPending:i,rebootProfilesError:l}}function Y(){const t=R(),s=v(),r=C({mutationKey:["rebootprofiles","remove"],mutationFn:async l=>t.delete(`rebootprofiles/${l.id}`),onSuccess:async()=>s.invalidateQueries({queryKey:["rebootprofiles"]})}),{mutateAsync:o,isPending:i}=r;return{removeRebootProfile:o,isRemovingRebootProfile:i}}const W=({rebootProfile:t})=>!t.tags.length&&!t.all_computers?e.jsx(j,{}):t.num_computers?e.jsxs(S,{to:{pathname:"/instances",search:`query=${encodeURIComponent(`profile:reboot:${t.id}`)}`},children:[t.num_computers," ",w(t.num_computers,"instance")]}):"0 instances",J=()=>e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsx(A,{filtersToDisplay:["search"]})]}),X=({profile:t})=>{const s=E(),{notify:r}=T(),{setPageParams:o}=f(),{value:i,setTrue:l,setFalse:c}=L(),{removeRebootProfile:h,isRemovingRebootProfile:u}=Y(),P=async()=>{try{await h({id:t.id}),r.success({message:`Reboot profile "${t.title}" removed successfully`,title:"Reboot profile removed"})}catch(m){s(m)}finally{c()}},g=()=>{o({sidePath:["edit"],profile:t.id.toString()})},x=()=>{o({sidePath:["duplicate"],profile:t.id.toString()})},a=[{icon:"edit",label:"Edit","aria-label":`Edit "${t.title}" profile`,onClick:g},{icon:"canvas",label:"Duplicate","aria-label":`Duplicate "${t.title}" profile`,onClick:x}],n=[{icon:"delete",label:"Remove","aria-label":`Remove "${t.title}" profile`,onClick:l}];return e.jsxs(e.Fragment,{children:[e.jsx(D,{toggleAriaLabel:`${t.title} profile actions`,actions:a,destructiveActions:n}),e.jsx(K,{isOpen:i,title:"Confirm delete",confirmButtonLabel:"Delete",onConfirm:P,close:c,confirmButtonDisabled:u,confirmButtonLoading:u,confirmButtonAppearance:"negative",confirmationText:`remove ${t.title}`,children:e.jsxs("p",{children:['Are you sure you want to remove "',t.title,'" reboot profile? The removal of "',t.title,'" reboot profile is irreversible and might adversely affect your system.']})})]})},Z=t=>({column:s,row:{index:r}})=>{const o={};switch(s.id){case"title":o.role="rowheader";break;case"access_group":o["aria-label"]="Access group";break;case"tags":o["aria-label"]="Tags",t===r&&(o.className="expandedCell");break;case"associated":o["aria-label"]="Associated instances";break;case"actions":o["aria-label"]="Actions";break}return o},ee=t=>({index:s,original:r})=>{const o={};return t===s&&(o.className="expandedRow"),o["aria-label"]=`${r.title} reboot profile row`,o},te=({profiles:t})=>{const{search:s,setPageParams:r}=f(),{getAccessGroupQuery:o}=G(),{expandedRowIndex:i,handleExpand:l,getTableRowsRef:c}=k(),{data:h}=o(),u=h?.data.map(({name:a,title:n})=>({label:n,value:a}))??[],P=d.useMemo(()=>s?t.filter(a=>a.title.toLowerCase().includes(s.toLowerCase())):t,[t,s]),g=a=>{r({sidePath:["view"],profile:a.id.toString()})},x=d.useMemo(()=>[{accessor:"title",Header:"Title",Cell:({row:{original:a}})=>e.jsx(y.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>{g(a)},children:a.title})},{accessor:"access_group",Header:"access group",Cell:({row:{original:a}})=>e.jsx(e.Fragment,{children:u.find(({value:n})=>n===a.access_group)?.label??a.access_group})},{accessor:"tags",Header:"Tags",Cell:({row:{original:a,index:n}})=>a.tags.length>0?e.jsx(F,{content:a.tags.map(m=>e.jsx("span",{className:"truncatedItem",children:m},m)),isExpanded:n==i,onExpand:()=>{l(n)},showCount:!0}):e.jsx(j,{})},{accessor:"associated",Header:"associated",Cell:({row:{original:a}})=>e.jsx(W,{rebootProfile:a})},{accessor:"scheduled_reboot",Header:"scheduled reboot",className:"date-cell",Cell:({row:a})=>e.jsx("span",{className:"font-monospace",children:O(a.original.next_run).format(M)})},{...V,Cell:({row:a})=>e.jsx(X,{profile:a.original})}],[u.length,i]);return e.jsx("div",{ref:c,children:e.jsx(I,{columns:x,data:P,emptyMsg:`No profiles found with the search: "${s}"`,getCellProps:Z(i),getRowProps:ee(i)})})},oe=()=>{const{rebootProfiles:t,isPending:s}=U(),{search:r,setPageParams:o}=f(),i=()=>{o({sidePath:["add"],profile:""})};return e.jsxs(e.Fragment,{children:[s&&e.jsx(N,{}),!s&&t.length===0&&!r&&e.jsx($,{title:"You don't have any Reboot profiles yet",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"Regular reboots keep your system healthy and secure by applying the latest updates. They also help maintain Livepatch coverage. Add a reboot profile to automate this process for your instances."}),e.jsx("a",{href:"https://ubuntu.com/security/livepatch/docs",target:"_blank",rel:"nofollow noopener noreferrer",children:"Learn more about Livepatch."})]}),cta:[e.jsx(y.Button,{appearance:"positive",onClick:i,type:"button",children:"Add reboot profile"},"table-add-new-profile")]}),!s&&t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(J,{}),e.jsx(te,{profiles:t})]})]})},se=d.lazy(async()=>b(()=>import("./index-DHJG9Jgp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(t=>({default:t.RebootProfileAddSidePanel}))),ae=d.lazy(async()=>b(()=>import("./index-DHJG9Jgp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(t=>({default:t.RebootProfileDetailsSidePanel}))),re=d.lazy(async()=>b(()=>import("./index-DHJG9Jgp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(t=>({default:t.RebootProfileDuplicateSidePanel}))),ie=d.lazy(async()=>b(()=>import("./index-DHJG9Jgp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])).then(t=>({default:t.RebootProfileEditSidePanel}))),ne=()=>{const{sidePath:t,lastSidePathSegment:s,setPageParams:r}=f();H("sidePath",["add","duplicate","edit","view"]);const o=()=>{r({sidePath:["add"],profile:""})};return e.jsxs(B,{children:[e.jsx(Q,{title:"Reboot profiles",actions:[e.jsx(y.Button,{appearance:"positive",onClick:o,type:"button",children:"Add reboot profile"},"new-key-button")]}),e.jsx(z,{children:e.jsx(oe,{})}),e.jsxs(p,{onClose:()=>{r({sidePath:[],profile:""})},isOpen:!!t.length,children:[s==="add"&&e.jsx(p.Suspense,{children:e.jsx(se,{})},"add"),s==="duplicate"&&e.jsx(p.Suspense,{children:e.jsx(re,{})},"duplicate"),s==="edit"&&e.jsx(p.Suspense,{children:e.jsx(ie,{})},"edit"),s==="view"&&e.jsx(p.Suspense,{children:e.jsx(ae,{})},"view")]},"add")]})},fe=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"}));export{W as R,oe as a,J as b,te as c,fe as i,Y as u};
