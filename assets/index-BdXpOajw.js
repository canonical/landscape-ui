import{j as e,B as E,r as u,g as i,e as M,n as L,m as O,f as Y,L as F,R as U}from"./index-BMhnQnvO.js";import{u as G}from"./useConfirm-DBWWlNvT.js";import{u as Q}from"./useInstances-CmnK8qSQ.js";import{u as z}from"./useRoles-CVnIP7R8.js";import{N as v}from"./NoData-D_FYardG.js";import{m as W}from"./moment-BcE1DmV8.js";import"./useFetchOld-Cff5y19B.js";import"./useMutation-Diy-BhWO.js";import"./useQuery-Dxk6aJEc.js";const q=({column:{id:a},row:{original:o}})=>{const s={};return a==="title"?s.role="rowheader":a==="checkbox"?s["aria-label"]=`Toggle ${o.title} instance`:a==="hostname"?s["aria-label"]="Hostname":a==="access_group"?s["aria-label"]="Access group":a==="client_tags"?s["aria-label"]="Tags":a==="creation_time"&&(s["aria-label"]="Creation time"),s},J=(a,o)=>{var s;return o?((s=a.find(({value:c})=>c===o))==null?void 0:s.label)??o:e.jsx(v,{})},k=a=>W(a).utc().calendar({sameElse:`${E} [UTC]`,lastWeek:"[Last] dddd, HH:mm [UTC]",sameDay:"[Today], HH:mm [UTC]",lastDay:"[Yesterday], HH:mm [UTC]"}),K="_checkbox_1jtck_1",V="_truncate_1jtck_5",b={checkbox:K,truncate:V},X=({accessGroupOptions:a,instances:o,onSelectedIdsChange:s,selectedIds:c})=>{const l=u.useMemo(()=>o,[o]),n=u.useMemo(()=>[{accessor:"checkbox",className:b.checkbox,Header:()=>e.jsx(i.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,checked:c.length===l.length,indeterminate:c.length>0&&c.length<l.length,onChange:()=>s(c.length>0?[]:l.map(({id:t})=>t))}),Cell:({row:{original:t}})=>e.jsx(i.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${t.title} instance`}),inline:!0,checked:c.includes(t.id),onChange:()=>s(c.includes(t.id)?c.filter(g=>g!==t.id):[...c,t.id])})},{accessor:"title",Header:"name"},{accessor:"hostname",Header:"Hostname"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:t}})=>J(a,t.access_group)},{accessor:"client_tags",Header:"Tags",Cell:({row:{original:t}})=>t.client_tags.length?e.jsx(i.Tooltip,{message:t.client_tags.join(", "),positionElementClassName:b.truncate,children:t.client_tags.join(", ")}):e.jsx(v,{})},{accessor:"creation_time",Header:"Pending since",Cell:({row:{original:t}})=>e.jsx(i.Tooltip,{message:k(t.creation_time),positionElementClassName:b.truncate,children:k(t.creation_time)})}],[l,c.length]);return e.jsx(i.ModularTable,{columns:n,data:l,getCellProps:q})},Z="_help_h15yn_1",ee={help:Z},ne=({instances:a})=>{var C;const[o,s]=u.useState(!1),[c,l]=u.useState(""),[n,t]=u.useState([]),g=M(),{user:p}=L(),{notify:j}=O(),{closeSidePanel:h,changeSidePanelSize:f}=Y(),{closeConfirmModal:x,confirmModal:y}=G(),{getAccessGroupQuery:$}=z(),{acceptPendingInstancesQuery:T,rejectPendingInstancesQuery:A}=Q(),d=(C=p==null?void 0:p.accounts.find(r=>r.name===(p==null?void 0:p.current_account)))==null?void 0:C.title,P=()=>{s(!0),f("small")},H=()=>{s(!1),f("large")},{mutateAsync:I}=T,{mutateAsync:w}=A,N=async()=>{try{await w({computer_ids:n}),x(),h(),j.success({message:`${n.length} pending ${n.length===1?"instance":"instances"} have been rejected to add to your ${d} organisation.`,title:`You have rejected ${n.length} pending ${n.length===1?"instance":"instances"}`})}catch(r){g(r)}},R=()=>{y({title:"Reject pending instances",body:`This will reject ${n.length} selected ${n.length===1?"instance":"instances"} to add to your ${d} organisation.`,buttons:[e.jsx(i.Button,{type:"button",appearance:"negative",onClick:N,"aria-label":`Reject selected ${n.length===1?"instance":"instances"}`,children:"Reject"},"reject")]})},B=async()=>{try{await I({access_group:c,computer_ids:n}),x(),h(),j.success({message:`${n.length} pending ${n.length===1?"instance":"instances"} have been successfully added to your ${d} organisation.`,title:`You have approved ${n.length} pending ${n.length===1?"instance":"instances"}`})}catch(r){g(r)}},S=()=>{y({title:"Approve pending instances",body:`This will approve ${n.length} selected ${n.length===1?"instance":"instances"} to add to your ${d} organisation.`,buttons:[e.jsx(i.Button,{type:"button",appearance:"positive",onClick:B,"aria-label":`Approve selected ${n.length===1?"instance":"instances"}`,children:"Approve"},"approve")]})},{data:m}=$(),_=(m==null?void 0:m.data.map(({name:r,title:D})=>({label:D,value:r})))??[];return e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:ee.help,children:[e.jsxs("span",{children:["You can automatically register new Landscape Client Instances when theyâ€™re configured using a registration key. This eliminates the need for manual approval of each computer. You can enable this feature in the"," "]}),e.jsx(F,{to:`${U}settings/general`,children:"Org. settings"}),e.jsx("span",{children:" or "}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"learn more"})]}),o&&e.jsx(i.Select,{label:"Access group",options:_,name:"access_group",value:c,onChange:r=>l(r.target.value)}),!o&&e.jsx(X,{accessGroupOptions:_,instances:a,onSelectedIdsChange:r=>t(r),selectedIds:n}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(i.Button,{type:"button",appearance:"base",onClick:h,children:"Cancel"}),o?e.jsx(i.Button,{type:"button",onClick:H,children:"Back"}):e.jsx(i.Button,{type:"button",appearance:"negative",disabled:n.length===0,onClick:R,children:"Reject"}),e.jsx(i.Button,{type:"button",appearance:"positive",disabled:n.length===0,onClick:o?S:P,children:"Approve"})]})]})},ue=ne;export{ue as default};
