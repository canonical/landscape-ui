const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CIVUkeMW.js","assets/index-DdDZs9iJ.js","assets/index-CNplmdTt.css","assets/useInstances-xzL-A-Ng.js","assets/SidePanelFormButtons-BSX-z9y0.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/useRoles-BNFkLHId.js","assets/index-BNjjK8kV.js","assets/ScriptsTabs-BYSIgAdA.js","assets/HeaderWithSearch-CXY4tLKs.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-djSi9FWq.js","assets/useExpandableRow-DKL1BEGd.js","assets/ScriptsTabs-DN44MVZt.css","assets/DeliveryBlock-B22Fcpek.js","assets/DeliveryBlock-VExRkUer.css","assets/ScriptDropdown-DdWI6EDt.js","assets/downshift.esm-BkSD5JbA.js","assets/ScriptDropdown-Wdg9HaWt.css","assets/index-DVvNqoS8.js","assets/CodeEditor-vgpfpBQ5.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-DyOippzW.js","assets/AttachmentFile-DtR4HEWJ.js","assets/AttachmentFile-B_HSPNHl.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-wJu9Ys9G.js","assets/EmployeeGroupIdentityIssuerList-Dsqnys80.js","assets/SidePanelTablePagination-BB-a982T.js","assets/EmployeeGroupIdentityIssuerList-CdRpefPn.css","assets/EmployeeList-B3PvhAfW.js","assets/EmployeeList-BQrbbWYX.css","assets/index-0uuPVSHU.css"])))=>i.map(i=>d[i]);
import{j as e,p as y,aV as ve,r as o,d as s,P as ue,aW as ye,m as Ie,q as V,M as Ce,af as we,O as Se,x as ie,as as oe,N as C,D as Ae,a as Ne,B as Te,a3 as Be,C as Re,o as Ee,b as De,F as ke,I as Le,aa as re,G as le,a2 as te}from"./index-DdDZs9iJ.js";import{u as ee}from"./useInstances-xzL-A-Ng.js";import{R as Pe,c as $e}from"./ResponsiveButtons-D85C5YGV.js";import"./InstancesPageActions-BB322Y5M.js";import{u as ze}from"./useRoles-BNFkLHId.js";import{u as Oe,T as Fe}from"./TagsAddConfirmationModal-DeGuJRDp.js";import{u as Ve}from"./WslInstancesHeader-BBkFaLUH.js";import"./HeaderWithSearch-CXY4tLKs.js";const Me="_infoContainer_1ca11_1",qe="_amount_1ca11_9",ce={infoContainer:Me,amount:qe},Qe=({isExpanded:t,overflowingChipsAmount:n})=>n>0&&!t&&e.jsx("div",{className:ce.infoContainer,children:e.jsx("span",{className:y("u-text--muted",ce.amount),children:`+${n}`})}),He=({containerRef:t,onDismiss:n,onOverflowingItemsAmountChange:l,tagData:c})=>{const u=()=>{if(!t.current)return;const r=t.current.querySelectorAll("span.p-chip");l(Array.from(r).filter(({offsetHeight:b,offsetTop:h})=>h>b).length)};return ve("resize",u),o.useEffect(()=>{u()},[c.length]),c.map(r=>e.jsx(s.Chip,{value:r,onDismiss:()=>{n(r)}},r))},Ue="_container_22v5i_1",We="_list_22v5i_6",Ge="_listItem_22v5i_11",Ze="_search_22v5i_17",F={container:Ue,list:We,listItem:Ge,search:Ze},Ye=({onTagClick:t,tags:n})=>n.length?e.jsxs("div",{className:F.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Tags"}),e.jsx("ul",{className:y("p-list--divided u-no-margin--bottom",F.list),children:n.map(l=>e.jsx("li",{children:e.jsx("div",{className:F.listItem,children:e.jsx(s.Button,{type:"button",appearance:"base",className:F.search,onClick:()=>t(l),children:l})})},l))})]}):null,Ke="_container_fqj7b_1",Je="_prompt_fqj7b_10",Xe="_saveButton_fqj7b_17",X={container:Ke,prompt:Je,saveButton:Xe},et=({onTagAdd:t,search:n})=>e.jsx(e.Fragment,{children:n&&e.jsxs("div",{className:X.container,children:[e.jsxs("span",{className:X.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:n}),e.jsx("span",{children:"..."})]}),e.jsx(s.Button,{type:"button",appearance:"link",onClick:t,className:X.saveButton,children:"Add tag"})]})}),de=ue().matches(/^[a-zA-Z]/,{message:"Tag must starts with a letter",excludeEmptyString:!0}).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,{message:"Tag can only contain letters, numbers, hyphens, and underscores",excludeEmptyString:!0}),tt="_searchContainer_30px9_1",st="_box_30px9_9",nt="_inputContainer_30px9_14",at="_inputError_30px9_19",it="_input_30px9_14",T={searchContainer:tt,box:st,inputContainer:nt,inputError:at,input:it},ot=({onTagsChange:t,tags:n,label:l,labelClassName:c,required:u})=>{var N;const[r,b]=o.useState(""),[h,_]=o.useState(""),[S,A]=o.useState(!1),[g,B]=o.useState(""),[f,j]=o.useState(!1),[M,q]=o.useState(0),{height:R}=ye(),[Q,E]=o.useState({top:"100%",bottom:"auto"}),{getAllInstanceTagsQuery:H}=ee(),D=o.useRef(null),m=o.useRef(null);o.useEffect(()=>{if(!m.current)return;const i=m.current.querySelector("input");i&&B(i.id)},[m.current]);const U=()=>{if(!m.current)return;const{top:i,height:d}=m.current.getBoundingClientRect();i+d+379<R?E({top:"100%",bottom:"auto"}):E({top:"auto",bottom:"100%"})};o.useEffect(()=>{!f||!m.current||U()},[R,f,m.current,(N=m.current)==null?void 0:N.clientHeight]);const k=()=>{j(!1)};Ie(D,k);const W=i=>{t(n.filter(d=>d!==i))},{data:v,isLoading:L}=H(),G=o.useMemo(()=>v?!r&&!n.length?v.data.results:v.data.results.filter(i=>!n.includes(i)).filter(i=>i.toLowerCase().includes(r.trim().toLowerCase())):[],[v,r,n]),P=i=>{t([...n,i])},$=()=>{if(r.trim())try{const i=de.validateSync(r.trim())??"";P(i),b(""),_(""),A(!1)}catch(i){i instanceof Error&&(_(i.message),A(!0))}},I=i=>{if(b(i.target.value),S)try{de.validateSync(i.target.value),_("")}catch(d){d instanceof Error&&_(d.message)}},Z=i=>{const{key:d}=i;f?(d==="Escape"&&k(),d==="Enter"&&$()):d==="Enter"&&j(!0)};return e.jsxs("div",{children:[e.jsx("label",{className:y("p-form__label",{"is-required":u},c),htmlFor:g,children:l||"Tags"}),e.jsxs("div",{className:"p-search-and-filter",ref:D,children:[e.jsxs("div",{className:y("p-search-and-filter__search-container",T.searchContainer),"aria-expanded":f,ref:m,onClick:()=>{j(!0)},children:[e.jsx(He,{containerRef:m,onDismiss:W,onOverflowingItemsAmountChange:i=>{q(i)},tagData:n}),e.jsx("div",{className:y("p-search-and-filter__box",T.box),children:e.jsx("div",{className:T.inputContainer,children:e.jsx(s.Input,{type:"text",autoComplete:"off",value:r,onChange:I,placeholder:"Add tags",className:y("u-no-margin--bottom",T.input),onClick:()=>{j(!0)},onKeyUp:Z,wrapperClassName:h?"is-error":"","aria-errormessage":h?`${g}-error`:void 0,"aria-invalid":!!h})})}),h&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:y("p-form-validation__message",T.inputError),id:`${g}-error`,children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:h})]})}),e.jsx(Qe,{isExpanded:f,overflowingChipsAmount:M})]}),f&&L&&e.jsx(V,{}),f&&!L&&e.jsxs("div",{className:"p-search-and-filter__panel",style:Q,children:[e.jsx(et,{onTagAdd:$,search:r}),e.jsx(Ye,{onTagClick:P,tags:G})]})]})]})},rt={deliver_after:"",deliverImmediately:!0,action:null},lt=Ce().shape({deliver_after:ue().when("deliverImmediately",{is:!1,then:t=>t.required("This field is required").test({message:"Invalid date",test:n=>ie(n).isValid()}).test({message:"Date must be in the future",test:n=>ie(n).isAfter()})}),deliverImmediately:Se(),action:we().oneOf(["shutdown","reboot"]).required()}),ct=t=>{var l;const n=(l=t.grouped_hardware)==null?void 0:l.network;return!Array.isArray(n)||n.length===0?e.jsx(C,{}):n.filter(({ip:c})=>c!=="Not available").map(({ip:c})=>c).join(", ")||e.jsx(C,{})},dt=(t,n)=>{var l,c,u;return[{label:"instance ID",value:t.id},{label:"Hostname",value:t.hostname},{label:"IP Address",value:ct(t)},{label:"Serial number",value:((l=t.grouped_hardware)==null?void 0:l.system.serial)??e.jsx(C,{})},{label:"Product identifier",value:((c=t.grouped_hardware)==null?void 0:c.system.model)??e.jsx(C,{})},{label:"Distribution",value:t.distribution??"Unknown"},{label:"Access group",value:((u=n.find(({value:r})=>r===t.access_group))==null?void 0:u.label)||t.access_group},{label:"Last ping time",value:t.last_ping_time&&oe(t.last_ping_time).isValid()?oe(t.last_ping_time).format(Ae):e.jsx(C,{})},{label:"Annotations",value:t.annotations?Object.entries(t.annotations).map(([r,b],h,_)=>e.jsxs(o.Fragment,{children:[e.jsx("span",{children:`${r}: ${b}`}),h<_.length-1&&e.jsx("br",{})]},r)):e.jsx(C,{})},{label:"Comment",value:t.comment||e.jsx(C,{})}]},ut="_titleRow_2b43d_1",mt="_flexContainer_2b43d_6",pt="_italic_2b43d_11",ht="_infoRow_2b43d_15",ft="_tagSection_2b43d_20",gt="_tagsRow_2b43d_25",xt="_tagsButton_2b43d_34",x={titleRow:ut,flexContainer:mt,italic:pt,infoRow:ht,tagSection:ft,tagsRow:gt,tagsButton:xt},bt=o.lazy(async()=>te(()=>import("./index-CIVUkeMW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),_t=o.lazy(async()=>te(()=>import("./index-BNjjK8kV.js"),__vite__mapDeps([8,9,1,2,7,10,11,12,13,14,15,16,4,5,6,17,18,19,20,21,22,23,24,25,26,27,28])).then(t=>({default:t.RunInstanceScriptForm}))),jt=o.lazy(async()=>te(()=>import("./index-wJu9Ys9G.js"),__vite__mapDeps([29,1,2,4,5,6,14,30,10,11,31,32,33,34,20,35]))),Bt=({instance:t})=>{const[n,l]=o.useState([...t.tags]),[c,u]=o.useState(""),[r,b]=o.useState(!1),[h,_]=o.useState(!1),S=n.filter(a=>!t.tags.includes(a)),A=Ne(),g=Te(),{openActivityDetails:B}=Be(),{notify:f}=Re(),{setSidePanelContent:j}=Ee(),{getAccessGroupQuery:M}=ze(),{removeInstancesQuery:q,rebootInstancesQuery:R,sanitizeInstanceQuery:Q,shutdownInstancesQuery:E}=ee(),{deleteChildInstancesQuery:H}=Ve(),{editInstanceQuery:D}=ee(),{isFeatureEnabled:m}=De(),{isFetchingProfileChanges:U,profileChangesCount:k,refetchProfileChanges:W}=Oe({instance_ids:[t.id],tags:S,limit:10},{enabled:!1});o.useEffect(()=>{l([...t.tags])},[t.tags]);const{data:v}=M(),L=(v==null?void 0:v.data.map(({name:a,title:O})=>({label:O,value:a})))??[],{mutateAsync:G,isPending:P}=D,{mutateAsync:$,isPending:I}=q,{mutateAsync:Z,isPending:N}=R,{mutateAsync:i,isPending:d}=E,{mutateAsync:se,isPending:ne}=H,{mutateAsync:me,isPending:Y}=Q,pe=n.length!==t.tags.length||n.some(a=>!t.tags.includes(a))||t.tags.some(a=>!n.includes(a)),p=ke({initialValues:rt,validationSchema:lt,onSubmit:async a=>{if(!a.action)return;const O={computer_ids:[t.id],deliver_after:a.deliverImmediately?void 0:`${a.deliver_after}:00Z`};try{const{data:J}=a.action==="reboot"?await Z(O):await i(O),ae=a.action==="reboot"?"restarted":"shut down";f.success({title:`You queued "${t.title}" to be ${ae}`,message:`Instance "${t.title}" will be ${ae} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{B(J)}}]})}catch(J){g(J)}}}),w=()=>{u("")},he=async()=>{try{await $({computer_ids:[t.id]}),A("/instances",{replace:!0})}catch(a){g(a)}finally{w()}},fe=async()=>{try{const{data:a}=await me({computer_id:t.id,computer_title:t.title});f.success({title:`You have successfully initiated Sanitization for ${t.title}`,message:`Sanitizing for ${t.title} has been queued in Activities. The data will be permanently irrecoverable once complete.`,actions:[{label:"View details",onClick:()=>{B(a)}}]})}catch(a){g(a)}finally{w()}},K=async()=>{try{await G({instanceId:t.id,tags:n}),f.success({title:"Tags updated",message:`"${t.title}" instance tags have been updated successfully`})}catch(a){g(a)}finally{w()}},ge=async()=>{if(S.length){const a=await W();a.isSuccess?a.data.data.count?u("tags"):await K():g(a.error)}else await K()},xe=()=>{j("Edit Instance",e.jsx(o.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(bt,{instance:t})}))},be=()=>{j("Run script",e.jsx(o.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(_t,{parentAccessGroup:t.access_group,query:`id:${t.id}`})}))},_e=()=>{j(`Associate employee with ${t.title}`,e.jsx(o.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(jt,{instanceTitle:t.title,employeeId:t.employee_id})}))},je=async()=>{try{await se({computer_ids:[t.id]}),A("/instances",{replace:!0})}catch(a){g(a)}},z=async a=>{await p.setFieldValue("action",a),p.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:x.titleRow,children:[e.jsxs("div",{className:x.flexContainer,children:[e.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:t.title}),t.is_wsl_instance&&e.jsx("p",{className:y("u-text--muted u-no-margin--bottom",x.italic),children:"WSL Instance"})]}),e.jsxs("div",{className:x.flexContainer,children:[t.is_wsl_instance&&e.jsx(s.ConfirmationButton,{className:"u-no-margin--bottom u-no-margin--right",type:"button",confirmationModalProps:{title:"Delete instance",children:e.jsxs("p",{children:["This will permanently delete the instance"," ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:ne,confirmButtonLoading:ne,onConfirm:je},children:"Delete instance"}),e.jsx(Pe,{collapseFrom:"xxl",buttons:[e.jsxs(s.Button,{type:"button",onClick:xe,hasIcon:!0,children:[e.jsx(s.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]},"edit-instance"),$e("runScripts",t)&&e.jsxs(s.Button,{type:"button",onClick:be,hasIcon:!0,children:[e.jsx(s.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]},"run-script"),e.jsxs(s.Button,{hasIcon:!0,type:"button",disabled:I,onClick:()=>{u("remove")},"aria-label":`Remove ${t.title} instance`,children:[e.jsx(s.Icon,{name:s.ICONS.delete}),e.jsx("span",{children:"Remove from Landscape"})]},"remove-instance"),e.jsxs(s.Button,{hasIcon:!0,type:"button",disabled:Y,onClick:()=>{u("sanitize")},"aria-label":`Sanitize ${t.title} instance`,children:[e.jsx(s.Icon,{name:"tidy"}),e.jsx("span",{children:"Sanitize"})]},"sanitize-instance"),e.jsxs(s.Button,{hasIcon:!0,type:"button",disabled:I,onClick:()=>{b(!0)},children:[e.jsx(s.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]},"reboot-instance"),m("employee-management")&&e.jsxs(s.Button,{type:"button",hasIcon:!0,onClick:_e,children:[e.jsx(s.Icon,{name:s.ICONS.user}),e.jsx("span",{children:"Associate employee"})]},"associate-employee"),e.jsxs(s.Button,{hasIcon:!0,type:"button",disabled:I,onClick:()=>{_(!0)},children:[e.jsx(s.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]},"shutdown-instance")]})]})]}),e.jsx("div",{className:x.infoRow,children:e.jsx(s.Row,{className:"u-no-padding--left u-no-padding--right u-no-max-width",children:dt(t,L).map(a=>e.jsx(s.Col,{size:4,children:e.jsx(Le,{...a})},a.label))})}),e.jsx("div",{className:x.tagSection,children:e.jsxs(s.Row,{className:x.tagsRow,children:[e.jsx(s.Col,{size:4,children:e.jsx(ot,{labelClassName:"p-text--small p-text--small-caps u-text--muted",onTagsChange:a=>{l(a)},tags:n})}),e.jsx(s.Col,{size:2,className:x.tagsButton,children:e.jsx(s.ActionButton,{type:"button",className:"u-no-margin--bottom",onClick:ge,disabled:!pe,loading:U,children:"Update"})})]})}),c==="tags"&&e.jsx(Fe,{instances:[t],tags:S,onConfirm:K,confirmButtonDisabled:P,close:w,profileChangesCount:k}),e.jsx(re,{isOpen:c==="remove",title:"Remove instance from Landscape",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:I,confirmButtonLoading:I,onConfirm:he,close:w,confirmationText:`remove ${t.title}`,children:e.jsxs("p",{children:["Removing this ",t.title," will delete all associated data and free up one license slot for another computer to be registered."]})}),e.jsx(re,{isOpen:c==="sanitize",confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:Y,confirmButtonLoading:Y,onConfirm:fe,close:w,confirmationText:`sanitize ${t.title}`,title:"Sanitize instance",children:e.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",t.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})}),r&&e.jsx(s.ConfirmationModal,{close:()=>{b(!1)},title:"Restart instance",confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonDisabled:N,confirmButtonLoading:N,onConfirm:async()=>z("reboot"),children:e.jsxs(s.Form,{onSubmit:async()=>z("reboot"),noValidate:!0,children:[e.jsx(s.CheckboxInput,{label:"Deliver as soon as possible",...p.getFieldProps("deliverImmediately"),checked:p.values.deliverImmediately}),e.jsx(s.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:x.input,placeholder:"Scheduled time",...p.getFieldProps("deliver_after"),disabled:p.values.deliverImmediately,error:le(p,"deliver_after")}),e.jsxs("p",{children:['This will restart "',t.title,'" instance.']})]})}),h&&e.jsx(s.ConfirmationModal,{close:()=>{_(!1)},title:"Shut down instance",confirmButtonLabel:"Shutdown",confirmButtonAppearance:"negative",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:async()=>z("shutdown"),children:e.jsxs(s.Form,{onSubmit:async()=>z("shutdown"),noValidate:!0,children:[e.jsx(s.CheckboxInput,{label:"Deliver as soon as possible",...p.getFieldProps("deliverImmediately"),checked:p.values.deliverImmediately}),e.jsx(s.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:x.input,placeholder:"Scheduled time",...p.getFieldProps("deliver_after"),disabled:p.values.deliverImmediately,error:le(p,"deliver_after")}),e.jsxs("p",{children:['This will shut down "',t.title,'" instance.']})]})})]})};export{Bt as default};
