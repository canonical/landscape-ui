import{r as p,j as n,g as c}from"./index-Bj3y1t-6.js";import{C as g}from"./CellInput-DQT3NnX9.js";import{T as h,C,a as b,E as N}from"./index-CtIV0Bf0.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new e.Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="431cb94b-fe99-48a2-8e3b-637f1a2910c3",e._sentryDebugIdIdentifier="sentry-dbid-431cb94b-fe99-48a2-8e3b-637f1a2910c3")}catch{}const w="_action_fofcj_1",y="_cell_fofcj_7",_="_input_fofcj_18",f="_inputWrapper_fofcj_26",l={action:w,cell:y,input:_,inputWrapper:f},j=async(e,s,a,o)=>{await e.setFieldValue(`constraints[${s}]${[a]}`,o),await e.setFieldTouched(`constraints[${s}]${[a]}`,!0),["rule","version"].includes(a)&&(o!==""?await e.setFieldValue(`constraints[${s}].notAnyVersion`,!0):e.values.constraints[s][a==="rule"?"version":"rule"]===""&&await e.setFieldValue(`constraints[${s}].notAnyVersion`,!1))},I=(e,s,a)=>{var i,u,d;if(!((i=e.errors.constraints)!=null&&i[s])||!((d=(u=e.touched.constraints)==null?void 0:u[s])!=null&&d[a]))return;const o=e.errors.constraints[s];return typeof o!="string"?o[a]:void 0},T=async(e,s)=>{await e.setFieldValue("constraints",e.values.constraints.filter((a,o)=>o!==s)),e.touched.constraints&&(e.touched.constraints.splice(s,1),await e.setTouched({...e.touched,constraints:e.touched.constraints}))},P=e=>({handleConstraintPropChange:async(s,a,o)=>{await j(e,s,a,o)},handleConstraintRowDelete:async s=>{await T(e,s)},getConstraintsErrorByIndex:(s,a)=>I(e,s,a)}),v=({column:e})=>{const s={};return s.className=l.cell,e.id==="package_name"?s.role="rowheader":e.id==="action"?s["aria-label"]="Action":e.id==="constraint"?s["aria-label"]="Constraint":e.id==="version"?s["aria-label"]="Version":e.id==="rule"&&(s["aria-label"]="Rule"),s},F=({formik:e})=>{p.useEffect(()=>{e.submitCount!==0&&(async()=>await e.setTouched({...e.touched,constraints:new Array(e.values.constraints.length).fill(h)}))()},[e.submitCount]);const s=p.useMemo(()=>e.values.constraints,[e.values.constraints]),{handleConstraintPropChange:a,handleConstraintRowDelete:o,getConstraintsErrorByIndex:i}=P(e),u=p.useMemo(()=>[{accessor:"constraint",Header:"Constraint",Cell:({row:{index:t}})=>n.jsx(c.Select,{label:"Constraint",labelClassName:"u-off-screen",className:l.input,wrapperClassName:l.inputWrapper,options:C,...e.getFieldProps(`constraints[${t}].constraint`),onChange:r=>a(t,"constraint",r.target.value),error:i(t,"constraint")})},{accessor:"package",Header:"Package",Cell:({row:{index:t}})=>n.jsx(g,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:l.input,wrapperClassName:l.inputWrapper,...e.getFieldProps(`constraints[${t}].package`),onChange:r=>a(t,"package",r),error:i(t,"package")})},{accessor:"rule",Header:"Rule",Cell:({row:{index:t}})=>n.jsx(c.Select,{label:"Rule",labelClassName:"u-off-screen",className:l.input,wrapperClassName:l.inputWrapper,...e.getFieldProps(`constraints[${t}].rule`),options:b,onChange:r=>a(t,"rule",r.target.value),error:i(t,"rule")})},{accessor:"version",Header:"Version",Cell:({row:{index:t}})=>n.jsx(g,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:l.input,wrapperClassName:l.inputWrapper,...e.getFieldProps(`constraints[${t}].version`),onChange:r=>a(t,"version",r),error:i(t,"version")})},{accessor:"action",className:l.action,Cell:({row:t})=>n.jsx(c.Button,{type:"button",hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding","aria-label":"Delete constraint row",onClick:()=>o(t.index),children:n.jsx(c.Icon,{name:c.ICONS.delete,className:"u-no-margin--left u-no-margin--right"})})}],[s,e.errors.constraints,e.touched.constraints]),d=async()=>{if(await e.setFieldValue("constraints",[N,...e.values.constraints]),e.touched.constraints){const t=[];for(let r=e.values.constraints.length;r>0;r--)e.touched.constraints[r-1]&&(t[r]=e.touched.constraints[r-1]);await e.setTouched({constraints:t})}};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"u-align-text--right",children:n.jsxs(c.Button,{type:"button",hasIcon:!0,onClick:d,children:[n.jsx(c.Icon,{name:c.ICONS.plus,className:"u-no-margin--left"}),n.jsx("span",{children:"Add new constraint"})]})}),n.jsx(c.ModularTable,{columns:u,data:s,getCellProps:v,emptyMsg:"No constraints added yet.",className:"u-no-margin--bottom"}),e.touched.constraints&&typeof e.errors.constraints=="string"&&n.jsx("div",{className:"is-error",children:n.jsxs("p",{className:"p-form-validation__message u-no-margin--top",children:[n.jsx("strong",{children:"Error: "}),n.jsx("span",{children:e.errors.constraints})]})})]})};export{F as P};
