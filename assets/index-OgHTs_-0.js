import{u as h,V as y,I as j}from"./ScriptsTabs-C3hIDC9c.js";import{c as oe,a as ae,d as ne,S as ce,b as pe}from"./ScriptsTabs-C3hIDC9c.js";import{q as F,s as I,g as v,t as C,r as P,j as t,h as s}from"./index-P3tcVer_.js";import"./usePageParams-CZXld3eS.js";import{S as E}from"./SidePanelFormButtons-CEx4Wy-H.js";import{u as V,D as q}from"./DeliveryBlock-DQX6CCmk.js";import{u as A}from"./useRoles-oaQYE5g1.js";import{g as u}from"./formikErrors-Bw8iTXYS.js";import"./index-BbHeewcZ.js";import{default as le}from"./index-G0JV_7TV.js";import"./TablePagination-9PvQlVgk.js";import"./TablePaginationBase-DrquMGK2.js";import"./NoData-DfvYDVkG.js";import"./TruncatedCell-D_3fzDwd.js";import"./StatusFilter-BjWN4DdL.js";import"./TableFilter-DTXx6h3i.js";import"./TableFilterChips-HMcdOmXT.js";import"./HeaderWithSearch-DCz7Mge8.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./useFetchOld-BGcQOp2P.js";import"./CodeEditor-BPM7vodj.js";import"./ScriptFormAttachments-WLzw2kpB.js";const N=i=>{const o=(i==null?void 0:i.map(({id:a,title:c})=>({label:c,value:a})))??[];return o.unshift({label:"Select script",value:0}),o},R=(i,o)=>{var a;return{message:`"${(a=o.find(({value:c})=>c===i.script_id))==null?void 0:a.label}" script queued to execute successfully`,title:"Script execution queued"}},re=({query:i})=>{const o=F(),{notify:a}=I(),{closeSidePanel:c}=v(),{getAccessGroupQuery:S}=A(),{scripts:l}=h({listenToUrlParams:!1},{script_type:"v2"}),{runScript:f}=V(),m=N(l),e=C({initialValues:j,validationSchema:y,onSubmit:async r=>{try{await f({deliver_after:r.deliverImmediately?void 0:r.deliver_after,query:i,script_id:r.script_id,username:r.username}),c(),a.success(R(r,m))}catch(n){o(n)}}}),g=async r=>{var d;const n=parseInt(r.target.value);if(await e.setFieldValue("script_id",n),!e.values.username){const x=((d=l.find(({id:_})=>_===n))==null?void 0:d.username)??"";await e.setFieldValue("username",x)}},{data:p}=S(),b=P.useMemo(()=>((p==null?void 0:p.data)??[]).map(({name:r,title:n})=>({label:n,value:r})),[p]);return t.jsxs(s.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[t.jsx(s.Select,{label:"Script",required:!0,options:m,...e.getFieldProps("script_id"),onChange:g,error:u(e,"script_id")}),t.jsx(s.Select,{label:"Access group",options:[{label:"Select access group",value:""},...b],...e.getFieldProps("in_access_group"),error:u(e,"in_access_group")}),t.jsxs(s.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(s.Col,{size:6,children:t.jsx(s.Input,{type:"text",label:"Run as user",autoComplete:"off",required:!0,...e.getFieldProps("username"),error:u(e,"username")})}),t.jsx(s.Col,{size:6,children:t.jsx(s.Input,{type:"text",label:"Time limit (seconds)",autoComplete:"off",required:!0,...e.getFieldProps("time_limit"),error:u(e,"time_limit")})})]}),t.jsx(q,{formik:e}),t.jsx(E,{submitButtonDisabled:e.isSubmitting,submitButtonText:"Run script"})]})};export{le as CreateScriptForm,re as RunInstanceScriptForm,oe as ScriptList,ae as ScriptsContainer,ne as ScriptsEmptyState,ce as ScriptsTabs,h as useGetScripts,pe as useGetSingleScript};
