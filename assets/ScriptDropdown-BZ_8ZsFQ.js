import{j as e,r as p,B as F,an as G,p as i,d,q as v}from"./index-gc_gETRV.js";import{b as H,u as K}from"./ScriptsTabs-BcGgF8jf.js";import"./index-DdJffcsH.js";import{D as V}from"./downshift.esm-DANWulrZ.js";const Y="_container_1yawx_1",$="_suggestionsContainer_1yawx_6",z="_pointer_1yawx_13",J="_highlighted_1yawx_18",M="_selectedContainer_1yawx_22",Q="_marginTop_1yawx_30",W="_extraPadding_1yawx_34",X="_removeButton_1yawx_44",Z="_icon_1yawx_48",o={container:Y,suggestionsContainer:$,pointer:z,highlighted:J,selectedContainer:M,marginTop:Q,extraPadding:W,removeButton:X,icon:Z},I=200,ee=(n,a)=>{const s=n.toLowerCase(),u=a.toLowerCase(),r=s.indexOf(u);return r>=0?e.jsxs(e.Fragment,{children:[n.substring(0,r),e.jsx("strong",{children:n.substring(r,r+a.length)}),n.substring(r+a.length)]}):n},re=({script:n,setScript:a,existingScriptId:s,errorMessage:u,parentAccessGroup:r})=>{const[l,x]=p.useState(""),[m,h]=p.useState(!1),[g,b]=p.useState(""),{script:c,isScriptLoading:T}=H(s||0,{enabled:!!s});p.useEffect(()=>{s&&(n==null?void 0:n.id)!==(c==null?void 0:c.id)&&a(c)},[c]);const B=F(),{scripts:j,isScriptsLoading:_}=K({listenToUrlParams:!1},{search:l,script_type:"active",limit:20,offset:0,parent_access_group:r},{enabled:l.length>2}),D=t=>(n==null?void 0:n.id)!==t.id,C=j.filter(D),E=()=>{a(null)},L=()=>{h(!1)},w=()=>{b(""),x("")},y=()=>{g.length>2?h(!0):h(!1)},O=t=>{b(t),t.length>2&&x(t)},P=G(()=>{try{y()}catch(t){B(t)}},I),R=t=>{t&&(a(t),h(!1),w())},U=t=>{t.key==="Escape"?t.currentTarget.blur():P()},N=g.length<3?"Min 3. characters":j.length===0&&l&&!_?`No scripts found by "${l}"`:s?"Scripts can't be replaced after the profile has been created.":null;return e.jsxs("div",{className:i(o.container,"p-form__group p-form-validation"),children:[e.jsx("label",{className:"is-required p-form__label",htmlFor:s?"script-selected":"script-search",children:"Script"}),!s&&e.jsx(V,{onSelect:R,itemToString:()=>"",isOpen:m,children:({getInputProps:t,getItemProps:k,getMenuProps:q,highlightedIndex:A})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(d.SearchBox,{...t(),id:s?void 0:"script-search",placeholder:"Search for scripts",required:!0,className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:g,onChange:O,onClear:w,onBlur:L,onFocus:y,onKeyUp:U}),N?e.jsx("span",{className:"p-form-help-text",children:N}):null,u&&!m?e.jsx("div",{className:"is-error",children:e.jsx("span",{className:"p-form-validation__message",id:"script-error",children:e.jsx("span",{children:u})})}):null,m&&(C.length>0||_)?e.jsx("ul",{className:i("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",o.suggestionsContainer),...q(),children:_?e.jsx(v,{}):C.map((f,S)=>e.jsx("li",{className:i("p-list__item",o.pointer,{[o.highlighted]:A===S}),...k({item:f,index:S}),children:e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:ee(f.title,l)})},f.id))}):null]})}),T?e.jsx(v,{}):null,n&&e.jsxs("div",{id:"script-selected",className:i("p-autocomplete__result p-list__item p-card u-no-margin--bottom",o.selectedContainer,{[o.marginTop]:!s,[o.extraPadding]:s}),children:[e.jsx("span",{children:e.jsx("b",{children:n.title})}),s?null:e.jsx(d.Button,{type:"button",appearance:"base",className:i(o.removeButton,"u-no-margin--bottom u-no-margin--right"),onClick:E,children:e.jsx(d.Tooltip,{message:"Remove",children:e.jsx(d.Icon,{name:d.ICONS.delete,className:o.icon})})})]},n.id)]})};export{re as S};
