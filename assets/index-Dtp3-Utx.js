import{b as Z,g as O,i as u,k as L,j as e,d as h,af as H,b3 as K,o as I,h as g,l as S,m as _,c as W,e as M,f as N,p as E,q as A,s as V,G as U,J,v as Q,a as X,aA as Y,aY as F,$ as ee,b4 as se,b5 as te,b6 as ne,aC as ae,b7 as re,b8 as ce}from"./index-CAxb-9CO.js";import{P as ie,a as oe,b as le}from"./PageMain-DA-yLzkU.js";import{u as de}from"./useGetInstances-yP-eeW-X.js";import{u as he}from"./useSelection-C1JP7O2F.js";import{u as ue}from"./useGetTags-Byfqctx7.js";import{u as pe}from"./useRoles-CwlY2G8P.js";const me=()=>{const s=Z(),{data:t,isPending:r}=O({queryKey:["availabilityZones"],queryFn:async()=>s.get("computers/availability-zones")});return{availabilityZones:t?.data.values??[],isGettingAvailabilityZones:r}},xe="_menuContainer_xrtuf_1",je="_wrapper_xrtuf_6",T={menuContainer:xe,wrapper:je},fe="_root_1fm3p_1",ge="_label_1fm3p_5",ye="_text_1fm3p_16",ve="_icon_1fm3p_20",Se="_content_1fm3p_24",w={root:fe,label:ge,text:ye,icon:ve,content:Se},_e=({el:s})=>{const[t,r]=u.useState(!1),a=u.useRef(null);L(a,()=>{t&&r(!1)});const i=u.cloneElement(s,{inline:!0});return e.jsxs("div",{ref:a,className:w.root,children:[e.jsxs(h.Button,{type:"button",appearance:"base",className:w.label,onClick:()=>{r(c=>!c)},children:[e.jsx(h.Icon,{name:"chevron-down",className:w.icon}),e.jsx("span",{className:w.text,children:s.props.label})]}),t&&e.jsx("div",{className:`p-contextual-menu__dropdown ${w.content}`,children:i})]})},be=({filters:s,collapseFrom:t="md",menuLabel:r="Filters",className:a,menuPosition:i="right"})=>{const c=H(`(min-width: ${K[t]}px)`);return e.jsx("div",{className:I(T.wrapper,a),children:c?s.map((n,d)=>e.jsx("span",{children:n},d)):e.jsx(h.ContextualMenu,{position:i,hasToggleIcon:!0,toggleLabel:r,toggleClassName:"u-no-margin--bottom",children:e.jsx("div",{className:T.menuContainer,children:s.map((n,d)=>n.type.name?e.jsx(_e,{el:n},d):n)})})})},we="_label_1i8qt_1",Ce={label:we},Ie=({options:s,label:t,inline:r=!1})=>{const{disabledColumns:a,setPageParams:i}=g(),c=n=>s.filter(({value:d})=>!n.includes(d)).map(({value:d})=>d);return S("disabledColumns",s.filter(n=>n.canBeHidden).map(n=>n.value)),e.jsx(_,{type:"multiple",showSelectedItemCount:!0,label:e.jsxs(e.Fragment,{children:[e.jsx(h.Icon,{name:"settings"}),e.jsx("span",{className:Ce.label,children:t})]}),onItemsSelect:n=>{i({disabledColumns:c(n)})},options:s,disabledOptions:s.filter(({canBeHidden:n})=>!n),selectedItems:c(a),inline:r})},$=()=>{const s=W(),t=M(),r=(n={},d={})=>O({queryKey:["savedSearches",n],queryFn:async()=>s.get("GetSavedSearches",{params:n}),...d}),a=N({mutationFn:async n=>s.get("CreateSavedSearch",{params:n}),onSuccess:async()=>t.invalidateQueries({queryKey:["savedSearches"]})}),i=N({mutationFn:async n=>s.get("EditSavedSearch",{params:n}),onSuccess:async()=>t.invalidateQueries({queryKey:["savedSearches"]})}),c=N({mutationFn:async n=>s.get("RemoveSavedSearch",{params:n}),onSuccess:async()=>t.invalidateQueries({queryKey:["savedSearches"]})});return{getSavedSearchesQuery:r,createSavedSearchQuery:a,editSavedSearchQuery:i,removeSavedSearchQuery:c}},Fe="_container_m2ugq_1",Ne="_list_m2ugq_6",ke="_listItem_m2ugq_11",Be="_search_m2ugq_17",Pe="_row_m2ugq_25",$e="_truncated_m2ugq_33",y={container:Fe,list:Ne,listItem:ke,search:Be,row:Pe,truncated:$e},Te=({onSavedSearchClick:s,onSavedSearchRemove:t,savedSearches:r})=>{if(!r.length)return null;const a=E(),{notify:i}=A(),{removeSavedSearchQuery:c}=$(),{mutateAsync:n,isPending:d}=c,l=async o=>{try{await n({name:o}),t(),i.success({message:`Saved search ${o} successfully removed`,title:"Saved search removed"})}catch(m){a(m)}};return e.jsxs("div",{className:y.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Saved searches"}),e.jsx("ul",{className:I("p-list--divided u-no-margin--bottom",y.list),children:r.map(o=>e.jsx("li",{children:e.jsxs("div",{className:y.listItem,children:[e.jsx(h.Button,{type:"button",appearance:"base",className:y.search,onClick:()=>s(o),children:e.jsxs(h.Row,{className:y.row,children:[e.jsx(h.Col,{size:4,children:e.jsx(h.Tooltip,{message:o.name,positionElementClassName:y.truncated,children:e.jsx("span",{children:o.name})})}),e.jsx(h.Col,{size:8,children:e.jsx(h.Tooltip,{message:o.search,positionElementClassName:y.truncated,children:e.jsx("span",{children:o.search})})})]})}),e.jsx(h.ConfirmationButton,{className:"has-icon u-no-margin--bottom u-no-padding--bottom u-no-padding--top",type:"button",appearance:"base",confirmationModalProps:{title:"Remove saved search",children:e.jsxs("p",{children:['This will remove the saved search "',o.name,'".']}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:()=>l(o.name)},children:e.jsx(h.Icon,{name:"delete"})})]})},o.name))})]})},qe="_infoContainer_zti77_1",Re="_helpButtonContainer_zti77_9",Oe="_helpButton_zti77_9",k={infoContainer:qe,helpButtonContainer:Re,helpButton:Oe},Le=({onHelpButtonClick:s})=>e.jsx("div",{className:k.infoContainer,children:e.jsx("div",{className:k.helpButtonContainer,children:e.jsx(h.Button,{type:"button",appearance:"base",hasIcon:!0,className:k.helpButton,onClick:t=>{t.stopPropagation(),s()},children:e.jsx(h.Icon,{name:h.ICONS.help})})})}),Ee=({onClose:s,onSearchSave:t,search:r})=>{const a=E(),{notify:i}=A(),{createSavedSearchQuery:c}=$(),{mutateAsync:n}=c,l=V({initialValues:{name:""},onSubmit:async({name:o})=>{try{await n({search:r,name:o,title:o}),i.success({message:`Saved search ${o} successfully added`,title:"Saved search added"}),t(),s()}catch(m){a(m)}},validationSchema:U({name:J().required("This field is required").test({message:"Name must consist of only lowercase alphanumeric characters and hyphens",test:o=>/^[a-z0-9][-a-z0-9]*$/.test(o)})})});return e.jsxs(h.Form,{onSubmit:l.handleSubmit,noValidate:!0,children:[e.jsx(h.Input,{type:"text",autoComplete:"off",autoFocus:!0,label:"Search name",...l.getFieldProps("name"),error:l.touched.name&&l.errors.name?l.errors.name:void 0}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(h.Button,{type:"button",disabled:l.isSubmitting,onClick:s,children:"Cancel"}),e.jsx(h.Button,{type:"submit",disabled:l.isSubmitting,appearance:"positive","aria-label":`Saved search as ${l.values.name}`,children:"Save search"})]})]})},Ae="_container_fqj7b_1",Qe="_prompt_fqj7b_10",Ge="_saveButton_fqj7b_17",B={container:Ae,prompt:Qe,saveButton:Ge},ze=({onSearchSave:s,search:t})=>{const[r,a]=u.useState(!1);return e.jsxs(e.Fragment,{children:[t&&r&&e.jsx(Ee,{onClose:()=>a(!1),onSearchSave:s,search:t}),t&&!r&&e.jsxs("div",{className:B.container,children:[e.jsxs("span",{className:B.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:t}),e.jsx("span",{children:"..."})]}),e.jsx(h.Button,{type:"button",appearance:"link",onClick:()=>a(!0),className:B.saveButton,children:"Save search"})]})]})},De="_searchContainer_pk8ic_1",Ze="_form_pk8ic_8",He="_searchBoxContainer_pk8ic_13",Ke="_input_pk8ic_17",C={searchContainer:De,form:Ze,searchBoxContainer:He,input:Ke},q=({inputText:s,savedSearches:t,search:r})=>{if(!t)return[];let a=t;if(r){const i=r.split(",").filter(Boolean);a=a.filter(({name:c})=>i.every(n=>n!==`search:${c}`))}return s&&(a=a.filter(({name:i,search:c})=>i.toLowerCase()!==s.trim().toLowerCase()&&c.toLowerCase()!==s.trim().toLowerCase())),a},We=({onHelpButtonClick:s})=>{const{query:t,setPageParams:r}=g(),[a,i]=u.useState(""),[c,n]=u.useState(!1),{getSavedSearchesQuery:d}=$(),l=u.useRef(null),o=u.useRef(null);L(l,p=>{const j=document.querySelector(".p-modal");j&&j.contains(p.target)||n(!1)});const{data:v,isLoading:b}=d(),x=u.useMemo(()=>q({inputText:a,savedSearches:v?.data,search:t}),[v,a,t]),f=()=>{if(!a)return;const j=q({inputText:"",savedSearches:v?.data,search:t}).some(({name:D})=>D.toLowerCase()===a.trim().toLowerCase())?"search:":"";r({query:t?`${t},${j}${a}`:`${j}${a}`}),i("")},G=p=>{r({query:t?`${t},search:${p.name}`:`search:${p.name}`})},z=p=>{const{key:j}=p;c?(j==="Escape"&&n(!1),j==="Enter"&&f()):j==="Enter"&&n(!0)};return e.jsxs("div",{className:"p-search-and-filter",ref:l,children:[e.jsxs("div",{className:I("p-search-and-filter__search-container",C.searchContainer),"aria-expanded":c,ref:o,onClick:()=>{n(!0)},children:[e.jsx(h.Form,{onSubmit:p=>{p.preventDefault(),f()},className:I("p-search-and-filter__box",C.form),children:e.jsx("div",{className:C.searchBoxContainer,children:e.jsx(h.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autocomplete:"off",className:C.input,value:a,onChange:p=>{i(p)},onClear:()=>{i("")},onSearch:f,onClick:()=>{n(!0)},onKeyUp:z})})}),e.jsx(Le,{onHelpButtonClick:s})]}),c&&b&&e.jsx(Q,{}),c&&!b&&e.jsxs("div",{className:"p-search-and-filter__panel",children:[e.jsx(ze,{onSearchSave:()=>{i("")},search:a.trim()}),e.jsx(Te,{onSavedSearchClick:G,onSavedSearchRemove:()=>{n(!0)},savedSearches:x})]})]})},Me=({options:s,label:t,inline:r=!1})=>{const{accessGroups:a,setPageParams:i}=g();return S("accessGroups",s.map(c=>c.value)),e.jsx(_,{type:"multiple",label:t,hasToggleIcon:!0,hasBadge:!0,options:s,onItemsSelect:c=>{i({accessGroups:c})},selectedItems:a,inline:r})},Ve=({options:s,label:t,inline:r=!1})=>{const[a,i]=u.useState(""),{availabilityZones:c,setPageParams:n}=g(),d=s.length>9&&a?s.filter(({value:o})=>o!=="none"&&o.includes(a)):s;S("availabilityZones",d.map(o=>o.value));const l=o=>{o[o.length-1]==="none"?n({availabilityZones:["none"]}):n({availabilityZones:o[0]!=="none"?o:o.filter(m=>m!=="none")})};return e.jsx(_,{type:"multiple",label:t,hasToggleIcon:!0,hasBadge:!0,onSearch:s.length>9?o=>{i(o)}:void 0,options:d,onItemsSelect:l,selectedItems:c,inline:r})},Ue=({options:s,label:t,inline:r=!1})=>{const{os:a,setPageParams:i}=g();return S("os",s.map(c=>c.value)),e.jsx(_,{type:"single",hasBadge:!0,label:t,hasToggleIcon:!0,options:s,onItemSelect:c=>{i({os:c})},selectedItem:a,inline:r})},Je=({options:s,label:t,inline:r=!1})=>{const[a,i]=u.useState(""),{tags:c,setPageParams:n}=g(),d=s.filter(({value:l})=>l.includes(a));return S("tags",d.map(l=>l.value)),e.jsx(_,{type:"multiple",label:t,hasToggleIcon:!0,hasBadge:!0,options:d,onItemsSelect:l=>{n({tags:l})},onSearch:l=>{i(l)},selectedItems:c,inline:r})},Xe=({label:s,inline:t=!1})=>{const{wsl:r,setPageParams:a}=g();return S("wsl",["parent","child"]),e.jsx(_,{type:"multiple",label:s,hasToggleIcon:!0,hasBadge:!0,options:[{label:"WSL parent",value:"parent"},{label:"WSL child",value:"child"}],onItemsSelect:i=>{a({wsl:i})},selectedItems:r,inline:t})},Ye="_top_1d4ve_1",es="_searchContainer_1d4ve_13",ss="_divider_1d4ve_22",P={top:Ye,searchContainer:es,divider:ss},ts=()=>{const{isFeatureEnabled:s}=X(),t=["package","reboot","removal","repository"];s("script-profiles")&&t.push("script"),s("usg-profiles")&&t.push("security"),t.push("upgrade"),s("wsl-child-instance-profiles")&&t.push("wsl");const r=[{term:"<keyword>",description:e.jsxs("span",{children:["Instances with the title or hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"distribution:<keyword>",description:e.jsxs("span",{children:["Instances with the installed distribution named"," ",e.jsx("code",{children:"<keyword>"})]})},{term:"needs:reboot",description:"Instances needing a reboot"},{term:"alert:<type>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with outstanding alerts of the specified"," ",e.jsx("code",{children:"<type>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be ",e.jsx("code",{children:"package-upgrades"}),","," ",e.jsx("code",{children:"security-upgrades"}),",",e.jsx("code",{children:"package-profiles"}),","," ",e.jsx("code",{children:"package-reporter"}),", ",e.jsx("code",{children:"esm-disabled"}),","," ",e.jsx("code",{children:"computer-offline"}),",",e.jsx("code",{children:"computer-reboot"}),","," ",e.jsx("code",{children:"computer-duplicates"}),", ",e.jsx("code",{children:"unapproved-activities"}),"."]})]})},{term:"ip:<address>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with IP addresses like ",e.jsx("code",{children:"<address>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<address>"})," can be a fragment or partial IP address representing a subnet such as 91.185.94 to match any instances in the subnet."]})]})},{term:"mac:<address>",description:e.jsxs("span",{children:["Instances with the MAC address ",e.jsx("code",{children:"<address>"})]})},{term:"id:<instance_id>",description:e.jsxs("span",{children:["Instance with the id ",e.jsx("code",{children:"<instance_id>"})]})},{term:"access-group:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," access group"]})},{term:"search:<name>",description:e.jsxs("span",{children:["Instances meeting the terms of the ",e.jsx("code",{children:"<name>"})," saved search"]})},{term:"upgrade-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," upgrade profile"]})},{term:"removal-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," removal profile"]})},{term:"tag:<keyword>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<keyword>"})," tag"]})},{term:"hostname:<keyword>",description:e.jsxs("span",{children:["Instance with the hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"title:<keyword>",description:e.jsxs("span",{children:["Instance with the title ",e.jsx("code",{children:"<keyword>"})]})},{term:"license-id:<license_id>",description:e.jsxs("span",{children:["Search for instances licensed to the specified"," ",e.jsx("code",{children:"<license_id>"})]})},{term:"needs:license OR license-id:none",description:"Search for instances that do not have a Landscape license, and, as a result, are not managed"},{term:"annotation:<key>",description:e.jsxs("span",{children:["Search for instances which define the specified annotation key. Optionally specify ",e.jsx("code",{children:"annotation:<key>:<string>"})," ","which will only return instances whose key matches and value also contains the ",e.jsx("code",{children:"<string>"})," specified"]})},{term:"profile:<type>:<profile_id>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances associated with the profile of type"," ",e.jsx("code",{children:"<type>"})," with the id"," ",e.jsx("code",{children:"<profile_id>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be"," ",t.map((a,i)=>e.jsxs(e.Fragment,{children:[e.jsx("code",{children:a},a),i<t.length-1&&", "]}))]})]})}];return s("usg-profiles")&&r.push({term:"profile:security:<profile_id>:<last_audit_result>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances associated with the security profile with the id"," ",e.jsx("code",{children:"<profile_id>"})," with a last security audit result of"," ",e.jsx("code",{children:"<last_audit_result>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<last_audit_result>"})," can be ",e.jsx("code",{children:"pass"}),","," ",e.jsx("code",{children:"fail"}),", ",e.jsx("code",{children:"in-progress"})]})]})}),s("wsl-child-instance-profiles")&&r.push({term:"profile:wsl:<profile_id>:<compliance_status>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances associated with the WSL child instance profile with the id"," ",e.jsx("code",{children:"<profile_id>"})," with a compliance state of"," ",e.jsx("code",{children:"<compliance_status>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<compliance_status>"})," can be ",e.jsx("code",{children:"compliant"}),", ",e.jsx("code",{children:"noncompliant"})]})]})}),r},ns=({columnFilterOptions:s})=>{const t=ts(),[r,a]=u.useState(!1),{getAccessGroupQuery:i}=pe(),{tags:c}=ue(),n=c.map(x=>({label:x,value:x}))??[],{availabilityZones:d}=me(),l=d.reduce((x,f)=>(x.push({label:f,value:f}),x),[{label:"Without zones",value:"none",group:"1"}]),{data:o}=i(),m=o?.data.map(({name:x,title:f})=>({value:x,label:f}))??[],v=F.status.options,b=F.os.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:P.top,children:[e.jsx("div",{className:P.searchContainer,children:e.jsx(We,{onHelpButtonClick:()=>{a(!0)}})}),e.jsx(be,{collapseFrom:"xxl",filters:[e.jsx(Y,{label:"Status",options:v},"status"),e.jsx(Ue,{label:"OS",options:b},"os"),e.jsx(Ve,{label:"Availability zones",options:l},"availability-zone"),e.jsx(Me,{label:"Access groups",options:m},"access-group"),e.jsx(Je,{label:"Tags",options:n},"tag"),e.jsx(Xe,{label:"WSL",options:[]},"wsl"),e.jsx("span",{className:P.divider},"divider-2"),e.jsx(Ie,{label:"Columns",options:s},"column")]})]}),e.jsx(ee,{filtersToDisplay:["accessGroups","os","availabilityZones","status","tags","query","wsl"],accessGroupOptions:m,availabilityZonesOptions:l,osOptions:b,statusOptions:v,tagOptions:n}),e.jsx(se,{open:r,data:t,onClose:()=>{a(!1)}}),e.jsx(te,{})]})},as=u.memo(function({instanceCount:t,instances:r,isGettingInstances:a,selectedInstances:i,setSelectedInstances:c}){const[n,d]=u.useState([]),l=u.useCallback(()=>{c([])},[]);return e.jsxs(e.Fragment,{children:[e.jsx(ns,{columnFilterOptions:n}),a?e.jsx(Q,{}):e.jsx(ne,{instances:r,selectedInstances:i,setColumnFilterOptions:d,setSelectedInstances:c}),e.jsx(ae,{totalItems:t,handleClearSelection:l,currentItemCount:r.length})]})}),R=(s,t)=>s.type==="select"?s.options.find(r=>r.value===t)?.query??"":"",rs=({accessGroups:s,availabilityZones:t,os:r,query:a,status:i,tags:c})=>{const n=[];return r&&n.push(R(F.os,r)),i&&n.push(R(F.status,i)),a&&n.push(...a.split(",")),c.length&&n.push(`tag:${c.join(" OR tag:")}`),s.length&&n.push(`access-group:${s.join(" OR access-group:")}`),t.length&&n.push(t.includes("none")?"availability-zone:null":`availability-zone:${t.join(" OR availability-zone:")}`),n.join(" ")},us=()=>{const{currentPage:s,pageSize:t,wsl:r,...a}=g(),{instances:i,instancesCount:c,isGettingInstances:n,isErrorInstances:d}=de({query:rs(a),archived_only:a.status==="archived",with_alerts:!0,with_upgrades:re,limit:t,offset:(s-1)*t,wsl_children:r.includes("child"),wsl_parents:r.includes("parent")}),{selectedItems:l,setSelectedItems:o}=he(i,n||d);return e.jsxs(ie,{children:[e.jsx(oe,{title:"Instances",actions:[e.jsx(ce,{isGettingInstances:n,selectedInstances:l},"actions")],sticky:!0}),e.jsx(le,{children:e.jsx(as,{instanceCount:c,instances:i,isGettingInstances:n,selectedInstances:l,setSelectedInstances:o})})]})};export{us as default};
