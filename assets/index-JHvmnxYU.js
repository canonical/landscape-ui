import{h as P,i as B,k,q as $,s as q,p as O,n as h,a0 as E,j as t,e as l,a as G,J as N}from"./index-CIJ7mRT9.js";import{S as R}from"./SidePanelFormButtons-Cffo84ct.js";import{u as D,T as Q}from"./TagsAddConfirmationModal-BZM19Dxz.js";import{u as W}from"./useGetTags-cUsnp65U.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./ModalTablePagination-BIC1ZD_y.js";const z=()=>{const e=P(),r=B(),{isPending:d,mutateAsync:g}=k({mutationFn:async m=>e.get("AddTagsToComputers",{params:m}),onSuccess:async()=>r.invalidateQueries({queryKey:["instances"]})});return{addTagsToInstances:g,isAddingTagsToInstances:d}},X=({selected:e})=>{const r=$(),{notify:d}=q(),{closeSidePanel:g}=O(),{addTagsToInstances:m,isAddingTagsToInstances:f}=z(),{tags:T,isGettingTags:C}=W(),[n,u]=h.useState([]),{isFetchingProfileChanges:x,profileChangesCount:b,refetchProfileChanges:j}=D({instance_ids:e.map(s=>s.id),tags:T,limit:10},{enabled:!1}),{value:v,setFalse:S,setTrue:w}=E(),[c,A]=h.useState(""),p=async()=>{try{await m({query:e.map(({id:s})=>`id:${s}`).join(" OR "),tags:n}),g(),d.success({title:"Tags assigned",message:`Tags successfully assigned to ${N(e.length,`"${e[0]?.title??""}" instance`,`${e.length} instances`)}`})}catch(s){r(s)}},F=async()=>{const s=await j();if(!s.isSuccess){r(s.error);return}s.data.data.count?w():await p()},o=T.filter(s=>s.toLowerCase().includes(c.toLowerCase()))??[],L=()=>{o.every(s=>n.includes(s))?u([]):u(o)},I=h.useMemo(()=>[{accessor:"value",Header:t.jsxs(t.Fragment,{children:[t.jsx(l.CheckboxInput,{inline:!0,label:null,disabled:o.every(s=>e.every(i=>i.tags.includes(s))),checked:o.every(s=>n.includes(s)||e.every(i=>i.tags.includes(s))),indeterminate:o.some(s=>e.some(i=>!i.tags.includes(s)))&&o.some(s=>e.some(i=>i.tags.includes(s))),onChange:L}),"Name"]}),Cell:({row:{original:{value:s},index:i}})=>{const M=()=>{if(n.includes(s)){u(n.toSpliced(n.findIndex(a=>a==s),1));return}e.every(a=>a.tags.includes(s))||u([...n,s])};return t.jsx(l.CheckboxInput,{inline:!0,label:s,disabled:e.every(a=>a.tags.includes(s)),name:`tag-${i}`,checked:n.includes(s)||e.every(a=>a.tags.includes(s)),indeterminate:!n.includes(s)&&e.some(a=>a.tags.includes(s))&&e.some(a=>!a.tags.includes(s)),onChange:M})}}],[n,o]);if(C)return t.jsx(G,{});const y=o.map(s=>({value:s}));return t.jsxs(t.Fragment,{children:[t.jsx("p",{children:"Adding tags will associate the instance with the profiles that tag is linked to. This may change configurations on your instance."}),t.jsx(l.SearchBox,{value:c,onChange:s=>{A(s)}}),t.jsx(l.ModularTable,{emptyMsg:"No tags found",columns:I,data:[...y.filter(({value:s})=>s.toLowerCase().startsWith(c.toLowerCase())),...y.filter(({value:s})=>!s.toLowerCase().startsWith(c.toLowerCase()))]}),t.jsx(R,{onSubmit:F,submitButtonDisabled:!n.length,submitButtonLoading:f||x,submitButtonText:"Assign"}),v&&t.jsx(Q,{instances:e,tags:n,onConfirm:p,confirmButtonLoading:f,close:S,profileChangesCount:b})]})};export{X as default};
