import{r as f,l as S,a as _,e as k,m as $,j as e,g as l,h as N,R as L,k as w}from"./index-BMhnQnvO.js";import{E as A}from"./EmptyState-ClMN1u86.js";import"./moment-BcE1DmV8.js";import{u as h}from"./usePageParams-C2gko9oh.js";import{u as x}from"./useUsns-Dw6dj2_v.js";import{u as T}from"./useConfirm-DBWWlNvT.js";import{U as q}from"./UsnList-DDpKnMX7.js";import"./useFetchOld-Cff5y19B.js";import"./useMutation-Diy-BhWO.js";import"./useQuery-Dxk6aJEc.js";import"./SelectAllButton-D_BMBSCB.js";import"./ExpandableTableFooter-9RPwl5aD.js";import"./NoData-D_FYardG.js";import"./TablePagination-BdWPaBG6.js";import"./TablePagination.module-DLVph1Z1.js";import"./TruncatedCell-iDjT0CSt.js";import"./helpers-BQ6A_CwO.js";import"./useOnClickOutside-B6njW3aZ.js";const E="_container_viyqm_1",D="_searchContainer_viyqm_5",B="_cta_viyqm_9",m={container:E,searchContainer:D,cta:B},F=({onSearch:r,usns:t})=>{const[a,n]=f.useState(""),{instanceId:o,childInstanceId:s}=S(),{setPageParams:c}=h(),u=_(),p=k(),{notify:i}=$(),{confirmModal:y,closeConfirmModal:j}=T(),{upgradeInstanceUsnsQuery:b}=x(),g=Number(o),{mutateAsync:U,isLoading:v}=b,I=()=>{u(`${L}instances/${s?`${g}/${s}`:`${g}`}`),c({tab:"activities"}),i.clear()},P=async()=>{try{await U({instanceId:g,usns:t}),i.success({title:"You queued packages to be upgraded",message:`Affected packages for ${t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:I}]})}catch(d){p(d)}finally{j()}},C=()=>{y({title:"Upgrade affected packages",body:`This will upgrade affected packages for ${t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`}.`,buttons:[e.jsx(l.Button,{appearance:"positive",onClick:P,disabled:v,"aria-label":"Upgrade selected packages",children:"Upgrade"},"upgrade")]})};return e.jsxs("div",{className:m.container,children:[e.jsx("div",{className:m.searchContainer,children:e.jsx(l.Form,{onSubmit:d=>{d.preventDefault(),r(a)},noValidate:!0,children:e.jsx(l.SearchBox,{shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:a,onChange:d=>n(d),onSearch:()=>r(a),onClear:()=>{n(""),r("")}})})}),e.jsx("div",{className:N("p-segmented-control",m.cta),children:e.jsxs(l.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:C,disabled:t.length===0,children:[e.jsx(l.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]})})]})},V=({instance:r,isUsnsLoading:t,totalUsnCount:a,usns:n})=>{const[o,s]=f.useState([]),{search:c,setPageParams:u}=h(),p=i=>{u({search:i}),s([])};return e.jsxs(e.Fragment,{children:[e.jsx(F,{onSearch:p,usns:o}),e.jsx(q,{tableType:"paginated",instances:[r],isUsnsLoading:t,onSelectedUsnsChange:i=>s(i),search:c,selectedUsns:o,totalUsnCount:a,usns:n})]})},H=({instance:r})=>{const{search:t,currentPage:a,pageSize:n}=h(),{getUsnsQuery:o}=x(),{data:s,isLoading:c}=o({computer_ids:[r.id],limit:n,offset:(a-1)*n,search:t,show_packages:!1});return e.jsxs(e.Fragment,{children:[!t&&a===1&&n===20&&c&&e.jsx(w,{}),!t&&a===1&&n===20&&!c&&(!s||s.data.results.length===0)&&e.jsx(A,{icon:"inspector-debug",title:"No security issues found"}),(t||a>1||n!==20||!c&&s&&s.data.results.length>0)&&e.jsx(V,{instance:r,isUsnsLoading:c,totalUsnCount:(s==null?void 0:s.data.count)??0,usns:(s==null?void 0:s.data.results)??[]})]})},ce=H;export{ce as default};
