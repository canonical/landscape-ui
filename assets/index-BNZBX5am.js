const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Ck-zstnl.js","assets/index-BQ4lKZ_y.js","assets/index-B6lWc-2N.css","assets/useInstances-DOwT-vNv.js","assets/SidePanelFormButtons-BLBhy2Ao.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/useRoles-B78I0BEl.js","assets/index-b7i018L7.js","assets/ScriptsTabs-Cg2vHxqb.js","assets/HeaderWithSearch-khaegu--.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-C4SOEJV8.js","assets/useExpandableRow-DFQIqQ3Q.js","assets/ScriptsTabs-DN44MVZt.css","assets/DeliveryBlock-CtLxdJSF.js","assets/DeliveryBlock-VExRkUer.css","assets/ScriptDropdown-CEkH8d24.js","assets/downshift.esm-Cc7ejX0I.js","assets/ScriptDropdown-Wdg9HaWt.css","assets/index-DlBmVomf.js","assets/CodeEditor-BK0B0hSj.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-n-VGsvSX.js","assets/AttachmentFile-BSekj9tI.js","assets/AttachmentFile-B_HSPNHl.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-CnqoeEGZ.js","assets/EmployeeGroupIdentityIssuerList-HR2RfLFw.js","assets/SidePanelTablePagination-Zmb1EO4M.js","assets/EmployeeGroupIdentityIssuerList-CdRpefPn.css","assets/EmployeeList-CbdyA8Ck.js","assets/EmployeeList-BQrbbWYX.css","assets/index-0uuPVSHU.css"])))=>i.map(i=>d[i]);
import{j as e,p as _,aV as ve,r as o,d as s,P as de,aW as ye,m as Ie,q as F,M as Ce,af as we,O as Se,x as ae,as as ie,N as I,D as Ae,a as Ne,B as Re,a3 as Te,C as Be,o as Ee,b as De,F as ke,I as Le,aa as oe,G as re,a2 as te}from"./index-BQ4lKZ_y.js";import{u as ee}from"./useInstances-DOwT-vNv.js";import{R as Pe,c as $e}from"./ResponsiveButtons-Bk0P-rXa.js";import"./InstancesPageActions-qkvsV6cO.js";import{u as ze}from"./useRoles-B78I0BEl.js";import{u as Oe,T as Fe}from"./TagsAddConfirmationModal-DyXJNpju.js";import{u as Ve}from"./WslInstancesHeader-C9eIbywJ.js";import"./HeaderWithSearch-khaegu--.js";const Me="_infoContainer_1ca11_1",qe="_amount_1ca11_9",le={infoContainer:Me,amount:qe},Qe=({isExpanded:t,overflowingChipsAmount:n})=>n>0&&!t&&e.jsx("div",{className:le.infoContainer,children:e.jsx("span",{className:_("u-text--muted",le.amount),children:`+${n}`})}),Ge=({containerRef:t,onDismiss:n,onOverflowingItemsAmountChange:r,tagData:h})=>{const m=()=>{if(!t.current)return;const l=t.current.querySelectorAll("span.p-chip");r(Array.from(l).filter(({offsetHeight:j,offsetTop:x})=>x>j).length)};return ve("resize",m),o.useEffect(()=>{m()},[h.length]),h.map(l=>e.jsx(s.Chip,{value:l,onDismiss:()=>{n(l)}},l))},He="_container_22v5i_1",Ue="_list_22v5i_6",We="_listItem_22v5i_11",Ze="_search_22v5i_17",O={container:He,list:Ue,listItem:We,search:Ze},Ye=({onTagClick:t,tags:n})=>n.length?e.jsxs("div",{className:O.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Tags"}),e.jsx("ul",{className:_("p-list--divided u-no-margin--bottom",O.list),children:n.map(r=>e.jsx("li",{children:e.jsx("div",{className:O.listItem,children:e.jsx(s.Button,{type:"button",appearance:"base",className:O.search,onClick:()=>t(r),children:r})})},r))})]}):null,Ke="_container_fqj7b_1",Je="_prompt_fqj7b_10",Xe="_saveButton_fqj7b_17",X={container:Ke,prompt:Je,saveButton:Xe},et=({onTagAdd:t,search:n})=>e.jsx(e.Fragment,{children:n&&e.jsxs("div",{className:X.container,children:[e.jsxs("span",{className:X.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:n}),e.jsx("span",{children:"..."})]}),e.jsx(s.Button,{type:"button",appearance:"link",onClick:t,className:X.saveButton,children:"Add tag"})]})}),ce=de().matches(/^[a-zA-Z]/,{message:"Tag must starts with a letter",excludeEmptyString:!0}).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,{message:"Tag can only contain letters, numbers, hyphens, and underscores",excludeEmptyString:!0}),tt="_searchContainer_30px9_1",st="_box_30px9_9",nt="_inputContainer_30px9_14",at="_inputError_30px9_19",it="_input_30px9_14",N={searchContainer:tt,box:st,inputContainer:nt,inputError:at,input:it},ot=({onTagsChange:t,tags:n,label:r,labelClassName:h,required:m})=>{const[l,j]=o.useState(""),[x,v]=o.useState(""),[S,A]=o.useState(!1),[f,R]=o.useState(""),[p,b]=o.useState(!1),[V,M]=o.useState(0),{height:T}=ye(),[q,B]=o.useState({top:"100%",bottom:"auto"}),{getAllInstanceTagsQuery:Q}=ee(),E=o.useRef(null),c=o.useRef(null);o.useEffect(()=>{if(!c.current)return;const i=c.current.querySelector("input");i&&R(i.id)},[c.current]);const G=()=>{if(!c.current)return;const{top:i,height:d}=c.current.getBoundingClientRect();i+d+379<T?B({top:"100%",bottom:"auto"}):B({top:"auto",bottom:"100%"})};o.useEffect(()=>{!p||!c.current||G()},[T,p,c.current,c.current?.clientHeight]);const D=()=>{b(!1)};Ie(E,D);const H=i=>{t(n.filter(d=>d!==i))},{data:C,isLoading:k}=Q(),U=o.useMemo(()=>C?!l&&!n.length?C.data.results:C.data.results.filter(i=>!n.includes(i)).filter(i=>i.toLowerCase().includes(l.trim().toLowerCase())):[],[C,l,n]),L=i=>{t([...n,i])},P=()=>{if(l.trim())try{const i=ce.validateSync(l.trim())??"";L(i),j(""),v(""),A(!1)}catch(i){i instanceof Error&&(v(i.message),A(!0))}},y=i=>{if(j(i.target.value),S)try{ce.validateSync(i.target.value),v("")}catch(d){d instanceof Error&&v(d.message)}},W=i=>{const{key:d}=i;p?(d==="Escape"&&D(),d==="Enter"&&P()):d==="Enter"&&b(!0)};return e.jsxs("div",{children:[e.jsx("label",{className:_("p-form__label",{"is-required":m},h),htmlFor:f,children:r||"Tags"}),e.jsxs("div",{className:"p-search-and-filter",ref:E,children:[e.jsxs("div",{className:_("p-search-and-filter__search-container",N.searchContainer),"aria-expanded":p,ref:c,onClick:()=>{b(!0)},children:[e.jsx(Ge,{containerRef:c,onDismiss:H,onOverflowingItemsAmountChange:i=>{M(i)},tagData:n}),e.jsx("div",{className:_("p-search-and-filter__box",N.box),children:e.jsx("div",{className:N.inputContainer,children:e.jsx(s.Input,{type:"text",autoComplete:"off",value:l,onChange:y,placeholder:"Add tags",className:_("u-no-margin--bottom",N.input),onClick:()=>{b(!0)},onKeyUp:W,wrapperClassName:x?"is-error":"","aria-errormessage":x?`${f}-error`:void 0,"aria-invalid":!!x})})}),x&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:_("p-form-validation__message",N.inputError),id:`${f}-error`,children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:x})]})}),e.jsx(Qe,{isExpanded:p,overflowingChipsAmount:V})]}),p&&k&&e.jsx(F,{}),p&&!k&&e.jsxs("div",{className:"p-search-and-filter__panel",style:q,children:[e.jsx(et,{onTagAdd:P,search:l}),e.jsx(Ye,{onTagClick:L,tags:U})]})]})]})},rt={deliver_after:"",deliverImmediately:!0,action:null},lt=Ce().shape({deliver_after:de().when("deliverImmediately",{is:!1,then:t=>t.required("This field is required").test({message:"Invalid date",test:n=>ae(n).isValid()}).test({message:"Date must be in the future",test:n=>ae(n).isAfter()})}),deliverImmediately:Se(),action:we().oneOf(["shutdown","reboot"]).required()}),ct=t=>{const n=t.grouped_hardware?.network;return!Array.isArray(n)||n.length===0?e.jsx(I,{}):n.filter(({ip:r})=>r!=="Not available").map(({ip:r})=>r).join(", ")||e.jsx(I,{})},dt=(t,n)=>[{label:"instance ID",value:t.id},{label:"Hostname",value:t.hostname},{label:"IP Address",value:ct(t)},{label:"Serial number",value:t.grouped_hardware?.system.serial??e.jsx(I,{})},{label:"Product identifier",value:t.grouped_hardware?.system.model??e.jsx(I,{})},{label:"Distribution",value:t.distribution??"Unknown"},{label:"Access group",value:n.find(({value:r})=>r===t.access_group)?.label||t.access_group},{label:"Last ping time",value:t.last_ping_time&&ie(t.last_ping_time).isValid()?ie(t.last_ping_time).format(Ae):e.jsx(I,{})},{label:"Annotations",value:t.annotations?Object.entries(t.annotations).map(([r,h],m,l)=>e.jsxs(o.Fragment,{children:[e.jsx("span",{children:`${r}: ${h}`}),m<l.length-1&&e.jsx("br",{})]},r)):e.jsx(I,{})},{label:"Comment",value:t.comment||e.jsx(I,{})}],ut="_titleRow_2b43d_1",mt="_flexContainer_2b43d_6",pt="_italic_2b43d_11",ht="_infoRow_2b43d_15",ft="_tagSection_2b43d_20",gt="_tagsRow_2b43d_25",xt="_tagsButton_2b43d_34",g={titleRow:ut,flexContainer:mt,italic:pt,infoRow:ht,tagSection:ft,tagsRow:gt,tagsButton:xt},bt=o.lazy(async()=>te(()=>import("./index-Ck-zstnl.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),_t=o.lazy(async()=>te(()=>import("./index-b7i018L7.js"),__vite__mapDeps([8,9,1,2,7,10,11,12,13,14,15,16,4,5,6,17,18,19,20,21,22,23,24,25,26,27,28])).then(t=>({default:t.RunInstanceScriptForm}))),jt=o.lazy(async()=>te(()=>import("./index-CnqoeEGZ.js"),__vite__mapDeps([29,1,2,4,5,6,14,30,10,11,31,32,33,34,20,35]))),Tt=({instance:t})=>{const[n,r]=o.useState([...t.tags]),[h,m]=o.useState(""),[l,j]=o.useState(!1),[x,v]=o.useState(!1),S=n.filter(a=>!t.tags.includes(a)),A=Ne(),f=Re(),{openActivityDetails:R}=Te(),{notify:p}=Be(),{setSidePanelContent:b}=Ee(),{getAccessGroupQuery:V}=ze(),{removeInstancesQuery:M,rebootInstancesQuery:T,sanitizeInstanceQuery:q,shutdownInstancesQuery:B}=ee(),{deleteChildInstancesQuery:Q}=Ve(),{editInstanceQuery:E}=ee(),{isFeatureEnabled:c}=De(),{isFetchingProfileChanges:G,profileChangesCount:D,refetchProfileChanges:H}=Oe({instance_ids:[t.id],tags:S,limit:10},{enabled:!1});o.useEffect(()=>{r([...t.tags])},[t.tags]);const{data:C}=V(),k=C?.data.map(({name:a,title:z})=>({label:z,value:a}))??[],{mutateAsync:U,isPending:L}=E,{mutateAsync:P,isPending:y}=M,{mutateAsync:W,isPending:i}=T,{mutateAsync:d,isPending:Z}=B,{mutateAsync:ue,isPending:se}=Q,{mutateAsync:me,isPending:Y}=q,pe=n.length!==t.tags.length||n.some(a=>!t.tags.includes(a))||t.tags.some(a=>!n.includes(a)),u=ke({initialValues:rt,validationSchema:lt,onSubmit:async a=>{if(!a.action)return;const z={computer_ids:[t.id],deliver_after:a.deliverImmediately?void 0:`${a.deliver_after}:00Z`};try{const{data:J}=a.action==="reboot"?await W(z):await d(z),ne=a.action==="reboot"?"restarted":"shut down";p.success({title:`You queued "${t.title}" to be ${ne}`,message:`Instance "${t.title}" will be ${ne} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{R(J)}}]})}catch(J){f(J)}}}),w=()=>{m("")},he=async()=>{try{await P({computer_ids:[t.id]}),A("/instances",{replace:!0})}catch(a){f(a)}finally{w()}},fe=async()=>{try{const{data:a}=await me({computer_id:t.id,computer_title:t.title});p.success({title:`You have successfully initiated Sanitization for ${t.title}`,message:`Sanitizing for ${t.title} has been queued in Activities. The data will be permanently irrecoverable once complete.`,actions:[{label:"View details",onClick:()=>{R(a)}}]})}catch(a){f(a)}finally{w()}},K=async()=>{try{await U({instanceId:t.id,tags:n}),p.success({title:"Tags updated",message:`"${t.title}" instance tags have been updated successfully`})}catch(a){f(a)}finally{w()}},ge=async()=>{if(S.length){const a=await H();a.isSuccess?a.data.data.count?m("tags"):await K():f(a.error)}else await K()},xe=()=>{b("Edit Instance",e.jsx(o.Suspense,{fallback:e.jsx(F,{}),children:e.jsx(bt,{instance:t})}))},be=()=>{b("Run script",e.jsx(o.Suspense,{fallback:e.jsx(F,{}),children:e.jsx(_t,{parentAccessGroup:t.access_group,query:`id:${t.id}`})}))},_e=()=>{b(`Associate employee with ${t.title}`,e.jsx(o.Suspense,{fallback:e.jsx(F,{}),children:e.jsx(jt,{instanceTitle:t.title,employeeId:t.employee_id})}))},je=async()=>{try{await ue({computer_ids:[t.id]}),A("/instances",{replace:!0})}catch(a){f(a)}},$=async a=>{await u.setFieldValue("action",a),u.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:g.titleRow,children:[e.jsxs("div",{className:g.flexContainer,children:[e.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:t.title}),t.is_wsl_instance&&e.jsx("p",{className:_("u-text--muted u-no-margin--bottom",g.italic),children:"WSL Instance"})]}),e.jsxs("div",{className:g.flexContainer,children:[t.is_wsl_instance&&e.jsx(s.ConfirmationButton,{className:"u-no-margin--bottom u-no-margin--right",type:"button",confirmationModalProps:{title:"Delete instance",children:e.jsxs("p",{children:["This will permanently delete the instance"," ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:se,confirmButtonLoading:se,onConfirm:je},children:"Delete instance"}),e.jsx(Pe,{collapseFrom:"xxl",buttons:[e.jsxs(s.Button,{type:"button",onClick:xe,hasIcon:!0,children:[e.jsx(s.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]},"edit-instance"),$e("runScripts",t)&&e.jsxs(s.Button,{type:"button",onClick:be,hasIcon:!0,children:[e.jsx(s.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]},"run-script"),e.jsxs(s.Button,{hasIcon:!0,type:"button",disabled:y,onClick:()=>{m("remove")},"aria-label":`Remove ${t.title} instance`,children:[e.jsx(s.Icon,{name:s.ICONS.delete}),e.jsx("span",{children:"Remove from Landscape"})]},"remove-instance"),e.jsxs(s.Button,{hasIcon:!0,type:"button",disabled:Y,onClick:()=>{m("sanitize")},"aria-label":`Sanitize ${t.title} instance`,children:[e.jsx(s.Icon,{name:"tidy"}),e.jsx("span",{children:"Sanitize"})]},"sanitize-instance"),e.jsxs(s.Button,{hasIcon:!0,type:"button",disabled:y,onClick:()=>{j(!0)},children:[e.jsx(s.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]},"reboot-instance"),c("employee-management")&&e.jsxs(s.Button,{type:"button",hasIcon:!0,onClick:_e,children:[e.jsx(s.Icon,{name:s.ICONS.user}),e.jsx("span",{children:"Associate employee"})]},"associate-employee"),e.jsxs(s.Button,{hasIcon:!0,type:"button",disabled:y,onClick:()=>{v(!0)},children:[e.jsx(s.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]},"shutdown-instance")]})]})]}),e.jsx("div",{className:g.infoRow,children:e.jsx(s.Row,{className:"u-no-padding--left u-no-padding--right u-no-max-width",children:dt(t,k).map(a=>e.jsx(s.Col,{size:4,children:e.jsx(Le,{...a})},a.label))})}),e.jsx("div",{className:g.tagSection,children:e.jsxs(s.Row,{className:g.tagsRow,children:[e.jsx(s.Col,{size:4,children:e.jsx(ot,{labelClassName:"p-text--small p-text--small-caps u-text--muted",onTagsChange:a=>{r(a)},tags:n})}),e.jsx(s.Col,{size:2,className:g.tagsButton,children:e.jsx(s.ActionButton,{type:"button",className:"u-no-margin--bottom",onClick:ge,disabled:!pe,loading:G,children:"Update"})})]})}),h==="tags"&&e.jsx(Fe,{instances:[t],tags:S,onConfirm:K,confirmButtonDisabled:L,close:w,profileChangesCount:D}),e.jsx(oe,{isOpen:h==="remove",title:"Remove instance from Landscape",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:y,confirmButtonLoading:y,onConfirm:he,close:w,confirmationText:`remove ${t.title}`,children:e.jsxs("p",{children:["Removing this ",t.title," will delete all associated data and free up one license slot for another computer to be registered."]})}),e.jsx(oe,{isOpen:h==="sanitize",confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:Y,confirmButtonLoading:Y,onConfirm:fe,close:w,confirmationText:`sanitize ${t.title}`,title:"Sanitize instance",children:e.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",t.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})}),l&&e.jsx(s.ConfirmationModal,{close:()=>{j(!1)},title:"Restart instance",confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonDisabled:i,confirmButtonLoading:i,onConfirm:async()=>$("reboot"),children:e.jsxs(s.Form,{onSubmit:async()=>$("reboot"),noValidate:!0,children:[e.jsx(s.CheckboxInput,{label:"Deliver as soon as possible",...u.getFieldProps("deliverImmediately"),checked:u.values.deliverImmediately}),e.jsx(s.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:g.input,placeholder:"Scheduled time",...u.getFieldProps("deliver_after"),disabled:u.values.deliverImmediately,error:re(u,"deliver_after")}),e.jsxs("p",{children:['This will restart "',t.title,'" instance.']})]})}),x&&e.jsx(s.ConfirmationModal,{close:()=>{v(!1)},title:"Shut down instance",confirmButtonLabel:"Shutdown",confirmButtonAppearance:"negative",confirmButtonDisabled:Z,confirmButtonLoading:Z,onConfirm:async()=>$("shutdown"),children:e.jsxs(s.Form,{onSubmit:async()=>$("shutdown"),noValidate:!0,children:[e.jsx(s.CheckboxInput,{label:"Deliver as soon as possible",...u.getFieldProps("deliverImmediately"),checked:u.values.deliverImmediately}),e.jsx(s.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:g.input,placeholder:"Scheduled time",...u.getFieldProps("deliver_after"),disabled:u.values.deliverImmediately,error:re(u,"deliver_after")}),e.jsxs("p",{children:['This will shut down "',t.title,'" instance.']})]})})]})};export{Tt as default};
