import{r as h,j as e,g as a,m as y,h as v,k as f,t as _,i as w,p as D,f as T,s as z,M as O}from"./index-DM-5oHlz.js";import{S as E}from"./SidePanelFormButtons-DAFaAJmg.js";import{A as L}from"./AssociationBlock-U_VDSBbw.js";import{u as C,R as B,a as $}from"./index-BCmHucX5.js";import{u as V}from"./useAPTSources-BiwUwrnQ.js";import{u as Q}from"./useRoles-CXJG4JFS.js";import{u as q}from"./constants-B22EWc3S.js";import"./usePageParams-CQNbyqOJ.js";import{t as N}from"./tests-yJleJdOg.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new t.Error().stack;s&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[s]="db922b4b-2f7d-4eae-97a8-74e5dcc209a7",t._sentryDebugIdIdentifier="sentry-dbid-db922b4b-2f7d-4eae-97a8-74e5dcc209a7")}catch{}const F=({label:t,onSearchChange:s})=>{const[l,r]=h.useState(""),[o,i]=h.useState(null),c=h.useRef(null);return h.useEffect(()=>{c.current&&i(c.current.querySelector("input"))},[c.current]),e.jsxs("div",{className:"p-search-box",ref:c,children:[e.jsx("label",{className:"u-off-screen",htmlFor:o==null?void 0:o.id,children:t}),e.jsx(a.Input,{type:"search",autoComplete:"off",className:"p-search-box__input",name:"search",placeholder:"Search",value:l,onChange:n=>r(n.target.value),onKeyDown:n=>{n.key==="Enter"&&(n.preventDefault(),s(l))}}),l&&e.jsx(a.Button,{type:"reset",className:"p-search-box__reset",onClick:()=>{s(""),r(""),o==null||o.focus()},"aria-label":"Reset search",children:e.jsx(a.Icon,{name:a.ICONS.close})}),e.jsx(a.Button,{type:"button",className:"p-search-box__button",onClick:()=>s(l),"aria-label":t,children:e.jsx(a.Icon,{name:a.ICONS.search})})]})},M=(t,s)=>s?t.filter(({name:l,line:r})=>l.match(s)||r.match(s)):t,G=({aptSources:t,formik:s})=>{const[l,r]=h.useState(""),o=M(t,l);return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:"Search for APT sources",onSearchChange:i=>r(i)}),e.jsxs("fieldset",{className:y("checkbox-group",{"is-error":s.touched.apt_sources&&s.errors.apt_sources}),children:[e.jsxs(a.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(a.Col,{small:1,medium:2,size:4,children:e.jsx("p",{className:"p-heading--5 p-text--small p-text--small-caps",children:"Name"})}),e.jsx(a.Col,{small:3,medium:4,size:8,children:e.jsx("p",{className:"p-heading--5 p-text--small p-text--small-caps",children:"Line"})})]}),o.length===0&&e.jsx("p",{children:`No APT sources found with the search: "${l}".`}),o.length>0&&e.jsx("ul",{className:"p-list--divided u-no-margin--bottom",children:o.map(({id:i,line:c,name:n})=>e.jsx("li",{className:"p-list__item",children:e.jsxs(a.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(a.Col,{small:1,medium:2,size:4,children:e.jsx(a.CheckboxInput,{label:n,...s.getFieldProps("apt_sources"),checked:s.values.apt_sources.includes(i),onChange:()=>s.setFieldValue("apt_sources",s.values.apt_sources.includes(i)?s.values.apt_sources.filter(g=>g!==i):[...s.values.apt_sources,i])})}),e.jsx(a.Col,{small:3,medium:4,size:8,children:e.jsx("p",{className:"u-no-margin--bottom u-truncate",title:c,children:c})})]})},n))})]})]})},H=({accessGroups:t,formik:s,isTitleRequired:l=!1})=>{const r=t.map(({name:o,title:i})=>({label:i,value:o}));return e.jsxs(e.Fragment,{children:[e.jsx(a.Input,{type:"text",label:"Title",required:l,autoComplete:"off",error:s.touched.title&&s.errors.title?s.errors.title:void 0,...s.getFieldProps("title")}),e.jsx(a.Input,{type:"text",label:"Description",autoComplete:"off",error:s.touched.description&&s.errors.description?s.errors.description:void 0,...s.getFieldProps("description")}),e.jsx(a.Select,{label:"Access group",options:r,error:s.touched.access_group&&s.errors.access_group?s.errors.access_group:void 0,...s.getFieldProps("access_group")}),e.jsx(L,{formik:s})]})},K=t=>t.filter(({series:s})=>s.length&&s.some(({pockets:l})=>l.length)).map(({name:s,series:l})=>({distributionName:s,series:l.filter(({pockets:r})=>r.length).map(({name:r,pockets:o})=>({seriesName:r,pockets:o.map(({name:i,id:c})=>({pocketName:i,value:c}))}))})),U=(t,s)=>{const l=K(t),r=[];for(const{distributionName:o,series:i}of l)if(o.match(s))r.push({distributionName:o,series:i});else{const c=[];for(const{seriesName:n,pockets:g}of i)if(n.match(s))c.push({seriesName:n,pockets:g});else{const x=[];for(const{pocketName:d,value:p}of g)d.match(s)&&x.push({pocketName:d,value:p});x.length&&c.push({seriesName:n,pockets:x})}c.length&&r.push({distributionName:o,series:c})}return r},J="_label_ogejm_1",S={label:J},W=({distributions:t,formik:s})=>{const[l,r]=h.useState(""),o=U(t,l);return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:"Search for pockets",onSearchChange:i=>r(i)}),e.jsxs("fieldset",{className:y("checkbox-group",{"is-error":s.touched.pockets&&s.errors.pockets}),children:[e.jsxs(a.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(a.Col,{small:1,medium:2,size:3,children:e.jsx("p",{className:"p-heading--5 p-text--small p-text--small-caps",children:"Distribution"})}),e.jsx(a.Col,{small:1,medium:2,size:4,children:e.jsx("p",{className:"p-heading--5 p-text--small p-text--small-caps",children:"Series"})}),e.jsx(a.Col,{small:2,medium:2,size:5,children:e.jsx("p",{className:"p-heading--5 p-text--small p-text--small-caps",children:"Pocket"})})]}),o.length===0&&e.jsx("p",{children:`No pockets found with the search: "${l}".`}),o.length>0&&e.jsx("ul",{className:"p-list--divided u-no-margin--bottom",children:o.map(({distributionName:i,series:c})=>e.jsx("li",{className:"p-list__item",children:e.jsxs(a.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(a.Col,{small:1,medium:2,size:3,children:e.jsx("p",{className:y("u-no-margin--bottom",S.label),children:i})}),e.jsx(a.Col,{small:3,medium:4,size:9,children:e.jsx("ul",{className:"p-list--divided u-no-padding--top u-no-margin--left",children:c.map(({seriesName:n,pockets:g})=>e.jsx("li",{className:"p-list__item",children:e.jsxs(a.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(a.Col,{small:1,medium:2,size:4,children:e.jsx("p",{className:"u-no-margin--bottom",children:n})}),e.jsx(a.Col,{small:2,medium:2,size:5,children:e.jsx("ul",{className:"p-list--divided u-no-padding--top u-no-margin--left",children:g.map(({pocketName:x,value:d})=>e.jsx("li",{className:"p-list__item",children:e.jsx(a.CheckboxInput,{label:x,labelClassName:S.label,...s.getFieldProps("pockets"),checked:s.values.pockets.includes(d),onChange:()=>s.setFieldValue("pockets",s.values.pockets.includes(d)?s.values.pockets.filter(p=>p!==d):[...s.values.pockets,d])})},d))})})]})},n))})})]})},i))})]}),e.jsx("p",{className:"p-form-help-text",children:`${s.values.pockets.length} selected`})]})},X=({currentTab:t,onCurrentTabChange:s})=>e.jsx(a.Tabs,{links:[{label:"Details",role:"tab",active:t===0,onClick:()=>s(0)},{label:"Pockets",role:"tab",active:t===1,onClick:()=>s(1)},{label:"APT Sources",role:"tab",active:t===2,onClick:()=>s(2)}]}),Y={access_group:"",all_computers:!1,apt_sources:[],description:"",pockets:[],tags:[],title:""},P={add:{ariaLabel:"Add a new repository profile",label:"Add repository profile"},edit:{ariaLabel:"Edit repository profile",label:"Save changes"}},Z=t=>v().shape({access_group:f(),all_computers:w(),apt_sources:_().of(f()),description:f(),pockets:_().of(f()),tags:_().of(f()),title:f().test({test:s=>!s||N.test(s),message:N.message}).test({message:"This field is required.",params:{action:t},test:s=>t!=="add"||!!s})}),A=t=>{const[s,l]=h.useState(0),r=D(),{closeSidePanel:o}=T(),{getDistributionsQuery:i}=q(),{getAccessGroupQuery:c}=Q(),{getAPTSourcesQuery:n}=V(),{createRepositoryProfileQuery:g,editRepositoryProfileQuery:x}=C(),{data:d}=i(),{data:p}=n(),{data:b}=c(),{mutateAsync:R}=g,{mutateAsync:k}=x,m=z({initialValues:Y,onSubmit:async u=>{const j={access_group:u.access_group,all_computers:u.all_computers,apt_sources:u.apt_sources,description:u.description,pockets:u.pockets,title:u.title};u.all_computers||(j.tags=u.tags);try{t.action==="add"?await R(j):await k({name:t.profile.name,...j}),o()}catch(I){r(I)}},validationSchema:Z(t.action)});return h.useEffect(()=>{t.action!=="add"||!m.errors||!m.submitCount||l(0)},[m.submitCount,m.errors,t.action]),h.useEffect(()=>{t.action==="edit"&&m.setValues({access_group:t.profile.access_group,all_computers:t.profile.all_computers,apt_sources:t.profile.apt_sources,description:t.profile.description,pockets:t.profile.pockets.map(({id:u})=>u),tags:t.profile.tags,title:t.profile.title})},[t]),e.jsxs(a.Form,{onSubmit:m.handleSubmit,noValidate:!0,children:[e.jsx(X,{currentTab:s,onCurrentTabChange:u=>l(u)}),e.jsxs(O,{children:[s===0&&e.jsx(H,{accessGroups:(b==null?void 0:b.data)??[],isTitleRequired:t.action==="add",formik:m}),s===1&&e.jsxs(e.Fragment,{children:[!(d!=null&&d.data.length)&&e.jsx("p",{children:"No distributions found."}),d&&d.data.length>0&&e.jsx(W,{distributions:d.data,formik:m})]}),s===2&&e.jsxs(e.Fragment,{children:[!(p!=null&&p.data.length)&&e.jsx("p",{children:"No APT sources found."}),p&&p.data.length>0&&e.jsx(G,{aptSources:p.data,formik:m})]})]}),e.jsx(E,{submitButtonDisabled:m.isSubmitting,submitButtonText:P[t.action].label,submitButtonAriaLabel:P[t.action].ariaLabel})]})},de=Object.freeze(Object.defineProperty({__proto__:null,default:A},Symbol.toStringTag,{value:"Module"})),ue=Object.freeze(Object.defineProperty({__proto__:null,RepositoryProfileForm:A,RepositoryProfileHeader:$,RepositoryProfileList:B,useRepositoryProfiles:C},Symbol.toStringTag,{value:"Module"}));export{ue as a,de as i};
