import{B as $,C as k,m as O,a2 as V,j as t,q as G,d as i,I as a,a3 as L,x as v,D as h}from"./index-DskkQfCs.js";import{u as H}from"./useInstances-Dl0gAjTU.js";const J="_statusIcon_1efxa_1",K="_output_1efxa_5",I={statusIcon:J,output:K},Z=({activityId:w})=>{var A,x,g,_,j,C,B;const o=$(),{notify:c}=k(),{closeSidePanel:r}=O(),{approveActivitiesQuery:D,cancelActivitiesQuery:P,getSingleActivityQuery:N,redoActivitiesQuery:S,undoActivitiesQuery:T}=V(),{getInstancesQuery:z}=H(),{mutateAsync:Q,isPending:l}=D,{mutateAsync:R,isPending:d}=P,{mutateAsync:q,isPending:u}=S,{mutateAsync:M,isPending:m}=T,{data:p,isLoading:f}=N({activityId:w}),e=p==null?void 0:p.data,{data:y}=z({query:`id:${e==null?void 0:e.computer_id}`,root_only:!1},{enabled:!!(e!=null&&e.computer_id)}),b=y&&y.data.results.length>0?y.data.results[0].title:"",Y=async n=>{try{await Q({query:`id:${n.id}`}),r(),c.success({title:"You have successfully approved an activity.",message:"This activity will be delivered the next time the Landscape server connects with the client."})}catch(s){o(s)}},E=async n=>{try{await R({query:`id:${n.id}`}),r(),c.success({title:"You have successfully canceled an activity.",message:"This activity won't be delivered to the client and will not run."})}catch(s){o(s)}},U=async n=>{try{await q({activity_ids:[n.id]}),r(),c.success({title:"You have successfully redone an activity.",message:"An activity has been queued to re-run this activity."})}catch(s){o(s)}},F=async n=>{try{await M({activity_ids:[n.id]}),r(),c.success({title:"You have successfully undone an activity.",message:"An activity has been queued to revert the changes delivered by this activity."})}catch(s){o(s)}};return t.jsxs(t.Fragment,{children:[f&&t.jsx(G,{}),!f&&e&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[((A=e.actions)==null?void 0:A.approvable)&&t.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:l,confirmationModalProps:{title:"Approve activity",children:t.jsxs("p",{children:["Are you sure you want to approve ",e.summary," ","activity?"]}),confirmButtonLabel:"Approve",confirmButtonAppearance:"positive",confirmButtonDisabled:l,confirmButtonLoading:l,onConfirm:async()=>Y(e)},children:"Approve"}),((x=e.actions)==null?void 0:x.cancelable)&&t.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:d,confirmationModalProps:{title:"Cancel activity",children:t.jsxs("p",{children:["Are you sure you want to cancel ",e.summary," ","activity?"]}),confirmButtonLabel:"Apply",confirmButtonAppearance:"positive",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:async()=>E(e)},children:!((g=e.actions)!=null&&g.approvable)&&!((_=e.actions)!=null&&_.reappliable)&&!((j=e.actions)!=null&&j.revertable)?"Cancel activity":"Cancel"}),((C=e.actions)==null?void 0:C.revertable)&&t.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:m,confirmationModalProps:{title:"Undo activity",children:t.jsxs("p",{children:["Are you sure you want to undo ",e.summary," ","activity?"]}),confirmButtonLabel:"Undo",confirmButtonAppearance:"positive",confirmButtonDisabled:m,confirmButtonLoading:m,onConfirm:async()=>F(e)},children:"Undo"}),((B=e.actions)==null?void 0:B.reappliable)&&t.jsx(i.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:u,confirmationModalProps:{title:"Redo activity",children:t.jsxs("p",{children:["Are you sure you want to redo ",e.summary," ","activity?"]}),confirmButtonLabel:"Redo",confirmButtonAppearance:"positive",confirmButtonDisabled:u,confirmButtonLoading:u,onConfirm:async()=>U(e)},children:"Redo"})]})},"buttons"),t.jsxs(i.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(i.Col,{size:12,children:t.jsx(a,{label:"Description",value:e.summary})}),b&&t.jsx(i.Col,{size:12,children:t.jsx(a,{label:"Instance",value:b})}),t.jsx(i.Col,{size:6,children:t.jsx(a,{label:"Status",value:t.jsxs(t.Fragment,{children:[t.jsx(i.Icon,{name:L[e.activity_status].icon,className:I.statusIcon}),t.jsx("span",{children:L[e.activity_status].label})]})})}),t.jsx(i.Col,{size:6,children:t.jsx(a,{label:"Created at",value:v(e.creation_time).format(h)})}),typeof e.delivery_time=="string"&&t.jsx(i.Col,{size:6,children:t.jsx(a,{label:"Delivered at",value:v(e.delivery_time).format(h)})}),e.completion_time&&t.jsx(i.Col,{size:6,children:t.jsx(a,{label:"Completed at",value:v(e.completion_time).format(h)})}),e.result_text&&t.jsx(i.Col,{size:12,children:t.jsx(i.CodeSnippet,{className:I.output,blocks:[{title:"Output",code:e.result_text}]})})]})]})]})};export{Z as default};
