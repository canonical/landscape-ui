import{r as d,j as s,B as x,g as p,d as h,m as f,o as v}from"./index-DXs1haZl.js";import{P as b,a as C,b as E}from"./PageMain-DhSBVwHg.js";import{h as y}from"./moment-Cl4UOzQZ.js";import{T as j}from"./TruncatedCell-Dx_NjREl.js";import"./moment-BF0UQeMK.js";import"./ExpandableTableFooter.module-C3W6TVe_.js";import{a as w}from"./helpers-BfuBH7Ij.js";import{u as P}from"./useOnClickOutside-C-WOPQdE.js";import{u as _}from"./usePageParams-BJqFm8Ol.js";import{H as R}from"./HeaderWithSearch-OzYSSkOw.js";import{u as L}from"./useQuery-DPA9mHwu.js";import"./TablePagination.module-DLVph1Z1.js";import{T as H}from"./TablePagination-DZ07rvb4.js";import"./HeaderWithSearch.module-ByXjIdeN.js";const T="_message_1po57_1",S="_expandedCell_1po57_5",F="_expandedRow_1po57_10",u={message:T,expandedCell:S,expandedRow:F},M=o=>({index:t})=>{const n={};return o===t&&(n.className=u.expandedRow),n},I=o=>({column:t,row:{index:n}})=>{const e={};return t.id==="creation_time"?e.role="rowheader":t.id==="person_name"?e["aria-label"]="username":t.id==="entity_type"?e["aria-label"]="entity type":t.id==="entity_name"?e["aria-label"]="entity name":t.id==="message"&&(e["aria-label"]="message",o===n&&(e.className=u.expandedCell)),e},N=({eventsLog:o})=>{const[t,n]=d.useState(""),[e,l]=d.useState(-1),c=d.useRef([]);P({current:e!==-1?c.current[e]:null},()=>l(-1));const r=d.useMemo(()=>[{accessor:"creation_time",Header:"creation time",Cell:({row:a})=>s.jsx(s.Fragment,{children:y(a.original.creation_time).format(x)})},{accessor:"person_name",Header:"username",Cell:({row:a})=>s.jsx(s.Fragment,{children:a.original.person_name})},{accessor:"entity_type",Header:"entity type",Cell:({row:a})=>s.jsx(s.Fragment,{children:a.original.entity_type})},{accessor:"entity_name",Header:"entity name",Cell:({row:a})=>s.jsx(s.Fragment,{children:a.original.entity_name})},{accessor:"message",className:u.message,Header:"event log message",Cell:({row:{original:a,index:i}})=>s.jsx(j,{content:a.message,isExpanded:i===e,onExpand:()=>{n(""),l(t?i-1:i)}})}],[o,e]);return s.jsx("div",{ref:w(c),children:s.jsx(p.ModularTable,{getCellProps:I(e),getRowProps:M(e),columns:r,data:o,sortable:!0,emptyMsg:"No events found"})})},k="_container_r415z_1",D="_searchContainer_r415z_8",Y="_select_r415z_12",z={container:k,searchContainer:D,select:Y},g={days:{slug:"days",label:"Days",type:"select",options:[{label:"1 day",value:"1"},{label:"7 days",value:"7"},{label:"30 days",value:"30"},{label:"90 days",value:"90"},{label:"180 days",value:"180"},{label:"365 days",value:"365"}]}},A=()=>{const{days:o,setPageParams:t}=_(),n=l=>{t({search:l})},e=l=>{t({days:l.target.value})};return s.jsx(R,{onSearch:n,actions:s.jsx(p.Select,{wrapperClassName:z.select,label:g.days.label,labelClassName:"u-no-margin--bottom",options:g.days.options,value:o,onChange:e})})};function O(){const o=h();return{getEventsLog:(n,e={})=>L({queryKey:["events",n],queryFn:()=>o.get("events",{params:n}),...e})}}const $=(o,t)=>{const n=["creation_time","person_id","person_name","entity_type","entity_id","entity_name","message"],l=[["Creation Time","Person ID","Person Name","Entity Type","Entity ID","Entity Name","Message"].join(","),...o.map(i=>n.map(m=>i[m]).join(","))].join(`\r
`),c=new Blob([l],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(c),a=document.createElement("a");a.href=r,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)},B=()=>{const{days:o,search:t,currentPage:n,pageSize:e}=_(),{user:l}=f(),{getEventsLog:c}=O(),{data:r,isLoading:a}=c({days:Number(o),limit:e,offset:(n-1)*e,search:t}),i=d.useMemo(()=>(r==null?void 0:r.data.results.filter(m=>m.message.includes(t)))??[],[r,t]);return s.jsxs(b,{children:[s.jsx(C,{title:"Events log",actions:[s.jsx(p.Button,{onClick:()=>$(i,`Event Log - ${l.current_account}-${y().format("YYYY-MM-DDTHH mm ss[Z]")}.csv`),children:"Download as CSV"},"download-as-cv")]}),s.jsxs(E,{children:[s.jsx(A,{}),a&&s.jsx(v,{}),!a&&i&&s.jsx(N,{eventsLog:i}),s.jsx(H,{totalItems:r==null?void 0:r.data.count,currentItemCount:i.length})]})]})},ne=B;export{ne as default};
