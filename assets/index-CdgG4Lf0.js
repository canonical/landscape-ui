import{u as q,e as O,r as m,i as N,b as R,j as e,d as i,c as $,_ as w,t as P,y as T}from"./index-CQs3wXys.js";import{P as Y,a as U,b as K}from"./PageMain-BTzMuvvj.js";import{E as G}from"./EmptyState-DNkTeHW1.js";import{u as W}from"./useFetchOld-D-5JyUuM.js";import{u as C}from"./useMutation-D9dT1mhA.js";import{u as L}from"./useQuery-DrwXjJzc.js";import{T as J}from"./TablePagination-DIiSuGph.js";import{u as E}from"./useRoles-DHn7bJnc.js";import{u as Q}from"./useConfirm-9PPCxKmU.js";import{u as D}from"./formik.esm-C_3GEhhV.js";import{c as B,b as z,a as V}from"./index.esm-85kEx3I1.js";import{S as X}from"./SidePanelFormButtons-CTKwSU1t.js";import{I}from"./InfoItem-BtzYmEJw.js";import{M as H}from"./MultiSelectField-_3K3CoZM.js";import{h as k}from"./moment-Cl4UOzQZ.js";function _(){const s=q(),a=W(),o=O(),r=(c,h={})=>L({queryKey:["administrators"],queryFn:()=>a.get("GetAdministrators"),...h}),u=C({mutationFn:c=>a.get("InviteAdministrator",{params:c}),onSuccess:()=>s.invalidateQueries(["invitations"])}),g=C({mutationFn:c=>a.get("DisableAdministrator",{params:c}),onSuccess:()=>s.invalidateQueries(["administrators"])}),x=C({mutationFn:({id:c,...h})=>o.put(`administrators/${c}`,h),onSuccess:()=>Promise.all([s.invalidateQueries(["administrators"]),s.invalidateQueries(["roles"])])}),l=(c,h={})=>L({queryKey:["invitations",c],queryFn:()=>o.get("/invitations",{params:c}),...h}),d=C({mutationFn:c=>o.delete(`/invitations/${c.id}`),onSuccess:()=>s.invalidateQueries(["invitations"])}),b=C({mutationFn:c=>o.post(`/invitations/${c.id}`),onSuccess:()=>s.invalidateQueries(["invitations"])});return{getAdministratorsQuery:r,inviteAdministratorQuery:u,disableAdministratorQuery:g,editAdministratorQuery:x,getInvitationsQuery:l,revokeInvitationQuery:d,resendInvitationQuery:b}}const Z=({administrator:s})=>{const[a,o]=m.useState(s);m.useEffect(()=>{o(s)},[s]);const{notify:r}=N(),u=R(),{confirmModal:g,closeConfirmModal:x}=Q(),{disableAdministratorQuery:l,editAdministratorQuery:d}=_(),{getRolesQuery:b}=E(),{data:c}=b(),h=(c==null?void 0:c.data.map(({name:v})=>({label:v,value:v})))??[],{mutateAsync:p}=d,{mutateAsync:f,isLoading:y}=l,j=async()=>{try{await f({email:a.email})}catch(v){u(v)}finally{x()}},A=()=>{g({title:"Disable Administrator",body:"This will remove the administrator from your Landscape organization.",buttons:[e.jsxs(i.Button,{onClick:j,appearance:"negative",hasIcon:!0,"aria-label":`Remove ${a.name}`,children:[y&&e.jsx(i.Spinner,{}),"Remove"]},"remove-administrator")]})},t=async v=>{try{await p({id:s.id,roles:v.roles}),o(S=>({...S,roles:v.roles})),r.success({title:"Permission changes have been queued",message:`You changed ${a.name}'s roles`})}catch(S){u(S)}},n=D({initialValues:{roles:[]},validationSchema:B().shape({roles:z().of(V()).min(1,"At least one role is required")}),onSubmit:t});return m.useEffect(()=>{n.setValues({roles:a.roles})},[a]),e.jsxs(i.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:[e.jsxs(i.Button,{type:"button",hasIcon:!0,onClick:A,children:[e.jsx("i",{className:"p-icon--delete","aria-hidden":"true"}),e.jsx("span",{children:"Remove"})]}),e.jsxs(i.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(i.Col,{size:6,children:e.jsx(I,{label:"Name",value:a.name})}),e.jsx(i.Col,{size:6,children:e.jsx(I,{label:"Email",value:a.email})}),e.jsx(i.Col,{size:12,children:e.jsx(I,{label:"Timezone",value:"---"})}),e.jsx(i.Col,{size:12,children:e.jsx(I,{label:"Identity URL",value:"---"})})]}),e.jsx(H,{variant:"condensed",label:"Roles",items:h,selectedItems:h.filter(({value:v})=>n.values.roles.includes(v)),placeholder:"Select roles",onItemsUpdate:v=>n.setFieldValue("roles",v.map(({value:S})=>S)),error:n.touched.roles&&typeof n.errors.roles=="string"?n.errors.roles:void 0}),e.jsx(X,{submitButtonDisabled:n.isSubmitting||n.values.roles.length===a.roles.length&&n.values.roles.every(v=>a.roles.includes(v)),submitButtonText:"Save changes"})]})},ee="_footer_i9cyy_1",te="_multiSelect_i9cyy_7",M={footer:ee,multiSelect:te},se=({administrator:s,roleOptions:a})=>{const o=R(),{notify:r}=N(),{editAdministratorQuery:u}=_(),{mutateAsync:g}=u,x=async({roles:d})=>{try{await g({id:s.id,roles:d}),r.success({title:"Permission changes have been queued",message:`You changed ${s.name}'s roles`})}catch(b){o(b)}},l=D({initialValues:{roles:[]},validationSchema:B().shape({roles:z().of(V()).min(1,"At least one role is required")}),onSubmit:x});return m.useEffect(()=>{l.setValues({roles:s.roles})},[s.roles]),e.jsx(i.Form,{onSubmit:l.handleSubmit,noValidate:!0,children:e.jsx(H,{required:!0,variant:"condensed",className:M.multiSelect,items:a,selectedItems:a.filter(({value:d})=>l.values.roles.includes(d)),onItemsUpdate:d=>l.setValues({roles:d.map(({value:b})=>b)}),placeholder:"Select roles",error:l.touched.roles&&typeof l.errors.roles=="string"?l.errors.roles:void 0,dropdownFooter:e.jsxs("div",{className:M.footer,children:[e.jsx(i.Button,{type:"button",dense:!0,small:!0,className:"u-no-margin--bottom",disabled:l.values.roles.length===s.roles.length&&s.roles.every(d=>l.values.roles.includes(d)),onClick:()=>l.setFieldValue("roles",s.roles),children:"Revert"}),e.jsx(i.Button,{type:"submit",dense:!0,small:!0,appearance:"positive",className:"u-no-margin--bottom",disabled:l.values.roles.length===s.roles.length&&s.roles.every(d=>l.values.roles.includes(d)),children:"Save changes"})]})})})},ae="_roles_1fjlo_1",ne="_actions_1fjlo_2",ie="_table_1fjlo_6",F={roles:ae,actions:ne,table:ie},oe=({administrators:s,emptyMessage:a,roles:o})=>{const r=R(),{setSidePanelContent:u}=$(),{confirmModal:g,closeConfirmModal:x}=Q(),{disableAdministratorQuery:l}=_(),{mutateAsync:d,isLoading:b}=l,c=m.useMemo(()=>s,[s]),h=m.useMemo(()=>o.map(({name:t})=>({label:t,value:t})),[o]),p=async t=>{try{await d({email:t})}catch(n){r(n)}finally{x()}},f=t=>{g({body:"This will remove the administrator from your Landscape organisation.",title:`Remove ${t.name}`,buttons:[e.jsxs(i.Button,{appearance:"negative",hasIcon:!0,onClick:()=>p(t.email),"aria-label":`Remove ${t.name}`,children:[b&&e.jsx(i.Spinner,{}),e.jsx("span",{children:"Remove"})]},`remove-administrator-${t.id}`)]})},y=t=>{u(t.name,e.jsx(Z,{administrator:t}))},j=m.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:t})=>e.jsx(i.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{y(t.original)},children:t.original.name})},{accessor:"email",Header:"Email"},{accessor:"roles",className:F.roles,Header:"Roles",Cell:({row:t})=>e.jsx(se,{administrator:t.original,roleOptions:h})},{accessor:"actions",className:F.actions,Cell:({row:t})=>e.jsxs(i.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left p-tooltip--top-center","aria-label":`Remove ${t.original.name}`,onClick:()=>f(t.original),children:[e.jsx("span",{className:"p-tooltip__message",children:"Remove"}),e.jsx(i.Icon,{name:i.ICONS.delete,className:"u-no-margin--left"})]})}],[c,h]),A=t=>{const n={};return t.column.id==="name"?n.role="rowheader":t.column.id==="email"?n["aria-label"]="Email":t.column.id==="roles"?n["aria-label"]="Roles":t.column.id==="actions"&&(n["aria-label"]="Actions"),n};return e.jsx(i.ModularTable,{columns:j,data:c,getCellProps:A,emptyMsg:a,className:F.table})},re=({onClear:s,onSearch:a})=>{const[o,r]=m.useState("");return e.jsx(i.Row,{className:"u-no-padding--left u-no-padding--right u-no-margin--left u-no-margin--right",children:e.jsx(i.Col,{size:6,children:e.jsx(i.Form,{onSubmit:u=>{u.preventDefault(),a(o)},noValidate:!0,children:e.jsx(i.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,value:o,onChange:u=>r(u),onSearch:()=>a(o),onClear:()=>{r(""),s()},autocomplete:"off"})})})})},le=({administrators:s})=>{const[a,o]=m.useState(""),[r,u]=m.useState(20),[g,x]=m.useState(1),{getRolesQuery:l}=E(),{data:d}=l(),c=(()=>{const p=a.trim().toLowerCase();return p?s.filter(f=>f.email.toLowerCase().includes(p)||f.name.toLowerCase().includes(p)||f.roles.some(y=>y.toLowerCase().includes(p))):s})(),h=c.filter((p,f)=>f>=(g-1)*r&&f<g*r)??[];return e.jsxs(e.Fragment,{children:[e.jsx(re,{onClear:()=>{o("")},onSearch:p=>{o(p)}}),e.jsx(oe,{administrators:h,emptyMessage:a.trim()?`No administrators found with the search: "${a.trim()}"`:"You have no administrators on your Landscape organisation",roles:(d==null?void 0:d.data)??[]}),h.length>0&&e.jsx(J,{currentPage:g,pageSize:r,paginate:p=>x(p),setPageSize:p=>u(p),totalItems:c.length,currentItemCount:h.length})]})},ce=m.lazy(()=>w(()=>import("./index-Dn9c4bnm.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]))),de=()=>{const{setSidePanelContent:s}=$(),{getAdministratorsQuery:a}=_(),{data:o,isLoading:r}=a(),u=()=>{s("Invite administrator",e.jsx(m.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ce,{})}))};return e.jsxs(e.Fragment,{children:[r&&e.jsx(P,{}),!r&&(!o||!o.data.length)&&e.jsx(G,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no administrators in your Landscape organization."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[e.jsx(i.Button,{type:"button",appearance:"positive",onClick:u,children:"Invite Administrator"},"invite-administrator")],icon:"user",title:"No administrators found"}),!r&&o&&o.data.length>0&&e.jsx(le,{administrators:o.data})]})},me=()=>{const s=R(),{notify:a}=N(),{confirmModal:o,closeConfirmModal:r}=Q(),{getInvitationsQuery:u,revokeInvitationQuery:g,resendInvitationQuery:x}=_(),{data:l}=u(),d=m.useMemo(()=>(l==null?void 0:l.data.results.sort((t,n)=>k(n.creation_time).diff(k(t.creation_time))))??[],[l]),{mutateAsync:b}=g,{mutateAsync:c}=x,h=async t=>{try{await b({id:t.id}),a.success({message:`${t.name}â€™${t.name.endsWith("s")?"":"s"} invitation has been revoked`,title:"You revoked an administrator invite"})}catch(n){s(n)}finally{r()}},p=t=>{o({title:`Revoke invitation for ${t.name}`,body:`This action will prevent ${t.name} from joining your Landscape organisation.`,buttons:[e.jsx(i.Button,{appearance:"negative",onClick:()=>h(t),children:"Revoke invitation"},"revoke")]})},f=async t=>{try{await c({id:t.id}),a.success({message:`${t.name} will receive a new invitation email`,title:"You resent an administrator invite"})}catch(n){s(n)}finally{r()}},y=t=>{o({title:`Resend invitation for ${t.name}`,body:`${t.name} will receive a new invitation email`,buttons:[e.jsx(i.Button,{appearance:"positive",onClick:()=>f(t),children:"Resend invitation"},"resend")]})},j=m.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"email",Header:"Email"},{accessor:"creation_time",Header:"Invited",Cell:({row:t})=>k(t.original.creation_time).format(T)},{accessor:"expiration_time",Header:"Expires",Cell:({row:t})=>k(t.original.creation_time).add(14,"days").format(T)},{accessor:"actions",Cell:({row:t})=>e.jsxs("div",{className:"u-align-text--right",children:[e.jsx(i.Button,{dense:!0,small:!0,className:"u-no-margin--bottom",onClick:()=>p(t.original),children:"Revoke"}),e.jsx(i.Button,{dense:!0,small:!0,className:"u-no-margin--bottom",onClick:()=>y(t.original),children:"Resend"})]})}],[d]),A=t=>{const n={};return t.column.id==="name"?n.role="rowheader":t.column.id==="email"?n["aria-label"]="Email":t.column.id==="creation_time"?n["aria-label"]="Invited":t.column.id==="expiration_time"?n["aria-label"]="Expires":t.column.id==="actions"&&(n["aria-label"]="Actions"),n};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-text--muted p-text--small",children:"Unclaimed invitations expire after 14 days."}),e.jsx(i.ModularTable,{columns:j,data:d,getCellProps:A,emptyMsg:"You have no unclaimed invitations."})]})},ue="_tabPanel_ai56l_1",he={tabPanel:ue},pe=[{label:"Administrators",id:"tab-link-administrators"},{label:"Invites",id:"tab-link-invites"}],ge=()=>{const[s,a]=m.useState("tab-link-administrators");return e.jsxs(e.Fragment,{children:[e.jsx(i.Tabs,{listClassName:"u-no-margin--bottom",links:pe.map(({label:o,id:r})=>({label:o,id:r,role:"tab",active:r===s,onClick:()=>a(r)}))}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":s,className:he.tabPanel,children:e.jsxs(m.Suspense,{fallback:e.jsx(P,{}),children:[s==="tab-link-administrators"&&e.jsx(de,{}),s==="tab-link-invites"&&e.jsx(me,{})]})})]})},ve=m.lazy(()=>w(()=>import("./index-Dn9c4bnm.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]))),be=()=>{const{setSidePanelContent:s}=$(),a=()=>{s("Invite administrator",e.jsx(m.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ve,{})}))};return e.jsxs(Y,{children:[e.jsx(U,{title:"Administrators",actions:[e.jsx(i.Button,{type:"button",onClick:a,children:"Invite administrator"},"invite-administrator")]}),e.jsx(K,{children:e.jsx(ge,{})})]})},fe=be,Te=Object.freeze(Object.defineProperty({__proto__:null,default:fe},Symbol.toStringTag,{value:"Module"}));export{Te as i,_ as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-Dn9c4bnm.js","assets/index-CQs3wXys.js","assets/index-C_8s_0a6.css","assets/formik.esm-C_3GEhhV.js","assets/MultiSelectField-_3K3CoZM.js","assets/MultiSelectField.module-D1r8qo_i.js","assets/MultiSelectField-B2rqRhX9.css","assets/SidePanelFormButtons-CTKwSU1t.js","assets/SidePanelFormButtons.module-CoxOjuX8.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/useRoles-DHn7bJnc.js","assets/useFetchOld-D-5JyUuM.js","assets/useMutation-D9dT1mhA.js","assets/useQuery-DrwXjJzc.js","assets/index.esm-85kEx3I1.js","assets/PageMain-BTzMuvvj.js","assets/PageMain-DtiowUD8.css","assets/EmptyState-DNkTeHW1.js","assets/EmptyState-BNXajmMK.css","assets/TablePagination-DIiSuGph.js","assets/TablePagination-JK-zjkSx.css","assets/useConfirm-9PPCxKmU.js","assets/InfoItem-BtzYmEJw.js","assets/InfoItem-BbayMzTk.css","assets/moment-Cl4UOzQZ.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
