import{f as g,g as C,j as e,T as I,d as u,h as H,i as M,k as P,l as Z,B as E,C as A,p as F,F as K,M as V,P as W,r as h,m as L,q as z,ac as U,ah as X,au as Y,ao as J,aY as ee,aw as se,aZ as te}from"./index-gkGXmHMG.js";import{P as ne,a as ae,b as re}from"./PageMain-DCE0dr6h.js";import{F as b,P as oe,I as ce,a as ie}from"./InstancesPageActions-71CO6sjP.js";import{u as D}from"./useInstances-CwQcC3PR.js";import{u as le}from"./useSelection-DxXlMjp1.js";import{G as de}from"./GroupFilter-CQhiK4So.js";import{u as ue}from"./useRoles-CIl8ibB-.js";import"./ResponsiveButtons-C22pypUf.js";const he="_label_1i8qt_1",pe={label:he},me=({options:t,label:n,inline:o=!1})=>{const{disabledColumns:a,setPageParams:c}=g(),r=s=>t.filter(({value:d})=>!s.includes(d)).map(({value:d})=>d);return C("disabledColumns",t.filter(s=>s.canBeHidden).map(s=>s.value)),e.jsx(I,{type:"multiple",showSelectedItemCount:!0,label:e.jsxs(e.Fragment,{children:[e.jsx(u.Icon,{name:"settings"}),e.jsx("span",{className:pe.label,children:n})]}),onItemsSelect:s=>{c({disabledColumns:r(s)})},options:t,disabledOptions:t.filter(({canBeHidden:s})=>!s),selectedItems:r(a),inline:o})},$=()=>{const t=H(),n=M(),o=(s={},d={})=>Z({queryKey:["savedSearches",s],queryFn:async()=>t.get("GetSavedSearches",{params:s}),...d}),a=P({mutationFn:async s=>t.get("CreateSavedSearch",{params:s}),onSuccess:async()=>n.invalidateQueries({queryKey:["savedSearches"]})}),c=P({mutationFn:async s=>t.get("EditSavedSearch",{params:s}),onSuccess:async()=>n.invalidateQueries({queryKey:["savedSearches"]})}),r=P({mutationFn:async s=>t.get("RemoveSavedSearch",{params:s}),onSuccess:async()=>n.invalidateQueries({queryKey:["savedSearches"]})});return{getSavedSearchesQuery:o,createSavedSearchQuery:a,editSavedSearchQuery:c,removeSavedSearchQuery:r}},xe="_container_m2ugq_1",fe="_list_m2ugq_6",je="_listItem_m2ugq_11",ge="_search_m2ugq_17",ye="_row_m2ugq_25",ve="_truncated_m2ugq_33",j={container:xe,list:fe,listItem:je,search:ge,row:ye,truncated:ve},Se=({onSavedSearchClick:t,onSavedSearchRemove:n,savedSearches:o})=>{if(!o.length)return null;const a=E(),{notify:c}=A(),{removeSavedSearchQuery:r}=$(),{mutateAsync:s,isPending:d}=r,l=async i=>{try{await s({name:i}),n(),c.success({message:`Saved search ${i} successfully removed`,title:"Saved search removed"})}catch(f){a(f)}};return e.jsxs("div",{className:j.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Saved searches"}),e.jsx("ul",{className:F("p-list--divided u-no-margin--bottom",j.list),children:o.map(i=>e.jsx("li",{children:e.jsxs("div",{className:j.listItem,children:[e.jsx(u.Button,{type:"button",appearance:"base",className:j.search,onClick:()=>t(i),children:e.jsxs(u.Row,{className:j.row,children:[e.jsx(u.Col,{size:4,children:e.jsx(u.Tooltip,{message:i.name,positionElementClassName:j.truncated,children:e.jsx("span",{children:i.name})})}),e.jsx(u.Col,{size:8,children:e.jsx(u.Tooltip,{message:i.search,positionElementClassName:j.truncated,children:e.jsx("span",{children:i.search})})})]})}),e.jsx(u.ConfirmationButton,{className:"has-icon u-no-margin--bottom u-no-padding--bottom u-no-padding--top",type:"button",appearance:"base",confirmationModalProps:{title:"Remove saved search",children:e.jsxs("p",{children:['This will remove the saved search "',i.name,'".']}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:()=>l(i.name)},children:e.jsx(u.Icon,{name:"delete"})})]})},i.name))})]})},_e="_infoContainer_zti77_1",be="_helpButtonContainer_zti77_9",Ce="_helpButton_zti77_9",R={infoContainer:_e,helpButtonContainer:be,helpButton:Ce},Ie=({onHelpButtonClick:t})=>e.jsx("div",{className:R.infoContainer,children:e.jsx("div",{className:R.helpButtonContainer,children:e.jsx(u.Button,{type:"button",appearance:"base",hasIcon:!0,className:R.helpButton,onClick:n=>{n.stopPropagation(),t()},children:e.jsx(u.Icon,{name:u.ICONS.help})})})}),we=({onClose:t,onSearchSave:n,search:o})=>{const a=E(),{notify:c}=A(),{createSavedSearchQuery:r}=$(),{mutateAsync:s}=r,l=K({initialValues:{name:""},onSubmit:async({name:i})=>{try{await s({search:o,name:i,title:i}),c.success({message:`Saved search ${i} successfully added`,title:"Saved search added"}),n(),t()}catch(f){a(f)}},validationSchema:V({name:W().required("This field is required").test({message:"Name must consist of only lowercase alphanumeric characters and hyphens",test:i=>/^[a-z0-9][-a-z0-9]*$/.test(i)})})});return e.jsxs(u.Form,{onSubmit:l.handleSubmit,noValidate:!0,children:[e.jsx(u.Input,{type:"text",autoComplete:"off",autoFocus:!0,label:"Search name",...l.getFieldProps("name"),error:l.touched.name&&l.errors.name?l.errors.name:void 0}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(u.Button,{type:"button",disabled:l.isSubmitting,onClick:t,children:"Cancel"}),e.jsx(u.Button,{type:"submit",disabled:l.isSubmitting,appearance:"positive","aria-label":`Saved search as ${l.values.name}`,children:"Save search"})]})]})},Ne="_container_fqj7b_1",Be="_prompt_fqj7b_10",ke="_saveButton_fqj7b_17",T={container:Ne,prompt:Be,saveButton:ke},Fe=({onSearchSave:t,search:n})=>{const[o,a]=h.useState(!1);return e.jsxs(e.Fragment,{children:[n&&o&&e.jsx(we,{onClose:()=>a(!1),onSearchSave:t,search:n}),n&&!o&&e.jsxs("div",{className:T.container,children:[e.jsxs("span",{className:T.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:n}),e.jsx("span",{children:"..."})]}),e.jsx(u.Button,{type:"button",appearance:"link",onClick:()=>a(!0),className:T.saveButton,children:"Save search"})]})]})},Pe="_searchContainer_pk8ic_1",Re="_form_pk8ic_8",Te="_searchBoxContainer_pk8ic_13",$e="_input_pk8ic_17",B={searchContainer:Pe,form:Re,searchBoxContainer:Te,input:$e},O=({inputText:t,savedSearches:n,search:o})=>{if(!n)return[];let a=n;if(o){const c=o.split(",").filter(Boolean);a=a.filter(({name:r})=>c.every(s=>s!==`search:${r}`))}return t&&(a=a.filter(({name:c,search:r})=>c.toLowerCase()!==t.trim().toLowerCase()&&r.toLowerCase()!==t.trim().toLowerCase())),a},Oe=({onHelpButtonClick:t})=>{const{query:n,setPageParams:o}=g(),[a,c]=h.useState(""),[r,s]=h.useState(!1),{getSavedSearchesQuery:d}=$(),l=h.useRef(null),i=h.useRef(null);L(l,p=>{const x=document.querySelector(".p-modal");x&&x.contains(p.target)||s(!1)});const{data:y,isLoading:w}=d(),N=h.useMemo(()=>O({inputText:a,savedSearches:y?.data,search:n}),[y,a,n]),v=()=>{if(!a)return;const x=O({inputText:"",savedSearches:y?.data,search:n}).some(({name:G})=>G.toLowerCase()===a.trim().toLowerCase())?"search:":"";o({query:n?`${n},${x}${a}`:`${x}${a}`}),c("")},m=p=>{o({query:n?`${n},search:${p.name}`:`search:${p.name}`})},S=p=>{const{key:x}=p;r?(x==="Escape"&&s(!1),x==="Enter"&&v()):x==="Enter"&&s(!0)};return e.jsxs("div",{className:"p-search-and-filter",ref:l,children:[e.jsxs("div",{className:F("p-search-and-filter__search-container",B.searchContainer),"aria-expanded":r,ref:i,onClick:()=>{s(!0)},children:[e.jsx(u.Form,{onSubmit:p=>{p.preventDefault(),v()},className:F("p-search-and-filter__box",B.form),children:e.jsx("div",{className:B.searchBoxContainer,children:e.jsx(u.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autocomplete:"off",className:B.input,value:a,onChange:p=>{c(p)},onClear:()=>{c("")},onSearch:v,onClick:()=>{s(!0)},onKeyUp:S})})}),e.jsx(Ie,{onHelpButtonClick:t})]}),r&&w&&e.jsx(z,{}),r&&!w&&e.jsxs("div",{className:"p-search-and-filter__panel",children:[e.jsx(Fe,{onSearchSave:()=>{c("")},search:a.trim()}),e.jsx(Se,{onSavedSearchClick:m,onSavedSearchRemove:()=>{s(!0)},savedSearches:N})]})]})},qe=({options:t,label:n,inline:o=!1})=>{const{accessGroups:a,setPageParams:c}=g();return C("accessGroups",t.map(r=>r.value)),e.jsx(I,{type:"multiple",label:n,hasToggleIcon:!0,hasBadge:!0,options:t,onItemsSelect:r=>{c({accessGroups:r})},selectedItems:a,inline:o})},Qe=({options:t,label:n,inline:o=!1})=>{const[a,c]=h.useState(""),{availabilityZones:r,setPageParams:s}=g(),d=t.length>9&&a?t.filter(({value:i})=>i!=="none"&&i.includes(a)):t;C("availabilityZones",d.map(i=>i.value));const l=i=>{i[i.length-1]==="none"?s({availabilityZones:["none"]}):s({availabilityZones:i[0]!=="none"?i:i.filter(f=>f!=="none")})};return e.jsx(I,{type:"multiple",label:n,hasToggleIcon:!0,hasBadge:!0,onSearch:t.length>9?i=>{c(i)}:void 0,options:d,onItemsSelect:l,selectedItems:r,inline:o})},Ee=({options:t,label:n,inline:o=!1})=>{const{os:a,setPageParams:c}=g();return C("os",t.map(r=>r.value)),e.jsx(I,{type:"single",hasBadge:!0,label:n,hasToggleIcon:!0,options:t,onItemSelect:r=>{c({os:r})},selectedItem:a,inline:o})},Ae=({options:t,label:n,inline:o=!1})=>{const[a,c]=h.useState(""),{tags:r,setPageParams:s}=g(),d=t.filter(({value:l})=>l.includes(a));return C("tags",d.map(l=>l.value)),e.jsx(I,{type:"multiple",label:n,hasToggleIcon:!0,hasBadge:!0,options:d,onItemsSelect:l=>{s({tags:l})},onSearch:l=>{c(l)},selectedItems:r,inline:o})},Le=[{term:"<keyword>",description:e.jsxs("span",{children:["Instances with the title or hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"distribution:<keyword>",description:e.jsxs("span",{children:["Instances with the installed distribution named"," ",e.jsx("code",{children:"<keyword>"})]})},{term:"needs:reboot",description:"Instances needing a reboot"},{term:"alert:<type>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with outstanding alerts of the specified"," ",e.jsx("code",{children:"<type>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be ",e.jsx("code",{children:"package-upgrades"}),","," ",e.jsx("code",{children:"security-upgrades"}),",",e.jsx("code",{children:"package-profiles"}),","," ",e.jsx("code",{children:"package-reporter"}),", ",e.jsx("code",{children:"esm-disabled"}),","," ",e.jsx("code",{children:"computer-offline"}),",",e.jsx("code",{children:"computer-reboot"}),","," ",e.jsx("code",{children:"computer-duplicates"}),", ",e.jsx("code",{children:"unapproved-activities"}),"."]})]})},{term:"ip:<address>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with IP addresses like ",e.jsx("code",{children:"<address>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<address>"})," can be a fragment or partial IP address representing a subnet such as 91.185.94 to match any instances in the subnet."]})]})},{term:"mac:<address>",description:e.jsxs("span",{children:["Instances with the MAC address ",e.jsx("code",{children:"<address>"})]})},{term:"id:<instance_id>",description:e.jsxs("span",{children:["Instance with the id ",e.jsx("code",{children:"<instance_id>"})]})},{term:"access-group:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," access group"]})},{term:"search:<name>",description:e.jsxs("span",{children:["Instances meeting the terms of the ",e.jsx("code",{children:"<name>"})," saved search"]})},{term:"upgrade-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," upgrade profile"]})},{term:"removal-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," removal profile"]})},{term:"tag:<keyword>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<keyword>"})," tag"]})},{term:"hostname:<keyword>",description:e.jsxs("span",{children:["Instance with the hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"title:<keyword>",description:e.jsxs("span",{children:["Instance with the title ",e.jsx("code",{children:"<keyword>"})]})},{term:"license-id:<license_id>",description:e.jsxs("span",{children:["Search for instances licensed to the specified"," ",e.jsx("code",{children:"<license_id>"})]})},{term:"needs:license OR license-id:none",description:"Search for instances that do not have a Landscape license, and, as a result, are not managed"},{term:"annotation:<key>",description:e.jsxs("span",{children:["Search for instances which define the specified annotation key. Optionally specify ",e.jsx("code",{children:"annotation:<key>:<string>"})," ","which will only return instances whose key matches and value also contains the ",e.jsx("code",{children:"<string>"})," specified"]})},{term:"security-profiles:<security-profile-id>:<pass|fail|in-progress>",description:e.jsxs("span",{children:["Search for the security profiles with a specified id. Optionally specify"," ",e.jsx("code",{children:"security-profiles:<security-profiles-id>:<pass|fail|in-progress>"})," ","which will only return security profiles whose id matches, and value also contains ",e.jsx("code",{children:"pass"}),", ",e.jsx("code",{children:"fail"}),","," ",e.jsx("code",{children:"in-progress"})," as specified"]})}],ze="_top_1d4ve_1",De="_searchContainer_1d4ve_13",Ge="_divider_1d4ve_22",k={top:ze,searchContainer:De,divider:Ge},He="_menuContainer_xrtuf_1",Me="_wrapper_xrtuf_6",q={menuContainer:He,wrapper:Me},Ze="_root_1fm3p_1",Ke="_label_1fm3p_5",Ve="_text_1fm3p_16",We="_icon_1fm3p_20",Ue="_content_1fm3p_24",_={root:Ze,label:Ke,text:Ve,icon:We,content:Ue},Xe=({el:t})=>{const[n,o]=h.useState(!1),a=h.useRef(null);L(a,()=>{n&&o(!1)});const c=h.cloneElement(t,{inline:!0});return e.jsxs("div",{ref:a,className:_.root,children:[e.jsxs(u.Button,{type:"button",appearance:"base",className:_.label,onClick:()=>{o(r=>!r)},children:[e.jsx(u.Icon,{name:"chevron-down",className:_.icon}),e.jsx("span",{className:_.text,children:t.props.label})]}),n&&e.jsx("div",{className:`p-contextual-menu__dropdown ${_.content}`,children:c})]})},Ye=({filters:t,collapseFrom:n="md",menuLabel:o="Filters",className:a,menuPosition:c="right"})=>{const r=U(`(min-width: ${X[n]}px)`);return e.jsx("div",{className:F(q.wrapper,a),children:r?t.map((s,d)=>e.jsx("span",{children:s},d)):e.jsx(u.ContextualMenu,{position:c,hasToggleIcon:!0,toggleLabel:o,toggleClassName:"u-no-margin--bottom",children:e.jsx("div",{className:q.menuContainer,children:t.map((s,d)=>s.type.name?e.jsx(Xe,{el:s},d):s)})})})},Je=({columnFilterOptions:t})=>{const[n,o]=h.useState(!1),{getAccessGroupQuery:a}=ue(),{getAllInstanceTagsQuery:c,getAvailabilityZonesQuery:r}=D(),{data:s}=c(),d=s?.data.results.map(m=>({label:m,value:m}))??[],{data:l}=r(),i=(l?.data.values??[]).reduce((m,S)=>(m.push({label:S,value:S}),m),[{label:"Without zones",value:"none",group:"1"}]),{data:f}=a(),y=f?.data.map(({name:m,title:S})=>({value:m,label:S}))??[],w=b.groupBy.options,N=b.status.options,v=b.os.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:k.top,children:[e.jsx("div",{className:k.searchContainer,children:e.jsx(Oe,{onHelpButtonClick:()=>{o(!0)}})}),e.jsx(Ye,{collapseFrom:"xxl",filters:[e.jsx(de,{label:"Group by",options:w},"group"),e.jsx("span",{className:k.divider},"divider-1"),e.jsx(Y,{label:"Status",options:N},"status"),e.jsx(Ee,{label:"OS",options:v},"os"),e.jsx(Qe,{label:"Availability zones",options:i},"availability-zone"),e.jsx(qe,{label:"Access groups",options:y},"access-group"),e.jsx(Ae,{label:"Tags",options:d},"tag"),e.jsx("span",{className:k.divider},"divider-2"),e.jsx(me,{label:"Columns",options:t},"column")]})]}),e.jsx(J,{filtersToDisplay:["accessGroups","os","availabilityZones","status","tags","query"],accessGroupOptions:y,availabilityZonesOptions:i,osOptions:v,statusOptions:N,tagOptions:d}),e.jsx(ee,{open:n,data:Le,onClose:()=>{o(!1)}}),e.jsx(oe,{})]})},es=h.memo(function({instanceCount:n,instances:o,isGettingInstances:a,selectedInstances:c,setSelectedInstances:r}){const[s,d]=h.useState([]),l=h.useCallback(()=>{r([])},[]);return e.jsxs(e.Fragment,{children:[e.jsx(Je,{columnFilterOptions:s}),a?e.jsx(z,{}):e.jsx(ce,{instances:o,selectedInstances:c,setColumnFilterOptions:d,setSelectedInstances:r}),e.jsx(se,{totalItems:n,handleClearSelection:l,currentItemCount:o.length})]})}),Q=(t,n)=>t.type==="select"?t.options.find(o=>o.value===n)?.query??"":"",ss=({accessGroups:t,availabilityZones:n,os:o,query:a,status:c,tags:r})=>{const s=[];return o&&s.push(Q(b.os,o)),c&&s.push(Q(b.status,c)),a&&s.push(...a.split(",")),r.length&&s.push(`tag:${r.join(" OR tag:")}`),t.length&&s.push(`access-group:${t.join(" OR access-group:")}`),n.length&&s.push(n.includes("none")?"availability-zone:null":`availability-zone:${n.join(" OR availability-zone:")}`),s.join(" ")},ds=()=>{const{currentPage:t,pageSize:n,groupBy:o,...a}=g(),{getInstancesQuery:c}=D(),{data:r,isLoading:s}=c({query:ss(a),root_only:o==="parent",archived_only:a.status==="archived",with_alerts:!0,with_upgrades:te,limit:n,offset:(t-1)*n}),d=r?.data.results??[],{selectedItems:l,setSelectedItems:i}=le(d,s);return e.jsxs(ne,{children:[e.jsx(ae,{title:"Instances",actions:[e.jsx(ie,{isGettingInstances:s,selectedInstances:l},"actions")],sticky:!0}),e.jsx(re,{children:e.jsx(es,{instanceCount:r?.data.count,instances:d,isGettingInstances:s,selectedInstances:l,setSelectedInstances:i})})]})};export{ds as default};
