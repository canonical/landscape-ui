const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-8hYQD8Fu.js","assets/index-Dg2qeAM1.js","assets/index-CQO7y1Gd.css","assets/useInstances-BFfYcqEm.js","assets/ResponsiveButtons-CsvMdCrE.js","assets/ResponsiveButtons-C56n2q_V.css","assets/useRoles-DhxkQ1IG.js","assets/InstancesPageActions-CBukiHQf.js","assets/InstancesPageActions-CswnIe9I.css","assets/useTaggedSecurityProfiles-D9QAWPMC.js","assets/WslInstancesHeader-Bh3BH0VQ.js","assets/HeaderWithSearch-9LSyOtlV.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/WslInstancesHeader-Dj3EjS23.css","assets/index-Cgr0EpBx.css","assets/index-ChD65z0I.js","assets/index-CsHgpdRJ.css","assets/index-TVEC6RzN.js","assets/index-7Fq2XZdx.css","assets/index-BvEONMb3.js","assets/useUsns-zV1ws8p5.js","assets/useUsns-DQKyxlHf.css","assets/index-B0p01W4u.css","assets/index-AvaxESwG.js","assets/index-HriCcMvv.js","assets/PageMain-D82xttqc.js","assets/PageMain-DJy-4N2e.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-MWJPBEiS.css","assets/index-CyESHLFB.js","assets/index-BAsg6f-x.css","assets/index-Blljf7xA.js","assets/SidePanelFormButtons-eNiDcGbx.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/helpers-kptqhis5.js","assets/output-DFRNcfG-.js","assets/index-DYvjq1Mv.css","assets/index-DfahPOgb.js","assets/UsnList-DELuvWsQ.js","assets/SelectAllButton-5EEDCO5s.js","assets/ExpandableTableFooter-AnI6_K1y.js","assets/ExpandableTableFooter-DWm8zyWg.css","assets/TruncatedCell-C6qDfyLZ.js","assets/TruncatedCell-CoXbu3VM.css","assets/UsnList-DXlgO95i.css","assets/index-DhbyciX0.js","assets/index-B1Uu4xTW.css","assets/index-BIaXzdbc.js","assets/downshift.esm-B-K-DSUq.js","assets/index-BU0BGAQg.css","assets/index-DhxOF6ZN.js","assets/constants-DxgG6wXH.js","assets/index-CNIav8so.css","assets/index-PJtImRCj.js","assets/constants-Dwl1JGyb.js","assets/index-DgHoeIwv.css","assets/index-C5P5CpjP.js"])))=>i.map(i=>d[i]);
import{a as w,j as n,E as D,n as b,m as T,c as Q,am as V,r as o,p as y,$ as u,i as C,f as O,g as f,h as E,O as z,b as B}from"./index-Dg2qeAM1.js";import{P as N,a as U,b as S}from"./PageMain-D82xttqc.js";import{u as $,a as q}from"./useUsns-zV1ws8p5.js";import{u as H}from"./useInstances-BFfYcqEm.js";import{c as h,R as M}from"./ResponsiveButtons-CsvMdCrE.js";import{c as G}from"./SingleInstanceTabs.module-Cm1BYFZQ.js";const W=({childInstanceId:e,instanceId:a})=>{const t=w();return n.jsx(D,{title:"Instance not found",icon:"connected",body:n.jsxs("p",{className:"u-no-margin--bottom",children:[n.jsx("span",{children:"Seems like the instance with id = "}),n.jsx("code",{children:a}),n.jsx("span",{children:" doesn't "}),e?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:"have a child instance with id = "}),n.jsx("code",{children:e})]}):n.jsx("span",{children:"exist"}),"."]}),cta:[n.jsx(b.Button,{appearance:"positive",onClick:async()=>t("/instances",{replace:!0}),type:"button","aria-label":"Go back",children:"Back to Instances page"},"go-back-to-instances-page"),n.jsx(b.Button,{onClick:async()=>t("/",{replace:!0}),type:"button","aria-label":"Go back",children:"Home page"},"go-back-to-home-page")]})},J=[{label:"Info",id:"tab-link-info"},{label:"WSL",id:"tab-link-wsl"},{label:"Activities",id:"tab-link-activities"},{label:"Kernel",id:"tab-link-kernel"},{label:"Security issues",id:"tab-link-security-issues"},{label:"Packages",id:"tab-link-packages"},{label:"Snaps",id:"tab-link-snaps"},{label:"Processes",id:"tab-link-processes"},{label:"Ubuntu Pro",id:"tab-link-ubuntu-pro"},{label:"Users",id:"tab-link-users"},{label:"Hardware",id:"tab-link-hardware"}],X=({id:e,label:a,packageCount:t,packagesLoading:r,usnCount:d,usnLoading:g,kernelCount:i,kernelLoading:l})=>e==="tab-link-packages"&&r||e==="tab-link-security-issues"&&g||e==="tab-link-kernel"&&l?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:a}),n.jsx(b.Spinner,{className:"u-no-margin--bottom u-no-padding--top"})]}):e==="tab-link-packages"&&t?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:a}),n.jsx(b.Badge,{value:t})]}):e==="tab-link-security-issues"&&d?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:a}),n.jsx(b.Badge,{value:d,isNegative:!0})]}):e==="tab-link-kernel"&&i?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:a}),n.jsx(b.Badge,{value:i})]}):a,Y=({activeTabId:e,instance:a,onActiveTabChange:t,packageCount:r,packagesLoading:d,usnCount:g,usnLoading:i,kernelCount:l,kernelLoading:p})=>J.filter(({id:_})=>!a.distribution||h("ubuntu",a)?_!=="tab-link-wsl":["tab-link-info","tab-link-wsl","tab-link-activities","tab-link-hardware"].includes(_)).map(({label:_,id:s})=>({label:X({label:_,id:s,packageCount:r,packagesLoading:d,usnCount:g,usnLoading:i,kernelCount:l,kernelLoading:p}),id:s,role:"tab",active:s===e,onClick:()=>t(s)})),Z=o.lazy(async()=>u(()=>import("./index-8hYQD8Fu.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),ee=o.lazy(async()=>u(()=>import("./index-ChD65z0I.js"),__vite__mapDeps([15,1,2,11,12,16]))),ne=o.lazy(async()=>u(()=>import("./index-TVEC6RzN.js"),__vite__mapDeps([17,1,2,18]))),te=o.lazy(async()=>u(()=>import("./index-BvEONMb3.js"),__vite__mapDeps([19,1,2,20,4,5,21,11,12,22]))),ae=o.lazy(async()=>u(()=>import("./index-AvaxESwG.js"),__vite__mapDeps([23,1,2]))),se=o.lazy(async()=>u(()=>import("./index-HriCcMvv.js"),__vite__mapDeps([24,1,2,25,26,20,4,5,21,3,27,28,29]))),re=o.lazy(async()=>u(()=>import("./index-CyESHLFB.js"),__vite__mapDeps([30,1,2,10,11,12,3,13,31]))),ie=o.lazy(async()=>u(()=>import("./index-Blljf7xA.js").then(e=>e.i),__vite__mapDeps([32,1,2,33,34,35,36,4,5,11,12,37,38]))),oe=o.lazy(async()=>u(()=>import("./index-DfahPOgb.js"),__vite__mapDeps([39,1,2,20,4,5,21,11,12,40,41,42,43,44,45,46,16]))),ce=o.lazy(async()=>u(()=>import("./index-DhbyciX0.js"),__vite__mapDeps([47,1,2,48]))),le=o.lazy(async()=>u(()=>import("./index-BIaXzdbc.js"),__vite__mapDeps([49,1,2,33,34,35,50,11,12,36,4,5,51]))),ue=({instance:e,packageCount:a,packagesLoading:t,usnCount:r,usnLoading:d,kernelCount:g,kernelLoading:i})=>{const{closeSidePanel:l}=T(),{tab:p,setPageParams:_}=Q(),s=p?`tab-link-${p}`:"tab-link-info",c=Y({activeTabId:s,instance:e,onActiveTabChange:m=>{_({tab:m.replace("tab-link-","")}),l()},packageCount:a,packagesLoading:t,usnCount:r,usnLoading:d,kernelCount:g,kernelLoading:i});return n.jsxs(n.Fragment,{children:[n.jsx(b.Tabs,{listClassName:"u-no-margin--bottom",links:c}),n.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":s,className:G.tabPanel,children:n.jsx(V,{children:n.jsxs(o.Suspense,{fallback:n.jsx(y,{}),children:[s==="tab-link-info"&&n.jsx(Z,{instance:e}),s==="tab-link-wsl"&&n.jsx(re,{instance:e}),s==="tab-link-activities"&&n.jsx(ae,{instanceId:e.id}),s==="tab-link-kernel"&&n.jsx(se,{instanceTitle:e.title}),s==="tab-link-security-issues"&&n.jsx(oe,{instance:e}),s==="tab-link-packages"&&n.jsx(te,{}),s==="tab-link-snaps"&&n.jsx(le,{}),s==="tab-link-processes"&&n.jsx(ee,{}),s==="tab-link-ubuntu-pro"&&n.jsx(ce,{instance:e}),s==="tab-link-users"&&n.jsx(ie,{}),s==="tab-link-hardware"&&n.jsx(ne,{instance:e})]})})})]})},de=e=>{if(e)return e.parent?[{label:"Instances",path:"/instances"},{label:e.parent.title,path:`/instances/${e.parent.id}`},{label:e.title,current:!0}]:[{label:"Instances",path:"/instances"},{label:e.title,current:!0}]},pe=e=>{if(!(!e||e.length===0||!e[0].Livepatch.Fixes))return e[0].Livepatch.Fixes.length},be=(e,a)=>e.distribution?a:0,ge=(e,a)=>e.distribution?a:0,_e=e=>(e==null?void 0:e.title)??"",me=(e,a)=>parseInt(a||(e??"")),ye=(e,a,t)=>!!e&&(!a||a===t),he=(e,a,t)=>{var r;return!!e&&h("ubuntu",e)&&(!t||((r=e.parent)==null?void 0:r.id)===parseInt(a??""))},xe=(e,a,t)=>{var r;return!!e&&h("ubuntu",e)&&(!t||((r=e.parent)==null?void 0:r.id)===parseInt(a??""))},je=(e,a,t)=>{var r;return!!e&&h("ubuntu",e)&&(!t||((r=e.parent)==null?void 0:r.id)===parseInt(a??""))},ke=e=>e?[e.id]:[],L=e=>e?e.id:0,Ie=(e,a,t)=>e&&(!t||e.parent&&e.parent.id===parseInt(a??"")),ve="_container_pnq0d_1",Pe={container:ve},fe=o.lazy(async()=>u(()=>import("./index-DhxOF6ZN.js"),__vite__mapDeps([52,1,2,53,25,26,20,4,5,21,3,27,28,54]))),Ee=o.lazy(async()=>u(()=>import("./index-PJtImRCj.js"),__vite__mapDeps([55,1,2,56,53,25,26,20,4,5,21,3,27,28,57]))),Le=o.lazy(async()=>u(()=>import("./index-C5P5CpjP.js"),__vite__mapDeps([58,1,2,3,56,25,26,20,4,5,21,27,28,57]))),Ve=({instanceName:e,hasTableData:a,kernelStatuses:t})=>{var s;const{setSidePanelContent:r}=T(),d=((s=t==null?void 0:t.installed)==null?void 0:s.version_rounded)??"",g=(t==null?void 0:t.downgrades)??[],i=(t==null?void 0:t.upgrades)??[],l=()=>{r("Downgrade kernel",n.jsx(o.Suspense,{fallback:n.jsx(y,{}),children:n.jsx(fe,{instanceName:e,currentKernelVersion:d,downgradeKernelVersions:g})}))},p=()=>{r("Upgrade kernel",n.jsx(o.Suspense,{fallback:n.jsx(y,{}),children:n.jsx(Ee,{instanceName:e,currentKernelVersion:d,upgradeKernelVersions:i})}))},_=()=>{var c;r(`Restart ${e}`,n.jsx(o.Suspense,{fallback:n.jsx(y,{}),children:n.jsx(Le,{instanceName:e,showNotification:a,newKernelVersionId:(c=i[0])==null?void 0:c.id})}))};return n.jsxs("div",{className:Pe.container,children:[n.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:"Kernel overview"}),n.jsx(M,{collapseFrom:"lg",buttons:[n.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:_,children:[n.jsx(b.Icon,{name:"restart"}),n.jsx("span",{children:"Restart instance"})]},"restart-instance"),n.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:g.length===0,onClick:l,children:[n.jsx(b.Icon,{name:"begin-downloading"}),n.jsx("span",{children:"Downgrade kernel"})]},"downgrade-kernel"),n.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:i.length===0,onClick:p,children:[n.jsx(b.Icon,{name:"change-version"}),n.jsx("span",{children:"Upgrade kernel"})]},"upgrade-kernel")]})]})};function we(){const e=C(),a=O(),t=({id:i},l={})=>E({queryKey:["kernel",i],queryFn:async()=>e.get(`computers/${i}/livepatch/kernel`),...l}),r=({id:i,...l},p={})=>E({queryKey:["kernel",{id:i,...l}],queryFn:async()=>e.get(`computers/${i}/livepatch/info`,{params:l}),...p}),d=f({mutationKey:["kernel","downgrade"],mutationFn:async({id:i,...l})=>e.post(`computers/${i}/kernel/downgrade`,l),onSuccess:async()=>a.invalidateQueries({queryKey:["kernel"]})}),g=f({mutationKey:["kernel","upgrade"],mutationFn:async({id:i,...l})=>e.post(`computers/${i}/kernel/upgrade`,l),onSuccess:async()=>a.invalidateQueries({queryKey:["kernel"]})});return{getKernelQuery:t,getLivepatchInfoQuery:r,downgradeKernelQuery:d,upgradeKernelQuery:g}}const Te=()=>{var I,v,P;const{instanceId:e,childInstanceId:a}=z(),{user:t}=B(),r=w(),{getSingleInstanceQuery:d}=H(),{getUsnsQuery:g}=$(),{getInstancePackagesQuery:i}=q(),{getLivepatchInfoQuery:l}=we(),p=o.useRef("");o.useEffect(()=>{t!=null&&t.current_account&&(p.current||(p.current=t.current_account),p.current!==t.current_account&&r("/instances",{replace:!0}))},[t==null?void 0:t.current_account]);const{data:_,isLoading:s}=d({instanceId:me(e,a),with_annotations:!0,with_grouped_hardware:!0},{enabled:ye(e,p.current,t==null?void 0:t.current_account)}),c=(_==null?void 0:_.data)??null,{data:m,isLoading:K}=g({computer_ids:ke(c),limit:1},{enabled:je(c,e,a)}),{data:x,isLoading:F}=i({available:!1,upgrade:!0,instance_id:L(c),limit:1},{enabled:he(c,e,a)}),{data:j,isLoading:R}=l({id:L(c)},{enabled:xe(c,e,a)}),A=pe((P=(v=(I=j==null?void 0:j.data.livepatch_info)==null?void 0:I.json)==null?void 0:v.output)==null?void 0:P.Status),k=Ie(c,e,a);return n.jsxs(N,{children:[n.jsx(U,{title:_e(c),hideTitle:!0,breadcrumbs:de(c)}),n.jsx(S,{children:s?n.jsx(y,{}):n.jsxs(n.Fragment,{children:[!k&&n.jsx(W,{childInstanceId:a,instanceId:e}),c&&k&&n.jsx(ue,{instance:c,packageCount:be(c,Number(x==null?void 0:x.data.count)),packagesLoading:F,usnCount:ge(c,Number(m==null?void 0:m.data.count)),usnLoading:K,kernelCount:c.distribution?A:0,kernelLoading:R})]})})]})},Ce=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{Ve as K,Ce as i,we as u};
