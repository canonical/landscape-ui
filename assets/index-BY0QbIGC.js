import{r as f,j as e,d as h,c as N,e as se,f as Q,g as te,q as Y,s as J,U as ne,t as ae,k as re,n as le,M as oe,o as X,L as ie,R as K,D as W}from"./index-CynLVgCY.js";import{P as ce,a as de,b as ue}from"./PageMain-ATmFa-jZ.js";import{T as he}from"./TablePagination-hwgLb0Pq.js";import{u as ee}from"./useInstances-kKMDgL9a.js";import{h as z}from"./moment-C5S46NFB.js";import{N as H}from"./NoData-DUm2CMdq.js";import{u as k}from"./usePageParams-BkosO9nh.js";import{P as me,F,S as y,I as pe}from"./InstancesPageActions-Cw2ClK3z.js";import{S as ge}from"./index-n0wuY1rr.js";import{u as xe}from"./useFetchOld-C8SCAVML.js";import{u as fe}from"./useRoles-b408AcWQ.js";import"./TablePagination.module-CgQ3jx4B.js";import"./moment-C86UhgFe.js";const je="_toggle_kt7f5_1",_e="_badgeContainer_kt7f5_7",be="_multiple_kt7f5_12",Ce="_badge_kt7f5_7",ve="_dropdown_kt7f5_23",Se="_container_kt7f5_27",ye="_list_kt7f5_37",Ie="_listItem_kt7f5_46",ke="_separated_kt7f5_53",we="_button_kt7f5_59",Ne="_selected_kt7f5_66",Be="_footer_kt7f5_72",v={toggle:je,badgeContainer:_e,multiple:be,badge:Ce,dropdown:ve,container:Se,list:ye,listItem:Ie,separated:ke,button:we,selected:Ne,footer:Be},$e=({onSearch:n})=>{const[t,o]=f.useState("");return e.jsx(h.Form,{onSubmit:a=>{a.preventDefault(),n(t)},children:e.jsx(h.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autoComplete:"off",value:t,onChange:a=>o(a),onSearch:()=>n(t),onClear:()=>{o(""),n("")}})})},T=({disabledOptions:n,hasBadge:t,hasToggleIcon:o,label:a,options:i,onSearch:m,position:l="left",...r})=>{const g=c=>{r.multiple&&r.onItemsSelect(r.selectedItems.includes(c.target.value)?r.selectedItems.filter(p=>p!==c.target.value):[...r.selectedItems,c.target.value])};return e.jsxs(h.ContextualMenu,{autoAdjust:!0,toggleAppearance:"base",toggleLabel:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a}),t&&e.jsx("span",{className:N(v.badgeContainer,{[v.multiple]:r.multiple&&i.length>9}),children:(r.multiple&&r.selectedItems.length>0||!r.multiple&&r.selectedItem)&&e.jsx(h.Badge,{value:r.multiple?r.selectedItems.length:1,className:v.badge})})]}),toggleClassName:v.toggle,hasToggleIcon:o,dropdownClassName:v.dropdown,position:l,onToggleMenu:c=>{c&&m&&m("")},children:[e.jsxs("span",{className:N(v.container,{[v.multiple]:r.multiple}),children:[m&&e.jsx($e,{onSearch:m}),e.jsx("ul",{className:v.list,children:i.map(({label:c,value:p,group:_},s)=>e.jsxs("li",{className:N({[v.listItem]:r.multiple,[v.separated]:_&&i[s+1]!==void 0&&i[s+1].group!==_}),children:[r.multiple&&e.jsx(h.Input,{type:"checkbox",label:c,labelClassName:"u-no-padding--top u-no-margin--bottom",value:p,onChange:g,checked:r.selectedItems.includes(p),disabled:n==null?void 0:n.some(d=>d.value===p)}),!r.multiple&&r.selectedItem!==p&&e.jsx(h.Button,{type:"button",appearance:"base",className:v.button,onClick:()=>r.onItemSelect(p),children:c}),!r.multiple&&r.selectedItem===p&&e.jsx("span",{className:v.selected,children:c})]},p))})]}),r.multiple&&e.jsxs("span",{className:v.footer,children:[e.jsx(h.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>r.onItemsSelect(i.map(({value:c})=>c)),children:"Select all"}),r.showSelectedItemCount?e.jsx("span",{className:"u-text--muted",children:`${r.selectedItems.length} of ${i.length} selected`}):e.jsx(h.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>r.onItemsSelect([]),children:"Clear"})]})]})},Ae="_label_1i8qt_1",Fe={label:Ae},Te=({options:n})=>{const{disabledColumns:t,setPageParams:o}=k(),a=i=>n.filter(({value:m})=>!i.includes(m)).map(({value:m})=>m);return e.jsx(T,{multiple:!0,showSelectedItemCount:!0,label:e.jsxs(e.Fragment,{children:[e.jsx(h.Icon,{name:"settings"}),e.jsx("span",{className:Fe.label,children:"Columns"})]}),onItemsSelect:i=>o({disabledColumns:a(i)}),options:n,disabledOptions:n.filter(({canBeHidden:i})=>!i),selectedItems:a(t)})},Le="_container_1ctbs_1",qe="_chipsContainer_1ctbs_8",Ee="_collapsed_1ctbs_16",He="_clearAllButton_1ctbs_21",De="_showLessButton_1ctbs_22",Re="_showMoreButton_1ctbs_23",ze="_clearAllIcon_1ctbs_38",$={container:Le,chipsContainer:qe,collapsed:Ee,clearAllButton:He,showLessButton:De,showMoreButton:Re,clearAllIcon:ze},Me=["accessGroups","availabilityZones","os","search","status","tags"],Pe=({accessGroupOptions:n,availabilityZonesOptions:t,filtersToDisplay:o,osOptions:a,statusOptions:i,tagOptions:m})=>{var j,S;const[l,r]=f.useState(!1),[g,c]=f.useState(0),p=o??Me,_=f.useRef(null),{setPageParams:s,accessGroups:d,availabilityZones:u,os:b,status:C,tags:L}=k(),q=()=>{s({accessGroups:[],availabilityZones:[],os:"",status:"",tags:[]}),r(!1)},E=()=>{if(!_.current)return;const x=[..._.current.querySelectorAll(".p-chip")];if(!x.length)return c(0);const R=x[0].offsetTop,B=x.filter(({offsetTop:w})=>w>R).length;B===0&&(r(!1),c(0)),c(B)};f.useEffect(()=>(window.addEventListener("resize",E),()=>{window.removeEventListener("resize",E)}),[]),f.useEffect(()=>{E()},[d.length,u.length,g,b,C,L.length]);const O=[...[C].slice(p.includes("status")?0:1),...[b].slice(p.includes("os")?0:1),...u.slice(p.includes("availabilityZones")?0:u.length),...d.slice(p.includes("accessGroups")?0:d.length),...L.slice(p.includes("tags")?0:L.length)].filter(Boolean).length>1;return e.jsxs("div",{className:$.container,children:[e.jsxs("div",{ref:_,className:N($.chipsContainer,{[$.collapsed]:!l}),children:[O&&e.jsxs(h.Button,{type:"button",appearance:"link",hasIcon:!0,className:$.clearAllButton,onClick:q,children:[e.jsx(h.Icon,{name:"close",className:$.clearAllIcon}),e.jsx("span",{children:"Clear all filters"})]}),p.includes("status")&&C&&e.jsx(h.Chip,{value:`Status: ${((j=i==null?void 0:i.find(({value:x})=>x===C))==null?void 0:j.label)??C}`,onDismiss:()=>s({status:""}),className:"u-no-margin--bottom u-no-margin--right"}),p.includes("os")&&b&&e.jsx(h.Chip,{value:`OS: ${((S=a==null?void 0:a.find(({value:x})=>x===b))==null?void 0:S.label)??b}`,onDismiss:()=>s({os:""}),className:"u-no-margin--bottom u-no-margin--right"}),p.includes("availabilityZones")&&u.map((x,R,B)=>{var w;return e.jsx(h.Chip,{value:`Availability z.: ${((w=t==null?void 0:t.find(({value:I})=>I===x))==null?void 0:w.label)??x}`,onDismiss:()=>s({availabilityZones:B.filter(I=>I!==x)}),className:"u-no-margin--bottom u-no-margin--right"},x)}),p.includes("accessGroups")&&d.map((x,R,B)=>{var w;return e.jsx(h.Chip,{value:`Access group: ${((w=n==null?void 0:n.find(({value:I})=>I===x))==null?void 0:w.label)??x}`,onDismiss:()=>s({accessGroups:B.filter(I=>I!==x)}),className:"u-no-margin--bottom u-no-margin--right"},x)}),p.includes("tags")&&L.map((x,R,B)=>{var w;return e.jsx(h.Chip,{value:`Tag: ${((w=m==null?void 0:m.find(({value:I})=>I===x))==null?void 0:w.label)??x}`,onDismiss:()=>s({tags:B.filter(I=>I!==x)}),className:"u-no-margin--bottom u-no-margin--right"},x)}),l&&e.jsx(h.Button,{type:"button",appearance:"link",className:$.showLessButton,onClick:()=>r(!1),children:e.jsx("span",{className:"u-text--muted",children:"Show less"})})]}),g>0&&!l&&e.jsx(h.Button,{type:"button",appearance:"link",className:$.showMoreButton,onClick:()=>r(!0),children:e.jsx("span",{className:"u-text--muted",children:`+${g}`})})]})},G=()=>{const n=xe(),t=se(),o=(l={},r={})=>te({queryKey:["savedSearches",l],queryFn:()=>n.get("GetSavedSearches",{params:l}),...r}),a=Q({mutationFn:l=>n.get("CreateSavedSearch",{params:l}),onSuccess:()=>t.invalidateQueries({queryKey:["savedSearches"]})}),i=Q({mutationFn:l=>n.get("EditSavedSearch",{params:l}),onSuccess:()=>t.invalidateQueries({queryKey:["savedSearches"]})}),m=Q({mutationFn:l=>n.get("RemoveSavedSearch",{params:l}),onSuccess:()=>t.invalidateQueries({queryKey:["savedSearches"]})});return{getSavedSearchesQuery:o,createSavedSearchQuery:a,editSavedSearchQuery:i,removeSavedSearchQuery:m}},Ue="_container_5hvuq_1",Oe="_list_5hvuq_6",Qe="_listItem_5hvuq_11",Ve="_search_5hvuq_17",Ge="_row_5hvuq_25",Ke="_truncated_5hvuq_33",A={container:Ue,list:Oe,listItem:Qe,search:Ve,row:Ge,truncated:Ke},We=({onSavedSearchClick:n,onSavedSearchRemove:t,savedSearches:o})=>{if(!o.length)return null;const a=Y(),{notify:i}=J(),{removeSavedSearchQuery:m}=G(),{mutateAsync:l,isPending:r}=m,g=async c=>{try{await l({name:c}),t(),i.success({message:`Saved search ${c} successfully removed`,title:"Saved search removed"})}catch(p){a(p)}};return e.jsxs("div",{className:A.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Saved searches"}),e.jsx("ul",{className:N("p-list--divided u-no-margin--bottom",A.list),children:o.map(c=>e.jsx("li",{children:e.jsxs("div",{className:A.listItem,children:[e.jsx(h.Button,{type:"button",appearance:"base",className:A.search,onClick:()=>n(c),children:e.jsxs(h.Row,{className:A.row,children:[e.jsx(h.Col,{size:4,children:e.jsx(h.Tooltip,{message:c.name,positionElementClassName:A.truncated,children:e.jsx("span",{children:c.name})})}),e.jsx(h.Col,{size:8,children:e.jsx(h.Tooltip,{message:c.search,positionElementClassName:A.truncated,children:e.jsx("span",{children:c.search})})})]})}),e.jsx(h.ConfirmationButton,{className:"has-icon u-no-margin--bottom u-no-padding--bottom u-no-padding--top",type:"button",appearance:"base",confirmationModalProps:{title:"Remove saved search",children:e.jsxs("p",{children:['This will remove the saved search "',c.name,'".']}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:r,confirmButtonLoading:r,onConfirm:()=>g(c.name)},children:e.jsx(h.Icon,{name:"delete"})})]})},c.name))})]})},Ze=({containerRef:n,onDismiss:t,onOverflowingItemsAmountChange:o,searchData:a})=>{const i=()=>{if(!n.current)return;const l=n.current.querySelectorAll("span.p-chip");o(Array.from(l).filter(({offsetHeight:r,offsetTop:g})=>g>r).length)};ne("resize",i),f.useEffect(()=>{i()},[a.length]);const m=l=>l.title?l.title:l.quoteValue?`'${l.value}'`:l.value;return a.map(l=>e.jsx(h.Chip,{value:m(l),lead:l.lead,onDismiss:()=>t(l.value)},l.value))},Ye="_infoContainer_1lzch_1",Je="_amount_1lzch_9",Xe="_helpButtonContainer_1lzch_14",es="_helpButton_1lzch_14",M={infoContainer:Ye,amount:Je,helpButtonContainer:Xe,helpButton:es},ss=({isExpanded:n,onHelpButtonClick:t,overflowingChipsAmount:o})=>e.jsxs("div",{className:M.infoContainer,children:[o>0&&!n&&e.jsx("span",{className:N("u-text--muted",M.amount),children:`+${o}`}),e.jsx("div",{className:M.helpButtonContainer,children:e.jsx(h.Button,{type:"button",appearance:"base",hasIcon:!0,className:M.helpButton,onClick:a=>{a.stopPropagation(),t()},children:e.jsx(h.Icon,{name:h.ICONS.help})})})]}),ts=({onClose:n,onSearchSave:t,search:o})=>{const a=Y(),{notify:i}=J(),{createSavedSearchQuery:m}=G(),{mutateAsync:l}=m,g=ae({initialValues:{name:""},onSubmit:async({name:c})=>{try{await l({search:o,name:c,title:c}),i.success({message:`Saved search ${c} successfully added`,title:"Saved search added"}),t(),n()}catch(p){a(p)}},validationSchema:re({name:le().required("This field is required").test({message:"Name must consist of only lowercase alphanumeric characters and hyphens",test:c=>/^[a-z0-9][-a-z0-9]*$/.test(c)})})});return e.jsxs(h.Form,{onSubmit:g.handleSubmit,noValidate:!0,children:[e.jsx(h.Input,{type:"text",autoComplete:"off",autoFocus:!0,label:"Search name",...g.getFieldProps("name"),error:g.touched.name&&g.errors.name?g.errors.name:void 0}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(h.Button,{type:"button",disabled:g.isSubmitting,onClick:n,children:"Cancel"}),e.jsx(h.Button,{type:"submit",disabled:g.isSubmitting,appearance:"positive","aria-label":`Saved search as ${g.values.name}`,children:"Save search"})]})]})},ns="_container_fqj7b_1",as="_prompt_fqj7b_10",rs="_saveButton_fqj7b_17",V={container:ns,prompt:as,saveButton:rs},ls=({onSearchSave:n,search:t})=>{const[o,a]=f.useState(!1);return e.jsxs(e.Fragment,{children:[t&&o&&e.jsx(ts,{onClose:()=>a(!1),onSearchSave:n,search:t}),t&&!o&&e.jsxs("div",{className:V.container,children:[e.jsxs("span",{className:V.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:t}),e.jsx("span",{children:"..."})]}),e.jsx(h.Button,{type:"button",appearance:"link",onClick:()=>a(!0),className:V.saveButton,children:"Save search"})]})]})},os="_searchContainer_t00ki_1",is="_form_t00ki_8",cs="_searchBoxContainer_t00ki_13",ds="_input_t00ki_17",P={searchContainer:os,form:is,searchBoxContainer:cs,input:ds},us=(n,t)=>!n||!t?[]:n.split(",").map(o=>{const a=t.find(({name:i})=>i===o);return a?{lead:"search",title:a.name,value:a.name}:{value:o,quoteValue:!0}}),hs=({onHelpButtonClick:n})=>{const{search:t,setPageParams:o}=k(),[a,i]=f.useState(""),[m,l]=f.useState(!1),[r,g]=f.useState(0),{getSavedSearchesQuery:c}=G(),p=f.useRef(null),_=f.useRef(null);oe(p,()=>{l(!1)});const d=j=>{o({search:t.split(",").filter(S=>S!==j).join(",")})},{data:u,isLoading:b}=c(),C=f.useMemo(()=>us(t,u==null?void 0:u.data),[t,u==null?void 0:u.data]),L=f.useMemo(()=>u?!a&&!C.length?u.data:u.data.filter(({name:j})=>C.every(({value:S})=>S!==`search:${j}`)).filter(({title:j,search:S})=>j.toLowerCase().includes(a.trim().toLowerCase())||S.toLowerCase().includes(a.trim().toLowerCase())):[],[u,a,C]),q=()=>{a&&(o({search:t?`${t},${a}`:a}),i(""))},E=j=>{o({search:t?`${t},search:${j.name}`:`search:${j.name}`})},O=j=>{const{key:S}=j;m?(S==="Escape"&&l(!1),S==="Enter"&&q()):S==="Enter"&&l(!0)};return e.jsxs("div",{className:"p-search-and-filter",ref:p,children:[e.jsxs("div",{className:N("p-search-and-filter__search-container",P.searchContainer),"aria-expanded":m,ref:_,onClick:()=>l(!0),children:[e.jsx(Ze,{containerRef:_,onDismiss:d,onOverflowingItemsAmountChange:j=>g(j),searchData:C}),e.jsx(h.Form,{onSubmit:j=>{j.preventDefault(),q()},className:N("p-search-and-filter__box",P.form),children:e.jsx("div",{className:P.searchBoxContainer,children:e.jsx(h.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autocomplete:"off",className:P.input,value:a,onChange:j=>i(j),onClear:()=>i(""),onSearch:q,onClick:()=>l(!0),onKeyUp:O})})}),e.jsx(ss,{isExpanded:m,onHelpButtonClick:n,overflowingChipsAmount:r})]}),m&&b&&e.jsx(X,{}),m&&!b&&e.jsxs("div",{className:"p-search-and-filter__panel",children:[e.jsx(ls,{onSearchSave:()=>i(""),search:a.trim()}),e.jsx(We,{onSavedSearchClick:E,onSavedSearchRemove:()=>l(!0),savedSearches:L})]})]})},ms=({options:n})=>{const{accessGroups:t,setPageParams:o}=k();return e.jsx(T,{multiple:!0,label:"Access group",hasToggleIcon:!0,hasBadge:!0,options:n,onItemsSelect:a=>o({accessGroups:a}),selectedItems:t})},ps=({options:n})=>{const[t,o]=f.useState(""),{availabilityZones:a,setPageParams:i}=k(),m=n.length>9&&t?n.filter(({value:r})=>r!=="none"&&r.includes(t)):n,l=r=>{r[r.length-1]==="none"?i({availabilityZones:["none"]}):i({availabilityZones:r[0]!=="none"?r:r.filter(g=>g!=="none")})};return e.jsx(T,{multiple:!0,label:"Availability zone",hasToggleIcon:!0,hasBadge:!0,onSearch:n.length>9?r=>o(r):void 0,options:m,onItemsSelect:l,selectedItems:a})},gs=({options:n})=>{const{groupBy:t,setPageParams:o}=k();return e.jsx(T,{multiple:!1,label:"Group by",hasToggleIcon:!0,hasBadge:!0,options:n,onItemSelect:a=>o({groupBy:a}),selectedItem:t})},xs=({options:n})=>{const{os:t,setPageParams:o}=k();return e.jsx(T,{multiple:!1,hasBadge:!0,label:"OS",hasToggleIcon:!0,options:n,onItemSelect:a=>o({os:a}),selectedItem:t})},fs=({options:n})=>{const{setPageParams:t,status:o}=k();return e.jsx(T,{multiple:!1,label:"Status",hasToggleIcon:!0,hasBadge:!0,options:n,onItemSelect:a=>t({status:a}),selectedItem:o})},js=({options:n})=>{const[t,o]=f.useState(""),{tags:a,setPageParams:i}=k(),m=n.filter(({value:l})=>l.includes(t));return e.jsx(T,{multiple:!0,label:"Tag",hasToggleIcon:!0,hasBadge:!0,options:m,onItemsSelect:l=>i({tags:l}),onSearch:l=>o(l),selectedItems:a})},_s=[{term:"<keyword>",description:e.jsxs("span",{children:["Instances with the title or hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"distribution:<keyword>",description:e.jsxs("span",{children:["Instances with the installed distribution named"," ",e.jsx("code",{children:"<keyword>"})]})},{term:"needs:reboot",description:"Instances needing a reboot"},{term:"alert:<type>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with outstanding alerts of the specified"," ",e.jsx("code",{children:"<type>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be ",e.jsx("code",{children:"package-upgrades"}),","," ",e.jsx("code",{children:"security-upgrades"}),",",e.jsx("code",{children:"package-profiles"}),","," ",e.jsx("code",{children:"package-reporter"}),", ",e.jsx("code",{children:"esm-disabled"}),","," ",e.jsx("code",{children:"computer-offline"}),",",e.jsx("code",{children:"computer-reboot"}),","," ",e.jsx("code",{children:"computer-duplicates"}),", ",e.jsx("code",{children:"unapproved-activities"}),"."]})]})},{term:"ip:<address>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with IP addresses like ",e.jsx("code",{children:"<address>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<address>"})," can be a fragment or partial IP address representing a subnet such as 91.185.94 to match any instances in the subnet."]})]})},{term:"mac:<address>",description:e.jsxs("span",{children:["Instances with the MAC address ",e.jsx("code",{children:"<address>"})]})},{term:"id:<instance_id>",description:e.jsxs("span",{children:["Instance with the id ",e.jsx("code",{children:"<instance_id>"})]})},{term:"access-group:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," access group"]})},{term:"search:<name>",description:e.jsxs("span",{children:["Instances meeting the terms of the ",e.jsx("code",{children:"<name>"})," saved search"]})},{term:"upgrade-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," upgrade profile"]})},{term:"removal-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," removal profile"]})},{term:"tag:<keyword>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<keyword>"})," tag"]})},{term:"hostname:<keyword>",description:e.jsxs("span",{children:["Instance with the hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"title:<keyword>",description:e.jsxs("span",{children:["Instance with the title ",e.jsx("code",{children:"<keyword>"})]})},{term:"license-id:<license_id>",description:e.jsxs("span",{children:["Search for instances licensed to the specified"," ",e.jsx("code",{children:"<license_id>"})]})},{term:"needs:license OR license-id:none",description:"Search for instances that do not have a Landscape license, and, as a result, are not managed"},{term:"annotation:<key>",description:e.jsxs("span",{children:["Search for instances which define the specified annotation key. Optionally specify ",e.jsx("code",{children:"annotation:<key>:<string>"})," ","which will only return instances whose key matches and value also contains the ",e.jsx("code",{children:"<string>"})," specified"]})}],bs=[{canBeHidden:!1,label:"Instance name",value:"title"},{canBeHidden:!0,label:"Status",value:"status"},{canBeHidden:!0,label:"Upgrades",value:"upgrades"},{canBeHidden:!0,label:"OS",value:"os"},{canBeHidden:!0,label:"Availability zone",value:"availability_zone"},{canBeHidden:!0,label:"Ubuntu pro",value:"ubuntu_pro"},{canBeHidden:!0,label:"Last ping",value:"last_ping"}],Cs="_top_q7ta9_1",vs="_select_q7ta9_13",Ss="_searchContainer_q7ta9_19",ys="_filters_q7ta9_23",Is="_divider_q7ta9_28",ks="_widgets_q7ta9_32",D={top:Cs,select:vs,searchContainer:Ss,filters:ys,divider:Is,widgets:ks},ws=()=>{const[n,t]=f.useState(!1),{getAccessGroupQuery:o}=fe(),{getAllInstanceTagsQuery:a,getAvailabilityZonesQuery:i}=ee(),{data:m}=a(),l=(m==null?void 0:m.data.results.map(u=>({label:u,value:u})))??[],{data:r}=i(),g=((r==null?void 0:r.data.values)??[]).reduce((u,b)=>(u.push({label:b,value:b}),u),[{label:"Without zones",value:"none",group:"1"}]),{data:c}=o(),p=(c==null?void 0:c.data.map(({name:u,title:b})=>({value:u,label:b})))??[],_=F.groupBy.options,s=F.status.type==="select"?F.status.options:[],d=F.os.type==="select"?F.os.options:[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:D.top,children:[e.jsx("div",{className:D.searchContainer,children:e.jsx(hs,{onHelpButtonClick:()=>t(!0)})}),e.jsxs("div",{className:D.filters,children:[e.jsx(gs,{options:_}),e.jsx("span",{className:D.divider}),e.jsx(fs,{options:s}),e.jsx(xs,{options:d}),e.jsx(ps,{options:g}),e.jsx(ms,{options:p}),e.jsx(js,{options:l}),e.jsx("span",{className:D.divider}),e.jsx(Te,{options:bs})]})]}),e.jsx(Pe,{filtersToDisplay:["accessGroups","os","availabilityZones","status","tags"],accessGroupOptions:p,availabilityZonesOptions:g,osOptions:d,statusOptions:s,tagOptions:l}),e.jsx(ge,{open:n,data:_s,onClose:()=>t(!1)}),e.jsx(me,{})]})},Ns="_checkbox_spblf_1",Bs="_rowHeader_spblf_5",$s="_nested_spblf_8",As="_restartError_spblf_12",Fs="_restartWarning_spblf_16",Ts="_statusListItem_spblf_20",Ls="_statusContainer_spblf_24",U={checkbox:Ns,rowHeader:Bs,nested:$s,restartError:As,restartWarning:Fs,statusListItem:Ts,statusContainer:Ls},qs=({instances:n,selectedInstances:t,setSelectedInstances:o,groupBy:a})=>{const{disabledColumns:i}=k(),m=()=>{o(t.length!==0?[]:n)},l=s=>{if(a==="parent"&&s.original.children.length>0){const d=s.original.children.map(({id:u})=>u);t.some(({id:u})=>d.includes(u))?o(t.filter(({id:u})=>!d.includes(u))):o([...t,...s.original.children.map(u=>({...u,parent:s.original,children:[]}))])}else t.some(({id:d})=>d===s.original.id)?o(t.filter(({id:d})=>d!==s.original.id)):o([...t,s.original])},r=f.useMemo(()=>a==="parent"?n.map(s=>({...s,subRows:s.children.map(d=>({...d,parent:s,children:[]}))})):n,[n,a]),g=s=>{const d=t.map(({id:u})=>u);return a==="parent"&&!s.is_wsl_instance&&s.children.length>0?s.children.every(({id:u})=>d.includes(u))?"checked":s.children.some(({id:u})=>d.includes(u))?"indeterminate":"unchecked":d.includes(s.id)?"checked":"unchecked"},c=s=>{if(!s.distribution||!/\d{1,2}\.\d{2}/.test(s.distribution))return{icon:"",label:e.jsx(H,{})};if(!s.upgrades||!s.upgrades.security&&!s.upgrades.regular)return{icon:y.UpToDate.icon.color,label:y.UpToDate.label};if(s.upgrades.security)if(s.upgrades.regular){const d=`${s.upgrades.security} security, ${s.upgrades.regular} regular ${s.upgrades.regular===1?"upgrade":"upgrades"}`;return{icon:y.SecurityUpgradesAlert.icon.color,label:e.jsx(e.Fragment,{children:d})}}else return{icon:y.SecurityUpgradesAlert.icon.color,label:e.jsxs(e.Fragment,{children:[s.upgrades.security," security"," ",s.upgrades.security===1?"upgrade":"upgrades"]})};else return{icon:y.PackageUpgradesAlert.icon.color,label:e.jsxs(e.Fragment,{children:[s.upgrades.regular," regular"," ",s.upgrades.regular===1?"upgrade":"upgrades"]})}},p=s=>{const d=((s==null?void 0:s.alerts)??[]).filter(({type:u})=>!["PackageUpgradesAlert","SecurityUpgradesAlert"].includes(u));return d.length===0?{icon:`${y.Online.icon.color}`,label:y.Online.alternateLabel??y.Online.label}:d.length===1?{icon:`${y[d[0].type].icon.color??y.Unknown.icon.color}`,label:e.jsx(e.Fragment,{children:d[0].summary})}:{label:e.jsx("span",{className:U.statusContainer,children:d.map(({type:u,summary:b})=>{var C;return e.jsx("span",{className:U.statusListItem,children:e.jsx(h.Tooltip,{message:b,children:e.jsx(h.Icon,{className:"u-no-margin--left",name:`${((C=y[u])==null?void 0:C.icon.color)??y.Unknown.icon.color}`})})},u)})})}},_=f.useMemo(()=>[{accessor:"title",Header:e.jsxs(e.Fragment,{children:[e.jsx(h.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,onChange:m,disabled:n.length===0,checked:t.length===n.length&&n.length!==0,indeterminate:t.length!==0&&t.length<n.length}),e.jsx("span",{children:"Name"})]}),Cell:({row:s})=>e.jsxs("div",{className:N(U.rowHeader,{[U.nested]:s.depth>0}),children:[e.jsx(h.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:s.original.title}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:g(s.original)==="checked",indeterminate:g(s.original)==="indeterminate",onChange:()=>{l(s)}}),e.jsx(ie,{to:s.original.parent?`${K}instances/${s.original.parent.id}/${s.original.id}`:`${K}instances/${s.original.id}`,children:s.original.title})]})},{accessor:"status",Header:"Status",Cell:({row:{original:s}})=>{const{label:d}=p(s);return d},getCellIcon:({row:{original:s}})=>{const{icon:d}=p(s);return d}},{accessor:"upgrades",Header:"Upgrades",Cell:({row:{original:s}})=>{const{label:d}=c(s);return d},getCellIcon:({row:{original:s}})=>{const{icon:d}=c(s);return d}},{accessor:"os",Header:"OS",Cell:({row:{original:s}})=>e.jsx(e.Fragment,{children:s.distribution_info.description??e.jsx(H,{})})},{accessor:"availability_zone",Header:"Availability zone",Cell:({row:{original:s}})=>{var d;return e.jsx(e.Fragment,{children:((d=s.cloud_init)==null?void 0:d.availability_zone)??e.jsx(H,{})})}},{accessor:"ubuntu_pro",Header:"Ubuntu pro",Cell:({row:s})=>e.jsx(e.Fragment,{children:s.original.ubuntu_pro_info&&z(s.original.ubuntu_pro_info.expires).isValid()?`Exp. ${z(s.original.ubuntu_pro_info.expires).format(W)}`:e.jsx(H,{})})},{accessor:"last_ping",Header:"Last ping time",Cell:({row:s})=>e.jsx(e.Fragment,{children:z(s.original.last_ping_time).isValid()?z(s.original.last_ping_time).format(W):e.jsx(H,{})})}].filter(({accessor:s})=>s&&!i.includes(s)),[i.length,t.length,n,a]);return e.jsx(h.ModularTable,{emptyMsg:"No instances found",columns:_,data:r})},Z=(n,t)=>{var o;return n.type==="select"?((o=n.options.find(a=>a.value===t))==null?void 0:o.query)??"":""},Es=({accessGroups:n,availabilityZones:t,os:o,search:a,status:i,tags:m})=>{const l=[];return o&&l.push(Z(F.os,o)),i&&l.push(Z(F.status,i)),a&&l.push(...a.split(",")),m.length&&l.push(`tag:${m.join(" OR tag:")}`),n.length&&l.push(`access-group:${n.join(" OR access-group:")}`),t.length&&l.push(t.includes("none")?"availability-zone:null":`availability-zone:${t.join(" OR availability-zone:")}`),l.join(" ")},Hs=({selectedInstances:n,setSelectedInstances:t})=>{const{currentPage:o,pageSize:a,groupBy:i,...m}=k(),{getInstancesQuery:l}=ee(),{data:r,isLoading:g}=l({query:Es(m),root_only:i==="parent",with_alerts:!0,with_upgrades:!0,limit:a,offset:(o-1)*a}),c=(r==null?void 0:r.data.results)??[],p=(r==null?void 0:r.data.count)??0,_=()=>{t([])};return e.jsxs(e.Fragment,{children:[e.jsx(ws,{}),g?e.jsx(X,{}):e.jsx(qs,{instances:c,selectedInstances:n,setSelectedInstances:s=>t(s),groupBy:i}),e.jsx(he,{totalItems:p,handleClearSelection:_,currentItemCount:c.length})]})},Ds="_header_116wp_1",Rs={header:Ds},Xs=()=>{const[n,t]=f.useState([]);return e.jsxs(ce,{children:[e.jsx(de,{title:"Instances",className:Rs.header,actions:[e.jsx(pe,{selected:n},"actions")]}),e.jsx(ue,{children:e.jsx(Hs,{selectedInstances:n,setSelectedInstances:o=>{t(o)}})})]})};export{Xs as default};
