import{j as e,aF as E,P as S,av as N,i,aD as P,M as R,al as A,d as c,a6 as F,B as L,D as v,aC as O,o as y,w as D,aw as B}from"./index-DZF0LgVk.js";import{T as W}from"./TruncatedCell-BR0xotE4.js";import{u as G}from"./useGetInstances-vEX72wFZ.js";import{g as M}from"./WslInstancesEmptyState-B8UosALV.js";import{u as H}from"./useSelection-kcs6R2WN.js";import{u as U}from"./useExpandableRow-XVaXaj3C.js";import"./GroupFilter-CQCzE7aQ.js";import"./HeaderWithSearch-BW1L9XJe.js";import"./useRoles-DlzB6KGu.js";const V=t=>e.jsx(E,{...t}),$="_header_513lp_1",q="_search_513lp_8",j={header:$,search:q},z=({instance:t})=>{const{value:a,setTrue:r,setFalse:d}=S();return e.jsxs(e.Fragment,{children:[e.jsx(N,{destructiveActions:[{icon:"security-tick",label:"Make compliant",onClick:r}],toggleAriaLabel:`${t.title} actions`}),e.jsx(M,{close:d,instances:[t],isOpen:a})]})},Y=t=>({column:a,row:{index:r}})=>a.id==="profiles"&&t===r?{className:"expandedCell"}:{},Z=t=>({index:a})=>t===a?{className:"expandedRow"}:{},oe=({wslProfile:t})=>{const{expandedRowIndex:a,getTableRowsRef:r,handleExpand:d}=U(),[_,u]=i.useState(""),[w]=i.useState(P),[m]=i.useState(R),[h,g]=i.useState(""),{instances:o,isGettingInstances:x}=G({query:[h,`profile:wsl:${t.id}:noncompliant`].filter(Boolean).join(" "),limit:m,offset:(w-1)*m,with_wsl_profiles:!0}),{selectedItems:n,setSelectedItems:f}=H(o,x),{value:I,setTrue:T,setFalse:k}=S(),b=i.useMemo(()=>[{accessor:"title",Header:e.jsxs(e.Fragment,{children:[e.jsx(c.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,disabled:!o.length,indeterminate:!!n.length&&n.length<o.length,checked:!!o.length&&n.length===o.length,onChange:({currentTarget:{checked:s}})=>{f(s?o:[])}}),"Instance name"]}),Cell:({row:{original:s}})=>e.jsxs(e.Fragment,{children:[e.jsx(c.CheckboxInput,{inline:!0,label:e.jsxs("span",{className:"u-off-screen",children:["Select ",s.title]}),checked:n.includes(s),onChange:({currentTarget:{checked:l}})=>{f(l?[...n,s]:n.filter(p=>p!==s))}}),e.jsx(F,{to:`/instances/${s.id}`,children:s.title})]})},{Header:"OS",Cell:({row:{original:s}})=>s.distribution_info?.description},{accessor:"profiles",Header:"WSL profiles",Cell:({row:{original:s,index:l}})=>e.jsx(W,{content:s.wsl_profiles?.map(p=>p.title).join(", "),isExpanded:l===a,onExpand:()=>{d(l)}})},{Header:"Last ping",Cell:({row:{original:s}})=>{const l=L(s.last_ping_time);return l.isValid()?e.jsx("span",{className:"font-monospace",children:l.format(v)}):e.jsx(O,{})}},{...A,Cell:({row:{original:s}})=>e.jsx(z,{instance:s})}],[o,n,a]),C=()=>{u(""),g("")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:j.header,children:[e.jsx(c.SearchBox,{className:y("u-no-margin--bottom",j.search),externallyControlled:!0,value:_,onChange:u,onClear:C,onSearch:g,autoComplete:"off"}),e.jsxs(c.Button,{type:"button",className:"u-no-margin",hasIcon:!0,onClick:T,disabled:!n.length,children:[e.jsx(c.Icon,{name:"security-tick"}),e.jsx("span",{children:"Make compliant"})]})]}),e.jsx(V,{filters:[{label:"Search",item:h||void 0,clear:C}]}),x?e.jsx(D,{}):e.jsx("div",{ref:r,children:e.jsx(B,{columns:b,data:o,emptyMsg:"No Windows instances found according to your search parameters.",getCellProps:Y(a),getRowProps:Z(a)})}),e.jsx(M,{close:k,instances:n,isOpen:I})]})};export{oe as default};
