import{o as y,a as j,p as b,q as U,j as s,m as I,g as p,r as P,n as S,E as $}from"./index-CYtilM9P.js";import{u as l}from"./usePageParams-ZZvT3eZS.js";import{u as g}from"./usePackages-DpHUrRSm.js";import{T as v}from"./TableFilterChips-Dqh7xIWp.js";import{H as L}from"./HeaderWithSearch-DM4VyiUV.js";import{U as k}from"./UsnList-D264jwxv.js";import"./useFetchOld-DGhJqqp0.js";import"./SelectAllButton-CwRdnU1s.js";import"./ExpandableTableFooter-C4oa8PnM.js";import"./NoData-1Ct4F_u9.js";import"./TablePagination-BBOB7v53.js";import"./TablePaginationBase-CdWtR2Ho.js";import"./TruncatedCell-CmgOKtjr.js";import"./helpers-BonKpxw0.js";const N="_actions_1l3g0_1",_={actions:N},w=({usns:t})=>{const{instanceId:o,childInstanceId:a}=y(),{setPageParams:n}=l(),r=j(),e=b(),{notify:i}=U(),{upgradeInstanceUsnsQuery:c}=g(),d=Number(o),{mutateAsync:m,isPending:u}=c,h=()=>{r(`/instances/${a?`${d}/${a}`:`${d}`}`),n({tab:"activities"}),i.clear()},f=async()=>{try{await m({instanceId:d,usns:t}),i.success({title:"You queued packages to be upgraded",message:`Affected packages for ${t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:h}]})}catch(x){e(x)}};return s.jsxs(s.Fragment,{children:[s.jsx(L,{actions:s.jsx("div",{className:I("p-segmented-control",_.actions),children:s.jsxs(p.ConfirmationButton,{className:"p-segmented-control__button has-icon u-no-margin--bottom",type:"button",disabled:t.length===0,confirmationModalProps:{title:"Upgrade affected packages",children:s.jsxs("p",{children:["This will upgrade affected packages for"," ",t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`,"."]}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:u,confirmButtonDisabled:u,onConfirm:f},children:[s.jsx(p.Icon,{name:"change-version"}),s.jsx("span",{children:"Upgrade"})]})})}),s.jsx(v,{filtersToDisplay:["search"]})]})},C=({instance:t,isUsnsLoading:o,totalUsnCount:a,usns:n})=>{const[r,e]=P.useState([]),{search:i}=l();return s.jsxs(s.Fragment,{children:[s.jsx(w,{usns:r}),s.jsx(k,{tableType:"paginated",instances:[t],isUsnsLoading:o,onSelectedUsnsChange:c=>e(c),search:i,selectedUsns:r,totalUsnCount:a,usns:n})]})},J=({instance:t})=>{const{search:o,currentPage:a,pageSize:n}=l(),{getUsnsQuery:r}=g(),{data:e,isLoading:i}=r({computer_ids:[t.id],limit:n,offset:(a-1)*n,search:o,show_packages:!1});return s.jsxs(s.Fragment,{children:[!o&&a===1&&n===20&&i&&s.jsx(S,{}),!o&&a===1&&n===20&&!i&&(!e||e.data.results.length===0)&&s.jsx($,{icon:"inspector-debug",title:"No security issues found"}),(o||a>1||n!==20||!i&&e&&e.data.results.length>0)&&s.jsx(C,{instance:t,isUsnsLoading:i,totalUsnCount:(e==null?void 0:e.data.count)??0,usns:(e==null?void 0:e.data.results)??[]})]})};export{J as default};
