const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CoV5cm2m.js","assets/index-Bd4iIRe_.js","assets/index-C0ZxZ9J6.css","assets/useInstances-CXxtUloJ.js","assets/useFetchOld-CisSrTSd.js","assets/WslInstancesHeader-rK_Jf8EZ.js","assets/HeaderWithSearch-BZcWm4PV.js","assets/HeaderWithSearch-Dlfhk-35.css","assets/usePageParams-CGqhdr-B.js","assets/WslInstancesHeader-Dj3EjS23.css","assets/useRoles-iAPrd7as.js","assets/moment-DWLH54Z_.js","assets/NoData-BBZVu-3W.js","assets/moment-C5S46NFB.js","assets/index-OHX2sxSE.js","assets/TablePagination-9gj_8Kgx.js","assets/TablePaginationBase-BDX0aSIU.js","assets/TablePaginationBase-CJl3HN1X.css","assets/TableFilterChips-DUUXOsEl.js","assets/TableFilterChips-BAnU27MY.css","assets/index-Eujs1Quf.css","assets/InstancesPageActions-yksR1lE9.js","assets/InstancesPageActions-CswnIe9I.css","assets/index-Dk2MuvQg.css","assets/index-DMnSP19R.js","assets/index-CsHgpdRJ.css","assets/index-BAElJeM7.js","assets/index-DrjfSO6d.css","assets/index-CEGdD4Ut.js","assets/useUsns-DTUaHna2.js","assets/useUsns-D2X0CFCl.css","assets/index-BtYnf8xN.css","assets/index-BzF9NX4g.js","assets/index-CpKMN72O.js","assets/PageMain-DnY4ZdGq.js","assets/PageMain--v5xNZ5p.css","assets/index-MWJPBEiS.css","assets/index-BhIas6eP.js","assets/index-6TCR7F2i.css","assets/index-9SovhHlM.js","assets/SidePanelFormButtons-vMl4fSkh.js","assets/SidePanelFormButtons.module-C5v714vX.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/helpers-Cr00MT1Y.js","assets/output-DFRNcfG-.js","assets/index-CrSQJCkv.css","assets/index-C6s8HaTz.js","assets/UsnList-dlVD_YYf.js","assets/SelectAllButton-DJUMTYTj.js","assets/ExpandableTableFooter-nxzKm-US.js","assets/ExpandableTableFooter-DWm8zyWg.css","assets/TruncatedCell-BaOxk-cS.js","assets/TruncatedCell-CoXbu3VM.css","assets/helpers-Fm1c994r.js","assets/helpers-CCHFURK6.css","assets/UsnList-B4hAwQmb.css","assets/index-D93OSEp2.css","assets/index-pHMiDKZK.js","assets/index-B1Uu4xTW.css","assets/index-VtFgTwGr.js","assets/downshift.esm-BYnLoRWx.js","assets/index-C0w1ohHD.css","assets/index-CzqhOH16.js","assets/constants-T0brhJIG.js","assets/index-CNIav8so.css","assets/index-DA1G6WD8.js","assets/constants-Dwl1JGyb.js","assets/index-DgHoeIwv.css","assets/index-BvtMf1hP.js"])))=>i.map(i=>d[i]);
import{a as L,j as n,E as R,g as b,r as o,_ as d,f as w,n as h,e as D,b as Q,c as P,d as E,o as V,x as C}from"./index-Bd4iIRe_.js";import{P as O,a as z,b as N}from"./PageMain-DnY4ZdGq.js";import{u as B,a as U}from"./useUsns-DTUaHna2.js";import{u as S}from"./useInstances-CXxtUloJ.js";import"./moment-DWLH54Z_.js";import{u as q}from"./usePageParams-CGqhdr-B.js";import"./moment-C5S46NFB.js";const $=({childInstanceId:e,instanceId:a})=>{const t=L();return n.jsx(R,{title:"Instance not found",icon:"connected",body:n.jsxs("p",{className:"u-no-margin--bottom",children:[n.jsx("span",{children:"Seems like the instance with id = "}),n.jsx("code",{children:a}),n.jsx("span",{children:" doesn't "}),e?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:"have a child instance with id = "}),n.jsx("code",{children:e})]}):n.jsx("span",{children:"exist"})]}),cta:[n.jsx(b.Button,{appearance:"positive",onClick:()=>t("/instances",{replace:!0}),type:"button","aria-label":"Go back",children:"Back to Instances page"},"go-back-to-instances-page"),n.jsx(b.Button,{onClick:()=>t("/",{replace:!0}),type:"button","aria-label":"Go back",children:"Home page"},"go-back-to-home-page")]})},H=[{label:"Info",id:"tab-link-info"},{label:"WSL",id:"tab-link-wsl"},{label:"Activities",id:"tab-link-activities"},{label:"Kernel",id:"tab-link-kernel"},{label:"Security issues",id:"tab-link-security-issues"},{label:"Packages",id:"tab-link-packages"},{label:"Snaps",id:"tab-link-snaps"},{label:"Processes",id:"tab-link-processes"},{label:"Ubuntu Pro",id:"tab-link-ubuntu-pro"},{label:"Users",id:"tab-link-users"},{label:"Hardware",id:"tab-link-hardware"}],M=({id:e,label:a,packageCount:t,packagesLoading:r,usnCount:u,usnLoading:g,kernelCount:i,kernelLoading:c})=>e==="tab-link-packages"&&r||e==="tab-link-security-issues"&&g||e==="tab-link-kernel"&&c?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:a}),n.jsx(b.Spinner,{className:"u-no-margin--bottom u-no-padding--top"})]}):e==="tab-link-packages"&&t?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:a}),n.jsx(b.Badge,{value:t})]}):e==="tab-link-security-issues"&&u?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:a}),n.jsx(b.Badge,{value:u,isNegative:!0})]}):e==="tab-link-kernel"&&i?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:a}),n.jsx(b.Badge,{value:i})]}):a,G=({activeTabId:e,instance:a,onActiveTabChange:t,packageCount:r,packagesLoading:u,usnCount:g,usnLoading:i,kernelCount:c,kernelLoading:p})=>H.filter(({id:_})=>!a.distribution||/\d{1,2}\.\d{2}/.test(a.distribution)?_!=="tab-link-wsl":["tab-link-info","tab-link-wsl","tab-link-activities","tab-link-hardware"].includes(_)).map(({label:_,id:s})=>({label:M({label:_,id:s,packageCount:r,packagesLoading:u,usnCount:g,usnLoading:i,kernelCount:c,kernelLoading:p}),id:s,role:"tab",active:s===e,onClick:()=>t(s)})),W="_tabPanel_1n8p7_1",J={tabPanel:W},X=o.lazy(()=>d(()=>import("./index-CoV5cm2m.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]))),Y=o.lazy(()=>d(()=>import("./index-DMnSP19R.js"),__vite__mapDeps([24,1,2,15,8,16,17,6,7,25]))),Z=o.lazy(()=>d(()=>import("./index-BAElJeM7.js"),__vite__mapDeps([26,1,2,27]))),ee=o.lazy(()=>d(()=>import("./index-CEGdD4Ut.js"),__vite__mapDeps([28,1,2,15,8,16,17,29,4,30,6,7,31]))),ne=o.lazy(()=>d(()=>import("./index-BzF9NX4g.js"),__vite__mapDeps([32,1,2,14,11,15,8,16,17,18,19,4,12,20]))),te=o.lazy(()=>d(()=>import("./index-CpKMN72O.js"),__vite__mapDeps([33,1,2,15,8,16,17,13,12,34,35,29,4,30,3,11,36]))),ae=o.lazy(()=>d(()=>import("./index-BhIas6eP.js"),__vite__mapDeps([37,1,2,5,3,4,6,7,8,9,38]))),se=o.lazy(()=>d(()=>import("./index-9SovhHlM.js").then(e=>e.i),__vite__mapDeps([39,1,2,15,8,16,17,40,41,42,43,6,7,12,44,45]))),re=o.lazy(()=>d(()=>import("./index-C6s8HaTz.js"),__vite__mapDeps([46,1,2,11,8,29,4,30,47,48,49,50,12,15,16,17,51,52,53,54,55,56]))),ie=o.lazy(()=>d(()=>import("./index-pHMiDKZK.js"),__vite__mapDeps([57,1,2,12,13,58]))),oe=o.lazy(()=>d(()=>import("./index-VtFgTwGr.js"),__vite__mapDeps([59,1,2,15,8,16,17,40,41,42,60,6,7,13,43,12,61]))),le=({instance:e,packageCount:a,packagesLoading:t,usnCount:r,usnLoading:u,kernelCount:g,kernelLoading:i})=>{const{closeSidePanel:c}=w(),{tab:p,setPageParams:_}=q(),s=p?`tab-link-${p}`:"tab-link-info",l=G({activeTabId:s,instance:e,onActiveTabChange:m=>{_({tab:m.replace("tab-link-","")}),c()},packageCount:a,packagesLoading:t,usnCount:r,usnLoading:u,kernelCount:g,kernelLoading:i});return n.jsxs(n.Fragment,{children:[n.jsx(b.Tabs,{listClassName:"u-no-margin--bottom",links:l}),n.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":s,className:J.tabPanel,children:n.jsxs(o.Suspense,{fallback:n.jsx(h,{}),children:[s==="tab-link-info"&&n.jsx(X,{instance:e}),s==="tab-link-wsl"&&n.jsx(ae,{instance:e}),s==="tab-link-activities"&&n.jsx(ne,{instanceId:e.id}),s==="tab-link-kernel"&&n.jsx(te,{instanceTitle:e.title}),s==="tab-link-security-issues"&&n.jsx(re,{instance:e}),s==="tab-link-packages"&&n.jsx(ee,{}),s==="tab-link-snaps"&&n.jsx(oe,{}),s==="tab-link-processes"&&n.jsx(Y,{}),s==="tab-link-ubuntu-pro"&&n.jsx(ie,{instance:e}),s==="tab-link-users"&&n.jsx(se,{}),s==="tab-link-hardware"&&n.jsx(Z,{instance:e})]})})]})},ce=e=>{if(e)return e.parent?[{label:"Instances",path:"/instances"},{label:e.parent.title,path:`/instances/${e.parent.id}`},{label:e.title,current:!0}]:[{label:"Instances",path:"/instances"},{label:e.title,current:!0}]},de=e=>{if(!(!e||e.length===0||!e[0].Livepatch.Fixes))return e[0].Livepatch.Fixes.length},ue=(e,a)=>e.distribution?a:0,pe=(e,a)=>e.distribution?a:0,be=e=>(e==null?void 0:e.title)??"",ge=(e,a)=>parseInt(a||(e??"")),_e=(e,a,t)=>!!e&&(!a||a===t),me=(e,a,t)=>{var r;return!!(e!=null&&e.distribution)&&/\d{1,2}\.\d{2}/.test(e.distribution)&&(!t||((r=e.parent)==null?void 0:r.id)===parseInt(a??""))},he=(e,a,t)=>{var r;return!!(e!=null&&e.distribution)&&/\d{1,2}\.\d{2}/.test(e.distribution)&&(!t||((r=e.parent)==null?void 0:r.id)===parseInt(a??""))},xe=(e,a,t)=>{var r;return!!(e!=null&&e.distribution)&&/\d{1,2}\.\d{2}/.test(e.distribution)&&(!t||((r=e.parent)==null?void 0:r.id)===parseInt(a??""))},je=e=>e?[e.id]:[],v=e=>e?e.id:0,ke=(e,a,t)=>e&&(!t||e.parent&&e.parent.id===parseInt(a??"")),ye="_container_pnq0d_1",Ie={container:ye},fe=o.lazy(()=>d(()=>import("./index-CzqhOH16.js"),__vite__mapDeps([62,1,2,14,11,15,8,16,17,18,19,4,12,20,13,63,34,35,29,30,3,64]))),Pe=o.lazy(()=>d(()=>import("./index-DA1G6WD8.js"),__vite__mapDeps([65,1,2,14,11,15,8,16,17,18,19,4,12,20,13,66,63,34,35,29,30,3,67]))),Ee=o.lazy(()=>d(()=>import("./index-BvtMf1hP.js"),__vite__mapDeps([68,1,2,14,11,15,8,16,17,18,19,4,12,20,3,13,66,34,35,29,30,67]))),Qe=({instanceName:e,hasTableData:a,kernelStatuses:t})=>{var s;const{setSidePanelContent:r}=w(),u=((s=t==null?void 0:t.installed)==null?void 0:s.version_rounded)??"",g=(t==null?void 0:t.downgrades)??[],i=(t==null?void 0:t.upgrades)??[],c=()=>{r("Downgrade kernel",n.jsx(o.Suspense,{fallback:n.jsx(h,{}),children:n.jsx(fe,{instanceName:e,currentKernelVersion:u,downgradeKernelVersions:g})}))},p=()=>{r("Upgrade kernel",n.jsx(o.Suspense,{fallback:n.jsx(h,{}),children:n.jsx(Pe,{instanceName:e,currentKernelVersion:u,upgradeKernelVersions:i})}))},_=()=>{var l;r(`Restart ${e}`,n.jsx(o.Suspense,{fallback:n.jsx(h,{}),children:n.jsx(Ee,{instanceName:e,showNotification:a,newKernelVersionId:(l=i[0])==null?void 0:l.id})}))};return n.jsxs("div",{className:Ie.container,children:[n.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:"Kernel overview"}),n.jsx("div",{className:"p-segmented-control",children:n.jsxs("div",{className:"p-segmented-control__list",children:[n.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:_,children:[n.jsx(b.Icon,{name:"restart"}),n.jsx("span",{children:"Restart instance"})]}),n.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:g.length===0,onClick:c,children:[n.jsx(b.Icon,{name:"begin-downloading"}),n.jsx("span",{children:"Downgrade kernel"})]}),n.jsxs(b.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:i.length===0,onClick:p,children:[n.jsx(b.Icon,{name:"change-version"}),n.jsx("span",{children:"Upgrade kernel"})]})]})},"buttons")]})};function ve(){const e=D(),a=Q(),t=({id:i},c={})=>E({queryKey:["kernel",i],queryFn:()=>e.get(`computers/${i}/livepatch/kernel`),...c}),r=({id:i,...c},p={})=>E({queryKey:["kernel",{id:i,...c}],queryFn:()=>e.get(`computers/${i}/livepatch/info`,{params:c}),...p}),u=P({mutationKey:["kernel","downgrade"],mutationFn:({id:i,...c})=>e.post(`computers/${i}/kernel/downgrade`,c),onSuccess:()=>a.invalidateQueries({queryKey:["kernel"]})}),g=P({mutationKey:["kernel","upgrade"],mutationFn:({id:i,...c})=>e.post(`computers/${i}/kernel/upgrade`,c),onSuccess:()=>a.invalidateQueries({queryKey:["kernel"]})});return{getKernelQuery:t,getLivepatchInfoQuery:r,downgradeKernelQuery:u,upgradeKernelQuery:g}}const Le=()=>{var y,I,f;const{instanceId:e,childInstanceId:a}=V(),{user:t}=C(),r=L(),{getSingleInstanceQuery:u}=S(),{getUsnsQuery:g}=B(),{getInstancePackagesQuery:i}=U(),{getLivepatchInfoQuery:c}=ve(),p=o.useRef("");o.useEffect(()=>{t!=null&&t.current_account&&(p.current||(p.current=t.current_account),p.current!==t.current_account&&r("/instances",{replace:!0}))},[t==null?void 0:t.current_account]);const{data:_,isLoading:s}=u({instanceId:ge(e,a),with_annotations:!0,with_grouped_hardware:!0},{enabled:_e(e,p.current,t==null?void 0:t.current_account)}),l=(_==null?void 0:_.data)??null,{data:m,isLoading:T}=g({computer_ids:je(l),limit:1},{enabled:xe(l,e,a)}),{data:x,isLoading:K}=i({available:!1,upgrade:!0,instance_id:v(l),limit:1},{enabled:me(l,e,a)}),{data:j,isLoading:F}=c({id:v(l)},{enabled:he(l,e,a)}),A=de((f=(I=(y=j==null?void 0:j.data.livepatch_info)==null?void 0:y.json)==null?void 0:I.output)==null?void 0:f.Status),k=ke(l,e,a);return n.jsxs(O,{children:[n.jsx(z,{title:be(l),hideTitle:!0,breadcrumbs:ce(l)}),n.jsx(N,{children:s?n.jsx(h,{}):n.jsxs(n.Fragment,{children:[!k&&n.jsx($,{childInstanceId:a,instanceId:e}),l&&k&&n.jsx(le,{instance:l,packageCount:ue(l,Number(x==null?void 0:x.data.count)),packagesLoading:K,usnCount:pe(l,Number(m==null?void 0:m.data.count)),usnLoading:T,kernelCount:l.distribution?A:0,kernelLoading:F})]})})]})},Ve=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));export{Qe as K,Ve as i,ve as u};
