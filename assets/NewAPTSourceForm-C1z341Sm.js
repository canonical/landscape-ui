import{c as x,b as G,j as r,d as s}from"./index-CQs3wXys.js";import{u as A}from"./formik.esm-C_3GEhhV.js";import{c as k,a}from"./index.esm-85kEx3I1.js";import{u as v}from"./useAPTSources-DZCujNji.js";import{u as j}from"./useGPGKeys-86KEEJsT.js";import{u as F}from"./useRoles-DHn7bJnc.js";import{t as n}from"./tests-DFnZqbNV.js";import{S as T}from"./SidePanelFormButtons-CTKwSU1t.js";import"./useFetchOld-D-5JyUuM.js";import"./useMutation-D9dT1mhA.js";import"./useQuery-DrwXjJzc.js";import"./SidePanelFormButtons.module-CoxOjuX8.js";const D=()=>{const{closeSidePanel:l}=x(),p=G(),{createAPTSourceQuery:m,getAPTSourcesQuery:d}=v(),{getGPGKeysQuery:g}=j(),{data:i,isLoading:b}=g(),{getAccessGroupQuery:y}=F(),{data:u,isLoading:_}=y(),P=((u==null?void 0:u.data)??[]).map(t=>({label:t.title,value:t.name})),S=((i==null?void 0:i.data)??[]).filter(({has_secret:t})=>t).map(({name:t})=>({label:t,value:t})),{mutateAsync:h,isLoading:f}=m,{data:o}=d(),e=A({initialValues:{name:"",apt_line:"",gpg_key:"",access_group:""},validationSchema:k().shape({name:a().required("This field is required").test({test:n.test,message:n.message}).test({params:{getAPTSourcesResponse:o},test:t=>!((o==null?void 0:o.data)??[]).map(({name:c})=>c).includes(t),message:"It must be unique within the account."}),apt_line:a().required("This field is required"),gpg_key:a(),access_group:a()}),onSubmit:async t=>{try{await h(t),l()}catch(c){p(c)}}});return r.jsxs(s.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[r.jsx(s.Input,{type:"text",label:"Name",required:!0,error:e.touched.name&&e.errors.name?e.errors.name:void 0,...e.getFieldProps("name")}),r.jsx(s.Input,{type:"text",label:"APT Line",required:!0,error:e.touched.apt_line&&e.errors.apt_line?e.errors.apt_line:void 0,...e.getFieldProps("apt_line")}),r.jsx(s.Select,{label:"GPG key",disabled:b,options:[{label:"Select GPG key",value:""},...S],...e.getFieldProps("gpg_key"),error:e.touched.gpg_key&&e.errors.gpg_key?e.errors.gpg_key:void 0}),r.jsx(s.Select,{label:"Access group",disabled:_,options:[{label:"Select access group",value:""},...P],...e.getFieldProps("access_group"),error:e.touched.access_group&&e.errors.access_group?e.errors.access_group:void 0}),r.jsx(T,{submitButtonDisabled:f,submitButtonText:"Add APT Source"})]})};export{D as default};
