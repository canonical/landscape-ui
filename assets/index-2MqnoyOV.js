import{y as D,z as T,x as N,j as t,d as l,e as b,R,o as h,J as A}from"./index-CNSDWj8Q.js";import{I as a}from"./InfoGrid-3w5mqARw.js";import{S as E}from"./StaticLink-BEYCGcPv.js";import{u as Q}from"./useGetInstance-BgZN2sNQ.js";import"./InstancesPageActions-DL7_pmR1.js";import"./index-CySvbr4l.js";import{u as j,b as x}from"./index-D-YBZSy_.js";import"./InfoItem-Bt7JBIPo.js";import"./NoData-6ZK9sV5u.js";import"./Truncated-Dtg97i8C.js";import"./useFetchOld-BAAs34Op.js";import"./ListTitle-BUruUKn1.js";import"./ResponsiveTable-BXalKviy.js";import"./TruncatedCell-BMum6DLZ.js";import"./useExpandableRow-B4jhRgod.js";import"./TextConfirmationModal-q88mH05g.js";import"./TablePagination-CFXNvqsZ.js";import"./TableFilterChips-06YfpJdc.js";import"./PageParamFilter-ChSwlZqZ.js";import"./TableFilter-2AKF5NjJ.js";import"./formikErrors-Bw8iTXYS.js";const M="_statusIcon_285mx_1",U="_output_285mx_5",_={statusIcon:M,output:U},Y=({activity:e})=>{const r=D(),{notify:n}=T(),{closeSidePanel:c}=N(),{approveActivitiesQuery:d,cancelActivitiesQuery:m,redoActivitiesQuery:p,undoActivitiesQuery:u}=j(),{mutateAsync:y,isPending:i}=d,{mutateAsync:I,isPending:v}=m,{mutateAsync:B,isPending:f}=p,{mutateAsync:C,isPending:g}=u,L=async o=>{try{await y({query:`id:${o.id}`}),c(),n.success({title:"You have successfully approved an activity.",message:"This activity will be delivered the next time the Landscape server connects with the client."})}catch(s){r(s)}},S=async o=>{try{await I({query:`id:${o.id}`}),c(),n.success({title:"You have successfully canceled an activity.",message:"This activity won't be delivered to the client and will not run."})}catch(s){r(s)}},w=async o=>{try{await B({activity_ids:[o.id]}),c(),n.success({title:"You have successfully redone an activity.",message:"An activity has been queued to re-run this activity."})}catch(s){r(s)}},P=async o=>{try{await C({activity_ids:[o.id]}),c(),n.success({title:"You have successfully undone an activity.",message:"An activity has been queued to revert the changes delivered by this activity."})}catch(s){r(s)}};return t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[e.actions?.approvable&&t.jsx(l.ConfirmationButton,{className:"p-segmented-control__button u-no-margin",type:"button",disabled:i,confirmationModalProps:{title:"Approve activity",children:t.jsxs("p",{children:["Are you sure you want to approve ",e.summary," activity?"]}),confirmButtonLabel:"Approve",confirmButtonAppearance:"positive",confirmButtonDisabled:i,confirmButtonLoading:i,onConfirm:async()=>L(e)},children:"Approve"}),e.actions?.cancelable&&t.jsx(l.ConfirmationButton,{className:"p-segmented-control__button u-no-margin",type:"button",disabled:v,confirmationModalProps:{title:"Cancel activity",children:t.jsxs("p",{children:["Are you sure you want to cancel ",e.summary," activity?"]}),confirmButtonLabel:"Confirm",confirmButtonAppearance:"negative",confirmButtonDisabled:v,confirmButtonLoading:v,onConfirm:async()=>S(e)},children:!e.actions?.approvable&&!e.actions?.reappliable&&!e.actions?.revertable?"Cancel activity":"Cancel"}),e.actions?.revertable&&t.jsx(l.ConfirmationButton,{className:"p-segmented-control__button u-no-margin",type:"button",disabled:g,confirmationModalProps:{title:"Undo activity",children:t.jsxs("p",{children:["Are you sure you want to undo ",e.summary," activity?"]}),confirmButtonLabel:"Undo",confirmButtonAppearance:"positive",confirmButtonDisabled:g,confirmButtonLoading:g,onConfirm:async()=>P(e)},children:"Undo"}),e.actions?.reappliable&&t.jsx(l.ConfirmationButton,{className:"p-segmented-control__button u-no-margin",type:"button",disabled:f,confirmationModalProps:{title:"Redo activity",children:t.jsxs("p",{children:["Are you sure you want to redo ",e.summary," activity?"]}),confirmButtonLabel:"Redo",confirmButtonAppearance:"positive",confirmButtonDisabled:f,confirmButtonLoading:f,onConfirm:async()=>w(e)},children:"Redo"})]})},"buttons")},rt=({activityId:e})=>{const{getSingleActivityQuery:r}=j(),{data:n,isPending:c,error:d}=r({activityId:e}),m=n?.data.computer_id,p=m!==void 0,{instance:u,isGettingInstance:y}=Q({instanceId:m},{enabled:p});if(c)return t.jsx(b,{});if(d)throw d;if(!n?.data)throw new Error;if(p&&y)return t.jsx(b,{});const i=n.data;return t.jsxs(t.Fragment,{children:[t.jsx(Y,{activity:i}),t.jsxs(a,{spaced:!0,children:[t.jsx(a.Item,{label:"Description",large:!0,value:i.summary}),u&&t.jsx(a.Item,{label:"Instance",large:!0,value:t.jsx(E,{to:R.instances.details.fromInstance(u),children:u.title})}),t.jsx(a.Item,{label:"Status",value:t.jsxs(t.Fragment,{children:[t.jsx(l.Icon,{name:x[i.activity_status].icon,className:_.statusIcon}),t.jsx("span",{children:x[i.activity_status].label})]})}),t.jsx(a.Item,{label:"Created at",value:h(i.creation_time).format(A)}),typeof i.delivery_time=="string"&&t.jsx(a.Item,{label:"Delivered at",value:h(i.delivery_time).format(A)}),i.completion_time!==null&&t.jsx(a.Item,{label:"Completed at",value:h(i.completion_time).format(A)})]}),i.result_text&&t.jsx(l.CodeSnippet,{className:_.output,blocks:[{title:"Output",code:i.result_text}]})]})};export{rt as default};
