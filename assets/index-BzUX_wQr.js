import{c as S,l as _,r as x,j as t,a4 as p,L as g,x as j,D as m,d as e,q as v,E as y,I as r,N as d}from"./index-DC4Jl2A5.js";import{S as f}from"./SidePanelTablePagination-CkLmznaY.js";import{b as A}from"./ScriptsTabs-DjT28N9C.js";import"./index-zybXurRT.js";import{u as C}from"./useRoles-Chl-pzmO.js";import{g as T,a as I,S as N}from"./index-BNhGechW.js";import"./HeaderWithSearch-qj64H8KA.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./useExpandableRow-3riDRkYo.js";const P=({id:s,...i})=>{const a=S(),{data:n,isLoading:c}=_({queryKey:["scriptProfileActivities",{id:s,...i}],queryFn:async()=>a.get(`script-profiles/${s}/activities`,{params:i})});return{activities:(n==null?void 0:n.data.results)??[],activitiesCount:n==null?void 0:n.data.count,isGettingActivities:c}},L=({activities:s})=>{const i=x.useMemo(()=>[{Header:"Run",accessor:"creation_time",Cell:({row:{original:a}})=>t.jsx(g,{className:"font-monospace",to:`/activities?query=parent-id%3A${a.id}`,children:j(a.creation_time).utc().format(m)})},{Header:"Status",accessor:"activity_status",Cell:({row:{original:a}})=>p[a.activity_status].label,getCellIcon:({row:{original:a}})=>p[a.activity_status].icon}],[s]);return t.jsx(e.ModularTable,{columns:i,data:s})},w=({profile:s})=>{const[i,a]=x.useState(1),[n,c]=x.useState(20),{activities:l,activitiesCount:u,isGettingActivities:o}=P({id:s.id,limit:n,offset:(i-1)*n});return o?t.jsx(v,{}):l.length?t.jsxs(t.Fragment,{children:[t.jsx(L,{activities:l}),t.jsx(f,{currentPage:i,pageSize:n,paginate:a,setPageSize:c,totalItems:u})]}):t.jsx(y,{title:"No runs found",body:"The profile has not run yet."})},z=({actions:s,profile:i})=>i.archived?t.jsxs(e.Notification,{inline:!0,title:"Profile archived:",severity:"caution",children:["The profile was archived on"," ",j(i.last_edited_at).format(m),"."]}):t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[t.jsxs(e.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:s.edit,children:[t.jsx(e.Icon,{name:"edit"}),t.jsx("span",{children:"Edit"})]}),t.jsxs(e.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:s.archive,children:[t.jsx(e.Icon,{name:"archive"}),t.jsx("span",{children:"Archive"})]})]})}),R=({profile:s})=>{var h;const{script:i,isScriptLoading:a}=A(s.script_id),{getAccessGroupQuery:n}=C(),{data:c,isLoading:l}=n();if(a||l)return t.jsx(v,{});const u=((h=c==null?void 0:c.data.find(b=>b.name==s.access_group))==null?void 0:h.title)||s.access_group,o=s.activities.last_activity;return t.jsxs(t.Fragment,{children:[t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Title",value:s.title})}),t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Status",value:T(s)})})]}),t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Script",value:i?t.jsx(g,{to:"/scripts?tab=scripts",state:{scriptId:i.id},children:i.title}):t.jsx(d,{})})}),t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Access group",value:u})})]}),t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Run as user",value:s.username})}),t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Time limit",value:`${s.time_limit}s`})})]}),t.jsx("hr",{}),t.jsx(r,{label:"Trigger",value:I(s)||t.jsx(d,{})}),t.jsxs(e.Row,{className:"u-no-padding",children:[s.trigger.trigger_type!="event"&&t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Next run",value:s.trigger.next_run?`${j(s.trigger.next_run).utc().format(m)}`:t.jsx(d,{})})}),t.jsx(e.Col,{size:6,children:t.jsx(r,{label:"Last run",value:o?t.jsx(g,{to:`/activities?query=parent-id%3A${o.id}`,children:j(o.creation_time).utc().format(m)}):t.jsx(d,{})})})]}),t.jsx("hr",{}),t.jsx("p",{className:"p-heading--5",children:"Association"}),t.jsx(e.Row,{className:"u-no-padding",children:t.jsx(r,{label:"Associated instances",value:t.jsx(N,{scriptProfile:s})})}),t.jsx(e.Row,{className:"u-no-padding",children:t.jsx(r,{label:"Tags",value:s.all_computers?"All instances":s.tags.join(", ")||t.jsx(d,{})})})]})},B=({actions:s,profile:i})=>{const[a,n]=x.useState("info"),l=[{label:"Info",id:"info"},{label:"Activity history",id:"activity-history"}].map(({label:u,id:o})=>({label:u,active:a==o,onClick:()=>{n(o)}}));return t.jsxs(t.Fragment,{children:[t.jsx(z,{actions:s,profile:i}),t.jsx(e.Tabs,{listClassName:"u-no-margin--bottom",links:l}),a=="info"&&t.jsx(R,{profile:i}),a=="activity-history"&&t.jsx(w,{profile:i})]})};export{B as default};
