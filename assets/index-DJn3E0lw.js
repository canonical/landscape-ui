const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-soCUQ3-_.js","assets/index-Cw5WBMVF.js","assets/index-CZSrOujQ.css","assets/SidePanelFormButtons-DVp3d0Zl.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/useRoles-DeUaYioH.js"])))=>i.map(i=>d[i]);
import{H as g,a2 as x,K as p,c as f,C as S,j as e,n as u,al as L,L as P,x as v,A as N,ai as T,am as w,r as d,ae as k,N as F,m as j,p as m,E,$ as A}from"./index-Cw5WBMVF.js";import{P as M,a as D,b as I}from"./PageMain-YNWx54qf.js";import{u as C}from"./useRoles-DeUaYioH.js";import{G as $}from"./GroupFilter-DoIJiGwY.js";import{F as G}from"./InstancesPageActions-n8_mgW7J.js";import{u as O}from"./useInstances-YfJMlPqN.js";const ce={title:"",parent:x},ie=g().shape({title:p().required("This field is required"),parent:p().required("This field is required")}),B="_container_vxbz8_1",H="_searchContainer_vxbz8_11",h={container:B,searchContainer:H},R=()=>{const{search:s,setPageParams:n}=f(),a=()=>{n({search:o.values.searchText})},c=()=>{n({search:""})},o=S({initialValues:{searchText:s},enableReinitialize:!0,validationSchema:g().shape({search:p()}),onSubmit:a}),t=G.groupBy.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:h.container,children:[e.jsx("div",{className:h.searchContainer,children:e.jsx(u.Form,{onSubmit:o.handleSubmit,noValidate:!0,children:e.jsx(u.SearchBox,{autocomplete:"off",externallyControlled:!0,value:o.values.searchText,onChange:async i=>await o.setFieldValue("searchText",i),placeholder:"Search",onSearch:a,onClear:c})})}),e.jsx($,{options:t},"group-by-filter")]}),e.jsx(L,{filtersToDisplay:["search"]})]})},V="_link_1wvsk_1",z={link:V},q=({accessGroup:s})=>{const{getInstancesQuery:n}=O(),{data:a,isPending:c}=n({query:`access-group: ${s.name}`,root_only:!1,with_alerts:!0,with_upgrades:!0,limit:1});if(a!=null&&a.data&&s.instancesCount!==a.data.count&&(s.instancesCount=a.data.count||0),c)return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"u-off-screen",children:"Loading..."}),e.jsx(u.Spinner,{"aria-hidden":!0})]});const o=a==null?void 0:a.data.count;return o?e.jsxs(P,{className:z.link,to:`/instances?accessGroups=${s.name}`,children:[o," ",v(o,"instance")]}):"0 instances"},U=({accessGroup:s})=>{const n=N(),{removeAccessGroupQuery:a}=C(),{value:c,setTrue:o,setFalse:t}=T(),{mutateAsync:i,isPending:l}=a,r=async()=>{try{await i({name:s.name})}catch(y){n(y)}finally{t()}};return e.jsxs(e.Fragment,{children:[e.jsx(w,{toggleAriaLabel:`${s.title} access group actions`,destructiveActions:[{icon:"delete",label:"Delete","aria-label":`Delete "${s.title}" access group`,onClick:o}]}),c&&e.jsx(u.ConfirmationModal,{title:`Deleting ${s.title} access group`,confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:l,confirmButtonLoading:l,onConfirm:r,close:t,children:e.jsx("p",{children:"Are you sure?"})})]})},K=s=>{const n={};switch(s.column.id){case"title":n.role="rowheader";break;case"name":n["aria-label"]="Name";break;case"instancesCount":n["aria-label"]="Instances count";break;case"parent":n["aria-label"]="Parent";break;case"id":n["aria-label"]="Actions";break}return n},b=(s,n)=>{const a=n.find(c=>c.name===s);return a&&a.parent?[a,...b(a.parent,n)]:a?[a]:[]},_=(s,n)=>n.filter(a=>a.parent===s).map(a=>({...a,instancesCount:0,subRows:_(a.name,n)})),Y=({accessGroups:s})=>{const{groupBy:n,search:a}=f(),c=d.useMemo(()=>{const t=a?s.filter(r=>r.name.toLowerCase().includes(a.toLowerCase())||r.title.toLowerCase().includes(a.toLowerCase())):s;if(n!=="parent")return t.map(r=>({...r,instancesCount:0}));const i=Array.from(new Set([...t,...t.flatMap(r=>b(r.parent||"",s))])),l=new Set(i.filter(r=>r.parent).map(r=>r.name));return i.filter(r=>!l.has(r.name)).map(r=>({...r,instancesCount:0,subRows:_(r.name,i)}))},[s,a,n]),o=d.useMemo(()=>[{accessor:"title",Header:"title",Cell:({row:t})=>e.jsx("div",{style:{paddingLeft:`${t.depth*1.25}rem`},children:e.jsx("span",{children:t.original.title})})},{accessor:"name",Header:"name"},{accessor:"instancesCount",Header:"affected instances",sortType:(t,i)=>t.original.instancesCount-i.original.instancesCount,Cell:({row:t})=>e.jsx(q,{accessGroup:t.original})},{accessor:"parent",Header:"parent",Cell:({row:{original:t}})=>{var l;return((l=s.find(r=>r.name===t.parent))==null?void 0:l.title)||e.jsx(F,{})}},{...k,Cell:({row:t})=>t.original.name===x?null:e.jsx(U,{accessGroup:t.original})}],[n,s]);return e.jsx(e.Fragment,{children:e.jsx(u.ModularTable,{columns:o,data:c,sortable:!0,getCellProps:K,emptyMsg:"No access groups found according to your search parameters."})})},J=d.lazy(()=>A(()=>import("./index-soCUQ3-_.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6]))),Q=()=>{const{getAccessGroupQuery:s}=C(),{setSidePanelContent:n}=j(),{data:a,isPending:c}=s(),o=(a==null?void 0:a.data)||[],t=()=>{n("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(m,{}),children:e.jsx(J,{})}))};return e.jsxs(e.Fragment,{children:[c&&e.jsx(m,{}),!c&&o.length===0&&e.jsx(E,{title:"No access groups found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any access groups yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/access-groups",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage access groups in Landscape"})]}),cta:[e.jsx(u.Button,{appearance:"positive",onClick:t,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),!c&&o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsx(Y,{accessGroups:o})]})]})},W="_header_116wp_1",X={header:W},Z=d.lazy(()=>A(()=>import("./index-soCUQ3-_.js").then(s=>s.a),__vite__mapDeps([0,1,2,3,4,5,6])).then(s=>({default:s.NewAccessGroupForm}))),ee=()=>{const{setSidePanelContent:s}=j(),n=()=>{s("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(m,{}),children:e.jsx(Z,{})}))};return e.jsxs(M,{children:[e.jsx(D,{className:X.header,title:"Access groups",actions:[e.jsx(u.Button,{appearance:"positive",onClick:n,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),e.jsx(I,{children:e.jsx(Q,{})})]})},le=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{Q as A,ce as I,ie as V,le as i};
