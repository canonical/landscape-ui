const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CBngzlSJ.js","assets/index-D0eLLMjG.js","assets/index-CMPBhKCb.css","assets/SidePanelFormButtons-C-BZcwoC.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useGPGKeys-S9HrrjtY.js","assets/tests-DFnZqbNV.js","assets/useRoles-DO9PSQ2F.js","assets/useAPTSources-41qdg1ah.js","assets/PageMain-CkxG3P6U.js","assets/PageMain-C_v2-kHh.css","assets/constants-D7yXN3Pr.js","assets/TextConfirmationModal-BXLfp-SY.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/RepositoryProfileListActions-DRQysbBA.js","assets/ModalTablePagination-CcJ1mxS8.js","assets/ModalTablePagination-HDr0Q-Wm.css","assets/constants-BU1sz6pu.js","assets/constants-BnrFFkRy.css","assets/index-Cz9CfuJq.css"])))=>i.map(i=>d[i]);
import{d as P,l as x,i as y,k as j,n as i,j as e,a as u,e as c,a8 as d,q as v,s as _,a7 as S,a0 as M,a4 as L,aB as N,p as C,E as w,_ as F}from"./index-D0eLLMjG.js";import{P as R,a as k,b as O}from"./PageMain-CkxG3P6U.js";import{L as D}from"./constants-D7yXN3Pr.js";import{T as E}from"./TextConfirmationModal-BXLfp-SY.js";import{u as I}from"./RepositoryProfileListActions-DRQysbBA.js";import{M as B}from"./ModalTablePagination-CcJ1mxS8.js";import"./constants-BU1sz6pu.js";const G=s=>{const o=P(),{data:t,isPending:r}=x({queryKey:["aptSources",s],queryFn:()=>o.get("repository/apt-source",{params:s})});return{aptSources:t?.data.results??[],isGettingAPTSources:r}},H=()=>{const s=P(),o=y(),{mutateAsync:t,isPending:r}=j({mutationKey:["aptSources","remove"],mutationFn:({id:n,...a})=>s.delete(`repository/apt-source/${n}`,{params:a}),onSuccess:()=>o.invalidateQueries({queryKey:["aptSources"]})});return{removeAPTSource:t,isRemovingAPTSource:r}},$=({repositoryProfilesResult:{isPending:s,data:o,error:t},goToNextPage:r,goToPreviousPage:n,pageNumber:a})=>{const l=i.useMemo(()=>[{Header:"Repository profile",accessor:"title"}],[]);return s?e.jsx(u,{}):o?e.jsxs(e.Fragment,{children:[e.jsx(c.ModularTable,{columns:l,data:o.data.results}),e.jsx(B,{current:a,max:Math.ceil(o.data.count/d),onNext:r,onPrev:n})]}):e.jsxs(c.Notification,{severity:"negative",children:['The associated repository profiles could not be loaded due to an unexpected error: "',t.message,'"']})},q=({aptSource:s,close:o,opened:t})=>{const{removeAPTSource:r,isRemovingAPTSource:n}=H(),{getRepositoryProfilesQuery:a}=I(),l=v(),{notify:f}=_(),{count:p,decrement:h,increment:A}=S(1),m=a({limit:d,offset:(p-1)*d,search:s.profiles},{enabled:!!s.profiles.length&&t}),T=async()=>{try{await r({id:s.id,disassociate_profiles:!0}),f.success({title:`You have successfully deleted the ${s.name} APT source.`,message:s.profiles.length?"It will no longer be available and it has been removed from its associated profiles.":"It will no longer be available to include in repository profiles."})}catch(b){l(b)}finally{o()}};return e.jsx(E,{className:"is-narrow",close:o,title:`Deleting ${s.name} APT source`,confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonLoading:n,confirmButtonDisabled:!!s.profiles.length&&m.isPending,onConfirm:T,isOpen:t,confirmationText:`delete ${s.name}`,children:s.profiles.length?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This APT source belongs to the following repository profiles."}),e.jsxs("p",{children:["If this source is deleted, it will no longer be included in its profiles. ",e.jsx("strong",{children:"This action is irreversible."})]}),e.jsx($,{repositoryProfilesResult:m,goToNextPage:A,goToPreviousPage:h,pageNumber:p})]}):e.jsxs("p",{children:["If this APT source is deleted, it will no longer be available to include in repository profiles."," ",e.jsx("strong",{children:"This action is irreversible."})]})})},Q=({aptSource:s})=>{const{value:o,setTrue:t,setFalse:r}=M();return e.jsxs(e.Fragment,{children:[e.jsx(L,{toggleAriaLabel:`${s.name} APT source actions`,destructiveActions:[{icon:c.ICONS.delete,label:"Delete","aria-label":`Remove ${s.name} APT source`,onClick:t}]}),e.jsx(q,{aptSource:s,close:r,opened:o})]})},K="_line_1odl9_1",z="_accessGroup_1odl9_10",g={line:K,accessGroup:z},U=s=>{const o={};switch(s.column.id){case"name":o.role="rowheader";break;case"access_group":o["aria-label"]="Access group";break;case"line":o["aria-label"]="Line";break;case"id":o["aria-label"]="Actions";break}return o},Y=({items:s})=>{const o=i.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"access_group",Header:"Access group",className:g.accessGroup},{accessor:"line",Header:"Line",className:g.line},{...D,Cell:({row:t})=>e.jsx(Q,{aptSource:t.original})}],[]);return e.jsx(N,{columns:o,data:i.useMemo(()=>s,[s.length]),emptyMsg:"No APT sources yet.",getCellProps:U})},V=i.lazy(async()=>F(()=>import("./index-CBngzlSJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20])).then(s=>({default:s.NewAPTSourceForm}))),Z=()=>{const{setSidePanelContent:s}=C(),{aptSources:o,isGettingAPTSources:t}=G(),r=()=>{s("Add APT source",e.jsx(i.Suspense,{fallback:e.jsx(u,{}),children:e.jsx(V,{})}))};return e.jsxs(R,{children:[e.jsx(k,{title:"APT sources",actions:[e.jsx(c.Button,{appearance:"positive",onClick:r,type:"button",children:"Add APT source"},"new-key-button")]}),e.jsxs(O,{children:[t&&e.jsx(u,{}),!t&&o.length===0&&e.jsx(w,{title:"No APT sources found",icon:"connected",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You havenâ€™t added any APT sources yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage APT sources in Landscape"})]}),cta:[e.jsx(c.Button,{appearance:"positive",onClick:r,type:"button",children:"Add APT source"},"table-add-new-mirror")]}),!t&&o.length>0&&e.jsx(Y,{items:o})]})]})},re=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));export{Y as A,H as a,re as i,G as u};
