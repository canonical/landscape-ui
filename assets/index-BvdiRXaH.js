const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CM6d2_eE.js","assets/index-B7TA2mEJ.js","assets/index-DM5072WT.css","assets/SidePanelTablePagination-Cc-ESw9P.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/PageMain-FFmGKqeV.js","assets/PageMain-BIuYvhUI.css","assets/useDistributions-Bf8bcUIv.js","assets/useFetchOld-CJ7nhgRY.js","assets/InfoItem-BGbjg2ci.js","assets/InfoItem-C-lWh_lY.css","assets/moment-C5S46NFB.js","assets/NoData-CEdbf9On.js","assets/index-_nOAvVrS.js","assets/moment-XwcdBKy1.js","assets/TablePagination-DWlHKziY.js","assets/usePageParams-BUsG_p4E.js","assets/SearchHelpPopup-DQ0iOBxi.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/index-BmoMXq9B.css","assets/DistributionCard.module-BJwqEI-8.js","assets/DistributionCard-Bupv9j-d.css","assets/index-BqjlXzq9.css","assets/EditPocketForm-42Rz7w5Q.js","assets/series-CBgL5ULK.js","assets/series-Doyz0RCU.css","assets/debug-BRXablwr.js","assets/debug-D65W9S9l.css","assets/MultiSelectField-BpvtVxIK.js","assets/MultiSelectField-DOBW8uWL.css","assets/SidePanelFormButtons-XYVE_s1x.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/useGPGKeys-Cvivy6p8.js","assets/NewPocketForm-BddbOH6F.js","assets/tests-DFnZqbNV.js","assets/DeriveSeriesForm-0XVTY7JD.js","assets/index-CZS4Jvy0.js","assets/NewDistributionForm-C384iTH4.js","assets/useRoles-CM-oV7aq.js"])))=>i.map(i=>d[i]);
import{z as w,i as D,r as d,N as U,j as e,G as W,g as v,h as l,_ as S,s as P,c as z,e as j,f as E,k as K,C as T,D as Y,A as Z,E as J}from"./index-B7TA2mEJ.js";import{P as X,a as ee,b as se}from"./PageMain-FFmGKqeV.js";import{u as O}from"./useDistributions-Bf8bcUIv.js";import{I as Q}from"./InfoItem-BGbjg2ci.js";import{h as G}from"./moment-C5S46NFB.js";import{N as te}from"./NoData-CEdbf9On.js";import{a as V,b as ne}from"./index-_nOAvVrS.js";import{u as H}from"./useFetchOld-CJ7nhgRY.js";import{s as $,d as R}from"./DistributionCard.module-BJwqEI-8.js";const ae=s=>!s||s==="synced"||s==="in progress"?"":V[s==="queued"?"undelivered":s].icon,oe="_progressContainer_xxjjr_1",re="_progress_xxjjr_1",ie="_progressBarContainer_xxjjr_11",ce="_progressBar_xxjjr_11",le="_iconContainer_xxjjr_27",N={progressContainer:oe,progress:re,progressBarContainer:ie,progressBar:ce,iconContainer:le},L=({pocket:s,syncPocketRefAdd:t,syncPocketRefs:o})=>{const u=w("(min-width: 620px)"),{setSidePanelContent:i}=D();if(d.useEffect(()=>{s.mode!=="mirror"&&s.mode!=="pull"||!s.last_sync_status||s.last_sync_status!=="in progress"||o.find(({distributionName:m})=>m===s.distribution.name)||t({distributionName:s.distribution.name,seriesName:s.series.name,pocketName:s.name})},[s,o]),s.mode==="upload")return U;if(!s.last_sync_status)return e.jsx(te,{});if(s.last_sync_status==="synced")return G(s.last_sync_time).format(W);if(s.last_sync_status==="in progress")return e.jsxs("div",{className:N.progressContainer,children:[u&&e.jsx("div",{className:N.progressBarContainer,children:e.jsx("div",{className:N.progressBar,style:{width:`${s.last_sync_activity.progress}%`}})}),e.jsx("span",{className:N.progress,children:`${s.last_sync_activity.progress}%`})]});const y=s.last_sync_status==="queued"?"undelivered":s.last_sync_status,r=()=>{i(s.last_sync_activity.summary,e.jsx(ne,{activityId:s.last_sync_activity.id}))};return e.jsxs("div",{className:v("p-table__cell--icon-placeholder",N.iconContainer),children:[e.jsx(l.Icon,{name:ae(s.last_sync_status)}),e.jsx(l.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:r,children:V[y].label})]})},de=d.lazy(()=>S(()=>import("./index-CM6d2_eE.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]))),M=({distributionName:s,pocket:t,seriesName:o})=>{const{setSidePanelContent:u}=D(),i=()=>{u(`${o} ${t.name}`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(de,{distributionName:s,pocket:t,seriesName:o})}))};return e.jsxs(e.Fragment,{children:[e.jsx(l.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:i,"aria-label":`List ${t.name} pocket of ${s}/${o}`,children:t.name}),t.mode==="pull"&&e.jsx("p",{className:"p-text--small u-text--muted u-no-margin--bottom",children:`pulling from ${t.pull_pocket}`})]})};function ue(){const s=z(),t=H(),o=j({mutationKey:["pockets","create"],mutationFn:n=>t.get("CreatePocket",{params:n}),onSuccess:()=>s.invalidateQueries({queryKey:["distributions"]})}),u=j({mutationKey:["pockets","edit"],mutationFn:n=>t.get("EditPocket",{params:n}),onSuccess:()=>s.invalidateQueries({queryKey:["distributions"]})}),i=j({mutationKey:["pockets","remove"],mutationFn:n=>t.get("RemovePocket",{params:n}),onSuccess:()=>s.invalidateQueries({queryKey:["distributions"]})}),y=j({mutationKey:["pocketPackages","sync"],mutationFn:n=>t.get("SyncMirrorPocket",{params:n}),onSuccess:(n,p)=>Promise.all([s.invalidateQueries({queryKey:["pocketPackages",{...p}]}),s.invalidateQueries({queryKey:["distributions"]})])}),r=j({mutationKey:["pocketPackages","pull"],mutationFn:n=>t.get("PullPackagesToPocket",{params:n}),onSuccess:(n,p)=>Promise.all([s.invalidateQueries({queryKey:["pocketPackages",{...p}]}),s.invalidateQueries({queryKey:["distributions"]})])}),c=j({mutationKey:["pocketPackages","remove"],mutationFn:n=>t.get("RemovePackagesFromPocket",{params:n}),onSuccess:(n,p)=>s.invalidateQueries({queryKey:["pocketPackages",{...p},"list"]})}),m=(n,p={})=>E({queryKey:["pocketPackages",{...n},"difference"],queryFn:()=>t.get("DiffPullPocket",{params:n}),...p}),g=(n,p={})=>E({queryKey:["pocketPackages",{...n},"list"],queryFn:()=>t.get("ListPocket",{params:n}),...p}),k=j({mutationKey:["packageFilters","add"],mutationFn:n=>t.get("AddPackageFiltersToPocket",{params:n}),onSuccess:(n,p)=>Promise.all([s.invalidateQueries({queryKey:["distributions"]}),s.invalidateQueries({queryKey:["pocketPackages",{...p}]})])}),h=j({mutationKey:["packageFilters","remove"],mutationFn:n=>t.get("RemovePackageFiltersFromPocket",{params:n}),onSuccess:(n,p)=>Promise.all([s.invalidateQueries({queryKey:["distributions"]}),s.invalidateQueries({queryKey:["pocketPackages",{...p}]})])}),x=j({mutationKey:["uploaderGPGKeys","add"],mutationFn:n=>t.get("AddUploaderGPGKeysToPocket",{params:n}),onSuccess:(n,p)=>Promise.all([s.invalidateQueries({queryKey:["distributions"]}),s.invalidateQueries({queryKey:["pocketPackages",{...p}]})])}),b=j({mutationKey:["uploaderGPGKeys","remove"],mutationFn:n=>t.get("RemoveUploaderGPGKeysFromPocket",{params:n}),onSuccess:(n,p)=>Promise.all([s.invalidateQueries({queryKey:["distributions"]}),s.invalidateQueries({queryKey:["pocketPackages",{...p}]})])});return{createPocketQuery:o,editPocketQuery:u,syncMirrorPocketQuery:y,pullPackagesToPocketQuery:r,diffPullPocketQuery:m,removePocketQuery:i,listPocketQuery:g,removePackagesFromPocketQuery:c,addPackageFiltersToPocketQuery:k,removePackageFiltersFromPocketQuery:h,addUploaderGPGKeysToPocketQuery:x,removeUploaderGPGKeysFromPocketQuery:b}}const me=d.lazy(()=>S(()=>import("./EditPocketForm-42Rz7w5Q.js"),__vite__mapDeps([24,1,2,25,26,27,28,29,30,31,32,33,34,9,6,7,8,10,11,12,13,14,15,16,4,5,17,18,19,20,21,22]))),I=({distributionName:s,pocket:t,seriesName:o,syncPocketRefs:u})=>{const i=w("(min-width: 620px)"),y=K(),{confirmModal:r,closeConfirmModal:c}=T(),{setSidePanelContent:m}=D(),{removePocketQuery:g,syncMirrorPocketQuery:k,pullPackagesToPocketQuery:h}=ue(),{mutateAsync:x}=g,b=a=>{r({body:`Do you really want to delete ${a.name} pocket from ${o} series of ${s} distribution?`,title:"Deleting pocket",buttons:[e.jsx(l.Button,{appearance:"negative",onClick:async()=>{try{await x({distribution:s,series:o,name:a.name})}catch(f){y(f)}finally{c()}},"aria-label":`Delete ${a.name} pocket of ${s}/${o}`,children:"Delete"},`delete-${a.name}-pocket`)]})},{mutateAsync:n}=k,{mutateAsync:p}=h,_=async()=>{try{await n({name:t.name,series:o,distribution:s})}catch(a){y(a)}finally{c()}},C=async()=>{try{await p({name:t.name,series:o,distribution:s})}catch(a){y(a)}finally{c()}},A=a=>{a.mode==="mirror"?r({title:`Synchronizing ${a.name} pocket`,body:"Do you want to synchronize packages?",buttons:[e.jsx(l.Button,{appearance:"positive",onClick:_,"aria-label":`Synchronize ${a.name} pocket of ${s}/${o}`,children:"Sync"},a.name)]}):a.mode==="pull"&&r({title:`Pulling packages to ${a.name} pocket`,body:`Do you want to pull packages from ${a.pull_pocket}?`,buttons:[e.jsx(l.Button,{appearance:"positive",onClick:C,"aria-label":`Pull packages to ${a.name} pocket of ${s}/${o}`,children:"Pull"},a.name)]})},F=(a,f)=>{a.currentTarget.blur(),m(`Edit ${f.name} pocket`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(me,{pocket:f,distributionName:s,seriesName:o})}))};return e.jsxs("div",{className:"divided-blocks",children:[(t.mode=="mirror"||t.mode=="pull")&&e.jsx("div",{className:"divided-blocks__item",children:e.jsx(l.Tooltip,{message:t.mode==="mirror"?"Sync":"Pull",position:"btm-center",children:e.jsx(l.Button,{small:i,hasIcon:!0,appearance:i?"base":"",className:v("u-no-margin--bottom",{"u-no-padding--right":i}),"aria-label":t.mode==="mirror"?`Synchronize ${t.name} pocket of ${s}/${o}`:`Pull packages to ${t.name} pocket of ${s}/${o}`,onClick:()=>A(t),disabled:u.some(a=>a.distributionName===s),children:e.jsx("i",{className:v("p-icon--change-version",{"u-no-margin--right":i})})})})}),e.jsx("div",{className:"divided-blocks__item",children:e.jsx(l.Tooltip,{message:"Edit",position:"btm-center",children:e.jsx(l.Button,{small:i,hasIcon:!0,appearance:i?"base":"",className:v("u-no-margin--bottom",{"u-no-padding--right":i}),"aria-label":`Edit ${t.name} pocket of ${s}/${o}`,onClick:a=>F(a,t),disabled:u.some(a=>a.distributionName===s),children:e.jsx("i",{className:v("p-icon--edit",{"u-no-margin--right":i})})})})}),e.jsx("div",{className:"divided-blocks__item",children:e.jsx(l.Tooltip,{message:"Delete",position:"btm-center",children:e.jsx(l.Button,{small:i,hasIcon:!0,appearance:i?"base":"",className:v("u-no-margin--bottom",{"u-no-padding--right":i}),"aria-label":`Remove ${t.name} pocket of ${s}/${o}`,onClick:()=>b(t),disabled:u.some(a=>a.distributionName===s),children:e.jsx("i",{className:v("p-icon--delete",{"u-no-margin--right":i})})})})})]})},pe=({column:s})=>{const t={};return s.id==="name"?t.role="rowheader":s.id==="mode"?t["aria-label"]="Mode":s.id==="last_sync"?t["aria-label"]="Last synced":s.id==="package_count"?t["aria-label"]="Content":s.id==="actions"&&(t["aria-label"]="Actions"),t},ye="_pocketWrapper_17dw4_1",ge="_ctaRow_17dw4_9",q={pocketWrapper:ye,ctaRow:ge},xe=({distributionName:s,series:t,syncPocketRefAdd:o,syncPocketRefs:u})=>{const i=w("(min-width: 620px)"),y=d.useMemo(()=>t.pockets,[t.pockets]),r=d.useMemo(()=>[{accessor:"name",Header:"Pocket",Cell:({row:{original:c}})=>e.jsx(M,{distributionName:s,pocket:c,seriesName:t.name})},{accessor:"mode",Header:"Mode"},{accessor:"last_sync",Header:"Last synced",Cell:({row:{original:c}})=>e.jsx(L,{pocket:c,syncPocketRefAdd:o,syncPocketRefs:u})},{accessor:"package_count",Header:"Content",Cell:({row:{original:c}})=>e.jsx(e.Fragment,{children:`${c.package_count} ${c.package_count===1?"package":"packages"}`})},{accessor:"actions",Cell:({row:{original:c}})=>e.jsx(I,{distributionName:s,pocket:c,seriesName:t.name,syncPocketRefs:u})}],[y,u]);return i?e.jsx(l.ModularTable,{columns:r,data:y,getCellProps:pe,emptyMsg:"No pockets yet"}):t.pockets.map((c,m)=>e.jsxs(l.Row,{className:v("u-no-padding--left u-no-padding--right",q.pocketWrapper),children:[e.jsx(l.Col,{size:2,small:2,children:e.jsx(Q,{label:"Pocket",value:e.jsx(M,{distributionName:s,pocket:c,seriesName:t.name})})}),e.jsx(l.Col,{size:2,small:2,children:e.jsx(Q,{label:"Last synced",value:e.jsx(L,{pocket:c,syncPocketRefAdd:o,syncPocketRefs:u})})}),e.jsx(l.Col,{size:2,small:2,children:e.jsx(Q,{label:"Mode",value:c.mode})}),e.jsx(l.Col,{size:2,small:2,children:e.jsx(Q,{label:"Content",value:e.jsx(e.Fragment,{children:`${c.package_count} ${c.package_count===1?"package":"packages"}`})})}),e.jsx("div",{className:q.ctaRow,children:e.jsx(I,{distributionName:s,pocket:c,seriesName:t.name,syncPocketRefs:u})})]},m))};function _e(){const s=z(),t=H(),o=j({mutationKey:["series","new"],mutationFn:r=>t.get("CreateSeries",{params:r}),onSuccess:()=>s.invalidateQueries({queryKey:["distributions"]})}),u=j({mutationKey:["series","derive"],mutationFn:r=>t.get("DeriveSeries",{params:r}),onSuccess:()=>s.invalidateQueries({queryKey:["distributions"]})}),i=j({mutationKey:["series","remove"],mutationFn:r=>t.get("RemoveSeries",{params:r}),onSuccess:()=>s.invalidateQueries({queryKey:["distributions"]})});return{createSeriesQuery:o,removeSeriesQuery:i,deriveSeriesQuery:u,getRepoInfo:(r,c={})=>E({queryKey:["repoInfo",{queryParams:r}],queryFn:()=>t.get("GetRepoInfo",{params:r}),...c})}}const he=d.lazy(()=>S(()=>import("./NewPocketForm-BddbOH6F.js"),__vite__mapDeps([35,1,2,25,26,27,28,29,30,31,32,33,34,9,36,6,7,8,10,11,12,13,14,15,16,4,5,17,18,19,20,21,22]))),je=d.lazy(()=>S(()=>import("./DeriveSeriesForm-0XVTY7JD.js"),__vite__mapDeps([37,1,2,36,31,32,33,6,7,8,9,10,11,12,13,14,15,16,4,5,17,18,19,20,21,22]))),ke=({distribution:s,series:t,syncPocketRefAdd:o,syncPocketRefs:u})=>{const[i,y]=d.useState(!1),[r,c]=d.useState("");d.useEffect(()=>{!t||!t.pockets.length||t.pockets[0].mode!=="mirror"||!t.pockets[0].mirror_uri.startsWith(Y)||c(t.pockets[0].mirror_uri.replace(/^.*\/(\d{8})T\d{6}Z$/,"$1"))},[t]);const m=w("(min-width: 620px)"),{confirmModal:g,closeConfirmModal:k}=T(),{setSidePanelContent:h}=D(),{removeSeriesQuery:x}=_e(),b=K(),{mutateAsync:n,isPending:p}=x,_=async()=>{g({title:"Remove series",body:"Are you sure? This action cannot be undone.",buttons:[e.jsx(l.Button,{appearance:"negative",hasIcon:!0,onClick:async()=>{try{await n({name:t.name,distribution:s.name})}catch(a){b(a)}finally{k()}},"aria-label":`Remove ${t.name} from ${s.name}`,children:"Remove"},`delete-${t.name}`)]})},C=({className:a})=>e.jsx(l.Button,{onClick:()=>{h("Derive series",e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(je,{distribution:s,origin:t.name})}))},onMouseDown:f=>{f.preventDefault()},"aria-label":`Derive series ${s.name}/${t.name}`,className:a??"is-small",children:"Derive series"}),A=({className:a})=>e.jsx(l.Button,{onClick:()=>{h(`New pocket for ${t.name}`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(he,{distribution:s,series:t})}))},onMouseDown:f=>{f.preventDefault()},"aria-label":`Add new pocket for ${s.name}/${t.name}`,className:a??"is-small",children:"New pocket"}),F=({className:a})=>e.jsx(l.Button,{onClick:_,onMouseDown:f=>{f.preventDefault()},disabled:p,"aria-label":`Remove ${s.name}/${t.name}`,className:a??"is-small",children:"Remove"});return e.jsxs("div",{className:$.card,children:[e.jsxs("div",{className:$.header,children:[e.jsx("h3",{className:$.title,children:t.name}),!!r&&e.jsx("span",{className:v("u-text--muted",$.snapshot),children:`Snapshot from ${G(r).format(Z)}`}),m?e.jsxs("div",{className:$.cta,children:[!r&&e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsx(A,{})]}),e.jsx(F,{})]}):e.jsxs("span",{className:"p-contextual-menu",children:[e.jsx(l.Button,{className:"p-contextual-menu__toggle u-no-margin--bottom","aria-controls":"series-cta","aria-expanded":i,"aria-haspopup":"true",onClick:()=>{y(a=>!a)},onBlur:()=>{y(!1)},children:"Actions"}),e.jsxs("span",{className:"p-contextual-menu__dropdown",id:"series-cta","aria-hidden":!i,children:[!r&&e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"p-contextual-menu__link"}),e.jsx(A,{className:"p-contextual-menu__link"})]}),e.jsx(F,{className:"p-contextual-menu__link"})]})]})]}),e.jsx("div",{className:$.content,children:e.jsx(xe,{distributionName:s.name,series:t,syncPocketRefAdd:o,syncPocketRefs:u})})]})},ve="_card_40gow_1",fe="_header_40gow_5",Pe="_title_40gow_11",be="_content_40gow_20",B={card:ve,header:fe,title:Pe,content:be},Se=d.lazy(()=>S(()=>import("./index-CZS4Jvy0.js"),__vite__mapDeps([38,1,2,12,25,26,31,32,33,8,9,34,36,6,7,10,11,13,14,15,16,4,5,17,18,19,20,21,22]))),Ce=({distribution:s})=>{const{setSidePanelContent:t}=D();return e.jsxs("div",{className:B.card,children:[e.jsx("div",{className:B.header,children:e.jsx("h3",{className:B.title,children:"No series have been added yet"})}),e.jsxs("div",{className:B.content,children:[e.jsx("p",{className:"u-no-margin--bottom",children:"Add a new mirror or series to get started"}),e.jsx("p",{className:"u-no-margin--top",children:e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage repositories in Landscape"})}),e.jsx(l.Button,{appearance:"positive",className:"u-no-margin--bottom",onClick:()=>{t(`Add mirror for ${s.name}`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Se,{distribution:s})}))},"aria-label":`Add mirror for ${s.name}`,children:"Add mirror"})]})]})},De=d.lazy(()=>S(()=>import("./index-CZS4Jvy0.js"),__vite__mapDeps([38,1,2,12,25,26,31,32,33,8,9,34,36,6,7,10,11,13,14,15,16,4,5,17,18,19,20,21,22]))),$e=({distribution:s,syncPocketRefAdd:t,syncPocketRefs:o})=>{const[u,i]=d.useState(!1),y=w("(min-width: 620px)"),{confirmModal:r,closeConfirmModal:c}=T(),{setSidePanelContent:m}=D(),{removeDistributionQuery:g}=O(),{mutateAsync:k,isPending:h}=g,x=K(),b=async()=>{r({title:`Removing ${s.name} distribution`,body:"Are you sure? This action cannot be undone.",buttons:[e.jsx(l.Button,{appearance:"negative",hasIcon:!0,"aria-label":`Remove ${s.name} distribution`,onClick:async()=>{try{await k({name:s.name})}catch(_){x(_)}finally{c()}},children:"Remove"},`delete-${s.name}`)]})},n=({className:_})=>e.jsx(l.Button,{onClick:()=>{m(`Add series to ${s.name}`,e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(De,{distribution:s,ctaText:"Add series"})}))},onMouseDown:C=>{C.preventDefault()},"aria-label":`Add series to ${s.name}`,className:_??"is-small",children:"Add series"}),p=({className:_})=>e.jsx(l.Button,{onClick:b,onMouseDown:C=>{C.preventDefault()},"aria-label":`Remove ${s.name} distribution`,disabled:h,className:_??"is-small",children:"Remove distribution"});return e.jsxs("div",{className:R.item,children:[e.jsxs("div",{className:R.titleGroup,children:[e.jsx("h2",{className:v("p-heading--4 u-no-margin--bottom u-no-padding--top",R.title),children:s.name}),y?e.jsxs("div",{children:[e.jsx(n,{}),e.jsx(p,{})]}):e.jsxs("span",{className:"p-contextual-menu--left",children:[e.jsx(l.Button,{className:"p-contextual-menu__toggle","aria-controls":"distribution-cta","aria-expanded":u,"aria-haspopup":"true",onClick:()=>{i(_=>!_)},onBlur:()=>{i(!1)},children:"Actions"}),e.jsxs("span",{className:"p-contextual-menu__dropdown",id:"distribution-cta","aria-hidden":!u,children:[e.jsx(n,{className:"p-contextual-menu__link"}),e.jsx(p,{className:"p-contextual-menu__link"})]})]})]}),s.series.length===0&&e.jsx(Ce,{distribution:s}),s.series.length>0&&s.series.map(_=>e.jsx(ke,{distribution:s,series:_,syncPocketRefAdd:t,syncPocketRefs:o},_.name))]})},we=d.lazy(()=>S(()=>import("./NewDistributionForm-C384iTH4.js"),__vite__mapDeps([39,1,2,8,9,40,36,31,32,33]))),Ne=()=>{const{setSidePanelContent:s}=D(),t=()=>{s("Add distribution",e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(we,{})}))};return e.jsx(J,{title:"No mirrors have been added yet",icon:"containers",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"To add a new mirror you must first add a distribution"}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage repositories in Landscape"})]}),cta:[e.jsx(l.Button,{onClick:t,type:"button",children:"Add distribution"},"add-distribution")]})},Ae=({onDistributionsLengthChange:s})=>{const[t,o]=d.useState([]),{getDistributionsQuery:u}=O(),{data:i,isLoading:y}=u({include_latest_sync:!0},{refetchInterval:t.length?1e3:void 0}),r=(i==null?void 0:i.data)??[];d.useEffect(()=>{s(r.length)},[r.length]),d.useEffect(()=>{var m,g;if(t.length)for(const k of t){const h=(g=(m=r.find(({name:x})=>x===k.distributionName))==null?void 0:m.series.find(({name:x})=>x===k.seriesName))==null?void 0:g.pockets.find(({name:x})=>x===k.pocketName);!h||h.mode!=="mirror"&&h.mode!=="pull"||h.last_sync_status==="in progress"||o(x=>x.filter(({distributionName:b})=>b!==k.distributionName))}},[r]);const c=m=>{o(g=>[...g,m])};return e.jsxs(e.Fragment,{children:[y&&e.jsx(P,{}),!y&&r.length===0&&e.jsx(Ne,{}),!y&&r.length>0&&r.map(m=>e.jsx($e,{distribution:m,syncPocketRefAdd:c,syncPocketRefs:t},m.name))]})},Fe=d.lazy(()=>S(()=>import("./NewDistributionForm-C384iTH4.js"),__vite__mapDeps([39,1,2,8,9,40,36,31,32,33]))),Qe=d.lazy(()=>S(()=>import("./index-CZS4Jvy0.js"),__vite__mapDeps([38,1,2,12,25,26,31,32,33,8,9,34,36,6,7,10,11,13,14,15,16,4,5,17,18,19,20,21,22]))),Be=()=>{const[s,t]=d.useState(0),[o,u]=d.useState(!1),i=w("(min-width: 620px)"),{setSidePanelContent:y}=D(),r=({className:m})=>e.jsx(l.Button,{onClick:()=>{y("Add distribution",e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Fe,{})}))},onMouseDown:g=>{g.preventDefault()},type:"button",className:v("u-no-margin--right",m),children:"Add distribution"}),c=({className:m})=>e.jsx(l.Button,{appearance:"positive",onClick:()=>{y("Add new mirror",e.jsx(d.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Qe,{})}))},onMouseDown:g=>{g.preventDefault()},type:"button",className:v("u-no-margin--right",m),disabled:s===0,children:"Add mirror"});return e.jsxs(X,{children:[e.jsx(ee,{title:"Repository Mirrors",actions:i?[e.jsx(r,{},"add-distribution-button"),e.jsx(c,{},"add-mirror-button")]:[e.jsxs("span",{className:"p-contextual-menu",children:[e.jsx(l.Button,{className:"p-contextual-menu__toggle u-no-margin--bottom","aria-controls":"menu","aria-expanded":o,"aria-haspopup":"true",onClick:()=>{u(m=>!m)},onBlur:()=>{u(!1)},children:"Actions"}),e.jsxs("span",{className:"p-contextual-menu__dropdown",id:"menu","aria-hidden":!o,children:[e.jsx(r,{className:"p-contextual-menu__link"}),e.jsx(c,{className:"p-contextual-menu__link"})]})]},"menu")]}),e.jsx(se,{children:e.jsx(Ae,{onDistributionsLengthChange:m=>t(m)})})]})},Oe=Object.freeze(Object.defineProperty({__proto__:null,default:Be},Symbol.toStringTag,{value:"Module"}));export{ue as a,Oe as i,_e as u};
