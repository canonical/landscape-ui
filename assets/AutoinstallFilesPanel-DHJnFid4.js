import{b as v,e as F,f as I,i as p,p as Y,q as C,n as x,s as G,j as e,d as i,t as S,$ as Q,v as f,B as T,I as j,A as b,D as y,a4 as E,av as K,aH as W,al as X,aI as J,aw as Z,h as ee,E as te,aB as se,a2 as ne}from"./index-58XCQrHI.js";import{u as D}from"./useGetAutoinstallFiles-RAdBnhaf.js";import{r as N,A as w,b as ae,a as ie,g as le}from"./helpers-B4nWsGMV.js";import"./index-tgeiFvOA.js";import{V as oe,D as re,u as ce,A as ue,a as P,C as de}from"./AutoinstallFileVersionHistory-44vLx4gz.js";import{H as me}from"./HeaderWithSearch-C49ydzbc.js";import{C as pe}from"./CodeEditor-CmUJpyPr.js";import{S as he}from"./SidePanelFormButtons-S63byZ8e.js";import"./SidePanelTablePagination-BHxqBpfn.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";const k=()=>{const t=v(),s=F(),{isPending:a,mutateAsync:n}=I({mutationFn:async l=>t.post("autoinstall",l),onSuccess:async()=>s.invalidateQueries({queryKey:["autoinstallFiles"]})});return{isAutoinstallFileAdding:a,addAutoinstallFile:n}},fe=()=>{const t=v(),s=F(),{isPending:a,mutateAsync:n}=I({mutationFn:async({id:l})=>t.delete(`autoinstall/${l}`),onSuccess:async()=>s.invalidateQueries({queryKey:["autoinstallFiles"]})});return{deleteAutoinstallFile:n,isAutoinstallFileUpdating:a}},O=()=>{const t=v(),s=F(),{isPending:a,mutateAsync:n}=I({mutationFn:async({id:l,...o})=>t.patch(`autoinstall/${l}`,o),onSuccess:async()=>{await s.invalidateQueries({queryKey:["autoinstallFiles"]})}});return{isAutoinstallFileUpdating:a,updateAutoinstallFile:n}},xe="_form_1dly8_1",Ae="_inputContainer_1dly8_7",je="_input_1dly8_7",_e="_inputDescription_1dly8_16",_={form:xe,inputContainer:Ae,input:je,inputDescription:_e},ge=(t,s)=>t===s,$=({buttonText:t,description:s,initialFile:a=re,notification:n,onSubmit:l})=>{const o=t==="Add",r=p.useRef(null),u=Y(),{notify:m}=C(),{closeSidePanel:g}=x(),c=G({initialValues:{contents:a.contents,is_default:a.is_default,filename:N(a.filename)},validationSchema:oe,onSubmit:async d=>{const h=`${d.filename}${w}`;try{await l({contents:d.contents,is_default:d.is_default,filename:h}),g(),m.success({message:`The autoinstall file ${h} ${n.message}`,title:`${n.title} ${h}`})}catch(A){u(A)}}}),q=async({target:{files:d}})=>{if(!d)return;const[h]=d,A=c.setFieldValue("contents",await h.text());if(c.values.filename){await A;return}await Promise.all([c.setFieldValue("filename",N(h.name)),A])},z=async d=>{await c.setFieldValue("contents",d)},H=()=>{r.current?.click()};return e.jsxs(i.Form,{className:_.form,noValidate:!0,onSubmit:c.handleSubmit,children:[e.jsx("span",{children:s}),e.jsxs("div",{className:_.inputContainer,children:[e.jsx(i.Input,{wrapperClassName:_.input,type:"text",label:"File name",...c.getFieldProps("filename"),error:S(c,"filename"),disabled:!!a.filename,required:!0}),e.jsx("span",{className:_.inputDescription,children:w})]}),o&&e.jsx(i.Input,{type:"checkbox",label:"Default",...c.getFieldProps("is_default"),help:"This file will be used to configure newly registered instances. Only one default file can be set at a time."}),e.jsx("input",{ref:r,className:"u-hide",type:"file",accept:ae.map(d=>`.${d}`).join(","),onChange:q}),e.jsx(pe,{label:"Code",value:c.values.contents,onChange:z,error:S(c,"contents"),required:!0,language:ie,headerContent:e.jsxs(i.Button,{className:"u-no-margin--bottom",appearance:"base",hasIcon:!0,onClick:H,type:"button",children:[e.jsx(i.Icon,{name:"upload"}),e.jsx("span",{children:"Populate from file"})]})}),e.jsx(he,{submitButtonDisabled:ge(c.values.contents,a.contents)||c.isSubmitting,submitButtonText:t})]})},be="_container_fgz2s_1",ye={container:be},M=({openAddForm:t})=>e.jsxs(e.Fragment,{children:[e.jsx(me,{actions:e.jsx("div",{className:ye.container,children:e.jsxs(i.Button,{type:"button",className:"u-no-margin",hasIcon:!0,onClick:t,children:[e.jsx(i.Icon,{name:"plus"}),e.jsx("span",{children:"Add new"})]})})}),e.jsx(Q,{filtersToDisplay:["search"]})]}),ve={message:"has been edited and all the changes made have been saved successfully.",title:"You have successfully saved changes for"},Fe=({autoinstallFile:t})=>{const{autoinstallFile:s,isAutoinstallFileLoading:a}=ce({id:t.id,with_metadata:!0}),{updateAutoinstallFile:n}=O();return a||!s?e.jsx(f,{}):e.jsxs(e.Fragment,{children:[s.metadata.max_versions<=s.version&&e.jsx(i.Notification,{inline:!0,title:"Edit history limit reached:",severity:"caution",children:e.jsxs("p",{children:["You've reached the limit of"," ",s.metadata.max_versions," saved"," ",T(s.metadata.max_versions,"edit"),". To save your new change, the oldest version will be automatically removed, keeping the most recent"," ",s.metadata.max_versions," ",T(s.metadata.max_versions,"version")," ","in history."]})}),e.jsx($,{buttonText:"Save changes",description:`The duplicated ${s.filename} will be assigned to the same user groups in the identity provider as the original file.`,initialFile:s,notification:ve,onSubmit:async({contents:l,is_default:o})=>{await n({id:s.id,contents:l,is_default:o})}})]})},V=({autoinstallFile:t,close:s})=>{const{notify:a}=C(),{closeSidePanel:n}=x(),{deleteAutoinstallFile:l}=fe(),o=async()=>{await l({id:t.id}),s(),n(),a.success({message:`The autoinstall file ${t.filename} has been permanently removed. All Employee accounts previously relying on it through identity provider group assignments will now fall back to the default autoinstall file.`,title:`You have successfully removed ${t.filename} autoinstall file.`})};return e.jsx(i.ConfirmationModal,{close:s,confirmButtonAppearance:"negative",confirmButtonLabel:"Remove",onConfirm:o,title:`Remove ${t.filename}, autoinstall file`,children:e.jsxs("p",{children:["You are about to remove ",t.filename,", an autoinstall file. This action is irreversible. All Employee accounts previously assigned this file via identity provider will instead use the default autoinstall file."]})})},Ie=({file:t})=>e.jsxs(e.Fragment,{children:[e.jsxs(i.Row,{className:"u-no-padding",children:[e.jsx(i.Col,{size:6,children:e.jsx(j,{label:"Name",value:t.filename})}),e.jsx(i.Col,{size:6,children:e.jsx(j,{label:"Version",value:t.version})})]}),e.jsxs(i.Row,{className:"u-no-padding",children:[e.jsx(i.Col,{size:6,children:e.jsx(j,{label:"Last modified",value:b(t.last_modified_at).format(y)})}),e.jsx(i.Col,{size:6,children:e.jsx(j,{label:"Date created",value:b(t.created_at).format(y)})})]})]}),Ce=[{id:"info",label:"Info"},{id:"version-history",label:"Version history"}],Se=({file:t,viewVersionHistory:s,initialTabId:a="info"})=>{const[n,l]=p.useState(a),o=Ce.map(({label:r,id:u})=>({label:r,active:u===n,role:"tab",onClick:()=>{l(u)}}));return e.jsxs(e.Fragment,{children:[e.jsx(i.Tabs,{links:o}),n==="info"&&e.jsx(Ie,{file:t}),n==="version-history"&&e.jsx(ue,{file:t,viewVersionHistory:s})]})},Te=({autoinstallFile:t,initialTabId:s})=>{const{value:a,setTrue:n,setFalse:l}=E(),{openAutoinstallFileDetails:o,openAutoinstallFileEditForm:r,setAutoinstallFileAsDefault:u}=R(t),m=()=>{o("version-history")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(i.Button,{type:"button",className:"p-segmented-control__button",onClick:r,hasIcon:!0,children:[e.jsx(i.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(i.Button,{type:"button",className:"p-segmented-control__button",onClick:u,disabled:t.is_default,hasIcon:!0,children:[e.jsx(i.Icon,{name:"starred"}),e.jsx("span",{children:"Set as default"})]}),e.jsxs(i.Button,{type:"button",className:"p-segmented-control__button",onClick:n,disabled:t.is_default,hasIcon:!0,children:[e.jsx(i.Icon,{name:i.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]})}),e.jsx(Se,{initialTabId:s,file:t,viewVersionHistory:m}),a&&e.jsx(V,{autoinstallFile:t,close:l})]})},B=()=>{const{setSidePanelContent:t}=x();return(s,a)=>{t(e.jsx(P,{file:s}),e.jsx(p.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(Te,{initialTabId:a,autoinstallFile:s})}))}},R=t=>{const{notify:s}=C(),{closeSidePanel:a,setSidePanelContent:n}=x(),{updateAutoinstallFile:l}=O(),o=B();return{openAutoinstallFileDetails:r=>{o(t,r)},openAutoinstallFileEditForm:()=>{n(e.jsx(P,{file:t,title:"Edit"}),e.jsx(p.Suspense,{fallback:e.jsx(f,{}),children:e.jsx(Fe,{autoinstallFile:t})}))},setAutoinstallFileAsDefault:async()=>{await l({id:t.id,is_default:!0}),a(),s.success({message:"Employee accounts without a specific autoinstall file assigned via the identity provider will now inherit this default file.",title:`You have successfully set ${t.filename} as the default autoinstall file`})}}},Ne=({autoinstallFile:t})=>{const{value:s,setTrue:a,setFalse:n}=E(),{openAutoinstallFileDetails:l,openAutoinstallFileEditForm:o,setAutoinstallFileAsDefault:r}=R(t),u=()=>{l()},m=[{icon:"show",label:"View details","aria-label":`View ${t.filename} details`,onClick:u},{icon:"edit",label:"Edit","aria-label":`Edit ${t.filename}`,onClick:o},{icon:"starred",label:"Set as default","aria-label":`Set ${t.filename} as default`,onClick:r,disabled:t.is_default}],g=[{icon:"delete",label:"Remove","aria-label":`Remove ${t.filename}`,onClick:a,disabled:t.is_default}];return e.jsxs(e.Fragment,{children:[e.jsx(K,{toggleAriaLabel:`${t.filename} actions`,actions:m,destructiveActions:g}),s&&e.jsx(V,{autoinstallFile:t,close:n})]})},we="_container_56wd4_1",Le="_header_56wd4_6",L={container:we,header:Le},Ee=({column:t})=>{{const s={};switch(t.id){case"filename":s.role="rowheader";break;case"last_modified_at":s["aria-label"]="last modified at";break}return s}},De=()=>({}),U=({autoinstallFiles:t})=>{const s=B(),a=p.useMemo(()=>[{...W,accessor:"filename",Header:e.jsxs("div",{className:L.header,children:["Name",e.jsx("span",{className:"u-text--muted",children:"Version"})]}),Cell:({row:{original:n}})=>e.jsxs(J,{children:[e.jsxs("div",{className:L.container,children:[e.jsx(i.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top u-align-text--left",onClick:()=>{s(n)},children:n.filename}),n.is_default&&e.jsx(de,{value:"Default"})]}),e.jsxs("span",{className:"u-text--muted",children:["Version ",n.version]})]})},{accessor:"last_modified_at",Header:"Last edited",Cell:({row:{original:{last_modified_at:n}}})=>e.jsx("div",{className:"font-monospace",children:b(n).format(y)})},{...X,Cell:({row:{original:n}})=>e.jsx(Ne,{autoinstallFile:n})}],[]);return e.jsx(Z,{columns:a,data:t,emptyMsg:"No autoinstall files found according to your search parameters.",getCellProps:Ee,getRowProps:De})},Pe=Object.freeze(Object.defineProperty({__proto__:null,AutoinstallFileForm:$,AutoinstallFilesHeader:M,AutoinstallFilesList:U,getAutoinstallFileOptions:le,useAddAutoinstallFile:k,useGetAutoinstallFiles:D},Symbol.toStringTag,{value:"Module"})),ke={message:"is now available and can be assigned to identity provider user groups.",title:"You have successfully added"},Oe=p.lazy(async()=>ne(()=>Promise.resolve().then(()=>Pe),void 0).then(t=>({default:t.AutoinstallFileForm}))),Ge=()=>{const{currentPage:t,pageSize:s,search:a}=ee(),{setSidePanelContent:n}=x(),{addAutoinstallFile:l}=k(),{autoinstallFiles:o,autoinstallFilesCount:r,isAutoinstallFilesLoading:u}=D({limit:s,offset:(t-1)*s,with_groups:!0,search:a}),m=()=>{n("Add new autoinstall file",e.jsxs(p.Suspense,{fallback:e.jsx(f,{}),children:[e.jsx(Oe,{buttonText:"Add",description:"Add autoinstall file. It can be applied during the initial setup of associated instances.",notification:ke,onSubmit:l}),","]}))};return!o.length&&!a&&!u?e.jsx(te,{icon:"file",title:"No autoinstall files found",body:e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any autoinstall files yet."}),cta:[e.jsx(i.Button,{appearance:"positive",onClick:m,className:"u-no-margin--right",children:"Add autoinstall file"},"add-autoinstall-file")]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{openAddForm:m}),u?e.jsx(f,{}):e.jsx(U,{autoinstallFiles:o}),e.jsx(se,{currentItemCount:o.length,totalItems:r})]})};export{Ge as default};
