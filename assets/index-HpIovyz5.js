import{r as f,b as U,z as E,j as t,h as r,k as N,y,a as T,l as A,m as k,n as g,R as $,t as q}from"./index-DAhtk5GF.js";import{A as F}from"./AuthTemplate-BwAC0uHN.js";import{r as I}from"./helpers-Bo73Thd0.js";import{S}from"./constants-LFXGfoad.js";const B="_list_9u1s7_1",R="_button_9u1s7_20",C="_icon_9u1s7_28",d={list:B,button:R,icon:C},D=({isStandaloneOidcEnabled:u,isUbuntuOneEnabled:m,oidcProviders:p,onInvitation:a})=>{const[i,c]=f.useState(0),[o]=U(),{getOidcUrlQuery:l,getUbuntuOneUrlQuery:b,getInvitationSummaryQuery:e}=E(),s=o.get("redirect-to"),n=o.get("invitation_id"),x=o.has("external"),{data:w}=e({invitationId:n??""},{enabled:!!n});f.useEffect(()=>{w&&a(w.data.account_title)},[w]);const h={};i>0&&(h.id=i),s&&(h.return_to=s),n&&(h.invitation_id=n),x&&(h.external=!0);const{data:j}=l(h,{enabled:i!==0});f.useEffect(()=>{j&&I(j.data.location)},[j]);const v={};s&&(v.return_to=`${window.origin}${s}`),n&&(v.invitation_id=n),x&&(v.external=!0);const{data:P,refetch:O}=b(v,{enabled:!1});return f.useEffect(()=>{P&&I(P.data.location)},[P]),t.jsxs("ul",{className:d.list,children:[m&&t.jsx("li",{className:"p-list__item",children:t.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:O,className:d.button,children:[t.jsx(r.Icon,{name:S["ubuntu-one"].icon,className:d.icon}),t.jsx("span",{children:"Sign in with Ubuntu One"})]})}),u&&t.jsx("li",{className:"p-list__item",children:t.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:()=>c(-1),className:d.button,children:[t.jsx(r.Icon,{name:S["standalone-oidc"].icon,className:d.icon}),t.jsx("span",{children:"Sign in with Enterprise Login"})]})}),p.map(_=>t.jsx("li",{className:"p-list__item",children:t.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:()=>c(_.id),className:d.button,children:[t.jsx(r.Icon,{name:S[_.provider].icon,className:d.icon}),t.jsx("span",{children:`Sign in with ${_.name}`})]})},_.id))]})},H="_buttonRow_f3s21_1",V={buttonRow:H},W=({isEmailIdentityOnly:u})=>{const[m]=U(),p=N(),{signInWithEmailAndPasswordQuery:a}=E(),{setUser:i}=y(),c=T(),o=m.get("redirect-to"),l=m.has("external"),{mutateAsync:b}=a,e=A({initialValues:{email:"",password:""},validationSchema:k().shape({email:u?g().required("This field is required").email("Please provide a valid email address"):g().required("This field is required"),password:g().required("This field is required")}),onSubmit:async s=>{try{const{data:n}=await b({email:s.email,password:s.password});if(l&&o)I(o,{replace:!0});else{"current_account"in n&&i(n);const x=new URL(o??`${$}overview`,location.origin);c(x.toString().replace(x.origin,""),{replace:!0})}}catch(n){p(n)}}});return t.jsxs(r.Form,{onSubmit:e.handleSubmit,children:[t.jsx(r.Input,{type:"text",label:u?"Email":"Identity",error:e.touched.email&&e.errors.email?e.errors.email:void 0,...e.getFieldProps("email"),"data-testid":"email"}),t.jsx(r.PasswordToggle,{id:"password",label:"Password",error:e.touched.password&&e.errors.password?e.errors.password:void 0,...e.getFieldProps("password"),"data-testid":"password"}),t.jsx("div",{className:V.buttonRow,children:t.jsx(r.Button,{type:"submit",appearance:"positive",disabled:e.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},X=()=>{const[u,m]=f.useState(""),{getLoginMethodsQuery:p}=E(),{data:a,isLoading:i}=p(),c=a!=null&&a.data.oidc.available?a==null?void 0:a.data.oidc.configurations.filter(({enabled:s})=>s):[],o=!!(a!=null&&a.data.standalone_oidc.available&&a.data.standalone_oidc.enabled),l=!!(a!=null&&a.data.ubuntu_one.available&&a.data.ubuntu_one.enabled),b=!!(a!=null&&a.data.password.available&&a.data.password.enabled),e=!!(a!=null&&a.data.pam.available&&a.data.pam.enabled);return t.jsxs(F,{invitationAccount:u,title:"Sign in to Landscape",children:[i&&t.jsx(q,{}),!i&&(b||e)&&t.jsx(W,{isEmailIdentityOnly:e}),!i&&(l||o||c.length>0)&&t.jsx(D,{isStandaloneOidcEnabled:o,isUbuntuOneEnabled:l,oidcProviders:c,onInvitation:s=>m(s)}),!i&&!b&&!l&&!c.length&&t.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})};export{X as default};
