import{u as T}from"./useAddAutoinstallFile-DXTaQm48.js";import{b as E,g as D,h as L,k as p,A as q,B as v,n as A,C as z,j as e,d as l,F as C,ao as Y,p as j,x as N,I as x,w as b,D as y,G as P,ap as Q,ai as W,o as K,N as X,aC as J,aq as Z,c as ee,E as te,aw as se,a2 as ae}from"./index-ClG4AO4X.js";import{V as ne,r as I,D as ie,A as w,f as le,a as oe,u as re,h as ce,i as k,b as $,g as ue}from"./EmployeeGroupIdentityIssuerList-DAoDr-x2.js";import"./index-CkKa67bu.js";import{H as de}from"./HeaderWithSearch-HMiSqRye.js";import{g as me,E as pe}from"./helpers-BtHScRhs.js";import{u as he}from"./useGetEmployeeGroups-BvKFI8F-.js";import{u as fe}from"./useExpandableRow-exisdsqu.js";import{C as xe}from"./CodeEditor-Cof9QBA2.js";import{S as je}from"./SidePanelFormButtons-BitiQJ8Y.js";import"./SidePanelTablePagination-CSms0KVO.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";const Ae=()=>{const t=E(),s=D(),{isPending:a,mutateAsync:n}=L({mutationFn:async({id:o})=>t.delete(`autoinstall/${o}`),onSuccess:async()=>s.invalidateQueries({queryKey:["autoinstallFiles"]})});return{deleteAutoinstallFile:n,isAutoinstallFileUpdating:a}},O=()=>{const t=E(),s=D(),{isPending:a,mutateAsync:n}=L({mutationFn:async({id:o,...r})=>t.patch(`autoinstall/${o}`,r),onSuccess:async()=>{await s.invalidateQueries({queryKey:["autoinstallFiles"]})}});return{isAutoinstallFileUpdating:a,updateAutoinstallFile:n}},ge="_form_1dly8_1",_e="_inputContainer_1dly8_7",be="_input_1dly8_7",ye="_inputDescription_1dly8_16",_={form:ge,inputContainer:_e,input:be,inputDescription:ye},R=({buttonText:t,description:s,initialFile:a=ie,notification:n,onSubmit:o})=>{const r=p.useRef(null),i=q(),{notify:u}=v(),{closeSidePanel:d}=A(),c=z({initialValues:{...a,filename:I(a.filename)},validationSchema:ne,onSubmit:async m=>{const h=`${m.filename}${w}`;try{await o({...m,filename:h}),d(),u.success({message:`${h} ${n.message}`,title:`${n.title} ${h}`})}catch(g){i(g)}}}),f=async({target:{files:m}})=>{if(!m)return;const[h]=m,g=c.setFieldValue("contents",await h.text());if(c.values.filename){await g;return}await Promise.all([c.setFieldValue("filename",I(h.name)),g])},F=async m=>{await c.setFieldValue("contents",m)},H=()=>{r.current?.click()};return e.jsxs(l.Form,{className:_.form,noValidate:!0,onSubmit:c.handleSubmit,children:[e.jsx("span",{children:s}),e.jsxs("div",{className:_.inputContainer,children:[e.jsx(l.Input,{wrapperClassName:_.input,type:"text",label:"File name",...c.getFieldProps("filename"),error:C(c,"filename"),disabled:!!a.filename,required:!0}),e.jsx("span",{className:_.inputDescription,children:w})]}),e.jsx("input",{ref:r,className:"u-hide",type:"file",accept:le.map(m=>`.${m}`).join(","),onChange:f}),e.jsx(xe,{label:"Code",value:c.values.contents,onChange:F,error:C(c,"contents"),required:!0,language:oe,headerContent:e.jsxs(l.Button,{className:"u-no-margin--bottom",appearance:"base",hasIcon:!0,onClick:H,type:"button",children:[e.jsx(l.Icon,{name:"upload"}),e.jsx("span",{children:"Populate from file"})]})}),e.jsx(je,{submitButtonDisabled:c.isSubmitting,submitButtonText:t})]})},Fe="_container_pnq0d_1",ve={container:Fe},M=({openAddForm:t})=>{const{employeeGroups:s}=he({},{listenToUrlParams:!1}),a=p.useMemo(()=>me(s),[s]);return e.jsxs(e.Fragment,{children:[e.jsx(de,{actions:e.jsxs("div",{className:ve.container,children:[e.jsx(pe,{options:a}),e.jsxs(l.Button,{type:"button",className:"u-no-margin",hasIcon:!0,onClick:t,children:[e.jsx(l.Icon,{name:"plus"}),e.jsx("span",{children:"Add new"})]})]})}),e.jsx(Y,{filtersToDisplay:["search","employeeGroups"],employeeGroupOptions:a})]})},Ce={message:"has been edited and all the changes made have been saved successfully.",title:"You have successfully saved changes for"},Ne=({autoinstallFile:t})=>{const{autoinstallFile:s,isAutoinstallFileLoading:a}=re({id:t.id,with_metadata:!0}),{updateAutoinstallFile:n}=O();return a||!s?e.jsx(j,{}):e.jsxs(e.Fragment,{children:[s.metadata.max_versions<=s.version&&e.jsx(l.Notification,{inline:!0,title:"Edit history limit reached:",severity:"caution",children:e.jsxs("p",{children:["You've reached the limit of"," ",s.metadata.max_versions," saved"," ",N(s.metadata.max_versions,"edit"),". To save your new change, the oldest version will be automatically removed, keeping the most recent"," ",s.metadata.max_versions," ",N(s.metadata.max_versions,"version")," ","in history."]})}),e.jsx(R,{buttonText:"Save changes",description:`The duplicated ${s.filename} will inherit the employee group assignments of the original file.`,initialFile:s,notification:Ce,onSubmit:async({contents:o})=>{await n({id:s.id,contents:o})}})]})},G=({autoinstallFile:t,close:s})=>{const{notify:a}=v(),{closeSidePanel:n}=A(),{deleteAutoinstallFile:o}=Ae(),r=async()=>{await o({id:t.id}),s(),n(),a.success({message:`The ${t.filename} autoinstall file has been permanently removed. All employee groups associated with this file are now using the default autoinstall file.`,title:`You have successfully removed ${t.filename} autoinstall file.`})};return e.jsx(l.ConfirmationModal,{close:s,confirmButtonAppearance:"negative",confirmButtonLabel:"Remove",onConfirm:r,title:`Remove ${t.filename}, autoinstall file`,children:e.jsxs("p",{children:["You are about to remove ",t.filename,", an autoinstall file. This action is irreversible. All employee groups this file is associated with, will have the default autoinstall file associated instead."]})})},Ie=({file:t})=>e.jsxs(e.Fragment,{children:[e.jsxs(l.Row,{className:"u-no-padding",children:[e.jsx(l.Col,{size:6,children:e.jsx(x,{label:"Name",value:t.filename})}),e.jsx(l.Col,{size:6,children:e.jsx(x,{label:"Version",value:t.version})})]}),e.jsxs(l.Row,{className:"u-no-padding",children:[e.jsx(l.Col,{size:6,children:e.jsx(x,{label:"Last modified",value:b(t.last_modified_at).format(y)})}),e.jsx(l.Col,{size:6,children:e.jsx(x,{label:"Date created",value:b(t.created_at).format(y)})})]}),e.jsx(x,{label:"Employee groups associated",value:t.groups.map(s=>s.name).join(", ")})]}),we=[{id:"info",label:"Info"},{id:"version-history",label:"Version history"}],Se=({file:t,viewVersionHistory:s,initialTabId:a="info"})=>{const[n,o]=p.useState(a),r=we.map(({label:i,id:u})=>({label:i,active:u===n,role:"tab",onClick:()=>{o(u)}}));return e.jsxs(e.Fragment,{children:[e.jsx(l.Tabs,{links:r}),n==="info"&&e.jsx(Ie,{file:t}),n==="version-history"&&e.jsx(ce,{file:t,viewVersionHistory:s})]})},Te=({autoinstallFile:t,initialTabId:s})=>{const{value:a,setTrue:n,setFalse:o}=P(),{openAutoinstallFileDetails:r,openAutoinstallFileEditForm:i,setAutoinstallFileAsDefault:u}=B(t),d=()=>{r("version-history")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(l.Button,{type:"button",className:"p-segmented-control__button",onClick:i,hasIcon:!0,children:[e.jsx(l.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(l.Button,{type:"button",className:"p-segmented-control__button",onClick:u,disabled:t.is_default,hasIcon:!0,children:[e.jsx(l.Icon,{name:"starred"}),e.jsx("span",{children:"Set as default"})]}),e.jsxs(l.Button,{type:"button",className:"p-segmented-control__button",onClick:n,disabled:t.is_default,hasIcon:!0,children:[e.jsx(l.Icon,{name:l.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]})}),e.jsx(Se,{initialTabId:s,file:t,viewVersionHistory:d}),a&&e.jsx(G,{autoinstallFile:t,close:o})]})},V=()=>{const{setSidePanelContent:t}=A();return(s,a)=>{t(e.jsx(k,{file:s}),e.jsx(p.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(Te,{initialTabId:a,autoinstallFile:s})}))}},B=t=>{const{notify:s}=v(),{closeSidePanel:a,setSidePanelContent:n}=A(),{updateAutoinstallFile:o}=O(),r=V();return{openAutoinstallFileDetails:i=>{r(t,i)},openAutoinstallFileEditForm:()=>{n(e.jsx(k,{file:t,title:"Edit"}),e.jsx(p.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(Ne,{autoinstallFile:t})}))},setAutoinstallFileAsDefault:async()=>{await o({id:t.id,is_default:!0}),a(),s.success({message:"Employee groups without an autoinstall file assigned will inherit this default file.",title:`You have successfully set ${t.filename} as the default autoinstall file`})}}},Ee=({autoinstallFile:t})=>{const{value:s,setTrue:a,setFalse:n}=P(),{openAutoinstallFileDetails:o,openAutoinstallFileEditForm:r,setAutoinstallFileAsDefault:i}=B(t),u=()=>{o()},d=[{icon:"topic",label:"View details","aria-label":`View ${t.filename} details`,onClick:u},{icon:"edit",label:"Edit","aria-label":`Edit ${t.filename}`,onClick:r},{icon:"starred",label:"Set as default","aria-label":`Set ${t.filename} as default`,onClick:i,disabled:t.is_default}],c=[{icon:"delete",label:"Remove","aria-label":`Remove ${t.filename}`,onClick:a,disabled:t.is_default}];return e.jsxs(e.Fragment,{children:[e.jsx(Q,{toggleAriaLabel:`${t.filename} actions`,actions:d,destructiveActions:c}),s&&e.jsx(G,{autoinstallFile:t,close:n})]})},De="_chip_kt4xa_1",Le="_container_kt4xa_5",S={chip:De,container:Le},Pe=t=>({column:s,row:{index:a}})=>{const n={};switch(s.id){case"filename":n.role="rowheader";break;case"groups":n["aria-label"]="employee groups",t===a&&(n.className="expandedCell");break;case"last_modified_at":n["aria-label"]="last modified at";break;case"created_at":n["aria-label"]="created at";break}return n},ke=t=>({index:s})=>{const a={};return t===s&&(a.className="expandedRow"),a},U=({autoinstallFiles:t})=>{const{expandedRowIndex:s,getTableRowsRef:a,handleExpand:n}=fe(),o=V(),r=p.useMemo(()=>[{accessor:"filename",Header:"Name",Cell:({row:{original:i}})=>e.jsxs("div",{className:S.container,children:[e.jsx(l.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top",onClick:()=>{o(i)},children:`${i.filename}, v${i.version}`}),i.is_default&&e.jsx("span",{className:K("p-chip is-dense u-no-margin--bottom",S.chip),children:e.jsx("span",{className:"p-chip__value",children:"default"})})]})},{accessor:"groups",Header:"Employee Groups Associated",Cell:({row:{original:{groups:i},index:u}})=>{if(!i||i.length===0)return e.jsx(X,{});const[d,...c]=i.map(f=>f.name);return e.jsx(J,{content:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:d}),c.map((f,F)=>e.jsxs("span",{children:[", ",f]},F))]}),isExpanded:u==s,onExpand:()=>{n(u)},showCount:!0})}},{accessor:"last_modified_at",Header:"Last modified",Cell:({row:{original:{last_modified_at:i}}})=>e.jsx("div",{className:"font-monospace",children:b(i).format(y)})},{accessor:"created_at",Header:"Date created",Cell:({row:{original:{created_at:i}}})=>e.jsx("div",{className:"font-monospace",children:b(i).format(y)})},{...W,Cell:({row:{original:i}})=>e.jsx(Ee,{autoinstallFile:i})}],[s]);return e.jsx("div",{ref:a,children:e.jsx(Z,{columns:r,data:t,emptyMsg:"No autoinstall files found according to your search parameters.",getCellProps:Pe(s),getRowProps:ke(s)})})},$e=Object.freeze(Object.defineProperty({__proto__:null,AutoinstallFileForm:R,AutoinstallFilesHeader:M,AutoinstallFilesList:U,getAutoinstallFileOptions:ue,useAddAutoinstallFile:T,useGetAutoinstallFiles:$},Symbol.toStringTag,{value:"Module"})),Oe={message:"can now be assigned to employee groups.",title:"You have successfully added"},Re=p.lazy(async()=>ae(()=>Promise.resolve().then(()=>$e),void 0).then(t=>({default:t.AutoinstallFileForm}))),Xe=()=>{const{currentPage:t,employeeGroups:s,pageSize:a,search:n}=ee(),{setSidePanelContent:o}=A(),{addAutoinstallFile:r}=T(),{autoinstallFiles:i,autoinstallFilesCount:u,isAutoinstallFilesLoading:d}=$({limit:a,offset:(t-1)*a,with_groups:!0,employee_group_ids:s.length>0?s.map(Number):void 0,search:n}),c=()=>{o("Add new autoinstall file",e.jsxs(p.Suspense,{fallback:e.jsx(j,{}),children:[e.jsx(Re,{buttonText:"Add",description:"Add autoinstall file. It can be applied during the initial setup of associated instances.",notification:Oe,onSubmit:r}),","]}))};return!i.length&&!n&&s.length===0&&!d?e.jsx(te,{icon:"file",title:"No autoinstall files found",body:e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any autoinstall files yet."}),cta:[e.jsx(l.Button,{appearance:"positive",onClick:c,className:"u-no-margin--right",children:"Add autoinstall file"},"add-autoinstall-file")]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{openAddForm:c}),d?e.jsx(j,{}):e.jsx(U,{autoinstallFiles:i}),e.jsx(se,{currentItemCount:i.length,totalItems:u})]})};export{Xe as default};
