import{j as s,t as m,r as l,L as x,R as b,b as h,i as j,c as f,d as L}from"./index-CQs3wXys.js";import{u as U,a as y}from"./useUsns-PbelDNjT.js";import{S as $}from"./SidePanelFormButtons-CTKwSU1t.js";import{U as S,E as k}from"./UsnList-BWdRV39e.js";import"./useFetchOld-D-5JyUuM.js";import"./useMutation-D9dT1mhA.js";import"./useQuery-DrwXjJzc.js";import"./SidePanelFormButtons.module-CoxOjuX8.js";import"./moment-DDUBUQL9.js";import"./TruncatedCell-BU0EwnPI.js";import"./ExpandableTableFooter-CeuFA5zV.js";import"./useConfirm-9PPCxKmU.js";import"./useOnClickOutside-CMkwII5b.js";import"./PageMain-BTzMuvvj.js";const C=({instanceIds:e})=>{const{getUsnsQuery:n}=U(),{data:i,isLoading:r}=n({computer_ids:e,show_packages:!1},{enabled:e.length>0});return s.jsxs(s.Fragment,{children:[r&&s.jsx(m,{}),!r&&(!i||i.data.results.length===0)&&null,!r&&i&&i.data.results.length>0&&s.jsx(S,{tableType:"expandable",instanceIds:e,isUsnsLoading:r,usns:i.data.results})]})},q=({instances:e})=>{const[n,i]=l.useState(5),r=l.useMemo(()=>e.slice(0,n),[e,n]),d=l.useMemo(()=>[{accessor:"title",Header:"Instance",Cell:({row:t})=>s.jsx(x,{className:"u-no-margin--bottom u-no-padding--top",to:`${b}instances/${t.original.parent?`${t.original.parent.id}/${t.original.id}`:t.original.id}`,state:{tab:"packages",filter:"upgrade",selectAll:!0},children:t.original.title})},{accessor:"security_upgrades",Header:"Security upgrades",Cell:({row:t})=>{var a;return s.jsx(s.Fragment,{children:(a=t.original.upgrades)==null?void 0:a.security})}},{accessor:"upgrades",Header:"Regular upgrades",Cell:({row:t})=>{var a;return s.jsx(s.Fragment,{children:(a=t.original.upgrades)==null?void 0:a.regular})}}],[e.length]);return s.jsx(k,{columns:d,data:r,limit:n,onLimitChange:()=>i(t=>t+5),itemNames:{plural:"instances",singular:"instance"},title:"Affected instances",totalCount:e.length})},A=({selectedInstances:e})=>{const n=h(),{notify:i}=j(),{closeSidePanel:r}=f(),{getPackagesQuery:d,upgradePackagesQuery:t}=y(),{data:a}=d({query:`id:${e.map(({id:o})=>o).join(" OR id:")}`,upgrade:!0}),{mutateAsync:p,isLoading:g}=t,c=async o=>{o.preventDefault();try{await p({query:`id:${e.map(({id:u})=>u).join(" OR id:")}`,packages:((a==null?void 0:a.data.results)??[]).map(({name:u})=>u)}),r(),i.success({title:`You queued ${a==null?void 0:a.data.count} packages to be upgraded`,message:`${a==null?void 0:a.data.count} packages on ${e.length} instances will be upgraded and are queued in Activities`})}catch(u){n(u)}};return s.jsxs(L.Form,{onSubmit:c,children:[s.jsx(C,{instanceIds:e.map(({id:o})=>o)}),s.jsx(q,{instances:e}),s.jsx($,{submitButtonDisabled:g,submitButtonText:"Request all upgrades"})]})},z=A;export{z as default};
