import{b as q,e as P,f as M,j as e,i as f,p as w,ap as O,o as p,d as h,v as K,P as R,q as V,n as L,s as U,G as C,J as W,K as Y,t as G}from"./index-DDaZatVV.js";import{S as H}from"./SidePanelFormButtons-DYhfXSG9.js";import"./index-UjDapocg.js";import"./AutoinstallFileVersionHistory-DyI82BII.js";import"./EmployeeList-BcLHxrAq.js";import{D as Q}from"./downshift.esm-aH2ZemZd.js";import{u as z}from"./useGetEmployees-8VLrHRD7.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";import"./SidePanelTablePagination-Dg_BwgDN.js";import"./TruncatedCell-feULe2jl.js";const J=()=>{const s=q(),a=P(),{mutateAsync:i,isPending:o}=M({mutationKey:["employee","associate"],mutationFn:async({employee_id:n,...c})=>s.post(`employees/${n}/computers`,c),onSuccess:(n,c)=>{a.invalidateQueries({queryKey:["instances",c.computer_id]})}});return{associateEmployeeWithInstance:i,isAssociating:o}},X="_container_th3ip_1",Z="_suggestionsContainer_th3ip_5",ee="_pointer_th3ip_13",te="_highlighted_th3ip_18",se="_selectedEmployee__container_th3ip_22",ne="_selectedEmployee__name_th3ip_30",oe="_selectedEmployee__button_th3ip_35",ae="_selectedEmployee__icon_th3ip_44",le="_errorMessage_th3ip_48",r={container:X,suggestionsContainer:Z,pointer:ee,highlighted:te,selectedEmployee__container:se,selectedEmployee__name:ne,selectedEmployee__button:oe,selectedEmployee__icon:ae,errorMessage:le},ie=200,ce=(s,a)=>{const i=s.toLowerCase(),o=a.toLowerCase(),n=i.indexOf(o);return n>=0?e.jsxs(e.Fragment,{children:[s.substring(0,n),e.jsx("strong",{children:s.substring(n,n+a.length)}),s.substring(n+a.length)]}):s},re=({employee:s,setEmployee:a,error:i})=>{const[o,n]=f.useState(""),[c,u]=f.useState(!1),[d,_]=f.useState(""),g=w(),{employees:m,isFetching:l}=z({listenToUrlParams:!1},{search:o,with_groups:!0},{enabled:o.length>2}),y=t=>s?.id!==t.id,x=m.filter(y),I=()=>{a(null)},F=()=>{u(!1)},E=()=>{_(""),n("")},S=()=>{d.length>2?u(!0):u(!1)},D=t=>{_(t),t.length>2&&n(t)},A=O(()=>{try{S()}catch(t){g(t)}},ie),T=t=>{t&&(a(t),u(!1),E())},v=t=>{t.key==="Escape"?t.currentTarget.blur():A()},j=!c&&d.length<3?"Min 3. characters":m.length===0&&o&&!l?`No employees found by "${o}"`:null;return e.jsxs("div",{className:p(r.container,{"is-error":!!i}),children:[e.jsx(Q,{onSelect:T,itemToString:()=>"",isOpen:c,children:({getInputProps:t,getItemProps:B,getMenuProps:k,highlightedIndex:$})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx("label",{className:"p-form__label",htmlFor:"employee-searchbox",id:"employee-searchbox-label",children:"Employee"}),e.jsx(h.SearchBox,{...t(),id:"employee-searchbox",placeholder:"Search for an employee",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:d,onChange:D,onClear:E,onBlur:F,onFocus:S,onKeyUp:v}),j?e.jsx("span",{className:"p-form-help-text",children:j}):null,c&&(x.length>0||l)?e.jsx("ul",{className:p("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",r.suggestionsContainer),...k(),children:l?e.jsx(K,{}):x.map((b,N)=>e.jsx("li",{className:p("p-list__item",r.pointer,{[r.highlighted]:$===N}),...B({item:b,index:N}),children:e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:ce(b.name,o)})},b.id))}):null]})}),!!i&&e.jsx("p",{className:p(r.errorMessage,"p-form-validation__message is-error"),children:i}),s&&e.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:e.jsxs("li",{className:p("p-autocomplete__result p-list__item p-card u-no-margin--bottom",r.selectedEmployee__container),children:[e.jsx("span",{className:r.selectedEmployee__name,children:s.name}),e.jsx(h.Button,{type:"button",title:"Remove",appearance:"link",className:p("u-no-margin--bottom",r.selectedEmployee__button),onClick:I,children:e.jsx(h.Icon,{name:h.ICONS.delete,className:r.selectedEmployee__icon})})]},s.id)})]})},Ee=({instanceTitle:s})=>{const{instanceId:a,childInstanceId:i}=R(),o=w(),{notify:n}=V(),{closeSidePanel:c}=L(),u=Number(i??a),{associateEmployeeWithInstance:d,isAssociating:_}=J(),g=async l=>{if(l.employee)try{await d({computer_id:u,employee_id:l.employee.id}),c(),n.success({title:`You have successfully associated ${l.employee.name}`,message:`${l.employee.name} has been successfully associated with ${s}.`})}catch(y){o(y)}},m=U({initialValues:{employee:null},validationSchema:C().shape({employee:C().shape({id:Y().required(),name:W().required()}).nullable().required("This field is required.")}),enableReinitialize:!0,onSubmit:g});return e.jsxs(h.Form,{noValidate:!0,onSubmit:m.handleSubmit,children:[e.jsx("p",{children:"You can associate the instance with the selected employee, allowing them to view its details and recovery key."}),e.jsx(re,{employee:m.values.employee,setEmployee:async l=>await m.setFieldValue("employee",l),error:G(m,"employee")}),e.jsx(H,{submitButtonDisabled:_,submitButtonText:"Associate",submitButtonAppearance:"positive"})]})};export{Ee as default};
