const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C_DwgQYp.js","assets/index-Bwatsl1G.js","assets/index-BwHlIK4o.css","assets/useInstances-CvI7zscF.js","assets/useFetchOld--qBGHGTA.js","assets/WslInstancesHeader-DL2oEBgd.js","assets/HeaderWithSearch-C5C_dSyA.js","assets/usePageParams-gxSf1nMa.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/TableFilterChips-t7GEBfEp.js","assets/TableFilterChips-CHqetGbX.css","assets/WslInstancesHeader-Dj3EjS23.css","assets/useRoles-f6kdZUNk.js","assets/NoData-CcX6zdBS.js","assets/index-C_rp6kpZ.js","assets/TablePagination-CYwNZA2E.js","assets/TablePaginationBase-Ds3XrZnG.js","assets/TablePaginationBase-CJl3HN1X.css","assets/StatusFilter-BlNgJH3S.js","assets/TableFilter-DyxtB4xw.js","assets/TableFilter-DXBG6q86.css","assets/index-CRv_aeRB.css","assets/helpers-Q9GvzaAC.js","assets/InstancesPageActions-0XsW5-wX.js","assets/InstancesPageActions-CswnIe9I.css","assets/index-Dk2MuvQg.css","assets/index-yyt_10Bf.js","assets/index-CsHgpdRJ.css","assets/index-B9w0s5qO.js","assets/index-DrjfSO6d.css","assets/index-BuEDzBII.js","assets/usePackages-_kN5XwR-.js","assets/usePackages-D2X0CFCl.css","assets/index-B0p01W4u.css","assets/index-B4yGJMXR.js","assets/index-C7TlrNDZ.js","assets/PageMain-CJJxVTE6.js","assets/PageMain--v5xNZ5p.css","assets/index-MWJPBEiS.css","assets/index-CI_vaVNg.js","assets/index-6TCR7F2i.css","assets/index-CwfQfNiw.js","assets/SidePanelFormButtons-CIamrVW7.js","assets/SidePanelFormButtons.module-tJTvEwdD.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/helpers-DJRVSlr2.js","assets/output-CazJxxjw.js","assets/index-CrSQJCkv.css","assets/index-aQvIRZU0.js","assets/UsnList-DBVL4g3Y.js","assets/SelectAllButton-e9m9WCtN.js","assets/ExpandableTableFooter-TVak5fsg.js","assets/ExpandableTableFooter-DWm8zyWg.css","assets/TruncatedCell-DWitkczO.js","assets/TruncatedCell-CoXbu3VM.css","assets/helpers-CEg62Tg7.js","assets/helpers-CCHFURK6.css","assets/UsnList-B4hAwQmb.css","assets/index-ME_-7qvr.js","assets/index-B1Uu4xTW.css","assets/index-Dzi-sKO4.js","assets/downshift.esm-CoajVyh7.js","assets/index-C0w1ohHD.css","assets/index-DR2emkhB.js","assets/constants-CFmTqzFM.js","assets/index-CNIav8so.css","assets/index-g_QtjRIx.js","assets/constants-pv1RtvWk.js","assets/index-DgHoeIwv.css","assets/index-D1Viyy8n.js"])))=>i.map(i=>d[i]);
import{a as w,j as n,E as R,g as p,f as T,M as Q,r as o,n as h,_ as d,e as V,b as C,c as v,d as E,o as O,x as z}from"./index-Bwatsl1G.js";import{P as N,a as B,b as U}from"./PageMain-CJJxVTE6.js";import{u as S,a as q}from"./usePackages-_kN5XwR-.js";import{u as $}from"./usePageParams-gxSf1nMa.js";import{u as H}from"./useInstances-CvI7zscF.js";import{d as x}from"./helpers-Q9GvzaAC.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c77c7531-2ab0-418f-b1b7-7681ba8a5314",e._sentryDebugIdIdentifier="sentry-dbid-c77c7531-2ab0-418f-b1b7-7681ba8a5314")}catch{}const M=({childInstanceId:e,instanceId:t})=>{const a=w();return n.jsx(R,{title:"Instance not found",icon:"connected",body:n.jsxs("p",{className:"u-no-margin--bottom",children:[n.jsx("span",{children:"Seems like the instance with id = "}),n.jsx("code",{children:t}),n.jsx("span",{children:" doesn't "}),e?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:"have a child instance with id = "}),n.jsx("code",{children:e})]}):n.jsx("span",{children:"exist"})]}),cta:[n.jsx(p.Button,{appearance:"positive",onClick:()=>a("/instances",{replace:!0}),type:"button","aria-label":"Go back",children:"Back to Instances page"},"go-back-to-instances-page"),n.jsx(p.Button,{onClick:()=>a("/",{replace:!0}),type:"button","aria-label":"Go back",children:"Home page"},"go-back-to-home-page")]})},G=[{label:"Info",id:"tab-link-info"},{label:"WSL",id:"tab-link-wsl"},{label:"Activities",id:"tab-link-activities"},{label:"Kernel",id:"tab-link-kernel"},{label:"Security issues",id:"tab-link-security-issues"},{label:"Packages",id:"tab-link-packages"},{label:"Snaps",id:"tab-link-snaps"},{label:"Processes",id:"tab-link-processes"},{label:"Ubuntu Pro",id:"tab-link-ubuntu-pro"},{label:"Users",id:"tab-link-users"},{label:"Hardware",id:"tab-link-hardware"}],W=({id:e,label:t,packageCount:a,packagesLoading:r,usnCount:u,usnLoading:g,kernelCount:i,kernelLoading:c})=>e==="tab-link-packages"&&r||e==="tab-link-security-issues"&&g||e==="tab-link-kernel"&&c?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:t}),n.jsx(p.Spinner,{className:"u-no-margin--bottom u-no-padding--top"})]}):e==="tab-link-packages"&&a?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:t}),n.jsx(p.Badge,{value:a})]}):e==="tab-link-security-issues"&&u?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:t}),n.jsx(p.Badge,{value:u,isNegative:!0})]}):e==="tab-link-kernel"&&i?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:t}),n.jsx(p.Badge,{value:i})]}):t,J=({activeTabId:e,instance:t,onActiveTabChange:a,packageCount:r,packagesLoading:u,usnCount:g,usnLoading:i,kernelCount:c,kernelLoading:b})=>G.filter(({id:_})=>!t.distribution||x("ubuntu",t)?_!=="tab-link-wsl":["tab-link-info","tab-link-wsl","tab-link-activities","tab-link-hardware"].includes(_)).map(({label:_,id:s})=>({label:W({label:_,id:s,packageCount:r,packagesLoading:u,usnCount:g,usnLoading:i,kernelCount:c,kernelLoading:b}),id:s,role:"tab",active:s===e,onClick:()=>a(s)})),X="_tabPanel_1n8p7_1",Y={tabPanel:X},Z=o.lazy(()=>d(()=>import("./index-C_DwgQYp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]))),ee=o.lazy(()=>d(()=>import("./index-yyt_10Bf.js"),__vite__mapDeps([26,1,2,15,7,16,17,6,8,9,10,27]))),ne=o.lazy(()=>d(()=>import("./index-B9w0s5qO.js"),__vite__mapDeps([28,1,2,29]))),te=o.lazy(()=>d(()=>import("./index-BuEDzBII.js"),__vite__mapDeps([30,1,2,15,7,16,17,31,4,32,18,19,20,9,10,6,8,33]))),ae=o.lazy(()=>d(()=>import("./index-B4yGJMXR.js"),__vite__mapDeps([34,1,2,14,7,15,16,17,18,19,20,9,10,4,13,21]))),se=o.lazy(()=>d(()=>import("./index-C7TlrNDZ.js"),__vite__mapDeps([35,1,2,15,7,16,17,13,36,37,31,4,32,3,22,38]))),re=o.lazy(()=>d(()=>import("./index-CI_vaVNg.js"),__vite__mapDeps([39,1,2,5,3,4,6,7,8,9,10,11,40]))),ie=o.lazy(()=>d(()=>import("./index-CwfQfNiw.js").then(e=>e.i),__vite__mapDeps([41,1,2,15,7,16,17,42,43,44,45,6,8,9,10,13,46,47]))),oe=o.lazy(()=>d(()=>import("./index-aQvIRZU0.js"),__vite__mapDeps([48,1,2,7,31,4,32,9,10,6,8,49,50,51,52,13,15,16,17,53,54,55,56,57,27]))),le=o.lazy(()=>d(()=>import("./index-ME_-7qvr.js"),__vite__mapDeps([58,1,2,13,7,59]))),ce=o.lazy(()=>d(()=>import("./index-Dzi-sKO4.js"),__vite__mapDeps([60,1,2,15,7,16,17,42,43,44,61,6,8,45,9,10,13,62]))),de=({instance:e,packageCount:t,packagesLoading:a,usnCount:r,usnLoading:u,kernelCount:g,kernelLoading:i})=>{const{closeSidePanel:c}=T(),{tab:b,setPageParams:_}=$(),s=b?`tab-link-${b}`:"tab-link-info",l=J({activeTabId:s,instance:e,onActiveTabChange:m=>{_({tab:m.replace("tab-link-","")}),c()},packageCount:t,packagesLoading:a,usnCount:r,usnLoading:u,kernelCount:g,kernelLoading:i});return n.jsxs(n.Fragment,{children:[n.jsx(p.Tabs,{listClassName:"u-no-margin--bottom",links:l}),n.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":s,className:Y.tabPanel,children:n.jsx(Q,{children:n.jsxs(o.Suspense,{fallback:n.jsx(h,{}),children:[s==="tab-link-info"&&n.jsx(Z,{instance:e}),s==="tab-link-wsl"&&n.jsx(re,{instance:e}),s==="tab-link-activities"&&n.jsx(ae,{instanceId:e.id}),s==="tab-link-kernel"&&n.jsx(se,{instanceTitle:e.title}),s==="tab-link-security-issues"&&n.jsx(oe,{instance:e}),s==="tab-link-packages"&&n.jsx(te,{}),s==="tab-link-snaps"&&n.jsx(ce,{}),s==="tab-link-processes"&&n.jsx(ee,{}),s==="tab-link-ubuntu-pro"&&n.jsx(le,{instance:e}),s==="tab-link-users"&&n.jsx(ie,{}),s==="tab-link-hardware"&&n.jsx(ne,{instance:e})]})})})]})},ue=e=>{if(e)return e.parent?[{label:"Instances",path:"/instances"},{label:e.parent.title,path:`/instances/${e.parent.id}`},{label:e.title,current:!0}]:[{label:"Instances",path:"/instances"},{label:e.title,current:!0}]},be=e=>{if(!(!e||e.length===0||!e[0].Livepatch.Fixes))return e[0].Livepatch.Fixes.length},pe=(e,t)=>e.distribution?t:0,ge=(e,t)=>e.distribution?t:0,_e=e=>(e==null?void 0:e.title)??"",me=(e,t)=>parseInt(t||(e??"")),he=(e,t,a)=>!!e&&(!t||t===a),xe=(e,t,a)=>{var r;return!!e&&x("ubuntu",e)&&(!a||((r=e.parent)==null?void 0:r.id)===parseInt(t??""))},je=(e,t,a)=>{var r;return!!e&&x("ubuntu",e)&&(!a||((r=e.parent)==null?void 0:r.id)===parseInt(t??""))},ke=(e,t,a)=>{var r;return!!e&&x("ubuntu",e)&&(!a||((r=e.parent)==null?void 0:r.id)===parseInt(t??""))},ye=e=>e?[e.id]:[],L=e=>e?e.id:0,Ie=(e,t,a)=>e&&(!a||e.parent&&e.parent.id===parseInt(t??"")),fe="_container_pnq0d_1",Pe={container:fe},ve=o.lazy(()=>d(()=>import("./index-DR2emkhB.js"),__vite__mapDeps([63,1,2,14,7,15,16,17,18,19,20,9,10,4,13,21,64,36,37,31,32,3,22,65]))),Ee=o.lazy(()=>d(()=>import("./index-g_QtjRIx.js"),__vite__mapDeps([66,1,2,14,7,15,16,17,18,19,20,9,10,4,13,21,67,64,36,37,31,32,3,22,68]))),Le=o.lazy(()=>d(()=>import("./index-D1Viyy8n.js"),__vite__mapDeps([69,1,2,14,7,15,16,17,18,19,20,9,10,4,13,21,3,67,36,37,31,32,22,68]))),Ve=({instanceName:e,hasTableData:t,kernelStatuses:a})=>{var s;const{setSidePanelContent:r}=T(),u=((s=a==null?void 0:a.installed)==null?void 0:s.version_rounded)??"",g=(a==null?void 0:a.downgrades)??[],i=(a==null?void 0:a.upgrades)??[],c=()=>{r("Downgrade kernel",n.jsx(o.Suspense,{fallback:n.jsx(h,{}),children:n.jsx(ve,{instanceName:e,currentKernelVersion:u,downgradeKernelVersions:g})}))},b=()=>{r("Upgrade kernel",n.jsx(o.Suspense,{fallback:n.jsx(h,{}),children:n.jsx(Ee,{instanceName:e,currentKernelVersion:u,upgradeKernelVersions:i})}))},_=()=>{var l;r(`Restart ${e}`,n.jsx(o.Suspense,{fallback:n.jsx(h,{}),children:n.jsx(Le,{instanceName:e,showNotification:t,newKernelVersionId:(l=i[0])==null?void 0:l.id})}))};return n.jsxs("div",{className:Pe.container,children:[n.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:"Kernel overview"}),n.jsx("div",{className:"p-segmented-control",children:n.jsxs("div",{className:"p-segmented-control__list",children:[n.jsxs(p.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:_,children:[n.jsx(p.Icon,{name:"restart"}),n.jsx("span",{children:"Restart instance"})]}),n.jsxs(p.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:g.length===0,onClick:c,children:[n.jsx(p.Icon,{name:"begin-downloading"}),n.jsx("span",{children:"Downgrade kernel"})]}),n.jsxs(p.Button,{hasIcon:!0,className:"p-segmented-control__button",type:"button",disabled:i.length===0,onClick:b,children:[n.jsx(p.Icon,{name:"change-version"}),n.jsx("span",{children:"Upgrade kernel"})]})]})},"buttons")]})};function we(){const e=V(),t=C(),a=({id:i},c={})=>E({queryKey:["kernel",i],queryFn:()=>e.get(`computers/${i}/livepatch/kernel`),...c}),r=({id:i,...c},b={})=>E({queryKey:["kernel",{id:i,...c}],queryFn:()=>e.get(`computers/${i}/livepatch/info`,{params:c}),...b}),u=v({mutationKey:["kernel","downgrade"],mutationFn:({id:i,...c})=>e.post(`computers/${i}/kernel/downgrade`,c),onSuccess:()=>t.invalidateQueries({queryKey:["kernel"]})}),g=v({mutationKey:["kernel","upgrade"],mutationFn:({id:i,...c})=>e.post(`computers/${i}/kernel/upgrade`,c),onSuccess:()=>t.invalidateQueries({queryKey:["kernel"]})});return{getKernelQuery:a,getLivepatchInfoQuery:r,downgradeKernelQuery:u,upgradeKernelQuery:g}}const Te=()=>{var I,f,P;const{instanceId:e,childInstanceId:t}=O(),{user:a}=z(),r=w(),{getSingleInstanceQuery:u}=H(),{getUsnsQuery:g}=S(),{getInstancePackagesQuery:i}=q(),{getLivepatchInfoQuery:c}=we(),b=o.useRef("");o.useEffect(()=>{a!=null&&a.current_account&&(b.current||(b.current=a.current_account),b.current!==a.current_account&&r("/instances",{replace:!0}))},[a==null?void 0:a.current_account]);const{data:_,isLoading:s}=u({instanceId:me(e,t),with_annotations:!0,with_grouped_hardware:!0},{enabled:he(e,b.current,a==null?void 0:a.current_account)}),l=(_==null?void 0:_.data)??null,{data:m,isLoading:K}=g({computer_ids:ye(l),limit:1},{enabled:ke(l,e,t)}),{data:j,isLoading:D}=i({available:!1,upgrade:!0,instance_id:L(l),limit:1},{enabled:xe(l,e,t)}),{data:k,isLoading:F}=c({id:L(l)},{enabled:je(l,e,t)}),A=be((P=(f=(I=k==null?void 0:k.data.livepatch_info)==null?void 0:I.json)==null?void 0:f.output)==null?void 0:P.Status),y=Ie(l,e,t);return n.jsxs(N,{children:[n.jsx(B,{title:_e(l),hideTitle:!0,breadcrumbs:ue(l)}),n.jsx(U,{children:s?n.jsx(h,{}):n.jsxs(n.Fragment,{children:[!y&&n.jsx(M,{childInstanceId:t,instanceId:e}),l&&y&&n.jsx(de,{instance:l,packageCount:pe(l,Number(j==null?void 0:j.data.count)),packagesLoading:D,usnCount:ge(l,Number(m==null?void 0:m.data.count)),usnLoading:K,kernelCount:l.distribution?A:0,kernelLoading:F})]})})]})},Ce=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{Ve as K,Ce as i,we as u};
