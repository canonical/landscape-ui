import{u as b,z as f,B as y,C as w,j as t,d as a,e as x,E as j}from"./index-Dfc97QGW.js";import{P as k,a as C,b as F}from"./PageMain-LS0GxKmV.js";import{b as S}from"./SidePanelFormButtons.module-CcPyiogC.js";import{g}from"./formikErrors-Bw8iTXYS.js";import{u as p}from"./useOrgSettings-D10Ykp3v.js";import{V as P}from"./constants-DP4KACWi.js";const E="_registrationContainer_16f29_1",N="_buttons_16f29_9",d={registrationContainer:E,buttons:N},O=({organisationPreferences:r})=>{const{setUser:l,user:i}=b(),c=f(),{notify:o}=y(),{changeOrganisationPreferences:u}=p(),{mutateAsync:_}=u,m={title:r.title,use_registration_key:!!r.registration_password,registration_password:r.registration_password||"",auto_register_new_computers:r.auto_register_new_computers},e=w({initialValues:m,validationSchema:P,onSubmit:async s=>{try{if(!i)return;await _({title:s.title,registration_password:s.registration_password,auto_register_new_computers:s.auto_register_new_computers}),s.title!==r.title&&l({...i,current_account:s.title,accounts:i.accounts.map(n=>n.title===r.title?{...n,title:s.title}:n)}),e.resetForm({values:{auto_register_new_computers:s.auto_register_new_computers,registration_password:s.registration_password,title:s.title,use_registration_key:s.use_registration_key}}),o.success({title:"Your changes have been saved",message:`Changes made to organization settings for ${s.title} have been successfully saved.`})}catch(n){c(n)}}}),h=s=>{e.getFieldProps("registration_password").onChange(s),e.setFieldValue("registration_password",""),e.setFieldTouched("registration_password",!1),e.setFieldError("registration_password",void 0),e.setFieldValue("auto_register_new_computers",!1)};return t.jsxs(a.Form,{noValidate:!0,onSubmit:e.handleSubmit,children:[t.jsx(a.Input,{label:"Organization's name",type:"text",help:"Visible to others in organization",error:g(e,"title"),...e.getFieldProps("title")}),t.jsx(a.Input,{label:"Use registration key",type:"checkbox",checked:e.values.use_registration_key,...e.getFieldProps("use_registration_key"),onChange:h}),e.values.use_registration_key&&t.jsxs("div",{className:d.registrationContainer,children:[t.jsx(a.Input,{labelClassName:"u-off-screen",label:"Registration key","aria-label":"Registration key",type:"text",error:g(e,"registration_password"),...e.getFieldProps("registration_password")}),t.jsx(a.Input,{label:"Auto register new computers",type:"checkbox",checked:e.values.auto_register_new_computers,help:"This will automatically accept new instances that register to your organization.",...e.getFieldProps("auto_register_new_computers")})]}),t.jsx("p",{className:"p-form-help-text",children:"When this feature is enabled, new computers must be enrolled using the key that's defined in the field."}),t.jsx("div",{className:`${S.buttons} ${d.buttons}`,children:t.jsx(a.Button,{className:"u-no-margin--bottom",appearance:"positive",type:"submit",disabled:e.isSubmitting||!e.dirty,children:"Save changes"})})]})},B=()=>{const{getOrganisationPreferences:r}=p(),{data:l,isLoading:i,refetch:c}=r(),o=l?.data,u=()=>{c()};return t.jsxs(k,{children:[t.jsx(C,{title:"General"}),t.jsxs(F,{container:"medium",children:[i&&t.jsx(x,{}),!i&&!o&&t.jsx(j,{title:"Could not load general information",icon:"connected",cta:[t.jsx(a.Button,{type:"button",appearance:"positive",onClick:u,children:"Try again"},"refetch")]}),o&&!i&&t.jsx(O,{organisationPreferences:o})]})]})};export{B as default};
