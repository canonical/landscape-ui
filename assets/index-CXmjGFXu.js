import{r as h,z as $,y as w,j as e,m as d,a1 as b,c as B,L as k}from"./index-2fzpjuii.js";import{u as A,W as S,a as N}from"./WslInstancesHeader-CiAGEctr.js";import{u as T}from"./useInstances-DeMDoX3c.js";import"./HeaderWithSearch-BIg5d4wD.js";const M="_toggleButton_bnzrt_1",W="_menu_bnzrt_6",C={toggleButton:M,menu:W},P=({instance:t,parentId:l})=>{const[c,i]=h.useState(null),{notify:a}=$(),u=w(),{setDefaultChildInstanceQuery:g,deleteChildInstancesQuery:n}=A(),{removeInstancesQuery:s}=T(),{mutateAsync:m,isPending:f}=g,{mutateAsync:L,isPending:p}=n,{mutateAsync:I,isPending:x}=s,r=()=>{i(null)},y=async()=>{try{await m({child_id:t.id,parent_id:l}),r(),a.success({title:`You queued ${t.title} to be set as the default instance`,message:`${t.title} will be the default instance.`})}catch(o){u(o)}},_=async()=>{try{await L({computer_ids:[t.id]}),r(),a.success({title:`You queued ${t.title} to be deleted.`,message:`${t.title} will be deleted.`})}catch(o){u(o)}},v=async()=>{try{await I({computer_ids:[t.id]}),r(),a.success({title:`You have successfully removed ${t.title}`,message:`${t.title} has been removed from Landscape. To manage it again, you will need to re-register it in Landscape.`})}catch(o){u(o)}},D=[{children:"Set default instance","aria-label":`Set ${t.title} as default instance`,onClick:()=>{i("setDefault")}},{children:"Remove instance from Landscape","aria-label":`Remove ${t.title} instance from Landscape`,onClick:()=>{i("remove")}},{children:"Delete instance","aria-label":`Delete ${t.title} instance`,onClick:()=>{i("delete")}}].filter(o=>o.children==="Set default instance"?!t.is_default_child:!0);return e.jsxs(e.Fragment,{children:[e.jsx(d.ContextualMenu,{position:"left",className:C.menu,toggleClassName:C.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(d.Icon,{name:"contextual-menu"}),toggleProps:{"aria-label":`${t.title} instance actions`},links:D}),c==="setDefault"&&e.jsx(d.ConfirmationModal,{title:"Set default instance",confirmButtonLabel:"Set default",confirmButtonAppearance:"positive",confirmButtonDisabled:f,confirmButtonLoading:f,onConfirm:y,close:r,children:e.jsxs("p",{children:["Are you sure you want to set ",t.title," as default instance?"]})}),e.jsx(b,{isOpen:c==="delete",close:r,title:"Delete instance",confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:p,confirmButtonLoading:p,confirmationText:`delete ${t.title}`,onConfirm:_,children:e.jsxs("p",{children:["This will permanently delete the instance ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]})}),e.jsx(b,{isOpen:c==="remove",close:r,title:"Remove instance from Landscape",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:x,confirmButtonLoading:x,confirmationText:`remove ${t.title}`,onConfirm:v,children:e.jsxs("p",{children:["This will remove the instance ",e.jsx("b",{children:t.title})," from Landscape. It will remain on the parent machine. You can re-register it to Landscape at any time."]})})]})},R="_title_s8qem_1",F="_actions_s8qem_5",j={title:R,actions:F},H=({instance:t})=>{const[l,c]=h.useState([]),{search:i}=B(),a=h.useMemo(()=>i?t.children.filter(({title:n,hostname:s})=>n.toLowerCase().includes(i.toLowerCase())||(s==null?void 0:s.toLowerCase().includes(i.toLowerCase()))):t.children,[t,i]),u=n=>{c(s=>s.some(({id:m})=>m===n.id)?s.filter(({id:m})=>m!==n.id):[...s,n])},g=h.useMemo(()=>[{accessor:"title",Header:e.jsxs(e.Fragment,{children:[e.jsx(d.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),checked:a.length>0&&l.length===a.length,indeterminate:l.length>0&&l.length<a.length,onChange:()=>{c(l.length>0?[]:a)}}),e.jsx("span",{children:"Title"})]}),Cell:({row:n})=>e.jsxs("div",{className:j.title,children:[e.jsx(d.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${n.original.title} instance`}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:l.some(({id:s})=>s===n.original.id),onChange:()=>u(n.original)}),e.jsx(k,{to:`/instances/${t.id}/${n.original.id}`,children:n.original.title})]})},{accessor:"distribution",Header:"OS",Cell:({row:{original:n}})=>n.distribution?`UbuntuÂ ${n.distribution}`:"Unknown"},{accessor:"default",Header:"Default",Cell:({row:{original:n}})=>e.jsx(e.Fragment,{children:n.is_default_child?"Yes":"No"})},{accessor:"actions",className:j.actions,Header:"Actions",Cell:({row:{original:n}})=>e.jsx(P,{instance:n,parentId:t.id})}],[a,l]);return e.jsxs(e.Fragment,{children:[e.jsx(S,{selectedInstances:l}),e.jsx(d.ModularTable,{columns:g,data:a,emptyMsg:"No WSL instances found"})]})},O=({instance:t})=>t.children.length!==0?e.jsx(H,{instance:t}):e.jsx(N,{});export{O as default};
