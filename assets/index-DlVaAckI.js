const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BK3RWRlC.js","assets/index-CL5bVZIc.js","assets/index-C-gptq0K.css","assets/useInstances-qrjnMeDp.js","assets/SidePanelFormButtons-BrkTX0tv.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/useRoles-BtYKFtaf.js","assets/index-D-MNTyK3.js","assets/ScriptsTabs-Qo2YT41p.js","assets/TruncatedCell-CJm20b4d.js","assets/TruncatedCell-CoXbu3VM.css","assets/HeaderWithSearch-B9k4oQln.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-DXH3TzoK.js","assets/ScriptsTabs-DBE3pWGL.css","assets/DeliveryBlock-BiGBDU8T.js","assets/DeliveryBlock-VExRkUer.css","assets/formikErrors-Bw8iTXYS.js","assets/ScriptDropdown-DrS09agH.js","assets/downshift.esm-D6VqpLlj.js","assets/ScriptDropdown-B5XgtP-0.css","assets/index-B0R6tjbX.js","assets/CodeEditor-vfrLjct9.js","assets/CodeEditor-CwlLRp3p.css","assets/ScriptFormAttachments-BBpqduMS.js","assets/AttachmentFile-Bkw-4tz2.js","assets/AttachmentFile-Br6SRBhg.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-BXz_UDI8.js","assets/EmployeeGroupIdentityIssuerList-BhzBsjR7.js","assets/EmployeeGroupIdentityIssuerList-DJkUyphv.css","assets/EmployeeList-CUlO9F_N.js","assets/EmployeeList-BthGffhq.css","assets/index-CbvjFctk.css"])))=>i.map(i=>d[i]);
import{j as e,n as v,aE as ge,r as i,m as s,G as le,aF as xe,ap as _e,o as V,C as be,a9 as ve,F as je,v as se,a8 as ne,N as I,D as ye,a as Ie,y as Ce,V as we,z as Se,l as Ne,b as Ae,A as Te,I as ke,a1 as ae,_ as X}from"./index-CL5bVZIc.js";import{u as J}from"./useInstances-qrjnMeDp.js";import{b as Ee}from"./helpers-Dq7JMvVJ.js";import{u as Be}from"./useRoles-BtYKFtaf.js";import"./InstancesPageActions-2izvGRg-.js";import{u as Re,T as De}from"./useTaggedSecurityProfiles-CyA6zK0W.js";import{u as ze}from"./WslInstancesHeader-CZqG_Oif.js";import{g as oe}from"./formikErrors-Bw8iTXYS.js";import"./HeaderWithSearch-B9k4oQln.js";const Pe="_infoContainer_1ca11_1",Le="_amount_1ca11_9",ie={infoContainer:Pe,amount:Le},$e=({isExpanded:t,overflowingChipsAmount:n})=>n>0&&!t&&e.jsx("div",{className:ie.infoContainer,children:e.jsx("span",{className:v("u-text--muted",ie.amount),children:`+${n}`})}),qe=({containerRef:t,onDismiss:n,onOverflowingItemsAmountChange:l,tagData:c})=>{const u=()=>{if(!t.current)return;const r=t.current.querySelectorAll("span.p-chip");l(Array.from(r).filter(({offsetHeight:x,offsetTop:p})=>p>x).length)};return ge("resize",u),i.useEffect(()=>{u()},[c.length]),c.map(r=>e.jsx(s.Chip,{value:r,onDismiss:()=>{n(r)}},r))},Fe="_container_1f6mu_1",Oe="_list_1f6mu_6",Ve="_listItem_1f6mu_11",Me="_search_1f6mu_17",O={container:Fe,list:Oe,listItem:Ve,search:Me},Qe=({onTagClick:t,tags:n})=>n.length?e.jsxs("div",{className:O.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Tags"}),e.jsx("ul",{className:v("p-list--divided u-no-margin--bottom",O.list),children:n.map(l=>e.jsx("li",{children:e.jsx("div",{className:O.listItem,children:e.jsx(s.Button,{type:"button",appearance:"base",className:O.search,onClick:()=>t(l),children:l})})},l))})]}):null,He="_container_fqj7b_1",Ue="_prompt_fqj7b_10",We="_saveButton_fqj7b_17",K={container:He,prompt:Ue,saveButton:We},Ze=({onTagAdd:t,search:n})=>e.jsx(e.Fragment,{children:n&&e.jsxs("div",{className:K.container,children:[e.jsxs("span",{className:K.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:n}),e.jsx("span",{children:"..."})]}),e.jsx(s.Button,{type:"button",appearance:"link",onClick:t,className:K.saveButton,children:"Add tag"})]})}),re=le().matches(/^[a-zA-Z]/,{message:"Tag must starts with a letter",excludeEmptyString:!0}).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,{message:"Tag can only contain letters, numbers, hyphens, and underscores",excludeEmptyString:!0}),Ge="_searchContainer_zkd2s_1",Ye="_box_zkd2s_9",Ke="_inputContainer_zkd2s_14",Je="_inputError_zkd2s_19",Xe="_input_zkd2s_14",k={searchContainer:Ge,box:Ye,inputContainer:Ke,inputError:Je,input:Xe},et=({onTagsChange:t,tags:n,label:l,labelClassName:c,required:u})=>{var $;const[r,x]=i.useState(""),[p,_]=i.useState(""),[j,N]=i.useState(!1),[y,A]=i.useState(""),[b,C]=i.useState(!1),[M,Q]=i.useState(0),{height:E}=xe(),[H,B]=i.useState({top:"100%",bottom:"auto"}),{getAllInstanceTagsQuery:U}=J(),w=i.useRef(null),m=i.useRef(null);i.useEffect(()=>{if(!m.current)return;const a=m.current.querySelector("input");a&&A(a.id)},[m.current]);const W=()=>{if(!m.current)return;const{top:a,height:h}=m.current.getBoundingClientRect();a+h+379<E?B({top:"100%",bottom:"auto"}):B({top:"auto",bottom:"100%"})};i.useEffect(()=>{!b||!m.current||W()},[E,b,m.current,($=m.current)==null?void 0:$.clientHeight]);const R=()=>{C(!1)};_e(w,R);const Z=a=>{t(n.filter(h=>h!==a))},{data:f,isLoading:D}=U(),z=i.useMemo(()=>f?!r&&!n.length?f.data.results:f.data.results.filter(a=>!n.includes(a)).filter(a=>a.toLowerCase().includes(r.trim().toLowerCase())):[],[f,r,n]),P=a=>{t([...n,a])},T=()=>{if(r.trim())try{const a=re.validateSync(r.trim())??"";P(a),x(""),_(""),N(!1)}catch(a){a instanceof Error&&(_(a.message),N(!0))}},G=a=>{if(x(a.target.value),j)try{re.validateSync(a.target.value),_("")}catch(h){h instanceof Error&&_(h.message)}},L=a=>{const{key:h}=a;b?(h==="Escape"&&R(),h==="Enter"&&T()):h==="Enter"&&C(!0)};return e.jsxs("div",{children:[e.jsx("label",{className:v("p-form__label",{"is-required":u},c),htmlFor:y,children:l||"Tags"}),e.jsxs("div",{className:"p-search-and-filter",ref:w,children:[e.jsxs("div",{className:v("p-search-and-filter__search-container",k.searchContainer),"aria-expanded":b,ref:m,onClick:()=>{C(!0)},children:[e.jsx(qe,{containerRef:m,onDismiss:Z,onOverflowingItemsAmountChange:a=>{Q(a)},tagData:n}),e.jsx("div",{className:v("p-search-and-filter__box",k.box),children:e.jsx("div",{className:k.inputContainer,children:e.jsx(s.Input,{type:"text",autoComplete:"off",value:r,onChange:G,placeholder:"Add tags",className:v("u-no-margin--bottom",k.input),onClick:()=>{C(!0)},onKeyUp:L,wrapperClassName:p?"is-error":"","aria-errormessage":p?`${y}-error`:void 0,"aria-invalid":!!p})})}),p&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:v("p-form-validation__message",k.inputError),id:`${y}-error`,children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:p})]})}),e.jsx($e,{isExpanded:b,overflowingChipsAmount:M})]}),b&&D&&e.jsx(V,{}),b&&!D&&e.jsxs("div",{className:"p-search-and-filter__panel",style:H,children:[e.jsx(Ze,{onTagAdd:T,search:r}),e.jsx(Qe,{onTagClick:P,tags:z})]})]})]})},tt={deliver_after:"",deliverImmediately:!0,action:null},st=be().shape({deliver_after:le().when("deliverImmediately",{is:!1,then:t=>t.required("This field is required").test({message:"Invalid date",test:n=>se(n).isValid()}).test({message:"Date must be in the future",test:n=>se(n).isAfter()})}),deliverImmediately:je(),action:ve().oneOf(["shutdown","reboot"]).required()}),nt=t=>{var l;const n=(l=t.grouped_hardware)==null?void 0:l.network;return!Array.isArray(n)||n.length===0?e.jsx(I,{}):n.filter(({ip:c})=>c!=="Not available").map(({ip:c})=>c).join(", ")||e.jsx(I,{})},at=(t,n)=>{var l,c,u;return[{label:"instance ID",value:t.id},{label:"Hostname",value:t.hostname},{label:"IP Address",value:nt(t)},{label:"Serial number",value:((l=t.grouped_hardware)==null?void 0:l.system.serial)??e.jsx(I,{})},{label:"Product identifier",value:((c=t.grouped_hardware)==null?void 0:c.system.model)??e.jsx(I,{})},{label:"Distribution",value:t.distribution??"Unknown"},{label:"Access group",value:((u=n.find(({value:r})=>r===t.access_group))==null?void 0:u.label)||t.access_group},{label:"Last ping time",value:t.last_ping_time&&ne(t.last_ping_time).isValid()?ne(t.last_ping_time).format(ye):e.jsx(I,{})},{label:"Annotations",value:t.annotations?Object.entries(t.annotations).map(([r,x],p,_)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:`${r}: ${x}`}),p<_.length-1&&e.jsx("br",{})]})):e.jsx(I,{})},{label:"Comment",value:t.comment||e.jsx(I,{})}]},ot="_titleRow_oxqvk_1",it="_flexContainer_oxqvk_6",rt="_italic_oxqvk_11",lt="_infoRow_oxqvk_15",ct="_tagSection_oxqvk_20",dt="_tagsRow_oxqvk_25",ut="_tagsButton_oxqvk_34",g={titleRow:ot,flexContainer:it,italic:rt,infoRow:lt,tagSection:ct,tagsRow:dt,tagsButton:ut},mt=i.lazy(async()=>X(()=>import("./index-BK3RWRlC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),pt=i.lazy(async()=>X(()=>import("./index-D-MNTyK3.js"),__vite__mapDeps([8,9,1,2,10,11,7,12,13,14,15,16,17,4,5,6,18,19,20,21,22,23,24,25,26,27,28,29,30])).then(t=>({default:t.RunInstanceScriptForm}))),ht=i.lazy(async()=>X(()=>import("./index-BXz_UDI8.js"),__vite__mapDeps([31,1,2,4,5,6,16,32,12,13,10,11,33,34,35,22,36]))),Ct=({instance:t})=>{const[n,l]=i.useState([...t.tags]),[c,u]=i.useState(""),r=n.filter(o=>!t.tags.includes(o)),{securityProfiles:x,isSecurityProfilesLoading:p}=Re(r,[t]),_=Ie(),j=Ce(),{openActivityDetails:N}=we(),{notify:y}=Se(),{setSidePanelContent:A}=Ne(),{getAccessGroupQuery:b}=Be(),{removeInstancesQuery:C,rebootInstancesQuery:M,sanitizeInstanceQuery:Q,shutdownInstancesQuery:E}=J(),{deleteChildInstancesQuery:H}=ze(),{editInstanceQuery:B}=J(),{isFeatureEnabled:U}=Ae();i.useEffect(()=>{l([...t.tags])},[t.tags]);const{data:w}=b(),m=(w==null?void 0:w.data.map(({name:o,title:F})=>({label:F,value:o})))??[],{mutateAsync:W,isPending:R}=B,{mutateAsync:Z,isPending:f}=C,{mutateAsync:D,isPending:z}=M,{mutateAsync:P,isPending:T}=E,{mutateAsync:G,isPending:L}=H,{mutateAsync:$,isPending:a}=Q,d=Te({initialValues:tt,validationSchema:st,onSubmit:async o=>{if(!o.action)return;const F={computer_ids:[t.id],deliver_after:o.deliverImmediately?void 0:`${o.deliver_after}:00Z`};try{const{data:Y}=o.action==="reboot"?await D(F):await P(F),te=o.action==="reboot"?"restarted":"shut down";y.success({title:`You queued "${t.title}" to be ${te}`,message:`Instance "${t.title}" will be ${te} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{N(Y)}}]})}catch(Y){j(Y)}}}),S=()=>{u("")},ce=async()=>{try{await Z({computer_ids:[t.id]}),S(),_("/instances",{replace:!0})}catch(o){j(o)}},de=async()=>{try{const{data:o}=await $({computer_id:t.id,computer_title:t.title});S(),y.success({title:`You have successfully initiated Sanitization for ${t.title}`,message:`Sanitizing for ${t.title} has been queued in Activities. The data will be permanently irrecoverable once complete.`,actions:[{label:"View details",onClick:()=>{N(o)}}]})}catch(o){j(o)}},ee=async()=>{try{await W({instanceId:t.id,tags:n}),S(),y.success({title:"Tags updated",message:`"${t.title}" instance tags have been updated successfully`})}catch(o){j(o)}},ue=async()=>{x.length?u("securityProfilesTags"):ee()},me=()=>{A("Edit Instance",e.jsx(i.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(mt,{instance:t})}))},pe=()=>{A("Run script",e.jsx(i.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(pt,{parentAccessGroup:t.access_group,query:`id:${t.id}`})}))},he=()=>{A(`Associate Employee with ${t.title}`,e.jsx(i.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(ht,{instanceTitle:t.title,employeeId:t.employee_id})}))},fe=async()=>{try{await G({computer_ids:[t.id]}),_("/instances",{replace:!0})}catch(o){j(o)}},q=async o=>{await d.setFieldValue("action",o),d.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:g.titleRow,children:[e.jsxs("div",{className:g.flexContainer,children:[e.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:t.title}),t.is_wsl_instance&&e.jsx("p",{className:v("u-text--muted u-no-margin--bottom",g.italic),children:"WSL Instance"})]}),e.jsxs("div",{className:g.flexContainer,children:[t.is_wsl_instance&&e.jsx(s.ConfirmationButton,{className:"u-no-margin--bottom u-no-margin--right",type:"button",confirmationModalProps:{title:"Delete instance",children:e.jsxs("p",{children:["This will permanently delete the instance"," ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:L,confirmButtonLoading:L,onConfirm:fe},children:"Delete instance"}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:me,hasIcon:!0,children:[e.jsx(s.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),Ee("runScripts",t)&&e.jsxs(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:pe,hasIcon:!0,children:[e.jsx(s.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]}),e.jsxs(s.Button,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:f,onClick:()=>{u("remove")},"aria-label":`Remove ${t.title} instance`,children:[e.jsx(s.Icon,{name:s.ICONS.delete}),e.jsx("span",{children:"Remove from Landscape"})]}),e.jsxs(s.Button,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:a,onClick:()=>{u("sanitize")},"aria-label":`Sanitize ${t.title} instance`,children:[e.jsx(s.Icon,{name:"tidy"}),e.jsx("span",{children:"Sanitize"})]}),e.jsxs(s.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:f,confirmationModalProps:{title:"Restart instance",children:e.jsxs(s.Form,{onSubmit:async()=>q("reboot"),noValidate:!0,children:[e.jsx(s.CheckboxInput,{label:"Deliver as soon as possible",...d.getFieldProps("deliverImmediately"),checked:d.values.deliverImmediately}),e.jsx(s.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:g.input,placeholder:"Scheduled time",...d.getFieldProps("deliver_after"),disabled:d.values.deliverImmediately,error:oe(d,"deliver_after")}),e.jsxs("p",{children:['This will restart "',t.title,'" instance.']})]}),confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonDisabled:z,confirmButtonLoading:z,onConfirm:async()=>q("reboot")},children:[e.jsx(s.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]}),U("employee-management")&&e.jsxs(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",hasIcon:!0,onClick:he,children:[e.jsx(s.Icon,{name:s.ICONS.user}),e.jsx("span",{children:"Associate employee"})]}),e.jsxs(s.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:f,confirmationModalProps:{title:"Shut down instance",children:e.jsxs(s.Form,{onSubmit:async()=>q("shutdown"),noValidate:!0,children:[e.jsx(s.CheckboxInput,{label:"Deliver as soon as possible",...d.getFieldProps("deliverImmediately"),checked:d.values.deliverImmediately}),e.jsx(s.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:g.input,placeholder:"Scheduled time",...d.getFieldProps("deliver_after"),disabled:d.values.deliverImmediately,error:oe(d,"deliver_after")}),e.jsxs("p",{children:['This will shut down "',t.title,'" instance.']})]}),confirmButtonLabel:"Shutdown",confirmButtonAppearance:"negative",confirmButtonDisabled:T,confirmButtonLoading:T,onConfirm:async()=>q("shutdown")},children:[e.jsx(s.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]})]})},"buttons")]})]}),e.jsx("div",{className:g.infoRow,children:e.jsx(s.Row,{className:"u-no-padding--left u-no-padding--right u-no-max-width",children:at(t,m).map(o=>e.jsx(s.Col,{size:4,children:e.jsx(ke,{...o})},o.label))})}),e.jsx("div",{className:g.tagSection,children:e.jsxs(s.Row,{className:g.tagsRow,children:[e.jsx(s.Col,{size:4,children:e.jsx(et,{labelClassName:"p-text--small p-text--small-caps u-text--muted",onTagsChange:o=>{l(o)},tags:n})}),e.jsx(s.Col,{size:2,className:g.tagsButton,children:e.jsx(s.Button,{type:"button",className:"u-no-margin--bottom",onClick:ue,disabled:p,children:"Update"})})]})}),c==="securityProfilesTags"&&e.jsx(De,{instances:[t],securityProfiles:x,tags:r,onConfirm:ee,confirmButtonDisabled:R,close:S}),e.jsx(ae,{isOpen:c==="remove",title:"Remove instance from Landscape",confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:f,confirmButtonLoading:f,onConfirm:ce,close:S,confirmationText:`remove ${t.title}`,children:e.jsxs("p",{children:["Removing this ",t.title," will delete all associated data and free up one license slot for another computer to be registered."]})}),e.jsx(ae,{isOpen:c==="sanitize",confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:a,confirmButtonLoading:a,onConfirm:de,close:S,confirmationText:`sanitize ${t.title}`,title:"Sanitize instance",children:e.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",t.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})};export{Ct as default};
