import{j as e,r as w,w as I,y,T as j,g as n,A as _,p as E,x as S,a as T,s as N,h as U,k as v,n as A,C as O}from"./index-_k3Mqmx0.js";import{u as L,A as k}from"./AuthTemplate-C6MS7VJ0.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new s.Error().stack;a&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[a]="c7ad89dd-a7cb-47db-a5fb-412c4ca10104",s._sentryDebugIdIdentifier="sentry-dbid-c7ad89dd-a7cb-47db-a5fb-412c4ca10104")}catch{}const B=({methods:s})=>{if(!s)return null;const a=!!(s.standalone_oidc.available&&s.standalone_oidc.enabled),l=!!(s.ubuntu_one.available&&s.ubuntu_one.enabled),i=!!(s.password.available&&s.password.enabled),c=!!(s.pam.available&&s.pam.enabled),b=s.oidc.available?s.oidc.configurations.filter(({enabled:d})=>d):[],o=i||c,m=l||a||s.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[o&&e.jsx(D,{isIdentityAvailable:c}),m&&e.jsx(C,{isStandaloneOidcEnabled:a,isUbuntuOneEnabled:l,oidcProviders:b}),!o&&!m&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},R="_list_9u1s7_1",F="_button_9u1s7_20",q="_icon_9u1s7_28",u={list:R,button:F,icon:q},C=({isStandaloneOidcEnabled:s,isUbuntuOneEnabled:a,oidcProviders:l})=>{const[i,c]=w.useState(0),[b]=I(),{invitationId:o}=L(),{getOidcUrlQuery:m,getUbuntuOneUrlQuery:d}=y(),p=b.get("redirect-to"),f=b.has("external"),t={};i>0&&(t.id=i),p&&(t.return_to=p),o&&(t.invitation_id=o),f&&(t.external=!0);const{data:g}=m(t,{enabled:i!==0});w.useEffect(()=>{g&&j(g.data.location)},[g]);const r={};p&&(r.return_to=`${window.origin}${p}`),o&&(r.invitation_id=o),f&&(r.external=!0);const{data:x,refetch:P}=d(r,{enabled:!1});return w.useEffect(()=>{x&&j(x.data.location)},[x]),e.jsxs("ul",{className:u.list,children:[a&&e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:P,className:u.button,children:[e.jsx(n.Icon,{name:_("ubuntu-one"),className:u.icon}),e.jsx("span",{children:"Sign in with Ubuntu One"})]})}),s&&e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:()=>c(-1),className:u.button,children:[e.jsx(n.Icon,{name:_("standalone"),className:u.icon}),e.jsx("span",{children:"Sign in with Enterprise Login"})]})}),l.map(h=>e.jsx("li",{className:"p-list__item",children:e.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:()=>c(h.id),className:u.button,children:[e.jsx(n.Icon,{name:_(h.provider),className:u.icon}),e.jsx("span",{children:`Sign in with ${h.name}`})]})},h.id))]})},Q="_buttonRow_f3s21_1",$={buttonRow:Q},D=({isIdentityAvailable:s})=>{const[a]=I(),l=E(),{signInWithEmailAndPasswordQuery:i}=y(),{redirectToExternalUrl:c,setAuthLoading:b,setUser:o}=S(),m=T(),d=a.get("redirect-to"),p=a.has("external"),{mutateAsync:f}=i,t=N({initialValues:{email:"",password:""},validationSchema:U().shape({email:s?v().required("This field is required"):v().required("This field is required").email("Please provide a valid email address"),password:v().required("This field is required")}),onSubmit:async g=>{try{const{data:r}=await f({email:g.email,password:g.password});p&&d?c(d,{replace:!0}):("current_account"in r&&(b(!0),o(r)),m(d??"/overview",{replace:!0}))}catch(r){l(r)}}});return e.jsxs(n.Form,{onSubmit:t.handleSubmit,children:[e.jsx(n.Input,{type:"text",label:s?"Identity":"Email",error:t.touched.email&&t.errors.email?t.errors.email:void 0,...t.getFieldProps("email"),"data-testid":"email"}),e.jsx(n.PasswordToggle,{id:"password",label:"Password",error:t.touched.password&&t.errors.password?t.errors.password:void 0,...t.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:$.buttonRow,children:e.jsx(n.Button,{type:"submit",appearance:"positive",disabled:t.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},W=()=>{const{getLoginMethodsQuery:s}=y(),{data:a,isLoading:l,isError:i}=s();return e.jsx(k,{title:"Sign in to Landscape",children:l?e.jsx(A,{}):i?e.jsx("p",{className:"u-no-margin--bottom",children:O}):e.jsx(B,{methods:(a==null?void 0:a.data)??null})})};export{W as default};
