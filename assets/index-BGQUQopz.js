const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CZfN7hLm.js","assets/index-bwXOAcKK.js","assets/index-CsTxpRsw.css","assets/moment-C5S46NFB.js","assets/InfoItem-D5kMV4a4.js","assets/InfoItem-C-lWh_lY.css","assets/useInstances-C7K6KmIB.js","assets/useFetchOld-ByPhVfhm.js","assets/moment-MRI66HFk.js","assets/TablePagination-Dw6MtsuZ.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/usePageParams-TpNL_kGt.js","assets/NoData-DpInLn0M.js","assets/index-4jXkfcLF.css"])))=>i.map(i=>d[i]);
import{j as e,E as te,d as a,c as F,r as _,_ as P,h as se,e as ae,i as Z,f as M,g as V,o as H,K as ne,t as ie,k as ce,n as G,p as oe,L as le,R as re,D as ue}from"./index-bwXOAcKK.js";import{m as de}from"./moment-MRI66HFk.js";import{T as me}from"./TablePagination-Dw6MtsuZ.js";import{u as B}from"./usePageParams-TpNL_kGt.js";import{u as pe}from"./useFetchOld-ByPhVfhm.js";import{N as he}from"./NoData-DpInLn0M.js";const ge=()=>e.jsx(te,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no activities yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage computers in Landscape"})]}),icon:"switcher-environments",title:"No activities found"}),_e="_wrapper_1avtj_1",fe="_search_1avtj_9",xe="_buttonContainer_1avtj_13",be="_button_1avtj_13",ye="_icon_1avtj_43",L={wrapper:_e,search:fe,buttonContainer:xe,button:be,icon:ye},je=({inputValue:s,onDescriptionClick:t,onInputChange:o,onSearchClick:r,onClear:i})=>e.jsxs("div",{className:L.wrapper,children:[e.jsx(a.SearchBox,{autocomplete:"off",shouldRefocusAfterReset:!0,externallyControlled:!0,value:s,onChange:o,onSearch:r,onClear:i,className:F("u-no-margin--bottom",L.search)}),e.jsx("div",{className:L.buttonContainer,children:e.jsx(a.Button,{type:"button",onClick:t,className:L.button,children:e.jsx(a.Icon,{name:a.ICONS.help,className:L.icon})})})]}),ve="_term_1p61y_1",Ce={term:ve},Se=({open:s,onClose:t,data:o})=>{const r=[{Header:"Term",accessor:"term",className:Ce.term,Cell:({value:i})=>typeof i=="string"?e.jsx("code",{children:i}):null},{Header:"Description",accessor:"description",Cell:({value:i})=>typeof i=="string"||_.isValidElement(i)?e.jsx("span",{className:"u-text--muted",children:i}):null}];return s&&e.jsxs(a.Modal,{title:"Search help",close:t,children:[e.jsx("p",{children:"Available search terms for use in the search box. If multiple search terms are separated by OR, any of the conditions will match. Otherwise, all conditions must be met for a instance to match. When a term is preceded by NOT, the condition must not match. If the searched value contains spaces or non-ASCII characters, it must be quoted."}),e.jsx(a.ModularTable,{className:"u-no-margin--bottom",columns:_.useMemo(()=>r,[]),data:_.useMemo(()=>o,[])})]})},Ae="_container_1le1l_1",Te="_sticky_1le1l_9",Ne="_searchContainer_1le1l_15",Ie="_filters_1le1l_19",R={container:Ae,sticky:Te,searchContainer:Ne,filters:Ie},we="_iconError_xphpu_1",De="_iconWarning_xphpu_5",ke="_iconWarningRed_xphpu_9",z={iconError:we,iconWarning:De,iconWarningRed:ke},K={succeeded:{icon:"success",label:"Succeeded"},scheduled:{icon:"spinner",label:"Scheduled"},waiting:{icon:"status-waiting",label:"Waiting"},undelivered:{icon:"status-queued",label:"Queued"},delivered:{icon:"status-in-progress",label:"In progress"},blocked:{icon:`warning-grey ${z.iconWarningRed}`,label:"Blocked"},unapproved:{icon:`warning-grey ${z.iconWarning}`,label:"Unapproved"},canceled:{icon:"error-grey",label:"Cancelled"},failed:{icon:`error-grey ${z.iconError}`,label:"Failed"}},$e=[{term:"id:<activity_id>",description:"Search for activities with a specific ID."},{term:"parent-id:<parent_id>",description:"Search for children activities of a specific ID."},{term:"created-after:<date>",description:e.jsxs("span",{children:["Search for activities created after a specific date or time, specified with the ISO-8601 format. The precision depends on how far you specify, for example ",e.jsx("code",{children:"2011-01"}),", ",e.jsx("code",{children:"2011-01-01"}),","," ",e.jsx("code",{children:"2011-01-01T10:30"})," are valid values."]})},{term:"created-before:<date>",description:"Search for activities created before a specific date or time. The format is the same as created-after."},{term:"creator:<email>",description:"Search for activities created by a particular person (specified by email address)."},{term:"computer:<criteria>",description:"Search for activities related to the given instances. The criteria is itself another query argument to search instances. See Instance Queries for details."},{term:"type:<type>",description:"Search for activities of a specific type."}],J=[{label:"All",value:""},...Object.entries(K).filter(([s])=>s!=="unapproved").map(([s,{label:t}])=>({label:t,value:s}))],Fe="_toggle_1pcmw_1",Be="_badgeContainer_1pcmw_7",Ee="_multiple_1pcmw_12",Le="_badge_1pcmw_7",Qe="_dropdown_1pcmw_23",Me="_container_1pcmw_27",Re="_horizontalPadding_1pcmw_32",He="_list_1pcmw_37",qe="_listItem_1pcmw_46",Ve="_separated_1pcmw_53",ze="_button_1pcmw_59",We="_selected_1pcmw_66",Ke="_footer_1pcmw_72",b={toggle:Fe,badgeContainer:Be,multiple:Ee,badge:Le,dropdown:Qe,container:Me,horizontalPadding:Re,list:He,listItem:qe,separated:Ve,button:ze,selected:We,footer:Ke},Pe=({onSearch:s})=>{const[t,o]=_.useState("");return e.jsx(a.Form,{onSubmit:r=>{r.preventDefault(),s(t)},children:e.jsx(a.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autoComplete:"off",value:t,onChange:r=>o(r),onSearch:()=>s(t),onClear:()=>{o(""),s("")}})})},O=({disabledOptions:s,hasBadge:t,hasToggleIcon:o,label:r,options:i,onSearch:g,position:f="left",...n})=>{const y=u=>{n.multiple&&n.onItemsSelect(n.selectedItems.includes(u.target.value)?n.selectedItems.filter(x=>x!==u.target.value):[...n.selectedItems,u.target.value])};return e.jsxs(a.ContextualMenu,{autoAdjust:!0,toggleAppearance:"base",toggleLabel:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:r}),t&&e.jsx("span",{className:F(b.badgeContainer,{[b.multiple]:n.multiple&&i.length>9}),children:(n.multiple&&n.selectedItems.length>0||!n.multiple&&n.selectedItem)&&e.jsx(a.Badge,{value:n.multiple?n.selectedItems.length:1,className:b.badge})})]}),toggleClassName:b.toggle,hasToggleIcon:o,dropdownClassName:b.dropdown,position:f,onToggleMenu:u=>{u&&g&&g("")},children:[e.jsxs("span",{className:F(b.container,{[b.multiple]:n.multiple,[b.horizontalPadding]:n.multiple||g}),children:[g&&e.jsx(Pe,{onSearch:g}),e.jsx("ul",{className:b.list,children:i.map(({label:u,value:x,group:p},l)=>e.jsxs("li",{className:F({[b.listItem]:n.multiple,[b.separated]:p&&i[l+1]!==void 0&&i[l+1].group!==p}),children:[n.multiple&&e.jsx(a.Input,{type:"checkbox",label:u,labelClassName:"u-no-padding--top u-no-margin--bottom",value:x,onChange:y,checked:n.selectedItems.includes(x),disabled:s==null?void 0:s.some(h=>h.value===x)}),!n.multiple&&n.selectedItem!==x&&e.jsx(a.Button,{type:"button",appearance:"base",className:b.button,onClick:()=>n.onItemSelect(x),children:u}),!n.multiple&&n.selectedItem===x&&e.jsx("span",{className:b.selected,children:u})]},x))})]}),n.multiple&&e.jsxs("span",{className:b.footer,children:[e.jsx(a.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>n.onItemsSelect(i.map(({value:u})=>u)),children:"Select all"}),n.showSelectedItemCount?e.jsx("span",{className:"u-text--muted",children:`${n.selectedItems.length} of ${i.length} selected`}):e.jsx(a.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>n.onItemsSelect([]),children:"Clear"})]})]})},Ye=({options:s})=>{const{setPageParams:t,status:o}=B();return e.jsx(O,{multiple:!1,label:"Status",hasToggleIcon:!0,hasBadge:!0,options:s,onItemSelect:r=>t({status:r}),selectedItem:o})},Ue="_container_1ctbs_1",Ge="_chipsContainer_1ctbs_8",Je="_collapsed_1ctbs_16",Xe="_clearAllButton_1ctbs_21",Ze="_showLessButton_1ctbs_22",Oe="_showMoreButton_1ctbs_23",et="_clearAllIcon_1ctbs_38",$={container:Ue,chipsContainer:Ge,collapsed:Je,clearAllButton:Xe,showLessButton:Ze,showMoreButton:Oe,clearAllIcon:et},tt=["accessGroups","availabilityZones","os","search","status","tags"],st=({accessGroupOptions:s,availabilityZonesOptions:t,filtersToDisplay:o,osOptions:r,statusOptions:i,tagOptions:g,typeOptions:f})=>{var k,Y,U;const[n,y]=_.useState(!1),[u,x]=_.useState(0),p=o??tt,l=_.useRef(null),{setPageParams:h,accessGroups:S,availabilityZones:j,fromDate:N,os:A,status:d,tags:I,toDate:v,type:D}=B(),q=()=>{h({accessGroups:[],availabilityZones:[],fromDate:"",os:"",status:"",tags:[],toDate:"",type:""}),y(!1)},E=()=>{if(!l.current)return;const m=[...l.current.querySelectorAll(".p-chip")];if(!m.length)return x(0);const Q=m[0].offsetTop,w=m.filter(({offsetTop:T})=>T>Q).length;w===0&&(y(!1),x(0)),x(w)};_.useEffect(()=>(window.addEventListener("resize",E),()=>{window.removeEventListener("resize",E)}),[]),_.useEffect(()=>{E()},[S.length,j.length,N,u,A,d,I.length,v,D]);const c=[...[d].slice(p.includes("status")?0:1),...[A].slice(p.includes("os")?0:1),...j.slice(p.includes("availabilityZones")?0:j.length),...S.slice(p.includes("accessGroups")?0:S.length),...I.slice(p.includes("tags")?0:I.length),...[N].slice(p.includes("fromDate")?0:1),...[v].slice(p.includes("toDate")?0:1),...[D].slice(p.includes("type")?0:1)].filter(Boolean).length>1;return e.jsxs("div",{className:$.container,children:[e.jsxs("div",{ref:l,className:F($.chipsContainer,{[$.collapsed]:!n}),children:[c&&e.jsxs(a.Button,{type:"button",appearance:"link",hasIcon:!0,className:$.clearAllButton,onClick:q,children:[e.jsx(a.Icon,{name:"close",className:$.clearAllIcon}),e.jsx("span",{children:"Clear all filters"})]}),p.includes("status")&&d&&e.jsx(a.Chip,{value:`Status: ${((k=i==null?void 0:i.find(({value:m})=>m===d))==null?void 0:k.label)??d}`,onDismiss:()=>h({status:""}),className:"u-no-margin--bottom u-no-margin--right"}),p.includes("os")&&A&&e.jsx(a.Chip,{value:`OS: ${((Y=r==null?void 0:r.find(({value:m})=>m===A))==null?void 0:Y.label)??A}`,onDismiss:()=>h({os:""}),className:"u-no-margin--bottom u-no-margin--right"}),p.includes("availabilityZones")&&j.map((m,Q,w)=>{var T;return e.jsx(a.Chip,{value:`Availability z.: ${((T=t==null?void 0:t.find(({value:C})=>C===m))==null?void 0:T.label)??m}`,onDismiss:()=>h({availabilityZones:w.filter(C=>C!==m)}),className:"u-no-margin--bottom u-no-margin--right"},m)}),p.includes("accessGroups")&&S.map((m,Q,w)=>{var T;return e.jsx(a.Chip,{value:`Access group: ${((T=s==null?void 0:s.find(({value:C})=>C===m))==null?void 0:T.label)??m}`,onDismiss:()=>h({accessGroups:w.filter(C=>C!==m)}),className:"u-no-margin--bottom u-no-margin--right"},m)}),p.includes("tags")&&I.map((m,Q,w)=>{var T;return e.jsx(a.Chip,{value:`Tag: ${((T=g==null?void 0:g.find(({value:C})=>C===m))==null?void 0:T.label)??m}`,onDismiss:()=>h({tags:w.filter(C=>C!==m)}),className:"u-no-margin--bottom u-no-margin--right"},m)}),p.includes("fromDate")&&N&&e.jsx(a.Chip,{value:`From: ${N}`,onDismiss:()=>h({fromDate:""}),className:"u-no-margin--bottom u-no-margin--right"}),p.includes("toDate")&&v&&e.jsx(a.Chip,{value:`To: ${v}`,onDismiss:()=>h({toDate:""}),className:"u-no-margin--bottom u-no-margin--right"}),p.includes("type")&&D&&e.jsx(a.Chip,{value:`Type: ${((U=f==null?void 0:f.find(({value:m})=>m===D))==null?void 0:U.label)??D}`,onDismiss:()=>h({type:""}),className:"u-no-margin--bottom u-no-margin--right"}),n&&e.jsx(a.Button,{type:"button",appearance:"link",className:$.showLessButton,onClick:()=>y(!1),children:e.jsx("span",{className:"u-text--muted",children:"Show less"})})]}),u>0&&!n&&e.jsx(a.Button,{type:"button",appearance:"link",className:$.showMoreButton,onClick:()=>y(!0),children:e.jsx("span",{className:"u-text--muted",children:`+${u}`})})]})},at=({options:s})=>{const[t,o]=_.useState(""),{setPageParams:r,type:i}=B(),g=s.filter(f=>f.label.toLowerCase().includes(t.toLowerCase()));return e.jsx(O,{multiple:!1,label:"Type",hasToggleIcon:!0,hasBadge:!0,onSearch:f=>o(f),options:g,onItemSelect:f=>r({type:f}),selectedItem:i})},nt=_.lazy(()=>P(()=>import("./index-CZfN7hLm.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])));function ee(){const s=pe(),t=se(),o=ae(),{setSidePanelContent:r}=Z(),i=(l={},h={})=>V({queryKey:["activities",l],queryFn:()=>t.get("activities",{params:l}),...h}),g=({activityId:l,...h},S={})=>V({queryKey:["activities",{activityId:l,...h}],queryFn:()=>t.get(`activities/${l}`,{params:h}),...S}),f=(l={},h={})=>V({queryKey:["activityTypes"],queryFn:()=>s.get("GetActivityTypes",{params:l}),...h}),n=M({mutationKey:["activities","cancel"],mutationFn:l=>s.get("CancelActivities",{params:l}),onSuccess:()=>o.invalidateQueries({queryKey:["activities"]})}),y=M({mutationKey:["activities","approve"],mutationFn:l=>s.get("ApproveActivities",{params:l}),onSuccess:()=>o.invalidateQueries({queryKey:["activities"]})}),u=M({mutationFn:l=>t.post("activities/reapply",l),onSuccess:()=>o.invalidateQueries({queryKey:["activities"]})}),x=M({mutationFn:l=>t.post("activities/revert",l),onSuccess:()=>o.invalidateQueries({queryKey:["activities"]})});return{getActivitiesQuery:i,getSingleActivityQuery:g,getActivityTypesQuery:f,cancelActivitiesQuery:n,approveActivitiesQuery:y,redoActivitiesQuery:u,undoActivitiesQuery:x,openActivityDetails:l=>{r(l.summary,e.jsx(_.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(nt,{activityId:l.id})}))}}}function it(s){const{state:t}=ne(),o=t==null?void 0:t.activity;_.useEffect(()=>{t!=null&&t.activity&&(s(t.activity),window.history.replaceState({},""))},[o])}const ct="_container_1r60q_1",ot="_buttons_1r60q_6",X={container:ct,buttons:ot},lt=()=>{const[s,t]=_.useState(!1),{setPageParams:o,fromDate:r,toDate:i}=B(),g=ie({initialValues:{fromDate:r||"",toDate:i||""},enableReinitialize:!0,validationSchema:ce().shape({fromDate:G(),toDate:G()}),onSubmit:f=>{o({fromDate:f.fromDate,toDate:f.toDate}),t(!1)}});return e.jsx(a.ContextualMenu,{visible:s,autoAdjust:!0,toggleAppearance:"base",toggleLabel:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Date range"}),e.jsx("span",{className:F(b.badgeContainer),children:r||i?e.jsx(a.Badge,{value:r&&i?2:1,className:b.badge}):null})]}),toggleClassName:b.toggle,toggleProps:{onClick:()=>{t(!s)}},hasToggleIcon:!0,dropdownClassName:b.dropdown,position:"left",children:e.jsxs(a.Form,{onSubmit:g.handleSubmit,noValidate:!0,className:X.container,children:[e.jsxs("div",{className:b.container,children:[e.jsx(a.Input,{type:"datetime-local",label:"From",...g.getFieldProps("fromDate")}),e.jsx(a.Input,{type:"datetime-local",label:"To",...g.getFieldProps("toDate")})]}),e.jsxs("div",{className:X.buttons,children:[e.jsx(a.Button,{small:!0,type:"button",appearance:"base",onClick:()=>{t(!1),g.resetForm()},children:"Cancel"}),e.jsx(a.Button,{small:!0,type:"submit",appearance:"positive",children:"Add"})]})]})})},rt=({resetSelectedIds:s})=>{const{search:t,status:o,setPageParams:r}=B(),{instanceId:i}=oe(),{getActivityTypesQuery:g}=ee(),[f,n]=_.useState(t),[y,u]=_.useState(!1),{data:x}=g(),l=((x==null?void 0:x.data)??[]).map(d=>({label:d,value:d})),h=[{label:"All",value:""},...l],S=!!i,j=()=>{r({search:f,status:o}),s()},N=()=>{r({search:""})},A=d=>{d.preventDefault(),j()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:F(R.container,{[R.sticky]:!S}),children:[e.jsxs("div",{className:R.searchContainer,children:[e.jsx(a.Form,{onSubmit:A,noValidate:!0,children:e.jsx(je,{inputValue:f,onInputChange:d=>{n(d)},onSearchClick:j,onDescriptionClick:()=>u(!0),onClear:N})}),e.jsx(Se,{open:y,onClose:()=>{u(!1)},data:$e})]}),e.jsxs("div",{className:R.filters,children:[e.jsx(Ye,{options:J}),e.jsx(at,{options:h}),e.jsx(lt,{})]})]}),e.jsx(st,{filtersToDisplay:["status","type","fromDate","toDate"],statusOptions:J,typeOptions:h})]})},ut="_checkbox_19yw3_1",dt="_description_19yw3_5",mt="_link_19yw3_9",W={checkbox:ut,description:dt,link:mt},pt=(s,t)=>s&&t?` created-after:${s} created-before:${t}`:s?` created-after:${s}`:t?` created-before:${t}`:"",ht=s=>s?` type:${s}`:"",gt=s=>s?` status:${s}`:"",_t=_.lazy(()=>P(()=>import("./index-CZfN7hLm.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),St=({instanceId:s,selectedIds:t,setSelectedIds:o})=>{const{search:r,status:i,fromDate:g,toDate:f,type:n,currentPage:y,pageSize:u}=B(),{setSidePanelContent:x}=Z(),{getActivitiesQuery:p}=ee(),l=pt(g,f),h=ht(n),S=gt(i),j=`${r}${S}${l}${h}`,N=c=>{x(c.summary,e.jsx(_.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(_t,{activityId:c.id})}))};it(N);const A=()=>{o([])},{data:d,isPending:I}=p({query:`${s?`computer:id:${s}`:""} ${j??""}`.trim(),limit:u,offset:(y-1)*u}),v=_.useMemo(()=>(d==null?void 0:d.data.results)??[],[d]),D=()=>{o(t.length!==0?[]:v.map(({id:c})=>c))},q=c=>{o(t.includes(c)?t.filter(k=>k!==c):[...t,c])},E=_.useMemo(()=>[{accessor:"checkbox",className:W.checkbox,Header:e.jsx(a.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:D,checked:v.length>0&&t.length===v.length,indeterminate:t.length>0&&t.length<v.length}),Cell:({row:c})=>e.jsx(a.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:c.original.summary}),inline:!0,labelClassName:"u-no-margin--bottom u-no-padding--top",checked:t.includes(c.original.id),onChange:()=>{q(c.original.id)}})},{accessor:"summary",className:W.description,Header:"Description",Cell:({row:c})=>e.jsx(a.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>N(c.original),children:c.original.summary})},{accessor:"activity_status",Header:"Status",Cell:({row:{original:{activity_status:c}}})=>K[c].label,getCellIcon:({row:{original:{activity_status:c}}})=>K[c].icon},{accessor:"computer_id",Header:"Instance",Cell:({row:c})=>e.jsxs(le,{className:W.link,to:`${re}instances/${c.original.computer_id}`,children:["ID: ",c.original.computer_id]})},{accessor:"creation_time",Header:"Created at",Cell:({row:c})=>e.jsx(e.Fragment,{children:de(c.original.creation_time).format(ue)})},{accessor:"creator.name",Header:"Creator",Cell:({row:c})=>{var k;return e.jsx(e.Fragment,{children:((k=c.original.creator)==null?void 0:k.name)??e.jsx(he,{})})}}].filter(c=>!s||c.accessor!=="computer_id"),[v,t]);return e.jsxs(e.Fragment,{children:[!j&&y===1&&u===50&&I&&e.jsx(H,{}),!j&&y===1&&u===50&&!I&&(!d||!d.data.count)&&e.jsx(ge,{}),(!!j||y!==1||u!==20||!I&&d&&d.data.count>0)&&e.jsxs(e.Fragment,{children:[e.jsx(rt,{resetSelectedIds:A}),e.jsx(a.ModularTable,{emptyMsg:I?"Loading...":`No activities found with the search ${j}`,columns:E,data:v}),e.jsx(me,{totalItems:d==null?void 0:d.data.count,currentItemCount:v.length,handleClearSelection:A})]})]})},ft=_.lazy(()=>P(()=>import("./index-CZfN7hLm.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),At=s=>e.jsx(_.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(ft,{...s})});export{St as A,Ye as S,O as T,K as a,At as b,st as c,Se as d,ee as u};
