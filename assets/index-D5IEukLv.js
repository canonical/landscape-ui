import{i as S,h as y,r as x,j as t,a2 as v,L as g,w as m,D as j,n as e,p as _,E as f,I as c,N as d}from"./index-DKN0tqRa.js";import{S as A}from"./SidePanelTablePagination-DoIInzCU.js";import{b as N}from"./ScriptsTabs-BDGn765u.js";import"./index-C9Wdxdf8.js";import{u as C}from"./useRoles-UG4iuZNF.js";import{g as I,a as T,S as k}from"./index-OdS3MEw_.js";import"./HeaderWithSearch-OZEH1uHG.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./useExpandableRow-B5wZZoM0.js";const P=({id:s,...i})=>{const a=S(),{data:n,isLoading:r}=y({queryKey:["scriptProfileActivities",{id:s,...i}],queryFn:async()=>a.get(`script-profiles/${s}/activities`,{params:i})});return{activities:(n==null?void 0:n.data.results)??[],activitiesCount:n==null?void 0:n.data.count,isGettingActivities:r}},w="_link_1wvsk_1",L={link:w},z=({activities:s})=>{const i=x.useMemo(()=>[{Header:"Run",accessor:"creation_time",Cell:({row:{original:a}})=>t.jsx(g,{className:`${L.link} font-monospace`,to:`/activities?query=parent-id%3A${a.id}`,children:m(a.creation_time).utc().format(j)})},{Header:"Status",accessor:"activity_status",Cell:({row:{original:a}})=>v[a.activity_status].label,getCellIcon:({row:{original:a}})=>v[a.activity_status].icon}],[s]);return t.jsx(e.ModularTable,{columns:i,data:s})},R=({profile:s})=>{const[i,a]=x.useState(1),[n,r]=x.useState(20),{activities:l,activitiesCount:u,isGettingActivities:o}=P({id:s.id,limit:n,offset:(i-1)*n});return o?t.jsx(_,{}):l.length?t.jsxs(t.Fragment,{children:[t.jsx(z,{activities:l}),t.jsx(A,{currentPage:i,pageSize:n,paginate:a,setPageSize:r,totalItems:u})]}):t.jsx(f,{title:"No runs found",body:"The profile has not run yet."})},E=({actions:s,profile:i})=>i.archived?t.jsxs(e.Notification,{inline:!0,title:"Profile archived:",severity:"caution",children:["The profile was archived on"," ",m(i.last_edited_at).format(j),"."]}):t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[t.jsxs(e.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:s.edit,children:[t.jsx(e.Icon,{name:"edit"}),t.jsx("span",{children:"Edit"})]}),t.jsxs(e.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:s.archive,children:[t.jsx(e.Icon,{name:"archive"}),t.jsx("span",{children:"Archive"})]})]})}),$="_link_1wvsk_1",p={link:$},F=({profile:s})=>{var h;const{script:i,isScriptLoading:a}=N(s.script_id),{getAccessGroupQuery:n}=C(),{data:r,isLoading:l}=n();if(a||l)return t.jsx(_,{});const u=((h=r==null?void 0:r.data.find(b=>b.name==s.access_group))==null?void 0:h.title)||s.access_group,o=s.activities.last_activity;return t.jsxs(t.Fragment,{children:[t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(c,{label:"Name",value:s.title})}),t.jsx(e.Col,{size:6,children:t.jsx(c,{label:"Status",value:I(s)})})]}),t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(c,{label:"Script",value:i?t.jsx(g,{className:p.link,to:"/scripts?tab=scripts",state:{scriptId:i.id},children:i.title}):t.jsx(d,{})})}),t.jsx(e.Col,{size:6,children:t.jsx(c,{label:"Access group",value:u})})]}),t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(c,{label:"Run as user",value:s.username})}),t.jsx(e.Col,{size:6,children:t.jsx(c,{label:"Time limit",value:`${s.time_limit}s`})})]}),t.jsx("hr",{}),t.jsx(c,{label:"Trigger",value:T(s)||t.jsx(d,{})}),t.jsxs(e.Row,{className:"u-no-padding",children:[s.trigger.trigger_type!="event"&&t.jsx(e.Col,{size:6,children:t.jsx(c,{label:"Next run",value:s.trigger.next_run?`${m(s.trigger.next_run).utc().format(j)}`:t.jsx(d,{})})}),t.jsx(e.Col,{size:6,children:t.jsx(c,{label:"Last run",value:o?t.jsx(g,{className:p.link,to:`/activities?query=parent-id%3A${o.id}`,children:m(o.creation_time).utc().format(j)}):t.jsx(d,{})})})]}),t.jsx("hr",{}),t.jsx("p",{className:"p-heading--5",children:"Association"}),t.jsx(e.Row,{className:"u-no-padding",children:t.jsx(c,{label:"Associated instances",value:t.jsx(k,{scriptProfile:s})})}),t.jsx(e.Row,{className:"u-no-padding",children:t.jsx(c,{label:"Tags",value:s.all_computers?"All instances":s.tags.join(", ")||t.jsx(d,{})})})]})},Q=({actions:s,profile:i})=>{const[a,n]=x.useState("info"),l=[{label:"Info",id:"info"},{label:"Activity history",id:"activity-history"}].map(({label:u,id:o})=>({label:u,active:a==o,onClick:()=>{n(o)}}));return t.jsxs(t.Fragment,{children:[t.jsx(E,{actions:s,profile:i}),t.jsx(e.Tabs,{listClassName:"u-no-margin--bottom",links:l}),a=="info"&&t.jsx(F,{profile:i}),a=="activity-history"&&t.jsx(R,{profile:i})]})};export{Q as default};
