import{o as y,a as x,p as j,q as I,j as s,m as U,g,r as w,n as P,E as _}from"./index-F5ixs2NP.js";import{u as l}from"./usePageParams-ByN77I-a.js";import{u as p}from"./usePackages-CMKa1o3f.js";import{T as S}from"./TableFilterChips-5N5Oo-yw.js";import{H as $}from"./HeaderWithSearch-Dt8LFJia.js";import{U as k}from"./UsnList-CUn1tSrc.js";import"./useFetchOld-IYQtjqtR.js";import"./SelectAllButton-D2mONzq6.js";import"./ExpandableTableFooter-WAfgHxl8.js";import"./NoData-D5--INTl.js";import"./TablePagination-BrIH39sP.js";import"./TablePaginationBase-CfRQScDE.js";import"./TruncatedCell-BgQPf_Ha.js";import"./helpers-BOBjp_rf.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="beacd0c9-b518-415f-84bb-91501283490f",e._sentryDebugIdIdentifier="sentry-dbid-beacd0c9-b518-415f-84bb-91501283490f")}catch{}const v="_actions_1l3g0_1",D={actions:v},L=({usns:e})=>{const{instanceId:a,childInstanceId:n}=y(),{setPageParams:i}=l(),r=x(),t=j(),{notify:o}=I(),{upgradeInstanceUsnsQuery:c}=p(),d=Number(a),{mutateAsync:m,isPending:u}=c,f=()=>{r(`/instances/${n?`${d}/${n}`:`${d}`}`),i({tab:"activities"}),o.clear()},b=async()=>{try{await m({instanceId:d,usns:e}),o.success({title:"You queued packages to be upgraded",message:`Affected packages for ${e.length===1?`"${e[0]}" security issue`:`${e.length} selected security issues`} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:f}]})}catch(h){t(h)}};return s.jsxs(s.Fragment,{children:[s.jsx($,{actions:s.jsx("div",{className:U("p-segmented-control",D.actions),children:s.jsxs(g.ConfirmationButton,{className:"p-segmented-control__button has-icon u-no-margin--bottom",type:"button",disabled:e.length===0,confirmationModalProps:{title:"Upgrade affected packages",children:s.jsxs("p",{children:["This will upgrade affected packages for"," ",e.length===1?`"${e[0]}" security issue`:`${e.length} selected security issues`,"."]}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:u,confirmButtonDisabled:u,onConfirm:b},children:[s.jsx(g.Icon,{name:"change-version"}),s.jsx("span",{children:"Upgrade"})]})})}),s.jsx(S,{filtersToDisplay:["search"]})]})},N=({instance:e,isUsnsLoading:a,totalUsnCount:n,usns:i})=>{const[r,t]=w.useState([]),{search:o}=l();return s.jsxs(s.Fragment,{children:[s.jsx(L,{usns:r}),s.jsx(k,{tableType:"paginated",instances:[e],isUsnsLoading:a,onSelectedUsnsChange:c=>t(c),search:o,selectedUsns:r,totalUsnCount:n,usns:i})]})},J=({instance:e})=>{const{search:a,currentPage:n,pageSize:i}=l(),{getUsnsQuery:r}=p(),{data:t,isLoading:o}=r({computer_ids:[e.id],limit:i,offset:(n-1)*i,search:a,show_packages:!1});return s.jsxs(s.Fragment,{children:[!a&&n===1&&i===20&&o&&s.jsx(P,{}),!a&&n===1&&i===20&&!o&&(!t||t.data.results.length===0)&&s.jsx(_,{icon:"inspector-debug",title:"No security issues found"}),(a||n>1||i!==20||!o&&t&&t.data.results.length>0)&&s.jsx(N,{instance:e,isUsnsLoading:o,totalUsnCount:(t==null?void 0:t.data.count)??0,usns:(t==null?void 0:t.data.results)??[]})]})};export{J as default};
