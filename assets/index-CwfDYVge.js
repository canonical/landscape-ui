import{o as S,p as _,q as j,f as k,s as U,h as q,t as v,k as t,v as T,j as s,g as i}from"./index-Bwatsl1G.js";import{S as A}from"./SidePanelFormButtons-CIamrVW7.js";import{M as D}from"./MultiSelectField-B42pkRH6.js";import{u as B}from"./index-CwfQfNiw.js";import"./SidePanelFormButtons.module-tJTvEwdD.js";import"./TablePagination-CYwNZA2E.js";import"./usePageParams-gxSf1nMa.js";import"./TablePaginationBase-Ds3XrZnG.js";import"./helpers-DJRVSlr2.js";import"./HeaderWithSearch-C5C_dSyA.js";import"./TableFilterChips-t7GEBfEp.js";import"./NoData-CcX6zdBS.js";import"./output-CazJxxjw.js";try{let o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},d=new o.Error().stack;d&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[d]="ff525a37-7fe6-4323-a43c-3c34292d300d",o._sentryDebugIdIdentifier="sentry-dbid-ff525a37-7fe6-4323-a43c-3c34292d300d")}catch{}const Y=({user:o})=>{const{instanceId:d}=S(),g=_(),{notify:b}=j(),{closeSidePanel:f}=k(),{editUserQuery:y,getGroupsQuery:w,getUserGroupsQuery:P,addUserToGroupQuery:G,removeUserFromGroupQuery:x}=B(),u=Number(d),{data:m,isLoading:V}=w({computer_id:u}),{data:p}=P({username:o.username,computer_id:u}),{mutateAsync:I}=y,{mutateAsync:N}=G,{mutateAsync:F}=x,l=((m==null?void 0:m.data.groups)??[]).map(r=>({label:r.name,value:String(r.gid)})),c=(p==null?void 0:p.data.groups.map(r=>String(r.gid)))||[],e=U({initialValues:{name:o.name??"",username:o.username,password:"",confirmPassword:"",location:o.location??"",homePhoneNumber:o.home_phone??"",workPhoneNumber:o.work_phone??"",primaryGroupValue:String(o.primary_gid),additionalGroupValue:c},validationSchema:q().shape({username:t().required("This field is required"),name:t(),password:t(),confirmPassword:t().when("password",([r],n)=>r&&r.length>0?n.trim().required("Confirm passphrase is required").oneOf([T("password"),""],"Passphrases must match"):n.notRequired()),location:t(),homePhoneNumber:t(),workPhoneNumber:t(),primaryGroupValue:t().required("This field is required"),additionalGroupValue:v().of(t())}),onSubmit:async r=>{const n=r.additionalGroupValue.filter(a=>!c.includes(a)),h=c.filter(a=>!r.additionalGroupValue.includes(a));try{const a=[];n.length&&a.push(N({computer_id:u,groupnames:n,usernames:[r.username],action:"add"})),h.length&&a.push(F({computer_id:u,groupnames:h,usernames:[r.username],action:"remove"})),a.push(I({computer_ids:[u],name:r.name,username:r.username,password:r.password,location:r.location,home_phone:r.homePhoneNumber,work_phone:r.workPhoneNumber,primary_groupname:r.primaryGroupValue})),await Promise.all(a),f(),b.success({message:"User updated successfully"})}catch(a){g(a)}}});return s.jsxs(i.Form,{onSubmit:e.handleSubmit,noValidate:!0,name:"edit-user",children:[s.jsx(i.Input,{type:"text",label:"Username",required:!0,autoComplete:"new-username",error:e.touched.username&&e.errors.username?e.errors.username:void 0,...e.getFieldProps("username")}),s.jsx(i.Input,{type:"text",label:"Name",error:e.touched.name&&e.errors.name?e.errors.name:void 0,...e.getFieldProps("name")}),s.jsx(i.Input,{type:"password",label:"Passphrase",autoComplete:"new-password",error:e.touched.password&&e.errors.password?e.errors.password:void 0,...e.getFieldProps("password")}),s.jsx(i.Input,{type:"password",label:"Confirm passphrase",autoComplete:"new-password",error:e.touched.confirmPassword&&e.errors.confirmPassword?e.errors.confirmPassword:void 0,...e.getFieldProps("confirmPassword")}),s.jsx(i.Select,{"data-testid":"primaryGroupValue",label:"Primary Group",required:!0,disabled:V,options:l,...e.getFieldProps("primaryGroupValue"),error:e.touched.primaryGroupValue&&e.errors.primaryGroupValue?e.errors.primaryGroupValue:void 0}),s.jsx(D,{variant:"condensed",placeholder:"Select groups",label:"Additional Groups",items:l,selectedItems:l.filter(({value:r})=>e.values.additionalGroupValue.includes(r)),onItemsUpdate:r=>{e.setFieldValue("additionalGroupValue",r.map(({value:n})=>n))},error:e.touched.additionalGroupValue&&(Array.isArray(e.errors.additionalGroupValue)?e.errors.additionalGroupValue.join(", "):e.errors.additionalGroupValue)||void 0}),s.jsx(i.Input,{type:"text",label:"Location",error:e.touched.location&&e.errors.location?e.errors.location:void 0,...e.getFieldProps("location")}),s.jsx(i.Input,{type:"text",label:"Home phone",error:e.touched.homePhoneNumber&&e.errors.homePhoneNumber?e.errors.homePhoneNumber:void 0,...e.getFieldProps("homePhoneNumber")}),s.jsx(i.Input,{type:"text",label:"Work phone",error:e.touched.workPhoneNumber&&e.errors.workPhoneNumber?e.errors.workPhoneNumber:void 0,...e.getFieldProps("workPhoneNumber")}),s.jsx(A,{submitButtonDisabled:e.isSubmitting,submitButtonText:"Save changes"})]})};export{Y as default};
