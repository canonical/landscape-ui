import{f as _,e as g,r as p,j as a,h as n,I as o,D as f,L as y}from"./index-P3tcVer_.js";import{h as x}from"./usePageParams-CZXld3eS.js";import{f as k}from"./ScriptsTabs-C3hIDC9c.js";import{N as j}from"./NoData-DfvYDVkG.js";import"./TablePagination-9PvQlVgk.js";import"./TablePaginationBase-DrquMGK2.js";import"./TruncatedCell-D_3fzDwd.js";import"./StatusFilter-BjWN4DdL.js";import"./TableFilter-DTXx6h3i.js";import"./TableFilterChips-HMcdOmXT.js";import"./HeaderWithSearch-DCz7Mge8.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./index-BbHeewcZ.js";const w=({attachmentId:e,scriptId:s},r={enabled:!0})=>{const d=_(),{data:l,isLoading:m,refetch:t}=g({queryKey:["scripts","attachment",e],queryFn:async()=>d.get(`scripts/${s}/attachments/${e}`),...r});return{scriptAttachment:(l==null?void 0:l.data)??null,isScriptAttachmentsLoading:m,refetch:t}},v="_attachmentBlock_1hc4o_1",L="_attachment_1hc4o_1",N="_link_1hc4o_15",h={attachmentBlock:v,attachment:L,link:N},O=({script:e})=>{const[s,r]=p.useState(null),{isScriptAttachmentsLoading:d,refetch:l}=w({attachmentId:(s==null?void 0:s.id)??0,scriptId:e.id},{enabled:!1});p.useEffect(()=>{(async()=>{if(!s)return;const{data:c}=await l();if(!c)return;const b=new Blob([c.data],{type:"application/octet-stream"}),u=URL.createObjectURL(b),i=document.createElement("a");i.href=u,i.download=s.name,document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(u),r(null)})()},[s,l]);const m=async(t,c)=>{r({id:t,name:c})};return a.jsxs(a.Fragment,{children:[a.jsxs(n.Row,{className:"u-no-padding",children:[a.jsx(n.Col,{size:6,children:a.jsx(o,{label:"name",value:e.title})}),a.jsx(n.Col,{size:6,children:a.jsx(o,{label:"version",value:e.version_number})})]}),a.jsx(n.Row,{className:"u-no-padding",children:a.jsx(o,{label:"status",value:k(e.status)})}),a.jsx(n.Row,{className:"u-no-padding",children:a.jsx(o,{label:"Date created",value:`${x(e.created_at).format(f)} by ${e.created_by.name}`})}),a.jsx(n.Row,{className:"u-no-padding",children:a.jsx(o,{label:"Last modified",value:`${x(e.last_edited_at).format(f)} by ${e.last_edited_by.name}`})}),a.jsx(n.Row,{className:"u-no-padding",children:a.jsx(n.Col,{size:12,children:a.jsx(o,{className:h.attachmentBlock,label:"attachments",value:e.attachments.length>0?e.attachments.map(t=>a.jsxs("span",{className:h.attachment,children:[a.jsx("span",{children:t.filename}),a.jsx(n.Button,{className:"u-no-margin--bottom",type:"button",onClick:async()=>m(t.id,t.filename),disabled:d&&(s==null?void 0:s.id)===t.id,appearance:"link","aria-label":`Download ${t.filename}`,children:a.jsx(n.Icon,{name:"begin-downloading"})})]},t.id)):a.jsx(j,{})})})}),a.jsx(o,{label:"associated profiles",value:e.script_profiles.length>0?e.script_profiles.map((t,c)=>a.jsxs(y,{className:h.link,to:"/scripts?tab=profiles",state:{scriptProfileId:t.id},children:[t.title,c<e.script_profiles.length-1?", ":""," "]},t.id)):a.jsx(j,{})})]})};export{O as default};
