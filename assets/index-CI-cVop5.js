import{A as H}from"./index-D4D46eZ3.js";import{i as f,q as S,t as A,k as j,n as i,j as t,d as r}from"./index-DAg1o-hl.js";import{S as T}from"./SidePanelFormButtons-DpWiVTI8.js";import{u as G}from"./useGPGKeys-DdSvgIRi.js";import{t as l}from"./tests-DFnZqbNV.js";import{u as k}from"./useRoles-uJJuagDr.js";import{u as E}from"./useAPTSources-UwVEbCdE.js";import"./PageMain-8B-RmEE7.js";import"./SidePanelFormButtons.module-yv6Qz3cN.js";import"./useFetchOld-CgHla_fb.js";const I={name:"",apt_line:"",gpg_key:"",access_group:""},F="Enter 'deb', followed by the URI for the repository mirror, distribution and components. An example entry could be 'deb http://landscape-repo-mirror/repository/standalone/ubuntu jammy main universe restricted multiverse'",L="_tooltipPositionElement_1cfe6_1",q={tooltipPositionElement:L},$=()=>{const{closeSidePanel:c}=f(),p=S(),{createAPTSourceQuery:d,getAPTSourcesQuery:m}=E(),{getGPGKeysQuery:g}=G(),{data:a,isLoading:b}=g(),{getAccessGroupQuery:y}=k(),{data:n,isLoading:P}=y(),_=((n==null?void 0:n.data)??[]).map(s=>({label:s.title,value:s.name})),h=((a==null?void 0:a.data)??[]).map(({name:s})=>({label:s,value:s})),{mutateAsync:x}=d,{data:o}=m(),e=A({initialValues:I,validationSchema:j().shape({name:i().required("This field is required").test({test:l.test,message:l.message}).test({params:{getAPTSourcesResponse:o},test:s=>!((o==null?void 0:o.data)??[]).map(({name:u})=>u).includes(s),message:"It must be unique within the account."}),apt_line:i().required("This field is required"),gpg_key:i(),access_group:i()}),onSubmit:async s=>{try{await x(s),c()}catch(u){p(u)}}});return t.jsxs(r.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[t.jsx(r.Input,{type:"text",label:"Name",required:!0,error:e.touched.name&&e.errors.name?e.errors.name:void 0,...e.getFieldProps("name")}),t.jsx(r.Input,{type:"text",label:t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"APT Line"}),t.jsxs(r.Tooltip,{message:F,positionElementClassName:q.tooltipPositionElement,children:[t.jsx(r.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),required:!0,error:e.touched.apt_line&&e.errors.apt_line?e.errors.apt_line:void 0,...e.getFieldProps("apt_line")}),t.jsx(r.Select,{label:"GPG key",disabled:b,options:[{label:"Select GPG key",value:""},...h],...e.getFieldProps("gpg_key"),error:e.touched.gpg_key&&e.errors.gpg_key?e.errors.gpg_key:void 0}),t.jsx(r.Select,{label:"Access group",disabled:P,options:[{label:"Select access group",value:""},..._],...e.getFieldProps("access_group"),error:e.touched.access_group&&e.errors.access_group?e.errors.access_group:void 0}),t.jsx(T,{submitButtonDisabled:e.isSubmitting,submitButtonText:"Add APT Source"})]})};export{H as APTSourcesList,$ as NewAPTSourceForm,E as useAPTSources};
