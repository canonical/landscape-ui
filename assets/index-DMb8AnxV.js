import{j as s,h as i,k as F,w as S,i as h,l as x}from"./index-BToeH5fw.js";import{u as g,I as f,V as v,P as T,b as j,c as I}from"./index-BCtC3JRT.js";import{F as V}from"./FileInput-BxGACfuv.js";import{P as A}from"./PackageProfileConstraintsBlock-CQNVdmwL.js";import{u as C}from"./useInstances-Bi7vZ_MT.js";import{u as O}from"./useRoles-DnKNDEfS.js";import{A as w}from"./AssociationBlock-BDGQ6URv.js";import{S as N}from"./SidePanelFormButtons-CjRzhl9g.js";const E=[{label:"Select constraints type",value:""},{label:"From an instance's packages",value:"instance"},{label:"From a CSV file",value:"material"},{label:"Enter manually",value:"manual"}],q="_container_1y4qx_1",B="_cta_1y4qx_7",D={container:q,cta:B},L=({formik:e})=>{const{getInstancesQuery:p}=C(),{data:c}=p(),u=(c==null?void 0:c.data.results.map(({id:r,title:n})=>({label:n,value:`${r}`})))??[];u.unshift({label:"Select instance",value:""});const d=async r=>{await e.setFieldValue("csvFile",r[0]);const n=await r[0].text();await e.setFieldValue("material",n)},l=async()=>{await e.setFieldValue("csvFile",null),await e.setFieldValue("material",""),await e.setFieldValue("isCsvFileParsed",!1)};return s.jsxs("div",{className:D.container,children:[s.jsx(i.Select,{label:"Package constraints",required:!0,options:E,...e.getFieldProps("constraintsType"),error:e.touched.constraintsType&&e.errors.constraintsType?e.errors.constraintsType:void 0}),e.values.constraintsType==="instance"&&s.jsx(i.Select,{label:"Instance",required:e.values.constraintsType==="instance",options:u,...e.getFieldProps("source_computer_id"),error:e.touched.source_computer_id&&e.errors.source_computer_id?e.errors.source_computer_id:void 0}),e.values.constraintsType==="material"&&s.jsx(V,{label:"Upload constraints",accept:".csv",...e.getFieldProps("csvFile"),onFileRemove:l,onFileUpload:d,help:'File should be formatted as either a package profile CSV file or the output of running "dpkg --get-selections" on a computer with desired packages installed.',error:e.touched.csvFile&&e.errors.csvFile||e.touched.material&&e.errors.material||void 0}),e.values.constraintsType==="manual"&&s.jsx(A,{formik:e})]})},P=()=>{const e=F(),{notify:p}=S(),{closeSidePanel:c}=h(),{getAccessGroupQuery:u}=O(),{createPackageProfileQuery:d}=g(),{data:l}=u(),r=(l==null?void 0:l.data.map(({name:a,title:o})=>({label:o,value:a})))??[];r.unshift({label:"Select access group",value:""});const{mutateAsync:n}=d,t=x({initialValues:f,onSubmit:async a=>{const o={access_group:a.access_group,description:a.description,title:a.title};a.all_computers?o.all_computers=!0:a.tags.length>0&&(o.tags=a.tags),a.constraintsType==="material"?o.material=a.material:a.constraintsType==="instance"?o.source_computer_id=a.source_computer_id:o.constraints=a.constraints.map(({constraint:m,package:_,rule:b,version:y})=>({constraint:m,package:_,rule:b,version:y}));try{await n(o),c(),p.success({message:`Profile "${a.title}" added successfully`,title:"Profile added"})}catch(m){e(m)}},validationSchema:v});return s.jsxs(i.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[s.jsx(i.Input,{type:"text",label:"Name",required:!0,...t.getFieldProps("title"),error:t.touched.title&&t.errors.title?t.errors.title:void 0}),s.jsx(i.Input,{type:"text",label:"Description",required:!0,autoComplete:"off",...t.getFieldProps("description"),error:t.touched.description&&t.errors.description?t.errors.description:void 0}),s.jsx(i.Select,{label:"Access group",...t.getFieldProps("access_group"),options:r,error:t.touched.access_group&&t.errors.access_group?t.errors.access_group:void 0}),s.jsx(w,{formik:t}),s.jsx(L,{formik:t}),s.jsx(N,{submitButtonDisabled:t.isSubmitting,submitButtonText:"Add package profile"})]})},Y=Object.freeze(Object.defineProperty({__proto__:null,default:P},Symbol.toStringTag,{value:"Module"})),J=Object.freeze(Object.defineProperty({__proto__:null,PackageProfileCreateForm:P,PackageProfileHeader:j,PackageProfileList:T,PackageProfilesEmptyState:I,usePackageProfiles:g},Symbol.toStringTag,{value:"Module"}));export{J as a,Y as i};
