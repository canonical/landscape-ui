import{b as _,c as D,i as $,j as e,d as s,r as x,L,R as B}from"./index-CQs3wXys.js";import{u as k}from"./useConfirm-9PPCxKmU.js";import{u as I}from"./useWsl-CTLM9nMW.js";import{u as A}from"./formik.esm-C_3GEhhV.js";import{c as P,a as F}from"./index.esm-85kEx3I1.js";import{S as M}from"./SidePanelFormButtons-CTKwSU1t.js";import"./moment-Cl4UOzQZ.js";import"./InfoItem-BtzYmEJw.js";import{useActivities as Q}from"./index-bj0TtfTA.js";import"./useFetchOld-D-5JyUuM.js";import"./useMutation-D9dT1mhA.js";import"./useQuery-DrwXjJzc.js";import"./SidePanelFormButtons.module-CoxOjuX8.js";import"./useInstances-A3J_BhkM.js";import"./moment-DDUBUQL9.js";import"./TablePagination-DIiSuGph.js";import"./EmptyState-DNkTeHW1.js";import"./SearchHelpPopup-CAM4EXp1.js";const W=({parentId:a})=>{const i=_(),{closeSidePanel:o}=D(),{notify:c}=$(),{createChildInstanceQuery:u,getWslInstanceNamesQuery:h}=I(),{openActivityDetails:b}=Q(),{data:m}=h(),g=(m==null?void 0:m.data.map(({label:p,name:r})=>({label:p,value:r})))||[],{mutateAsync:f}=u,n=A({initialValues:{instanceType:"Ubuntu"},validationSchema:P({instanceType:F().required("This field is required")}),onSubmit:async p=>{try{const{data:r}=await f({parent_id:a,computer_name:p.instanceType});o(),c.success({message:"You queued a new WSL instance to be installed",actions:[{label:"View details",onClick:()=>b(r)}]})}catch(r){i(r)}}});return e.jsxs(s.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:[e.jsx(s.Select,{label:"Instance type",required:!0,options:g,...n.getFieldProps("instanceType"),error:n.touched.instanceType&&n.errors.instanceType?n.errors.instanceType:void 0}),e.jsx(M,{submitButtonDisabled:n.isSubmitting,submitButtonText:"Install",submitButtonAriaLabel:"Install new WSL instance"})]})},H="_container_13w3p_1",U="_searchContainer_13w3p_6",q="_cta_13w3p_10",S={container:H,searchContainer:U,cta:q},O=({parentId:a,resetQuery:i,selectedInstances:o,setQuery:c})=>{const[u,h]=x.useState(""),b=_(),{setSidePanelContent:m}=D(),{confirmModal:g,closeConfirmModal:f}=k(),{deleteChildInstancesQuery:n}=I(),{mutateAsync:p}=n,r=async()=>{try{await p({computer_ids:o.map(({id:d})=>d)})}catch(d){b(d)}finally{f()}},C=()=>{g({title:`Delete ${o.length===1?o[0].title:"selected instances"}`,body:`This will remove selected WSL ${o.length===1?"instance":"instances"} from the host and Landscape`,buttons:[e.jsx(s.Button,{appearance:"negative",onClick:r,children:"Uninstall"},"uninstall")]})},y=d=>{d.preventDefault(),c(u)};return e.jsxs("div",{className:S.container,children:[e.jsx("div",{className:S.searchContainer,children:e.jsx(s.Form,{onSubmit:y,noValidate:!0,children:e.jsx(s.SearchBox,{onChange:d=>h(d),value:u,onSearch:()=>c(u),autocomplete:"off",onClear:()=>{i(),h("")}})})}),e.jsxs("div",{className:S.cta,children:[e.jsx(s.Button,{type:"button",onClick:()=>{m("Install new WSL instance",e.jsx(W,{parentId:a}))},children:e.jsx("span",{children:"Install new instance"})}),e.jsx(s.Button,{type:"button",onClick:C,disabled:o.length===0,children:e.jsx("span",{children:"Uninstall"})})]})]})},V="_title_6t0ne_1",E="_actions_6t0ne_5",v={title:V,actions:E},R=({instance:a})=>{const[i,o]=x.useState([]),[c,u]=x.useState(""),h=_(),{confirmModal:b,closeConfirmModal:m}=k(),{setDefaultChildInstanceQuery:g,deleteChildInstancesQuery:f}=I(),n=x.useMemo(()=>c?a.children.filter(({title:t,hostname:l})=>t.toLowerCase().includes(c.toLowerCase())||l.toLowerCase().includes(c.toLowerCase())):a.children,[a,c]),{mutateAsync:p}=g,{mutateAsync:r}=f,C=async t=>{try{await p({child_id:t,parent_id:a.id})}catch(l){h(l)}finally{m()}},y=t=>{b({title:"Set default instance",body:`Are you sure you want to set ${t.title} as default instance?`,buttons:[e.jsx(s.Button,{appearance:"positive",onClick:()=>C(t.id),children:"Set default"},"set-default")]})},d=async t=>{try{await r({computer_ids:[t]})}catch(l){h(l)}finally{m()}},T=t=>{b({title:`Delete ${t.title}`,body:"This will remove the WSL instance from the host and Landscape",buttons:[e.jsx(s.Button,{appearance:"negative",onClick:()=>d(t.id),children:"Delete"},"delete")]})},N=t=>{o(l=>l.some(({id:j})=>j===t.id)?l.filter(({id:j})=>j!==t.id):[...l,t])},w=x.useMemo(()=>[{accessor:"title",Header:e.jsxs(e.Fragment,{children:[e.jsx(s.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),checked:n.length>0&&i.length===n.length,indeterminate:i.length>0&&i.length<n.length,onChange:()=>{o(i.length>0?[]:n)}}),e.jsx("span",{children:"Title"})]}),Cell:({row:t})=>e.jsxs("div",{className:v.title,children:[e.jsx(s.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${t.original.title} instance`}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:i.some(({id:l})=>l===t.original.id),onChange:()=>N(t.original)}),e.jsx(L,{to:`${B}instances/${a.id}/${t.original.id}`,children:t.original.title})]})},{accessor:"distribution",Header:"OS",Cell:({row:{original:t}})=>t.distribution?`UbuntuÂ ${t.distribution}`:"Unknown"},{accessor:"default",Header:"Default",Cell:({row:t})=>e.jsx("span",{children:t.original.title===a.default_child?"Yes":"No"})},{accessor:"actions",className:v.actions,Cell:({row:t})=>e.jsxs("div",{className:"divided-blocks",children:[e.jsx("div",{className:"divided-blocks__item",children:e.jsxs(s.Button,{small:!0,hasIcon:!0,type:"button",appearance:"base",className:"u-no-margin--bottom u-no-padding--left p-tooltip--btm-right","aria-label":`Set ${t.original.title} as default instance`,onClick:()=>y(t.original),children:[e.jsx("span",{className:"p-tooltip__message",children:"Set default instance"}),e.jsx("i",{className:"p-icon--pin u-no-margin--left"})]})}),e.jsx("div",{className:"divided-blocks__item",children:e.jsxs(s.Button,{small:!0,hasIcon:!0,type:"button",appearance:"base",className:"u-no-margin--bottom u-no-padding--left p-tooltip--btm-right","aria-label":`Delete ${t.original.title} instance`,onClick:()=>T(t.original),children:[e.jsx("span",{className:"p-tooltip__message",children:"Delete instance"}),e.jsx("i",{className:"p-icon--delete u-no-margin--left"})]})})]})}],[n,i]);return e.jsxs(e.Fragment,{children:[e.jsx(O,{parentId:a.id,resetQuery:()=>{u("")},selectedInstances:i,setQuery:t=>{u(t)}}),e.jsx(s.ModularTable,{columns:w,data:n})]})},ue=R;export{ue as default};
