import{f as q,t as M,v as O,j as e,r as f,y as w,ad as P,G as d,d as h,e as R,C as V,z as K,x as L,B as U,k as C,h as W,m as Y}from"./index-CNSDWj8Q.js";import{S as z}from"./SidePanelFormButtons-DIizKTix.js";import"./EmployeeList-CKLLomOE.js";import{D as G}from"./downshift.esm-DADdD-V8.js";import{u as H}from"./useGetEmployees-Bqf4LrXW.js";import{g as Q}from"./formikErrors-Bw8iTXYS.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./constants-CDnVvJTb.js";import"./NoData-6ZK9sV5u.js";import"./TruncatedCell-BMum6DLZ.js";import"./Truncated-Dtg97i8C.js";import"./ResponsiveTable-BXalKviy.js";const J=()=>{const s=q(),a=M(),{mutateAsync:i,isPending:n}=O({mutationKey:["employee","associate"],mutationFn:async({employee_id:o,...c})=>s.post(`employees/${o}/computers`,c),onSuccess:(o,c)=>{a.invalidateQueries({queryKey:["instances",c.computer_id]})}});return{associateEmployeeWithInstance:i,isAssociating:n}},X="_container_t3heu_1",Z="_suggestionsContainer_t3heu_5",ee="_pointer_t3heu_13",te="_highlighted_t3heu_18",se="_selectedEmployee__container_t3heu_22",oe="_selectedEmployee__name_t3heu_30",ne="_selectedEmployee__button_t3heu_35",ae="_selectedEmployee__icon_t3heu_44",le="_errorMessage_t3heu_48",r={container:X,suggestionsContainer:Z,pointer:ee,highlighted:te,selectedEmployee__container:se,selectedEmployee__name:oe,selectedEmployee__button:ne,selectedEmployee__icon:ae,errorMessage:le},ie=200,ce=(s,a)=>{const i=s.toLowerCase(),n=a.toLowerCase(),o=i.indexOf(n);return o>=0?e.jsxs(e.Fragment,{children:[s.substring(0,o),e.jsx("strong",{children:s.substring(o,o+a.length)}),s.substring(o+a.length)]}):s},re=({employee:s,setEmployee:a,error:i})=>{const[n,o]=f.useState(""),[c,u]=f.useState(!1),[p,_]=f.useState(""),g=w(),{employees:m,isFetching:l}=H({listenToUrlParams:!1},{search:n},{enabled:n.length>2}),y=t=>s?.id!==t.id,x=m.filter(y),I=()=>{a(null)},F=()=>{u(!1)},E=()=>{_(""),o("")},S=()=>{p.length>2?u(!0):u(!1)},D=t=>{_(t),t.length>2&&o(t)},A=P(()=>{try{S()}catch(t){g(t)}},ie),B=t=>{t&&(a(t),u(!1),E())},T=t=>{t.key==="Escape"?t.currentTarget.blur():A()},j=!c&&p.length<3?"Min 3. characters":m.length===0&&n&&!l?`No employees found by "${n}"`:null;return e.jsxs("div",{className:d(r.container,{"is-error":!!i}),children:[e.jsx(G,{onSelect:B,itemToString:()=>"",isOpen:c,children:({getInputProps:t,getItemProps:k,getMenuProps:v,highlightedIndex:$})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx("label",{className:"p-form__label",htmlFor:"employee-searchbox",id:"employee-searchbox-label",children:"Employee"}),e.jsx(h.SearchBox,{...t(),id:"employee-searchbox",placeholder:"Search for an employee",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:p,onChange:D,onClear:E,onBlur:F,onFocus:S,onKeyUp:T}),j?e.jsx("span",{className:"p-form-help-text",children:j}):null,c&&(x.length>0||l)?e.jsx("ul",{className:d("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",r.suggestionsContainer),...v(),children:l?e.jsx(R,{}):x.map((b,N)=>e.jsx("li",{className:d("p-list__item",r.pointer,{[r.highlighted]:$===N}),...k({item:b,index:N}),children:e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:ce(b.name,n)})},b.id))}):null]})}),!!i&&e.jsx("p",{className:d(r.errorMessage,"p-form-validation__message is-error"),children:i}),s&&e.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:e.jsxs("li",{className:d("p-autocomplete__result p-list__item p-card u-no-margin--bottom",r.selectedEmployee__container),children:[e.jsx("span",{className:r.selectedEmployee__name,children:s.name}),e.jsx(h.Button,{type:"button",title:"Remove",appearance:"link",className:d("u-no-margin--bottom",r.selectedEmployee__button),onClick:I,children:e.jsx(h.Icon,{name:h.ICONS.delete,className:r.selectedEmployee__icon})})]},s.id)})]})},je=({instanceTitle:s})=>{const{instanceId:a,childInstanceId:i}=V(),n=w(),{notify:o}=K(),{closeSidePanel:c}=L(),u=Number(i??a),{associateEmployeeWithInstance:p,isAssociating:_}=J(),g=async l=>{if(l.employee)try{await p({computer_id:u,employee_id:l.employee.id}),c(),o.success({title:`You have successfully associated ${l.employee.name}`,message:`${l.employee.name} has been successfully associated with ${s}.`})}catch(y){n(y)}},m=U({initialValues:{employee:null},validationSchema:C().shape({employee:C().shape({id:Y().required(),name:W().required()}).nullable().required("This field is required.")}),enableReinitialize:!0,onSubmit:g});return e.jsxs(h.Form,{noValidate:!0,onSubmit:m.handleSubmit,children:[e.jsx("p",{children:"You can associate the instance with the selected employee, allowing them to view its details and recovery key."}),e.jsx(re,{employee:m.values.employee,setEmployee:async l=>await m.setFieldValue("employee",l),error:Q(m,"employee")}),e.jsx(z,{submitButtonDisabled:_,submitButtonText:"Associate",submitButtonAppearance:"positive"})]})};export{je as default};
