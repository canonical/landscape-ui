import{a9 as F,y as N,f as x,J as B,ap as O,z as $,s as D,t as k,n as j,v as q,j as e,e as r,w as P,ae as c,i as L,m as M,a0 as H,O as v,I as d,aM as Q,p as U}from"./index-zH89cK1j.js";import{A as V}from"./AssociationBlock-DVjxYDEA.js";import{S as z}from"./SidePanelFormButtons-DRtagKhz.js";import{u as S}from"./useRoles-Dajkssiw.js";import{u as W,R as X}from"./index-QoD8Xees.js";import{a as be,b as Se,c as Ae}from"./index-QoD8Xees.js";import{P as J}from"./ProfileAssociationInfo-D_lQ-Z2x.js";import"./MultiSelectField-DeqTbmek.js";import"./useGetTags-BGHRM7fD.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./PageMain-BD64heAK.js";import"./constants-vXG6UVBi.js";import"./constants-CxVijUCT.js";import"./TextConfirmationModal-CR6BbdNw.js";import"./table-CdFwMAPu.js";import"./HeaderWithSearch-Z5W-A0zX.js";const R={add:"Add",edit:"updated"},K={add:"Add removal profile",edit:"Save changes"},Y={access_group:F,all_computers:!1,days_without_exchange:"",tags:[],title:""},b=2147483647,Z=t=>N().shape({access_group:x(),all_computers:$(),days_without_exchange:O().test({name:"required",message:"This field is required.",params:{action:t},test:s=>s!=null||t!=="add"}).integer("Timeframe must be an integer value.").min(1,"Timeframe must be at least 1.").max(b,`Timeframe must be at most  ${b}.`),tags:B().of(x()),title:x().test({name:"required",message:"This field is required.",params:{action:t},test:s=>!!s||t!=="add"})}),ee="_inputContainer_v1jo9_1",te="_input_v1jo9_1",ae="_inputDescription_v1jo9_10",f={inputContainer:ee,input:te,inputDescription:ae},A=t=>{const s=D(),{notify:a}=k(),{sidePath:l,popSidePath:p,createPageParamsSetter:u}=j(),{createRemovalProfileQuery:m,editRemovalProfileQuery:g}=W(),{getAccessGroupQuery:h}=S(),{data:_}=h(),T=_?.data.map(({name:o,title:n})=>({label:n,value:o}))??[],{mutateAsync:C}=m,{mutateAsync:E}=g,y=u({sidePath:[],profile:""}),G=async o=>{const n={title:o.title,days_without_exchange:o.days_without_exchange,access_group:o.access_group,all_computers:o.all_computers};!o.all_computers&&o.tags.length>0&&(n.tags=o.tags);try{t.action==="edit"?await E({all_computers:n.all_computers,days_without_exchange:n.days_without_exchange,name:t.profile.name,tags:n.tags,title:n.title}):await C(n),y(),a.success({message:`Removal profile ${R[t.action]}`,title:`Removal profile ${o.title} has been ${R[t.action]}`})}catch(w){s(w)}},i=q({initialValues:t.action==="edit"?{access_group:t.profile.access_group,all_computers:t.profile.all_computers,days_without_exchange:t.profile.days_without_exchange,tags:t.profile.tags,title:t.profile.title}:Y,onSubmit:G,validationSchema:Z(t.action)});return e.jsxs(r.Form,{onSubmit:i.handleSubmit,noValidate:!0,children:[e.jsx(r.Input,{type:"text",label:"Title",required:t.action==="add",...i.getFieldProps("title"),error:P(i,"title")}),e.jsxs("div",{className:f.inputContainer,children:[e.jsx(r.Input,{type:"number",inputMode:"numeric",label:"Removal timeframe",required:t.action==="add",autoComplete:"off",className:f.input,wrapperClassName:f.inputWrapper,...i.getFieldProps("days_without_exchange"),error:P(i,"days_without_exchange")}),e.jsx("span",{className:f.inputDescription,children:"days"})]}),e.jsx(r.Select,{label:"Access group",options:T,...i.getFieldProps("access_group"),error:P(i,"access_group")}),e.jsx(V,{formik:i}),e.jsx(z,{submitButtonDisabled:i.isSubmitting,submitButtonText:K[t.action],onCancel:y,hasBackButton:l.length>1,onBackButtonPress:p})]})},Pe=()=>e.jsxs(e.Fragment,{children:[e.jsx(c.Header,{children:"Add removal profile"}),e.jsx(c.Content,{children:e.jsx(A,{action:"add"})})]});function se(t){const s=L(),{data:a,isPending:l,error:p}=M({queryKey:["removalProfile",t],queryFn:async({signal:m})=>s.get("GetRemovalProfiles",{signal:m})}),u=a?.data.find(({id:m})=>m===t);return{removalProfile:u,removalProfileError:a&&!u?new Error("The removal profile could not be found."):p,isGettingRemovalProfile:l}}const I=()=>{const{profile:t}=j(),{isGettingRemovalProfile:s,removalProfile:a,removalProfileError:l}=se(parseInt(t));if(l)throw l;return s?{removalProfile:void 0,isGettingRemovalProfile:!0}:{removalProfile:a,isGettingRemovalProfile:!1}},ve=()=>{const{createSidePathPusher:t}=j(),{getAccessGroupQuery:s}=S(),{removalProfile:a,isGettingRemovalProfile:l}=I(),{data:p,isPending:u}=s(),{value:m,setTrue:g,setFalse:h}=H();if(l||u)return e.jsx(c.LoadingState,{});const _=t("edit");return e.jsxs(e.Fragment,{children:[e.jsx(c.Header,{children:a.title}),e.jsxs(c.Content,{children:[e.jsxs("div",{className:"p-segmented-control",children:[e.jsxs(r.Button,{type:"button",hasIcon:!0,className:"p-segmented-control__button",onClick:_,"aria-label":`Edit ${a.title}`,children:[e.jsx(r.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(r.Button,{className:"p-segmented-control__button",hasIcon:!0,type:"button",onClick:g,"aria-label":`Remove ${a.title}`,children:[e.jsx(r.Icon,{name:r.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]}),e.jsxs(v,{children:[e.jsx(v.Item,{children:e.jsxs(d,{children:[e.jsx(d.Item,{label:"Title",value:a.title}),e.jsx(d.Item,{label:"Name",value:a.name}),e.jsx(d.Item,{label:"Access group",value:Q(a.access_group,p)}),e.jsx(d.Item,{label:"Removal timeframe",large:!0,value:`${a.days_without_exchange} ${U(a.days_without_exchange,"day")}`})]})}),e.jsx(v.Item,{title:"Association",children:e.jsx(J,{profile:a,children:e.jsx(d,{children:e.jsx(d.Item,{label:"Tags",large:!0,value:a.tags.join(", "),type:"truncated"})})})})]})]}),e.jsx(X,{close:h,isOpen:m,removalProfile:a})]})},je=()=>{const{removalProfile:t,isGettingRemovalProfile:s}=I();return s?e.jsx(c.LoadingState,{}):e.jsxs(e.Fragment,{children:[e.jsxs(c.Header,{children:['Edit "',t.title,'" profile']}),e.jsxs(c.Content,{children:[e.jsx(A,{action:"edit",profile:t}),";"]})]})};export{Pe as RemovalProfileAddSidePanel,ve as RemovalProfileDetailsSidePanel,je as RemovalProfileEditSidePanel,be as RemovalProfileList,Se as RemovalProfilesEmptyState,Ae as RemovalProfilesHeader,W as useRemovalProfiles};
