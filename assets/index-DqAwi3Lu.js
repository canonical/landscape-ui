import{e as y,n as S,f as v,g as j,r as w,j as s,h as r}from"./index-BZncHbld.js";import{A}from"./AssociationBlock-DGNvSWUx.js";import{S as P}from"./SidePanelFormButtons-oOW0dnjh.js";import{u as T}from"./index-Bsr5a_2T.js";import{u as R}from"./useRoles-DVYPWMjO.js";import{c as N,a as l,d as C,f as F,b as I}from"./index.esm-CSf5VhIj.js";import"./MultiSelectField-Bd2lbNRn.js";import"./useInstances-DlBpYpfg.js";import"./PageMain-DZPiYS8t.js";import"./useMutation-C-a8eqzH.js";import"./useFetchOld-BIuxw0nI.js";import"./SidePanelFormButtons.module-yv6Qz3cN.js";import"./useConfirm-Q_YLVd4l.js";import"./usePageParams-DsZCpUh3.js";import"./EmptyState-WD5xiPA0.js";import"./HeaderWithSearch-BhNhDEFy.js";const u={add:"Add",edit:"updated"},$={add:"Add removal profile",edit:"Save changes"},q={access_group:"",all_computers:!1,days_without_exchange:"",tags:[],title:""},D=e=>N().shape({access_group:l(),all_computers:C(),days_without_exchange:F().test({name:"required",message:"This field is required.",params:{action:e},test:i=>!!i||!["add","add"].includes(e)}).integer("Timeframe must be an integer value.").min(1,"Timeframe must be at least 1.").max(2147483647,"Timeframe must be less than 2147483648."),tags:I().of(l()),title:l().test({name:"required",message:"This field is required.",params:{action:e},test:i=>!!i||!["add","add"].includes(e)})}),E="_inputContainer_v1jo9_1",B="_input_v1jo9_1",V="_inputDescription_v1jo9_10",n={inputContainer:E,input:B,inputDescription:V},L=e=>{const i=y(),{notify:m}=S(),{closeSidePanel:d}=v(),{createRemovalProfileQuery:p,editRemovalProfileQuery:_}=T(),{getAccessGroupQuery:g}=R(),{data:c}=g(),f=(c==null?void 0:c.data.map(({name:a,title:o})=>({label:o,value:a})))??[],{mutateAsync:h}=p,{mutateAsync:x}=_,t=j({initialValues:q,onSubmit:async a=>{const o={title:a.title,days_without_exchange:a.days_without_exchange,access_group:a.access_group,all_computers:a.all_computers};!a.all_computers&&a.tags.length>0&&(o.tags=a.tags);try{e.action==="edit"?await x({...o,name:e.profile.name}):await h(o),d(),m.success({message:`Removal profile ${u[e.action]}`,title:`Removal profile ${a.title} has been ${u[e.action]}`})}catch(b){i(b)}},validationSchema:D(e.action)});return w.useEffect(()=>{e.action==="edit"&&t.setValues({access_group:e.profile.access_group,all_computers:e.profile.all_computers,days_without_exchange:e.profile.days_without_exchange,tags:e.profile.tags,title:e.profile.title})},[e]),s.jsxs(r.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[s.jsx(r.Input,{type:"text",label:"Name",required:e.action==="add",...t.getFieldProps("title"),error:t.touched.title&&t.errors.title?t.errors.title:void 0}),s.jsxs("div",{className:n.inputContainer,children:[s.jsx(r.Input,{type:"number",inputMode:"numeric",label:"Removal timeframe",required:e.action==="add",autoComplete:"off",className:n.input,wrapperClassName:n.inputWrapper,...t.getFieldProps("days_without_exchange"),error:t.touched.days_without_exchange&&t.errors.days_without_exchange?t.errors.days_without_exchange:void 0}),s.jsx("span",{className:n.inputDescription,children:"days"})]}),s.jsx(r.Select,{label:"Access group",options:f,...t.getFieldProps("access_group"),error:t.touched.access_group&&t.errors.access_group?t.errors.access_group:void 0}),s.jsx(A,{formik:t}),s.jsx(P,{submitButtonDisabled:t.isSubmitting,submitButtonText:$[e.action]})]})},se=L;export{se as default};
