import{i as b,h as S,r as m,j as t,Y as v,m as e,v as x,n as y,D as j,o as p,E as C,I as o,L as _,N as h,l as k,ap as f}from"./index-CTElUWT8.js";import{S as N}from"./SidePanelFormButtons-CYT4_L0-.js";import{S as A}from"./SidePanelTablePagination-nmJUiJhO.js";import{b as I}from"./ScriptsTabs-BbEb29ut.js";import{u as T}from"./useRoles-DZQyhFA2.js";import"./index-Cfr2i4AK.js";import{g as P,a as w}from"./index-Rc92zSwD.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./TruncatedCell-9kQY5eG0.js";import"./HeaderWithSearch-CJoY5Sdd.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";const L=({id:s,...a})=>{const n=b(),{data:i,isLoading:r}=S({queryKey:["scriptProfileActivities",{id:s,...a}],queryFn:async()=>n.get(`script-profiles/${s}/activities`,{params:a})});return{activities:(i==null?void 0:i.data.results)??[],activitiesCount:i==null?void 0:i.data.count,isGettingActivities:r}},z="_link_1wvsk_1",B={link:z},E=({activities:s,viewActivityDetails:a})=>{const n=m.useMemo(()=>[{Header:"Run",Cell:({row:{original:i}})=>t.jsxs(e.Button,{type:"button",appearance:"link",className:y("u-no-margin u-no-padding--top",B.link),onClick:()=>{a(i)},children:[x(i.creation_time).utc().format(j)," "]})},{Header:"Status",Cell:({row:{original:i}})=>v[i.activity_status].label,getCellIcon:({row:{original:i}})=>v[i.activity_status].icon}],[s]);return t.jsx(e.ModularTable,{columns:n,data:s})},R=({profile:s,viewActivityDetails:a})=>{const[n,i]=m.useState(1),[r,l]=m.useState(20),{activities:d,activitiesCount:u,isGettingActivities:c}=L({id:s.id,limit:r,offset:(n-1)*r});return c?t.jsx(p,{}):d.length?t.jsxs(t.Fragment,{children:[t.jsx(E,{activities:d,viewActivityDetails:a}),t.jsx(A,{currentPage:n,pageSize:r,paginate:i,setPageSize:l,totalItems:u})]}):t.jsx(C,{title:"No runs found",body:"The profile has not run yet."})},F=({actions:s,profile:a})=>a.archived?t.jsxs(e.Notification,{inline:!0,title:"Profile archived:",severity:"caution",children:["The profile was archived on"," ",x(a.last_edited_at).format(j),"."]}):t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[t.jsxs(e.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:s.edit,children:[t.jsx(e.Icon,{name:"edit"}),t.jsx("span",{children:"Edit"})]}),t.jsxs(e.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:s.archive,children:[t.jsx(e.Icon,{name:"archive"}),t.jsx("span",{children:"Archive"})]})]})}),D="_link_1wvsk_1",$={link:D},G=({profile:s,viewActivityDetails:a})=>{const{script:n,isScriptLoading:i}=I(s.script_id),{getAccessGroupQuery:r}=T(),{data:l,isLoading:d}=r();if(i||d)return t.jsx(p,{});const u=l==null?void 0:l.data.find(g=>g.name==s.access_group);if(!n||!u)throw new Error;const c=s.activities.last_activity;return t.jsxs(t.Fragment,{children:[t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Name",value:s.title})}),t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Status",value:P(s)})})]}),t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Script",value:t.jsx(_,{className:$.link,to:"/scripts?tab=scripts",state:{scriptId:n.id},children:n.title})})}),t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Access group",value:u.title})})]}),t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Run as user",value:s.username})}),t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Time limit",value:`${s.time_limit}s`})})]}),t.jsx("hr",{}),t.jsx(o,{label:"Trigger",value:w(s)}),t.jsxs(e.Row,{className:"u-no-padding",children:[s.trigger.trigger_type!="event"&&t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Next run",value:s.trigger.next_run?`${x(s.trigger.next_run).utc().format(j)}`:t.jsx(h,{})})}),t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Last run",value:c?t.jsxs(e.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top",onClick:()=>{a(c)},children:[x(c.creation_time).utc().format(j)," "]}):t.jsx(h,{})})})]}),t.jsx("hr",{}),t.jsx("p",{className:"p-heading--5",children:"Association"}),t.jsx(e.Row,{className:"u-no-padding",children:t.jsx(o,{label:"Associated instances",value:s.computers.num_associated_computers?t.jsxs(_,{to:{pathname:"/instances",search:`?tags=${s.tags.join("%2C")}`},children:[s.computers.num_associated_computers," instances"]}):t.jsx(h,{})})}),t.jsx(e.Row,{className:"u-no-padding",children:t.jsx(o,{label:"Tags",value:s.all_computers?"All instances":s.tags.join(", ")||t.jsx(h,{})})})]})},X=({actions:s,profile:a})=>{const{setSidePanelContent:n}=k(),[i,r]=m.useState("info"),l=c=>{n(`${a.title} - ${x(c.creation_time).format(j)}`,t.jsx(m.Suspense,{fallback:t.jsx(p,{}),children:t.jsxs(t.Fragment,{children:[t.jsx(f,{activityId:c.id}),t.jsx(N,{hasActionButtons:!1,hasBackButton:!0,onBackButtonPress:s.viewDetails})]})}))},u=[{label:"Info",id:"info"},{label:"Activity history",id:"activity-history"}].map(({label:c,id:g})=>({label:c,active:i==g,onClick:()=>{r(g)}}));return t.jsxs(t.Fragment,{children:[t.jsx(F,{actions:s,profile:a}),t.jsx(e.Tabs,{listClassName:"u-no-margin--bottom",links:u}),i=="info"&&t.jsx(G,{profile:a,viewActivityDetails:l}),i=="activity-history"&&t.jsx(R,{profile:a,viewActivityDetails:l})]})};export{X as default};
