import{e as v,b as C,c as I,d as L,B as N,p as w,r as P,j as s,N as f,g as p,m as y,I as x,n as D}from"./index-BWDSuVdc.js";import{P as k,a as M,b as U}from"./PageMain-DgpfYE6B.js";import{d as T,s as g}from"./constants-BiU2XIF5.js";import"./usePageParams-Bts0F2BK.js";import{u as B}from"./EditUserForm-Dk-DEqye.js";import"./useFetchOld-BrEW1db4.js";import"./NoData-B3Q3EXVi.js";import"./index-Dth2zyxz.js";import"./TablePagination-B-je2IEH.js";import"./TablePaginationBase-BhH1Qvbp.js";import"./StatusFilter-BJ1mp4rK.js";import"./TableFilter-B1PCZQ69.js";import"./TableFilterChips-BuKzUo5Y.js";import"./SidePanelFormButtons.module-tJTvEwdD.js";import"./formikErrors-BhPg4HXw.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},i=new t.Error().stack;i&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[i]="0945413b-0960-47df-bd80-154118d4e182",t._sentryDebugIdIdentifier="sentry-dbid-0945413b-0960-47df-bd80-154118d4e182")}catch{}function A(){const t=v(),i=C(),r=(n={},o={})=>L({queryKey:["userDetails","getCredentials"],queryFn:()=>t.get("credentials",{params:n}),...o}),l=I({mutationKey:["userDetails","generate"],mutationFn:n=>t.post("credentials",n),onSuccess:()=>i.invalidateQueries({queryKey:["userDetails","getCredentials"]})});return{getUserApiCredentials:r,generateApiCredentials:l}}const E="_tableWrapper_4bdb3_1",K="_apiCredentials_4bdb3_10",j={tableWrapper:E,apiCredentials:K},G=({user:t,credentials:i})=>{const r=N("(min-width: 620px)"),l=w(),{generateApiCredentials:n}=A(),{mutateAsync:o,isPending:d}=n,m=async a=>{try{await o({account:a})}catch(e){l(e)}},b=P.useMemo(()=>[{Header:"Label",accessor:"label"},{Header:"Value",accessor:"value",Cell:({value:a})=>a}],[t,i]);return t.accounts.map(a=>{const e=i.find(u=>u.account_name===a.name),h=[{label:"Name",value:e==null?void 0:e.account_name},{label:"Title",value:e==null?void 0:e.account_title},{label:"Identity",value:s.jsx("code",{children:t.identity})},{label:"Endpoint",value:s.jsx("code",{children:e==null?void 0:e.endpoint})},{label:"Access Key",value:e!=null&&e.access_key?s.jsx("code",{children:e.access_key}):f},{label:"Secret Key",value:e!=null&&e.secret_key?s.jsx("code",{children:e.secret_key}):f},{label:"Roles",value:a.roles.join(", ")}],c=e!=null&&e.secret_key||e!=null&&e.access_key?"Regenerate":"Generate";return s.jsx("div",{className:T.item,children:s.jsxs("div",{className:g.card,children:[s.jsxs("div",{className:g.header,children:[s.jsx("p",{className:g.title,children:a.title}),s.jsxs(p.ConfirmationButton,{className:y("u-no-margin--bottom",{"is-small":r}),type:"button",confirmationModalProps:{title:`${c} API credentials for ${a.title}`,children:s.jsxs("p",{children:[c==="Regenerate"?`${c.slice(0,-1)}ing your API credentials will make your previously used credentials obsolete and deauthenticate any clients using them. `:"","This action will create new credentials for integrating with the ",a.title," organisation"]}),confirmButtonLabel:`${c} API credentials`,confirmButtonDisabled:d,confirmButtonLoading:d,onConfirm:()=>m(a.name)},children:[c," API credentials"]})]}),s.jsx("div",{className:y(g.content,j.tableWrapper),children:r?s.jsx(p.ModularTable,{columns:b,data:h,emptyMsg:"No data available"}):h.map((u,_)=>s.jsxs(p.Row,{className:y("u-no-padding--left u-no-padding--right",j.apiCredentials),children:[s.jsx(p.Col,{size:2,small:2,children:s.jsx(x,{label:"",value:u.label})}),s.jsx(p.Col,{size:2,small:2,children:s.jsx(x,{label:"",value:u.value})})]},_))})]})},a.title)})},ee=()=>{var e;const{getUserDetails:t}=B(),{getUserApiCredentials:i}=A(),{data:r,isLoading:l}=t(),{data:n,isLoading:o}=i(),d=r==null?void 0:r.data,m=(e=n==null?void 0:n.data)==null?void 0:e.credentials,b=d&&m,a=l||o;return s.jsxs(k,{children:[s.jsx(M,{title:"API credentials"}),s.jsxs(U,{children:[a&&s.jsx(D,{}),b&&s.jsx(G,{user:d,credentials:m})]})]})};export{ee as default};
