const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DvUYA-ZD.js","assets/index-BZncHbld.js","assets/index-DWaf_ZwL.css","assets/InfoItem-M3f9HIaq.js","assets/InfoItem-C-lWh_lY.css","assets/useConfirm-Q_YLVd4l.js","assets/NoData-CnQp-2wz.js","assets/PageMain-DZPiYS8t.js","assets/PageMain-BIuYvhUI.css","assets/EmptyState-WD5xiPA0.js","assets/EmptyState-DUn4ZRie.css","assets/useRoles-DVYPWMjO.js","assets/useMutation-C-a8eqzH.js","assets/useFetchOld-BIuxw0nI.js","assets/usePageParams-DsZCpUh3.js","assets/HeaderWithSearch-BhNhDEFy.js","assets/HeaderWithSearch-DQybm8h_.css","assets/AssociationBlock-DGNvSWUx.js","assets/MultiSelectField-Bd2lbNRn.js","assets/MultiSelectField-DOBW8uWL.css","assets/useInstances-DlBpYpfg.js","assets/AssociationBlock-Cb2Mr2ww.css","assets/SidePanelFormButtons-oOW0dnjh.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/index.esm-CSf5VhIj.js","assets/FileInput-DLYFwRsJ.js","assets/WslInstancesHeader-BVZKQZe8.js","assets/WslInstancesHeader-C2N1H1qb.css","assets/CodeEditor-BOtFug1d.js","assets/CodeEditor-CA89WJcJ.css","assets/index-DMJRXBNc.css"])))=>i.map(i=>d[i]);
import{r as m,_ as F,f as W,j as e,h as a,l as P,c as te,d as se,e as $,n as q,i as N,g as A}from"./index-BZncHbld.js";import{u as oe,P as ie,a as ae,b as ne}from"./PageMain-DZPiYS8t.js";import{E as re}from"./EmptyState-WD5xiPA0.js";import{u as R}from"./useRoles-DVYPWMjO.js";import{u as E}from"./usePageParams-DsZCpUh3.js";import{N as le}from"./NoData-CnQp-2wz.js";import{u as w}from"./useMutation-C-a8eqzH.js";import{u as ce}from"./useConfirm-Q_YLVd4l.js";import{H as ue}from"./HeaderWithSearch-BhNhDEFy.js";import{A as k}from"./AssociationBlock-DGNvSWUx.js";import{S as B}from"./SidePanelFormButtons-oOW0dnjh.js";import{c as D,a as p,g as de,d as M,b as z}from"./index.esm-CSf5VhIj.js";import{F as pe}from"./FileInput-DLYFwRsJ.js";import{u as V}from"./WslInstancesHeader-BVZKQZe8.js";import{C as me}from"./CodeEditor-BOtFug1d.js";const ge=m.lazy(()=>F(()=>Promise.resolve().then(()=>X),void 0)),Q=()=>{const{setSidePanelContent:t}=W(),i=()=>{t("Add WSL profile",e.jsx(m.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ge,{action:"add"})}))};return e.jsx(re,{title:"You don't have any WSL profiles yet",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"WSL profiles allow you to create and apply configurations for Windows Subsystem for Linux &lpar;WSL&rpar; instances, in bulk."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/manage-wsl-instances-in-landscape",target:"_blank",rel:"nofollow noopener noreferrer",children:"Learn how to use WSL profiles"})]}),cta:[e.jsx(a.Button,{appearance:"positive",onClick:i,children:"Add WSL profile"},"add")]})},fe=`These instances are not compliant
with the profile. They do not have a
pending activity to become compliant.`,he=`These instances are not compliant
with the profile. They do have a
pending activity to apply its
constraints.`,be=({column:t})=>{const i={};return t.id==="name"?i.role="rowheader":t.id==="access_group"?i["aria-label"]="Access group":t.id==="tags"?i["aria-label"]="Tags":t.id==="description"?i["aria-label"]="Description":t.id==="computers['non-compliant']"?i["aria-label"]="Not compliant instances":t.id==="computers['pending']"?i["aria-label"]="Pending instances":t.id==="computers['constrained']"?i["aria-label"]="Associated instances":t.id==="actions"&&(i["aria-label"]="Actions"),i},_e="_truncated_lm2kq_1",ye="_noWrap_lm2kq_2",xe="_actions_lm2kq_11",Ie="_description_lm2kq_15",Pe="_toggleButton_lm2kq_19",Se="_actionButton_lm2kq_24",_={truncated:_e,noWrap:ye,actions:xe,description:Ie,toggleButton:Pe,actionButton:Se};function L(){const t=te(),i=se(),r=(d,f={})=>oe({queryKey:["wslProfiles"],queryFn:()=>i.get("child-instance-profiles"),...f}),c=w({mutationFn:d=>i.post("child-instance-profiles",d),onSuccess:()=>t.invalidateQueries({queryKey:["wslProfiles"]})}),u=w({mutationFn:({name:d})=>i.delete(`child-instance-profiles/${d}`),onSuccess:()=>t.invalidateQueries({queryKey:["wslProfiles"]})}),y=w({mutationFn:({name:d,...f})=>i.patch(`child-instance-profiles/${d}`,f),onSuccess:()=>t.invalidateQueries({queryKey:["wslProfiles"]})});return{createWslProfileQuery:c,editWslProfileQuery:y,getWslProfilesQuery:r,removeWslProfileQuery:u}}const je=m.lazy(()=>F(()=>Promise.resolve().then(()=>De),void 0)),Te=m.lazy(()=>F(()=>Promise.resolve().then(()=>X),void 0)),ve=m.lazy(()=>F(()=>import("./index-DvUYA-ZD.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]))),H=({wslProfiles:t})=>{const{search:i}=E(),r=$(),{notify:c}=q(),{setSidePanelContent:u}=W(),{getAccessGroupQuery:y}=R(),{removeWslProfileQuery:d}=L(),{closeConfirmModal:f,confirmModal:h}=ce(),{mutateAsync:x}=d,{data:I}=y(),b=(I==null?void 0:I.data.map(({name:s,title:l})=>({label:l,value:s})))??[],S=s=>{u(s.title,e.jsx(m.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ve,{profile:s,accessGroupOptions:b})}))},j=s=>{u(`Edit "${s.title}" profile`,e.jsx(m.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(je,{profile:s})}))},T=s=>{u(`Duplicate "${s.title}" profile`,e.jsx(m.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Te,{action:"duplicate",profile:s})}))},n=async s=>{try{await x({name:s}),c.success({message:`WSL profile "${s}" removed successfully.`,title:"WSL profile removed"})}catch(l){r(l)}finally{f()}},o=(s,l)=>{h({title:`Remove ${s}`,body:e.jsxs("p",{children:["Removing this profile will affect"," ",e.jsxs("b",{children:[l," instances"]}),". This action is irreversible."]}),buttons:[e.jsx(a.Button,{type:"button",appearance:"negative",onClick:()=>n(s),"aria-label":`Remove ${s} profile`,children:"Remove"},"remove")]})},g=m.useMemo(()=>i?t.filter(s=>s.title.toLowerCase().includes(i.toLowerCase())):t,[t,i]),C=m.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:{original:s}})=>e.jsx(a.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>S(s),children:s.title})},{accessor:"description",className:N(_.truncated,_.description),Header:"Description"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:{access_group:s}}})=>{var l;return((l=b.find(({value:v})=>v===s))==null?void 0:l.label)??s}},{accessor:"tags",className:_.truncated,Header:"Tags",Cell:({row:{original:s}})=>s.tags.join(", ")||e.jsx(le,{})},{accessor:"computers['non-compliant']",Header:e.jsxs("div",{className:_.noWrap,children:[e.jsx("span",{children:"Not compliant "}),e.jsx(a.Tooltip,{position:"btm-left",message:fe,children:e.jsx(a.Icon,{name:"help"})})]}),Cell:({row:{original:s}})=>e.jsx(e.Fragment,{children:`${s.computers["non-compliant"].length} ${s.computers["non-compliant"].length===1?"instance":"instances"}`})},{accessor:"computers['pending']",Header:e.jsxs("div",{className:_.noWrap,children:[e.jsx("span",{children:"Pending "}),e.jsx(a.Tooltip,{position:"btm-left",message:he,children:e.jsx(a.Icon,{name:"help"})})]}),Cell:({row:{original:s}})=>{var l,v;return e.jsx(e.Fragment,{children:`${((l=s.computers.pending)==null?void 0:l.length)??0} ${((v=s.computers.pending)==null?void 0:v.length)===1?"instance":"instances"}`})}},{accessor:"computers['constrained']",Header:"Associated",Cell:({row:{original:s}})=>e.jsx(e.Fragment,{children:`${s.computers.constrained.length} ${s.computers.constrained.length===1?"instance":"instances"}`})},{accessor:"actions",className:N("u-align-text--right",_.actions),Header:"Actions",Cell:({row:{original:s}})=>e.jsxs(a.ContextualMenu,{position:"left",toggleClassName:_.toggleButton,toggleAppearance:"base",toggleLabel:e.jsx(a.Icon,{name:"contextual-menu","aria-hidden":!0}),toggleProps:{"aria-label":`${s.name} profile actions`},children:[e.jsxs(a.Button,{type:"button",appearance:"base",hasIcon:!0,className:N("u-no-margin--bottom u-no-margin--right",_.actionButton),onClick:()=>j(s),"aria-label":`Edit ${s.name} profile`,children:[e.jsx(a.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(a.Button,{type:"button",appearance:"base",hasIcon:!0,className:N("u-no-margin--bottom u-no-margin--right",_.actionButton),onClick:()=>T(s),"aria-label":`Edit ${s.name} profile`,children:[e.jsx(a.Icon,{name:"canvas"}),e.jsx("span",{children:"Duplicate"})]}),e.jsxs(a.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-margin--right p-contextual-menu__link",onClick:()=>o(s.name,s.computers.constrained.length),"aria-label":`Remove ${s.name} profile`,children:[e.jsx(a.Icon,{name:a.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]})}],[g,b.length]);return e.jsx(a.ModularTable,{columns:C,data:g,emptyMsg:`No WSL profiles found with the search "${i}"`,getCellProps:be})},U=()=>{const{setPageParams:t}=E(),i=r=>{t({search:r})};return e.jsx(ue,{onSearch:i})},Fe=1,G=[{label:"Select",value:""},{label:"From a file",value:"file"},{label:"Plain text",value:"text"}],We="You can use a cloud-init configuration YAML file under 1MB to register new WSL instances. Cloud-init streamlines the setup by automating installation and configuration tasks.",Le=[/^ubuntu$/,/^ubuntu-preview$/,/^ubuntu-[0-9]{2}\.[0-9]{2}$/],Ne=()=>D().shape({title:p().required("This field is required"),access_group:p().required("This field is required"),description:p().required("This field is required"),instanceType:p().required("This field is required"),rootfsImage:p().when("instanceType",{is:"custom",then:t=>t.required("This field is required"),otherwise:t=>t.notRequired()}),customImageName:p().when("instanceType",{is:"custom",then:t=>t.required("This field is required").test("not-match-reserved-patterns","Instance name cannot match 'ubuntu', 'ubuntu-preview', or 'ubuntu-<dd>.<dd>'",i=>!Le.some(r=>r.test(i.toLowerCase()))),otherwise:t=>t.notRequired()}),cloudInitType:p(),cloudInit:de().nullable().when("cloudInitType",{is:t=>t==="file"||t==="text",then:t=>t.required("This field is required").test("file-size","File size must be less than 1MB",i=>(typeof i=="string"&&(i=K(i)),i?i.size===void 0?!1:i.size<=Fe*1024*1024:!0)),otherwise:t=>t.notRequired()}),all_computers:M(),tags:z().of(p())}),Ce=t=>t.action==="add"?{title:"",access_group:"",description:"",instanceType:"",customImageName:"",rootfsImage:"",cloudInitType:"",cloudInit:null,all_computers:!1,tags:[]}:{title:`${t.profile.title} (copy)`,access_group:t.profile.access_group,all_computers:t.profile.all_computers,cloudInit:null,cloudInitType:"",description:t.profile.description,tags:t.profile.tags,customImageName:t.profile.image_source?t.profile.image_name:"",instanceType:t.profile.image_source?"custom":t.profile.image_name,rootfsImage:t.profile.image_source||""},K=t=>{const i=new Blob([t],{type:"application/x-yaml"});return new File([i],"myFile.yaml",{type:"application/x-yaml"})},we=t=>{if(t)return new Promise((i,r)=>{const c=new FileReader;c.readAsDataURL(t),c.onload=()=>i(c.result),c.onerror=u=>r(u)})},Oe=async t=>{if(t===null)return;let i;typeof t=="string"?i=K(t):i=t;const r=await we(i);return r?r.split(",")[1]:void 0},$e="_block_zzdrk_1",qe={block:$e},O={add:{notificationAction:"added",ariaLabel:"Add a new WSL profile",buttonLabel:"Add WSL profile"},duplicate:{notificationAction:"duplicated",ariaLabel:"Duplicate WSL profile",buttonLabel:"Duplicate"}},Re=t=>{const i=$(),{closeSidePanel:r}=W(),{notify:c}=q(),{getAccessGroupQuery:u}=R(),{getWslInstanceNamesQuery:y}=V(),{createWslProfileQuery:d}=L(),{mutateAsync:f}=d,{data:h}=u(),{data:x,isLoading:I}=y(),b=((x==null?void 0:x.data)??[]).map(({label:s,name:l})=>({label:s,value:l}))||[],S=[{label:"Select",value:""},...b,{label:"From URL",value:"custom"}],j=(h==null?void 0:h.data.map(({name:s,title:l})=>({label:l,value:s})))??[],T=[{label:"Select access group",value:""},...j],n=async s=>{try{const l=await Oe(o.values.cloudInit),J=(await f({title:s.title,access_group:s.access_group,description:s.description,image_name:s.instanceType==="custom"?s.customImageName:s.instanceType,image_source:s.rootfsImage,cloud_init_contents:l,all_computers:s.all_computers,tags:s.tags})).data.computers.constrained.length;r();const ee=t.action==="add"?s.title:t.profile.title;c.success({title:`Profile "${ee}" ${O[t.action].notificationAction} successfully`,message:`It has been associated with ${J} instances`})}catch(l){i(l)}},o=A({initialValues:Ce(t),onSubmit:n,validationSchema:Ne()}),g=async s=>{await o.setFieldValue("cloudInit",s[0])},C=async()=>{await o.setFieldValue("cloudInit",null)};return e.jsxs(a.Form,{onSubmit:o.handleSubmit,noValidate:!0,children:[e.jsx(a.Input,{type:"text",label:"Name",required:!0,...o.getFieldProps("title"),error:o.touched.title&&o.errors.title?o.errors.title:void 0}),e.jsx(a.Input,{type:"text",label:"Description",required:!0,...o.getFieldProps("description"),error:o.touched.description&&o.errors.description?o.errors.description:void 0}),e.jsx(a.Select,{label:"Access group","aria-label":"Access group",required:!0,options:T,...o.getFieldProps("access_group"),error:o.touched.access_group&&o.errors.access_group?o.errors.access_group:void 0}),e.jsxs("div",{className:qe.block,children:[(o.values.instanceType!==""||o.values.cloudInitType!=="")&&e.jsx(a.Notification,{severity:"caution",title:"Warning",children:e.jsx("span",{children:"Once the profile is added, you cannot modify the RootFS image or Cloud-init file."})}),e.jsx(a.Select,{label:"RootFS image",disabled:I,"aria-label":"RootFS image",options:S,required:!0,...o.getFieldProps("instanceType"),error:o.touched.instanceType&&o.errors.instanceType?o.errors.instanceType:void 0}),o.values.instanceType==="custom"&&e.jsxs(e.Fragment,{children:[e.jsx(a.Input,{label:"Image name",type:"text",...o.getFieldProps("customImageName"),error:o.touched.customImageName&&o.errors.customImageName?o.errors.customImageName:void 0}),e.jsx(a.Input,{type:"text",label:"RootFS image URL",...o.getFieldProps("rootfsImage"),error:o.touched.rootfsImage&&o.errors.rootfsImage?o.errors.rootfsImage:void 0,help:"The file path must be reachable by the affected WSL instances"})]}),e.jsx(a.Select,{label:"Cloud-init","aria-label":"Cloud-init",options:G,...o.getFieldProps("cloudInitType"),error:o.touched.cloudInitType&&o.errors.cloudInitType?o.errors.cloudInitType:void 0}),o.values.cloudInitType==="file"&&e.jsx(pe,{label:"Upload cloud-init",labelClassName:"u-off-screen",accept:".yaml",...o.getFieldProps("cloudInit"),onFileRemove:C,onFileUpload:g,help:We,error:o.touched.cloudInit&&o.errors.cloudInit?o.errors.cloudInit:void 0}),o.values.cloudInitType==="text"&&e.jsx(me,{label:"Cloud init configuration",onChange:s=>{o.setFieldValue("cloudInit",s??"")},value:o.values.cloudInit??"",language:"yaml",defaultValue:"# paste cloud-init config here",error:o.touched.cloudInit&&o.errors.cloudInit?o.errors.cloudInit:void 0})]}),e.jsx(k,{formik:o}),e.jsx(B,{submitButtonText:O[t.action].buttonLabel,submitButtonAriaLabel:O[t.action].ariaLabel,submitButtonDisabled:o.isSubmitting})]})},Y=Re,X=Object.freeze(Object.defineProperty({__proto__:null,default:Y},Symbol.toStringTag,{value:"Module"})),Ae=()=>D().shape({title:p().required("This field is required"),description:p().required("This field is required"),access_group:p().required("This field is required"),all_computers:M(),tags:z().of(p())}),Ee="_block_zzdrk_1",ke={block:Ee},Be=({profile:t})=>{const{getAccessGroupQuery:i}=R(),{getWslInstanceNamesQuery:r}=V(),{editWslProfileQuery:c}=L(),u=$(),{closeSidePanel:y}=W(),{notify:d}=q(),{mutateAsync:f}=c,{data:h}=r(),x=((h==null?void 0:h.data)??[]).map(({label:o,name:g})=>({label:o,value:g}))||[],I=[{label:"Select",value:""},...x,{label:"From URL",value:"custom"}],{data:b}=i(),S=(b==null?void 0:b.data.map(({name:o,title:g})=>({label:g,value:o})))??[],j=[{label:"Select access group",value:""},...S],T=async o=>{try{await f({name:t.name,title:o.title,access_group:o.access_group,description:o.description,all_computers:o.all_computers,tags:o.tags}),y(),d.success({title:"WSL profile updated",message:`WSL profile "${t.title}" updated successfully`})}catch(g){u(g)}},n=A({initialValues:{title:t.title,access_group:t.access_group,description:t.description,instanceType:t.image_source?"custom":t.image_name,customImageName:t.image_source?t.image_name:"",rootfsImage:t.image_source||"",all_computers:t.all_computers,tags:t.tags},onSubmit:T,validationSchema:Ae()});return e.jsxs(a.Form,{onSubmit:n.handleSubmit,noValidate:!0,children:[e.jsx(a.Input,{type:"text",label:"Name",required:!0,...n.getFieldProps("title"),error:n.touched.title&&n.errors.title?n.errors.title:void 0}),e.jsx(a.Input,{type:"text",label:"Description",required:!0,...n.getFieldProps("description"),error:n.touched.description&&n.errors.description?n.errors.description:void 0}),e.jsx(a.Select,{label:"Access group","aria-label":"Access group",options:j,required:!0,...n.getFieldProps("access_group"),error:n.touched.access_group&&n.errors.access_group?n.errors.access_group:void 0}),e.jsxs("div",{className:ke.block,children:[e.jsx(a.Notification,{severity:"caution",title:"Editing unavailable",children:e.jsx("span",{children:"You cannot edit RootFS image or Cloud-init file. To modify these fields, create a new profile."})}),e.jsx(a.Select,{disabled:!0,label:"RootFS image","aria-label":"RootFS image",options:I,...n.getFieldProps("instanceType"),error:n.touched.instanceType&&n.errors.instanceType?n.errors.instanceType:void 0}),n.values.instanceType==="custom"&&e.jsxs(e.Fragment,{children:[e.jsx(a.Input,{disabled:!0,label:"Image name",type:"text",required:!0,...n.getFieldProps("customImageName"),error:n.touched.customImageName&&n.errors.customImageName?n.errors.customImageName:void 0}),e.jsx(a.Input,{disabled:!0,type:"text",label:"RootFS image URL",required:!0,...n.getFieldProps("rootfsImage"),error:n.touched.rootfsImage&&n.errors.rootfsImage?n.errors.rootfsImage:void 0,help:"The file path must be reachable by the affected WSL instances"})]}),e.jsx(a.Select,{label:"Cloud-init","aria-label":"Cloud-init",options:G,disabled:!0})]}),e.jsx(k,{formik:n}),e.jsx(B,{submitButtonText:"Save changes",submitButtonDisabled:n.isSubmitting})]})},Z=Be,De=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"})),Me=Object.freeze(Object.defineProperty({__proto__:null,WslProfileEditForm:Z,WslProfileInstallForm:Y,WslProfilesEmptyState:Q,WslProfilesHeader:U,WslProfilesList:H,useWslProfiles:L},Symbol.toStringTag,{value:"Module"})),ze=m.lazy(()=>F(()=>Promise.resolve().then(()=>Me),void 0).then(t=>({default:t.WslProfileInstallForm}))),Ve=()=>{const{setSidePanelContent:t}=W(),{getWslProfilesQuery:i}=L(),{data:r,isLoading:c}=i(),u=()=>{t("Add WSL profile",e.jsx(m.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(ze,{action:"add"})}))};return e.jsxs(ie,{children:[e.jsx(ae,{title:"WSL Profiles",actions:[e.jsx(a.Button,{type:"button",appearance:"positive",onClick:u,children:"Add WSL profile"},"add-wsl-profile")]}),e.jsxs(ne,{children:[c&&e.jsx(P,{}),!c&&(!r||r.data.results.length===0)&&e.jsx(Q,{}),!c&&r&&r.data.results.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(U,{}),e.jsx(H,{wslProfiles:r.data.results})]})]})]})},Qe=Ve,rt=Object.freeze(Object.defineProperty({__proto__:null,default:Qe},Symbol.toStringTag,{value:"Module"}));export{De as a,rt as b,X as i,L as u};
