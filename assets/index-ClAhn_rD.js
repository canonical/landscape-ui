import{e as T,l as j,f as _,j as s,g as a}from"./index-Bwv21umG.js";import{u as F}from"./formik.esm-1BnXfl6u.js";import{h as m}from"./moment-Cl4UOzQZ.js";import{M as p}from"./MultiSelectField-DzfkgJ8Q.js";import{S as $}from"./SidePanelFormButtons-CYk-y39P.js";import{u as A}from"./index-yrHjlw-1.js";import{u as N}from"./useInstances-zDlqbUFb.js";import{c as P,d as V,a as d,b as y,f as k}from"./index.esm-BNxcffbw.js";import"./MultiSelectField.module-D1r8qo_i.js";import"./SidePanelFormButtons.module-DyBJG5lm.js";import"./useConfirm-C8SdOzvQ.js";import"./EmptyState-BVaENBo3.js";import"./useFetchOld-CLIuhBjP.js";import"./useMutation-J8RvGgz_.js";import"./useQuery-Dt9EUPCN.js";import"./useRoles-CEVrDnUF.js";const O={deliverImmediately:!0,deliver_after:"",instanceIds:[],queryType:"tags",tags:[],username:""},w=P().shape({deliverImmediately:V().required("This field is required."),deliver_after:d().when("deliverImmediately",{is:!1,then:i=>i.required("This field is required.")}),instanceIds:y().of(k()).when("queryType",{is:"ids",then:i=>i.min(1,"At least one instance is required.")}),queryType:d().required("This field is required."),tags:y().of(d()).when("queryType",{is:"tags",then:i=>i.min(1,"At least one tag is required.")}),username:d().required("This field is required.")}),C="_bold_23wb5_1",D="_radioGroup_23wb5_5",f={bold:C,radioGroup:D},R=({script:i})=>{const v=T(),{notify:g}=j(),{closeSidePanel:I}=_(),{getAllInstanceTagsQuery:h,getInstancesQuery:b}=N(),{executeScriptQuery:q}=A(),{mutateAsync:S}=q,e=F({initialValues:O,onSubmit:async t=>{const r={query:t.queryType==="ids"?`id:${t.instanceIds.join(" OR id:")}`:`tag:${t.tags.join(" OR tag:")}`,script_id:i.id,username:t.username};t.deliverImmediately||(r.deliver_after=m(t.deliver_after).toISOString().replace(/\.\d+(?=Z$)/,""));try{await S(r),I(),g.success({message:`"${i.title}" script queued to execute successfully`,title:"Script execution queued"})}catch(x){v(x)}},validationSchema:w}),{data:o}=h(),n=(o==null?void 0:o.data.results.map(t=>({label:t,value:t})))??[],{data:l}=b(),u=(l==null?void 0:l.data.results.map(({title:t,id:r})=>({label:t,value:r})))??[],c=t=>{const r=t.currentTarget.value==="true";e.setFieldValue("deliverImmediately",r),r||e.setFieldValue("deliver_after",m().toISOString().slice(0,16))};return s.jsxs(a.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[s.jsx("p",{className:"u-no-margin--bottom",children:"Select instances by:"}),s.jsxs("div",{className:"p-form--inline is-required",children:[s.jsx(a.Input,{type:"radio",label:"Tags",...e.getFieldProps("queryType"),value:"tags",checked:e.values.queryType==="tags"}),s.jsx(a.Input,{type:"radio",label:"Names",...e.getFieldProps("queryType"),value:"ids",checked:e.values.queryType==="ids"})]}),e.values.queryType==="tags"&&s.jsx(p,{variant:"condensed",label:"Tags",required:!0,...e.getFieldProps("tags"),items:n,selectedItems:n.filter(({value:t})=>e.values.tags.includes(t)),onItemsUpdate:t=>e.setFieldValue("tags",t.map(({value:r})=>r)),error:e.touched.tags&&typeof e.errors.tags=="string"?e.errors.tags:void 0}),e.values.queryType==="ids"&&s.jsx(p,{variant:"condensed",label:"Instances",required:!0,...e.getFieldProps("instanceIds"),items:u,selectedItems:u.filter(({value:t})=>e.values.instanceIds.includes(t)),onItemsUpdate:t=>e.setFieldValue("instanceIds",t.map(({value:r})=>r)),error:e.touched.instanceIds&&typeof e.errors.instanceIds=="string"?e.errors.instanceIds:void 0}),s.jsx(a.Input,{type:"text",label:"Run as user",autoComplete:"off",required:!0,...e.getFieldProps("username"),error:e.touched.username&&e.errors.username?e.errors.username:void 0}),s.jsx("span",{className:f.bold,children:"Delivery time"}),s.jsxs("div",{className:f.radioGroup,children:[s.jsx(a.Input,{type:"radio",label:"As soon as possible",name:"deliverImmediately",value:"true",onChange:c,checked:e.values.deliverImmediately}),s.jsx(a.Input,{type:"radio",label:"Scheduled",name:"deliverImmediately",value:"false",onChange:c,checked:!e.values.deliverImmediately})]}),!e.values.deliverImmediately&&s.jsx(a.Input,{type:"datetime-local",label:"Deliver after",labelClassName:"u-off-screen",...e.getFieldProps("deliver_after"),error:e.touched.deliver_after&&e.errors.deliver_after?e.errors.deliver_after:void 0}),s.jsx($,{submitButtonDisabled:e.isSubmitting,submitButtonText:"Run script"})]})},se=R;export{se as default};
