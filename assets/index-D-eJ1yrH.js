import{i as _,h as g,r as p,j as a,m as n,I as l,v as x,D as f,N as j,L as y}from"./index-BWFRbB2q.js";import{f as k}from"./ScriptsTabs-D55C_IiX.js";import"./TruncatedCell-7BS-SGSa.js";import"./HeaderWithSearch-D_aOWktC.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";import"./index-BEAbIWny.js";const w=({attachmentId:e,scriptId:s},d={enabled:!0})=>{const r=_(),{data:o,isLoading:m,refetch:t}=g({queryKey:["scripts","attachment",e],queryFn:async()=>r.get(`scripts/${s}/attachments/${e}`),...d});return{scriptAttachment:(o==null?void 0:o.data)??null,isScriptAttachmentsLoading:m,refetch:t}},v="_attachmentBlock_1hc4o_1",L="_attachment_1hc4o_1",N="_link_1hc4o_15",h={attachmentBlock:v,attachment:L,link:N},$=({script:e})=>{const[s,d]=p.useState(null),{isScriptAttachmentsLoading:r,refetch:o}=w({attachmentId:(s==null?void 0:s.id)??0,scriptId:e.id},{enabled:!1});p.useEffect(()=>{(async()=>{if(!s)return;const{data:c}=await o();if(!c)return;const b=new Blob([c.data],{type:"application/octet-stream"}),u=URL.createObjectURL(b),i=document.createElement("a");i.href=u,i.download=s.name,document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(u),d(null)})()},[s,o]);const m=async(t,c)=>{d({id:t,name:c})};return a.jsxs(a.Fragment,{children:[a.jsxs(n.Row,{className:"u-no-padding",children:[a.jsx(n.Col,{size:6,children:a.jsx(l,{label:"name",value:e.title})}),a.jsx(n.Col,{size:6,children:a.jsx(l,{label:"version",value:e.version_number})})]}),a.jsx(n.Row,{className:"u-no-padding",children:a.jsx(l,{label:"status",value:k(e.status)})}),a.jsx(n.Row,{className:"u-no-padding",children:a.jsx(l,{label:"Date created",value:`${x(e.created_at).format(f)} by ${e.created_by.name}`})}),a.jsx(n.Row,{className:"u-no-padding",children:a.jsx(l,{label:"Last modified",value:`${x(e.last_edited_at).format(f)} by ${e.last_edited_by.name}`})}),a.jsx(n.Row,{className:"u-no-padding",children:a.jsx(n.Col,{size:12,children:a.jsx(l,{className:h.attachmentBlock,label:"attachments",value:e.attachments.length>0?e.attachments.map(t=>a.jsxs("span",{className:h.attachment,children:[a.jsx("span",{children:t.filename}),a.jsx(n.Button,{className:"u-no-margin--bottom",type:"button",onClick:async()=>m(t.id,t.filename),disabled:r&&(s==null?void 0:s.id)===t.id,appearance:"link","aria-label":`Download ${t.filename}`,children:a.jsx(n.Icon,{name:"begin-downloading"})})]},t.id)):a.jsx(j,{})})})}),a.jsx(l,{label:"associated profiles",value:e.script_profiles.length>0?e.script_profiles.map((t,c)=>a.jsxs(y,{className:h.link,to:"/scripts?tab=profiles",state:{scriptProfileId:t.id},children:[t.title,c<e.script_profiles.length-1?", ":""," "]},t.id)):a.jsx(j,{})})]})};export{$ as default};
