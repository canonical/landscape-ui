import{aA as y,l as g,j as e,z as p,N as h,aB as x,aq as _,k as u,m as j,aD as m,T as f,am as v,b as E,i as b,a as C,d as P,A as L,an as w}from"./index-CYddq1Dt.js";import{P as T,a as D,b as F}from"./PageMain-wcB-RWYa.js";import{H}from"./HeaderWithSearch-LK3eyMPY.js";const R="_message_1hc9t_1",I={message:R},N=n=>({index:s})=>{const a={};return n===s&&(a.className="expandedRow"),a},S=n=>({column:s,row:{index:a}})=>{const t={};return s.id==="creation_time"?t.role="rowheader":s.id==="person_name"?t["aria-label"]="username":s.id==="entity_type"?t["aria-label"]="entity type":s.id==="entity_name"?t["aria-label"]="entity name":s.id==="message"&&(t["aria-label"]="message",n===a&&(t.className="expandedCell")),t},M=({eventsLog:n})=>{const{expandedRowIndex:s,getTableRowsRef:a,handleExpand:t}=y(),l=g.useMemo(()=>[{accessor:"creation_time",Header:"creation time",className:"date-cell",Cell:({row:o})=>e.jsx("span",{className:"font-monospace",children:p(o.original.creation_time).format(h)})},{accessor:"person_name",Header:"username",Cell:({row:o})=>e.jsx(e.Fragment,{children:o.original.person_name})},{accessor:"entity_type",Header:"entity type",Cell:({row:o})=>e.jsx(e.Fragment,{children:o.original.entity_type})},{accessor:"entity_name",Header:"entity name",Cell:({row:o})=>e.jsx(e.Fragment,{children:o.original.entity_name})},{accessor:"message",className:I.message,Header:"message",Cell:({row:{original:o,index:r}})=>e.jsx(x,{content:o.message,isExpanded:r===s,onExpand:()=>{t(r)}})}],[n,s]);return e.jsx("div",{ref:a,children:e.jsx(_,{columns:l,data:n,emptyMsg:"No events found according to your search parameters.",getCellProps:S(s),getRowProps:N(s),minWidth:1200})})},A=()=>{const{days:n,setPageParams:s}=u();return j("days",m.map(a=>a.value)),e.jsx(f,{type:"single",label:"Days",showSelectionOnToggleLabel:!0,hasToggleIcon:!0,options:m,onItemSelect:a=>{s({days:a})},selectedItem:n.toString()})},Y=()=>e.jsxs(e.Fragment,{children:[e.jsx(H,{actions:e.jsx(A,{})}),e.jsx(v,{filtersToDisplay:["search"]})]});function k(){const n=E();return{getEventsLog:(a,t={})=>b({queryKey:["events",a],queryFn:async()=>n.get("events",{params:a}),...t})}}const O="_header_1676f_1",B={header:O},V=(n,s)=>{const a=["creation_time","person_id","person_name","entity_type","entity_id","entity_name","message"],l=[["Creation Time","Person ID","Person Name","Entity Type","Entity ID","Entity Name","Message"].join(","),...n.map(c=>a.map(d=>c[d]).join(","))].join(`\r
`),o=new Blob([l],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(o),i=document.createElement("a");i.href=r,i.download=s,document.body.appendChild(i),i.click(),document.body.removeChild(i)},U=()=>{const{days:n,search:s,currentPage:a,pageSize:t}=u(),{user:l}=C(),{getEventsLog:o}=k(),{data:r,isLoading:i}=o({days:Number(n),limit:t,offset:(a-1)*t,search:s}),c=g.useMemo(()=>r?.data.results.filter(d=>d.message.toLowerCase().includes(s.toLowerCase()))??[],[r,s]);return e.jsxs(T,{children:[e.jsx(D,{className:B.header,title:"Events log",actions:[e.jsx(P.Button,{type:"button",onClick:()=>{V(c,`Event Log - ${l.current_account}-${p().format("YYYY-MM-DDTHH mm ss[Z]")}.csv`)},children:"Download as CSV"},"download-as-cv")]}),e.jsxs(F,{children:[e.jsx(Y,{}),i&&e.jsx(L,{}),!i&&c&&e.jsx(M,{eventsLog:c}),e.jsx(w,{totalItems:r?.data.count,currentItemCount:c.length})]})]})};export{U as default};
