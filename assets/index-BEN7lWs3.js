import{b as O,i as J,j as e,f as $,d as n,r as c,t as k,L as ne,R as Q,I as P,m as W,_ as F,c as X,z as ae,U as re}from"./index-CQs3wXys.js";import{P as oe,a as ie,b as le}from"./PageMain-BTzMuvvj.js";import{S as ce}from"./SearchHelpPopup-CAM4EXp1.js";import{T as ue}from"./TablePagination-DIiSuGph.js";import{u as H}from"./useSavedSearches-dHWyeXn-.js";import{u as Z}from"./useConfirm-9PPCxKmU.js";import{a as de,u as he}from"./useOnClickOutside-CMkwII5b.js";import{u as me}from"./formik.esm-C_3GEhhV.js";import{c as pe,a as ge}from"./index.esm-85kEx3I1.js";import{u as z}from"./useInstances-A3J_BhkM.js";import{h as A}from"./moment-Cl4UOzQZ.js";import{S as b}from"./constants-C1o6u7Ik.js";import{G as Y,O as G,S as K,I as _e,Q as xe}from"./constants-DH8CR2kC.js";import"./useFetchOld-D-5JyUuM.js";import"./useMutation-D9dT1mhA.js";import"./useQuery-DrwXjJzc.js";const fe="_container_5hvuq_1",be="_list_5hvuq_6",je="_listItem_5hvuq_11",Se="_search_5hvuq_17",Ce="_row_5hvuq_25",ve="_truncated_5hvuq_33",w={container:fe,list:be,listItem:je,search:Se,row:Ce,truncated:ve},ye=({onSavedSearchClick:s,onSavedSearchRemove:r,savedSearches:i})=>{if(!i.length)return null;const o=O(),{notify:p}=J(),{closeConfirmModal:g,confirmModal:l}=Z(),{removeSavedSearchQuery:_}=H(),{mutateAsync:h}=_,f=async t=>{try{await h({name:t}),r(),p.success({message:`Saved search ${t} successfully removed`,title:"Saved search removed"})}catch(a){o(a)}finally{g()}},j=t=>{l({title:"Remove saved search",body:`This will remove the saved search "${t}"`,buttons:[e.jsx(n.Button,{type:"button",appearance:"negative",onClick:()=>f(t),"aria-label":`Remove ${t} search`,children:"Remove"},"remove")]})};return e.jsxs("div",{className:w.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Saved searches"}),e.jsx("ul",{className:$("p-list--divided u-no-margin--bottom",w.list),children:i.map(t=>e.jsx("li",{children:e.jsxs("div",{className:w.listItem,children:[e.jsx(n.Button,{appearance:"base",className:w.search,onClick:()=>s(t),children:e.jsxs(n.Row,{className:w.row,children:[e.jsx(n.Col,{size:4,children:e.jsx(n.Tooltip,{message:t.name,positionElementClassName:w.truncated,children:e.jsx("span",{children:t.name})})}),e.jsx(n.Col,{size:8,children:e.jsx(n.Tooltip,{message:t.search,positionElementClassName:w.truncated,children:e.jsx("span",{children:t.search})})})]})}),e.jsx(n.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding--bottom u-no-padding--top",onClick:()=>j(t.name),"aria-label":`Remove ${t.title} search`,children:e.jsx(n.Icon,{name:"delete"})})]})},t.name))})]})},we=({containerRef:s,onDismiss:r,onOverflowingItemsAmountChange:i,searchData:o})=>{const p=()=>{if(!s.current)return;const l=s.current.querySelectorAll("span.p-chip");i(Array.from(l).filter(({offsetHeight:_,offsetTop:h})=>h>_).length)};de("resize",p),c.useEffect(()=>{p()},[o.length]);const g=l=>l.title?l.title:l.quoteValue?`'${l.value}'`:l.value;return o.map(l=>e.jsx(n.Chip,{value:g(l),lead:l.lead,onDismiss:()=>r(l.value)},l.value))},Ne="_infoContainer_drsz5_1",ke="_amount_drsz5_9",Ie="_helpButtonContainer_drsz5_14",Re="_helpButton_drsz5_14",E={infoContainer:Ne,amount:ke,helpButtonContainer:Ie,helpButton:Re},$e=({isExpanded:s,onHelpButtonClick:r,overflowingChipsAmount:i})=>e.jsxs("div",{className:E.infoContainer,children:[i>0&&!s&&e.jsx("span",{className:$("u-text--muted",E.amount),children:`+${i}`}),e.jsx("div",{className:E.helpButtonContainer,children:e.jsx(n.Button,{type:"button",appearance:"base",hasIcon:!0,className:E.helpButton,onClick:o=>{o.stopPropagation(),r()},children:e.jsx(n.Icon,{name:"help"})})})]}),Le=({onClose:s,onSearchSave:r,search:i})=>{const o=O(),{notify:p}=J(),{createSavedSearchQuery:g}=H(),{mutateAsync:l}=g,h=me({initialValues:{name:""},onSubmit:async({name:f})=>{try{await l({search:i,name:f,title:f}),p.success({message:`Saved search ${f} successfully added`,title:"Saved search added"}),r(),s()}catch(j){o(j)}},validationSchema:pe({name:ge().required("This field is required").test({message:"Name must consist of only lowercase alphanumeric characters and hyphens",test:f=>/^[a-z0-9][-a-z0-9]*$/.test(f)})})});return e.jsxs(n.Form,{onSubmit:h.handleSubmit,noValidate:!0,children:[e.jsx(n.Input,{type:"text",autoComplete:"off",autoFocus:!0,label:"Search name",...h.getFieldProps("name"),error:h.touched.name&&h.errors.name?h.errors.name:void 0}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(n.Button,{type:"button",disabled:h.isSubmitting,onClick:s,children:"Cancel"}),e.jsx(n.Button,{type:"submit",disabled:h.isSubmitting,appearance:"positive","aria-label":`Saved search as ${h.values.name}`,children:"Save search"})]})]})},Pe="_container_fqj7b_1",Ae="_prompt_fqj7b_10",Ee="_saveButton_fqj7b_17",U={container:Pe,prompt:Ae,saveButton:Ee},Be=({onSearchSave:s,search:r})=>{const[i,o]=c.useState(!1);return e.jsxs(e.Fragment,{children:[r&&i&&e.jsx(Le,{onClose:()=>o(!1),onSearchSave:s,search:r}),r&&!i&&e.jsxs("div",{className:U.container,children:[e.jsxs("span",{className:U.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:r}),e.jsx("span",{children:"..."})]}),e.jsx(n.Button,{type:"button",appearance:"link",onClick:()=>o(!0),className:U.saveButton,children:"Save search"})]})]})},Te="_searchContainer_17q9j_1",Fe="_form_17q9j_5",De="_searchBoxContainer_17q9j_10",qe="_input_17q9j_14",B={searchContainer:Te,form:Fe,searchBoxContainer:De,input:qe},Ue=({onHelpButtonClick:s,returnSearchData:r,existingSearchData:i=[]})=>{const[o,p]=c.useState(""),[g,l]=c.useState(!1),[_,h]=c.useState([]),[f,j]=c.useState(0),{getSavedSearchesQuery:t}=H(),a=c.useRef(null),d=c.useRef(null);c.useEffect(()=>{r(_)},[_]),c.useEffect(()=>{h(u=>[...i,...u])},[i.length]),he(a,()=>{l(!1)});const N=u=>{h(S=>S.filter(({value:L})=>L!==u))},{data:C,isLoading:v}=t(),y=c.useMemo(()=>C?!o&&!_.length?C.data:C.data.filter(({search:u})=>_.every(({value:S})=>S!==u)).filter(({title:u,search:S})=>u.toLowerCase().includes(o.trim().toLowerCase())||S.toLowerCase().includes(o.trim().toLowerCase())):[],[C,o,_]),m=()=>{o&&(h(u=>[...u,{value:o,quoteValue:!0}]),p(""))},D=u=>{h(S=>[...S,{value:u.search,lead:"search",title:u.name}])},q=u=>{const{key:S}=u;g?(S==="Escape"&&l(!1),S==="Enter"&&m()):S==="Enter"&&l(!0)};return e.jsxs("div",{className:"p-search-and-filter",ref:a,children:[e.jsxs("div",{className:$("p-search-and-filter__search-container",B.searchContainer),"aria-expanded":g,ref:d,onClick:()=>l(!0),children:[e.jsx(we,{containerRef:d,onDismiss:N,onOverflowingItemsAmountChange:u=>j(u),searchData:_}),e.jsx(n.Form,{onSubmit:u=>{u.preventDefault(),m()},className:$("p-search-and-filter__box",B.form),children:e.jsx("div",{className:B.searchBoxContainer,children:e.jsx(n.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autocomplete:"off",className:B.input,value:o,onChange:u=>p(u),onClear:()=>p(""),onSearch:m,onClick:()=>l(!0),onKeyUp:q})})}),e.jsx($e,{isExpanded:g,onHelpButtonClick:s,overflowingChipsAmount:f})]}),g&&v&&e.jsx(k,{}),g&&!v&&e.jsxs("div",{className:"p-search-and-filter__panel",children:[e.jsx(Be,{onSearchSave:()=>p(""),search:o.trim()}),e.jsx(ye,{onSavedSearchClick:D,onSavedSearchRemove:()=>l(!0),savedSearches:y})]})]})},Oe="_checkbox_okmcr_1",He="_rowHeader_okmcr_5",ze="_nested_okmcr_8",Me="_restartError_okmcr_12",Ve="_restartWarning_okmcr_16",Qe="_statusListItem_okmcr_20",We="_statusContainer_okmcr_24",T={checkbox:Oe,rowHeader:He,nested:ze,restartError:Me,restartWarning:Ve,statusListItem:Qe,statusContainer:We},Ye=({instances:s,selectedInstances:r,setSelectedInstances:i,groupBy:o})=>{const p=()=>{i(r.length!==0?[]:s)},g=t=>{if(o==="parent"&&t.original.children.length>0){const a=t.original.children.map(({id:d})=>d);r.some(({id:d})=>a.includes(d))?i(r.filter(({id:d})=>!a.includes(d))):i([...r,...t.original.children.map(d=>({...d,parent:t.original,children:[]}))])}else r.some(({id:a})=>a===t.original.id)?i(r.filter(({id:a})=>a!==t.original.id)):i([...r,t.original])},l=c.useMemo(()=>o==="parent"?s.map(t=>({...t,subRows:t.children.map(a=>({...a,parent:t,children:[]}))})):s,[s,o]),_=t=>{const a=r.map(({id:d})=>d);return o==="parent"&&!t.is_wsl_instance&&t.children.length>0?t.children.every(({id:d})=>a.includes(d))?"checked":t.children.some(({id:d})=>a.includes(d))?"indeterminate":"unchecked":a.includes(t.id)?"checked":"unchecked"},h=t=>{if(!t.upgrades||!t.upgrades.security&&!t.upgrades.regular)return{icon:b.UpToDate.icon.color,label:b.UpToDate.label};if(t.upgrades.security)if(t.upgrades.regular){const a=`${t.upgrades.security} security, ${t.upgrades.regular} regular ${t.upgrades.regular===1?"upgrade":"upgrades"}`;return{icon:b.SecurityUpgradesAlert.icon.color,label:e.jsx(e.Fragment,{children:a})}}else return{icon:b.SecurityUpgradesAlert.icon.color,label:e.jsxs(e.Fragment,{children:[t.upgrades.security," security"," ",t.upgrades.security===1?"upgrade":"upgrades"]})};else return{icon:b.PackageUpgradesAlert.icon.color,label:e.jsxs(e.Fragment,{children:[t.upgrades.regular," regular"," ",t.upgrades.regular===1?"upgrade":"upgrades"]})}},f=t=>{const a=((t==null?void 0:t.alerts)??[]).filter(({type:d})=>!["PackageUpgradesAlert","SecurityUpgradesAlert"].includes(d));return t.reboot_required_flag?{icon:`${b.ComputerRebootAlert.icon.color}`,label:b.ComputerRebootAlert.alternateLabel??b.ComputerRebootAlert.label}:a.length===0?{icon:`${b.Online.icon.color}`,label:b.Online.alternateLabel??b.Online.label}:a.length===1?{icon:`${b[a[0].type].icon.color??b.Unknown.icon.color}`,label:e.jsx(e.Fragment,{children:a[0].summary})}:{label:e.jsx("span",{className:T.statusContainer,children:a.map(({type:d,summary:I})=>e.jsx("span",{className:T.statusListItem,children:e.jsx(n.Tooltip,{message:I,children:e.jsx(n.Icon,{className:"u-no-margin--left",name:`${b[d].icon.color??b.Unknown.icon.color}`})})},d))})}},j=c.useMemo(()=>[{accessor:"title",Header:e.jsxs(e.Fragment,{children:[e.jsx(n.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,onChange:p,disabled:s.length===0,checked:r.length===s.length&&s.length!==0,indeterminate:r.length!==0&&r.length<s.length}),e.jsx("span",{children:"Name"})]}),Cell:({row:t})=>e.jsxs("div",{className:$(T.rowHeader,{[T.nested]:t.depth>0}),children:[e.jsx(n.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:t.original.title}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:_(t.original)==="checked",indeterminate:_(t.original)==="indeterminate",onChange:()=>{g(t)}}),e.jsx(ne,{to:t.original.parent?`${Q}instances/${t.original.parent.id}/${t.original.id}`:`${Q}instances/${t.original.id}`,children:t.original.title})]})},{Header:"Status",accessor:"reboot_required_flag",Cell:({row:{original:t}})=>{const{label:a}=f(t);return a},getCellIcon:({row:{original:t}})=>{const{icon:a}=f(t);return a}},{Header:"Upgrades",Cell:({row:{original:t}})=>{const{label:a}=h(t);return a},getCellIcon:({row:{original:t}})=>{const{icon:a}=h(t);return a}},{accessor:"distribution",Header:"OS",Cell:({row:{original:t}})=>t.distribution?/\d{1,2}\.\d{2}/.test(t.distribution)?`${t.is_wsl_instance?"WSL - ":""}UbuntuÂ ${t.distribution}`:`Windows ${t.distribution}`:"---"},{accessor:"ubuntu_pro_info",Header:"Ubuntu pro",Cell:({row:t})=>e.jsx(e.Fragment,{children:t.original.ubuntu_pro_info&&A(t.original.ubuntu_pro_info.expires,P).isValid()?`Exp. ${A(t.original.ubuntu_pro_info.expires,P).format(W)}`:"---"})},{Header:"Host name",accessor:"hostname"},{Header:"Last ping time",accessor:"last_ping_time",Cell:({row:t})=>e.jsx(e.Fragment,{children:A(t.original.last_ping_time,P).isValid()?A(t.original.last_ping_time,P).format(W):"---"})}],[r.length,s,o]);return e.jsx(e.Fragment,{children:e.jsx(n.ModularTable,{emptyMsg:"No instances found",columns:j,data:l})})},Ge="_top_1y6w6_1",Ke="_select_1y6w6_11",Je="_searchContainer_1y6w6_17",Xe="_widgets_1y6w6_21",R={top:Ge,select:Ke,searchContainer:Je,widgets:Xe},Ze=c.lazy(()=>F(()=>import("./index-CJDRijEY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),et=()=>{const{setSidePanelContent:s}=X(),{getPendingInstancesQuery:r}=z(),{data:i}=r();if(!i||!i.data.length)return null;const o=()=>{s("Review Pending Instances",e.jsx(c.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(Ze,{instances:i.data})}),"large")};return e.jsxs(n.Notification,{severity:"information",title:"Pending instances",children:[e.jsx("span",{children:`You currently have ${i.data.length} pending
          	${i.data.length===1?"instance":"instances"}
          	awaiting your review and approval. `}),e.jsx(n.Button,{type:"button",appearance:"link",onClick:o,children:"Review Pending Instances"})]})},tt=({selectedInstances:s,setSelectedInstances:r})=>{var M;const[i,o]=c.useState([]),[p,g]=c.useState(1),[l,_]=c.useState(50),[h,f]=c.useState(!1),[j,t]=c.useState(""),[a,d]=c.useState(""),N=(M=ae().state)==null?void 0:M.chipData,[C,v]=re(),[y,m]=c.useState(C.get("status")||""),{getInstancesQuery:D}=z(),q=xe[y],{data:u,isLoading:S}=D({query:`${i.map(({lead:x,value:se,title:V})=>x&&V?`${x}:${V}`:se).join(" ")}${a??""} ${q}`.trim(),root_only:j==="parent",with_alerts:!0,with_upgrades:y!=="pending-computers",limit:l,offset:(p-1)*l}),L=(u==null?void 0:u.data.results)??[],ee=(u==null?void 0:u.data.count)??0,te=x=>{g(x),r([])};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:R.top,children:[e.jsx("div",{className:R.searchContainer,children:e.jsx(Ue,{existingSearchData:N?[N]:void 0,onHelpButtonClick:()=>f(!0),returnSearchData:x=>o(x)})}),e.jsx(n.Select,{label:Y.label,wrapperClassName:R.select,className:"u-no-margin--bottom",options:Y.options,value:j,onChange:x=>{r([]),t(x.target.value)}}),e.jsx(n.Select,{label:G.label,wrapperClassName:R.select,className:"u-no-margin--bottom",options:G.options,value:a,onChange:x=>{r([]),d(x.target.value)}}),e.jsx(n.Select,{label:K.label,wrapperClassName:R.select,className:"u-no-margin--bottom",options:K.options,value:y,onChange:x=>{r([]),m(x.target.value),x.target.value!==""?v({status:x.target.value}):(C.delete("status"),v(C))}})]}),e.jsx(ce,{open:h,data:_e,onClose:()=>{f(!1)}}),e.jsx(et,{}),S?e.jsx(k,{}):e.jsx(Ye,{instances:L,selectedInstances:s,setSelectedInstances:x=>{r(x)},groupBy:j}),e.jsx(ue,{currentPage:p,totalItems:ee,paginate:te,pageSize:l,setPageSize:x=>{_(x)},currentItemCount:L.length})]})},st="_header_c9ifr_1",nt={header:st},at=c.lazy(()=>F(()=>import("./index-C9OLuwoX.js").then(s=>s.R),__vite__mapDeps([11,1,2,12,3,13,14,15,16,5,6,7,8,17,18,19,20,21,22]))),rt=c.lazy(()=>F(()=>import("./index-Xdke5WUn.js"),__vite__mapDeps([23,1,2,24,5,6,7,17,18,19,25,9,26,27,28,29,3,30,31,32,33]))),ot=c.lazy(()=>F(()=>import("./index-C72oL8EH.js"),__vite__mapDeps([34,1,2,5,7,15,16,17,18,19,35]))),it=()=>{const[s,r]=c.useState([]),i=O(),{setSidePanelContent:o}=X(),{confirmModal:p,closeConfirmModal:g}=Z(),{rebootInstancesQuery:l,shutdownInstancesQuery:_}=z(),{mutateAsync:h,isLoading:f}=l,{mutateAsync:j,isLoading:t}=_,a=async()=>{o("Run script",e.jsx(c.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(at,{query:`id:${s.map(({id:m})=>m).join(" id:")}`})}))},d=async()=>{try{await j({computer_ids:s.map(({id:m})=>m)})}catch(m){i(m)}finally{g()}},I=()=>{p({title:"Shutting down selected instances",body:`Are you sure you want to shutdown ${s.length} instance${s.length===1?"":"s"}?`,buttons:[e.jsx(n.Button,{appearance:"negative",onClick:d,children:"Shutdown"},"shutdown")]})},N=async()=>{try{await h({computer_ids:s.map(({id:m})=>m)})}catch(m){i(m)}finally{g()}},C=()=>{p({title:"Restarting selected instances",body:`Are you sure you want to restart ${s.length} instance${s.length===1?"":"s"}?`,buttons:[e.jsx(n.Button,{appearance:"negative",onClick:N,children:"Restart"},"restart")]})},v=()=>{o("Upgrades",e.jsx(c.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(rt,{selectedInstances:s})}),"large")},y=()=>{o(`Report for ${s.length===1?s[0].title:`${s.length} instances`}`,e.jsx(c.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(ot,{instanceIds:s.map(({id:m})=>m)})}),"medium")};return e.jsxs(oe,{children:[e.jsx(ie,{title:"Instances",className:nt.header,actions:[e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(n.Button,{className:"p-segmented-control__button",type:"button",onClick:I,disabled:t||s.length===0,children:[e.jsx(n.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button",type:"button",onClick:C,disabled:f||s.length===0,children:[e.jsx(n.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button",type:"button",onClick:y,disabled:s.length===0,children:[e.jsx(n.Icon,{name:"status"}),e.jsx("span",{children:"View report"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button",type:"button",onClick:a,disabled:s.length===0,children:[e.jsx(n.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button",type:"button",onClick:v,disabled:s.length===0||s.every(({upgrades:m})=>!m||!m.regular&&!m.security),children:[e.jsx(n.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]})]})},"buttons")]}),e.jsx(le,{children:e.jsx(tt,{selectedInstances:s,setSelectedInstances:m=>{r(m)}})})]})},yt=it;export{yt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-CJDRijEY.js","assets/index-CQs3wXys.js","assets/index-C_8s_0a6.css","assets/useConfirm-9PPCxKmU.js","assets/useInstances-A3J_BhkM.js","assets/useFetchOld-D-5JyUuM.js","assets/useMutation-D9dT1mhA.js","assets/useQuery-DrwXjJzc.js","assets/useRoles-DHn7bJnc.js","assets/moment-DDUBUQL9.js","assets/index-CoQBeqtS.css","assets/index-C9OLuwoX.js","assets/index-D-OXC4P1.js","assets/EmptyState-DNkTeHW1.js","assets/EmptyState-BNXajmMK.css","assets/formik.esm-C_3GEhhV.js","assets/index.esm-85kEx3I1.js","assets/SidePanelFormButtons-CTKwSU1t.js","assets/SidePanelFormButtons.module-CoxOjuX8.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/index-CRBxSwZU.css","assets/moment-Cl4UOzQZ.js","assets/index-DBZN6KOy.css","assets/index-Xdke5WUn.js","assets/useUsns-PbelDNjT.js","assets/UsnList-BWdRV39e.js","assets/TruncatedCell-BU0EwnPI.js","assets/TruncatedCell-BIhicLLO.css","assets/ExpandableTableFooter-CeuFA5zV.js","assets/ExpandableTableFooter-PHbaG9hU.css","assets/useOnClickOutside-CMkwII5b.js","assets/PageMain-BTzMuvvj.js","assets/PageMain-DtiowUD8.css","assets/UsnList-Cd2TCZfq.css","assets/index-C72oL8EH.js","assets/index-X8X8N8QD.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
