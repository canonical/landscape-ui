import{r as f,t as _,a as P,k as S,v as k,C as $,j as e,h as d,g as N,R as w,s as A,E as L}from"./index-DA1zp4UR.js";import"./moment-BhIxFDQN.js";import{u as h}from"./usePageParams-BcTq1VJa.js";import{u as x}from"./useUsns-BkT66Nsz.js";import{U as T}from"./UsnList-w8pWWOmq.js";import"./useFetchOld-DxdXVajm.js";import"./SelectAllButton-Cv1hzj-g.js";import"./ExpandableTableFooter-CdTMhby8.js";import"./NoData-erdAyttJ.js";import"./TablePagination-THfNRSZ8.js";import"./TablePagination.module-CgQ3jx4B.js";import"./TruncatedCell-BftwTypl.js";import"./helpers-B4Ea794_.js";const q="_container_viyqm_1",E="_searchContainer_viyqm_5",D="_cta_viyqm_9",m={container:q,searchContainer:E,cta:D},B=({onSearch:c,usns:t})=>{const[a,n]=f.useState(""),{instanceId:o,childInstanceId:s}=_(),{setPageParams:r}=h(),u=P(),g=S(),{notify:i}=k(),{confirmModal:y,closeConfirmModal:j}=$(),{upgradeInstanceUsnsQuery:v}=x(),p=Number(o),{mutateAsync:b}=v,C=()=>{u(`${w}instances/${s?`${p}/${s}`:`${p}`}`),r({tab:"activities"}),i.clear()},U=async()=>{try{await b({instanceId:p,usns:t}),i.success({title:"You queued packages to be upgraded",message:`Affected packages for ${t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`} will be upgraded and are queued in Activities`,actions:[{label:"View details",onClick:C}]})}catch(l){g(l)}finally{j()}},I=()=>{y({title:"Upgrade affected packages",body:`This will upgrade affected packages for ${t.length===1?`"${t[0]}" security issue`:`${t.length} selected security issues`}.`,buttons:[e.jsx(d.Button,{appearance:"positive",onClick:U,"aria-label":"Upgrade selected packages",children:"Upgrade"},"upgrade")]})};return e.jsxs("div",{className:m.container,children:[e.jsx("div",{className:m.searchContainer,children:e.jsx(d.Form,{onSubmit:l=>{l.preventDefault(),c(a)},noValidate:!0,children:e.jsx(d.SearchBox,{shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:a,onChange:l=>n(l),onSearch:()=>c(a),onClear:()=>{n(""),c("")}})})}),e.jsx("div",{className:N("p-segmented-control",m.cta),children:e.jsxs(d.Button,{hasIcon:!0,className:"p-segmented-control__button",onClick:I,disabled:t.length===0,children:[e.jsx(d.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]})})]})},F=({instance:c,isUsnsLoading:t,totalUsnCount:a,usns:n})=>{const[o,s]=f.useState([]),{search:r,setPageParams:u}=h(),g=i=>{u({search:i}),s([])};return e.jsxs(e.Fragment,{children:[e.jsx(B,{onSearch:g,usns:o}),e.jsx(T,{tableType:"paginated",instances:[c],isUsnsLoading:t,onSelectedUsnsChange:i=>s(i),search:r,selectedUsns:o,totalUsnCount:a,usns:n})]})},Z=({instance:c})=>{const{search:t,currentPage:a,pageSize:n}=h(),{getUsnsQuery:o}=x(),{data:s,isLoading:r}=o({computer_ids:[c.id],limit:n,offset:(a-1)*n,search:t,show_packages:!1});return e.jsxs(e.Fragment,{children:[!t&&a===1&&n===20&&r&&e.jsx(A,{}),!t&&a===1&&n===20&&!r&&(!s||s.data.results.length===0)&&e.jsx(L,{icon:"inspector-debug",title:"No security issues found"}),(t||a>1||n!==20||!r&&s&&s.data.results.length>0)&&e.jsx(F,{instance:c,isUsnsLoading:r,totalUsnCount:(s==null?void 0:s.data.count)??0,usns:(s==null?void 0:s.data.results)??[]})]})};export{Z as default};
