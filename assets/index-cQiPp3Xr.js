import{r as h,j as s,n as g,i as I,f as C,g as y,h as F,O as b,B as N,A as k,o as S,al as H,x as j,c as P,p as E,E as M,an as Q}from"./index-Cw5WBMVF.js";import{H as v}from"./HeaderWithSearch-BVxS-90p.js";const z=({processes:n,selectedPids:t,setSelectedPids:c})=>{const o=()=>{c(t.length===0?n.map(({pid:e})=>e):[])},r=h.useMemo(()=>[{accessor:"name",Header:s.jsxs(s.Fragment,{children:[s.jsx(g.CheckboxInput,{inline:!0,label:s.jsx("span",{className:"u-off-screen",children:"Toggle all processes"}),checked:t.length>0&&t.length===n.length,disabled:n.length===0,onChange:o,indeterminate:t.length>0&&t.length<n.length}),s.jsx("span",{children:"Command"})]}),Cell:({row:e})=>s.jsxs(s.Fragment,{children:[s.jsx(g.CheckboxInput,{inline:!0,label:s.jsx("span",{className:"u-off-screen",children:`Select process ${e.original.name}`}),checked:t.includes(e.original.pid),onChange:()=>{c(t.includes(e.original.pid)?t.filter(i=>i!==e.original.pid):[...t,e.original.pid])}}),s.jsx("span",{children:e.original.name})]})},{accessor:"state",Header:"State"},{accessor:"vm_size",Header:"VM size"},{accessor:"cpu_utilization",Header:"CPU (%)",Cell:({row:e})=>s.jsxs(s.Fragment,{children:[(100*e.original.cpu_utilisation).toFixed(1),"%"]})},{accessor:"pid",Header:"PID"},{accessor:"start_time",Header:"Started at"},{accessor:"gid",Header:"Group"}],[n,t]);return s.jsx(g.ModularTable,{columns:r,data:n,emptyMsg:"No processes found"})};function f(){const n=I(),t=C(),c=(e,i={})=>{if(!e)throw new Error("Missing required parameters");const{computer_id:l,...d}=e;return F({queryKey:["processes",e],queryFn:async()=>n.get(`/computers/${l}/processes`,{params:d}),...i})},o=y({mutationFn:async e=>n.post("processes/terminate",e),onSuccess:async()=>t.invalidateQueries({queryKey:["processes"]})}),r=y({mutationFn:async e=>n.post("processes/kill",e),onSuccess:async()=>t.invalidateQueries({queryKey:["processes"]})});return{getProcessesQuery:c,killProcessQuery:r,terminateProcessQuery:o}}const K="_actions_1l3g0_1",T={actions:K},q=({selectedPids:n,handleClearSelection:t})=>{const{instanceId:c}=b(),{notify:o}=N(),r=k(),{killProcessQuery:e,terminateProcessQuery:i}=f(),l=Number(c),{mutateAsync:d}=i,{mutateAsync:a}=e,m=async()=>{try{await d({pids:n,computer_id:l}),o.success({message:`${j(n.length,"Process","Processes")} successfully ended.`}),t()}catch(u){r(u)}},p=async()=>{try{await a({pids:n,computer_id:l}),o.success({message:`${j(n.length,"Process","Processes")} successfully killed.`}),t()}catch(u){r(u)}};return s.jsxs(s.Fragment,{children:[s.jsx(v,{actions:s.jsx("div",{className:S("p-segmented-control",T.actions),children:s.jsxs("div",{className:"p-segmented-control__list",children:[s.jsx(g.Button,{type:"button",className:"p-segmented-control__button u-no-margin--bottom",disabled:n.length===0,onClick:m,children:"End process"}),s.jsx(g.Button,{type:"button",className:"p-segmented-control__button u-no-margin--bottom",disabled:n.length===0,onClick:p,children:"Kill process"})]})}),afterSearch:t}),s.jsx(H,{filtersToDisplay:["search"]})]})},B=()=>{const[n,t]=h.useState([]),{instanceId:c,childInstanceId:o}=b(),{search:r,currentPage:e,pageSize:i}=P(),{getProcessesQuery:l}=f(),d=Number(o??c),{data:a,isLoading:m}=l({computer_id:d,limit:i,offset:(e-1)*i,search:r}),p=(a==null?void 0:a.data.count)??0,u=h.useMemo(()=>(a==null?void 0:a.data.results)??[],[a]),x=()=>{t([])};return s.jsxs(s.Fragment,{children:[!r&&m&&s.jsx(E,{}),!m&&!r&&(!a||a.data.results.length===0)&&s.jsx(M,{icon:"connected",title:"No processes running"}),(r||!m&&a&&a.data.results.length>0)&&s.jsxs(s.Fragment,{children:[s.jsx(q,{handleClearSelection:x,selectedPids:n}),s.jsx(z,{processes:u,setSelectedPids:_=>t(_),selectedPids:n})]}),s.jsx(Q,{handleClearSelection:x,totalItems:p,currentItemCount:u.length})]})};export{B as default};
