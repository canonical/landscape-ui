import{j as e,g as s,h as D,r as u,_ as F,d as Z,c as ee,f as q,o as S,W as te,e as ie,B as ne}from"./index-Dt7YhOS0.js";import{m as ae}from"./moment-DcUn0hwS.js";import"./TablePagination.module-DLVph1Z1.js";import{T as oe}from"./TablePagination-0eisoSCU.js";import{E as se}from"./EmptyState-BG0AupYF.js";import{S as ce}from"./SearchHelpPopup-vdTLvWK1.js";import{u as re}from"./useFetchOld-BGspy5lX.js";import{u as C}from"./useMutation-B0Ge1lYR.js";import{u as N}from"./useQuery-Dlf2yvOE.js";import{u as le}from"./useConfirm-CR6bT57R.js";import{u as R}from"./usePageParams-Du9VpOtH.js";const ue=()=>e.jsx(se,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no activities yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage computers in Landscape"})]}),icon:"switcher-environments",title:"No activities found"}),de="_wrapper_1qrua_1",pe="_search_1qrua_9",he="_buttonContainer_1qrua_13",me="_button_1qrua_13",ve="_icon_1qrua_43",A={wrapper:de,search:pe,buttonContainer:he,button:me,icon:ve},ge=({inputValue:a,onDescriptionClick:t,onInputChange:c,onSearchClick:g,onClear:h})=>e.jsxs("div",{className:A.wrapper,children:[e.jsx(s.SearchBox,{autocomplete:"off",shouldRefocusAfterReset:!0,externallyControlled:!0,value:a,onChange:c,onSearch:g,onClear:h,className:D("u-no-margin--bottom",A.search)}),e.jsx("div",{className:A.buttonContainer,children:e.jsx("button",{type:"button",onClick:t,className:A.button,children:e.jsx("i",{className:D("p-icon--help",A.icon)})})})]}),ye=u.lazy(()=>F(()=>import("./index-BFCNroRO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])));function P(){const a=re(),t=Z(),c=ee(),{setSidePanelContent:g}=q(),h=(i={},l={})=>N({queryKey:["activities",i],queryFn:()=>t.get("activities",{params:i}),...l}),d=({activityId:i,...l},p={})=>N({queryKey:["activities",{activityId:i,...l}],queryFn:()=>t.get(`activities/${i}`,{params:l}),...p}),r=(i={},l={})=>N({queryKey:["activityTypes"],queryFn:()=>a.get("GetActivityTypes",{params:i}),...l}),y=C({mutationKey:["activities","cancel"],mutationFn:i=>a.get("CancelActivities",{params:i}),onSuccess:()=>c.invalidateQueries(["activities"])}),b=C({mutationKey:["activities","approve"],mutationFn:i=>a.get("ApproveActivities",{params:i}),onSuccess:()=>c.invalidateQueries(["activities"])}),v=C({mutationFn:i=>t.post("activities/reapply",i),onSuccess:()=>c.invalidateQueries(["activities"])}),_=C({mutationFn:i=>t.post("activities/revert",i),onSuccess:()=>c.invalidateQueries(["activities"])});return{getActivitiesQuery:h,getSingleActivityQuery:d,getActivityTypesQuery:r,cancelActivitiesQuery:y,approveActivitiesQuery:b,redoActivitiesQuery:v,undoActivitiesQuery:_,openActivityDetails:i=>{g(i.summary,e.jsx(u.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(ye,{activityId:i.id})}))}}}function _e(a){const{state:t}=te(),c=t==null?void 0:t.activity;u.useEffect(()=>{t!=null&&t.activity&&(a(t.activity),window.history.replaceState({},""))},[c])}const be="_container_honpf_1",fe="_searchContainer_honpf_8",Ae="_select_honpf_12",xe="_cta_honpf_17",j={container:be,searchContainer:fe,select:Ae,cta:xe},Ce="_iconError_j51du_1",je="_iconWarning_j51du_5",Se="_iconWarningRed_j51du_9",$={iconError:Ce,iconWarning:je,iconWarningRed:Se},E={succeeded:{icon:"success",label:"Succeeded"},scheduled:{icon:"spinner",label:"Scheduled"},waiting:{icon:"status-waiting",label:"Waiting"},undelivered:{icon:"status-queued",label:"Queued"},delivered:{icon:"status-in-progress",label:"In progress"},blocked:{icon:`warning-grey ${$.iconWarningRed}`,label:"Blocked"},unapproved:{icon:`warning-grey ${$.iconWarning}`,label:"Unapproved"},canceled:{icon:"error-grey",label:"Cancelled"},failed:{icon:`error-grey ${$.iconError}`,label:"Failed"}},Te=[{term:"id:<activity_id>",description:"Search for activities with a specific ID."},{term:"parent-id:<parent_id>",description:"Search for children activities of a specific ID."},{term:"created-after:<date>",description:e.jsxs("span",{children:["Search for activities created after a specific date or time, specified with the ISO-8601 format. The precision depends on how far you specify, for example ",e.jsx("code",{children:"2011-01"}),", ",e.jsx("code",{children:"2011-01-01"}),","," ",e.jsx("code",{children:"2011-01-01T10:30"})," are valid values."]})},{term:"created-before:<date>",description:"Search for activities created before a specific date or time. The format is the same as created-after."},{term:"creator:<email>",description:"Search for activities created by a particular person (specified by email address)."},{term:"computer:<criteria>",description:"Search for activities related to the given instances. The criteria is itself another query argument to search instances. See Instance Queries for details."},{term:"type:<type>",description:"Search for activities of a specific type."}],ke=[{label:"All",value:""},...Object.entries(E).filter(([a])=>a!=="unapproved").map(([a,{label:t}])=>({label:t,value:a}))],we=({resetSelectedIds:a,selectedIds:t})=>{const{search:c,status:g,setPageParams:h}=R(),d=ie(),{confirmModal:r,closeConfirmModal:y}=le(),{approveActivitiesQuery:b,cancelActivitiesQuery:v,redoActivitiesQuery:_,undoActivitiesQuery:f}=P(),[i,l]=u.useState(c),[p,x]=u.useState(!1),{mutateAsync:T,isLoading:k}=b,{mutateAsync:n,isLoading:m}=v,{mutateAsync:w,isLoading:B}=_,{mutateAsync:O,isLoading:H}=f,Q=()=>{h({search:i,status:g}),a()},W=o=>{h({status:o})},M=()=>{h({search:""})},I=o=>{o.preventDefault(),Q()},U=async()=>{try{await T({query:`id:${t.join(" OR id:")}`})}catch(o){d(o)}finally{y()}},V=()=>{r({title:`Approve ${t.length===1?"activity":"activities"}`,body:`Are you sure you want to approve selected ${t.length===1?"activity":"activities"}?`,buttons:[e.jsx(s.Button,{appearance:"positive",onClick:U,children:"Approve"},"approve")]})},z=async()=>{try{await n({query:`id:${t.join(" OR id:")}`})}catch(o){d(o)}finally{y()}},K=()=>{r({title:`Cancel ${t.length===1?"activity":"activities"}`,body:`Are you sure you want to cancel selected ${t.length===1?"activity":"activities"}?`,buttons:[e.jsx(s.Button,{appearance:"positive",onClick:z,children:"Apply"},"cancel")]})},Y=async()=>{try{await w({activity_ids:t})}catch(o){d(o)}finally{y()}},G=()=>{r({title:`Redo ${t.length===1?"activity":"activities"}`,body:`Are you sure you want to redo selected ${t.length===1?"activity":"activities"}?`,buttons:[e.jsx(s.Button,{appearance:"positive",onClick:Y,children:"Redo"},"redo")]})},J=async()=>{try{await O({activity_ids:t})}catch(o){d(o)}finally{y()}},X=()=>{r({title:`Undo ${t.length===1?"activity":"activities"}`,body:`Are you sure you want to undo selected ${t.length===1?"activity":"activities"}?`,buttons:[e.jsx(s.Button,{appearance:"positive",onClick:J,children:"Undo"},"undo")]})};return e.jsxs("div",{className:j.container,children:[e.jsxs("div",{className:j.searchContainer,children:[e.jsx(s.Form,{onSubmit:I,noValidate:!0,children:e.jsx(ge,{inputValue:i,onInputChange:o=>{l(o)},onSearchClick:Q,onDescriptionClick:()=>x(!0),onClear:M})}),e.jsx(ce,{open:p,onClose:()=>{x(!1)},data:Te})]}),e.jsx(s.Select,{label:"Status",labelClassName:"u-no-margin--bottom",wrapperClassName:j.select,className:"u-no-margin--bottom",options:ke,onChange:o=>W(o.target.value),value:g}),e.jsx("div",{className:D("p-segmented-control",j.cta),children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsx(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:V,disabled:t.length===0||k,children:"Approve"}),e.jsx(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:K,disabled:t.length===0||m,children:"Cancel"}),e.jsx(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:X,disabled:t.length===0||H,children:"Undo"}),e.jsx(s.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:G,disabled:t.length===0||B,children:"Redo"})]})},"buttons")]})},Ne="_checkbox_15zhq_1",$e="_description_15zhq_5",L={checkbox:Ne,description:$e},De=u.lazy(()=>F(()=>import("./index-BFCNroRO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]))),Ie=({instanceId:a})=>{const[t,c]=u.useState([]),{search:g,status:h,currentPage:d,pageSize:r}=R(),{setSidePanelContent:y}=q(),{getActivitiesQuery:b}=P(),v=`${g}${h?` status:${h}`:""}`,_=n=>{y(n.summary,e.jsx(u.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(De,{activityId:n.id})}))};_e(_);const f=()=>{c([])},{data:i,isLoading:l}=b({query:`${a?`computer:id:${a}`:""} ${v??""}`.trim(),limit:r,offset:(d-1)*r}),p=u.useMemo(()=>(i==null?void 0:i.data.results)??[],[i]),x=()=>{c(n=>n.length?[]:p.map(({id:m})=>m))},T=n=>{c(m=>m.includes(n)?m.filter(w=>w!==n):[...m,n])},k=u.useMemo(()=>[{accessor:"checkbox",className:L.checkbox,Header:e.jsx(s.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:x,checked:p.length>0&&t.length===p.length,indeterminate:t.length>0&&t.length<p.length}),Cell:({row:n})=>e.jsx(s.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:n.original.summary}),inline:!0,labelClassName:"u-no-margin--bottom u-no-padding--top",checked:t.includes(n.original.id),onChange:()=>{T(n.original.id)}})},{accessor:"summary",className:L.description,Header:"Description",Cell:({row:n})=>e.jsx(s.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>_(n.original),children:n.original.summary})},{accessor:"activity_status",Header:"Status",Cell:({row:{original:{activity_status:n}}})=>E[n].label,getCellIcon:({row:{original:{activity_status:n}}})=>E[n].icon},{accessor:"creation_time",Header:"Created at",Cell:({row:n})=>e.jsx(e.Fragment,{children:ae(n.original.creation_time).format(ne)})},{accessor:"creator.name",Header:"Creator",Cell:({row:n})=>{var m;return e.jsx(e.Fragment,{children:((m=n.original.creator)==null?void 0:m.name)??"-"})}}],[p,t]);return e.jsxs(e.Fragment,{children:[!v&&d===1&&r===50&&l&&e.jsx(S,{}),!v&&d===1&&r===50&&!l&&(!i||!i.data.count)&&e.jsx(ue,{}),(!!v||d!==1||r!==50||!l&&i&&i.data.count>0)&&e.jsxs(e.Fragment,{children:[e.jsx(we,{resetSelectedIds:f,selectedIds:t}),e.jsx(s.ModularTable,{emptyMsg:`No activities found with the search ${v}`,columns:k,data:p}),e.jsx(oe,{totalItems:i==null?void 0:i.data.count,currentItemCount:p.length,handleClearSelection:f})]})]})},Ee=u.lazy(()=>F(()=>import("./index-BFCNroRO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]))),Ue=a=>e.jsx(u.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Ee,{...a})});export{Ie as A,E as a,Ue as b,P as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-BFCNroRO.js","assets/index-Dt7YhOS0.js","assets/index-BAlneFez.css","assets/moment-Cl4UOzQZ.js","assets/InfoItem-Mj-XXzjC.js","assets/InfoItem.module-BZ3tYMsb.js","assets/InfoItem-BbayMzTk.css","assets/useConfirm-CR6bT57R.js","assets/useInstances-DayeQdIw.js","assets/useFetchOld-BGspy5lX.js","assets/useMutation-B0Ge1lYR.js","assets/useQuery-Dlf2yvOE.js","assets/moment-DcUn0hwS.js","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/TablePagination-0eisoSCU.js","assets/usePageParams-Du9VpOtH.js","assets/EmptyState-BG0AupYF.js","assets/EmptyState-BNXajmMK.css","assets/SearchHelpPopup-vdTLvWK1.js","assets/SearchHelpPopup-DNpzZE4f.css","assets/index-4jXkfcLF.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
