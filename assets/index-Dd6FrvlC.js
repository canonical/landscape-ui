const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B2Bsxs9a.js","assets/index-czR6w9lm.js","assets/index-D38JayDC.css","assets/UdebCheckboxInput-BSpoTTdJ.js","assets/UdebCheckboxInput-mCgCMP_S.css","assets/debug-TqGXZ-HJ.js","assets/useGPGKeys-DuhhGcVe.js","assets/useFetchOld-CEj2k1CT.js","assets/debug-CHNhm1j1.css","assets/MultiSelectField-DrxbUqFA.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-CfWEYvbx.js","assets/SidePanelFormButtons.module-tJTvEwdD.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/formikErrors-M28fKKOX.js","assets/constants-CLKu9tGf.js","assets/usePageParams-CTGLrWb_.js","assets/NoData-lrj3YC8M.js","assets/index-BgtlemhL.js","assets/TablePagination-lSfBZTnC.js","assets/TablePaginationBase-PYbQPdg1.js","assets/TablePaginationBase-CJl3HN1X.css","assets/StatusFilter-D-xdwg2t.js","assets/TableFilter-CyJVthnU.js","assets/TableFilter-DXBG6q86.css","assets/TableFilterChips-DvqzXX1K.js","assets/TableFilterChips-CHqetGbX.css","assets/index-geI-abAU.css","assets/constants-DhXkDRlN.css"])))=>i.map(i=>d[i]);
import{r as i,j as e,g as c,B as le,p as de,f as ue,m as F,n as A,_ as ge}from"./index-czR6w9lm.js";import{S as me}from"./SidePanelTablePagination-VN_4xLj2.js";import"./usePageParams-CTGLrWb_.js";import{f as fe,p as pe}from"./constants-CLKu9tGf.js";import"./TablePaginationBase-PYbQPdg1.js";import"./useFetchOld-CEj2k1CT.js";import"./NoData-lrj3YC8M.js";import"./index-BgtlemhL.js";import"./TablePagination-lSfBZTnC.js";import"./StatusFilter-D-xdwg2t.js";import"./TableFilter-CyJVthnU.js";import"./TableFilterChips-DvqzXX1K.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new t.Error().stack;n&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[n]="ada2da28-cabd-458f-90a7-3617c1b01c59",t._sentryDebugIdIdentifier="sentry-dbid-ada2da28-cabd-458f-90a7-3617c1b01c59")}catch{}const he="_version_sfav3_1",Pe="_content_sfav3_5",Q={version:he,content:Pe},ke=({isUpload:t,packagesToShow:n,search:s,selectedPackages:l,setSelectedPackages:m})=>{const u=i.useMemo(()=>[{accessor:"packageName",Header:({rows:a})=>t?e.jsxs(e.Fragment,{children:[e.jsx(c.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),disabled:!a.length,indeterminate:!!l.length&&l.length<a.length,checked:l.length===a.length&&!!l.length,onChange:()=>{m(d=>d.length?[]:a.map((h,x)=>x))}}),e.jsx("span",{children:"Package"})]}):"Package",Cell:({row:a})=>t?e.jsx(c.CheckboxInput,{inline:!0,label:a.original.packageName,checked:l.includes(a.index),onChange:()=>{m(d=>d.includes(a.index)?d.filter(h=>h!==a.index):[...d,a.index])}}):a.original.packageName},{accessor:"packageVersion",Header:"Version",getCellIcon:({row:a})=>a.original.difference?"warning":!1,className:Q.version,Cell:({row:a})=>a.original.difference?e.jsx(c.Tooltip,{position:"top-center",message:a.original.difference==="delete"?"Package deleted":`Version differs
from parent pocket.
Parent version:
${a.original.newVersion}`,children:e.jsx("span",{children:a.original.packageVersion})}):a.original.packageVersion}],[n,l.length]);return e.jsx(c.ModularTable,{columns:u,data:n,emptyMsg:s?`No packages found with the search: "${s}".`:void 0,className:Q.content,getCellProps:({column:a})=>{switch(a.id){case"packageName":return{role:"rowheader"};case"packageVersion":return{"aria-label":"Version"};default:return{}}}})},xe="_ctaRow_qlsck_1",be={ctaRow:xe},ye=i.lazy(async()=>ge(()=>import("./index-B2Bsxs9a.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]))),k=1,H=20,we=({distributionName:t,pocket:n,seriesName:s})=>{const[l,m]=i.useState(k),[u,a]=i.useState(H),[d,h]=i.useState([]),[x,O]=i.useState(!1),[j,V]=i.useState(""),[b,v]=i.useState(""),[R,U]=i.useState([]),B=le("(max-width: 619px)"),I=de(),{setSidePanelContent:q,closeSidePanel:K}=ue(),{listPocketQuery:G,diffPullPocketQuery:J,pullPackagesToPocketQuery:W,syncMirrorPocketQuery:X,removePackagesFromPocketQuery:Y,removePocketQuery:Z}=fe(),{mutate:N,isPending:T}=X,{mutate:ee,isPending:w}=W,ne=()=>{n.mode==="mirror"?N({name:n.name,series:s,distribution:t}):n.mode==="pull"&&ee({name:n.name,series:s,distribution:t})},te=()=>{q(`Edit ${n.name} pocket`,e.jsx(i.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(ye,{pocket:n,distributionName:t,seriesName:s})}))},{mutateAsync:ae,isPending:S}=Z,oe=async()=>{try{await ae({distribution:t,series:s,name:n.name}),K()}catch(o){I(o)}},{mutateAsync:se,isPending:y}=Y,E=!T&&!w&&!y&&!S,{data:C,isLoading:M}=G({name:n.name,series:s,distribution:t,search:b,limit:u,offset:l*u-u},{enabled:E}),D=(C==null?void 0:C.data)??{count:0,results:[]},f=D.results.map(o=>({packageName:o.name,packageVersion:o.version})),{data:_}=J({name:n.name,series:s,distribution:t},{enabled:n.mode==="pull"&&!M&&E});i.useEffect(()=>{const o=(_==null?void 0:_.data)??{},r=[];for(const g in o){const p={add:[],update:[],delete:[],...o[g]};for(const[P,$]of p.add)r.push({packageName:P,newVersion:$,difference:"add"});(p.update.length||p.delete.length)&&O(!0);for(const[P,,$]of p.update)r.push({packageName:P,newVersion:$,difference:"update"});for(const[P]of p.delete)r.push({packageName:P,difference:"delete",newVersion:""})}U(r)},[_]);const ce=()=>x?(f.forEach((o,r)=>{const g=R.find(({packageName:p})=>o.packageName===p);g&&(f[r].difference=g.difference,g.newVersion!==""&&(f[r].newVersion=g.newVersion))}),[...f.filter(({difference:o})=>o),...f.filter(({difference:o})=>!o)]):f,z=i.useMemo(()=>ce(),[l,u,b,x,f.length,R.length]),re=async()=>{const o=z.filter((r,g)=>d.includes(g)).map(({packageName:r})=>r);try{await se({name:n.name,series:s,distribution:t,packages:o})}catch(r){I(r)}},L=!b&&l===k&&u===H&&!D.count,ie=n.mode==="upload"?{size:8,medium:4}:{size:6,medium:3};return e.jsxs(e.Fragment,{children:[e.jsxs(c.Row,{className:F("u-no-padding--left u-no-padding--right",be.ctaRow),children:[e.jsx(c.Col,{...ie,children:e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[n.mode!=="upload"&&e.jsx(c.Button,{className:"p-segmented-control__button",type:"button",onClick:ne,disabled:T&&w,"aria-label":n.mode==="mirror"?`Synchronize ${n.name} pocket of ${t}/${s}`:`Pull packages to ${n.name} pocket of ${t}/${s}`,children:n.mode==="mirror"?"Sync":"Pull"}),e.jsx(c.Button,{className:"p-segmented-control__button",type:"button",onClick:te,"aria-label":`Edit ${n.name} pocket of ${t}/${s}`,children:"Edit"}),e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button",type:"button","aria-label":`Remove ${n.name} pocket of ${t}/${s}`,confirmationModalProps:{title:"Deleting pocket",children:e.jsxs("p",{children:["Do you really want to delete ",n.name," pocket from"," ",s," series of ",t," distribution?"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:S,confirmButtonLoading:S,onConfirm:oe},children:"Remove"}),n.mode==="upload"&&e.jsx(c.ConfirmationButton,{className:"p-segmented-control__button",type:"button",disabled:!d.length||y,"aria-label":`Remove selected packages from ${n.name} pocket of ${t}/${s}`,confirmationModalProps:{title:"Deleting packages from pocket",children:e.jsxs("p",{children:["This will delete ",d.length," selected"," ",pe(d.length,"package","packages")," ","from ",n.name," pocket ",s," series of"," ",t," distribution"]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:y,confirmButtonLoading:y,onConfirm:re},children:"Remove packages"})]})})}),n.mode!=="upload"&&!L&&e.jsx(c.Col,{size:6,medium:3,children:e.jsx(c.Form,{onSubmit:o=>{o.preventDefault(),v(j),m(k)},noValidate:!0,children:e.jsx(c.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,"aria-label":"Package search",onChange:o=>{V(o)},value:j,onClear:()=>{V(""),v(""),m(k)},className:F({"is-dense":!B,"u-no-margin--bottom":B}),onSearch:()=>{v(j),m(k)},autocomplete:"off"})})})]}),M?e.jsx(A,{}):L?e.jsx("p",{children:"No packages found"}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{isUpload:n.mode==="upload",packagesToShow:z,search:b,selectedPackages:d,setSelectedPackages:h}),e.jsx(me,{currentPage:l,totalItems:D.count,paginate:o=>{h([]),m(o)},pageSize:u,setPageSize:o=>{a(o)}})]})]})};export{we as default};
