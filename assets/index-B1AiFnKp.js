const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CKz24aTx.js","assets/index-D3R13Zz0.js","assets/index-DEuNBe7s.css","assets/CodeEditor-Bm7xqtMm.js","assets/CodeEditor-CA89WJcJ.css","assets/SidePanelFormButtons-DuRl5zt_.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css","assets/useFetchOld-D83Rawm4.js","assets/useRoles-C8WfzZtl.js","assets/moment-C5S46NFB.js","assets/index-Cg_wu4YD.css","assets/index-DhTkOFaH.js","assets/useUsns-DJ05MaDf.js","assets/useUsns-CzsIYyKO.css","assets/moment-BKWyaLVK.js","assets/index-NPt1GHi_.js","assets/index-DegjgOfo.css"])))=>i.map(i=>d[i]);
import{r as f,j as e,h as i,g as N,c as se,e as V,f as ne,k as G,w as te,Z as ae,l as re,m as oe,n as le,W as ie,t as H,L as ce,R as J,H as X,_ as K,i as de}from"./index-D3R13Zz0.js";import{P as ue,a as he,b as me}from"./PageMain-DESwZ53x.js";import{T as pe}from"./TablePagination-DYKyEp4C.js";import{u as Z}from"./useInstances-D1dA_NyF.js";import{h as z}from"./moment-C5S46NFB.js";import{N as q}from"./NoData-D7SAfVtn.js";import{u as w}from"./usePageParams-FnwxCHeD.js";import{P as ge,F as L,S as y}from"./PendingInstancesNotification-CYccQ_Dv.js";import{S as xe}from"./SearchHelpPopup-BeFd4OLF.js";import{u as fe}from"./useFetchOld-D83Rawm4.js";import{u as _e}from"./useRoles-C8WfzZtl.js";import"./TablePagination.module-CgQ3jx4B.js";const je="_toggle_kt7f5_1",be="_badgeContainer_kt7f5_7",Se="_multiple_kt7f5_12",ve="_badge_kt7f5_7",Ce="_dropdown_kt7f5_23",ye="_container_kt7f5_27",Ie="_list_kt7f5_37",we="_listItem_kt7f5_46",ke="_separated_kt7f5_53",Ne="_button_kt7f5_59",Be="_selected_kt7f5_66",$e="_footer_kt7f5_72",v={toggle:je,badgeContainer:be,multiple:Se,badge:ve,dropdown:Ce,container:ye,list:Ie,listItem:we,separated:ke,button:Ne,selected:Be,footer:$e},Ae=({onSearch:t})=>{const[n,l]=f.useState("");return e.jsx(i.Form,{onSubmit:a=>{a.preventDefault(),t(n)},children:e.jsx(i.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autoComplete:"off",value:n,onChange:a=>l(a),onSearch:()=>t(n),onClear:()=>{l(""),t("")}})})},T=({disabledOptions:t,hasBadge:n,hasToggleIcon:l,label:a,options:c,onSearch:m,position:o="left",...r})=>{const x=d=>{r.multiple&&r.onItemsSelect(r.selectedItems.includes(d.target.value)?r.selectedItems.filter(p=>p!==d.target.value):[...r.selectedItems,d.target.value])};return e.jsxs(i.ContextualMenu,{autoAdjust:!0,toggleAppearance:"base",toggleLabel:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a}),n&&e.jsx("span",{className:N(v.badgeContainer,{[v.multiple]:r.multiple&&c.length>9}),children:(r.multiple&&r.selectedItems.length>0||!r.multiple&&r.selectedItem)&&e.jsx(i.Badge,{value:r.multiple?r.selectedItems.length:1,className:v.badge})})]}),toggleClassName:v.toggle,hasToggleIcon:l,dropdownClassName:v.dropdown,position:o,onToggleMenu:d=>{d&&m&&m("")},children:[e.jsxs("span",{className:N(v.container,{[v.multiple]:r.multiple}),children:[m&&e.jsx(Ae,{onSearch:m}),e.jsx("ul",{className:v.list,children:c.map(({label:d,value:p,group:b},s)=>e.jsxs("li",{className:N({[v.listItem]:r.multiple,[v.separated]:b&&c[s+1]!==void 0&&c[s+1].group!==b}),children:[r.multiple&&e.jsx(i.Input,{type:"checkbox",label:d,labelClassName:"u-no-padding--top u-no-margin--bottom",value:p,onChange:x,checked:r.selectedItems.includes(p),disabled:t==null?void 0:t.some(u=>u.value===p)}),!r.multiple&&r.selectedItem!==p&&e.jsx(i.Button,{type:"button",appearance:"base",className:v.button,onClick:()=>r.onItemSelect(p),children:d}),!r.multiple&&r.selectedItem===p&&e.jsx("span",{className:v.selected,children:d})]},p))})]}),r.multiple&&e.jsxs("span",{className:v.footer,children:[e.jsx(i.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>r.onItemsSelect(c.map(({value:d})=>d)),children:"Select all"}),r.showSelectedItemCount?e.jsx("span",{className:"u-text--muted",children:`${r.selectedItems.length} of ${c.length} selected`}):e.jsx(i.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>r.onItemsSelect([]),children:"Clear"})]})]})},Le="_label_1i8qt_1",Te={label:Le},Fe=({options:t})=>{const{disabledColumns:n,setPageParams:l}=w(),a=c=>t.filter(({value:m})=>!c.includes(m)).map(({value:m})=>m);return e.jsx(T,{multiple:!0,showSelectedItemCount:!0,label:e.jsxs(e.Fragment,{children:[e.jsx(i.Icon,{name:"settings"}),e.jsx("span",{className:Te.label,children:"Columns"})]}),onItemsSelect:c=>l({disabledColumns:a(c)}),options:t,disabledOptions:t.filter(({canBeHidden:c})=>!c),selectedItems:a(n)})},Re="_container_1ctbs_1",Ee="_chipsContainer_1ctbs_8",qe="_collapsed_1ctbs_16",De="_clearAllButton_1ctbs_21",He="_showLessButton_1ctbs_22",Pe="_showMoreButton_1ctbs_23",ze="_clearAllIcon_1ctbs_38",$={container:Re,chipsContainer:Ee,collapsed:qe,clearAllButton:De,showLessButton:He,showMoreButton:Pe,clearAllIcon:ze},Me=["accessGroups","availabilityZones","os","search","status","tags"],Ue=({accessGroupOptions:t,availabilityZonesOptions:n,filtersToDisplay:l,osOptions:a,statusOptions:c,tagOptions:m})=>{var j,C;const[o,r]=f.useState(!1),[x,d]=f.useState(0),p=l??Me,b=f.useRef(null),{setPageParams:s,accessGroups:u,availabilityZones:h,os:g,status:S,tags:F}=w(),R=()=>{s({accessGroups:[],availabilityZones:[],os:"",status:"",tags:[]}),r(!1)},E=()=>{if(!b.current)return;const _=[...b.current.querySelectorAll(".p-chip")];if(!_.length)return d(0);const P=_[0].offsetTop,B=_.filter(({offsetTop:k})=>k>P).length;B===0&&(r(!1),d(0)),d(B)};f.useEffect(()=>(window.addEventListener("resize",E),()=>{window.removeEventListener("resize",E)}),[]),f.useEffect(()=>{E()},[u.length,h.length,x,g,S,F.length]);const Q=[...[S].slice(p.includes("status")?0:1),...[g].slice(p.includes("os")?0:1),...h.slice(p.includes("availabilityZones")?0:h.length),...u.slice(p.includes("accessGroups")?0:u.length),...F.slice(p.includes("tags")?0:F.length)].filter(Boolean).length>1;return e.jsxs("div",{className:$.container,children:[e.jsxs("div",{ref:b,className:N($.chipsContainer,{[$.collapsed]:!o}),children:[Q&&e.jsxs(i.Button,{type:"button",appearance:"link",hasIcon:!0,className:$.clearAllButton,onClick:R,children:[e.jsx(i.Icon,{name:"close",className:$.clearAllIcon}),e.jsx("span",{children:"Clear all filters"})]}),p.includes("status")&&S&&e.jsx(i.Chip,{value:`Status: ${((j=c==null?void 0:c.find(({value:_})=>_===S))==null?void 0:j.label)??S}`,onDismiss:()=>s({status:""}),className:"u-no-margin--bottom u-no-margin--right"}),p.includes("os")&&g&&e.jsx(i.Chip,{value:`OS: ${((C=a==null?void 0:a.find(({value:_})=>_===g))==null?void 0:C.label)??g}`,onDismiss:()=>s({os:""}),className:"u-no-margin--bottom u-no-margin--right"}),p.includes("availabilityZones")&&h.map((_,P,B)=>{var k;return e.jsx(i.Chip,{value:`Availability z.: ${((k=n==null?void 0:n.find(({value:I})=>I===_))==null?void 0:k.label)??_}`,onDismiss:()=>s({availabilityZones:B.filter(I=>I!==_)}),className:"u-no-margin--bottom u-no-margin--right"},_)}),p.includes("accessGroups")&&u.map((_,P,B)=>{var k;return e.jsx(i.Chip,{value:`Access group: ${((k=t==null?void 0:t.find(({value:I})=>I===_))==null?void 0:k.label)??_}`,onDismiss:()=>s({accessGroups:B.filter(I=>I!==_)}),className:"u-no-margin--bottom u-no-margin--right"},_)}),p.includes("tags")&&F.map((_,P,B)=>{var k;return e.jsx(i.Chip,{value:`Tag: ${((k=m==null?void 0:m.find(({value:I})=>I===_))==null?void 0:k.label)??_}`,onDismiss:()=>s({tags:B.filter(I=>I!==_)}),className:"u-no-margin--bottom u-no-margin--right"},_)}),o&&e.jsx(i.Button,{type:"button",appearance:"link",className:$.showLessButton,onClick:()=>r(!1),children:e.jsx("span",{className:"u-text--muted",children:"Show less"})})]}),x>0&&!o&&e.jsx(i.Button,{type:"button",appearance:"link",className:$.showMoreButton,onClick:()=>r(!0),children:e.jsx("span",{className:"u-text--muted",children:`+${x}`})})]})},Y=()=>{const t=fe(),n=se(),l=(o={},r={})=>ne({queryKey:["savedSearches",o],queryFn:()=>t.get("GetSavedSearches",{params:o}),...r}),a=V({mutationFn:o=>t.get("CreateSavedSearch",{params:o}),onSuccess:()=>n.invalidateQueries({queryKey:["savedSearches"]})}),c=V({mutationFn:o=>t.get("EditSavedSearch",{params:o}),onSuccess:()=>n.invalidateQueries({queryKey:["savedSearches"]})}),m=V({mutationFn:o=>t.get("RemoveSavedSearch",{params:o}),onSuccess:()=>n.invalidateQueries({queryKey:["savedSearches"]})});return{getSavedSearchesQuery:l,createSavedSearchQuery:a,editSavedSearchQuery:c,removeSavedSearchQuery:m}},Oe="_container_5hvuq_1",Qe="_list_5hvuq_6",Ve="_listItem_5hvuq_11",We="_search_5hvuq_17",Ge="_row_5hvuq_25",Ke="_truncated_5hvuq_33",A={container:Oe,list:Qe,listItem:Ve,search:We,row:Ge,truncated:Ke},Ze=({onSavedSearchClick:t,onSavedSearchRemove:n,savedSearches:l})=>{if(!l.length)return null;const a=G(),{notify:c}=te(),{removeSavedSearchQuery:m}=Y(),{mutateAsync:o,isPending:r}=m,x=async d=>{try{await o({name:d}),n(),c.success({message:`Saved search ${d} successfully removed`,title:"Saved search removed"})}catch(p){a(p)}};return e.jsxs("div",{className:A.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Saved searches"}),e.jsx("ul",{className:N("p-list--divided u-no-margin--bottom",A.list),children:l.map(d=>e.jsx("li",{children:e.jsxs("div",{className:A.listItem,children:[e.jsx(i.Button,{type:"button",appearance:"base",className:A.search,onClick:()=>t(d),children:e.jsxs(i.Row,{className:A.row,children:[e.jsx(i.Col,{size:4,children:e.jsx(i.Tooltip,{message:d.name,positionElementClassName:A.truncated,children:e.jsx("span",{children:d.name})})}),e.jsx(i.Col,{size:8,children:e.jsx(i.Tooltip,{message:d.search,positionElementClassName:A.truncated,children:e.jsx("span",{children:d.search})})})]})}),e.jsx(i.ConfirmationButton,{className:"has-icon u-no-margin--bottom u-no-padding--bottom u-no-padding--top",type:"button",appearance:"base",confirmationModalProps:{title:"Remove saved search",children:e.jsxs("p",{children:['This will remove the saved search "',d.name,'".']}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:r,confirmButtonLoading:r,onConfirm:()=>x(d.name)},children:e.jsx(i.Icon,{name:"delete"})})]})},d.name))})]})},Ye=({containerRef:t,onDismiss:n,onOverflowingItemsAmountChange:l,searchData:a})=>{const c=()=>{if(!t.current)return;const o=t.current.querySelectorAll("span.p-chip");l(Array.from(o).filter(({offsetHeight:r,offsetTop:x})=>x>r).length)};ae("resize",c),f.useEffect(()=>{c()},[a.length]);const m=o=>o.title?o.title:o.quoteValue?`'${o.value}'`:o.value;return a.map(o=>e.jsx(i.Chip,{value:m(o),lead:o.lead,onDismiss:()=>n(o.value)},o.value))},Je="_infoContainer_1lzch_1",Xe="_amount_1lzch_9",et="_helpButtonContainer_1lzch_14",tt="_helpButton_1lzch_14",M={infoContainer:Je,amount:Xe,helpButtonContainer:et,helpButton:tt},st=({isExpanded:t,onHelpButtonClick:n,overflowingChipsAmount:l})=>e.jsxs("div",{className:M.infoContainer,children:[l>0&&!t&&e.jsx("span",{className:N("u-text--muted",M.amount),children:`+${l}`}),e.jsx("div",{className:M.helpButtonContainer,children:e.jsx(i.Button,{type:"button",appearance:"base",hasIcon:!0,className:M.helpButton,onClick:a=>{a.stopPropagation(),n()},children:e.jsx(i.Icon,{name:i.ICONS.help})})})]}),nt=({onClose:t,onSearchSave:n,search:l})=>{const a=G(),{notify:c}=te(),{createSavedSearchQuery:m}=Y(),{mutateAsync:o}=m,x=re({initialValues:{name:""},onSubmit:async({name:d})=>{try{await o({search:l,name:d,title:d}),c.success({message:`Saved search ${d} successfully added`,title:"Saved search added"}),n(),t()}catch(p){a(p)}},validationSchema:oe({name:le().required("This field is required").test({message:"Name must consist of only lowercase alphanumeric characters and hyphens",test:d=>/^[a-z0-9][-a-z0-9]*$/.test(d)})})});return e.jsxs(i.Form,{onSubmit:x.handleSubmit,noValidate:!0,children:[e.jsx(i.Input,{type:"text",autoComplete:"off",autoFocus:!0,label:"Search name",...x.getFieldProps("name"),error:x.touched.name&&x.errors.name?x.errors.name:void 0}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(i.Button,{type:"button",disabled:x.isSubmitting,onClick:t,children:"Cancel"}),e.jsx(i.Button,{type:"submit",disabled:x.isSubmitting,appearance:"positive","aria-label":`Saved search as ${x.values.name}`,children:"Save search"})]})]})},at="_container_fqj7b_1",rt="_prompt_fqj7b_10",ot="_saveButton_fqj7b_17",W={container:at,prompt:rt,saveButton:ot},lt=({onSearchSave:t,search:n})=>{const[l,a]=f.useState(!1);return e.jsxs(e.Fragment,{children:[n&&l&&e.jsx(nt,{onClose:()=>a(!1),onSearchSave:t,search:n}),n&&!l&&e.jsxs("div",{className:W.container,children:[e.jsxs("span",{className:W.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:n}),e.jsx("span",{children:"..."})]}),e.jsx(i.Button,{type:"button",appearance:"link",onClick:()=>a(!0),className:W.saveButton,children:"Save search"})]})]})},it="_searchContainer_t00ki_1",ct="_form_t00ki_8",dt="_searchBoxContainer_t00ki_13",ut="_input_t00ki_17",U={searchContainer:it,form:ct,searchBoxContainer:dt,input:ut},ht=(t,n)=>!t||!n?[]:t.split(",").map(l=>{const a=n.find(({name:c})=>c===l);return a?{lead:"search",title:a.name,value:a.name}:{value:l,quoteValue:!0}}),mt=({onHelpButtonClick:t})=>{const{search:n,setPageParams:l}=w(),[a,c]=f.useState(""),[m,o]=f.useState(!1),[r,x]=f.useState(0),{getSavedSearchesQuery:d}=Y(),p=f.useRef(null),b=f.useRef(null);ie(p,()=>{o(!1)});const u=j=>{l({search:n.split(",").filter(C=>C!==j).join(",")})},{data:h,isLoading:g}=d(),S=f.useMemo(()=>ht(n,h==null?void 0:h.data),[n,h==null?void 0:h.data]),F=f.useMemo(()=>h?!a&&!S.length?h.data:h.data.filter(({name:j})=>S.every(({value:C})=>C!==`search:${j}`)).filter(({title:j,search:C})=>j.toLowerCase().includes(a.trim().toLowerCase())||C.toLowerCase().includes(a.trim().toLowerCase())):[],[h,a,S]),R=()=>{a&&(l({search:n?`${n},${a}`:a}),c(""))},E=j=>{l({search:n?`${n},search:${j.name}`:`search:${j.name}`})},Q=j=>{const{key:C}=j;m?(C==="Escape"&&o(!1),C==="Enter"&&R()):C==="Enter"&&o(!0)};return e.jsxs("div",{className:"p-search-and-filter",ref:p,children:[e.jsxs("div",{className:N("p-search-and-filter__search-container",U.searchContainer),"aria-expanded":m,ref:b,onClick:()=>o(!0),children:[e.jsx(Ye,{containerRef:b,onDismiss:u,onOverflowingItemsAmountChange:j=>x(j),searchData:S}),e.jsx(i.Form,{onSubmit:j=>{j.preventDefault(),R()},className:N("p-search-and-filter__box",U.form),children:e.jsx("div",{className:U.searchBoxContainer,children:e.jsx(i.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autocomplete:"off",className:U.input,value:a,onChange:j=>c(j),onClear:()=>c(""),onSearch:R,onClick:()=>o(!0),onKeyUp:Q})})}),e.jsx(st,{isExpanded:m,onHelpButtonClick:t,overflowingChipsAmount:r})]}),m&&g&&e.jsx(H,{}),m&&!g&&e.jsxs("div",{className:"p-search-and-filter__panel",children:[e.jsx(lt,{onSearchSave:()=>c(""),search:a.trim()}),e.jsx(Ze,{onSavedSearchClick:E,onSavedSearchRemove:()=>o(!0),savedSearches:F})]})]})},pt=({options:t})=>{const{accessGroups:n,setPageParams:l}=w();return e.jsx(T,{multiple:!0,label:"Access group",hasToggleIcon:!0,hasBadge:!0,options:t,onItemsSelect:a=>l({accessGroups:a}),selectedItems:n})},gt=({options:t})=>{const[n,l]=f.useState(""),{availabilityZones:a,setPageParams:c}=w(),m=t.length>9&&n?t.filter(({value:r})=>r!=="none"&&r.includes(n)):t,o=r=>{r[r.length-1]==="none"?c({availabilityZones:["none"]}):c({availabilityZones:r[0]!=="none"?r:r.filter(x=>x!=="none")})};return e.jsx(T,{multiple:!0,label:"Availability zone",hasToggleIcon:!0,hasBadge:!0,onSearch:t.length>9?r=>l(r):void 0,options:m,onItemsSelect:o,selectedItems:a})},xt=({options:t})=>{const{groupBy:n,setPageParams:l}=w();return e.jsx(T,{multiple:!1,label:"Group by",hasToggleIcon:!0,hasBadge:!0,options:t,onItemSelect:a=>l({groupBy:a}),selectedItem:n})},ft=({options:t})=>{const{os:n,setPageParams:l}=w();return e.jsx(T,{multiple:!1,hasBadge:!0,label:"OS",hasToggleIcon:!0,options:t,onItemSelect:a=>l({os:a}),selectedItem:n})},_t=({options:t})=>{const{setPageParams:n,status:l}=w();return e.jsx(T,{multiple:!1,label:"Status",hasToggleIcon:!0,hasBadge:!0,options:t,onItemSelect:a=>n({status:a}),selectedItem:l})},jt=({options:t})=>{const[n,l]=f.useState(""),{tags:a,setPageParams:c}=w(),m=t.filter(({value:o})=>o.includes(n));return e.jsx(T,{multiple:!0,label:"Tag",hasToggleIcon:!0,hasBadge:!0,options:m,onItemsSelect:o=>c({tags:o}),onSearch:o=>l(o),selectedItems:a})},bt=[{term:"<keyword>",description:e.jsxs("span",{children:["Instances with the title or hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"distribution:<keyword>",description:e.jsxs("span",{children:["Instances with the installed distribution named"," ",e.jsx("code",{children:"<keyword>"})]})},{term:"needs:reboot",description:"Instances needing a reboot"},{term:"alert:<type>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with outstanding alerts of the specified"," ",e.jsx("code",{children:"<type>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be ",e.jsx("code",{children:"package-upgrades"}),","," ",e.jsx("code",{children:"security-upgrades"}),",",e.jsx("code",{children:"package-profiles"}),","," ",e.jsx("code",{children:"package-reporter"}),", ",e.jsx("code",{children:"esm-disabled"}),","," ",e.jsx("code",{children:"computer-offline"}),",",e.jsx("code",{children:"computer-reboot"}),","," ",e.jsx("code",{children:"computer-duplicates"}),", ",e.jsx("code",{children:"unapproved-activities"}),"."]})]})},{term:"ip:<address>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with IP addresses like ",e.jsx("code",{children:"<address>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<address>"})," can be a fragment or partial IP address representing a subnet such as 91.185.94 to match any instances in the subnet."]})]})},{term:"mac:<address>",description:e.jsxs("span",{children:["Instances with the MAC address ",e.jsx("code",{children:"<address>"})]})},{term:"id:<instance_id>",description:e.jsxs("span",{children:["Instance with the id ",e.jsx("code",{children:"<instance_id>"})]})},{term:"access-group:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," access group"]})},{term:"search:<name>",description:e.jsxs("span",{children:["Instances meeting the terms of the ",e.jsx("code",{children:"<name>"})," saved search"]})},{term:"upgrade-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," upgrade profile"]})},{term:"removal-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," removal profile"]})},{term:"tag:<keyword>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<keyword>"})," tag"]})},{term:"hostname:<keyword>",description:e.jsxs("span",{children:["Instance with the hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"title:<keyword>",description:e.jsxs("span",{children:["Instance with the title ",e.jsx("code",{children:"<keyword>"})]})},{term:"license-id:<license_id>",description:e.jsxs("span",{children:["Search for instances licensed to the specified"," ",e.jsx("code",{children:"<license_id>"})]})},{term:"needs:license OR license-id:none",description:"Search for instances that do not have a Landscape license, and, as a result, are not managed"},{term:"annotation:<key>",description:e.jsxs("span",{children:["Search for instances which define the specified annotation key. Optionally specify ",e.jsx("code",{children:"annotation:<key>:<string>"})," ","which will only return instances whose key matches and value also contains the ",e.jsx("code",{children:"<string>"})," specified"]})}],St=[{canBeHidden:!1,label:"Instance name",value:"title"},{canBeHidden:!0,label:"Status",value:"alerts"},{canBeHidden:!0,label:"Upgrades",value:"upgrades"},{canBeHidden:!0,label:"OS",value:"distribution"},{canBeHidden:!0,label:"Availability zone",value:"cloud_init.availability_zone"},{canBeHidden:!0,label:"Ubuntu pro",value:"ubuntu_pro_info"},{canBeHidden:!0,label:"Last ping",value:"last_ping_time"}],vt="_top_q7ta9_1",Ct="_select_q7ta9_13",yt="_searchContainer_q7ta9_19",It="_filters_q7ta9_23",wt="_divider_q7ta9_28",kt="_widgets_q7ta9_32",D={top:vt,select:Ct,searchContainer:yt,filters:It,divider:wt,widgets:kt},Nt=()=>{const[t,n]=f.useState(!1),{getAccessGroupQuery:l}=_e(),{getAllInstanceTagsQuery:a,getAvailabilityZonesQuery:c}=Z(),{data:m}=a(),o=(m==null?void 0:m.data.results.map(h=>({label:h,value:h})))??[],{data:r}=c(),x=((r==null?void 0:r.data.values)??[]).reduce((h,g)=>(h.push({label:g,value:g}),h),[{label:"Without zones",value:"none",group:"1"}]),{data:d}=l(),p=(d==null?void 0:d.data.map(({name:h,title:g})=>({value:h,label:g})))??[],b=L.groupBy.options,s=L.status.type==="select"?L.status.options:[],u=L.os.type==="select"?L.os.options:[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:D.top,children:[e.jsx("div",{className:D.searchContainer,children:e.jsx(mt,{onHelpButtonClick:()=>n(!0)})}),e.jsxs("div",{className:D.filters,children:[e.jsx(xt,{options:b}),e.jsx("span",{className:D.divider}),e.jsx(_t,{options:s}),e.jsx(ft,{options:u}),e.jsx(gt,{options:x}),e.jsx(pt,{options:p}),e.jsx(jt,{options:o}),e.jsx("span",{className:D.divider}),e.jsx(Fe,{options:St})]})]}),e.jsx(Ue,{filtersToDisplay:["accessGroups","os","availabilityZones","status","tags"],accessGroupOptions:p,availabilityZonesOptions:x,osOptions:u,statusOptions:s,tagOptions:o}),e.jsx(xe,{open:t,data:bt,onClose:()=>n(!1)}),e.jsx(ge,{})]})},Bt="_checkbox_spblf_1",$t="_rowHeader_spblf_5",At="_nested_spblf_8",Lt="_restartError_spblf_12",Tt="_restartWarning_spblf_16",Ft="_statusListItem_spblf_20",Rt="_statusContainer_spblf_24",O={checkbox:Bt,rowHeader:$t,nested:At,restartError:Lt,restartWarning:Tt,statusListItem:Ft,statusContainer:Rt},Et=({instances:t,selectedInstances:n,setSelectedInstances:l,groupBy:a})=>{const{disabledColumns:c}=w(),m=()=>{l(n.length!==0?[]:t)},o=s=>{if(a==="parent"&&s.original.children.length>0){const u=s.original.children.map(({id:h})=>h);n.some(({id:h})=>u.includes(h))?l(n.filter(({id:h})=>!u.includes(h))):l([...n,...s.original.children.map(h=>({...h,parent:s.original,children:[]}))])}else n.some(({id:u})=>u===s.original.id)?l(n.filter(({id:u})=>u!==s.original.id)):l([...n,s.original])},r=f.useMemo(()=>a==="parent"?t.map(s=>({...s,subRows:s.children.map(u=>({...u,parent:s,children:[]}))})):t,[t,a]),x=s=>{const u=n.map(({id:h})=>h);return a==="parent"&&!s.is_wsl_instance&&s.children.length>0?s.children.every(({id:h})=>u.includes(h))?"checked":s.children.some(({id:h})=>u.includes(h))?"indeterminate":"unchecked":u.includes(s.id)?"checked":"unchecked"},d=s=>{if(!s.distribution||!/\d{1,2}\.\d{2}/.test(s.distribution))return{icon:"",label:e.jsx(q,{})};if(!s.upgrades||!s.upgrades.security&&!s.upgrades.regular)return{icon:y.UpToDate.icon.color,label:y.UpToDate.label};if(s.upgrades.security)if(s.upgrades.regular){const u=`${s.upgrades.security} security, ${s.upgrades.regular} regular ${s.upgrades.regular===1?"upgrade":"upgrades"}`;return{icon:y.SecurityUpgradesAlert.icon.color,label:e.jsx(e.Fragment,{children:u})}}else return{icon:y.SecurityUpgradesAlert.icon.color,label:e.jsxs(e.Fragment,{children:[s.upgrades.security," security"," ",s.upgrades.security===1?"upgrade":"upgrades"]})};else return{icon:y.PackageUpgradesAlert.icon.color,label:e.jsxs(e.Fragment,{children:[s.upgrades.regular," regular"," ",s.upgrades.regular===1?"upgrade":"upgrades"]})}},p=s=>{const u=((s==null?void 0:s.alerts)??[]).filter(({type:h})=>!["PackageUpgradesAlert","SecurityUpgradesAlert"].includes(h));return u.length===0?{icon:`${y.Online.icon.color}`,label:y.Online.alternateLabel??y.Online.label}:u.length===1?{icon:`${y[u[0].type].icon.color??y.Unknown.icon.color}`,label:e.jsx(e.Fragment,{children:u[0].summary})}:{label:e.jsx("span",{className:O.statusContainer,children:u.map(({type:h,summary:g})=>{var S;return e.jsx("span",{className:O.statusListItem,children:e.jsx(i.Tooltip,{message:g,children:e.jsx(i.Icon,{className:"u-no-margin--left",name:`${((S=y[h])==null?void 0:S.icon.color)??y.Unknown.icon.color}`})})},h)})})}},b=f.useMemo(()=>[{accessor:"title",Header:e.jsxs(e.Fragment,{children:[e.jsx(i.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,onChange:m,disabled:t.length===0,checked:n.length===t.length&&t.length!==0,indeterminate:n.length!==0&&n.length<t.length}),e.jsx("span",{children:"Name"})]}),Cell:({row:s})=>e.jsxs("div",{className:N(O.rowHeader,{[O.nested]:s.depth>0}),children:[e.jsx(i.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:s.original.title}),labelClassName:"u-no-margin--bottom u-no-padding--top",checked:x(s.original)==="checked",indeterminate:x(s.original)==="indeterminate",onChange:()=>{o(s)}}),e.jsx(ce,{to:s.original.parent?`${J}instances/${s.original.parent.id}/${s.original.id}`:`${J}instances/${s.original.id}`,children:s.original.title})]})},{accessor:"alerts",Header:"Status",Cell:({row:{original:s}})=>{const{label:u}=p(s);return u},getCellIcon:({row:{original:s}})=>{const{icon:u}=p(s);return u}},{accessor:"upgrades",Header:"Upgrades",Cell:({row:{original:s}})=>{const{label:u}=d(s);return u},getCellIcon:({row:{original:s}})=>{const{icon:u}=d(s);return u}},{accessor:"distribution",Header:"OS",Cell:({row:{original:s}})=>s.distribution?/\d{1,2}\.\d{2}/.test(s.distribution)?`${s.is_wsl_instance?"WSL - ":""}Ubuntu ${s.distribution}`:`Windows ${s.distribution}`:e.jsx(q,{})},{accessor:"cloud_init.availability_zone",Header:"Availability zone",Cell:({row:{original:s}})=>{var u;return e.jsx(e.Fragment,{children:((u=s.cloud_init)==null?void 0:u.availability_zone)??e.jsx(q,{})})}},{accessor:"ubuntu_pro_info",Header:"Ubuntu pro",Cell:({row:s})=>e.jsx(e.Fragment,{children:s.original.ubuntu_pro_info&&z(s.original.ubuntu_pro_info.expires).isValid()?`Exp. ${z(s.original.ubuntu_pro_info.expires).format(X)}`:e.jsx(q,{})})},{accessor:"last_ping_time",Header:"Last ping time",Cell:({row:s})=>e.jsx(e.Fragment,{children:z(s.original.last_ping_time).isValid()?z(s.original.last_ping_time).format(X):e.jsx(q,{})})}].filter(({accessor:s})=>s&&!c.includes(s)),[c.length,n.length,t,a]);return e.jsx(e.Fragment,{children:e.jsx(i.ModularTable,{emptyMsg:"No instances found",columns:b,data:r})})},ee=(t,n)=>{var l;return t.type==="select"?((l=t.options.find(a=>a.value===n))==null?void 0:l.query)??"":""},qt=({accessGroups:t,availabilityZones:n,os:l,search:a,status:c,tags:m})=>{const o=[];return l&&o.push(ee(L.os,l)),c&&o.push(ee(L.status,c)),a&&o.push(...a.split(",")),m.length&&o.push(`tag:${m.join(" OR tag:")}`),t.length&&o.push(`access-group:${t.join(" OR access-group:")}`),n.length&&o.push(n.includes("none")?"availability-zone:null":`availability-zone:${n.join(" OR availability-zone:")}`),o.join(" ")},Dt=({selectedInstances:t,setSelectedInstances:n})=>{const{currentPage:l,pageSize:a,groupBy:c,...m}=w(),{getInstancesQuery:o}=Z(),{data:r,isLoading:x}=o({query:qt(m),root_only:c==="parent",with_alerts:!0,with_upgrades:!0,limit:a,offset:(l-1)*a}),d=(r==null?void 0:r.data.results)??[],p=(r==null?void 0:r.data.count)??0,b=()=>{n([])};return e.jsxs(e.Fragment,{children:[e.jsx(Nt,{}),x?e.jsx(H,{}):e.jsx(Et,{instances:d,selectedInstances:t,setSelectedInstances:s=>n(s),groupBy:c}),e.jsx(pe,{totalItems:p,handleClearSelection:b,currentItemCount:d.length})]})},Ht="_header_116wp_1",Pt={header:Ht},zt=f.lazy(()=>K(()=>import("./index-CKz24aTx.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])).then(t=>({default:t.RunInstanceScriptForm}))),Mt=f.lazy(()=>K(()=>import("./index-DhTkOFaH.js"),__vite__mapDeps([12,1,2,5,6,7,13,8,14,15])).then(t=>({default:t.Upgrades}))),Ut=f.lazy(()=>K(()=>import("./index-NPt1GHi_.js"),__vite__mapDeps([16,1,2,8,5,6,7,17]))),ss=()=>{const[t,n]=f.useState([]),l=G(),{setSidePanelContent:a}=de(),{rebootInstancesQuery:c,shutdownInstancesQuery:m}=Z(),{mutateAsync:o,isPending:r}=c,{mutateAsync:x,isPending:d}=m,p=async()=>{a("Run script",e.jsx(f.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(zt,{query:`id:${t.map(({id:g})=>g).join(" id:")}`})}))},b=async()=>{try{await x({computer_ids:t.map(({id:g})=>g)})}catch(g){l(g)}},s=async()=>{try{await o({computer_ids:t.map(({id:g})=>g)})}catch(g){l(g)}},u=()=>{a("Upgrades",e.jsx(f.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(Mt,{selectedInstances:t})}),"large")},h=()=>{a(`Report for ${t.length===1?t[0].title:`${t.length} instances`}`,e.jsx(f.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(Ut,{instanceIds:t.map(({id:g})=>g)})}),"medium")};return e.jsxs(ue,{children:[e.jsx(he,{title:"Instances",className:Pt.header,actions:[e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(i.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:d||t.length===0,confirmationModalProps:{title:"Shutting down selected instances",children:e.jsxs("p",{children:["Are you sure you want to shutdown ",t.length," ","instance",t.length===1?"":"s","?"]}),confirmButtonLabel:"Shutdown",confirmButtonAppearance:"negative",confirmButtonLoading:d,confirmButtonDisabled:d,onConfirm:b},children:[e.jsx(i.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]}),e.jsxs(i.ConfirmationButton,{className:"p-segmented-control__button has-icon",type:"button",disabled:r||t.length===0,confirmationModalProps:{title:"Restarting selected instances",children:e.jsxs("p",{children:["Are you sure you want to restart ",t.length," ","instance",t.length===1?"":"s","?"]}),confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonLoading:r,confirmButtonDisabled:r,onConfirm:s},children:[e.jsx(i.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]}),e.jsxs(i.Button,{className:"p-segmented-control__button",type:"button",onClick:h,disabled:t.length===0,children:[e.jsx(i.Icon,{name:"status"}),e.jsx("span",{children:"View report"})]}),e.jsxs(i.Button,{className:"p-segmented-control__button",type:"button",onClick:p,disabled:t.length===0,children:[e.jsx(i.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]}),e.jsxs(i.Button,{className:"p-segmented-control__button",type:"button",onClick:u,disabled:t.length===0||t.every(({upgrades:g})=>!g||!g.regular&&!g.security),children:[e.jsx(i.Icon,{name:"change-version"}),e.jsx("span",{children:"Upgrade"})]})]})},"buttons")]}),e.jsx(me,{children:e.jsx(Dt,{selectedInstances:t,setSelectedInstances:g=>{n(g)}})})]})};export{ss as default};
