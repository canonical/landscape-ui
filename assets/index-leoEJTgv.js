import{h as x,t as h,k as c,p as R,q as I,f as _,s as w,j as i,g as u}from"./index-Bj3y1t-6.js";import{u as F}from"./useRoles-BuiQ5OVH.js";import{g as j,a as C,b as D,c as V}from"./index-Bur_FT_S.js";import{P as y,A as Q}from"./AccessGroupBlock-DeMXAAc6.js";import{S as k}from"./SidePanelFormButtons-dpQcLrQ5.js";import"./useFetchOld-BtTLYE3Q.js";import"./PageMain-BzoqSo_G.js";import"./TruncatedCell-BxNzcIaN.js";import"./SidePanelFormButtons.module-tJTvEwdD.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a727bfc4-15ca-4b8a-becd-c94bfeab35ec",e._sentryDebugIdIdentifier="sentry-dbid-a727bfc4-15ca-4b8a-becd-c94bfeab35ec")}catch{}const O={access_groups:[],description:"",name:"",permissions:[]},B=x().shape({access_groups:h().of(c()),description:c(),name:c().required("This field is required.").matches(/^[a-zA-Z][-+a-zA-Z0-9]*$/,"Name must start with a letter and can contain alphanumeric characters, ‘-‘ and ‘+’."),permissions:h().of(c())}),E=(e,t)=>({accessGroupsToAdd:j(e.access_groups,t),permissionsToAdd:e.permissions.includes("AddComputerToAccessGroup")?[...e.permissions,"RemoveComputerFromAccessGroup"]:e.permissions}),N=(e,t,d)=>{const{addAccessGroups:p,addPermissions:m}=d,r=[],{accessGroupsToAdd:n,permissionsToAdd:a}=E(e,t);return n.length>0&&r.push(p({name:e.name,access_groups:n})),a.length>0&&r.push(m({name:e.name,permissions:a})),r},K=()=>{const e=R(),{notify:t}=I(),{closeSidePanel:d}=_(),{createRoleQuery:p,addPermissionsToRoleQuery:m,addAccessGroupsToRoleQuery:r,getAccessGroupQuery:n,getPermissionsQuery:a}=F(),{data:l}=a(),g=l?C(l.data):[],{data:f}=n(),b=f?D(V(f.data)):[],{mutateAsync:A}=p,{mutateAsync:T}=m,{mutateAsync:P}=r,s=w({initialValues:O,validationSchema:B,onSubmit:async o=>{await A({description:o.description,name:o.name});const G=N(o,b,{addAccessGroups:P,addPermissions:T});try{await Promise.all(G),d(),t.success({title:"New role has been added",message:`You added the role '${o.name}'`})}catch(S){e(S)}}});return i.jsxs(u.Form,{onSubmit:s.handleSubmit,noValidate:!0,children:[i.jsx(u.Input,{type:"text",label:"Role name",required:!0,autoComplete:"off",...s.getFieldProps("name"),error:s.touched.name&&s.errors.name?s.errors.name:void 0}),i.jsx(u.Input,{type:"text",label:"Description",autoComplete:"off",...s.getFieldProps("description"),error:s.touched.description&&s.errors.description?s.errors.description:void 0}),i.jsx(y,{description:"These permissions are for managing the account as a whole. They are not limited to the specified access groups, but instead apply globally.",onPermissionChange:o=>s.setFieldValue("permissions",o),options:g.filter(({global:o})=>o),permissions:s.values.permissions,title:"Global permissions"}),i.jsx(y,{description:"These permissions only apply to selected access groups.",onPermissionChange:o=>s.setFieldValue("permissions",o),options:g.filter(({global:o})=>!o),permissions:s.values.permissions,title:"Permissions"}),i.jsx(Q,{accessGroupOptions:b,accessGroups:s.values.access_groups,onAccessGroupChange:o=>{s.setFieldValue("access_groups",o)}}),i.jsx(k,{submitButtonDisabled:s.isSubmitting,submitButtonText:"Add role"})]})};export{K as default};
