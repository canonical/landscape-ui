const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-4uzc-EuB.js","assets/index-P3tcVer_.js","assets/index-CjWED4RU.css","assets/useInstances-Dt0ImR3b.js","assets/useFetchOld-BGcQOp2P.js","assets/SidePanelFormButtons-CEx4Wy-H.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/useRoles-oaQYE5g1.js","assets/index-OgHTs_-0.js","assets/ScriptsTabs-C3hIDC9c.js","assets/TablePagination-9PvQlVgk.js","assets/usePageParams-CZXld3eS.js","assets/TablePaginationBase-DrquMGK2.js","assets/TablePaginationBase-CJl3HN1X.css","assets/NoData-DfvYDVkG.js","assets/TruncatedCell-D_3fzDwd.js","assets/TruncatedCell-CoXbu3VM.css","assets/StatusFilter-BjWN4DdL.js","assets/TableFilter-DTXx6h3i.js","assets/TableFilter-CNw_lMaf.css","assets/TableFilterChips-HMcdOmXT.js","assets/TableFilterChips-CHqetGbX.css","assets/HeaderWithSearch-DCz7Mge8.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-Cm1BYFZQ.js","assets/SingleInstanceTabs-9EpKZLyq.css","assets/index-BbHeewcZ.js","assets/ScriptsTabs-CNG6qEx6.css","assets/DeliveryBlock-DQX6CCmk.js","assets/DeliveryBlock-VExRkUer.css","assets/formikErrors-Bw8iTXYS.js","assets/index-G0JV_7TV.js","assets/CodeEditor-BPM7vodj.js","assets/CodeEditor-CwlLRp3p.css","assets/ScriptFormAttachments-WLzw2kpB.js","assets/index-DQfK0Pa-.js","assets/EmployeeGroupIdentityIssuerList-CmrEs8Tq.js","assets/EmployeeGroupIdentityIssuerList-DJkUyphv.css","assets/EmployeeList-DcEUR-GX.js","assets/EmployeeList-BthGffhq.css","assets/downshift.esm-DX4h0D7n.js","assets/index-CbvjFctk.css"])))=>i.map(i=>d[i]);
import{j as e,n as v,a1 as de,r as i,h as n,l as ie,a2 as ue,X as me,o as V,D as pe,i as he,J as fe,k as ge,a as xe,q as _e,s as be,g as je,b as ye,t as Y,I as ve,_ as J}from"./index-P3tcVer_.js";import{u as G}from"./useInstances-Dt0ImR3b.js";import{u as Ie}from"./WslInstancesHeader-j3_12lnA.js";import{m as te,h as ne}from"./usePageParams-CZXld3eS.js";import{u as we}from"./useRoles-oaQYE5g1.js";import{N as y}from"./NoData-DfvYDVkG.js";import{u as Ce}from"./index-C4mrLuM2.js";import{b as Se}from"./helpers-CmPE_LZU.js";import"./InstancesPageActions-SaA8hNJ6.js";import{g as se}from"./formikErrors-Bw8iTXYS.js";import"./useFetchOld-BGcQOp2P.js";import"./HeaderWithSearch-DCz7Mge8.js";import"./TableFilterChips-HMcdOmXT.js";import"./TablePagination-9PvQlVgk.js";import"./TablePaginationBase-DrquMGK2.js";import"./StatusFilter-BjWN4DdL.js";import"./TableFilter-DTXx6h3i.js";const Ne="_infoContainer_1ca11_1",Ae="_amount_1ca11_9",ae={infoContainer:Ne,amount:Ae},Te=({isExpanded:t,overflowingChipsAmount:s})=>s>0&&!t&&e.jsx("div",{className:ae.infoContainer,children:e.jsx("span",{className:v("u-text--muted",ae.amount),children:`+${s}`})}),ke=({containerRef:t,onDismiss:s,onOverflowingItemsAmountChange:l,tagData:d})=>{const u=()=>{if(!t.current)return;const r=t.current.querySelectorAll("span.p-chip");l(Array.from(r).filter(({offsetHeight:f,offsetTop:m})=>m>f).length)};return de("resize",u),i.useEffect(()=>{u()},[d.length]),d.map(r=>e.jsx(n.Chip,{value:r,onDismiss:()=>s(r)},r))},Be="_container_1f6mu_1",Ee="_list_1f6mu_6",Re="_listItem_1f6mu_11",De="_search_1f6mu_17",z={container:Be,list:Ee,listItem:Re,search:De},Le=({onTagClick:t,tags:s})=>s.length?e.jsxs("div",{className:z.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Tags"}),e.jsx("ul",{className:v("p-list--divided u-no-margin--bottom",z.list),children:s.map(l=>e.jsx("li",{children:e.jsx("div",{className:z.listItem,children:e.jsx(n.Button,{type:"button",appearance:"base",className:z.search,onClick:()=>t(l),children:l})})},l))})]}):null,Pe="_container_fqj7b_1",$e="_prompt_fqj7b_10",ze="_saveButton_fqj7b_17",K={container:Pe,prompt:$e,saveButton:ze},Fe=({onTagAdd:t,search:s})=>e.jsx(e.Fragment,{children:s&&e.jsxs("div",{className:K.container,children:[e.jsxs("span",{className:K.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:s}),e.jsx("span",{children:"..."})]}),e.jsx(n.Button,{type:"button",appearance:"link",onClick:t,className:K.saveButton,children:"Add tag"})]})}),oe=ie().matches(/^[a-zA-Z]/,{message:"Tag must starts with a letter",excludeEmptyString:!0}).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,{message:"Tag can only contain letters, numbers, hyphens, and underscores",excludeEmptyString:!0}),Ve="_searchContainer_qgkjy_1",qe="_box_qgkjy_8",Oe="_inputContainer_qgkjy_13",Me="_inputError_qgkjy_18",F={searchContainer:Ve,box:qe,inputContainer:Oe,inputError:Me},Qe=({onTagsChange:t,tags:s,label:l,labelClassName:d,required:u})=>{var L;const[r,f]=i.useState(""),[m,_]=i.useState(""),[q,A]=i.useState(!1),[w,O]=i.useState(""),[x,I]=i.useState(!1),[M,C]=i.useState(0),{height:T}=ue(),[Q,k]=i.useState({top:"100%",bottom:"auto"}),{getAllInstanceTagsQuery:b}=G(),B=i.useRef(null),p=i.useRef(null);i.useEffect(()=>{if(!p.current)return;const a=p.current.querySelector("input");a&&O(a.id)},[p.current]),i.useEffect(()=>{!x||!p.current||H()},[T,x,p.current,(L=p.current)==null?void 0:L.clientHeight]);const H=()=>{if(!p.current)return;const{top:a,height:h}=p.current.getBoundingClientRect();a+h+379<T?k({top:"100%",bottom:"auto"}):k({top:"auto",bottom:"100%"})},S=()=>{I(!1)};me(B,S);const U=a=>{t(s.filter(h=>h!==a))},{data:j,isLoading:E}=b(),N=i.useMemo(()=>j?!r&&!s.length?j.data.results:j.data.results.filter(a=>!s.includes(a)).filter(a=>a.toLowerCase().includes(r.trim().toLowerCase())):[],[j,r,s]),W=a=>{t([...s,a])},c=()=>{if(r.trim())try{const a=oe.validateSync(r.trim())??"";W(a),f(""),_(""),A(!1)}catch(a){a instanceof Error&&(_(a.message),A(!0))}},R=a=>{if(f(a.target.value),q)try{oe.validateSync(a.target.value),_("")}catch(h){h instanceof Error&&_(h.message)}},D=a=>{const{key:h}=a;x?(h==="Escape"&&S(),h==="Enter"&&c()):h==="Enter"&&I(!0)};return e.jsxs("div",{children:[e.jsx("label",{className:v("p-form__label",{"is-required":u},d),htmlFor:w,children:l||"Tags"}),e.jsxs("div",{className:"p-search-and-filter",ref:B,children:[e.jsxs("div",{className:v("p-search-and-filter__search-container",F.searchContainer),"aria-expanded":x,ref:p,onClick:()=>I(!0),children:[e.jsx(ke,{containerRef:p,onDismiss:U,onOverflowingItemsAmountChange:a=>C(a),tagData:s}),e.jsx("div",{className:v("p-search-and-filter__box",F.box),children:e.jsx("div",{className:F.inputContainer,children:e.jsx(n.Input,{type:"text",autoComplete:"off",value:r,onChange:R,placeholder:"Add tags",className:"u-no-margin--bottom",onClick:()=>I(!0),onKeyUp:D,wrapperClassName:m?"is-error":"","aria-errormessage":m?`${w}-error`:void 0,"aria-invalid":!!m})})}),m&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:v("p-form-validation__message",F.inputError),id:`${w}-error`,children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:m})]})}),e.jsx(Te,{isExpanded:x,overflowingChipsAmount:M})]}),x&&E&&e.jsx(V,{}),x&&!E&&e.jsxs("div",{className:"p-search-and-filter__panel",style:Q,children:[e.jsx(Fe,{onTagAdd:c,search:r}),e.jsx(Le,{onTagClick:W,tags:N})]})]})]})},He=t=>{var l;const s=(l=t.grouped_hardware)==null?void 0:l.network;return!Array.isArray(s)||s.length===0?e.jsx(y,{}):s.filter(({ip:d})=>d!=="Not available").map(({ip:d})=>d).join(", ")||e.jsx(y,{})},Ue=(t,s)=>{var l,d,u;return[{label:"instance ID",value:t.id},{label:"Hostname",value:t.hostname},{label:"IP Address",value:He(t)},{label:"Serial number",value:((l=t.grouped_hardware)==null?void 0:l.system.serial)??e.jsx(y,{})},{label:"Product identifier",value:((d=t.grouped_hardware)==null?void 0:d.system.model)??e.jsx(y,{})},{label:"Distribution",value:t.distribution??"Unknown"},{label:"Access group",value:((u=s.find(({value:r})=>r===t.access_group))==null?void 0:u.label)||t.access_group},{label:"Last ping time",value:t.last_ping_time&&te(t.last_ping_time).isValid()?te(t.last_ping_time).format(pe):e.jsx(y,{})},{label:"Annotations",value:t.annotations?Object.entries(t.annotations).map(([r,f],m,_)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:`${r}: ${f}`}),m<_.length-1&&e.jsx("br",{})]})):e.jsx(y,{})},{label:"Comment",value:t.comment||e.jsx(y,{})}]},We="_titleRow_lxk0r_1",Ze="_flexContainer_lxk0r_6",Ye="_italic_lxk0r_11",Ke="_infoRow_lxk0r_15",Ge="_tagSection_lxk0r_20",Je="_tagsRow_lxk0r_25",Xe="_tagsButton_lxk0r_33",g={titleRow:We,flexContainer:Ze,italic:Ye,infoRow:Ke,tagSection:Ge,tagsRow:Je,tagsButton:Xe},et={deliver_after:"",deliverImmediately:!0,action:null},tt=he().shape({deliver_after:ie().when("deliverImmediately",{is:!1,then:t=>t.required("This field is required").test({message:"Invalid date",test:s=>ne(s).isValid()}).test({message:"Date must be in the future",test:s=>ne(s).isAfter()})}),deliverImmediately:ge(),action:fe().oneOf(["shutdown","reboot"]).required()}),nt=i.lazy(async()=>J(()=>import("./index-4uzc-EuB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),st=i.lazy(async()=>J(()=>import("./index-OgHTs_-0.js"),__vite__mapDeps([9,10,1,2,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,5,6,7,29,4,30,8,31,32,33,34,35])).then(t=>({default:t.RunInstanceScriptForm}))),at=i.lazy(async()=>J(()=>import("./index-DQfK0Pa-.js"),__vite__mapDeps([36,1,2,5,6,7,12,27,37,11,13,14,19,20,21,22,23,24,16,17,38,39,15,40,41,42]))),vt=({instance:t})=>{const[s,l]=i.useState(t.tags),d=xe(),u=_e(),{openActivityDetails:r}=Ce(),{notify:f}=be(),{setSidePanelContent:m}=je(),{getAccessGroupQuery:_}=we(),{removeInstancesQuery:q,rebootInstancesQuery:A,sanitizeInstanceQuery:w,shutdownInstancesQuery:O}=G(),{deleteChildInstancesQuery:x}=Ie(),{editInstanceQuery:I}=G(),{isFeatureEnabled:M}=ye();i.useEffect(()=>{l(t.tags)},[t.tags]);const{data:C}=_(),T=(C==null?void 0:C.data.map(({name:o,title:$})=>({label:$,value:o})))??[],{mutateAsync:Q}=I,{mutateAsync:k,isPending:b}=q,{mutateAsync:B,isPending:p}=A,{mutateAsync:H,isPending:S}=O,{mutateAsync:U,isPending:j}=x,{mutateAsync:E,isPending:N}=w,c=Y({initialValues:et,validationSchema:tt,onSubmit:async o=>{if(!o.action)return;const $={computer_ids:[t.id],deliver_after:o.deliverImmediately?void 0:`${o.deliver_after}:00Z`};try{const{data:Z}=o.action==="reboot"?await B($):await H($),ee=o.action==="reboot"?"restarted":"shut down";f.success({title:`You queued "${t.title}" to be ${ee}`,message:`Instance "${t.title}" will be ${ee} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{r(Z)}}]})}catch(Z){u(Z)}}}),R=async()=>{try{await k({computer_ids:[t.id]}),d("/instances",{replace:!0})}catch(o){u(o)}},D=async()=>{try{const{data:o}=await E({computer_id:t.id,computer_title:t.title});f.success({title:`You have successfully initiated Sanitization for ${t.title}`,message:`Sanitizing for ${t.title} has been queued in Activities. The data will be permanently irrecoverable once complete.`,actions:[{label:"View details",onClick:()=>{r(o)}}]})}catch(o){u(o)}},L=Y({initialValues:{confirmationText:""},onSubmit:async()=>R()}),a=Y({initialValues:{confirmationText:""},onSubmit:async()=>D()}),h=async()=>{try{await Q({instanceId:t.id,tags:s}),f.success({title:"Tags updated",message:`"${t.title}" instance tags have been updated successfully`})}catch(o){u(o)}},X=()=>{m("Edit Instance",e.jsx(i.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(nt,{instance:t})}))},re=()=>{m("Run script",e.jsx(i.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(st,{query:`id:${t.id}`})}))},le=()=>{m(`Associate Employee with ${t.title}`,e.jsx(i.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(at,{instanceTitle:t.title,employeeId:t.employee_id})}))},ce=async()=>{try{await U({computer_ids:[t.id]}),d("/instances",{replace:!0})}catch(o){u(o)}},P=async o=>{await c.setFieldValue("action",o),c.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:g.titleRow,children:[e.jsxs("div",{className:g.flexContainer,children:[e.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:t.title}),t.is_wsl_instance&&e.jsx("p",{className:v("u-text--muted u-no-margin--bottom",g.italic),children:"WSL Instance"})]}),e.jsxs("div",{className:g.flexContainer,children:[t.is_wsl_instance&&e.jsx(n.ConfirmationButton,{className:"u-no-margin--bottom u-no-margin--right",type:"button",confirmationModalProps:{title:"Delete instance",children:e.jsxs("p",{children:["This will permanently delete the instance"," ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:j,confirmButtonLoading:j,onConfirm:ce},children:"Delete instance"}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:X,children:[e.jsx(n.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),Se("runScripts",t)&&e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:re,children:[e.jsx(n.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:b,confirmationModalProps:{title:"Remove instance from Landscape",children:e.jsxs(n.Form,{onSubmit:c.handleSubmit,noValidate:!0,children:[e.jsxs("p",{children:["Removing this ",t.title," will delete all associated data and free up one license slot for another computer to be registered."]}),e.jsxs("p",{children:["Type ",e.jsxs("b",{children:["remove ",t.title]})," to confirm."]}),e.jsx(n.Input,{type:"text",...L.getFieldProps("confirmationText")})]}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:b,confirmButtonLoading:b,onConfirm:R},children:[e.jsx(n.Icon,{name:n.ICONS.delete}),e.jsx("span",{children:"Remove from Landscape"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:N,confirmationModalProps:{title:"Sanitize instance",children:e.jsxs(n.Form,{onSubmit:a.handleSubmit,noValidate:!0,children:[e.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for ",t.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]}),e.jsxs("p",{children:["Type ",e.jsxs("b",{children:["sanitize ",t.title]})," to confirm."]}),e.jsx(n.Input,{type:"text",...a.getFieldProps("confirmationText")})]}),confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:N||a.values.confirmationText!==`sanitize ${t.title}`,confirmButtonLoading:N,onConfirm:D},children:[e.jsx(n.Icon,{name:"tidy"}),e.jsx("span",{children:"Sanitize"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:b,confirmationModalProps:{title:"Restart instance",children:e.jsxs(n.Form,{onSubmit:async()=>P("reboot"),noValidate:!0,children:[e.jsx(n.CheckboxInput,{label:"Deliver as soon as possible",...c.getFieldProps("deliverImmediately"),checked:c.values.deliverImmediately}),e.jsx(n.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:g.input,placeholder:"Scheduled time",...c.getFieldProps("deliver_after"),disabled:c.values.deliverImmediately,error:se(c,"deliver_after")}),e.jsxs("p",{children:['This will restart "',t.title,'" instance.']})]}),confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonDisabled:p,confirmButtonLoading:p,onConfirm:async()=>P("reboot")},children:[e.jsx(n.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]}),M("employee-management")&&e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:le,children:[e.jsx(n.Icon,{name:n.ICONS.user}),e.jsx("span",{children:"Associate employee"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:b,confirmationModalProps:{title:"Shut down instance",children:e.jsxs(n.Form,{onSubmit:async()=>P("shutdown"),noValidate:!0,children:[e.jsx(n.CheckboxInput,{label:"Deliver as soon as possible",...c.getFieldProps("deliverImmediately"),checked:c.values.deliverImmediately}),e.jsx(n.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:g.input,placeholder:"Scheduled time",...c.getFieldProps("deliver_after"),disabled:c.values.deliverImmediately,error:se(c,"deliver_after")}),e.jsxs("p",{children:['This will shut down "',t.title,'" instance.']})]}),confirmButtonLabel:"Shutdown",confirmButtonAppearance:"negative",confirmButtonDisabled:S,confirmButtonLoading:S,onConfirm:async()=>P("shutdown")},children:[e.jsx(n.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]})]})},"buttons")]})]}),e.jsx("div",{className:g.infoRow,children:e.jsx(n.Row,{className:"u-no-padding--left u-no-padding--right u-no-max-width",children:Ue(t,T).map(o=>e.jsx(n.Col,{size:4,children:e.jsx(ve,{...o})},o.label))})}),e.jsx("div",{className:g.tagSection,children:e.jsxs(n.Row,{className:g.tagsRow,children:[e.jsx(n.Col,{size:4,children:e.jsx(Qe,{labelClassName:"p-text--small p-text--small-caps u-text--muted",onTagsChange:o=>{l(o)},tags:s})}),e.jsx(n.Col,{size:2,className:g.tagsButton,children:e.jsx(n.Button,{type:"button",className:"u-no-margin--bottom",onClick:h,children:"Update"})})]})})]})};export{vt as default};
