const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DWQWYwKb.js","assets/index-BRihK9aF.js","assets/index-DgLN2HdX.css","assets/MultiSelectField-60LuLhWg.js","assets/MultiSelectField-GyNA33om.css","assets/SidePanelFormButtons-BFlViY8c.js","assets/SidePanelFormButtons.module-C5v714vX.js","assets/SidePanelFormButtons-Cl1KfOFD.css","assets/useRoles-BaBAheRf.js","assets/useFetchOld-CpP6IFJx.js","assets/PageMain-BoWGNkz2.js","assets/PageMain--v5xNZ5p.css","assets/TablePagination-5Vy8vn_p.js","assets/usePageParams-iyOWMaH2.js","assets/TablePaginationBase-BoGPMhhk.js","assets/TablePaginationBase-CJl3HN1X.css","assets/NoData-UXVxwgLt.js","assets/TableFilterChips-BIIQiaEm.js","assets/TableFilterChips-CHqetGbX.css","assets/HeaderWithSearch-DtfezJ1H.js","assets/HeaderWithSearch-C2lwo0VI.css"])))=>i.map(i=>d[i]);
import{b as w,e as H,c as j,d as L,r as g,q as k,p as I,s as T,h as Q,t as E,k as M,j as e,g as d,I as _,f as F,n as S,E as V,_ as D,D as B}from"./index-BRihK9aF.js";import{P as z,a as O,b as K}from"./PageMain-BoWGNkz2.js";import{u as Y}from"./useFetchOld-CpP6IFJx.js";import{T as U}from"./TablePagination-5Vy8vn_p.js";import{u as $}from"./useRoles-BaBAheRf.js";import{M as q}from"./MultiSelectField-60LuLhWg.js";import{S as W}from"./SidePanelFormButtons-BFlViY8c.js";import{N}from"./NoData-UXVxwgLt.js";import{u as G,h as C}from"./usePageParams-iyOWMaH2.js";import{T as J}from"./TableFilterChips-BIIQiaEm.js";import{H as X}from"./HeaderWithSearch-DtfezJ1H.js";function A(){const s=w(),n=Y(),o=H(),m=(i,b={})=>L({queryKey:["administrators"],queryFn:()=>n.get("GetAdministrators"),...b}),p=j({mutationFn:i=>n.get("InviteAdministrator",{params:i}),onSuccess:()=>s.invalidateQueries({queryKey:["invitations"]})}),h=j({mutationFn:i=>n.get("DisableAdministrator",{params:i}),onSuccess:()=>s.invalidateQueries({queryKey:["administrators"]})}),v=j({mutationFn:({id:i,...b})=>o.put(`administrators/${i}`,b),onSuccess:()=>Promise.all([s.invalidateQueries({queryKey:["administrators"]}),s.invalidateQueries({queryKey:["roles"]})])}),c=(i,b={})=>L({queryKey:["invitations",i],queryFn:()=>o.get("/invitations",{params:i}),...b}),r=j({mutationFn:i=>o.delete(`/invitations/${i.id}`),onSuccess:()=>s.invalidateQueries({queryKey:["invitations"]})}),u=j({mutationFn:i=>o.post(`/invitations/${i.id}`),onSuccess:()=>s.invalidateQueries({queryKey:["invitations"]})});return{getAdministratorsQuery:m,inviteAdministratorQuery:p,disableAdministratorQuery:h,editAdministratorQuery:v,getInvitationsQuery:c,revokeInvitationQuery:r,resendInvitationQuery:u}}const Z=({administrator:s})=>{const[n,o]=g.useState(s);g.useEffect(()=>{o(s)},[s]);const{notify:m}=k(),p=I(),{disableAdministratorQuery:h,editAdministratorQuery:v}=A(),{getRolesQuery:c}=$(),{data:r}=c(),u=(r==null?void 0:r.data.map(({name:a})=>({label:a,value:a})))??[],{mutateAsync:i}=v,{mutateAsync:b,isPending:f}=h,y=async()=>{try{await b({email:n.email})}catch(a){p(a)}},l=async a=>{try{await i({id:s.id,roles:a.roles}),o(x=>({...x,roles:a.roles})),m.success({title:"Permission changes have been queued",message:`You changed ${n.name}'s roles`})}catch(x){p(x)}},t=T({initialValues:{roles:[]},validationSchema:Q().shape({roles:E().of(M()).min(1,"At least one role is required")}),onSubmit:l});return g.useEffect(()=>{t.setValues({roles:n.roles})},[n]),e.jsxs(d.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:[e.jsxs(d.ConfirmationButton,{type:"button",className:"has-icon",confirmationModalProps:{title:"Disable Administrator",children:e.jsx("p",{children:"This will remove the administrator from your Landscape organisation."}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:f,confirmButtonLoading:f,onConfirm:y},children:[e.jsx(d.Icon,{name:d.ICONS.delete,"aria-hidden":"true"}),e.jsx("span",{children:"Remove"})]}),e.jsxs(d.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(d.Col,{size:6,children:e.jsx(_,{label:"Name",value:n.name})}),e.jsx(d.Col,{size:6,children:e.jsx(_,{label:"Email",value:n.email})}),e.jsx(d.Col,{size:12,children:e.jsx(_,{label:"Timezone",value:e.jsx(N,{})})}),e.jsx(d.Col,{size:12,children:e.jsx(_,{label:"Identity URL",value:e.jsx(N,{})})})]}),e.jsx(q,{variant:"condensed",label:"Roles",items:u,selectedItems:u.filter(({value:a})=>t.values.roles.includes(a)),placeholder:"Select roles",onItemsUpdate:a=>t.setFieldValue("roles",a.map(({value:x})=>x)),error:t.touched.roles&&typeof t.errors.roles=="string"?t.errors.roles:void 0}),e.jsx(W,{submitButtonDisabled:t.isSubmitting||t.values.roles.length===n.roles.length&&t.values.roles.every(a=>n.roles.includes(a)),submitButtonText:"Save changes"})]})},ee="_footer_nfyyh_1",te="_multiSelect_nfyyh_7",R={footer:ee,multiSelect:te},se=({administrator:s,roleOptions:n})=>{const o=I(),{notify:m}=k(),{editAdministratorQuery:p}=A(),{mutateAsync:h}=p,v=async({roles:r})=>{try{await h({id:s.id,roles:r}),m.success({title:"Permission changes have been queued",message:`You changed ${s.name}'s roles`})}catch(u){o(u)}},c=T({initialValues:{roles:[]},validationSchema:Q().shape({roles:E().of(M()).min(1,"At least one role is required")}),onSubmit:v});return g.useEffect(()=>{c.setValues({roles:s.roles})},[s.roles]),e.jsx(d.Form,{onSubmit:c.handleSubmit,noValidate:!0,children:e.jsx(q,{required:!0,variant:"condensed",className:R.multiSelect,items:n,selectedItems:n.filter(({value:r})=>c.values.roles.includes(r)),onItemsUpdate:r=>c.setValues({roles:r.map(({value:u})=>u)}),placeholder:"Select roles",error:c.touched.roles&&typeof c.errors.roles=="string"?c.errors.roles:void 0,dropdownFooter:e.jsxs("div",{className:R.footer,children:[e.jsx(d.Button,{type:"button",dense:!0,small:!0,className:"u-no-margin--bottom",disabled:c.values.roles.length===s.roles.length&&s.roles.every(r=>c.values.roles.includes(r)),onClick:()=>c.setFieldValue("roles",s.roles),children:"Revert"}),e.jsx(d.Button,{type:"submit",dense:!0,small:!0,appearance:"positive",className:"u-no-margin--bottom",disabled:c.values.roles.length===s.roles.length&&s.roles.every(r=>c.values.roles.includes(r)),children:"Save changes"})]})})})},ne="_roles_1cuab_1",ie="_actions_1cuab_2",ae="_table_1cuab_6",P={roles:ne,actions:ie,table:ae},oe=({administrators:s,emptyMessage:n,roles:o})=>{const m=I(),{setSidePanelContent:p}=F(),{disableAdministratorQuery:h}=A(),{mutateAsync:v,isPending:c}=h,r=g.useMemo(()=>s,[s]),u=g.useMemo(()=>o.map(({name:l})=>({label:l,value:l})),[o]),i=async l=>{try{await v({email:l})}catch(t){m(t)}},b=l=>{p(l.name,e.jsx(Z,{administrator:l}))},f=g.useMemo(()=>[{accessor:"name",Header:"Name",Cell:({row:l})=>e.jsx(d.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{b(l.original)},children:l.original.name})},{accessor:"email",Header:"Email"},{accessor:"roles",className:P.roles,Header:"Roles",Cell:({row:l})=>e.jsx(se,{administrator:l.original,roleOptions:u})},{accessor:"actions",className:P.actions,Cell:({row:l})=>e.jsx(d.ConfirmationButton,{className:"u-no-margin--bottom u-no-padding--left is-small has-icon",type:"button",appearance:"base","aria-label":`Remove ${l.original.name}`,confirmationModalProps:{title:`Remove ${l.original.name}`,children:e.jsx("p",{children:"This will remove the administrator from your Landscape organisation."}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:c,confirmButtonLoading:c,onConfirm:()=>i(l.original.email)},children:e.jsx(d.Tooltip,{position:"top-center",message:"Remove",children:e.jsx(d.Icon,{name:d.ICONS.delete,className:"u-no-margin--left u-no-padding"})})})}],[r,u]),y=l=>{const t={};return l.column.id==="name"?t.role="rowheader":l.column.id==="email"?t["aria-label"]="Email":l.column.id==="roles"?t["aria-label"]="Roles":l.column.id==="actions"&&(t["aria-label"]="Actions"),t};return e.jsx(d.ModularTable,{columns:f,data:r,getCellProps:y,emptyMsg:n,className:P.table})},re=()=>e.jsxs(e.Fragment,{children:[e.jsx(X,{}),e.jsx(J,{filtersToDisplay:["search"]})]}),le=({administrators:s})=>{const{search:n,pageSize:o,currentPage:m}=G(),{getRolesQuery:p}=$(),{data:h}=p(),c=(()=>{const u=n.trim().toLowerCase();return u?s.filter(i=>i.email.toLowerCase().includes(u)||i.name.toLowerCase().includes(u)||i.roles.some(b=>b.toLowerCase().includes(u))):s})(),r=c.filter((u,i)=>i>=(m-1)*o&&i<m*o)??[];return e.jsxs(e.Fragment,{children:[e.jsx(re,{}),e.jsx(oe,{administrators:r,emptyMessage:n.trim()?`No administrators found with the search: "${n.trim()}"`:"You have no administrators on your Landscape organisation",roles:(h==null?void 0:h.data)??[]}),r.length>0&&e.jsx(U,{totalItems:c.length,currentItemCount:r.length})]})},ce=g.lazy(()=>D(()=>import("./index-DWQWYwKb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))),de=()=>{const{setSidePanelContent:s}=F(),{getAdministratorsQuery:n}=A(),{data:o,isLoading:m}=n(),p=()=>{s("Invite administrator",e.jsx(g.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(ce,{})}))};return e.jsxs(e.Fragment,{children:[m&&e.jsx(S,{}),!m&&(!o||!o.data.length)&&e.jsx(V,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no administrators in your Landscape organization."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[e.jsx(d.Button,{type:"button",appearance:"positive",onClick:p,children:"Invite Administrator"},"invite-administrator")],icon:"user",title:"No administrators found"}),!m&&o&&o.data.length>0&&e.jsx(le,{administrators:o.data})]})},me=()=>{const s=I(),{notify:n}=k(),{getInvitationsQuery:o,revokeInvitationQuery:m,resendInvitationQuery:p}=A(),{data:h}=o(),v=g.useMemo(()=>(h==null?void 0:h.data.results.sort((t,a)=>C(a.creation_time).diff(C(t.creation_time))))??[],[h]),{mutateAsync:c,isPending:r}=m,{mutateAsync:u,isPending:i}=p,b=async t=>{try{await c({id:t.id}),n.success({message:`${t.name}â€™${t.name.endsWith("s")?"":"s"} invitation has been revoked`,title:"You revoked an administrator invite"})}catch(a){s(a)}},f=async t=>{try{await u({id:t.id}),n.success({message:`${t.name} will receive a new invitation email`,title:"You resent an administrator invite"})}catch(a){s(a)}},y=g.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"email",Header:"Email"},{accessor:"creation_time",Header:"Invited",Cell:({row:t})=>C(t.original.creation_time).format(B)},{accessor:"expiration_time",Header:"Expires",Cell:({row:t})=>C(t.original.creation_time).add(14,"days").format(B)},{accessor:"actions",Cell:({row:t})=>e.jsxs("div",{className:"u-align-text--right",children:[e.jsx(d.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Revoke invitation for ${t.original.name}`,children:e.jsxs("p",{children:["This action will prevent ",t.original.name," from joining your Landscape organisation."]}),confirmButtonLabel:"Revoke invitation",confirmButtonAppearance:"negative",confirmButtonDisabled:r,confirmButtonLoading:r,onConfirm:()=>b(t.original)},children:"Revoke"}),e.jsx(d.ConfirmationButton,{className:"u-no-margin--bottom is-small is-dense",type:"button",confirmationModalProps:{title:`Resend invitation for ${t.original.name}`,children:e.jsxs("p",{children:[t.original.name," will receive a new invitation email."]}),confirmButtonLabel:"Resend invitation",confirmButtonAppearance:"positive",confirmButtonDisabled:i,confirmButtonLoading:i,onConfirm:()=>f(t.original)},children:"Resend"})]})}],[v]),l=t=>{const a={};return t.column.id==="name"?a.role="rowheader":t.column.id==="email"?a["aria-label"]="Email":t.column.id==="creation_time"?a["aria-label"]="Invited":t.column.id==="expiration_time"?a["aria-label"]="Expires":t.column.id==="actions"&&(a["aria-label"]="Actions"),a};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-text--muted p-text--small",children:"Unclaimed invitations expire after 14 days."}),e.jsx(d.ModularTable,{columns:y,data:v,getCellProps:l,emptyMsg:"You have no unclaimed invitations."})]})},ue="_tabPanel_1n8p7_1",he={tabPanel:ue},ge=[{label:"Administrators",id:"tab-link-administrators"},{label:"Invites",id:"tab-link-invites"}],pe=()=>{const[s,n]=g.useState("tab-link-administrators");return e.jsxs(e.Fragment,{children:[e.jsx(d.Tabs,{listClassName:"u-no-margin--bottom",links:ge.map(({label:o,id:m})=>({label:o,id:m,role:"tab",active:m===s,onClick:()=>n(m)}))}),e.jsx("div",{tabIndex:0,role:"tabpanel","aria-labelledby":s,className:he.tabPanel,children:e.jsxs(g.Suspense,{fallback:e.jsx(S,{}),children:[s==="tab-link-administrators"&&e.jsx(de,{}),s==="tab-link-invites"&&e.jsx(me,{})]})})]})},be=g.lazy(()=>D(()=>import("./index-DWQWYwKb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))),ve=()=>{const{setSidePanelContent:s}=F(),n=()=>{s("Invite administrator",e.jsx(g.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(be,{})}))};return e.jsxs(z,{children:[e.jsx(O,{title:"Administrators",actions:[e.jsx(d.Button,{type:"button",onClick:n,children:"Invite administrator"},"invite-administrator")]}),e.jsx(K,{children:e.jsx(pe,{})})]})},Fe=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{Fe as i,A as u};
