import{r as j,j as s,g,d as I,c as P,k as y,l as k,e as C,h as N,o as S}from"./index-DXs1haZl.js";import{E as F}from"./EmptyState-BYL1pVz2.js";import"./TablePagination.module-DLVph1Z1.js";import{T as H}from"./TablePagination-DZ07rvb4.js";import{u as f}from"./useMutation-CoMMCR6r.js";import{u as E}from"./useQuery-DPA9mHwu.js";import{u as _}from"./usePageParams-BJqFm8Ol.js";import{H as Q}from"./HeaderWithSearch-OzYSSkOw.js";import"./HeaderWithSearch.module-ByXjIdeN.js";const M=({processes:t,selectedPids:n,setSelectedPids:c})=>{const i=()=>{c(n.length===0?t.map(({pid:e})=>e):[])},r=j.useMemo(()=>[{accessor:"name",Header:s.jsxs(s.Fragment,{children:[s.jsx(g.CheckboxInput,{inline:!0,label:s.jsx("span",{className:"u-off-screen",children:"Toggle all processes"}),checked:n.length>0&&n.length===t.length,disabled:t.length===0,onChange:i,indeterminate:n.length>0&&n.length<t.length}),s.jsx("span",{children:"Command"})]}),Cell:({row:e})=>s.jsxs(s.Fragment,{children:[s.jsx(g.CheckboxInput,{inline:!0,label:s.jsx("span",{className:"u-off-screen",children:`Select process ${e.original.name}`}),checked:n.includes(e.original.pid),onChange:()=>{c(n.includes(e.original.pid)?n.filter(o=>o!==e.original.pid):[...n,e.original.pid])}}),s.jsx("span",{children:e.original.name})]})},{accessor:"state",Header:"State"},{accessor:"vm_size",Header:"VM size"},{accessor:"cpu_utilization",Header:"CPU (%)",Cell:({row:e})=>s.jsxs(s.Fragment,{children:[(100*e.original.cpu_utilisation).toFixed(1),"%"]})},{accessor:"pid",Header:"PID"},{accessor:"start_time",Header:"Started at"},{accessor:"gid",Header:"Group"}],[t,n]);return s.jsx(g.ModularTable,{columns:r,data:t,emptyMsg:"No processes found"})},b=()=>{const t=I(),n=P(),c=(e,o={})=>{const{computer_id:m,...u}=e;return E({queryKey:["processes",e],queryFn:()=>t.get(`/computers/${m}/processes`,{params:u}),...o})},i=f({mutationFn:e=>t.post("processes/terminate",e),onSuccess:()=>{n.invalidateQueries(["processes"])}}),r=f({mutationFn:e=>t.post("processes/kill",e),onSuccess:()=>{n.invalidateQueries(["processes"])}});return{getProcessesQuery:c,killProcessQuery:r,terminateProcessQuery:i}},v="_actions_1l3g0_1",$={actions:v},z=({selectedPids:t,handleClearSelection:n})=>{const{instanceId:c}=y(),{setPageParams:i}=_(),{notify:r}=k(),e=C(),{killProcessQuery:o,terminateProcessQuery:m}=b(),u=Number(c),{mutateAsync:a}=m,{mutateAsync:d}=o,x=l=>{i({search:l}),n()},p=async()=>{try{await a({pids:t,computer_id:u}),r.success({message:`${t.length===1?"Process":"Processes"} successfully ended`}),n()}catch(l){e(l)}},h=async()=>{try{await d({pids:t,computer_id:u}),r.success({message:`${t.length===1?"Process":"Processes"} successfully killed`}),n()}catch(l){e(l)}};return s.jsx(Q,{onSearch:x,actions:s.jsx("div",{className:N("p-segmented-control",$.actions),children:s.jsxs("div",{className:"p-segmented-control__list",children:[s.jsx(g.Button,{className:"p-segmented-control__button",disabled:t.length===0,onClick:p,children:"End process"}),s.jsx(g.Button,{className:"p-segmented-control__button",disabled:t.length===0,onClick:h,children:"Kill process"})]})})})},T=()=>{const[t,n]=j.useState([]),{instanceId:c,childInstanceId:i}=y(),{search:r,currentPage:e,pageSize:o}=_(),{getProcessesQuery:m}=b(),u=Number(i??c),{data:a,isLoading:d}=m({computer_id:u,limit:o,offset:(e-1)*o,search:r}),x=(a==null?void 0:a.data.count)??0,p=j.useMemo(()=>(a==null?void 0:a.data.results)??[],[a]),h=()=>{n([])};return s.jsxs(s.Fragment,{children:[!r&&d&&s.jsx(S,{}),!d&&!r&&(!a||a.data.results.length===0)&&s.jsx(F,{icon:"connected",title:"No processes running"}),(r||!d&&a&&a.data.results.length>0)&&s.jsxs(s.Fragment,{children:[s.jsx(z,{handleClearSelection:h,selectedPids:t}),s.jsx(M,{processes:p,setSelectedPids:l=>n(l),selectedPids:t})]}),s.jsx(H,{handleClearSelection:h,totalItems:x,currentItemCount:p.length})]})},W=T;export{W as default};
