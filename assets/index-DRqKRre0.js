import{f as b,e as S,r as m,j as t,h as e,n as y,D as x,o as h,E as f,I as o,L as v,g as C}from"./index-vDh6p1re.js";import{S as k}from"./SidePanelFormButtons-CrzoUcfJ.js";import{a as _,b as N}from"./index-CS00h_Ig.js";import{h as j}from"./usePageParams-C-pi3Kin.js";import{S as A}from"./SidePanelTablePagination-IeAfxzKG.js";import{N as p}from"./NoData-ClqjzLea.js";import{b as I}from"./ScriptsTabs-qWvYCBab.js";import{u as T}from"./useRoles-Cobv-tGH.js";import"./index-CCmNm2LP.js";import{g as P,a as w}from"./index-DrKQVYYm.js";import"./SidePanelFormButtons.module-D2P5PizG.js";import"./TablePagination-s2q42wYR.js";import"./TablePaginationBase-eH-xceTk.js";import"./StatusFilter-kNfNcZ7x.js";import"./TableFilter-D9jMhOmC.js";import"./TableFilterChips-BgTfFgZ3.js";import"./useFetchOld-Dh4_z9Or.js";import"./TruncatedCell-BRtEnS33.js";import"./HeaderWithSearch-DZAyAsgS.js";import"./SingleInstanceTabs.module-Cm1BYFZQ.js";const L=({id:s,...a})=>{const n=b(),{data:i,isLoading:c}=S({queryKey:["scriptProfileActivities",{id:s,...a}],queryFn:async()=>n.get(`script-profiles/${s}/activities`,{params:a})});return{activities:(i==null?void 0:i.data.results)??[],activitiesCount:i==null?void 0:i.data.count,isGettingActivities:c}},z="_link_1wvsk_1",B={link:z},E=({activities:s,viewActivityDetails:a})=>{const n=m.useMemo(()=>[{Header:"Run",Cell:({row:{original:i}})=>t.jsxs(e.Button,{type:"button",appearance:"link",className:y("u-no-margin u-no-padding--top",B.link),onClick:()=>{a(i)},children:[j(i.creation_time).utc().format(x)," "]})},{Header:"Status",Cell:({row:{original:i}})=>_[i.activity_status].label,getCellIcon:({row:{original:i}})=>_[i.activity_status].icon}],[s]);return t.jsx(e.ModularTable,{columns:n,data:s})},R=({profile:s,viewActivityDetails:a})=>{const[n,i]=m.useState(1),[c,l]=m.useState(20),{activities:d,activitiesCount:u,isGettingActivities:r}=L({id:s.id,limit:c,offset:(n-1)*c});return r?t.jsx(h,{}):d.length?t.jsxs(t.Fragment,{children:[t.jsx(E,{activities:d,viewActivityDetails:a}),t.jsx(A,{currentPage:n,pageSize:c,paginate:i,setPageSize:l,totalItems:u})]}):t.jsx(f,{title:"No runs found",body:"The profile has not run yet."})},F=({actions:s,profile:a})=>a.archived?t.jsxs(e.Notification,{inline:!0,title:"Profile archived:",severity:"caution",children:["The profile was archived on"," ",j(a.last_edited_at).format(x),"."]}):t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[t.jsxs(e.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:s.edit,children:[t.jsx(e.Icon,{name:"edit"}),t.jsx("span",{children:"Edit"})]}),t.jsxs(e.Button,{className:"p-segmented-control__button",type:"button",hasIcon:!0,onClick:s.archive,children:[t.jsx(e.Icon,{name:"archive"}),t.jsx("span",{children:"Archive"})]})]})}),D="_link_1wvsk_1",$={link:D},G=({profile:s,viewActivityDetails:a})=>{const{script:n,isScriptLoading:i}=I(s.script_id),{getAccessGroupQuery:c}=T(),{data:l,isLoading:d}=c();if(i||d)return t.jsx(h,{});const u=l==null?void 0:l.data.find(g=>g.name==s.access_group);if(!n||!u)throw new Error;const r=s.activities.last_activity;return t.jsxs(t.Fragment,{children:[t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Name",value:s.title})}),t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Status",value:P(s)})})]}),t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Script",value:t.jsx(v,{className:$.link,to:"/scripts?tab=scripts",state:{scriptId:n.id},children:n.title})})}),t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Access group",value:u.title})})]}),t.jsxs(e.Row,{className:"u-no-padding",children:[t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Run as user",value:s.username})}),t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Time limit",value:`${s.time_limit}s`})})]}),t.jsx("hr",{}),t.jsx(o,{label:"Trigger",value:w(s)}),t.jsxs(e.Row,{className:"u-no-padding",children:[s.trigger.trigger_type!="event"&&t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Next run",value:s.trigger.next_run?`${j(s.trigger.next_run).utc().format(x)}`:t.jsx(p,{})})}),t.jsx(e.Col,{size:6,children:t.jsx(o,{label:"Last run",value:r?t.jsxs(e.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top",onClick:()=>{a(r)},children:[j(r.creation_time).utc().format(x)," "]}):t.jsx(p,{})})})]}),t.jsx("hr",{}),t.jsx("p",{className:"p-heading--5",children:"Association"}),t.jsx(e.Row,{className:"u-no-padding",children:t.jsx(o,{label:"Associated instances",value:s.computers.num_associated_computers?t.jsxs(v,{to:{pathname:"/instances",search:`?tags=${s.tags.join("%2C")}`},children:[s.computers.num_associated_computers," instances"]}):t.jsx(p,{})})}),t.jsx(e.Row,{className:"u-no-padding",children:t.jsx(o,{label:"Tags",value:s.all_computers?"All instances":s.tags.join(", ")||t.jsx(p,{})})})]})},rt=({actions:s,profile:a})=>{const{setSidePanelContent:n}=C(),[i,c]=m.useState("info"),l=r=>{n(`${a.title} - ${j(r.creation_time).format(x)}`,t.jsx(m.Suspense,{fallback:t.jsx(h,{}),children:t.jsxs(t.Fragment,{children:[t.jsx(N,{activityId:r.id}),t.jsx(k,{hasActionButtons:!1,hasBackButton:!0,onBackButtonPress:s.viewDetails})]})}))},u=[{label:"Info",id:"info"},{label:"Activity history",id:"activity-history"}].map(({label:r,id:g})=>({label:r,active:i==g,onClick:()=>{c(g)}}));return t.jsxs(t.Fragment,{children:[t.jsx(F,{actions:s,profile:a}),t.jsx(e.Tabs,{listClassName:"u-no-margin--bottom",links:u}),i=="info"&&t.jsx(G,{profile:a,viewActivityDetails:l}),i=="activity-history"&&t.jsx(R,{profile:a,viewActivityDetails:l})]})};export{rt as default};
