import{k as j,v as S,i as N,w as I,l as k,j as e,h as r}from"./index-ChpBdI_6.js";import{I as m}from"./InfoItem-Cy9nbWuf.js";import{u as T}from"./index-BRB2eHdL.js";import{h as A}from"./moment-C5S46NFB.js";import{u as C}from"./index-BQ2NCB5f.js";import{N as E,U as F,a as P}from"./constants-Dwl1JGyb.js";import{K as R}from"./constants-Bpc7tdJb.js";import"./moment-Bybp3Fm7.js";import"./TablePagination-CADMgw0I.js";import"./TablePagination.module-CgQ3jx4B.js";import"./usePageParams-DipFd9G4.js";import"./SearchHelpPopup-CsKlgMQM.js";import"./useFetchOld-BEyeLqBi.js";import"./NoData-YwuUR19A.js";import"./PageMain-DJCG_GD-.js";import"./useUsns-BLRD2Bmf.js";import"./useInstances-CtHMA3X1.js";const B="_radioGroup_1yu2c_1",O="_marginTop_1yu2c_6",l={radioGroup:B,marginTop:O},ee=({currentKernelVersion:c,upgradeKernelVersions:o,instanceName:u})=>{const p=j(),{instanceId:_}=S(),{closeSidePanel:s}=N(),{notify:v}=I(),{upgradeKernelQuery:y}=C(),{openActivityDetails:f}=T(),{mutateAsync:h,isPending:n}=y,g=[{label:"Select",value:""},...o.map(a=>({label:a.version_rounded,value:a.id.toString()}))],b={deliver_immediately:!0,randomize_delivery:!1,deliver_delay_window:0,deliver_after:"",new_kernel_version_id:o.length===1?o[0].id.toString():"",reboot_after:!1},i=k({initialValues:b,validationSchema:R,onSubmit:async a=>{try{const{data:t}=await h({id:Number(_),kernel_package_id:Number(a.new_kernel_version_id),reboot_after:a.reboot_after});s();const x=a.reboot_after?F:P;v.success({title:`You queued kernel upgrade for "${u}"`,message:x,actions:[{label:"View details",onClick:()=>f(t)}]})}catch(t){p(t)}}}),d=async a=>{const t=a.currentTarget.value==="true";await i.setFieldValue("deliver_immediately",t),t||await i.setFieldValue("deliver_after",A().toISOString().slice(0,16))},w=async()=>{await i.setFieldValue("reboot_after",!0),i.handleSubmit()};return e.jsxs(r.Form,{onSubmit:i.handleSubmit,children:[e.jsx(r.Notification,{severity:"information",title:"Restart recommended",children:e.jsx("span",{children:E})}),e.jsxs(r.Row,{className:"u-no-padding--left u-no-padding--right",children:[e.jsx(r.Col,{size:6,children:e.jsx(m,{label:"current version",value:c})}),e.jsx(r.Col,{size:6,children:e.jsx(m,{label:"new version",value:o.length===1?e.jsx("span",{children:o[0].version_rounded}):e.jsx(r.Select,{options:g,...i.getFieldProps("new_kernel_version")})})})]}),e.jsx("strong",{className:l.marginTop,children:"Delivery time"}),e.jsxs("div",{className:l.radioGroup,children:[e.jsx(r.Input,{type:"radio",label:"As soon as possible",name:"deliver_immediately",value:"true",onChange:d,checked:i.values.deliver_immediately}),e.jsx(r.Input,{type:"radio",label:"Scheduled",name:"deliver_immediately",value:"false",onChange:d,checked:!i.values.deliver_immediately})]}),!i.values.deliver_immediately&&e.jsx(r.Input,{type:"datetime-local",label:"Deliver after",labelClassName:"u-off-screen",...i.getFieldProps("deliver_after"),error:i.touched.deliver_after&&i.errors.deliver_after}),e.jsx("strong",{className:l.marginTop,children:"Randomise delivery over a time window"}),e.jsxs("div",{className:l.radioGroup,children:[e.jsx(r.Input,{type:"radio",label:"No",...i.getFieldProps("randomize_delivery"),onChange:async()=>{await i.setFieldValue("randomize_delivery",!1),await i.setFieldValue("deliver_delay_window",0)},checked:!i.values.randomize_delivery}),e.jsx(r.Input,{type:"radio",label:"Yes",...i.getFieldProps("randomize_delivery"),onChange:async()=>await i.setFieldValue("randomize_delivery",!0),checked:i.values.randomize_delivery})]}),i.values.randomize_delivery&&e.jsx(r.Input,{type:"number",inputMode:"numeric",min:0,label:"Delivery delay window",labelClassName:"u-off-screen",help:"Time in minutes",...i.getFieldProps("deliver_delay_window"),error:i.touched.deliver_delay_window&&i.errors.deliver_delay_window?i.errors.deliver_delay_window:void 0}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(r.Button,{type:"button",appearance:"base",onClick:s,children:"Cancel"}),e.jsx(r.ConfirmationButton,{type:"button",confirmationModalProps:{title:"Upgrading kernel and restarting instance",children:e.jsx("p",{children:"Are you sure? This action will upgrade the kernel and restart the instance."}),confirmButtonLabel:"Upgrade and Restart",confirmButtonAppearance:"positive",confirmButtonLoading:n,confirmButtonDisabled:n,onConfirm:w},children:"Upgrade and Restart"}),e.jsx(r.ConfirmationButton,{type:"button",appearance:"positive",confirmationModalProps:{title:"Upgrading kernel",children:e.jsx("p",{children:"Are you sure? This action will upgrade the kernel."}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:n,confirmButtonDisabled:n,type:"submit",onConfirm:()=>i.handleSubmit()},children:"Upgrade kernel"})]})]})};export{ee as default};
