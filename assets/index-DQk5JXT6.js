import{j as t,r as u,m as z,d as n,B as T,C as $,a as k,a2 as E,aC as N,aq as w,a8 as m,ai as L,L as R,E as P,I as o,N as D}from"./index-gc_gETRV.js";import{D as M,A as O,g as B}from"./EmployeeList-DITdIOZ7.js";import{g as p}from"./InstancesPageActions-BjC5YnQo.js";import{u as H}from"./useInstances-HAzsZPHe.js";import"./ResponsiveButtons-CkY3WafE.js";const V=e=>e.employee.is_active?t.jsx(M,{...e}):t.jsx(O,{...e}),Y=({employee:e})=>{const[i,a]=u.useState(!1),{closeSidePanel:s}=z(),c=()=>{a(!0)},d=()=>{a(!1),s()};return t.jsxs("div",{children:[t.jsxs(n.Button,{hasIcon:!0,onClick:c,children:[t.jsx(n.Icon,{name:e.is_active?"pause":"play"}),t.jsx("span",{children:e.is_active?"Deactivate":"Activate"})]}),i&&t.jsx(V,{employee:e,handleClose:d})]})},q=({instance:e})=>{const[i,a]=u.useState(""),s=T(),{notify:c}=$(),d=k(),{openActivityDetails:h}=E(),{removeInstancesQuery:g,sanitizeInstanceQuery:x}=H(),{mutateAsync:y,isPending:b}=g,{mutateAsync:j,isPending:C}=x,r=()=>{a("")},A=async()=>{try{const{data:l}=await j({computer_id:e.id,computer_title:e.title});c.success({title:`You have successfully initiated Sanitization for ${e.title}`,message:`Sanitizing for ${e.title} has been queued in Activities. The data will be permanently irrecoverable once complete.`,actions:[{label:"View details",onClick:()=>{h(l)}}]})}catch(l){s(l)}finally{r()}},S=async()=>{try{await y({computer_ids:[e.id]}),c.success({title:`You have successfully removed ${e.title}`,message:`${e.title} has been removed from Landscape. To manage it again, you will need to re-register it in Landscape.`})}catch(l){s(l)}finally{r()}},_=[{icon:"machines",label:"View details","aria-label":`View ${e.title} instance details`,onClick:async()=>d(`${N}instances/${e.id}`)}],I=[{icon:"tidy",label:"Sanitize","aria-label":`Sanitize ${e.title} instance`,onClick:()=>{a("sanitize")}},{icon:n.ICONS.delete,label:"Remove from Landscape","aria-label":"Remove from Landscape",onClick:()=>{a("remove")}}];return t.jsxs(t.Fragment,{children:[t.jsx(w,{toggleAriaLabel:`${e.title} profile actions`,actions:_,destructiveActions:I}),t.jsx(m,{isOpen:i==="remove",title:`Remove ${e.title} instance`,confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:b,onConfirm:S,close:r,confirmationText:`remove ${e.title}`,children:t.jsxs("p",{children:["Removing this ",e.title," will delete all associated data and free up one license slot for another computer to be registered."]})}),t.jsx(m,{isOpen:i==="sanitize",title:`Sanitize "${e.title}" instance`,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:C,onConfirm:A,close:r,confirmationText:`sanitize ${e.title}`,children:t.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",e.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})},v={title:"No instances found",body:"There are no instances associated with this employee."},F="_container_nv9rn_1",Q="_link_nv9rn_7",f={container:F,link:Q},U=()=>({column:e})=>{const i={};return e.id==="name"?i.role="rowheader":e.id==="status"?i["aria-label"]="Status":e.id==="recovery_key"?i["aria-label"]="Recovery key":e.id==="actions"&&(i["aria-label"]="Actions"),i},G=({instances:e})=>{const i=u.useMemo(()=>[{accessor:"name",Header:"name",Cell:({row:a})=>t.jsx(R,{className:f.link,to:a.original.parent?`/instances/${a.original.parent.id}/${a.original.id}`:`/instances/${a.original.id}`,children:a.original.title})},{accessor:"status",Header:"status",Cell:({row:{original:a}})=>{const{label:s}=p(a);return s},getCellIcon:({row:{original:a}})=>{const{icon:s}=p(a);return s}},{accessor:"recovery_key",Header:"recovery key",Cell:()=>"****************"},{...L,Cell:({row:{original:a}})=>t.jsx(q,{instance:a})}],[e]);return t.jsxs("div",{className:f.container,children:[t.jsx("h4",{className:"p-heading--5",children:"Instances associated"}),e&&e.length>0?t.jsx(n.ModularTable,{data:e,columns:i,getCellProps:U()}):t.jsx(P,{title:v.title,body:v.body})]})},ee=({employee:e})=>{var i,a;return t.jsxs(t.Fragment,{children:[t.jsx(Y,{employee:e}),t.jsxs(n.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(n.Col,{size:6,children:t.jsx(o,{label:"name",value:e.name})}),t.jsx(n.Col,{size:6,children:t.jsx(o,{label:"email",value:e.email})})]}),t.jsxs(n.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(n.Col,{size:6,children:t.jsx(o,{label:"employee groups",value:((a=(i=e.groups)==null?void 0:i.map(s=>s.name))==null?void 0:a.join(", "))||"N/A",type:"truncated"})}),t.jsx(n.Col,{size:6,children:t.jsx(o,{label:"status",value:B(e)})})]}),t.jsx(o,{label:"autoinstall file",value:e.autoinstall_file?`${e.autoinstall_file.filename}, v${e.autoinstall_file.version}`:t.jsx(D,{})}),t.jsx(G,{instances:e.computers})]})};export{ee as default};
