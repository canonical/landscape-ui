const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DTezVAII.js","assets/index-BMhnQnvO.js","assets/index-BPqj2aAr.css","assets/formik.esm-CIbWtvkk.js","assets/SidePanelFormButtons-Sm5GAIF2.js","assets/SidePanelFormButtons.module-D1MffuBu.js","assets/SidePanelFormButtons-5RbWRdTr.css","assets/AssociationBlock-BW5vwt-w.js","assets/MultiSelectField-DwiNKGgx.js","assets/MultiSelectField-B2rqRhX9.css","assets/useInstances-CmnK8qSQ.js","assets/useFetchOld-Cff5y19B.js","assets/useMutation-Diy-BhWO.js","assets/useQuery-Dxk6aJEc.js","assets/AssociationBlock-Cb2Mr2ww.css","assets/useAPTSources-DI9crB1K.js","assets/useDistributions-O4ngGji2.js","assets/useRoles-CVnIP7R8.js","assets/index.esm-Cg6cKhK8.js","assets/tests-DFnZqbNV.js","assets/index-Cbgi0rQx.css"])))=>i.map(i=>d[i]);
import{c as A,d as F,e as j,r as u,_ as x,f as _,j as e,g as r,k as g}from"./index-BMhnQnvO.js";import{E as Q}from"./EmptyState-ClMN1u86.js";import{P as D,a as N,b as M}from"./PageMain-Do4tk6tv.js";import{u as $}from"./useFetchOld-Cff5y19B.js";import{u as y}from"./useMutation-Diy-BhWO.js";import{u as O}from"./useQuery-Dxk6aJEc.js";import"./index.esm-Cg6cKhK8.js";import{u as T}from"./useConfirm-DBWWlNvT.js";import{u as w}from"./useRoles-CVnIP7R8.js";function v(){const o=A(),t=F(),n=$(),l=j(),c=(a={},d={})=>O({queryKey:["repositoryProfiles",a],queryFn:()=>t.get("repositoryprofiles",{params:a}),...d}),p=y({mutationFn:a=>t.post("repositoryprofiles",a),onSuccess:()=>o.invalidateQueries(["repositoryProfiles"])}),m=y({mutationFn:({name:a,...d})=>t.put(`repositoryprofiles/${a}`,d),onSuccess:()=>o.invalidateQueries(["repositoryProfiles"])}),f=y({mutationKey:["repositoryProfiles"],mutationFn:a=>n.get("RemoveRepositoryProfile",{params:a}),onSuccess:()=>{o.invalidateQueries(["repositoryProfiles"]).catch(l)}});return{getRepositoryProfilesQuery:c,createRepositoryProfileQuery:p,editRepositoryProfileQuery:m,removeRepositoryProfileQuery:f}}const I=({column:o})=>{const t={};return o.id==="title"?t.role="rowheader":o.id==="description"?t["aria-label"]="Description":o.id==="access_group"?t["aria-label"]="Access group":o.id==="id"&&(t["aria-label"]="Actions"),t},L="_actions_3ja8w_1",B="_accessGroup_3ja8w_2",G="_description_3ja8w_6",b={actions:L,accessGroup:B,description:G},H=u.lazy(()=>x(()=>import("./index-DTezVAII.js").then(o=>o.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))),z=({repositoryProfiles:o})=>{const t=j(),{confirmModal:n,closeConfirmModal:l}=T(),{setSidePanelContent:c}=_(),{removeRepositoryProfileQuery:p}=v(),{mutateAsync:m,isLoading:f}=p,{getAccessGroupQuery:a}=w(),{data:d}=a(),h=((d==null?void 0:d.data)??[]).map(({name:s,title:i})=>({label:i,value:s})),R=(s,i)=>{s.currentTarget.blur(),c(`Edit ${i.title}`,e.jsx(u.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(H,{action:"edit",profile:i})}))},C=async s=>{try{await m({name:s})}catch(i){t(i)}finally{l()}},S=s=>{n({body:"Are you sure?",title:`Deleting ${s} repository profile`,buttons:[e.jsxs(r.Button,{appearance:"negative",hasIcon:!0,onClick:()=>C(s),"aria-label":`Delete ${s} repository profile`,children:[f&&e.jsx(r.Spinner,{}),"Delete"]},`delete-profile-${s}`)]})},P=u.useMemo(()=>o,[o]),k=u.useMemo(()=>[{accessor:"title",Header:"Title"},{accessor:"description",Header:"Description",className:b.description},{accessor:"access_group",Header:"Access group",className:b.accessGroup,Cell:({row:{original:s}})=>{var i;return((i=h.find(({value:E})=>s.access_group===E))==null?void 0:i.label)??s.access_group}},{accessor:"id",Cell:({row:s})=>e.jsxs("div",{className:"divided-blocks",children:[e.jsx("div",{className:"divided-blocks__item",children:e.jsx(r.Tooltip,{message:"Edit",position:"btm-center",children:e.jsx(r.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Edit ${s.original.name} repository profile`,onClick:i=>R(i,s.original),children:e.jsx("i",{className:"p-icon--edit u-no-margin--left"})})})}),e.jsx("div",{className:"divided-blocks__item",children:e.jsx(r.Tooltip,{message:"Delete",position:"btm-center",children:e.jsx(r.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Remove ${s.original.name} repository profile`,onClick:()=>S(s.original.name),children:e.jsx(r.Icon,{name:r.ICONS.delete,className:"u-no-margin--left"})})})})]})}],[P,h]);return e.jsx(r.ModularTable,{columns:k,data:P,getCellProps:I,emptyMsg:"No profiles yet."})},q=u.lazy(()=>x(()=>import("./index-DTezVAII.js").then(o=>o.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20])).then(o=>({default:o.RepositoryProfileForm}))),K=()=>{const{setSidePanelContent:o}=_(),{getRepositoryProfilesQuery:t}=v(),{data:n,isLoading:l}=t(),c=(n==null?void 0:n.data.results)??[],p=()=>{o("Add repository profile",e.jsx(u.Suspense,{fallback:e.jsx(g,{}),children:e.jsx(q,{action:"add"})}))};return e.jsxs(D,{children:[e.jsx(N,{title:"Repository Profiles",actions:[e.jsx(r.Button,{appearance:"positive",onClick:p,type:"button",children:"Add profile"},"new-key-button")]}),e.jsxs(M,{children:[l&&e.jsx(g,{}),!l&&c.length===0&&e.jsx(Q,{title:"No profiles found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You havenâ€™t added any profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/repositories",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage profiles in Landscape"})]}),cta:[e.jsx(r.Button,{appearance:"positive",onClick:p,type:"button",children:"Add profile"},"table-add-new-profile")]}),!l&&c.length>0&&e.jsx(z,{repositoryProfiles:c})]})]})},V=K,te=Object.freeze(Object.defineProperty({__proto__:null,default:V},Symbol.toStringTag,{value:"Module"}));export{z as R,te as i,v as u};
