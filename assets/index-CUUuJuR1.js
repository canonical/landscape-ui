const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DIHBco5J.js","assets/index-DN_YS9_3.js","assets/index-CMPBhKCb.css","assets/WslInstancesEmptyState-B37Gz9Hz.js","assets/GroupFilter-7D7i2dRX.js","assets/HeaderWithSearch-DzjwmQR6.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/index-CGto-yop.js","assets/TextConfirmationModal-CyrSbwDv.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/WslInstancesEmptyState-CBT5OoUG.css","assets/AssociationBlock-DvXfU5Qp.js","assets/MultiSelectField-BBnvEm8T.js","assets/MultiSelectField-GyNA33om.css","assets/useGetTags-DarKgUFs.js","assets/AssociationBlock-vsPH8fvb.css","assets/CodeEditor-BRWEaTqr.js","assets/CodeEditor-KxSGUzo3.css","assets/FileInput-D0C4h8nk.js","assets/RadioGroup-BfuWEXDz.js","assets/RadioGroup-WBbAFTwm.css","assets/SidePanelFormButtons-CeIrPige.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useGetWslInstanceTypes-CimG2b9J.js","assets/useRoles-DoFQPeH6.js","assets/SidePanelTableFilterChips-BnEj6EUy.js","assets/constants-DtLZBNBu.js","assets/useGetInstances-v-w49HK6.js","assets/useSelection-ClH7pU3D.js","assets/PageMain-DBf2pLlC.js","assets/PageMain-C_v2-kHh.css","assets/useGetWslLimits-CEr-tnBu.js","assets/constants--49SNmXJ.js","assets/index-DCFRyHTp.css"])))=>i.map(i=>d[i]);
import{d as T,i as w,k as N,m as u,l as I,a0 as W,j as e,e as p,ax as g,S as A,J as v,q as D,s as M,E as F,as as O,a4 as B,aE as G,n as h,aA as $,aF as y,a as _,aB as H,o as z,ac as f,_ as x,D as U}from"./index-DN_YS9_3.js";import{P as q,a as Q,b as V}from"./PageMain-DBf2pLlC.js";import{u as Y}from"./useGetWslLimits-CEr-tnBu.js";import"./index-CGto-yop.js";import{H as K}from"./HeaderWithSearch-DzjwmQR6.js";import{L as J}from"./constants-DtLZBNBu.js";import{L as Z}from"./constants--49SNmXJ.js";import{u as X}from"./useRoles-DoFQPeH6.js";import{T as ee}from"./TextConfirmationModal-CyrSbwDv.js";import"./WslInstancesEmptyState-B37Gz9Hz.js";const se=()=>{const s=T(),t=w(),{isPending:i,mutateAsync:o}=N({mutationFn:async({name:n})=>s.delete(`child-instance-profiles/${n}`),onSuccess:async()=>t.invalidateQueries({queryKey:["wslProfiles"]})});return{deleteWslProfile:o,isDeletingWslProfile:i}},E=(s,t)=>{const i=T(),{currentPage:o,pageSize:n}=u();s=t?.listenToUrlParams??!0?{limit:n,offset:(o-1)*n,...s}:s;const{data:l,isPending:r}=I({queryKey:["wslProfiles",s],queryFn:async()=>i.get("child-instance-profiles",{params:s})});return{wslProfiles:l?.data.results??[],wslProfilesCount:l?.data.count??0,isGettingWslProfiles:r}},L="_landscape_isWslPopupClosed",R=({disabled:s})=>{const{setPageParams:t}=u(),{value:i,setTrue:o}=W(!!localStorage.getItem(L)),{value:n,setTrue:l,setFalse:r}=W(),c=()=>{t({sidePath:["add"]})},m=()=>{i?c():l()},P=()=>{r(),c(),localStorage.setItem(L,"true"),o()};return e.jsxs(e.Fragment,{children:[e.jsx(p.Button,{type:"button",appearance:"positive",onClick:m,disabled:s,children:"Add WSL profile"}),n&&e.jsx(p.ConfirmationModal,{close:r,title:"WSL profiles is a beta feature",onConfirm:P,confirmButtonLabel:"Add WSL profile",confirmButtonAppearance:"positive",children:e.jsx("p",{children:"We are gathering feedback to improve this feature."})})]})},te=({wslProfile:s})=>!s.tags.length&&!s.all_computers?e.jsx(g,{}):s.computers.constrained.length?e.jsxs(A,{to:{pathname:"/instances",search:`query=${encodeURIComponent(`profile:wsl:${s.id}`)}`},children:[s.computers.constrained.length," ",v(s.computers.constrained.length,"instance")]}):"0 instances",ne=({wslProfile:s})=>{if(!s.tags.length&&!s.all_computers)return e.jsx(g,{});const t=s.computers.constrained.length-s.computers["non-compliant"].length;return t?e.jsxs(A,{to:{pathname:"/instances",search:`query=${encodeURIComponent(`profile:wsl:${s.id}:compliant`)}`},children:[t," ",v(t,"instance")]}):"0 instances"},ae=({wslProfile:s,onClick:t})=>!s.tags.length&&!s.all_computers?e.jsx(g,{}):s.computers["non-compliant"].length?e.jsxs(p.Button,{className:"u-no-padding--top u-no-margin--bottom",type:"button",appearance:"link",onClick:t,children:[s.computers["non-compliant"].length," ",v(s.computers["non-compliant"].length,"instance")]}):"0 instances",oe=({wslProfile:s,...t})=>{const i=D(),{notify:o}=M(),{setPageParams:n}=u(),{deleteWslProfile:l,isDeletingWslProfile:r}=se(),c=async()=>{try{await l({name:s.name}),n({sidePath:[],profile:""}),o.success({message:"Instances created by this profile won't be affected.",title:`You have successfully removed ${s.title}.`})}catch(m){i(m)}finally{t.close()}};return e.jsx(e.Fragment,{children:e.jsx(ee,{title:`Remove ${s.title}`,confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:r,confirmButtonLoading:r,onConfirm:c,confirmationText:`remove ${s.title}`,...t,children:e.jsxs("p",{children:["Removing this profile will not remove the WSL child instances associated with it. ",e.jsx("strong",{children:"This action is irreversible."})]})})})},ie=()=>e.jsx(F,{title:"No WSL profiles found",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You havenâ€™t added any WSL profiles yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/manage-wsl-instances-in-landscape",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage WSL profiles in Landscape"})]}),cta:[e.jsx(R,{},"add")]}),re=()=>e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsx(O,{filtersToDisplay:["search"]})]}),le=({profile:s})=>{const{setPageParams:t}=u(),{value:i,setTrue:o,setFalse:n}=W(),l=()=>{t({sidePath:["edit"],profile:s.name})},r=[{icon:"edit",label:"Edit","aria-label":`Edit ${s.title} profile`,onClick:l}],c=[{icon:"delete",label:"Remove","aria-label":`Remove ${s.title} profile`,onClick:o}];return e.jsxs(e.Fragment,{children:[e.jsx(B,{toggleAriaLabel:`${s.title} profile actions`,actions:r,destructiveActions:c}),e.jsx(oe,{isOpen:i,close:n,wslProfile:s})]})},ce=(s,t)=>({column:i,row:{index:o}})=>{const n={};switch(i.id){case"title":n.role="rowheader";break;case"access_group":n["aria-label"]="Access group";break;case"tags":n["aria-label"]="Tags",s===o&&t==="tags"&&(n.className="expandedCell");break;case"description":n["aria-label"]="Description",s===o&&t==="description"&&(n.className="expandedCell");break;case"computers['non-compliant']":n["aria-label"]="Not compliant instances";break;case"computers['pending']":n["aria-label"]="Pending instances";break;case"computers['constrained']":n["aria-label"]="Associated instances";break;case"actions":n["aria-label"]="Actions";break}return n},de=s=>({index:t,original:i})=>{const o={};return s===t&&(o.className="expandedRow"),o["aria-label"]=`${i.title} wsl profile row`,o},pe="_description_3we9f_1",ue="_header_3we9f_12",b={description:pe,header:ue},me=()=>{const{expandedRowIndex:s,expandedColumnId:t,getTableRowsRef:i,handleExpand:o}=G(),{search:n}=u(),{setPageParams:l}=u(),{getAccessGroupQuery:r}=X(),{isGettingWslProfiles:c,wslProfiles:m}=E({search:n}),{data:P}=r(),C=P?.data.map(({name:a,title:d})=>({label:d,value:a}))??[],k=h.useMemo(()=>[{...Z,Cell:({row:{original:a}})=>{const d=()=>{l({sidePath:["view"],profile:a.name})};return e.jsxs($,{children:[e.jsx(p.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align--left",onClick:d,children:a.title}),e.jsx("span",{className:"u-text--muted",children:a.name})]})}},{accessor:"description",className:b.description,Header:"Description",Cell:({row:{original:a,index:d}})=>{const j=()=>{o(d,"description")};return e.jsx(y,{content:a.description,isExpanded:d===s&&t==="description",onExpand:j})}},{accessor:"access_group",Header:"Access group",Cell:({row:{original:{access_group:a}}})=>C.find(({value:d})=>d===a)?.label??a},{accessor:"tags",Header:"Tags",Cell:({row:{original:a,index:d}})=>{if(a.all_computers)return"All instances";if(!a.tags.length)return e.jsx(g,{});const j=()=>{o(d,"tags")};return e.jsx(y,{content:a.tags.map(S=>e.jsx("span",{className:"truncatedItem",children:S},S)),isExpanded:d===s&&t==="tags",onExpand:j,showCount:!0})}},{accessor:"computers['constrained']",Header:"Associated parents",Cell:({row:{original:a}})=>e.jsx(te,{wslProfile:a})},{accessor:"computers['non-compliant']",Header:e.jsxs("div",{className:b.header,children:["Not compliant",e.jsx(p.Tooltip,{position:"btm-left",message:"These instances are not compliant with the profile. They do not have a pending activity to become compliant.",children:e.jsx(p.Icon,{name:"help"})})]}),Cell:({row:{original:a}})=>e.jsx(ae,{wslProfile:a,onClick:()=>{l({sidePath:["noncompliant"],profile:a.name})}})},{accessor:"computers['compliant']",Header:e.jsxs("div",{className:b.header,children:["Compliant",e.jsx(p.Tooltip,{position:"btm-left",message:"These instances are compliant with the profile.",children:e.jsx(p.Icon,{name:"help"})})]}),Cell:({row:{original:a}})=>e.jsx(ne,{wslProfile:a})},{...J,Cell:({row:{original:a}})=>e.jsx(le,{profile:a})}],[C.length,s,t]);return c?e.jsx(_,{}):e.jsx("div",{ref:i,children:e.jsx(H,{columns:k,data:m,emptyMsg:"No WSL profiles found according to your search parameters.",getCellProps:ce(s,t),getRowProps:de(s),minWidth:1200})})},fe=h.lazy(()=>x(()=>import("./index-DIHBco5J.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34])).then(s=>({default:s.WslProfileAddSidePanel}))),he=h.lazy(()=>x(()=>import("./index-DIHBco5J.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34])).then(s=>({default:s.WslProfileDetailsSidePanel}))),ge=h.lazy(()=>x(()=>import("./index-DIHBco5J.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34])).then(s=>({default:s.WslProfileEditSidePanel}))),xe=h.lazy(()=>x(()=>import("./index-DIHBco5J.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34])).then(s=>({default:s.WslProfileNonCompliantInstancesSidePanel}))),Pe=()=>{const{sidePath:s,lastSidePathSegment:t,setPageParams:i}=u();z("sidePath",["add","edit","noncompliant","view"]);const{isGettingWslProfiles:o,wslProfilesCount:n}=E({limit:U,offset:0},{listenToUrlParams:!1}),{isGettingWslLimits:l,wslProfileLimit:r}=Y(),c=n>=r;return e.jsxs(q,{children:[o?e.jsx(_,{}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"WSL profiles",actions:[e.jsx(R,{disabled:c},"add-wsl-profile")]}),e.jsx(V,{children:n?l?e.jsx(_,{}):e.jsxs(e.Fragment,{children:[e.jsxs(p.Notification,{severity:"caution",title:"WSL profiles is a beta feature",children:["We are gathering feedback to improve this feature."," ",e.jsx("a",{target:"_blank",rel:"noreferrer noopener nofollow",href:"https://discourse.ubuntu.com/t/feedback-on-the-new-web-portal/50528",children:"Share your feedback"})]}),e.jsx(re,{}),c&&e.jsxs(p.Notification,{severity:"caution",inline:!0,title:"Profile limit reached:",children:["You've reached the limit of ",r," active WSL profiles. You must remove a profile to be able to add a new one."]}),e.jsx(me,{})]}):e.jsx(ie,{})})]}),e.jsxs(f,{onClose:()=>{i({sidePath:[],profile:""})},isOpen:!!s.length,size:t==="noncompliant"?"large":void 0,children:[t==="add"&&e.jsx(f.Suspense,{children:e.jsx(fe,{})},"add"),t==="edit"&&e.jsx(f.Suspense,{children:e.jsx(ge,{})},"edit"),t==="noncompliant"&&e.jsx(f.Suspense,{children:e.jsx(xe,{})},"noncompliant"),t==="view"&&e.jsx(f.Suspense,{children:e.jsx(he,{})},"view")]})]})},Ae=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"}));export{te as W,ae as a,ne as b,oe as c,R as d,ie as e,re as f,me as g,E as h,Ae as i,se as u};
