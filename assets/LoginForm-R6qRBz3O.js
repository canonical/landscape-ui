import{j as e,K as w,y as h,$ as x,u as P,N as A,B as E,k as j,P as _,h as g,d as m}from"./index-CNSDWj8Q.js";import{g as f}from"./formikErrors-Bw8iTXYS.js";import{A as y}from"./AvailableProviderList-B4B-Rzn_.js";const R=({methods:a})=>{if(!a)return null;const o=!!(a.standalone_oidc.available&&a.standalone_oidc.enabled),d=!!(a.ubuntu_one.available&&a.ubuntu_one.enabled),p=!!(a.password.available&&a.password.enabled),n=!!(a.pam.available&&a.pam.enabled),b=a.oidc.available?a.oidc.configurations.filter(({enabled:l})=>l):[],c=p||n,u=d||o||a.oidc.configurations.length>0;return e.jsxs(e.Fragment,{children:[c&&e.jsx(L,{isIdentityAvailable:n}),u&&e.jsx(y,{isStandaloneOidcEnabled:o,isUbuntuOneEnabled:d,oidcProviders:b}),!c&&!u&&e.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})},S="_buttonRow_f3s21_1",F={buttonRow:S},L=({isIdentityAvailable:a})=>{const[o]=w(),d=h(),{login:p,isLoggingIn:n}=x(),{redirectToExternalUrl:b,setUser:c}=P(),u=A(),l=o.get("redirect-to"),v=o.has("external"),s=E({initialValues:{email:"",password:""},validationSchema:j().shape({email:a?g().required("This field is required"):g().required("This field is required").matches(/^[a-zA-Z0-9-_.]+@[a-zA-Z0-9-.]*[a-zA-Z]$/,"Please provide a valid email address").test({message:"Please provide a valid email address",test:t=>{if(!t||t.match(/\.\./))return!1;const[i,r]=t.split("@");return!(!i||!r||i.startsWith(".")||i.endsWith(".")||!r.includes(".")||r.startsWith(".")||r.startsWith("-")||r.match(/\.-/)||r.match(/-\./))}}),password:g().required("This field is required")}),onSubmit:async t=>{try{const{data:i}=await p({email:t.email,password:t.password});v&&l?b(l,{replace:!0}):("current_account"in i&&c(i),u(l??_,{replace:!0}))}catch(i){d(i)}}});return e.jsxs(m.Form,{onSubmit:s.handleSubmit,children:[e.jsx(m.Input,{type:"text",label:a?"Identity":"Email",error:f(s,"email"),...s.getFieldProps("email"),"data-testid":"email"}),e.jsx(m.PasswordToggle,{id:"password",label:"Password",error:f(s,"password"),...s.getFieldProps("password"),"data-testid":"password"}),e.jsx("div",{className:F.buttonRow,children:e.jsx(m.ActionButton,{type:"submit",appearance:"positive",loading:s.isSubmitting||n,disabled:s.isSubmitting||!s.isValid||n,className:"u-no-margin--bottom",children:"Sign in"})})]})};export{R as L};
