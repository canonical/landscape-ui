import{h as S,i as o,k,l as R,p as T,o as C,f as D,q as F,s as N,j as t,g as i,m as B}from"./index-xYBbIcB9.js";import{u as P}from"./index-gQIRBsRO.js";import{u as E}from"./useInstances-C0U6a7Re.js";import{h as f}from"./usePageParams-BPqOE3H2.js";import{u as V}from"./index-BlzWzbp2.js";import{U as z}from"./constants-BDMNZImn.js";import"./TablePagination-uK77CSDZ.js";import"./TablePaginationBase-Cei9bSVz.js";import"./StatusFilter-DDs4u3bb.js";import"./TableFilter-Bs-9ySlE.js";import"./TableFilterChips-DwpzAZz0.js";import"./useFetchOld-BU5n9LWB.js";import"./NoData-CkCw4S-S.js";import"./PageMain-Ns2BZnnp.js";import"./usePackages-DDBwKMX4.js";import"./helpers-Cc9GMOVU.js";try{let a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new a.Error().stack;n&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[n]="737eb0d5-38c9-451c-8f16-6c73f846e77e",a._sentryDebugIdIdentifier="sentry-dbid-737eb0d5-38c9-451c-8f16-6c73f846e77e")}catch{}const U=S().shape({deliver_immediately:o(),randomize_delivery:o(),deliver_delay_window:R().min(0,"Delivery delay must be greater than or equal to 0"),deliver_after:k().test({test:a=>a?f(a).isValid():!0,message:"You have to enter a valid date and time"}),upgrade_and_restart:o()}),G={deliver_immediately:!0,randomize_delivery:!1,deliver_delay_window:0,deliver_after:"",upgrade_and_restart:!1},L="To save patches, upgrade your kernel and then Restart. If you Restart without upgrading, you will lose patches until Livepatch automatically applies them again.",$="_radioGroup_1yu2c_1",M="_marginTop_1yu2c_6",l={radioGroup:$,marginTop:M},se=({showNotification:a,instanceName:n,newKernelVersionId:c})=>{const g=T(),{instanceId:u}=C(),{closeSidePanel:d}=D(),{notify:m}=F(),{restartInstanceQuery:h}=E(),{upgradeKernelQuery:b}=V(),{openActivityDetails:p}=P(),{mutateAsync:w,isPending:y}=h,{mutateAsync:I,isPending:_}=b,e=N({initialValues:G,validationSchema:U,onSubmit:async r=>{try{r.upgrade_and_restart?await A():await j(r)}catch(s){g(s)}}}),v=async r=>{const s=r.currentTarget.value==="true";await e.setFieldValue("deliver_immediately",s),s||await e.setFieldValue("deliver_after",f().toISOString().slice(0,16))},x=async()=>{await e.setFieldValue("upgrade_and_restart",!0),e.handleSubmit()},A=async()=>{const{data:r}=await I({id:Number(u),kernel_package_id:Number(c),reboot_after:!0});d(),m.success({title:`You queued kernel upgrade for "${n}"`,message:z,actions:[{label:"View details",onClick:()=>p(r)}]})},j=async r=>{const{data:s}=await w({id:Number(u),deliver_after:r.deliver_after,deliver_delay_window:r.deliver_delay_window});d(),m.success({title:`You queued "${n}" to be restarted.`,message:`Instance "${n}" will be restarted and is queued in Activities`,actions:[{label:"View details",onClick:()=>p(s)}]})};return t.jsxs(i.Form,{onSubmit:e.handleSubmit,children:[a&&t.jsx(i.Notification,{title:"Restart recommended",severity:"caution",children:L}),t.jsx("strong",{children:"Delivery time"}),t.jsxs("div",{className:l.radioGroup,children:[t.jsx(i.Input,{type:"radio",label:"As soon as possible",name:"deliver_immediately",value:"true",onChange:v,checked:e.values.deliver_immediately}),t.jsx(i.Input,{type:"radio",label:"Scheduled",name:"deliver_immediately",value:"false",onChange:v,checked:!e.values.deliver_immediately})]}),!e.values.deliver_immediately&&t.jsx(i.Input,{type:"datetime-local",label:"Deliver after",labelClassName:"u-off-screen",...e.getFieldProps("deliver_after"),error:e.touched.deliver_after&&e.errors.deliver_after?e.errors.deliver_after:void 0}),t.jsx("strong",{className:B(l.marginTop),children:"Randomise delivery over a time window"}),t.jsxs("div",{className:l.radioGroup,children:[t.jsx(i.Input,{type:"radio",label:"No",...e.getFieldProps("randomize_delivery"),onChange:async()=>{await e.setFieldValue("randomize_delivery",!1),await e.setFieldValue("deliver_delay_window",0)},checked:!e.values.randomize_delivery}),t.jsx(i.Input,{type:"radio",label:"Yes",...e.getFieldProps("randomize_delivery"),onChange:async()=>await e.setFieldValue("randomize_delivery",!0),checked:e.values.randomize_delivery})]}),e.values.randomize_delivery&&t.jsx(i.Input,{type:"number",inputMode:"numeric",min:0,label:"Delivery delay window",labelClassName:"u-off-screen",help:"Time in minutes",...e.getFieldProps("deliver_delay_window"),error:e.touched.deliver_delay_window&&e.errors.deliver_delay_window?e.errors.deliver_delay_window:void 0}),t.jsxs("div",{className:"form-buttons",children:[t.jsx(i.Button,{type:"button",appearance:"base",onClick:d,children:"Cancel"}),a&&c&&t.jsx(i.ConfirmationButton,{type:"button",confirmationModalProps:{title:"Upgrading kernel and restarting instance",children:t.jsx("p",{children:"Are you sure? This action will upgrade the kernel and restart the instance."}),confirmButtonLabel:"Upgrade and Restart",confirmButtonAppearance:"negative",confirmButtonLoading:_,confirmButtonDisabled:_,onConfirm:x},children:"Upgrade and Restart"}),t.jsx(i.ConfirmationButton,{type:"button",appearance:"negative",confirmationModalProps:{title:"Restarting instance",children:t.jsx("p",{children:"Are you sure? This action will restart the instance."}),confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonLoading:y,confirmButtonDisabled:y,onConfirm:()=>e.handleSubmit()},children:"Restart"})]})]})};export{se as default};
