import{d as Z,c as ee,e as I,k as Q,f as S,j as e,g as a,r as x,_ as q,p as se,l as re,h as te,o as P}from"./index-CreLYkd7.js";import{E as oe}from"./EmptyState-DAULjSZb.js";import"./TablePagination.module-DLVph1Z1.js";import{T as ne}from"./TablePagination-Zw7WkUG8.js";import{u as k}from"./useMutation-CvjNgrEE.js";import{u as F}from"./useQuery-TlFJgfqc.js";import{u as ae}from"./useConfirm-Bodc886s.js";import{u as ce}from"./formik.esm-C2DYiXJC.js";import{c as ie,a as j,e as ue}from"./index.esm-Co3jed-Q.js";import{S as le}from"./SidePanelFormButtons-CfVlXCl-.js";import{g as de,r as E,U as T,a as me}from"./helpers-Cjr4pgyV.js";import{u as B}from"./usePageParams-MY5k-CLu.js";function A(){const r=Z(),o=ee(),c=I(),u=(s,y={})=>F({queryKey:["users",{...s}],queryFn:()=>r.get("users",{params:s}),...y}),d=k({mutationKey:["users","new"],mutationFn:s=>r.post("users",s),onSuccess:()=>{o.invalidateQueries(["users"]).catch(c)}}),m=k({mutationKey:["users","edit"],mutationFn:s=>r.put("users",s),onSuccess:()=>{o.invalidateQueries(["users"]).catch(c)}}),h=k({mutationKey:["users","remove"],mutationFn:s=>r.delete("users",{params:s}),onSuccess:()=>{o.invalidateQueries(["users"]).catch(c)}}),g=k({mutationKey:["users","lock"],mutationFn:s=>r.post("users/lock",s),onSuccess:()=>{o.invalidateQueries(["users"]).catch(c)}}),p=k({mutationKey:["users","unlock"],mutationFn:s=>r.post("users/unlock",s),onSuccess:()=>{o.invalidateQueries(["users"]).catch(c)}}),n=(s,y={})=>F({queryKey:["groups",s.computer_id],queryFn:()=>r.get(`computers/${s.computer_id}/groups`),...y}),l=(s,y={})=>F({queryKey:["userGroups",s.computer_id,s.username],queryFn:()=>r.get(`computers/${s.computer_id}/users/${s.username}/groups`),...y}),b=k({mutationKey:["groups","add"],mutationFn:s=>r.post(`computers/${s.computer_id}/usergroups/update_bulk`,s),onSuccess:()=>{o.invalidateQueries(["users"]).catch(c)}}),t=k({mutationKey:["groups","remove"],mutationFn:s=>r.post(`computers/${s.computer_id}/usergroups/update_bulk`,s),onSuccess:()=>{o.invalidateQueries(["users"]).catch(c)}});return{getUsersQuery:u,getGroupsQuery:n,getUserGroupsQuery:l,createUserQuery:d,removeUserQuery:h,editUserQuery:m,lockUserQuery:g,unlockUserQuery:p,addUserToGroupQuery:b,removeUserFromGroupQuery:t}}const pe="_headerContainer_j1328_1",he="_searchContainer_j1328_6",D={headerContainer:pe,searchContainer:he},M=()=>{const{instanceId:r}=Q(),o=I(),{closeSidePanel:c}=S(),{createUserQuery:u,getGroupsQuery:d}=A(),m=Number(r),{mutateAsync:h,isLoading:g}=u,{data:p,isLoading:n}=d({computer_id:m}),b=((p==null?void 0:p.data.groups)??[]).map(s=>({label:s.name,value:s.name})),t=ce({initialValues:{name:"",username:"",password:"",confirmPassword:"",requirePasswordReset:!1,location:"",homePhoneNumber:"",workPhoneNumber:"",primaryGroupValue:""},validationSchema:ie().shape({name:j().required("This field is required"),username:j().required("This field is required"),password:j().required("This field is required"),confirmPassword:j().required("This field is required").oneOf([ue("password"),""],"Passwords must match"),location:j(),homePhoneNumber:j(),workPhoneNumber:j(),primaryGroupValue:j().required("This field is required")}),onSubmit:async s=>{try{await h({computer_ids:[m],name:s.name,username:s.username,password:s.password,require_password_reset:s.requirePasswordReset,location:s.location,home_phone:s.homePhoneNumber,work_phone:s.workPhoneNumber,primary_groupname:s.primaryGroupValue}),c()}catch(y){o(y)}}});return e.jsxs(a.Form,{noValidate:!0,onSubmit:t.handleSubmit,name:"add-new-user",children:[e.jsx(a.Input,{type:"text",label:"Username",autoComplete:"new-username",required:!0,error:t.touched.username&&t.errors.username?t.errors.username:void 0,...t.getFieldProps("username")}),e.jsx(a.Input,{type:"text",label:"Name",required:!0,error:t.touched.name&&t.errors.name?t.errors.name:void 0,...t.getFieldProps("name")}),e.jsx(a.Input,{type:"password",label:"Passphrase",autoComplete:"new-password",required:!0,error:t.touched.password&&t.errors.password?t.errors.password:void 0,...t.getFieldProps("password")}),e.jsx(a.Input,{type:"password",label:"Confirm passphrase",autoComplete:"new-password",required:!0,error:t.touched.confirmPassword&&t.errors.confirmPassword?t.errors.confirmPassword:void 0,...t.getFieldProps("confirmPassword")}),e.jsx(a.Input,{type:"checkbox",label:"Require passphrase reset",help:"User must change password at first login",...t.getFieldProps("requirePasswordReset"),checked:t.values.requirePasswordReset}),e.jsx(a.Select,{label:"Primary Group",disabled:n,options:[{label:"Select",value:""},...b],...t.getFieldProps("primaryGroupValue"),error:t.touched.primaryGroupValue&&t.errors.primaryGroupValue?t.errors.primaryGroupValue:void 0}),e.jsx(a.Input,{type:"text",label:"Location",error:t.touched.location&&t.errors.location?t.errors.location:void 0,...t.getFieldProps("location")}),e.jsx(a.Input,{type:"text",label:"Home phone",error:t.touched.homePhoneNumber&&t.errors.homePhoneNumber?t.errors.homePhoneNumber:void 0,...t.getFieldProps("homePhoneNumber")}),e.jsx(a.Input,{type:"text",label:"Work phone",error:t.touched.workPhoneNumber&&t.errors.workPhoneNumber?t.errors.workPhoneNumber:void 0,...t.getFieldProps("workPhoneNumber")}),e.jsx(le,{submitButtonDisabled:g,submitButtonText:"Add user"})]})},ge="_cta_hpksw_1",be={cta:ge},xe=x.lazy(()=>q(()=>import("./index-BAGheyL3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))),ye=({selectedUsers:r,handleClearSelection:o,sidePanel:c=!1})=>{const[u,d]=x.useState(!1),{instanceId:m}=Q(),h=se("(min-width: 620px)"),g=I(),{notify:p}=re(),{setSidePanelContent:n,closeSidePanel:l}=S(),{confirmModal:b,closeConfirmModal:t}=ae(),{removeUserQuery:s,lockUserQuery:y,unlockUserQuery:_}=A(),{mutateAsync:C}=s,{mutateAsync:N}=y,{mutateAsync:f}=_,w=Number(m),i=r.length===1?r[0]:void 0,{locked:G,unlocked:V}=de(r),v=async(U,$)=>{try{await U({computer_ids:[w],usernames:me(r),delete_home:$==="removed"?u:void 0}),o&&o(),l(),p.success({message:`Successfully requested to be ${$}`})}catch(J){g(J)}finally{t()}},R=async()=>{await v(N,"locked")},K=async()=>{await v(f,"unlocked")},H=async()=>{await v(C,"removed")},O=()=>{n("Add new user",e.jsx(M,{}))},z=U=>{n("Edit user",e.jsx(x.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(xe,{user:U})}))},Y=async()=>{b({title:`Delete ${i?i.username:"users"}`,body:e.jsxs("div",{children:[e.jsx("p",{className:"u-no-margin--bottom",children:i?`This will delete user ${i.username}. You can delete this user's home folders at the same time`:"This will delete selected users. You can delete their home folders as well"}),e.jsx(a.Input,{label:"Delete the home folders as well",type:"checkbox",onChange:()=>d(U=>!U)})]}),buttons:[e.jsx(a.Button,{appearance:"negative",onClick:H,children:"Delete"},"remove")]})},W=async()=>{b({title:`Lock ${i?`user ${i.username}`:`${r.length} users`}`,body:E({user:i,selectedUsers:r,userAction:T.Lock}),buttons:[e.jsx(a.Button,{appearance:"positive",onClick:R,children:"Lock"},"lock")]})},X=async()=>{b({title:`Unlock ${i?`user ${i.username}`:`${r.length} users`}`,body:E({user:i,selectedUsers:r,userAction:T.Unlock}),buttons:[e.jsx(a.Button,{appearance:"positive",onClick:K,children:"Unlock"},"unlock")]})};return e.jsxs("div",{className:te("p-panel__controls u-no-padding--top",{"u-no-margin--left":c,[be.cta]:!c&&h}),children:[!c&&e.jsxs(a.Button,{hasIcon:!0,onClick:O,className:"u-no-margin--right",children:[e.jsx(a.Icon,{name:"plus"}),e.jsx("span",{children:"Add user"})]}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[((i==null?void 0:i.enabled)||!c)&&e.jsxs(a.Button,{disabled:V===0,onClick:W,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"lock-locked"}),e.jsx("span",{children:"Lock"})]}),(!(i!=null&&i.enabled)||!c)&&e.jsxs(a.Button,{disabled:G===0,onClick:X,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlock"})]}),c&&i&&e.jsxs(a.Button,{onClick:()=>z(i),className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(a.Button,{disabled:r.length===0,onClick:Y,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"delete"}),e.jsx("span",{children:"Delete"})]})]})})]})},je=(r,o)=>r.filter(c=>o.includes(c.uid)),ke=({selected:r,handleClearSelection:o,users:c})=>{const{search:u,setPageParams:d}=B(),[m,h]=x.useState(u),g=()=>{d({search:m}),o()},p=()=>{d({search:""})},n=l=>{l.preventDefault(),g()};return e.jsxs("div",{className:D.headerContainer,children:[e.jsx("div",{className:D.searchContainer,children:e.jsx(a.Form,{onSubmit:n,noValidate:!0,children:e.jsx(a.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,value:m,onChange:l=>h(l),onClear:p})})}),e.jsx(ye,{handleClearSelection:o,selectedUsers:je(c,r)})]})},_e="_status_1n2s0_1",fe="_actions_1n2s0_7",L={status:_e,actions:fe},Ue=({column:r})=>{const o={};switch(r.id){case"username":o.role="rowheader";break;case"enabled":o["aria-label"]="Status";break;case"uid":o["aria-label"]="User id";break;case"name":o["aria-label"]="Full name";break}return o},Ce=x.lazy(()=>q(()=>import("./index-BAGheyL3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))),we=x.lazy(()=>q(()=>import("./index-BJenaQuz.js"),__vite__mapDeps([21,1,2,22,23,24,11,12,13,14,15,16,17,18,19,3,4,5,6,7,20]))),Pe=({users:r,selected:o,setSelected:c})=>{const{setSidePanelContent:u}=S(),d=n=>{u("Edit user",e.jsx(x.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(Ce,{user:n})}))},m=n=>{u("User details",e.jsx(x.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(we,{user:n})}))},h=()=>{c(o.length!==0?[]:r.map(({uid:n})=>n))},g=n=>{o.includes(n)?c(o.filter(l=>l!==n)):c([...o,n])},p=x.useMemo(()=>[{accessor:"username",Header:e.jsxs(e.Fragment,{children:[e.jsx(a.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:h,checked:r.length>0&&o.length===r.length,indeterminate:o.length>0&&o.length<r.length}),e.jsx("span",{children:"username"})]}),Cell:({row:n})=>e.jsxs(e.Fragment,{children:[e.jsx(a.CheckboxInput,{inline:!0,label:e.jsxs("span",{className:"u-off-screen",children:["Select user ",n.original.username]}),checked:o.includes(n.original.uid),onChange:()=>g(n.original.uid)}),e.jsx(a.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>m(n.original),"aria-label":`Show details of user ${n.original.username}`,children:n.original.username})]})},{Header:"status",accessor:"enabled",sortType:"basic",Cell:({row:n})=>e.jsx("div",{className:L.status,children:n.original.enabled?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"p-icon--lock-unlock"}),e.jsx("span",{children:"Unlocked"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"p-icon--lock-locked-active"}),e.jsx("span",{children:"Locked"})]})})},{Header:"UID",accessor:"uid",sortType:"basic"},{Header:"Full Name",accessor:"name",sortType:"basic",Cell:({value:n})=>n||"-"},{accessor:"actions",className:L.actions,Cell:({row:n})=>e.jsx(a.Tooltip,{message:"Edit",position:"btm-center",children:e.jsx(a.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Edit ${n.original.name} profile`,onClick:()=>d(n.original),children:e.jsx("i",{className:"p-icon--edit u-no-margin--left"})})})}],[r]);return e.jsx(a.ModularTable,{columns:p,data:r,emptyMsg:"No users available",sortable:!0,initialSortDirection:"ascending",initialSortColumn:"username",getCellProps:Ue})},Se=(r,o)=>r?o.filter(({username:c,name:u})=>{const d=u==null?void 0:u.toUpperCase().includes(r.toUpperCase()),m=c.toUpperCase().includes(r.toUpperCase());return d||m}):o,Ne=1e3,ve=()=>{const[r,o]=x.useState([]),{instanceId:c,childInstanceId:u}=Q(),{search:d,currentPage:m,pageSize:h}=B(),{setSidePanelContent:g}=S(),{getUsersQuery:p}=A(),n=Number(u??c),{data:l,isLoading:b}=p({computer_id:n,limit:Ne}),t=(l==null?void 0:l.data.results)??[],s=x.useMemo(()=>Se(d,t),[d,t]),_=((f,w)=>s.slice(w,w+f))(h,(m-1)*h),C=()=>{o([])},N=()=>{g("Add new user",e.jsx(M,{}))};return e.jsxs(e.Fragment,{children:[b&&e.jsx(P,{}),!b&&(!l||l.data.results.length===0)&&e.jsx(oe,{title:"No users found",body:"Add new users by clicking the button below",icon:"connected",cta:[e.jsx(a.Button,{appearance:"positive",onClick:N,children:"Add user"},"empty-state-add-new-user")]}),!b&&s.length&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{selected:r,handleClearSelection:C,users:_}),e.jsx(Pe,{selected:r,setSelected:f=>o(f),users:_})]}),e.jsx(ne,{handleClearSelection:C,totalItems:s.length,currentItemCount:_.length})]})},Fe=ve,Ve=Object.freeze(Object.defineProperty({__proto__:null,default:Fe},Symbol.toStringTag,{value:"Module"}));export{ye as U,Ve as i,A as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-BAGheyL3.js","assets/index-CreLYkd7.js","assets/index-DzLy8aaC.css","assets/formik.esm-C2DYiXJC.js","assets/index.esm-Co3jed-Q.js","assets/SidePanelFormButtons-CfVlXCl-.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/MultiSelectField-DVS5b9ca.js","assets/MultiSelectField.module-D1r8qo_i.js","assets/MultiSelectField-B2rqRhX9.css","assets/EmptyState-DAULjSZb.js","assets/EmptyState-BNXajmMK.css","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/TablePagination-Zw7WkUG8.js","assets/usePageParams-MY5k-CLu.js","assets/useMutation-CvjNgrEE.js","assets/useQuery-TlFJgfqc.js","assets/useConfirm-Bodc886s.js","assets/helpers-Cjr4pgyV.js","assets/index-BJenaQuz.js","assets/InfoItem-DVjSC8Rv.js","assets/InfoItem.module-BZ3tYMsb.js","assets/InfoItem-BbayMzTk.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
