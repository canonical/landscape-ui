import{r as d,M as h,j as s,B as x,h as p,d as v,o as b,l as f}from"./index-u_EhbhC_.js";import{u as C,P as E,a as j,b as w}from"./PageMain-CmLgxdJK.js";import{h as y}from"./moment-C5S46NFB.js";import{T as P}from"./TruncatedCell-DdaPylls.js";import"./moment-BMNhdv00.js";import{a as R}from"./helpers-B4Ea794_.js";import{u as _}from"./usePageParams-TkE3cuN_.js";import{H as L}from"./HeaderWithSearch-8K0RDNyY.js";import{T as H}from"./TablePagination-B-hCaI46.js";import"./TablePagination.module-CgQ3jx4B.js";const T="_message_1po57_1",S="_expandedCell_1po57_5",M="_expandedRow_1po57_10",u={message:T,expandedCell:S,expandedRow:M},F=o=>({index:a})=>{const n={};return o===a&&(n.className=u.expandedRow),n},I=o=>({column:a,row:{index:n}})=>{const e={};return a.id==="creation_time"?e.role="rowheader":a.id==="person_name"?e["aria-label"]="username":a.id==="entity_type"?e["aria-label"]="entity type":a.id==="entity_name"?e["aria-label"]="entity name":a.id==="message"&&(e["aria-label"]="message",o===n&&(e.className=u.expandedCell)),e},N=({eventsLog:o})=>{const[a,n]=d.useState(""),[e,l]=d.useState(-1),i=d.useRef([]);h({current:e!==-1?i.current[e]:null},()=>l(-1));const r=d.useMemo(()=>[{accessor:"creation_time",Header:"creation time",Cell:({row:t})=>s.jsx(s.Fragment,{children:y(t.original.creation_time).format(x)})},{accessor:"person_name",Header:"username",Cell:({row:t})=>s.jsx(s.Fragment,{children:t.original.person_name})},{accessor:"entity_type",Header:"entity type",Cell:({row:t})=>s.jsx(s.Fragment,{children:t.original.entity_type})},{accessor:"entity_name",Header:"entity name",Cell:({row:t})=>s.jsx(s.Fragment,{children:t.original.entity_name})},{accessor:"message",className:u.message,Header:"event log message",Cell:({row:{original:t,index:c}})=>s.jsx(P,{content:t.message,isExpanded:c===e,onExpand:()=>{n(""),l(a?c-1:c)}})}],[o,e]);return s.jsx("div",{ref:R(i),children:s.jsx(p.ModularTable,{getCellProps:I(e),getRowProps:F(e),columns:r,data:o,sortable:!0,emptyMsg:"No events found"})})},k="_container_1d6rw_1",D="_searchContainer_1d6rw_8",Y="_select_1d6rw_12",A={container:k,searchContainer:D,select:Y},g={days:{slug:"days",label:"Days",type:"select",options:[{label:"1 day",value:"1"},{label:"7 days",value:"7"},{label:"30 days",value:"30"},{label:"90 days",value:"90"},{label:"180 days",value:"180"},{label:"365 days",value:"365"}]}},O=()=>{const{days:o,setPageParams:a}=_(),n=l=>{a({search:l})},e=l=>{a({days:l.target.value})};return s.jsx(L,{onSearch:n,actions:s.jsx(p.Select,{wrapperClassName:A.select,label:g.days.label,labelClassName:"u-no-margin--bottom",options:g.days.options,value:o,onChange:e})})};function $(){const o=v();return{getEventsLog:(n,e={})=>C({queryKey:["events",n],queryFn:()=>o.get("events",{params:n}),...e})}}const B=(o,a)=>{const n=["creation_time","person_id","person_name","entity_type","entity_id","entity_name","message"],l=[["Creation Time","Person ID","Person Name","Entity Type","Entity ID","Entity Name","Message"].join(","),...o.map(c=>n.map(m=>c[m]).join(","))].join(`\r
`),i=new Blob([l],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(i),t=document.createElement("a");t.href=r,t.download=a,document.body.appendChild(t),t.click(),document.body.removeChild(t)},U=()=>{const{days:o,search:a,currentPage:n,pageSize:e}=_(),{user:l}=b(),{getEventsLog:i}=$(),{data:r,isLoading:t}=i({days:Number(o),limit:e,offset:(n-1)*e,search:a}),c=d.useMemo(()=>(r==null?void 0:r.data.results.filter(m=>m.message.includes(a)))??[],[r,a]);return s.jsxs(E,{children:[s.jsx(j,{title:"Events log",actions:[s.jsx(p.Button,{onClick:()=>B(c,`Event Log - ${l.current_account}-${y().format("YYYY-MM-DDTHH mm ss[Z]")}.csv`),children:"Download as CSV"},"download-as-cv")]}),s.jsxs(w,{children:[s.jsx(O,{}),t&&s.jsx(f,{}),!t&&c&&s.jsx(N,{eventsLog:c}),s.jsx(H,{totalItems:r==null?void 0:r.data.count,currentItemCount:c.length})]})]})},ee=U;export{ee as default};
