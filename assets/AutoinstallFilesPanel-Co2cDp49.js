const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DbBuokfR.js","assets/index-DN_YS9_3.js","assets/index-CMPBhKCb.css","assets/CodeEditor-BRWEaTqr.js","assets/index-CGto-yop.js","assets/CodeEditor-KxSGUzo3.css","assets/SidePanelFormButtons-CeIrPige.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/HeaderWithSearch-DzjwmQR6.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/Chip-HbbhxOYW.js","assets/Chip-R6WqXyae.css","assets/constants-DtLZBNBu.js","assets/SidePanelTablePagination-By5p_UR0.js","assets/constants--49SNmXJ.js","assets/index-ZQQe9POB.css"])))=>i.map(i=>d[i]);
import{d as _,i as L,k as C,l as U,y as ue,z as de,B as $,b9 as me,n as m,a0 as N,q as pe,s as w,p as y,t as fe,j as e,e as o,v as k,as as he,a as x,J as V,I as F,w as j,Q as S,D as ge,_ as z,a4 as xe,aA as Ae,aB as _e,m as ye,E as ve,at as Fe}from"./index-DN_YS9_3.js";import"./index-CGto-yop.js";import{H as be}from"./HeaderWithSearch-DzjwmQR6.js";import{C as H}from"./Chip-HbbhxOYW.js";import{L as je}from"./constants-DtLZBNBu.js";import{C as Se}from"./CodeEditor-BRWEaTqr.js";import{S as Ce}from"./SidePanelFormButtons-CeIrPige.js";import{S as Ie}from"./SidePanelTablePagination-By5p_UR0.js";import{L as Te}from"./constants--49SNmXJ.js";const G=()=>{const t=_(),s=L(),{isPending:a,mutateAsync:n}=C({mutationFn:async i=>t.post("autoinstall",i),onSuccess:async()=>s.invalidateQueries({queryKey:["autoinstallFiles"]})});return{isAutoinstallFileAdding:a,addAutoinstallFile:n}},Le=()=>{const t=_(),s=L(),{isPending:a,mutateAsync:n}=C({mutationFn:async({id:i})=>t.delete(`autoinstall/${i}`),onSuccess:async()=>s.invalidateQueries({queryKey:["autoinstallFiles"]})});return{deleteAutoinstallFile:n,isAutoinstallFileDeleting:a}},W=({id:t,...s})=>{const a=_(),{data:n,isLoading:i}=U({queryKey:["autoinstallFiles",t,{...s}],queryFn:async()=>a.get(`autoinstall/${t}`,{params:s})});return{autoinstallFile:n?.data,isAutoinstallFileLoading:i}},Y=(t,s={})=>{const a=_(),{data:n,isLoading:i,isFetching:l}=U({queryKey:["autoinstallFiles",t],queryFn:async()=>a.get("autoinstall",{params:t}),...s});return{autoinstallFiles:n?.data.results??[],autoinstallFilesCount:n?.data.count,isAutoinstallFilesLoading:i,isFetching:l}},Q=()=>{const t=_(),s=L(),{isPending:a,mutateAsync:n}=C({mutationFn:async({id:i,...l})=>t.patch(`autoinstall/${i}`,l),onSuccess:async()=>{await s.invalidateQueries({queryKey:["autoinstallFiles"]})}});return{isAutoinstallFileUpdating:a,updateAutoinstallFile:n}},Ne=()=>{const t=_(),{isPending:s,mutateAsync:a}=C({mutationFn:async n=>t.post("autoinstall:validate",n)});return{isAutoinstallFileValidating:s,validateAutoinstallFile:a}},P="yaml",M=`.${P}`,K=[P,"yml"],B=t=>t.replace(new RegExp(`\\.(${K.join("|")})$`),""),we="_form_1dly8_1",Pe="_inputContainer_1dly8_7",Ee="_input_1dly8_7",De="_inputDescription_1dly8_16",b={form:we,inputContainer:Pe,input:Ee,inputDescription:De},Oe=ue().shape({contents:$().required("This field is required"),filename:$().required("This field is required"),is_default:de()}),$e={contents:"",filename:"",is_default:!1},ke=(t,s)=>t===s,Ve=t=>{if(me(t)&&t.response){const{error:s}=t.response.data;return s==="AutoinstallOverrideWarning"}return!1},Me=t=>{const s=t.response?.data.message.match(/overrides fields (.+)$/);return s?s[1].split(",").map(a=>a.trim()):[]},J=({buttonText:t,description:s,initialFile:a=$e,notification:n,onSubmit:i})=>{const l=t==="Add",r=m.useRef(null),[d,p]=m.useState([]),{setTrue:A,setFalse:v,value:I}=N(),f=pe(),{notify:T}=w(),{closeSidePanel:ne}=y(),{validateAutoinstallFile:ae,isAutoinstallFileValidating:D}=Ne(),O=async(u,h=!1)=>{const g=`${u.filename}${M}`;try{await i({contents:u.contents,is_default:u.is_default,filename:g,accept_warning:h}),ne(),T.success({message:`The autoinstall file ${g} ${n.message}`,title:`${n.title} ${g}`})}catch(ce){f(ce)}},c=fe({initialValues:{contents:a.contents,is_default:a.is_default,filename:B(a.filename)},validationSchema:Oe,onSubmit:async u=>{try{await ae({contents:u.contents}),await O(u,!1)}catch(h){if(Ve(h)){const g=Me(h);p(g),A()}else f(h)}}}),ie=async()=>{c.setSubmitting(!0),await O(c.values,!0),v()},le=async({target:{files:u}})=>{if(!u)return;const[h]=u,g=c.setFieldValue("contents",await h.text());if(c.values.filename){await g;return}await Promise.all([c.setFieldValue("filename",B(h.name)),g])},oe=async u=>{await c.setFieldValue("contents",u)},re=()=>{r.current?.click()};return e.jsxs(o.Form,{className:b.form,noValidate:!0,onSubmit:c.handleSubmit,children:[e.jsx("span",{children:s}),e.jsxs("div",{className:b.inputContainer,children:[e.jsx(o.Input,{wrapperClassName:b.input,type:"text",label:"File name",...c.getFieldProps("filename"),error:k(c,"filename"),disabled:!!a.filename,required:!0}),e.jsx("span",{className:b.inputDescription,children:M})]}),l&&e.jsx(o.Input,{type:"checkbox",label:"Default",...c.getFieldProps("is_default"),help:"This file will be used to configure newly registered instances. Only one default file can be set at a time."}),e.jsx("input",{ref:r,className:"u-hide",type:"file",accept:K.map(u=>`.${u}`).join(","),onChange:le}),e.jsx(Se,{label:"Code",value:c.values.contents,onChange:oe,error:k(c,"contents"),required:!0,language:P,headerContent:e.jsxs(o.Button,{className:"u-no-margin--bottom",appearance:"base",hasIcon:!0,onClick:re,type:"button",children:[e.jsx(o.Icon,{name:"upload"}),e.jsx("span",{children:"Populate from file"})]})}),e.jsx(Ce,{submitButtonDisabled:ke(c.values.contents,a.contents)||c.isSubmitting||D,submitButtonLoading:D||c.isSubmitting,submitButtonText:t}),I&&e.jsxs(o.ConfirmationModal,{title:"Override autoinstall file",confirmButtonLabel:"Override and add file",confirmButtonAppearance:"negative",confirmButtonLoading:c.isSubmitting,onConfirm:ie,close:v,confirmButtonProps:{type:"button"},children:[e.jsx("p",{children:"The autoinstall file you submitted overrides the following fields:"}),e.jsx("ul",{children:d.map(u=>e.jsx("li",{children:u},u))}),e.jsx("p",{children:"Overriding these fields could cause client registration to fail if not formatted correctly."})]})]})},Be="_container_fgz2s_1",qe={container:Be},X=({openAddForm:t})=>e.jsxs(e.Fragment,{children:[e.jsx(be,{actions:e.jsx("div",{className:qe.container,children:e.jsxs(o.Button,{type:"button",className:"u-no-margin",hasIcon:!0,onClick:t,children:[e.jsx(o.Icon,{name:"plus"}),e.jsx("span",{children:"Add new"})]})})}),e.jsx(he,{filtersToDisplay:["search"]})]}),Re={message:"has been edited and all the changes made have been saved successfully.",title:"You have successfully saved changes for"},Ue=({autoinstallFile:t})=>{const{autoinstallFile:s,isAutoinstallFileLoading:a}=W({id:t.id,with_metadata:!0}),{updateAutoinstallFile:n}=Q();return a||!s?e.jsx(x,{}):e.jsxs(e.Fragment,{children:[s.metadata.max_versions<=s.version&&e.jsxs(o.Notification,{title:"Edit history limit reached:",severity:"caution",children:["You've reached the limit of"," ",s.metadata.max_versions," saved"," ",V(s.metadata.max_versions,"edit"),". To save your new change, the oldest version will be automatically removed, keeping the most recent"," ",s.metadata.max_versions," ",V(s.metadata.max_versions,"version")," ","in history."]}),e.jsx(J,{buttonText:"Save changes",description:`The duplicated ${s.filename} will be assigned to the same user groups in the identity provider as the original file.`,initialFile:s,notification:Re,onSubmit:async({contents:i,is_default:l,accept_warning:r})=>{await n({id:s.id,contents:i,is_default:l,accept_warning:r})}})]})},ze="_chip_1aiey_1",He="_container_1aiey_6",q={chip:ze,container:He},E=({file:t,title:s,version:a=t.version})=>e.jsxs("div",{className:q.container,children:[!!s&&`${s} `,t.filename,", v",a,t.is_default&&e.jsx(H,{className:q.chip,value:"Default"})]}),Z=({autoinstallFile:t,close:s})=>{const{notify:a}=w(),{closeSidePanel:n}=y(),{deleteAutoinstallFile:i,isAutoinstallFileDeleting:l}=Le(),r=async()=>{await i({id:t.id}),s(),n(),a.success({message:`The autoinstall file ${t.filename} has been permanently removed. All Employee accounts previously relying on it through identity provider group assignments will now fall back to the default autoinstall file.`,title:`You have successfully removed ${t.filename} autoinstall file.`})};return e.jsx(o.ConfirmationModal,{close:s,confirmButtonAppearance:"negative",confirmButtonLabel:"Remove",onConfirm:r,confirmButtonLoading:l,title:`Remove ${t.filename}, autoinstall file`,children:e.jsxs("p",{children:["You are about to remove ",t.filename,", an autoinstall file. This action is irreversible. All Employee accounts previously assigned this file via identity provider will instead use the default autoinstall file."]})})},Ge=({file:t})=>e.jsxs(F,{children:[e.jsx(F.Item,{label:"Name",value:t.filename}),e.jsx(F.Item,{label:"Version",value:t.version}),e.jsx(F.Item,{label:"Last modified",value:j(t.last_modified_at).format(S)}),e.jsx(F.Item,{label:"Date created",value:j(t.created_at).format(S)})]}),We=m.lazy(async()=>z(()=>import("./index-DbBuokfR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),Ye=({file:t,viewVersionHistory:s})=>{const{setSidePanelContent:a}=y(),{autoinstallFile:n,isAutoinstallFileLoading:i}=W({id:t.id,with_metadata:!0}),[l,r]=m.useState(1),[d,p]=m.useState(ge),A=n?n.metadata.versions:[],v=A.slice(l-1,l*d),I=m.useMemo(()=>[{accessor:"version",Header:"Version",Cell:({row:{original:f}})=>{const T=()=>{a(e.jsx(E,{file:t,version:f.version}),e.jsx(m.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(We,{file:t,goBack:s,versionInfo:f})}))};return e.jsxs(o.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:T,children:["Version ",f.version]})}},{accessor:"created_at",Header:"Created at",Cell:({row:{original:{created_at:f}}})=>e.jsx("div",{className:"font-monospace",children:j(f).format(S)})}],[]);return i?e.jsx(x,{}):e.jsxs(e.Fragment,{children:[e.jsx(o.ModularTable,{columns:I,data:v}),e.jsx(Ie,{currentItemCount:v.length,currentPage:l,pageSize:d,paginate:r,setPageSize:p,totalItems:A.length})]})},Qe="_tabs_1ks86_1",Ke={tabs:Qe},Je=[{id:"info",label:"Info"},{id:"version-history",label:"Version history"}],Xe=({file:t,viewVersionHistory:s,initialTabId:a="info"})=>{const[n,i]=m.useState(a),l=Je.map(({label:r,id:d})=>({label:r,active:d===n,role:"tab",onClick:()=>{i(d)}}));return e.jsxs(e.Fragment,{children:[e.jsx(o.Tabs,{listClassName:Ke.tabs,links:l}),n==="info"&&e.jsx(Ge,{file:t}),n==="version-history"&&e.jsx(Ye,{file:t,viewVersionHistory:s})]})},Ze=({autoinstallFile:t,initialTabId:s})=>{const{value:a,setTrue:n,setFalse:i}=N(),{openAutoinstallFileDetails:l,openAutoinstallFileEditForm:r,setAutoinstallFileAsDefault:d}=te(t),p=()=>{l("version-history")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button",onClick:r,hasIcon:!0,children:[e.jsx(o.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button",onClick:d,disabled:t.is_default,hasIcon:!0,children:[e.jsx(o.Icon,{name:"starred"}),e.jsx("span",{children:"Set as default"})]}),e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button",onClick:n,disabled:t.is_default,hasIcon:!0,children:[e.jsx(o.Icon,{name:o.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]})}),e.jsx(Xe,{initialTabId:s,file:t,viewVersionHistory:p}),a&&e.jsx(Z,{autoinstallFile:t,close:i})]})},ee=()=>{const{setSidePanelContent:t}=y();return(s,a)=>{t(e.jsx(E,{file:s}),e.jsx(m.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(Ze,{initialTabId:a,autoinstallFile:s})}))}},te=t=>{const{notify:s}=w(),{closeSidePanel:a,setSidePanelContent:n}=y(),{updateAutoinstallFile:i}=Q(),l=ee();return{openAutoinstallFileDetails:r=>{l(t,r)},openAutoinstallFileEditForm:()=>{n(e.jsx(E,{file:t,title:"Edit"}),e.jsx(m.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(Ue,{autoinstallFile:t})}))},setAutoinstallFileAsDefault:async()=>{await i({id:t.id,is_default:!0}),a(),s.success({message:"Employee accounts without a specific autoinstall file assigned via the identity provider will now inherit this default file.",title:`You have successfully set ${t.filename} as the default autoinstall file`})}}},et=({autoinstallFile:t})=>{const{value:s,setTrue:a,setFalse:n}=N(),{openAutoinstallFileDetails:i,openAutoinstallFileEditForm:l,setAutoinstallFileAsDefault:r}=te(t),d=()=>{i()},p=[{icon:"show",label:"View details","aria-label":`View ${t.filename} details`,onClick:d},{icon:"edit",label:"Edit","aria-label":`Edit ${t.filename}`,onClick:l},{icon:"starred",label:"Set as default","aria-label":`Set ${t.filename} as default`,onClick:r,disabled:t.is_default}],A=[{icon:"delete",label:"Remove","aria-label":`Remove ${t.filename}`,onClick:a,disabled:t.is_default}];return e.jsxs(e.Fragment,{children:[e.jsx(xe,{toggleAriaLabel:`${t.filename} actions`,actions:p,destructiveActions:A}),s&&e.jsx(Z,{autoinstallFile:t,close:n})]})},tt="_container_56wd4_1",st="_header_56wd4_6",R={container:tt,header:st},nt=({column:t})=>{{const s={};switch(t.id){case"filename":s.role="rowheader";break;case"last_modified_at":s["aria-label"]="last modified at";break}return s}},at=()=>({}),se=({autoinstallFiles:t})=>{const s=ee(),a=m.useMemo(()=>[{...Te,accessor:"filename",Header:e.jsxs("div",{className:R.header,children:["Name",e.jsx("span",{className:"u-text--muted",children:"Version"})]}),Cell:({row:{original:n}})=>e.jsxs(Ae,{children:[e.jsxs("div",{className:R.container,children:[e.jsx(o.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top u-align-text--left",onClick:()=>{s(n)},children:n.filename}),n.is_default&&e.jsx(H,{value:"Default"})]}),e.jsxs("span",{className:"u-text--muted",children:["Version ",n.version]})]})},{accessor:"last_modified_at",Header:"Last edited",Cell:({row:{original:{last_modified_at:n}}})=>e.jsx("div",{className:"font-monospace",children:j(n).format(S)})},{...je,Cell:({row:{original:n}})=>e.jsx(et,{autoinstallFile:n})}],[]);return e.jsx(_e,{columns:a,data:t,emptyMsg:"No autoinstall files found according to your search parameters.",getCellProps:nt,getRowProps:at})},it=Object.freeze(Object.defineProperty({__proto__:null,AutoinstallFileForm:J,AutoinstallFilesHeader:X,AutoinstallFilesList:se,useAddAutoinstallFile:G,useGetAutoinstallFiles:Y},Symbol.toStringTag,{value:"Module"})),lt={message:"is now available and can be assigned to identity provider user groups.",title:"You have successfully added"},ot=m.lazy(async()=>z(()=>Promise.resolve().then(()=>it),void 0).then(t=>({default:t.AutoinstallFileForm}))),rt=()=>{const{currentPage:t,pageSize:s,search:a}=ye(),{setSidePanelContent:n}=y(),{addAutoinstallFile:i}=G(),{autoinstallFiles:l,autoinstallFilesCount:r,isAutoinstallFilesLoading:d}=Y({limit:s,offset:(t-1)*s,search:a}),p=()=>{n("Add new autoinstall file",e.jsx(m.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(ot,{buttonText:"Add",description:"Add autoinstall file. It can be applied during the initial setup of associated instances.",notification:lt,onSubmit:i})}))};return!l.length&&!a&&!d?e.jsx(ve,{icon:"file",title:"No autoinstall files found",body:e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any autoinstall files yet."}),cta:[e.jsx(o.Button,{appearance:"positive",onClick:p,className:"u-no-margin--right",children:"Add autoinstall file"},"add-autoinstall-file")]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{openAddForm:p}),d?e.jsx(x,{}):e.jsx(se,{autoinstallFiles:l}),e.jsx(Fe,{currentItemCount:l.length,totalItems:r})]})},At=Object.freeze(Object.defineProperty({__proto__:null,default:rt},Symbol.toStringTag,{value:"Module"}));export{M as A,P as a,At as b,B as r,W as u};
