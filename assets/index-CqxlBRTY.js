const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CRXJMj8B.js","assets/index-DdVy3CIu.js","assets/index-DCq_vsqr.css","assets/useInstances-uWwQvNUT.js","assets/useFetchOld-CHfQedZ7.js","assets/SidePanelFormButtons-CKYzlbXP.js","assets/SidePanelFormButtons.module-D2P5PizG.js","assets/SidePanelFormButtons-JM1G8Sq6.css","assets/useRoles-SNBAHG3A.js","assets/index-CFeqfHLj.js","assets/CodeEditor-DCDAlWlp.js","assets/index-CzMCzDjk.js","assets/CodeEditor-CwlLRp3p.css","assets/usePageParams-CcklzBaA.js","assets/index-C4ym0nfD.css","assets/index-DQ4z-VN9.js","assets/EmployeeGroupIdentityIssuerList-7ekPTM7W.js","assets/TablePagination-DcRP3nto.js","assets/TablePaginationBase-ZnL0qmAy.js","assets/TablePaginationBase-CJl3HN1X.css","assets/TableFilter-CDgyuP9F.js","assets/TableFilter-CNw_lMaf.css","assets/TableFilterChips-3QiSvy-H.js","assets/TableFilterChips-CHqetGbX.css","assets/HeaderWithSearch-w77Jjk9W.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/TruncatedCell-DGWBciT5.js","assets/TruncatedCell-CoXbu3VM.css","assets/EmployeeGroupIdentityIssuerList-DJkUyphv.css","assets/EmployeeList-Dx8MDzxu.js","assets/NoData-Chqc7NTj.js","assets/EmployeeList-BthGffhq.css","assets/downshift.esm-BnOKdrr7.js","assets/index-CbvjFctk.css"])))=>i.map(i=>d[i]);
import{j as e,m as y,$ as ce,r as i,g as n,k as ie,a0 as de,V as ue,n as V,D as me,h as pe,H as he,i as fe,a as ge,p as xe,q as _e,f as be,s as Z,I as je,_ as G}from"./index-DdVy3CIu.js";import{u as K}from"./useInstances-uWwQvNUT.js";import{u as ye}from"./WslInstancesHeader-B3Ms3ApV.js";import{m as te,h as ne}from"./usePageParams-CcklzBaA.js";import{u as ve}from"./useRoles-SNBAHG3A.js";import{N as j}from"./NoData-Chqc7NTj.js";import{u as Ie}from"./index-DTjKue4r.js";import{b as we}from"./helpers-DxtHhVlv.js";import"./InstancesPageActions-DZ0y7iGp.js";import{g as se}from"./formikErrors-Bw8iTXYS.js";import"./useFetchOld-CHfQedZ7.js";import"./HeaderWithSearch-w77Jjk9W.js";import"./TableFilterChips-3QiSvy-H.js";import"./TablePagination-DcRP3nto.js";import"./TablePaginationBase-ZnL0qmAy.js";import"./StatusFilter-DAfk9Cb4.js";import"./TableFilter-CDgyuP9F.js";const Ce="_infoContainer_1ca11_1",Se="_amount_1ca11_9",ae={infoContainer:Ce,amount:Se},Ne=({isExpanded:t,overflowingChipsAmount:s})=>s>0&&!t&&e.jsx("div",{className:ae.infoContainer,children:e.jsx("span",{className:y("u-text--muted",ae.amount),children:`+${s}`})}),Ae=({containerRef:t,onDismiss:s,onOverflowingItemsAmountChange:l,tagData:d})=>{const u=()=>{if(!t.current)return;const r=t.current.querySelectorAll("span.p-chip");l(Array.from(r).filter(({offsetHeight:f,offsetTop:m})=>m>f).length)};return ce("resize",u),i.useEffect(()=>{u()},[d.length]),d.map(r=>e.jsx(n.Chip,{value:r,onDismiss:()=>s(r)},r))},Te="_container_1f6mu_1",ke="_list_1f6mu_6",Be="_listItem_1f6mu_11",Ee="_search_1f6mu_17",z={container:Te,list:ke,listItem:Be,search:Ee},Re=({onTagClick:t,tags:s})=>s.length?e.jsxs("div",{className:z.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Tags"}),e.jsx("ul",{className:y("p-list--divided u-no-margin--bottom",z.list),children:s.map(l=>e.jsx("li",{children:e.jsx("div",{className:z.listItem,children:e.jsx(n.Button,{type:"button",appearance:"base",className:z.search,onClick:()=>t(l),children:l})})},l))})]}):null,De="_container_fqj7b_1",Le="_prompt_fqj7b_10",Pe="_saveButton_fqj7b_17",Y={container:De,prompt:Le,saveButton:Pe},$e=({onTagAdd:t,search:s})=>e.jsx(e.Fragment,{children:s&&e.jsxs("div",{className:Y.container,children:[e.jsxs("span",{className:Y.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:s}),e.jsx("span",{children:"..."})]}),e.jsx(n.Button,{type:"button",appearance:"link",onClick:t,className:Y.saveButton,children:"Add tag"})]})}),oe=ie().matches(/^[a-zA-Z]/,{message:"Tag must starts with a letter",excludeEmptyString:!0}).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,{message:"Tag can only contain letters, numbers, hyphens, and underscores",excludeEmptyString:!0}),ze="_searchContainer_qgkjy_1",Fe="_box_qgkjy_8",Ve="_inputContainer_qgkjy_13",qe="_inputError_qgkjy_18",F={searchContainer:ze,box:Fe,inputContainer:Ve,inputError:qe},Oe=({onTagsChange:t,tags:s,label:l,labelClassName:d,required:u})=>{var C;const[r,f]=i.useState(""),[m,_]=i.useState(""),[q,k]=i.useState(!1),[S,O]=i.useState(""),[x,v]=i.useState(!1),[N,M]=i.useState(0),{height:B}=de(),[Q,b]=i.useState({top:"100%",bottom:"auto"}),{getAllInstanceTagsQuery:H}=K(),A=i.useRef(null),p=i.useRef(null);i.useEffect(()=>{if(!p.current)return;const a=p.current.querySelector("input");a&&O(a.id)},[p.current]),i.useEffect(()=>{!x||!p.current||E()},[B,x,p.current,(C=p.current)==null?void 0:C.clientHeight]);const E=()=>{if(!p.current)return;const{top:a,height:h}=p.current.getBoundingClientRect();a+h+379<B?b({top:"100%",bottom:"auto"}):b({top:"auto",bottom:"100%"})},R=()=>{v(!1)};ue(A,R);const D=a=>{t(s.filter(h=>h!==a))},{data:I,isLoading:w}=H(),J=i.useMemo(()=>I?!r&&!s.length?I.data.results:I.data.results.filter(a=>!s.includes(a)).filter(a=>a.toLowerCase().includes(r.trim().toLowerCase())):[],[I,r,s]),c=a=>{t([...s,a])},T=()=>{if(r.trim())try{const a=oe.validateSync(r.trim())??"";c(a),f(""),_(""),k(!1)}catch(a){a instanceof Error&&(_(a.message),k(!0))}},L=a=>{if(f(a.target.value),q)try{oe.validateSync(a.target.value),_("")}catch(h){h instanceof Error&&_(h.message)}},U=a=>{const{key:h}=a;x?(h==="Escape"&&R(),h==="Enter"&&T()):h==="Enter"&&v(!0)};return e.jsxs("div",{children:[e.jsx("label",{className:y("p-form__label",{"is-required":u},d),htmlFor:S,children:l||"Tags"}),e.jsxs("div",{className:"p-search-and-filter",ref:A,children:[e.jsxs("div",{className:y("p-search-and-filter__search-container",F.searchContainer),"aria-expanded":x,ref:p,onClick:()=>v(!0),children:[e.jsx(Ae,{containerRef:p,onDismiss:D,onOverflowingItemsAmountChange:a=>M(a),tagData:s}),e.jsx("div",{className:y("p-search-and-filter__box",F.box),children:e.jsx("div",{className:F.inputContainer,children:e.jsx(n.Input,{type:"text",autoComplete:"off",value:r,onChange:L,placeholder:"Add tags",className:"u-no-margin--bottom",onClick:()=>v(!0),onKeyUp:U,wrapperClassName:m?"is-error":"","aria-errormessage":m?`${S}-error`:void 0,"aria-invalid":!!m})})}),m&&e.jsx("div",{className:"is-error",children:e.jsxs("p",{className:y("p-form-validation__message",F.inputError),id:`${S}-error`,children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:m})]})}),e.jsx(Ne,{isExpanded:x,overflowingChipsAmount:N})]}),x&&w&&e.jsx(V,{}),x&&!w&&e.jsxs("div",{className:"p-search-and-filter__panel",style:Q,children:[e.jsx($e,{onTagAdd:T,search:r}),e.jsx(Re,{onTagClick:c,tags:J})]})]})]})},Me=t=>{var l;const s=(l=t.grouped_hardware)==null?void 0:l.network;return!Array.isArray(s)||s.length===0?e.jsx(j,{}):s.filter(({ip:d})=>d!=="Not available").map(({ip:d})=>d).join(", ")||e.jsx(j,{})},Qe=(t,s)=>{var l,d,u;return[{label:"instance ID",value:t.id},{label:"Hostname",value:t.hostname},{label:"IP Address",value:Me(t)},{label:"Serial number",value:((l=t.grouped_hardware)==null?void 0:l.system.serial)??e.jsx(j,{})},{label:"Product identifier",value:((d=t.grouped_hardware)==null?void 0:d.system.model)??e.jsx(j,{})},{label:"Distribution",value:t.distribution??"Unknown"},{label:"Access group",value:((u=s.find(({value:r})=>r===t.access_group))==null?void 0:u.label)||t.access_group},{label:"Last ping time",value:t.last_ping_time&&te(t.last_ping_time).isValid()?te(t.last_ping_time).format(me):e.jsx(j,{})},{label:"Annotations",value:t.annotations?Object.entries(t.annotations).map(([r,f],m,_)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:`${r}: ${f}`}),m<_.length-1&&e.jsx("br",{})]})):e.jsx(j,{})},{label:"Comment",value:t.comment||e.jsx(j,{})}]},He="_titleRow_lxk0r_1",Ue="_flexContainer_lxk0r_6",We="_italic_lxk0r_11",Ze="_infoRow_lxk0r_15",Ye="_tagSection_lxk0r_20",Ke="_tagsRow_lxk0r_25",Ge="_tagsButton_lxk0r_33",g={titleRow:He,flexContainer:Ue,italic:We,infoRow:Ze,tagSection:Ye,tagsRow:Ke,tagsButton:Ge},Je={deliver_after:"",deliverImmediately:!0,action:null},Xe=pe().shape({deliver_after:ie().when("deliverImmediately",{is:!1,then:t=>t.required("This field is required").test({message:"Invalid date",test:s=>ne(s).isValid()}).test({message:"Date must be in the future",test:s=>ne(s).isAfter()})}),deliverImmediately:fe(),action:he().oneOf(["shutdown","reboot"]).required()}),et=i.lazy(async()=>G(()=>import("./index-CRXJMj8B.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),tt=i.lazy(async()=>G(()=>import("./index-CFeqfHLj.js").then(t=>t.i),__vite__mapDeps([9,1,2,10,11,12,5,6,7,4,8,13,14])).then(t=>({default:t.RunInstanceScriptForm}))),nt=i.lazy(async()=>G(()=>import("./index-DQ4z-VN9.js"),__vite__mapDeps([15,1,2,5,6,7,13,11,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]))),jt=({instance:t})=>{const[s,l]=i.useState(t.tags),d=ge(),u=xe(),{openActivityDetails:r}=Ie(),{notify:f}=_e(),{setSidePanelContent:m}=be(),{getAccessGroupQuery:_}=ve(),{removeInstancesQuery:q,rebootInstancesQuery:k,sanitizeInstanceQuery:S,shutdownInstancesQuery:O}=K(),{deleteChildInstancesQuery:x}=ye(),{editInstanceQuery:v}=K();i.useEffect(()=>{l(t.tags)},[t.tags]);const{data:N}=_(),M=(N==null?void 0:N.data.map(({name:o,title:$})=>({label:$,value:o})))??[],{mutateAsync:B}=v,{mutateAsync:Q,isPending:b}=q,{mutateAsync:H,isPending:A}=k,{mutateAsync:p,isPending:E}=O,{mutateAsync:R,isPending:D}=x,{mutateAsync:I,isPending:w}=S,c=Z({initialValues:Je,validationSchema:Xe,onSubmit:async o=>{if(!o.action)return;const $={computer_ids:[t.id],deliver_after:o.deliverImmediately?void 0:`${o.deliver_after}:00Z`};try{const{data:W}=o.action==="reboot"?await H($):await p($),ee=o.action==="reboot"?"restarted":"shut down";f.success({title:`You queued "${t.title}" to be ${ee}`,message:`Instance "${t.title}" will be ${ee} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{r(W)}}]})}catch(W){u(W)}}}),T=async()=>{try{await Q({computer_ids:[t.id]}),d("/instances",{replace:!0})}catch(o){u(o)}},L=async()=>{try{const{data:o}=await I({computer_id:t.id,computer_title:t.title});f.success({title:`You have successfully initiated Sanitization for ${t.title}`,message:`Sanitizing for ${t.title} has been queued in Activities. The data will be permanently irrecoverable once complete.`,actions:[{label:"View details",onClick:()=>{r(o)}}]})}catch(o){u(o)}},U=Z({initialValues:{confirmationText:""},onSubmit:async()=>T()}),C=Z({initialValues:{confirmationText:""},onSubmit:async()=>L()}),a=async()=>{try{await B({instanceId:t.id,tags:s}),f.success({title:"Tags updated",message:`"${t.title}" instance tags have been updated successfully`})}catch(o){u(o)}},h=()=>{m("Edit Instance",e.jsx(i.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(et,{instance:t})}))},X=()=>{m("Run script",e.jsx(i.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(tt,{query:`id:${t.id}`})}))},re=()=>{m(`Associate Employee with ${t.title}`,e.jsx(i.Suspense,{fallback:e.jsx(V,{}),children:e.jsx(nt,{instanceTitle:t.title,employeeId:t.employee_id})}))},le=async()=>{try{await R({computer_ids:[t.id]}),d("/instances",{replace:!0})}catch(o){u(o)}},P=async o=>{await c.setFieldValue("action",o),c.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:g.titleRow,children:[e.jsxs("div",{className:g.flexContainer,children:[e.jsx("h2",{className:"p-heading--4 u-no-padding--top u-no-margin--bottom",children:t.title}),t.is_wsl_instance&&e.jsx("p",{className:y("u-text--muted u-no-margin--bottom",g.italic),children:"WSL Instance"})]}),e.jsxs("div",{className:g.flexContainer,children:[t.is_wsl_instance&&e.jsx(n.ConfirmationButton,{className:"u-no-margin--bottom u-no-margin--right",type:"button",confirmationModalProps:{title:"Delete instance",children:e.jsxs("p",{children:["This will permanently delete the instance"," ",e.jsx("b",{children:t.title})," from both the Windows host machine and Landscape."]}),confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:D,confirmButtonLoading:D,onConfirm:le},children:"Delete instance"}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:h,children:[e.jsx(n.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),we("runScripts",t)&&e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:X,children:[e.jsx(n.Icon,{name:"code"}),e.jsx("span",{children:"Run script"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:b,confirmationModalProps:{title:"Remove instance from Landscape",children:e.jsxs(n.Form,{onSubmit:c.handleSubmit,noValidate:!0,children:[e.jsxs("p",{children:["Removing this ",t.title," will delete all associated data and free up one license slot for another computer to be registered."]}),e.jsxs("p",{children:["Type ",e.jsxs("b",{children:["remove ",t.title]})," to confirm."]}),e.jsx(n.Input,{type:"text",...U.getFieldProps("confirmationText")})]}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:b,confirmButtonLoading:b,onConfirm:T},children:[e.jsx(n.Icon,{name:n.ICONS.delete}),e.jsx("span",{children:"Remove from Landscape"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:w,confirmationModalProps:{title:"Sanitize instance",children:e.jsxs(n.Form,{onSubmit:C.handleSubmit,noValidate:!0,children:[e.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for ",t.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]}),e.jsxs("p",{children:["Type ",e.jsxs("b",{children:["sanitize ",t.title]})," to confirm."]}),e.jsx(n.Input,{type:"text",...C.getFieldProps("confirmationText")})]}),confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:w||C.values.confirmationText!==`sanitize ${t.title}`,confirmButtonLoading:w,onConfirm:L},children:[e.jsx(n.Icon,{name:"tidy"}),e.jsx("span",{children:"Sanitize"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:b,confirmationModalProps:{title:"Restart instance",children:e.jsxs(n.Form,{onSubmit:async()=>P("reboot"),noValidate:!0,children:[e.jsx(n.CheckboxInput,{label:"Deliver as soon as possible",...c.getFieldProps("deliverImmediately"),checked:c.values.deliverImmediately}),e.jsx(n.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:g.input,placeholder:"Scheduled time",...c.getFieldProps("deliver_after"),disabled:c.values.deliverImmediately,error:se(c,"deliver_after")}),e.jsxs("p",{children:['This will restart "',t.title,'" instance.']})]}),confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonDisabled:A,confirmButtonLoading:A,onConfirm:async()=>P("reboot")},children:[e.jsx(n.Icon,{name:"restart"}),e.jsx("span",{children:"Restart"})]}),e.jsxs(n.Button,{className:"p-segmented-control__button u-no-margin--bottom",type:"button",onClick:re,children:[e.jsx(n.Icon,{name:n.ICONS.user}),e.jsx("span",{children:"Associate employee"})]}),e.jsxs(n.ConfirmationButton,{className:"p-segmented-control__button u-no-margin--bottom has-icon",type:"button",disabled:b,confirmationModalProps:{title:"Shut down instance",children:e.jsxs(n.Form,{onSubmit:async()=>P("shutdown"),noValidate:!0,children:[e.jsx(n.CheckboxInput,{label:"Deliver as soon as possible",...c.getFieldProps("deliverImmediately"),checked:c.values.deliverImmediately}),e.jsx(n.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",className:g.input,placeholder:"Scheduled time",...c.getFieldProps("deliver_after"),disabled:c.values.deliverImmediately,error:se(c,"deliver_after")}),e.jsxs("p",{children:['This will shut down "',t.title,'" instance.']})]}),confirmButtonLabel:"Shutdown",confirmButtonAppearance:"negative",confirmButtonDisabled:E,confirmButtonLoading:E,onConfirm:async()=>P("shutdown")},children:[e.jsx(n.Icon,{name:"power-off"}),e.jsx("span",{children:"Shutdown"})]})]})},"buttons")]})]}),e.jsx("div",{className:g.infoRow,children:e.jsx(n.Row,{className:"u-no-padding--left u-no-padding--right u-no-max-width",children:Qe(t,M).map(o=>e.jsx(n.Col,{size:4,children:e.jsx(je,{...o})},o.label))})}),e.jsx("div",{className:g.tagSection,children:e.jsxs(n.Row,{className:g.tagsRow,children:[e.jsx(n.Col,{size:4,children:e.jsx(Oe,{labelClassName:"p-text--small p-text--small-caps u-text--muted",onTagsChange:o=>{l(o)},tags:s})}),e.jsx(n.Col,{size:2,className:g.tagsButton,children:e.jsx(n.Button,{type:"button",className:"u-no-margin--bottom",onClick:a,children:"Update"})})]})})]})};export{jt as default};
