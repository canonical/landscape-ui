import{d as Z,c as ee,e as F,k as I,f as P,j as e,g as a,r as j,_ as Q,o as se,l as te,h as re,p as S}from"./index-BtF_YtUH.js";import{E as oe}from"./EmptyState-DEWIlzdx.js";import"./TablePagination.module-DLVph1Z1.js";import{T as ne}from"./TablePagination-CPoFi906.js";import{u as k}from"./useMutation-BYbif-23.js";import{u as v}from"./useQuery-BwHZd3cH.js";import{u as ae}from"./useConfirm-DuPebGn3.js";import{u as ce}from"./formik.esm--mvEdW23.js";import{c as ie,a as y,e as ue}from"./index.esm-CM4zsSNH.js";import{S as le}from"./SidePanelFormButtons-DlLMSK5f.js";import{g as de,r as E,U as q,a as me}from"./helpers-DTRqF_Sv.js";import{u as B}from"./usePageParams-ChNXzzdf.js";function $(){const o=Z(),n=ee(),c=F(),u=(t,h={})=>v({queryKey:["users",{...t}],queryFn:()=>o.get("users",{params:t}),...h}),m=k({mutationKey:["users","new"],mutationFn:t=>o.post("users",t),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}}),l=k({mutationKey:["users","edit"],mutationFn:t=>o.put("users",t),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}}),x=k({mutationKey:["users","remove"],mutationFn:t=>o.delete("users",{params:t}),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}}),b=k({mutationKey:["users","lock"],mutationFn:t=>o.post("users/lock",t),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}}),p=k({mutationKey:["users","unlock"],mutationFn:t=>o.post("users/unlock",t),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}}),d=(t,h={})=>v({queryKey:["groups",t.computer_id],queryFn:()=>o.get(`computers/${t.computer_id}/groups`),...h}),r=(t,h={})=>v({queryKey:["userGroups",t.computer_id,t.username],queryFn:()=>o.get(`computers/${t.computer_id}/users/${t.username}/groups`),...h}),g=k({mutationKey:["groups","add"],mutationFn:t=>o.post(`computers/${t.computer_id}/usergroups/update_bulk`,t),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}}),s=k({mutationKey:["groups","remove"],mutationFn:t=>o.post(`computers/${t.computer_id}/usergroups/update_bulk`,t),onSuccess:()=>{n.invalidateQueries(["users"]).catch(c)}});return{getUsersQuery:u,getGroupsQuery:d,getUserGroupsQuery:r,createUserQuery:m,removeUserQuery:x,editUserQuery:l,lockUserQuery:b,unlockUserQuery:p,addUserToGroupQuery:g,removeUserFromGroupQuery:s}}const pe="_headerContainer_j1328_1",he="_searchContainer_j1328_6",D={headerContainer:pe,searchContainer:he},T=()=>{const{instanceId:o}=I(),n=F(),{closeSidePanel:c}=P(),{createUserQuery:u,getGroupsQuery:m}=$(),l=Number(o),{mutateAsync:x,isLoading:b}=u,{data:p,isLoading:d}=m({computer_id:l}),g=((p==null?void 0:p.data.groups)??[]).map(t=>({label:t.name,value:t.name})),s=ce({initialValues:{name:"",username:"",password:"",confirmPassword:"",requirePasswordReset:!1,location:"",homePhoneNumber:"",workPhoneNumber:"",primaryGroupValue:""},validationSchema:ie().shape({name:y().required("This field is required"),username:y().required("This field is required"),password:y().required("This field is required"),confirmPassword:y().required("This field is required").oneOf([ue("password"),""],"Passwords must match"),location:y(),homePhoneNumber:y(),workPhoneNumber:y(),primaryGroupValue:y().required("This field is required")}),onSubmit:async t=>{try{await x({computer_ids:[l],name:t.name,username:t.username,password:t.password,require_password_reset:t.requirePasswordReset,location:t.location,home_phone:t.homePhoneNumber,work_phone:t.workPhoneNumber,primary_groupname:t.primaryGroupValue}),c()}catch(h){n(h)}}});return e.jsxs(a.Form,{noValidate:!0,onSubmit:s.handleSubmit,name:"add-new-user",children:[e.jsx(a.Input,{type:"text",label:"Username",autoComplete:"new-username",required:!0,error:s.touched.username&&s.errors.username?s.errors.username:void 0,...s.getFieldProps("username")}),e.jsx(a.Input,{type:"text",label:"Name",required:!0,error:s.touched.name&&s.errors.name?s.errors.name:void 0,...s.getFieldProps("name")}),e.jsx(a.Input,{type:"password",label:"Passphrase",autoComplete:"new-password",required:!0,error:s.touched.password&&s.errors.password?s.errors.password:void 0,...s.getFieldProps("password")}),e.jsx(a.Input,{type:"password",label:"Confirm passphrase",autoComplete:"new-password",required:!0,error:s.touched.confirmPassword&&s.errors.confirmPassword?s.errors.confirmPassword:void 0,...s.getFieldProps("confirmPassword")}),e.jsx(a.Input,{type:"checkbox",label:"Require passphrase reset",help:"User must change password at first login",...s.getFieldProps("requirePasswordReset"),checked:s.values.requirePasswordReset}),e.jsx(a.Select,{label:"Primary Group",disabled:d,options:[{label:"Select",value:""},...g],...s.getFieldProps("primaryGroupValue"),error:s.touched.primaryGroupValue&&s.errors.primaryGroupValue?s.errors.primaryGroupValue:void 0}),e.jsx(a.Input,{type:"text",label:"Location",error:s.touched.location&&s.errors.location?s.errors.location:void 0,...s.getFieldProps("location")}),e.jsx(a.Input,{type:"text",label:"Home phone",error:s.touched.homePhoneNumber&&s.errors.homePhoneNumber?s.errors.homePhoneNumber:void 0,...s.getFieldProps("homePhoneNumber")}),e.jsx(a.Input,{type:"text",label:"Work phone",error:s.touched.workPhoneNumber&&s.errors.workPhoneNumber?s.errors.workPhoneNumber:void 0,...s.getFieldProps("workPhoneNumber")}),e.jsx(le,{submitButtonDisabled:b,submitButtonText:"Add user"})]})},ge="_cta_hpksw_1",xe={cta:ge},be=j.lazy(()=>Q(()=>import("./index-DrMXUL1-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))),je=({selectedUsers:o,handleClearSelection:n,sidePanel:c=!1})=>{const[u,m]=j.useState(!1),{instanceId:l}=I(),x=se("(min-width: 620px)"),b=F(),{notify:p}=te(),{setSidePanelContent:d,closeSidePanel:r}=P(),{confirmModal:g,closeConfirmModal:s}=ae(),{removeUserQuery:t,lockUserQuery:h,unlockUserQuery:U}=$(),{mutateAsync:C}=t,{mutateAsync:_}=h,{mutateAsync:w}=U,M=Number(l),i=o.length===1?o[0]:void 0,{locked:G,unlocked:V}=de(o),N=async(f,A)=>{try{await f({computer_ids:[M],usernames:me(o),delete_home:A==="removed"?u:void 0}),n&&n(),r(),p.success({message:`Successfully requested to be ${A}`})}catch(J){b(J)}finally{s()}},R=async()=>{await N(_,"locked")},K=async()=>{await N(w,"unlocked")},O=async()=>{await N(C,"removed")},z=()=>{d("Add new user",e.jsx(T,{}))},H=f=>{d("Edit user",e.jsx(j.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(be,{user:f})}))},Y=async()=>{g({title:`Delete ${i?i.username:"users"}`,body:e.jsxs("div",{children:[e.jsx("p",{className:"u-no-margin--bottom",children:i?`This will delete user ${i.username}. You can delete this user's home folders at the same time`:"This will delete selected users. You can delete their home folders as well"}),e.jsx(a.Input,{label:"Delete the home folders as well",type:"checkbox",onChange:()=>m(f=>!f)})]}),buttons:[e.jsx(a.Button,{appearance:"negative",onClick:O,children:"Delete"},"remove")]})},W=async()=>{g({title:`Lock ${i?`user ${i.username}`:`${o.length} users`}`,body:E({user:i,selectedUsers:o,userAction:q.Lock}),buttons:[e.jsx(a.Button,{appearance:"positive",onClick:R,children:"Lock"},"lock")]})},X=async()=>{g({title:`Unlock ${i?`user ${i.username}`:`${o.length} users`}`,body:E({user:i,selectedUsers:o,userAction:q.Unlock}),buttons:[e.jsx(a.Button,{appearance:"positive",onClick:K,children:"Unlock"},"unlock")]})};return e.jsxs("div",{className:re("p-panel__controls u-no-padding--top",{"u-no-margin--left":c,[xe.cta]:!c&&x}),children:[!c&&e.jsxs(a.Button,{hasIcon:!0,onClick:z,className:"u-no-margin--right",children:[e.jsx(a.Icon,{name:"plus"}),e.jsx("span",{children:"Add user"})]}),e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[((i==null?void 0:i.enabled)||!c)&&e.jsxs(a.Button,{disabled:V===0,onClick:W,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"lock-locked"}),e.jsx("span",{children:"Lock"})]}),(!(i!=null&&i.enabled)||!c)&&e.jsxs(a.Button,{disabled:G===0,onClick:X,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"lock-unlock"}),e.jsx("span",{children:"Unlock"})]}),c&&i&&e.jsxs(a.Button,{onClick:()=>H(i),className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(a.Button,{disabled:o.length===0,onClick:Y,className:"p-segmented-control__button",children:[e.jsx(a.Icon,{name:"delete"}),e.jsx("span",{children:"Delete"})]})]})})]})},ye=(o,n)=>o.filter(c=>n.includes(c.uid)),ke=({selected:o,handleClearSelection:n,users:c})=>{const{search:u,setPageParams:m}=B(),[l,x]=j.useState(u),b=()=>{m({search:l}),n()},p=()=>{m({search:""})},d=r=>{r.preventDefault(),b()};return e.jsxs("div",{className:D.headerContainer,children:[e.jsx("div",{className:D.searchContainer,children:e.jsx(a.Form,{onSubmit:d,noValidate:!0,children:e.jsx(a.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,value:l,onChange:r=>x(r),onClear:p})})}),e.jsx(je,{handleClearSelection:n,selectedUsers:ye(c,o)})]})},_e="_status_1n2s0_1",fe="_actions_1n2s0_7",L={status:_e,actions:fe},Ue=j.lazy(()=>Q(()=>import("./index-DrMXUL1-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))),we=j.lazy(()=>Q(()=>import("./index-rZ4imrdX.js"),__vite__mapDeps([21,1,2,22,23,24,11,12,13,14,15,16,17,18,19,3,4,5,6,7,20]))),Se=({users:o,selected:n,setSelected:c})=>{const{setSidePanelContent:u}=P(),m=r=>{u("Edit user",e.jsx(j.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Ue,{user:r})}))},l=r=>{u("User details",e.jsx(j.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(we,{user:r})}))},x=()=>{c(n.length!==0?[]:o.map(({uid:r})=>r))},b=r=>{n.includes(r.uid)?c(n.filter(g=>g!==r.uid)):c([...n,r.uid])},p=[{content:e.jsxs(e.Fragment,{children:[e.jsx(a.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),checked:n.length===o.length&&o.length>0,onChange:x,indeterminate:n.length>0&&n.length<o.length}),e.jsx("span",{children:"USERNAME"})]})},{content:"Status",sortKey:"status"},{content:"UID"},{content:"Full Name"},{content:""}],d=o.map(r=>({columns:[{content:e.jsxs(e.Fragment,{children:[e.jsx(a.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:`Select user ${r.username}`}),checked:n.includes(r.uid),onChange:()=>b(r)}),e.jsx(a.Button,{appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{l(r)},"aria-label":`Show details of user ${r.username}`,children:r.username})]}),role:"rowheader","aria-label":`User ${r.username}`},{content:e.jsx("div",{className:L.status,children:r.enabled?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"p-icon--lock-unlock"}),e.jsx("span",{children:"Unlocked"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"p-icon--lock-locked-active"}),e.jsx("span",{children:"Locked"})]})}),"aria-label":`User ${r.username} status`},{content:r.uid,"aria-label":"uid"},{content:r.name?r.name:"-","aria-label":"full name"},{className:L.actions,content:e.jsxs(a.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left p-tooltip--btm-center","aria-label":`Edit ${r.name} profile`,onClick:()=>m(r),children:[e.jsx("span",{className:"p-tooltip__message",children:"Edit"}),e.jsx("i",{className:"p-icon--edit u-no-margin--left"})]})}],sortData:{status:r.enabled,uid:r.uid,fullname:r.username}}));return e.jsx(a.MainTable,{headers:p,rows:d,sortable:!0})},Pe=(o,n)=>o?n.filter(({username:c,name:u})=>{const m=u==null?void 0:u.toUpperCase().includes(o.toUpperCase()),l=c.toUpperCase().includes(o.toUpperCase());return m||l}):n,Ce=1e3,Ne=()=>{const[o,n]=j.useState([]),{instanceId:c}=I(),{search:u,currentPage:m,pageSize:l}=B(),{setSidePanelContent:x}=P(),{getUsersQuery:b}=$(),p=Number(c),{data:d,isLoading:r}=b({computer_id:p,limit:Ce}),g=(d==null?void 0:d.data.results)??[],s=j.useMemo(()=>Pe(u,g),[u,g]),h=((_,w)=>s.slice(w,w+_))(l,(m-1)*l),U=()=>{n([])},C=()=>{x("Add new user",e.jsx(T,{}))};return e.jsxs(e.Fragment,{children:[r&&e.jsx(S,{}),!r&&(!d||d.data.results.length===0)&&e.jsx(oe,{title:"No users found",body:"Add new users by clicking the button below",icon:"connected",cta:[e.jsx(a.Button,{appearance:"positive",onClick:C,children:"Add user"},"empty-state-add-new-user")]}),!r&&s.length&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{selected:o,handleClearSelection:U,users:h}),e.jsx(Se,{selected:o,setSelected:_=>n(_),users:h})]}),e.jsx(ne,{handleClearSelection:U,totalItems:s.length,currentItemCount:h.length})]})},ve=Ne,Ge=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{je as U,Ge as i,$ as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-DrMXUL1-.js","assets/index-BtF_YtUH.js","assets/index-BAlneFez.css","assets/formik.esm--mvEdW23.js","assets/index.esm-CM4zsSNH.js","assets/SidePanelFormButtons-DlLMSK5f.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/MultiSelectField-D1BhrwhL.js","assets/MultiSelectField.module-D1r8qo_i.js","assets/MultiSelectField-B2rqRhX9.css","assets/EmptyState-DEWIlzdx.js","assets/EmptyState-BNXajmMK.css","assets/TablePagination.module-DLVph1Z1.js","assets/TablePagination-JK-zjkSx.css","assets/TablePagination-CPoFi906.js","assets/usePageParams-ChNXzzdf.js","assets/useMutation-BYbif-23.js","assets/useQuery-BwHZd3cH.js","assets/useConfirm-DuPebGn3.js","assets/helpers-DTRqF_Sv.js","assets/index-rZ4imrdX.js","assets/InfoItem-BeNSkrT3.js","assets/InfoItem.module-BZ3tYMsb.js","assets/InfoItem-BbayMzTk.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
