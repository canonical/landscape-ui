const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Ck47OtQT.js","assets/index-BniO5lih.js","assets/index-zG6MToCc.css","assets/SidePanelFormButtons-bG-J2X_B.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/useRoles-DRKlPdx8.js"])))=>i.map(i=>d[i]);
import{H as x,ag as f,o as p,w as j,C as w,j as e,d as u,ay as N,aZ as F,az as R,L as E,x as b,R as k,z as I,B as M,a4 as D,ad as G,r as d,N as B,aM as O,y as A,i as m,E as $,a7 as C}from"./index-BniO5lih.js";import{P as H,a as V,b as z}from"./PageMain-DMSiaUeu.js";import{u as y}from"./useRoles-DRKlPdx8.js";import{L as q}from"./constants-HWGNn3R9.js";import{u as _}from"./useGetInstances-CYwqcOV3.js";const ce={title:"",parent:f},le=x().shape({title:p().required("This field is required"),parent:p().required("This field is required")}),U="_container_1xee9_1",Q="_searchContainer_1xee9_10",h={container:U,searchContainer:Q},Y=()=>{const{search:s,setPageParams:a,createPageParamsSetter:n}=j(),c=n({search:""}),l=i=>{a({search:i.searchText})},t=w({initialValues:{searchText:s},enableReinitialize:!0,validationSchema:x().shape({search:p()}),onSubmit:l}),o=F.groupBy.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:h.container,children:[e.jsx("div",{className:h.searchContainer,children:e.jsx(u.Form,{onSubmit:t.handleSubmit,noValidate:!0,children:e.jsx(u.SearchBox,{autocomplete:"off",externallyControlled:!0,value:t.values.searchText,onChange:async i=>await t.setFieldValue("searchText",i),placeholder:"Search",onSearch:()=>{t.submitForm()},onClear:c})})}),e.jsx(N,{label:"Group by",options:o,pageParamKey:"groupBy"},"group-by-filter")]}),e.jsx(R,{filtersToDisplay:["search"]})]})},K=({accessGroup:s})=>{const{instancesCount:a,isGettingInstances:n}=_({query:`access-group: ${s.name}`,with_alerts:!0,with_upgrades:!0,limit:1});return n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"u-off-screen",children:"Loading..."}),e.jsx(u.Spinner,{"aria-hidden":!0})]}):a?e.jsxs(E,{to:k.instances.root({accessGroups:[s.name]}),children:[a," ",b(a,"instance")]}):"0 instances"},Z=({accessGroup:s,parentAccessGroupTitle:a})=>{const n=I(),{notify:c}=M(),{removeAccessGroupQuery:l}=y(),{value:t,setTrue:o,setFalse:i}=D(),{instancesCount:r=0}=_({query:`access-group: ${s.name}`,with_alerts:!0,with_upgrades:!0,limit:1}),{mutateAsync:L,isPending:g}=l,T=async()=>{try{await L({name:s.name}),c.success({title:`You have successfully deleted the "${s.title}" access group.`,message:`All entities in this access group will now belong to "${a}".`})}catch(v){n(v)}finally{i()}};return e.jsxs(e.Fragment,{children:[e.jsx(G,{toggleAriaLabel:`${s.title} access group actions`,destructiveActions:[{icon:"delete",label:"Delete","aria-label":`Delete "${s.title}" access group`,onClick:o}]}),t&&e.jsxs(u.ConfirmationModal,{title:`Deleting ${s.title} access group`,confirmButtonLabel:"Delete",confirmButtonAppearance:"negative",confirmButtonDisabled:g,confirmButtonLoading:g,onConfirm:T,close:i,children:[r>0&&e.jsxs("p",{children:["Removing this access group will affect ",r," ",b(r,"instance"),'. They will now belong to "',a,'".']}),e.jsxs("p",{children:["This action is ",e.jsx("b",{children:"irreversible"})]})]})]})},J=s=>{const a={};switch(s.column.id){case"title":a.role="rowheader";break;case"name":a["aria-label"]="Name";break;case"instancesCount":a["aria-label"]="Instances count";break;case"parent":a["aria-label"]="Parent";break;case"id":a["aria-label"]="Actions";break}return a},P=(s,a)=>{const n=a.find(c=>c.name===s);return n&&n.parent?[n,...P(n.parent,a)]:n?[n]:[]},S=(s,a)=>a.filter(n=>n.parent===s).map(n=>({...n,instancesCount:0,subRows:S(n.name,a)})),W=({accessGroups:s})=>{const{groupBy:a,search:n}=j(),c=d.useMemo(()=>{const t=n?s.filter(r=>r.name.toLowerCase().includes(n.toLowerCase())||r.title.toLowerCase().includes(n.toLowerCase())):s;if(a!=="parent")return t.map(r=>({...r,instancesCount:0}));const o=Array.from(new Set([...t,...t.flatMap(r=>P(r.parent||"",s))])),i=new Set(o.filter(r=>r.parent).map(r=>r.name));return o.filter(r=>!i.has(r.name)).map(r=>({...r,instancesCount:0,subRows:S(r.name,o)}))},[s,n,a]),l=d.useMemo(()=>[{accessor:"title",Header:"title",Cell:({row:t})=>e.jsx("div",{style:{paddingLeft:`${t.depth*1.25}rem`},children:e.jsx("span",{children:t.original.title})})},{accessor:"name",Header:"name"},{accessor:"instancesCount",Header:"affected instances",sortType:(t,o)=>t.original.instancesCount-o.original.instancesCount,Cell:({row:t})=>e.jsx(K,{accessGroup:t.original})},{accessor:"parent",Header:"parent",Cell:({row:{original:t}})=>s.find(i=>i.name===t.parent)?.title||e.jsx(B,{})},{...q,Cell:({row:t})=>{if(t.original.name===f)return null;const o=s.find(i=>i.name===t.original.parent)?.title||t.original.parent;return e.jsx(Z,{accessGroup:t.original,parentAccessGroupTitle:o})}}],[a,s]);return e.jsx(O,{columns:l,data:c,sortable:!0,getCellProps:J,emptyMsg:"No access groups found according to your search parameters."})},X=d.lazy(()=>C(()=>import("./index-Ck47OtQT.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6]))),ee=()=>{const{getAccessGroupQuery:s}=y(),{setSidePanelContent:a}=A(),{data:n,isPending:c}=s(),l=n?.data||[],t=()=>{a("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(m,{}),children:e.jsx(X,{})}))};return e.jsxs(e.Fragment,{children:[c&&e.jsx(m,{}),!c&&l.length===0&&e.jsx($,{title:"No access groups found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any access groups yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/access-groups",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage access groups in Landscape"})]}),cta:[e.jsx(u.Button,{appearance:"positive",onClick:t,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),!c&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{}),e.jsx(W,{accessGroups:l})]})]})},se=d.lazy(()=>C(()=>import("./index-Ck47OtQT.js").then(s=>s.a),__vite__mapDeps([0,1,2,3,4,5,6])).then(s=>({default:s.NewAccessGroupForm}))),ae=()=>{const{setSidePanelContent:s}=A(),a=()=>{s("Add access group",e.jsx(d.Suspense,{fallback:e.jsx(m,{}),children:e.jsx(se,{})}))};return e.jsxs(H,{children:[e.jsx(V,{sticky:!0,title:"Access groups",actions:[e.jsx(u.Button,{appearance:"positive",onClick:a,type:"button",className:"u-no-margin--right",children:"Add access group"},"add-access-group")]}),e.jsx(z,{children:e.jsx(ee,{})})]})},ue=Object.freeze(Object.defineProperty({__proto__:null,default:ae},Symbol.toStringTag,{value:"Module"}));export{ee as A,ce as I,le as V,ue as i};
