import{e as y,r as f,j as e,g as t,f as A,o as N,h as v}from"./index-DXs1haZl.js";import{E as P}from"./EmptyState-BYL1pVz2.js";import{P as S,a as D,b as C}from"./PageMain-DhSBVwHg.js";import{u as j}from"./useRoles-CGNtMKpq.js";import{u as G}from"./useConfirm-C9Ai5vPv.js";import{c as _,a as w}from"./index.esm-FGh7VWBq.js";import{u as k}from"./formik.esm-CwYJvJSO.js";import{S as F}from"./SidePanelFormButtons-Dtg_vQ52.js";import"./useFetchOld-DWTVWZGf.js";import"./useMutation-CoMMCR6r.js";import"./useQuery-DPA9mHwu.js";import"./SidePanelFormButtons.module-DyBJG5lm.js";const L="_actions_14r9y_1",$="_name_14r9y_5",x={actions:L,name:$},B=({accessGroupData:l})=>{const{confirmModal:m,closeConfirmModal:r}=G(),{removeAccessGroupQuery:n}=j(),{mutateAsync:c,isLoading:i}=n,u=y(),d=(s,a="",g=0)=>{let h=[];return s.filter(b=>b.parent===a).forEach(b=>{h.push({...b,indentLevel:g}),h=h.concat(d(s,b.name,g+1))}),h},p=f.useMemo(()=>{const s=l.sort((a,g)=>a.name.localeCompare(g.name))||[];return d(s)},[l.length]),o=f.useMemo(()=>[{accessor:"title",Header:"Title",className:x.name},{accessor:"name",Header:"Name",className:x.name},{accessor:"id",className:x.actions,Cell:({row:s})=>e.jsx("div",{className:"divided-blocks",children:e.jsx("div",{className:"divided-blocks__item",children:e.jsxs(t.Button,{small:!0,hasIcon:!0,appearance:"base",className:"u-no-margin--bottom u-no-padding--left p-tooltip--btm-center","aria-label":`Remove ${s.original.name} access group`,onClick:()=>{m({body:"Are you sure?",title:`Deleting ${s.original.name} access group`,buttons:[e.jsxs(t.Button,{appearance:"negative",hasIcon:!0,onClick:async()=>{try{await c({name:s.original.name})}catch(a){u(a)}finally{r()}},"aria-label":`Delete ${s.original.name} access group`,children:[i&&e.jsx(t.Spinner,{}),"Delete"]},`delete-access-group-${s.original.name}`)]})},children:[e.jsx("span",{className:"p-tooltip__message",children:"Delete"}),e.jsx(t.Icon,{name:t.ICONS.delete,className:"u-no-margin--left"})]})})})}],[]);return e.jsx(e.Fragment,{children:e.jsx(t.ModularTable,{columns:o,data:p,getCellProps:s=>{const a=s.row.original;switch(s.column.id){case"name":return{role:"rowheader"};case"title":return{"aria-label":"Title",style:{paddingLeft:`${a.indentLevel*2}rem`}};case"id":return{"aria-label":"Actions"};default:return{}}}})})},M=()=>{const{createAccessGroupQuery:l,getAccessGroupQuery:m}=j(),{mutateAsync:r,isLoading:n}=l,{closeSidePanel:c}=A(),{data:i,isLoading:u}=m(),d=((i==null?void 0:i.data)??[]).map(s=>({label:s.title,value:s.name})),p=y(),o=k({initialValues:{title:"",parent:""},validationSchema:_().shape({title:w().required("This field is required")}),onSubmit:async s=>{try{await r(s),c()}catch(a){p(a)}}});return e.jsxs(t.Form,{noValidate:!0,onSubmit:o.handleSubmit,children:[e.jsx(t.Input,{type:"text",label:"Title",id:"new-access-group-title",required:!0,error:o.touched.title&&o.errors.title?o.errors.title:void 0,...o.getFieldProps("title")}),e.jsx(t.Select,{required:!0,id:"Parent",label:"Parent",disabled:u,options:[...d],...o.getFieldProps("parent")}),e.jsx(F,{submitButtonDisabled:n,submitButtonText:"Add"})]})},E=()=>{const{setSidePanelContent:l}=A(),{getAccessGroupQuery:m}=j(),{data:r,isLoading:n}=m(),c=(r==null?void 0:r.data)??[],i=()=>{l("Add access group",e.jsx(M,{}))},u=({className:d})=>e.jsx(t.Button,{appearance:"positive",onClick:i,onMouseDown:p=>{p.preventDefault()},type:"button",className:v("u-no-margin--right",d),children:"Add access group"});return e.jsxs(S,{children:[e.jsx(D,{title:"Access groups",actions:[e.jsx(u,{},"add-new-access-group-button")]}),e.jsxs(C,{children:[n&&e.jsx(N,{}),!n&&c.length===0&&e.jsx(P,{title:"No access groups found",icon:"copy",body:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any access groups yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/access-groups",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage access groups in Landscape"})]}),cta:[e.jsx(u,{},"empty-state-new-button")]}),!n&&c.length>0&&e.jsx(B,{accessGroupData:c})]})]})},U=E;export{U as default};
