import{c as S,d as C,j as e,T as I,n as h,e as z,f as G,g as N,h as Q,A as E,B as L,o as q,C as H,J as M,M as K,r as u,l as Z,p as A,au as V,ao as U,aT as W,aq as J,aU as X}from"./index-ClpWheCJ.js";import{P as Y,a as ee,b as se}from"./PageMain-CVU8VjvV.js";import{F as b,P as te,I as ne,a as ae}from"./InstancesPageActions-CbQ7WUQ1.js";import{u as R}from"./useInstances-DvLeTpj5.js";import{u as re}from"./useSelection-BWzbFIDM.js";import{G as oe}from"./GroupFilter-BRvVZlp9.js";import{u as ie}from"./useRoles-1klFmoud.js";import"./ResponsiveButtons-Og1fsUVd.js";const ce="_label_1i8qt_1",le={label:ce},de=({options:a})=>{const{disabledColumns:t,setPageParams:r}=S(),s=i=>a.filter(({value:o})=>!i.includes(o)).map(({value:o})=>o);return C("disabledColumns",a.filter(i=>i.canBeHidden).map(i=>i.value)),e.jsx(I,{type:"multiple",showSelectedItemCount:!0,label:e.jsxs(e.Fragment,{children:[e.jsx(h.Icon,{name:"settings"}),e.jsx("span",{className:le.label,children:"Columns"})]}),onItemsSelect:i=>{r({disabledColumns:s(i)})},options:a,disabledOptions:a.filter(({canBeHidden:i})=>!i),selectedItems:s(t)})},O=()=>{const a=z(),t=G(),r=(n={},c={})=>Q({queryKey:["savedSearches",n],queryFn:async()=>a.get("GetSavedSearches",{params:n}),...c}),s=N({mutationFn:async n=>a.get("CreateSavedSearch",{params:n}),onSuccess:async()=>t.invalidateQueries({queryKey:["savedSearches"]})}),i=N({mutationFn:async n=>a.get("EditSavedSearch",{params:n}),onSuccess:async()=>t.invalidateQueries({queryKey:["savedSearches"]})}),o=N({mutationFn:async n=>a.get("RemoveSavedSearch",{params:n}),onSuccess:async()=>t.invalidateQueries({queryKey:["savedSearches"]})});return{getSavedSearchesQuery:r,createSavedSearchQuery:s,editSavedSearchQuery:i,removeSavedSearchQuery:o}},he="_container_5hvuq_1",ue="_list_5hvuq_6",pe="_listItem_5hvuq_11",me="_search_5hvuq_17",xe="_row_5hvuq_25",je="_truncated_5hvuq_33",g={container:he,list:ue,listItem:pe,search:me,row:xe,truncated:je},fe=({onSavedSearchClick:a,onSavedSearchRemove:t,savedSearches:r})=>{if(!r.length)return null;const s=E(),{notify:i}=L(),{removeSavedSearchQuery:o}=O(),{mutateAsync:n,isPending:c}=o,l=async d=>{try{await n({name:d}),t(),i.success({message:`Saved search ${d} successfully removed`,title:"Saved search removed"})}catch(f){s(f)}};return e.jsxs("div",{className:g.container,children:[e.jsx("p",{className:"p-text--small-caps u-text--muted p-text--small",children:"Saved searches"}),e.jsx("ul",{className:q("p-list--divided u-no-margin--bottom",g.list),children:r.map(d=>e.jsx("li",{children:e.jsxs("div",{className:g.listItem,children:[e.jsx(h.Button,{type:"button",appearance:"base",className:g.search,onClick:()=>a(d),children:e.jsxs(h.Row,{className:g.row,children:[e.jsx(h.Col,{size:4,children:e.jsx(h.Tooltip,{message:d.name,positionElementClassName:g.truncated,children:e.jsx("span",{children:d.name})})}),e.jsx(h.Col,{size:8,children:e.jsx(h.Tooltip,{message:d.search,positionElementClassName:g.truncated,children:e.jsx("span",{children:d.search})})})]})}),e.jsx(h.ConfirmationButton,{className:"has-icon u-no-margin--bottom u-no-padding--bottom u-no-padding--top",type:"button",appearance:"base",confirmationModalProps:{title:"Remove saved search",children:e.jsxs("p",{children:['This will remove the saved search "',d.name,'".']}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:c,confirmButtonLoading:c,onConfirm:()=>l(d.name)},children:e.jsx(h.Icon,{name:"delete"})})]})},d.name))})]})},ge="_infoContainer_zti77_1",Se="_helpButtonContainer_zti77_9",ve="_helpButton_zti77_9",F={infoContainer:ge,helpButtonContainer:Se,helpButton:ve},ye=({onHelpButtonClick:a})=>e.jsx("div",{className:F.infoContainer,children:e.jsx("div",{className:F.helpButtonContainer,children:e.jsx(h.Button,{type:"button",appearance:"base",hasIcon:!0,className:F.helpButton,onClick:t=>{t.stopPropagation(),a()},children:e.jsx(h.Icon,{name:h.ICONS.help})})})}),_e=({onClose:a,onSearchSave:t,search:r})=>{const s=E(),{notify:i}=L(),{createSavedSearchQuery:o}=O(),{mutateAsync:n}=o,l=H({initialValues:{name:""},onSubmit:async({name:d})=>{try{await n({search:r,name:d,title:d}),i.success({message:`Saved search ${d} successfully added`,title:"Saved search added"}),t(),a()}catch(f){s(f)}},validationSchema:M({name:K().required("This field is required").test({message:"Name must consist of only lowercase alphanumeric characters and hyphens",test:d=>/^[a-z0-9][-a-z0-9]*$/.test(d)})})});return e.jsxs(h.Form,{onSubmit:l.handleSubmit,noValidate:!0,children:[e.jsx(h.Input,{type:"text",autoComplete:"off",autoFocus:!0,label:"Search name",...l.getFieldProps("name"),error:l.touched.name&&l.errors.name?l.errors.name:void 0}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(h.Button,{type:"button",disabled:l.isSubmitting,onClick:a,children:"Cancel"}),e.jsx(h.Button,{type:"submit",disabled:l.isSubmitting,appearance:"positive","aria-label":`Saved search as ${l.values.name}`,children:"Save search"})]})]})},be="_container_fqj7b_1",Ce="_prompt_fqj7b_10",Ie="_saveButton_fqj7b_17",P={container:be,prompt:Ce,saveButton:Ie},we=({onSearchSave:a,search:t})=>{const[r,s]=u.useState(!1);return e.jsxs(e.Fragment,{children:[t&&r&&e.jsx(_e,{onClose:()=>s(!1),onSearchSave:a,search:t}),t&&!r&&e.jsxs("div",{className:P.container,children:[e.jsxs("span",{className:P.prompt,children:[e.jsx("span",{children:"Search for "}),e.jsx("span",{className:"p-search-and-filter__search-query",children:t}),e.jsx("span",{children:"..."})]}),e.jsx(h.Button,{type:"button",appearance:"link",onClick:()=>s(!0),className:P.saveButton,children:"Save search"})]})]})},Be="_searchContainer_t00ki_1",ke="_form_t00ki_8",Ne="_searchBoxContainer_t00ki_13",Fe="_input_t00ki_17",k={searchContainer:Be,form:ke,searchBoxContainer:Ne,input:Fe},T=({inputText:a,savedSearches:t,search:r})=>{if(!t)return[];let s=t;if(r){const i=r.split(",").filter(Boolean);s=s.filter(({name:o})=>i.every(n=>n!==`search:${o}`))}return a&&(s=s.filter(({name:i,search:o})=>i.toLowerCase()!==a.trim().toLowerCase()&&o.toLowerCase()!==a.trim().toLowerCase())),s},Pe=({onHelpButtonClick:a})=>{const{query:t,setPageParams:r}=S(),[s,i]=u.useState(""),[o,n]=u.useState(!1),{getSavedSearchesQuery:c}=O(),l=u.useRef(null),d=u.useRef(null);Z(l,p=>{const j=document.querySelector(".p-modal");j&&j.contains(p.target)||n(!1)});const{data:m,isLoading:w}=c(),B=u.useMemo(()=>T({inputText:s,savedSearches:m==null?void 0:m.data,search:t}),[m,s,t]),v=()=>{if(!s)return;const j=T({inputText:"",savedSearches:m==null?void 0:m.data,search:t}).some(({name:D})=>D.toLowerCase()===s.trim().toLowerCase())?"search:":"";r({query:t?`${t},${j}${s}`:`${j}${s}`}),i("")},x=p=>{r({query:t?`${t},search:${p.name}`:`search:${p.name}`})},y=p=>{const{key:j}=p;o?(j==="Escape"&&n(!1),j==="Enter"&&v()):j==="Enter"&&n(!0)};return e.jsxs("div",{className:"p-search-and-filter",ref:l,children:[e.jsxs("div",{className:q("p-search-and-filter__search-container",k.searchContainer),"aria-expanded":o,ref:d,onClick:()=>n(!0),children:[e.jsx(h.Form,{onSubmit:p=>{p.preventDefault(),v()},className:q("p-search-and-filter__box",k.form),children:e.jsx("div",{className:k.searchBoxContainer,children:e.jsx(h.SearchBox,{externallyControlled:!0,shouldRefocusAfterReset:!0,autocomplete:"off",className:k.input,value:s,onChange:p=>i(p),onClear:()=>i(""),onSearch:v,onClick:()=>n(!0),onKeyUp:y})})}),e.jsx(ye,{onHelpButtonClick:a})]}),o&&w&&e.jsx(A,{}),o&&!w&&e.jsxs("div",{className:"p-search-and-filter__panel",children:[e.jsx(we,{onSearchSave:()=>i(""),search:s.trim()}),e.jsx(fe,{onSavedSearchClick:x,onSavedSearchRemove:()=>n(!0),savedSearches:B})]})]})},qe=({options:a})=>{const{accessGroups:t,setPageParams:r}=S();return C("accessGroups",a.map(s=>s.value)),e.jsx(I,{type:"multiple",label:"Access group",hasToggleIcon:!0,hasBadge:!0,options:a,onItemsSelect:s=>{r({accessGroups:s})},selectedItems:t})},Oe=({options:a})=>{const[t,r]=u.useState(""),{availabilityZones:s,setPageParams:i}=S(),o=a.length>9&&t?a.filter(({value:c})=>c!=="none"&&c.includes(t)):a;C("availabilityZones",o.map(c=>c.value));const n=c=>{c[c.length-1]==="none"?i({availabilityZones:["none"]}):i({availabilityZones:c[0]!=="none"?c:c.filter(l=>l!=="none")})};return e.jsx(I,{type:"multiple",label:"Availability zone",hasToggleIcon:!0,hasBadge:!0,onSearch:a.length>9?c=>{r(c)}:void 0,options:o,onItemsSelect:n,selectedItems:s})},Te=({options:a})=>{const{os:t,setPageParams:r}=S();return C("os",a.map(s=>s.value)),e.jsx(I,{type:"single",hasBadge:!0,label:"OS",hasToggleIcon:!0,options:a,onItemSelect:s=>{r({os:s})},selectedItem:t})},$e=({options:a})=>{const[t,r]=u.useState(""),{tags:s,setPageParams:i}=S(),o=a.filter(({value:n})=>n.includes(t));return C("tags",o.map(n=>n.value)),e.jsx(I,{type:"multiple",label:"Tag",hasToggleIcon:!0,hasBadge:!0,options:o,onItemsSelect:n=>{i({tags:n})},onSearch:n=>{r(n)},selectedItems:s})},Ee=[{term:"<keyword>",description:e.jsxs("span",{children:["Instances with the title or hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"distribution:<keyword>",description:e.jsxs("span",{children:["Instances with the installed distribution named"," ",e.jsx("code",{children:"<keyword>"})]})},{term:"needs:reboot",description:"Instances needing a reboot"},{term:"alert:<type>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with outstanding alerts of the specified"," ",e.jsx("code",{children:"<type>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<type>"})," can be ",e.jsx("code",{children:"package-upgrades"}),","," ",e.jsx("code",{children:"security-upgrades"}),",",e.jsx("code",{children:"package-profiles"}),","," ",e.jsx("code",{children:"package-reporter"}),", ",e.jsx("code",{children:"esm-disabled"}),","," ",e.jsx("code",{children:"computer-offline"}),",",e.jsx("code",{children:"computer-reboot"}),","," ",e.jsx("code",{children:"computer-duplicates"}),", ",e.jsx("code",{children:"unapproved-activities"}),"."]})]})},{term:"ip:<address>",description:e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Instances with IP addresses like ",e.jsx("code",{children:"<address>"})]}),e.jsx("br",{}),e.jsxs("span",{children:[e.jsx("code",{children:"<address>"})," can be a fragment or partial IP address representing a subnet such as 91.185.94 to match any instances in the subnet."]})]})},{term:"mac:<address>",description:e.jsxs("span",{children:["Instances with the MAC address ",e.jsx("code",{children:"<address>"})]})},{term:"id:<instance_id>",description:e.jsxs("span",{children:["Instance with the id ",e.jsx("code",{children:"<instance_id>"})]})},{term:"access-group:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," access group"]})},{term:"search:<name>",description:e.jsxs("span",{children:["Instances meeting the terms of the ",e.jsx("code",{children:"<name>"})," saved search"]})},{term:"upgrade-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," upgrade profile"]})},{term:"removal-profile:<name>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<name>"})," removal profile"]})},{term:"tag:<keyword>",description:e.jsxs("span",{children:["Instances associated with the ",e.jsx("code",{children:"<keyword>"})," tag"]})},{term:"hostname:<keyword>",description:e.jsxs("span",{children:["Instance with the hostname ",e.jsx("code",{children:"<keyword>"})]})},{term:"title:<keyword>",description:e.jsxs("span",{children:["Instance with the title ",e.jsx("code",{children:"<keyword>"})]})},{term:"license-id:<license_id>",description:e.jsxs("span",{children:["Search for instances licensed to the specified"," ",e.jsx("code",{children:"<license_id>"})]})},{term:"needs:license OR license-id:none",description:"Search for instances that do not have a Landscape license, and, as a result, are not managed"},{term:"annotation:<key>",description:e.jsxs("span",{children:["Search for instances which define the specified annotation key. Optionally specify ",e.jsx("code",{children:"annotation:<key>:<string>"})," ","which will only return instances whose key matches and value also contains the ",e.jsx("code",{children:"<string>"})," specified"]})},{term:"security-profiles:<security-profile-id>:<pass|fail|in-progress>",description:e.jsxs("span",{children:["Search for the security profiles with a specified id. Optionally specify"," ",e.jsx("code",{children:"security-profiles:<security-profiles-id>:<pass|fail|in-progress>"})," ","which will only return security profiles whose id matches, and value also contains ",e.jsx("code",{children:"pass"}),", ",e.jsx("code",{children:"fail"}),","," ",e.jsx("code",{children:"in-progress"})," as specified"]})}],Le="_top_unlra_1",Ae="_searchContainer_unlra_13",Re="_filters_unlra_17",De="_divider_unlra_22",_={top:Le,searchContainer:Ae,filters:Re,divider:De},ze=({columnFilterOptions:a})=>{const[t,r]=u.useState(!1),{getAccessGroupQuery:s}=ie(),{getAllInstanceTagsQuery:i,getAvailabilityZonesQuery:o}=R(),{data:n}=i(),c=(n==null?void 0:n.data.results.map(x=>({label:x,value:x})))??[],{data:l}=o(),d=((l==null?void 0:l.data.values)??[]).reduce((x,y)=>(x.push({label:y,value:y}),x),[{label:"Without zones",value:"none",group:"1"}]),{data:f}=s(),m=(f==null?void 0:f.data.map(({name:x,title:y})=>({value:x,label:y})))??[],w=b.groupBy.options,B=b.status.options,v=b.os.options;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:_.top,children:[e.jsx("div",{className:_.searchContainer,children:e.jsx(Pe,{onHelpButtonClick:()=>{r(!0)}})}),e.jsxs("div",{className:_.filters,children:[e.jsx(oe,{options:w}),e.jsx("span",{className:_.divider}),e.jsx(V,{options:B}),e.jsx(Te,{options:v}),e.jsx(Oe,{options:d}),e.jsx(qe,{options:m}),e.jsx($e,{options:c}),e.jsx("span",{className:_.divider}),e.jsx(de,{options:a})]})]}),e.jsx(U,{filtersToDisplay:["accessGroups","os","availabilityZones","status","tags","query"],accessGroupOptions:m,availabilityZonesOptions:d,osOptions:v,statusOptions:B,tagOptions:c}),e.jsx(W,{open:t,data:Ee,onClose:()=>{r(!1)}}),e.jsx(te,{})]})},Ge=u.memo(function({instanceCount:t,instances:r,isGettingInstances:s,selectedInstances:i,setSelectedInstances:o}){const[n,c]=u.useState([]),l=u.useCallback(()=>{o([])},[]);return e.jsxs(e.Fragment,{children:[e.jsx(ze,{columnFilterOptions:n}),s?e.jsx(A,{}):e.jsx(ne,{instances:r,selectedInstances:i,setColumnFilterOptions:c,setSelectedInstances:o}),e.jsx(J,{totalItems:t,handleClearSelection:l,currentItemCount:r.length})]})}),$=(a,t)=>{var r;return a.type==="select"?((r=a.options.find(s=>s.value===t))==null?void 0:r.query)??"":""},Qe=({accessGroups:a,availabilityZones:t,os:r,query:s,status:i,tags:o})=>{const n=[];return r&&n.push($(b.os,r)),i&&n.push($(b.status,i)),s&&n.push(...s.split(",")),o.length&&n.push(`tag:${o.join(" OR tag:")}`),a.length&&n.push(`access-group:${a.join(" OR access-group:")}`),t.length&&n.push(t.includes("none")?"availability-zone:null":`availability-zone:${t.join(" OR availability-zone:")}`),n.join(" ")},Xe=()=>{const{currentPage:a,pageSize:t,groupBy:r,...s}=S(),{getInstancesQuery:i}=R(),{data:o,isLoading:n}=i({query:Qe(s),root_only:r==="parent",archived_only:s.status==="archived",with_alerts:!0,with_upgrades:X,limit:t,offset:(a-1)*t}),c=(o==null?void 0:o.data.results)??[],{selectedItems:l,setSelectedItems:d}=re(c,n);return e.jsxs(Y,{children:[e.jsx(ee,{title:"Instances",actions:[e.jsx(ae,{isGettingInstances:n,selectedInstances:l},"actions")],sticky:!0}),e.jsx(se,{children:e.jsx(Ge,{instanceCount:o==null?void 0:o.data.count,instances:c,isGettingInstances:n,selectedInstances:l,setSelectedInstances:d})})]})};export{Xe as default};
