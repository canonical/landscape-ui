import{d as y,j as t,s as S,h as F,i as B,l as k,g as l,f as U,m as $}from"./index-Bwatsl1G.js";import{u as L}from"./useFetchOld--qBGHGTA.js";import{S as N}from"./SidePanelFormButtons-CIamrVW7.js";import"./SidePanelFormButtons.module-tJTvEwdD.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},i=new e.Error().stack;i&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[i]="32ebe1b8-0c37-4a70-926e-af8cb5c2ccb7",e._sentryDebugIdIdentifier="sentry-dbid-32ebe1b8-0c37-4a70-926e-af8cb5c2ccb7")}catch{}function D(){const e=L();return{getCsvComplianceData:(n={},s={})=>y({queryKey:["csvComplianceData",n],queryFn:()=>e.get("GetCSVComplianceData",{params:n}),...s}),getInstancesNotUpgraded:(n={},s={})=>y({queryKey:["instancesNotUpgraded",n],queryFn:()=>e.get("GetComputersNotUpgraded",{params:n}),...s}),getNotPingingInstances:(n,s={})=>y({queryKey:["notPingingInstances",n],queryFn:()=>e.get("GetNotPingingComputers",{params:n}),...s}),getUsnTimeToFix:(n={},s={})=>y({queryKey:["usnTimeToFix",n],queryFn:()=>e.get("GetUSNTimeToFix",{params:n}),...s}),getUpgradedInstancesByFrequency:(n={},s={})=>y({queryKey:["upgradedInstancesByFrequency",n],queryFn:()=>e.get("GetUpgradedComputersByFrequency",{params:n}),...s})}}const O="_header_1kqll_1",V="_lineContainer_1kqll_8",E="_line_1kqll_8",j={header:O,lineContainer:V,line:E},C=({currentCount:e,negativeDescription:i,positiveDescription:d,title:a,totalCount:c})=>{const r=(100*e/c).toFixed();return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:j.header,children:[t.jsx("span",{children:a}),t.jsx("span",{children:`${r}%`})]}),t.jsx("div",{className:j.lineContainer,children:t.jsx("div",{className:j.line,style:{width:`${r}%`}})}),t.jsx("p",{className:"u-text--muted p-text--small",children:d}),t.jsx("p",{className:"u-text--muted p-text--small u-no-margin--bottom",children:i})]})},G="_rowContainer_q14my_7",K="_row_q14my_7",b={rowContainer:G,row:K},z="_rangeContainer_1omsg_1",W={rangeContainer:z},I=(e,i)=>{const d=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(d),c=document.createElement("a");c.href=a,c.download=i,document.body.appendChild(c),c.click(),document.body.removeChild(c)},P=({instanceIds:e})=>{const{getCsvComplianceData:i}=D(),{data:d}=i({query:`id:${e.join(" OR id:")}`}),a=S({initialValues:{range:0,reportByCve:!0},validationSchema:F({range:k().required("This field is required"),reportByCve:B()}),onSubmit:()=>I((d==null?void 0:d.data)||"","report.csv")});return t.jsxs(l.Form,{onSubmit:a.handleSubmit,noValidate:!0,children:[t.jsx(l.CheckboxInput,{label:"Report by CVE",inline:!0,...a.getFieldProps("reportByCve"),checked:a.values.reportByCve}),t.jsxs("div",{className:W.rangeContainer,children:[t.jsx(l.Input,{type:"number",label:"Range",className:"u-no-margin--bottom",style:{maxWidth:"min-content"},...a.getFieldProps("range"),error:a.touched.range&&a.errors.range?a.errors.range:void 0}),t.jsx("span",{children:"Days"})]}),t.jsx(N,{submitButtonDisabled:!1,submitButtonText:"Download"})]})},M=({instanceIds:e})=>{const{setSidePanelContent:i}=U(),{getNotPingingInstances:d,getInstancesNotUpgraded:a,getUsnTimeToFix:c}=D(),{data:r,isLoading:n}=d({since_minutes:5,query:`id:${e.join(" OR id:")}`}),s=r?e.length-r.data.length:0,{data:g,isLoading:_}=a({query:`id:${e.join(" OR id:")}`}),x=g?e.length-g.data.length:0,{data:o,isLoading:f}=c({query:`id:${e.join(" OR id:")}`,fixed_in_days:[2,14,30,60]}),p={month:(o==null?void 0:o.data[30].length)||0,old:(o==null?void 0:o.data[60].length)||0,pending:(o==null?void 0:o.data.pending.length)||0,recent:(o==null?void 0:o.data[2].length)||0,twoWeeks:(o==null?void 0:o.data[14].length)||0},v={recent:2,twoWeeks:14,month:30,old:60},w=(h,m)=>{const u=m==="positive"?p[h]:e.length-p[h];return u!==1?`${u||"No"} instances have${m==="negative"?" not":""} applied USNs in ${v[h]} days or less.`:`1 instance has${m==="negative"?" not":""} applied USNs in ${v[h]} days or less.`},q=()=>{i("Download report as CSV",t.jsx(P,{instanceIds:e}))};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:b.rowContainer,children:t.jsxs(l.Row,{className:$("u-no-padding--left u-no-padding--right",b.row),children:[t.jsx(l.Col,{size:6,children:!f&&t.jsx(C,{currentCount:e.length-p.pending,negativeDescription:`${p.pending||"No"} instance${p.pending!==1?"s are":" is"} not yet patched.`,positiveDescription:`${e.length-p.pending||"No"} instance${e.length-p.pending!==1?"s are":" is"} securely patched.`,title:"Securely patched",totalCount:e.length})}),t.jsx(l.Col,{size:6,children:!_&&t.jsx(C,{currentCount:x,negativeDescription:`${(g==null?void 0:g.data.length)||"No"} instance${(g==null?void 0:g.data.length)!==1?"s are":" is"} not covered by upgrade profiles.`,positiveDescription:`${x||"No"} instance${x!==1?"s are":" is"} covered by upgrade profiles.`,title:"Upgrade profiles",totalCount:e.length})}),t.jsx(l.Col,{size:6,children:!n&&t.jsx(C,{currentCount:s,negativeDescription:`${(r==null?void 0:r.data.length)||"No"} instance${(r==null?void 0:r.data.length)!==1?"s have":" has"} not contacted the server within the last 5 minutes.`,positiveDescription:`${s||"No"} instance${s!==1?"s have":" has"} contacted the server within the last 5 minutes.`,title:"Contacted",totalCount:e.length})})]})}),!f&&t.jsxs("div",{className:b.rowContainer,children:[t.jsx("h4",{children:"Security upgrades"}),t.jsx(l.Row,{className:$("u-no-padding--left u-no-padding--right",b.row),children:Object.entries(v).map(([h,m])=>{const u=h;return t.jsx(l.Col,{size:6,children:t.jsx(C,{currentCount:p[u],negativeDescription:w(u,"negative"),positiveDescription:w(u,"positive"),title:`${m} days`,totalCount:e.length})},u)})})]}),t.jsx(N,{submitButtonDisabled:!1,submitButtonText:"Download as CSV",onSubmit:q})]})};export{M as default};
