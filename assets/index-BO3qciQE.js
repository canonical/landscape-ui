const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C3diIwpC.js","assets/index-K2U83YxJ.js","assets/index-C0ZxZ9J6.css","assets/usePageParams-btTIl-Mq.js","assets/useInstances-BNPdLjb2.js","assets/useFetchOld-skueaXrj.js","assets/TablePagination-B87KF8DI.js","assets/TablePaginationBase-CHdj3YtJ.js","assets/TablePaginationBase-CJl3HN1X.css","assets/StatusFilter-BqfQ_NEp.js","assets/TableFilter-Bs4z0Q86.js","assets/TableFilter-DXBG6q86.css","assets/TableFilterChips-F9CkWOGf.js","assets/TableFilterChips-CHqetGbX.css","assets/NoData-DE16lN-s.js","assets/index-DlELVwax.css"])))=>i.map(i=>d[i]);
import{j as e,E as K,g as o,m as O,r as u,_ as Q,e as Y,b as U,f as M,c as N,d as $,n as S,O as G,s as J,h as X,l as q,o as Z,L as ee,D as te}from"./index-K2U83YxJ.js";import{u as I,m as se}from"./usePageParams-btTIl-Mq.js";import{u as ae,T as ie}from"./TablePagination-B87KF8DI.js";import{S as ne}from"./StatusFilter-BqfQ_NEp.js";import{T as re}from"./TableFilterChips-F9CkWOGf.js";import{T as oe,t as v}from"./TableFilter-Bs4z0Q86.js";import{u as ce}from"./useFetchOld-skueaXrj.js";import{N as H}from"./NoData-DE16lN-s.js";const le=()=>e.jsx(K,{body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"There are no activities yet."}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage computers in Landscape"})]}),icon:"switcher-environments",title:"No activities found"}),ue="_wrapper_22uzw_1",de="_search_22uzw_9",pe="_buttonContainer_22uzw_13",me="_button_22uzw_13",he="_icon_22uzw_43",j={wrapper:ue,search:de,buttonContainer:pe,button:me,icon:he},ye=({inputValue:s,onDescriptionClick:t,onInputChange:n,onSearchClick:d,onClear:r})=>e.jsxs("div",{className:j.wrapper,children:[e.jsx(o.SearchBox,{autocomplete:"off",shouldRefocusAfterReset:!0,externallyControlled:!0,value:s,onChange:n,onSearch:d,onClear:r,className:O("u-no-margin--bottom",j.search)}),e.jsx("div",{className:j.buttonContainer,children:e.jsx(o.Button,{type:"button",onClick:t,className:j.button,children:e.jsx(o.Icon,{name:o.ICONS.help,className:j.icon})})})]}),ge="_term_1p61y_1",fe={term:ge},xe=({open:s,onClose:t,data:n})=>{const d=[{Header:"Term",accessor:"term",className:fe.term,Cell:({value:r})=>typeof r=="string"?e.jsx("code",{children:r}):null},{Header:"Description",accessor:"description",Cell:({value:r})=>typeof r=="string"||u.isValidElement(r)?e.jsx("span",{className:"u-text--muted",children:r}):null}];return s&&e.jsxs(o.Modal,{title:"Search help",close:t,children:[e.jsx("p",{children:"Available search terms for use in the search box. If multiple search terms are separated by OR, any of the conditions will match. Otherwise, all conditions must be met for a instance to match. When a term is preceded by NOT, the condition must not match. If the searched value contains spaces or non-ASCII characters, it must be quoted."}),e.jsx(o.ModularTable,{className:"u-no-margin--bottom",columns:u.useMemo(()=>d,[]),data:u.useMemo(()=>n,[])})]})},_e="_container_1le1l_1",be="_sticky_1le1l_9",ve="_searchContainer_1le1l_15",je="_filters_1le1l_19",k={container:_e,sticky:be,searchContainer:ve,filters:je},Se="_iconError_xphpu_1",Ce="_iconWarning_xphpu_5",Te="_iconWarningRed_xphpu_9",w={iconError:Se,iconWarning:Ce,iconWarningRed:Te},E={succeeded:{icon:"success",label:"Succeeded"},scheduled:{icon:"spinner",label:"Scheduled"},waiting:{icon:"status-waiting",label:"Waiting"},undelivered:{icon:"status-queued",label:"Queued"},delivered:{icon:"status-in-progress",label:"In progress"},blocked:{icon:`warning-grey ${w.iconWarningRed}`,label:"Blocked"},unapproved:{icon:`warning-grey ${w.iconWarning}`,label:"Unapproved"},canceled:{icon:"error-grey",label:"Cancelled"},failed:{icon:`error-grey ${w.iconError}`,label:"Failed"}},Ae=[{term:"id:<activity_id>",description:"Search for activities with a specific ID."},{term:"parent-id:<parent_id>",description:"Search for children activities of a specific ID."},{term:"created-after:<date>",description:e.jsxs("span",{children:["Search for activities created after a specific date or time, specified with the ISO-8601 format. The precision depends on how far you specify, for example ",e.jsx("code",{children:"2011-01"}),", ",e.jsx("code",{children:"2011-01-01"}),","," ",e.jsx("code",{children:"2011-01-01T10:30"})," are valid values."]})},{term:"created-before:<date>",description:"Search for activities created before a specific date or time. The format is the same as created-after."},{term:"creator:<email>",description:"Search for activities created by a particular person (specified by email address)."},{term:"computer:<criteria>",description:"Search for activities related to the given instances. The criteria is itself another query argument to search instances. See Instance Queries for details."},{term:"type:<type>",description:"Search for activities of a specific type."}],L=[{label:"All",value:""},...Object.entries(E).filter(([s])=>s!=="unapproved").map(([s,{label:t}])=>({label:t,value:s}))],De=({options:s})=>{const[t,n]=u.useState(""),{setPageParams:d,type:r}=I(),l=s.filter(c=>c.label.toLowerCase().includes(t.toLowerCase()));return ae("type",l.map(c=>c.value)),e.jsx(oe,{multiple:!1,label:"Type",hasToggleIcon:!0,hasBadge:!0,onSearch:c=>n(c),options:l,onItemSelect:c=>d({type:c}),selectedItem:r})},Fe=u.lazy(()=>Q(()=>import("./index-C3diIwpC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])));function R(){const s=ce(),t=Y(),n=U(),{setSidePanelContent:d}=M(),r=(i={},h={})=>$({queryKey:["activities",i],queryFn:()=>t.get("activities",{params:i}),...h}),l=({activityId:i,...h},x={})=>$({queryKey:["activities",{activityId:i,...h}],queryFn:()=>t.get(`activities/${i}`,{params:h}),...x}),c=(i={},h={})=>$({queryKey:["activityTypes"],queryFn:()=>s.get("GetActivityTypes",{params:i}),...h}),b=N({mutationKey:["activities","cancel"],mutationFn:i=>s.get("CancelActivities",{params:i}),onSuccess:()=>n.invalidateQueries({queryKey:["activities"]})}),y=N({mutationKey:["activities","approve"],mutationFn:i=>s.get("ApproveActivities",{params:i}),onSuccess:()=>n.invalidateQueries({queryKey:["activities"]})}),p=N({mutationFn:i=>t.post("activities/reapply",i),onSuccess:()=>n.invalidateQueries({queryKey:["activities"]})}),C=N({mutationFn:i=>t.post("activities/revert",i),onSuccess:()=>n.invalidateQueries({queryKey:["activities"]})});return{getActivitiesQuery:r,getSingleActivityQuery:l,getActivityTypesQuery:c,cancelActivitiesQuery:b,approveActivitiesQuery:y,redoActivitiesQuery:p,undoActivitiesQuery:C,openActivityDetails:i=>{d(i.summary,e.jsx(u.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Fe,{activityId:i.id})}))}}}function Ne(s){const{state:t}=G(),n=t==null?void 0:t.activity;u.useEffect(()=>{t!=null&&t.activity&&(s(t.activity),window.history.replaceState({},""))},[n])}const ke="_container_1r60q_1",Ie="_buttons_1r60q_6",V={container:ke,buttons:Ie},$e=()=>{const[s,t]=u.useState(!1),{setPageParams:n,fromDate:d,toDate:r}=I(),l=J({initialValues:{fromDate:d||"",toDate:r||""},enableReinitialize:!0,validationSchema:X().shape({fromDate:q(),toDate:q()}),onSubmit:c=>{n({fromDate:c.fromDate,toDate:c.toDate}),t(!1)}});return e.jsx(o.ContextualMenu,{visible:s,autoAdjust:!0,toggleAppearance:"base",toggleLabel:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Date range"}),e.jsx("span",{className:O(v.badgeContainer),children:d||r?e.jsx(o.Badge,{value:d&&r?2:1,className:v.badge}):null})]}),toggleClassName:v.toggle,toggleProps:{onClick:()=>{t(!s)}},hasToggleIcon:!0,dropdownClassName:v.dropdown,position:"left",children:e.jsxs(o.Form,{onSubmit:l.handleSubmit,noValidate:!0,className:V.container,children:[e.jsxs("div",{className:v.container,children:[e.jsx(o.Input,{type:"datetime-local",label:"From",...l.getFieldProps("fromDate")}),e.jsx(o.Input,{type:"datetime-local",label:"To",...l.getFieldProps("toDate")})]}),e.jsxs("div",{className:V.buttons,children:[e.jsx(o.Button,{small:!0,type:"button",appearance:"base",onClick:()=>{t(!1),l.resetForm()},children:"Cancel"}),e.jsx(o.Button,{small:!0,type:"submit",appearance:"positive",children:"Add"})]})]})})},we=({resetSelectedIds:s})=>{const{query:t,setPageParams:n}=I(),{instanceId:d}=Z(),{getActivityTypesQuery:r}=R(),[l,c]=u.useState(""),[b,y]=u.useState(!1),{data:p}=r(),T=((p==null?void 0:p.data)??[]).map(g=>({label:g,value:g})),i=[{label:"All",value:""},...T],h=!!d,x=()=>{l&&(n({query:t?`${t},${l}`:`${l}`}),c(""),s())},_=()=>{n({query:""})},A=g=>{g.preventDefault(),x()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:O(k.container,{[k.sticky]:!h}),children:[e.jsx("div",{className:k.searchContainer,children:e.jsx(o.Form,{onSubmit:A,noValidate:!0,children:e.jsx(ye,{inputValue:l,onInputChange:g=>{c(g)},onSearchClick:x,onDescriptionClick:()=>y(!0),onClear:_})})}),e.jsxs("div",{className:k.filters,children:[e.jsx(ne,{options:L}),e.jsx(De,{options:i}),e.jsx($e,{})]})]}),e.jsx(xe,{open:b,data:Ae,onClose:()=>y(!1)}),e.jsx(re,{filtersToDisplay:["status","type","fromDate","toDate","query"],statusOptions:L,typeOptions:i})]})},Pe="_checkbox_19yw3_1",Ee="_description_19yw3_5",Oe="_link_19yw3_9",P={checkbox:Pe,description:Ee,link:Oe},Qe=(s,t)=>s&&t?` created-after:${s} created-before:${t}`:s?` created-after:${s}`:t?` created-before:${t}`:"",qe=s=>s?` type:${s}`:"",He=s=>s?` status:${s}`:"",Le=u.lazy(()=>Q(()=>import("./index-C3diIwpC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),Ge=({instanceId:s,selectedIds:t,setSelectedIds:n})=>{const{search:d,status:r,fromDate:l,toDate:c,type:b,currentPage:y,pageSize:p}=I(),{setSidePanelContent:C}=M(),{getActivitiesQuery:T}=R(),i=Qe(l,c),h=qe(b),x=He(r),_=`${d}${x}${i}${h}`,A=a=>{C(a.summary,e.jsx(u.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Le,{activityId:a.id})}))};Ne(A);const g=()=>{n([])},{data:m,isPending:D}=T({query:`${s?`computer:id:${s}`:""} ${_??""}`.trim(),limit:p,offset:(y-1)*p}),f=u.useMemo(()=>(m==null?void 0:m.data.results)??[],[m]),W=()=>{n(t.length!==0?[]:f.map(({id:a})=>a))},z=a=>{n(t.includes(a)?t.filter(F=>F!==a):[...t,a])},B=u.useMemo(()=>[{accessor:"checkbox",className:P.checkbox,Header:e.jsx(o.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all"}),inline:!0,onChange:W,checked:f.length>0&&t.length===f.length,indeterminate:t.length>0&&t.length<f.length}),Cell:({row:a})=>e.jsx(o.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:a.original.summary}),inline:!0,labelClassName:"u-no-margin--bottom u-no-padding--top",checked:t.includes(a.original.id),onChange:()=>{z(a.original.id)}})},{accessor:"summary",className:P.description,Header:"Description",Cell:({row:a})=>e.jsx(o.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top u-align-text--left",onClick:()=>A(a.original),children:a.original.summary})},{accessor:"activity_status",Header:"Status",Cell:({row:{original:{activity_status:a}}})=>E[a].label,getCellIcon:({row:{original:{activity_status:a}}})=>E[a].icon},{accessor:"computer_id",Header:"Instance",Cell:({row:a})=>a.original.computer_id?e.jsxs(ee,{className:P.link,to:`/instances/${a.original.computer_id}`,children:["ID: ",a.original.computer_id]}):e.jsx(H,{})},{accessor:"creation_time",Header:"Created at",Cell:({row:a})=>e.jsx(e.Fragment,{children:se(a.original.creation_time).format(te)})},{accessor:"creator.name",Header:"Creator",Cell:({row:a})=>{var F;return e.jsx(e.Fragment,{children:((F=a.original.creator)==null?void 0:F.name)??e.jsx(H,{})})}}].filter(a=>!s||a.accessor!=="computer_id"),[f,t]);return e.jsxs(e.Fragment,{children:[!_&&y===1&&p===20&&D&&e.jsx(S,{}),!_&&y===1&&p===20&&!D&&(!m||!m.data.count)&&e.jsx(le,{}),(!!_||y!==1||p!==20||!D&&m&&m.data.count>0)&&e.jsxs(e.Fragment,{children:[e.jsx(we,{resetSelectedIds:g}),D?e.jsx(S,{}):e.jsx(o.ModularTable,{emptyMsg:"No activities found according to your search parameters.",columns:B,data:f}),e.jsx(ie,{totalItems:m==null?void 0:m.data.count,currentItemCount:f.length,handleClearSelection:g})]})]})},Ve=u.lazy(()=>Q(()=>import("./index-C3diIwpC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),Je=s=>e.jsx(u.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Ve,{...s})});export{Ge as A,xe as S,E as a,Je as b,R as u};
