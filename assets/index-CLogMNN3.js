import{c as _,i as C,k as L,l as N,ac as P,B as I,r as k,j as s,W as x,d as u,p as h,I as j,q as M}from"./index-C_afT7mA.js";import{P as q,a as w,b as B}from"./PageMain-BVjkE8vb.js";import{d as D,s as g}from"./constants-CkyhILNL.js";import{u as K}from"./EditUserForm-B_nkB75_.js";import"./SidePanelFormButtons.module-BuIu-Bem.js";function v(){const i=_(),l=C(),n=(t={},o={})=>N({queryKey:["userDetails","getCredentials"],queryFn:async()=>i.get("credentials",{params:t}),...o}),r=L({mutationKey:["userDetails","generate"],mutationFn:async t=>i.post("credentials",t),onSuccess:async()=>l.invalidateQueries({queryKey:["userDetails","getCredentials"]})});return{fetchUserApiCredentials:n,generateApiCredentials:r}}const E="_tableWrapper_13q9l_1",G="_apiCredentials_13q9l_11",f={tableWrapper:E,apiCredentials:G},R=({user:i,credentials:l})=>{const n=P("(min-width: 620px)"),r=I(),{generateApiCredentials:t}=v(),{mutateAsync:o,isPending:c}=t,m=async a=>{try{await o({account:a})}catch(e){r(e)}},y=k.useMemo(()=>[{Header:"Label",accessor:"label"},{Header:"Value",accessor:"value",Cell:({value:a})=>a}],[i,l]);return i.accounts.map(a=>{const e=l.find(p=>p.account_name===a.name),b=[{label:"Name",value:e==null?void 0:e.account_name},{label:"Title",value:e==null?void 0:e.account_title},{label:"Identity",value:s.jsx("code",{children:i.identity})},{label:"Endpoint",value:s.jsx("code",{children:e==null?void 0:e.endpoint})},{label:"Access Key",value:e!=null&&e.access_key?s.jsx("code",{children:e.access_key}):x},{label:"Secret Key",value:e!=null&&e.secret_key?s.jsx("code",{children:e.secret_key}):x},{label:"Roles",value:a.roles.join(", ")}],d=e!=null&&e.secret_key||e!=null&&e.access_key?"Regenerate":"Generate";return s.jsx("div",{className:D.item,children:s.jsxs("div",{className:g.card,children:[s.jsxs("div",{className:g.header,children:[s.jsx("p",{className:g.title,children:a.title}),s.jsxs(u.ConfirmationButton,{className:h("u-no-margin--bottom",{"is-small":n}),type:"button",confirmationModalProps:{title:`${d} API credentials for ${a.title}`,children:s.jsxs("p",{children:[d==="Regenerate"?`${d.slice(0,-1)}ing your API credentials will make your previously used credentials obsolete and deauthenticate any clients using them. `:"","This action will create new credentials for integrating with the ",a.title," organization"]}),confirmButtonLabel:`${d} API credentials`,confirmButtonDisabled:c,confirmButtonLoading:c,onConfirm:async()=>m(a.name)},children:[d," API credentials"]})]}),s.jsx("div",{className:h(g.content,f.tableWrapper),children:n?s.jsx(u.ModularTable,{columns:y,data:b,emptyMsg:"No data available"}):b.map((p,A)=>s.jsxs(u.Row,{className:h("u-no-padding--left u-no-padding--right",f.apiCredentials),children:[s.jsx(u.Col,{size:2,small:2,children:s.jsx(j,{label:"",value:p.label})}),s.jsx(u.Col,{size:2,small:2,children:s.jsx(j,{label:"",value:p.value})})]},A))})]})},a.title)})},Q=()=>{var e;const{getUserDetails:i}=K(),{fetchUserApiCredentials:l}=v(),{data:n,isLoading:r}=i(),{data:t,isLoading:o}=l(),c=n==null?void 0:n.data,m=(e=t==null?void 0:t.data)==null?void 0:e.credentials,y=c&&m,a=r||o;return s.jsxs(q,{children:[s.jsx(w,{title:"API credentials"}),s.jsxs(B,{children:[a&&s.jsx(M,{}),y&&s.jsx(R,{user:c,credentials:m})]})]})};export{Q as default};
