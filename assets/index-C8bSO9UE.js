import{r as u,_ as f,e as y,f as x,j as t,g as m,p as g}from"./index-iyHIejiU.js";import{P,a as A,b as E}from"./PageMain-CGWGAp6o.js";import{u as b}from"./useRoles-BSlAWEcz.js";import{E as C}from"./EmptyState-ZfPBeN8Q.js";import{T as v}from"./TruncatedCell-Df_l_kHH.js";import{u as I}from"./useConfirm-_8nON0sp.js";import{u as D}from"./useOnClickOutside-ChepXlBh.js";const T="_bold_nffzr_1",S={bold:T},O=u.lazy(()=>f(()=>import("./index-DdmaV-vz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]))),k=({role:s})=>{const e=y(),{setSidePanelContent:n}=x(),{closeConfirmModal:o,confirmModal:r}=I(),{removeRoleQuery:a}=b(),{mutateAsync:i,isLoading:l}=a,d=async p=>{try{await i({name:p})}catch(_){e(_)}finally{o()}},c=p=>{r({title:`Remove '${p.name}' role`,body:t.jsxs("p",{children:[t.jsx("span",{children:`This will remove '${p.name}' role.`}),p.persons.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),t.jsx("span",{className:S.bold,children:`This will affect ${p.persons.length} administrator${p.persons.length===1?"":"s"}`})]})]}),buttons:[t.jsx(m.Button,{type:"button",appearance:"negative",onClick:()=>d(p.name),disabled:l,children:"Remove"},"remove")]})},h=p=>{n(`Edit "${p.name}" role`,t.jsx(u.Suspense,{fallback:t.jsx(g,{}),children:t.jsx(O,{role:p})}))};return t.jsxs("div",{className:"divided-blocks",children:[t.jsx("div",{className:"divided-blocks__item",children:t.jsx(m.Tooltip,{message:"Edit",position:"top-center",children:t.jsx(m.Button,{small:!0,hasIcon:!0,type:"button",appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Edit ${s.name} role`,onClick:()=>h(s),children:t.jsx(m.Icon,{name:"edit",className:"u-no-margin--left"})})})}),t.jsx("div",{className:"divided-blocks__item",children:t.jsx(m.Tooltip,{message:"Delete",position:"top-center",children:t.jsx(m.Button,{small:!0,hasIcon:!0,type:"button",appearance:"base",className:"u-no-margin--bottom u-no-padding--left","aria-label":`Delete ${s.name} role`,onClick:()=>c(s),children:t.jsx(m.Icon,{name:"delete",className:"u-no-margin--left"})})})})]})},N=s=>s.reduce((e,{global:n,name:o,title:r})=>{if(o==="RemoveComputerFromAccessGroup")return e;const a=/view/i.test(o)?"view":"manage",i=o==="AddComputerToAccessGroup"?"access group":r.replace(/(view|manage) /i,"").replace(/computer/i,"instance"),l=e.find(({label:d})=>d===i)||{global:n,label:i,values:{manage:"",view:""}};return l.values[a]=o,[...e.filter(({label:d})=>d!==i),l]},[]),te=s=>{const e={maxDepth:0,options:s.filter(n=>n.parent==="").map(({name:n,title:o})=>({children:[],depth:0,label:o,parents:[],value:n}))};for(;e.maxDepth>=0;){const n=e.options.filter(({depth:r})=>r===e.maxDepth);e.maxDepth++;const o=s.filter(({parent:r})=>n.some(({value:a})=>a===r));if(o.length===0)break;for(const{name:r,parent:a,title:i}of o){const l=n.find(({value:c})=>c===a);if(!l)continue;const d=[a,...l.parents];e.options.push({children:[],depth:e.maxDepth,label:i,parents:d,value:r});for(const c of d)e.options.filter(({value:h})=>h===c)[0].children.push(r)}}return e.options},w=(s,e,n)=>n.filter(o=>o.depth===e).filter(({value:o})=>s.includes(o))[0].value,se=s=>s.sort((e,n)=>{if(e.children.includes(n.value))return-1;if(n.children.includes(e.value))return 1;for(let o=0;o<Math.min(e.depth,n.depth);o++){const r=w(e.parents,o,s),a=w(n.parents,o,s);if(r!==a)return r.localeCompare(a)}return e.value.localeCompare(n.value)}),ne=(s,e)=>{const n=Math.max(...e.map(({depth:r})=>r)),o=s;if(s.length>0)for(let r=0;r<n;r++){const a=e.filter(({depth:i})=>i===r).filter(({value:i})=>s.includes(i));for(const i of a)if(i.children.every(l=>s.includes(l))){const l=s.filter(d=>!i.children.includes(d));s.splice(0,s.length,...l)}}return o},L="_actions_109z2_1",M="_expandedRow_109z2_5",$="_expandedCell_109z2_10",j={actions:L,expandedRow:M,expandedCell:$},R=(s,e,n)=>{const o=s.global_permissions?[...s.permissions,...s.global_permissions]:s.permissions,r=[...new Set(o.filter(a=>n==="manage"?!/(view|remove)/i.test(a):!/(remove)/i.test(a)&&!e.find(({values:i})=>i.manage===a&&!i.view)).map(a=>{var i;return((i=e.find(({values:l})=>n==="manage"?l.manage===a:l.view===a||l.manage===a))==null?void 0:i.label)??""}))];return r.length===0?"":r.length!==e.filter(({values:a})=>!!a[n]).length?r.map((a,i)=>i>0?a:a.replace(/^\w/,l=>l.toUpperCase())).join(", "):"All properties"},z=s=>({column:e,row:{index:n}})=>{const o={};return(s==null?void 0:s.rowIndex)===n&&s.columnId===e.id&&(o.className=j.expandedCell),e.id==="name"?o.role="rowheader":e.id==="persons"?o["aria-label"]="Administrators":e.id==="view"?o["aria-label"]="View permissions":e.id==="manage"?o["aria-label"]="Manage permissions":e.id==="actions"&&(o["aria-label"]="Actions"),o},B=s=>({index:e})=>{const n={};return s===e&&(n.className=j.expandedRow),n},F=s=>e=>{e&&(s.current=[...e.querySelectorAll("tbody tr")])},H=({roleList:s})=>{const[e,n]=u.useState(null),{getPermissionsQuery:o}=b(),r=u.useRef([]);D({current:e?r.current[e.rowIndex]:null},()=>n(null));const{data:a}=o(),i=a?N(a.data):[],l=u.useMemo(()=>s,[s]),d=u.useMemo(()=>[{accessor:"name",Header:"Name"},{accessor:"persons",Header:"Administrators",Cell:({row:c})=>c.original.persons.length},{accessor:"view",Header:"View",Cell:({row:{original:c,index:h}})=>t.jsx(v,{content:R(c,i,"view"),isExpanded:(e==null?void 0:e.rowIndex)===h&&e.columnId==="view",onExpand:()=>n({rowIndex:h,columnId:"view"})})},{accessor:"manage",Header:"Manage",Cell:({row:{original:c,index:h}})=>t.jsx(v,{content:R(c,i,"manage"),isExpanded:(e==null?void 0:e.rowIndex)===h&&e.columnId==="manage",onExpand:()=>n({rowIndex:h,columnId:"manage"})})},{accessor:"actions",className:j.actions,Cell:({row:{original:c}})=>t.jsx(k,{role:c})}],[l,a,e]);return t.jsx("div",{ref:F(r),children:t.jsx(m.ModularTable,{columns:d,data:l,getCellProps:z(e),getRowProps:B(e==null?void 0:e.rowIndex)})})},Q=u.lazy(()=>f(()=>import("./index-FmU1l_6H.js"),__vite__mapDeps([22,1,2,3,5,6,7,8,9,10,11,12,13,4,14,15,16,17,18,19,20,21]))),V=()=>{const{setSidePanelContent:s}=x(),{getRolesQuery:e}=b(),{data:n,isLoading:o}=e();return t.jsxs(t.Fragment,{children:[o&&t.jsx(g,{}),!o&&(!n||!n.data.length)&&t.jsx(C,{title:"No roles found",body:t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"u-no-margin--bottom",children:"You havenâ€™t added any roles yet."}),t.jsx("a",{href:"https://ubuntu.com/landscape/docs/administrators",target:"_blank",rel:"nofollow noopener noreferrer",children:"How to manage administrators in Landscape"})]}),cta:[t.jsx(m.Button,{appearance:"positive",onClick:()=>s("Add role",t.jsx(u.Suspense,{fallback:t.jsx(g,{}),children:t.jsx(Q,{})})),children:"Add role"},"add")]}),!o&&n&&n.data.length>0&&t.jsx(H,{roleList:n.data})]})},G=u.lazy(()=>f(()=>import("./index-FmU1l_6H.js"),__vite__mapDeps([22,1,2,3,5,6,7,8,9,10,11,12,13,4,14,15,16,17,18,19,20,21]))),q=()=>{const{setSidePanelContent:s}=x(),e=()=>{s("Add Role",t.jsx(u.Suspense,{fallback:t.jsx(g,{}),children:t.jsx(G,{})}))};return t.jsxs(P,{children:[t.jsx(A,{title:"Roles",actions:[t.jsx(m.Button,{type:"button",onClick:e,appearance:"positive",children:"Add role"},"add-role")]}),t.jsx(E,{children:t.jsx(V,{})})]})},U=q,oe=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));export{N as a,se as b,te as c,ne as g,oe as i};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-DdmaV-vz.js","assets/index-iyHIejiU.js","assets/index-BAlneFez.css","assets/formik.esm-c-905Aib.js","assets/index.esm-CfZZ3TkA.js","assets/useRoles-BSlAWEcz.js","assets/useFetchOld-Cc7ZDJ-i.js","assets/useMutation-Dzxfa_Ac.js","assets/useQuery-DWxiiFJ4.js","assets/AccessGroupBlock-C8C2Qoiv.js","assets/AccessGroupBlock-BBu3FI5L.css","assets/SidePanelFormButtons-BxUMNubN.js","assets/SidePanelFormButtons.module-DyBJG5lm.js","assets/SidePanelFormButtons-CR46v8uL.css","assets/PageMain-CGWGAp6o.js","assets/PageMain-DyI__TtH.css","assets/EmptyState-ZfPBeN8Q.js","assets/EmptyState-BNXajmMK.css","assets/TruncatedCell-Df_l_kHH.js","assets/TruncatedCell-BIhicLLO.css","assets/useConfirm-_8nON0sp.js","assets/useOnClickOutside-ChepXlBh.js","assets/index-FmU1l_6H.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
