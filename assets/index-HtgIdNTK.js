import{r as m,j as e,H as _,g as p,d as v,k as C,p as b}from"./index-Cgvo6fQq.js";import{P as f,a as E,b as j}from"./PageMain-CgsCzV83.js";import{h as y}from"./moment-Cl4UOzQZ.js";import{T as w}from"./TruncatedCell-Cgvmf07L.js";import"./moment-Ca7bd7oO.js";import"./ExpandableTableFooter.module-C3W6TVe_.js";import{a as P}from"./helpers-BfuBH7Ij.js";import{u as R}from"./useOnClickOutside-C8-jCCi3.js";import{u as x}from"./usePageParams-C_58JMDS.js";import{u as S}from"./useQuery-BkysfzoD.js";import"./TablePagination.module-DLVph1Z1.js";import{T}from"./TablePagination-BHogtBAM.js";const L="_message_1po57_1",H="_expandedCell_1po57_5",F="_expandedRow_1po57_10",g={message:L,expandedCell:H,expandedRow:F},N=o=>({index:t})=>{const n={};return o===t&&(n.className=g.expandedRow),n},M=o=>({column:t,row:{index:n}})=>{const s={};return t.id==="creation_time"?s.role="rowheader":t.id==="person_name"?s["aria-label"]="username":t.id==="entity_type"?s["aria-label"]="entity type":t.id==="entity_name"?s["aria-label"]="entity name":t.id==="message"&&(s["aria-label"]="message",o===n&&(s.className=g.expandedCell)),s},I=({eventsLog:o})=>{const[t,n]=m.useState(""),[s,d]=m.useState(-1),c=m.useRef([]);R({current:s!==-1?c.current[s]:null},()=>d(-1));const r=m.useMemo(()=>[{accessor:"creation_time",Header:"creation time",Cell:({row:a})=>e.jsx(e.Fragment,{children:y(a.original.creation_time).format(_)})},{accessor:"person_name",Header:"username",Cell:({row:a})=>e.jsx(e.Fragment,{children:a.original.person_name})},{accessor:"entity_type",Header:"entity type",Cell:({row:a})=>e.jsx(e.Fragment,{children:a.original.entity_type})},{accessor:"entity_name",Header:"entity name",Cell:({row:a})=>e.jsx(e.Fragment,{children:a.original.entity_name})},{accessor:"message",className:g.message,Header:"event log message",Cell:({row:{original:a,index:l}})=>e.jsx(w,{content:a.message,isExpanded:l===s,onExpand:()=>{n(""),d(t?l-1:l)}})}],[o,s]);return e.jsx("div",{ref:P(c),children:e.jsx(p.ModularTable,{getCellProps:M(s),getRowProps:N(s),columns:r,data:o,sortable:!0,emptyMsg:"No events found"})})},k="_container_r415z_1",D="_searchContainer_r415z_8",Y="_select_r415z_12",u={container:k,searchContainer:D,select:Y},h={days:{slug:"days",label:"Days",type:"select",options:[{label:"1 day",value:"1"},{label:"7 days",value:"7"},{label:"30 days",value:"30"},{label:"90 days",value:"90"},{label:"180 days",value:"180"},{label:"365 days",value:"365"}]}},z=()=>{const{search:o,days:t,setPageParams:n}=x(),[s,d]=m.useState(o),c=()=>{n({search:s})},r=()=>{n({search:""})},a=i=>{n({days:i.target.value})},l=i=>{i.preventDefault(),c()};return e.jsxs("div",{className:u.container,children:[e.jsx("div",{className:u.searchContainer,children:e.jsx(p.Form,{onSubmit:l,noValidate:!0,children:e.jsx(p.SearchBox,{value:s,onChange:i=>{d(i)},onSearch:c,onClear:r})})}),e.jsx(p.Select,{wrapperClassName:u.select,label:h.days.label,labelClassName:"u-no-margin--bottom",options:h.days.options,value:t,onChange:a})]})};function A(){const o=v();return{getEventsLog:(n,s={})=>S({queryKey:["events",n],queryFn:()=>o.get("events",{params:n}),...s})}}const O=(o,t)=>{const n=["creation_time","person_id","person_name","entity_type","entity_id","entity_name","message"],d=[["Creation Time","Person ID","Person Name","Entity Type","Entity ID","Entity Name","Message"].join(","),...o.map(l=>n.map(i=>l[i]).join(","))].join(`\r
`),c=new Blob([d],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(c),a=document.createElement("a");a.href=r,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)},$=()=>{const{days:o,search:t,currentPage:n,pageSize:s}=x(),{user:d}=C(),{getEventsLog:c}=A(),{data:r,isLoading:a}=c({days:Number(o),limit:s,offset:(n-1)*s,search:t}),l=m.useMemo(()=>(r==null?void 0:r.data.results.filter(i=>i.message.includes(t)))??[],[r,t]);return e.jsxs(f,{children:[e.jsx(E,{title:"Events log",actions:[e.jsx(p.Button,{onClick:()=>O(l,`Event Log - ${d.current_account}-${y().format("YYYY-MM-DDTHH mm ss[Z]")}.csv`),children:"Download as CSV"},"download-as-cv")]}),e.jsxs(j,{children:[e.jsx(z,{}),a&&e.jsx(b,{}),!a&&l&&e.jsx(I,{eventsLog:l}),e.jsx(T,{totalItems:r==null?void 0:r.data.count,currentItemCount:l.length})]})]})},se=$;export{se as default};
