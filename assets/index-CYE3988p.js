import{h as x,t as h,k as c,p as R,q as I,f as _,s as w,j as i,g as u}from"./index-GiuCVecl.js";import{u as F}from"./useRoles-DElVTfEo.js";import{g as j,a as C,b as D,c as V}from"./index-BeAhhiuD.js";import{P as y,A as Q}from"./AccessGroupBlock-XR-VjsrO.js";import{S as k}from"./SidePanelFormButtons-BJj6SSBO.js";import"./useFetchOld-DmpCZqVp.js";import"./PageMain-DojUpcuH.js";import"./TruncatedCell-BCEwutKH.js";import"./SidePanelFormButtons.module-tJTvEwdD.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="261f322b-a716-49eb-a4d5-7b05116d8df2",s._sentryDebugIdIdentifier="sentry-dbid-261f322b-a716-49eb-a4d5-7b05116d8df2")}catch{}const O={access_groups:[],description:"",name:"",permissions:[]},B=x().shape({access_groups:h().of(c()),description:c(),name:c().required("This field is required.").matches(/^[a-zA-Z][-+a-zA-Z0-9]*$/,"Name must start with a letter and can contain alphanumeric characters, ‘-‘ and ‘+’."),permissions:h().of(c())}),E=(s,t)=>({accessGroupsToAdd:j(s.access_groups,t),permissionsToAdd:s.permissions.includes("AddComputerToAccessGroup")?[...s.permissions,"RemoveComputerFromAccessGroup"]:s.permissions}),N=(s,t,d)=>{const{addAccessGroups:p,addPermissions:m}=d,r=[],{accessGroupsToAdd:n,permissionsToAdd:a}=E(s,t);return n.length>0&&r.push(p({name:s.name,access_groups:n})),a.length>0&&r.push(m({name:s.name,permissions:a})),r},K=()=>{const s=R(),{notify:t}=I(),{closeSidePanel:d}=_(),{createRoleQuery:p,addPermissionsToRoleQuery:m,addAccessGroupsToRoleQuery:r,getAccessGroupQuery:n,getPermissionsQuery:a}=F(),{data:l}=a(),g=l?C(l.data):[],{data:f}=n(),b=f?D(V(f.data)):[],{mutateAsync:A}=p,{mutateAsync:T}=m,{mutateAsync:P}=r,e=w({initialValues:O,validationSchema:B,onSubmit:async o=>{await A({description:o.description,name:o.name});const G=N(o,b,{addAccessGroups:P,addPermissions:T});try{await Promise.all(G),d(),t.success({title:"New role has been added",message:`You added the role '${o.name}'`})}catch(S){s(S)}}});return i.jsxs(u.Form,{onSubmit:e.handleSubmit,noValidate:!0,children:[i.jsx(u.Input,{type:"text",label:"Role name",required:!0,autoComplete:"off",...e.getFieldProps("name"),error:e.touched.name&&e.errors.name?e.errors.name:void 0}),i.jsx(u.Input,{type:"text",label:"Description",autoComplete:"off",...e.getFieldProps("description"),error:e.touched.description&&e.errors.description?e.errors.description:void 0}),i.jsx(y,{description:"These permissions are for managing the account as a whole. They are not limited to the specified access groups, but instead apply globally.",onPermissionChange:o=>e.setFieldValue("permissions",o),options:g.filter(({global:o})=>o),permissions:e.values.permissions,title:"Global permissions"}),i.jsx(y,{description:"These permissions only apply to selected access groups.",onPermissionChange:o=>e.setFieldValue("permissions",o),options:g.filter(({global:o})=>!o),permissions:e.values.permissions,title:"Permissions"}),i.jsx(Q,{accessGroupOptions:b,accessGroups:e.values.access_groups,onAccessGroupChange:o=>{e.setFieldValue("access_groups",o)}}),i.jsx(k,{submitButtonDisabled:e.isSubmitting,submitButtonText:"Add role"})]})};export{K as default};
