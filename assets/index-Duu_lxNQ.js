const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CNfgIf6E.js","assets/index-bwXOAcKK.js","assets/index-CsTxpRsw.css","assets/PackageProfileConstraintsBlock-WPjmyzX7.js","assets/CellInput-CbeOVcKG.js","assets/index-Bx4Ghr62.js","assets/PageMain-DGqxFa8m.js","assets/PageMain-BIuYvhUI.css","assets/useFetchOld-ByPhVfhm.js","assets/InfoItem-D5kMV4a4.js","assets/InfoItem-C-lWh_lY.css","assets/HeaderWithSearch-blRWdXlZ.js","assets/HeaderWithSearch-DQybm8h_.css","assets/SidePanelTablePagination-CHErDRzn.js","assets/TablePagination.module-CgQ3jx4B.js","assets/TablePagination-DTa7xTwu.css","assets/useRoles-OTQjxFzO.js","assets/usePageParams-TpNL_kGt.js","assets/index-BA-mh0bv.css","assets/PackageProfileConstraintsBlock-9pB7ZW9v.css","assets/SidePanelFormButtons-BtqRcXDp.js","assets/SidePanelFormButtons.module-yv6Qz3cN.js","assets/SidePanelFormButtons-CxAXtF89.css"])))=>i.map(i=>d[i]);
import{r as C,_ as B,q as F,s as w,i as I,j as e,d as r,o as A,c as k,k as L,n as j,m as q,l as H,t as W}from"./index-bwXOAcKK.js";import{H as D}from"./HeaderWithSearch-blRWdXlZ.js";import{u as E,L as M,C as z,a as T}from"./index-Bx4Ghr62.js";import{C as $}from"./CellInput-CbeOVcKG.js";import{S as U}from"./SidePanelTablePagination-CHErDRzn.js";import"./PageMain-DGqxFa8m.js";import"./useFetchOld-ByPhVfhm.js";import"./InfoItem-D5kMV4a4.js";import"./useRoles-OTQjxFzO.js";import"./usePageParams-TpNL_kGt.js";import"./TablePagination.module-CgQ3jx4B.js";const G=[{label:"All",value:""},{label:"Conflicts",value:"conflicts"},{label:"Depends",value:"depends"}],Q="_container_scrq4_1",Y={container:Q},J=C.lazy(()=>B(()=>import("./index-CNfgIf6E.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))),K=({filter:a,formik:n,onFilterChange:o,profile:s,selectedIds:u,setSelectedIds:p})=>{const P=F(),{notify:l}=w(),{setSidePanelContent:g}=I(),{removePackageProfileConstraintsQuery:h}=E(),{mutateAsync:N,isPending:m}=h,b=async()=>{try{await N({constraint_ids:u,name:s.name}),p([]),l.success({message:`${u.length} "${s.name}" profile's ${u.length===1?"constraint":"constraints"} removed successfully`,title:`Package profile ${u.length===1?"constraint":"constraints"} removed`})}catch(t){P(t)}},v=()=>{g(`Add package constraints to "${s.name}" profile`,e.jsx(C.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(J,{profile:s})}),"medium")};return e.jsxs("div",{className:Y.container,children:[e.jsx(r.Select,{label:"Constraint type",labelClassName:"u-no-padding--top",options:G,value:a,onChange:t=>o(t.target.value)}),e.jsxs(r.ConfirmationButton,{className:"has-icon u-no-margin--right",type:"button",disabled:u.length===0||n.values.id!==0,"aria-label":`Remove selected ${u.length===1?"constraint":"constraints"}`,confirmationModalProps:{title:`Remove ${u.length===1?"constraint":"constraints"}`,children:e.jsxs("p",{children:["This will remove ",u.length," ",u.length===1?"constraint":"constraints","."]}),confirmButtonLabel:"Remove",confirmButtonAppearance:"negative",confirmButtonDisabled:m,confirmButtonLoading:m,onConfirm:b},children:[e.jsx(r.Icon,{name:r.ICONS.delete}),e.jsx("span",{children:"Remove"})]}),e.jsxs(r.Button,{type:"button",hasIcon:!0,onClick:v,"aria-label":"Add new constraint",children:[e.jsx(r.Icon,{name:r.ICONS.plus}),e.jsx("span",{children:"Add constraints"})]})]})},X="_actionButton_14uri_1",Z="_tooltip_14uri_5",f={actionButton:X,tooltip:Z},ee=({constraint:a,formik:n})=>n.values.id===a.id?e.jsxs(e.Fragment,{children:[e.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:k("u-no-margin--bottom u-no-padding",f.actionButton),onClick:()=>n.handleSubmit(),children:e.jsx(r.Tooltip,{tooltipClassName:f.tooltip,message:"Save changes",children:e.jsx(r.Icon,{name:"success-grey",className:"u-no-margin--left u-no-margin--right"})})}),e.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>n.resetForm(),"aria-label":`Cancel editing ${a.package} constraint`,children:e.jsx(r.Tooltip,{tooltipClassName:f.tooltip,message:"Cancel",children:e.jsx(r.Icon,{name:"error-grey",className:"u-no-margin--left u-no-margin--right"})})})]}):e.jsx(r.Button,{type:"button",appearance:"base",hasIcon:!0,className:"u-no-margin--bottom u-no-padding",onClick:()=>n.setValues(a),disabled:n.values.id!==0,"aria-label":`Edit ${a.package} constraint`,children:e.jsx(r.Tooltip,{tooltipClassName:f.tooltip,message:"Edit constraint",children:e.jsx(r.Icon,{name:"edit",className:"u-no-margin--left u-no-margin--right"})})}),ne="_actionsCell_168s7_1",ae="_noPadding_168s7_7",te="_cell_168s7_11",se="_input_168s7_23",oe="_inputWrapper_168s7_31",re="_checkboxContainer_168s7_37",ie="_hidden_168s7_41",d={actionsCell:ne,noPadding:ae,cell:te,input:se,inputWrapper:oe,checkboxContainer:re,hidden:ie},le=async(a,n,o)=>{await a.setFieldValue(`${n}`,o),await a.setFieldTouched(`${n}`,!0),["rule","version"].includes(`${n}`)&&(o!==""?await a.setFieldValue("notAnyVersion",!0):a.values[n==="rule"?"version":"rule"]===""&&await a.setFieldValue("notAnyVersion",!1))},ce=(a,n)=>{if(!(!a.touched[n]||!a.errors[n]))return a.errors[n]},ue=a=>({handleConstraintPropChange:(n,o)=>le(a,n,o),getConstraintPropError:n=>ce(a,n)}),de=({column:a,row:n},o)=>{const s={};return s.className=k(d.cell,{[d.noPadding]:n.original.id===o}),n.original.package==="loading"?a.id==="package"?s.colSpan=5:(s.className=d.hidden,s["aria-hidden"]=!0):a.id==="package"?s.role="rowheader":a.id==="actions"?s["aria-label"]="Actions":a.id==="constraint"?s["aria-label"]="Constraint":a.id==="version"?s["aria-label"]="Version":a.id==="rule"&&(s["aria-label"]="Rule"),s},pe=(a,n)=>{let o="No constraints found";return a&&(o+=` with the constraint type: "${a}"`,n&&(o+=" and")),n&&(o+=` with the search: "${n}"`),o},ge=({filter:a,formik:n,isConstraintsLoading:o,onSelectedIdsChange:s,pageSize:u,profileConstraints:p,search:P,selectedIds:l})=>{const g=C.useMemo(()=>{if(o)return[M];if(!p)return[];const t=p.map(c=>({...c,notAnyVersion:!!c.version}));return n.values.id!==-1?t:[n.values,...t].slice(0,u)},[o,p,n.values,u]),h=()=>{s(l.length?[]:g.map(({id:t})=>t))},N=t=>{l.includes(t)?s(l.filter(c=>c!==t)):s([...l,t])},{handleConstraintPropChange:m,getConstraintPropError:b}=ue(n),v=C.useMemo(()=>[{accessor:"constraint",Header:()=>e.jsxs("div",{className:d.checkboxContainer,children:[e.jsx(r.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:"Toggle all constraints"}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:n.values.id!==0||g.length===0,checked:g.length>0&&g.length===l.length,indeterminate:l.length>0&&l.length<g.length,onChange:h}),e.jsx("span",{children:"Constraint"})]}),Cell:({row:{original:t}})=>n.values.id===t.id?e.jsx(r.Select,{label:"Constraint",labelClassName:"u-off-screen",className:d.input,wrapperClassName:d.inputWrapper,options:z,...n.getFieldProps("constraint"),onChange:c=>m("constraint",c.target.value),error:b("constraint")}):e.jsxs("div",{className:d.checkboxContainer,children:[e.jsx(r.CheckboxInput,{inline:!0,label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${t.package} constraint`}),labelClassName:"u-no-margin--bottom u-no-padding--top",disabled:n.values.id!==0,checked:l.includes(t.id),onChange:()=>N(t.id)}),e.jsx("span",{children:t.constraint})]})},{accessor:"package",Header:"Package",Cell:({row:{original:t}})=>n.values.id===t.id?e.jsx($,{placeholder:"Package name",label:"Package name",labelClassName:"u-off-screen",className:d.input,wrapperClassName:d.inputWrapper,...n.getFieldProps("package"),onChange:c=>m("package",c),error:b("package")}):t.package!=="loading"?e.jsx(e.Fragment,{children:t.package}):e.jsx(A,{})},{accessor:"rule",Header:"Rule",Cell:({row:{original:t}})=>{var c;return n.values.id===t.id?e.jsx(r.Select,{label:"Rule",labelClassName:"u-off-screen",className:d.input,wrapperClassName:d.inputWrapper,options:T,...n.getFieldProps("rule"),onChange:_=>m("rule",_.target.value),error:b("rule")}):e.jsx(e.Fragment,{children:((c=T.find(({value:_})=>_===t.rule))==null?void 0:c.label)??t.rule})}},{accessor:"version",Header:"Version",Cell:({row:{original:t}})=>n.values.id===t.id?e.jsx($,{placeholder:"Version",label:"Version",labelClassName:"u-off-screen",className:d.input,wrapperClassName:d.inputWrapper,...n.getFieldProps("version"),onChange:c=>m("version",c),error:b("version")}):e.jsx(e.Fragment,{children:t.version})},{accessor:"actions",className:d.actionsCell,Cell:({row:{original:t}})=>e.jsx(ee,{constraint:t,formik:n})}],[g,l.length,n.errors,n.touched]);return e.jsx(r.ModularTable,{columns:v,data:g,getCellProps:t=>de(t,n.values.id),className:"u-no-margin--bottom",emptyMsg:pe(a,P)})},he={constraint:"",id:0,notAnyVersion:!1,package:"",rule:"",version:""},me=L().shape({constraint:j().required("Required."),id:q(),notAnyVersion:H(),package:j().required("Required."),rule:j().when("notAnyVersion",{is:!0,then:a=>a.required("Required.")}),version:j().when("notAnyVersion",(a,n)=>a[0]?n.required("Required."):n)}),Ce="_pagination_15tqa_1",be={pagination:Ce},Fe=({profile:a})=>{const[n,o]=C.useState([]),[s,u]=C.useState(1),[p,P]=C.useState(20),[l,g]=C.useState(""),[h,N]=C.useState(""),m=i=>{o([]),u(i)},b=i=>{o([]),P(i)},v=F(),{notify:t}=w(),{editPackageProfileConstraintQuery:c,getPackageProfileConstraintsQuery:_}=E(),{mutateAsync:V}=c,S=W({initialValues:he,onSubmit:async(i,{resetForm:R})=>{try{await V({constraint:i.constraint,id:i.id,package:i.package,rule:i.rule,version:i.version,name:a.name}),t.success({message:`"${a.name}" package profile's constraint updated successfully`,title:"Package profile constraint updated"}),R()}catch(O){v(O)}},validationSchema:me}),{data:x,isLoading:y}=_({constraint_type:h||void 0,limit:p,name:a.name,offset:(s-1)*p,search:l});return e.jsxs(e.Fragment,{children:[!l&&!h&&s===1&&p===20&&y&&e.jsx(A,{}),(l||h||s!==1||p!==20||!y&&x&&x.data.results.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(D,{actions:e.jsx(K,{filter:h,formik:S,onFilterChange:i=>N(i),profile:a,selectedIds:n,setSelectedIds:i=>o(i)}),onSearch:i=>g(i),disabled:S.values.id!==0}),e.jsx(ge,{filter:h,formik:S,isConstraintsLoading:y,onSelectedIdsChange:i=>o(i),pageSize:p,profileConstraints:x==null?void 0:x.data.results,search:l,selectedIds:n}),e.jsx(U,{currentPage:s,pageSize:p,paginate:m,setPageSize:b,totalItems:x==null?void 0:x.data.count,className:be.pagination})]})]})};export{Fe as default};
