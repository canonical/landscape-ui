import{r as v,b as O,z as E,j as t,h as n,k as N,y,a as A,l as T,m as k,n as g,p as $,R as q,t as F}from"./index-BIsTIai5.js";import{A as R}from"./AuthTemplate-CYSHHB6_.js";import{r as S}from"./helpers-Bo73Thd0.js";import{S as I}from"./constants-LFXGfoad.js";const B="_list_463vl_1",C="_button_463vl_17",D="_icon_463vl_25",d={list:B,button:C,icon:D},H=({isStandaloneOidcEnabled:u,isUbuntuOneEnabled:m,oidcProviders:p,onInvitation:a})=>{const[i,c]=v.useState(0),[r]=O(),{getOidcUrlQuery:l,getUbuntuOneUrlQuery:b,getInvitationSummaryQuery:e}=E(),s=r.get("redirect-to"),o=r.get("invitation_id"),h=r.has("external"),{data:_}=e({invitationId:o??""},{enabled:!!o});v.useEffect(()=>{_&&a(_.data.account_title)},[_]);const x={};i>0&&(x.id=i),s&&(x.return_to=s),o&&(x.invitation_id=o),h&&(x.external=!0);const{data:j}=l(x,{enabled:i!==0});v.useEffect(()=>{j&&S(j.data.location)},[j]);const f={};s&&(f.return_to=`${window.origin}${s}`),o&&(f.invitation_id=o),h&&(f.external=!0);const{data:P,refetch:U}=b(f,{enabled:!1});return v.useEffect(()=>{P&&S(P.data.location)},[P]),t.jsxs("ul",{className:d.list,children:[m&&t.jsx("li",{className:"p-list__item",children:t.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:U,className:d.button,children:[t.jsx(n.Icon,{name:I["ubuntu-one"].icon,className:d.icon}),t.jsx("span",{children:"Sign in with Ubuntu One"})]})}),u&&t.jsx("li",{className:"p-list__item",children:t.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:()=>c(-1),className:d.button,children:[t.jsx(n.Icon,{name:I["standalone-oidc"].icon,className:d.icon}),t.jsx("span",{children:"Sign in with Enterprise Login"})]})}),p.map(w=>t.jsx("li",{className:"p-list__item",children:t.jsxs(n.Button,{type:"button",hasIcon:!0,onClick:()=>c(w.id),className:d.button,children:[t.jsx(n.Icon,{name:I[w.provider].icon,className:d.icon}),t.jsx("span",{children:`Sign in with ${w.name}`})]})},w.id))]})},V="_buttonRow_46ihv_1",W={buttonRow:V},z=({isEmailIdentityOnly:u})=>{const[m]=O(),p=N(),{signInWithEmailAndPasswordQuery:a}=E(),{setUser:i}=y(),c=A(),r=m.get("redirect-to"),l=m.has("external"),{mutateAsync:b}=a,e=T({initialValues:{email:"",password:"",remember:!1},validationSchema:k().shape({email:u?g().required("This field is required").email("Please provide a valid email address"):g().required("This field is required"),password:g().required("This field is required"),remember:$()}),onSubmit:async s=>{try{const{data:o}=await b({email:s.email,password:s.password});if(l&&r)S(r,{replace:!0});else{i(o,s.remember);const h=new URL(r??`${q}overview`,location.origin);c(h.toString().replace(h.origin,""),{replace:!0})}}catch(o){p(o)}}});return t.jsxs(n.Form,{onSubmit:e.handleSubmit,children:[t.jsx(n.Input,{type:"text",label:u?"Email":"Identity",error:e.touched.email&&e.errors.email?e.errors.email:void 0,...e.getFieldProps("email"),"data-testid":"email"}),t.jsx(n.PasswordToggle,{id:"password",label:"Password",error:e.touched.password&&e.errors.password?e.errors.password:void 0,...e.getFieldProps("password"),"data-testid":"password"}),t.jsx(n.CheckboxInput,{label:"Remember this device",...e.getFieldProps("remember")}),t.jsx("div",{className:W.buttonRow,children:t.jsx(n.Button,{type:"submit",appearance:"positive",disabled:e.isSubmitting,className:"u-no-margin--bottom",children:"Sign in"})})]})},Y=()=>{const[u,m]=v.useState(""),{getLoginMethodsQuery:p}=E(),{data:a,isLoading:i}=p(),c=a!=null&&a.data.oidc.available?a==null?void 0:a.data.oidc.configurations.filter(({enabled:s})=>s):[],r=!!(a!=null&&a.data.standalone_oidc.available&&a.data.standalone_oidc.enabled),l=!!(a!=null&&a.data.ubuntu_one.available&&a.data.ubuntu_one.enabled),b=!!(a!=null&&a.data.password.available&&a.data.password.enabled),e=!!(a!=null&&a.data.pam.available&&a.data.pam.enabled);return t.jsxs(R,{invitationAccount:u,title:"Sign in to Landscape",children:[i&&t.jsx(F,{}),!i&&(b||e)&&t.jsx(z,{isEmailIdentityOnly:e}),!i&&(l||r||c.length>0)&&t.jsx(H,{isStandaloneOidcEnabled:r,isUbuntuOneEnabled:l,oidcProviders:c,onInvitation:s=>m(s)}),!i&&!b&&!l&&!c.length&&t.jsx("span",{children:"It seems like you have no way to get in. Please contact our support team."})]})};export{Y as default};
