const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B9cISp33.js","assets/index-CDk-Jgvr.js","assets/index-B4xaleMR.css","assets/CodeEditor-CRtMIC7q.js","assets/index-C_IEMtmD.js","assets/CodeEditor-KxSGUzo3.css","assets/SidePanelFormButtons-CsUGQk2E.js","assets/SidePanelFormButtons.module-BuIu-Bem.js","assets/SidePanelFormButtons-CmV-sWf7.css","assets/HeaderWithSearch-lC_PsP2p.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/Chip-Cl4ow-w6.js","assets/Chip-R6WqXyae.css","assets/constants-DRKgEQ0k.js","assets/SidePanelTablePagination-ByE4BkY1.js","assets/constants-BR1biRXO.js","assets/index-ZQQe9POB.css"])))=>i.map(i=>d[i]);
import{b as _,g as L,h as C,i as U,v as ue,w as de,x as $,b0 as me,l as m,Z as N,o as pe,p as w,n as y,q as fe,j as e,d as o,s as k,am as he,A as x,C as V,K as b,z as j,N as S,_ as z,ap as ge,ay as xe,aq as Ae,k as _e,E as ye,an as ve}from"./index-CDk-Jgvr.js";import"./index-C_IEMtmD.js";import{H as be}from"./HeaderWithSearch-lC_PsP2p.js";import{C as H}from"./Chip-Cl4ow-w6.js";import{L as Fe}from"./constants-DRKgEQ0k.js";import{C as je}from"./CodeEditor-CRtMIC7q.js";import{S as Se}from"./SidePanelFormButtons-CsUGQk2E.js";import{S as Ce}from"./SidePanelTablePagination-ByE4BkY1.js";import{L as Ie}from"./constants-BR1biRXO.js";const G=()=>{const t=_(),s=L(),{isPending:a,mutateAsync:n}=C({mutationFn:async i=>t.post("autoinstall",i),onSuccess:async()=>s.invalidateQueries({queryKey:["autoinstallFiles"]})});return{isAutoinstallFileAdding:a,addAutoinstallFile:n}},Te=()=>{const t=_(),s=L(),{isPending:a,mutateAsync:n}=C({mutationFn:async({id:i})=>t.delete(`autoinstall/${i}`),onSuccess:async()=>s.invalidateQueries({queryKey:["autoinstallFiles"]})});return{deleteAutoinstallFile:n,isAutoinstallFileDeleting:a}},W=({id:t,...s})=>{const a=_(),{data:n,isLoading:i}=U({queryKey:["autoinstallFiles",t,{...s}],queryFn:async()=>a.get(`autoinstall/${t}`,{params:s})});return{autoinstallFile:n?.data,isAutoinstallFileLoading:i}},Y=(t,s={})=>{const a=_(),{data:n,isLoading:i,isFetching:l}=U({queryKey:["autoinstallFiles",t],queryFn:async()=>a.get("autoinstall",{params:t}),...s});return{autoinstallFiles:n?.data.results??[],autoinstallFilesCount:n?.data.count,isAutoinstallFilesLoading:i,isFetching:l}},K=()=>{const t=_(),s=L(),{isPending:a,mutateAsync:n}=C({mutationFn:async({id:i,...l})=>t.patch(`autoinstall/${i}`,l),onSuccess:async()=>{await s.invalidateQueries({queryKey:["autoinstallFiles"]})}});return{isAutoinstallFileUpdating:a,updateAutoinstallFile:n}},Le=()=>{const t=_(),{isPending:s,mutateAsync:a}=C({mutationFn:async n=>t.post("autoinstall:validate",n)});return{isAutoinstallFileValidating:s,validateAutoinstallFile:a}},P="yaml",M=`.${P}`,Q=[P,"yml"],B=t=>t.replace(new RegExp(`\\.(${Q.join("|")})$`),""),Ne="_form_1dly8_1",we="_inputContainer_1dly8_7",Pe="_input_1dly8_7",Ee="_inputDescription_1dly8_16",F={form:Ne,inputContainer:we,input:Pe,inputDescription:Ee},De=ue().shape({contents:$().required("This field is required"),filename:$().required("This field is required"),is_default:de()}),Oe={contents:"",filename:"",is_default:!1},$e=(t,s)=>t===s,ke=t=>{if(me(t)&&t.response){const{error:s}=t.response.data;return s==="AutoinstallOverrideWarning"}return!1},Ve=t=>{const s=t.response?.data.message.match(/overrides fields (.+)$/);return s?s[1].split(",").map(a=>a.trim()):[]},X=({buttonText:t,description:s,initialFile:a=Oe,notification:n,onSubmit:i})=>{const l=t==="Add",r=m.useRef(null),[d,p]=m.useState([]),{setTrue:A,setFalse:v,value:I}=N(),f=pe(),{notify:T}=w(),{closeSidePanel:ne}=y(),{validateAutoinstallFile:ae,isAutoinstallFileValidating:D}=Le(),O=async(u,h=!1)=>{const g=`${u.filename}${M}`;try{await i({contents:u.contents,is_default:u.is_default,filename:g,accept_warning:h}),ne(),T.success({message:`The autoinstall file ${g} ${n.message}`,title:`${n.title} ${g}`})}catch(ce){f(ce)}},c=fe({initialValues:{contents:a.contents,is_default:a.is_default,filename:B(a.filename)},validationSchema:De,onSubmit:async u=>{try{await ae({contents:u.contents}),await O(u,!1)}catch(h){if(ke(h)){const g=Ve(h);p(g),A()}else f(h)}}}),ie=async()=>{c.setSubmitting(!0),await O(c.values,!0),v()},le=async({target:{files:u}})=>{if(!u)return;const[h]=u,g=c.setFieldValue("contents",await h.text());if(c.values.filename){await g;return}await Promise.all([c.setFieldValue("filename",B(h.name)),g])},oe=async u=>{await c.setFieldValue("contents",u)},re=()=>{r.current?.click()};return e.jsxs(o.Form,{className:F.form,noValidate:!0,onSubmit:c.handleSubmit,children:[e.jsx("span",{children:s}),e.jsxs("div",{className:F.inputContainer,children:[e.jsx(o.Input,{wrapperClassName:F.input,type:"text",label:"File name",...c.getFieldProps("filename"),error:k(c,"filename"),disabled:!!a.filename,required:!0}),e.jsx("span",{className:F.inputDescription,children:M})]}),l&&e.jsx(o.Input,{type:"checkbox",label:"Default",...c.getFieldProps("is_default"),help:"This file will be used to configure newly registered instances. Only one default file can be set at a time."}),e.jsx("input",{ref:r,className:"u-hide",type:"file",accept:Q.map(u=>`.${u}`).join(","),onChange:le}),e.jsx(je,{label:"Code",value:c.values.contents,onChange:oe,error:k(c,"contents"),required:!0,language:P,headerContent:e.jsxs(o.Button,{className:"u-no-margin--bottom",appearance:"base",hasIcon:!0,onClick:re,type:"button",children:[e.jsx(o.Icon,{name:"upload"}),e.jsx("span",{children:"Populate from file"})]})}),e.jsx(Se,{submitButtonDisabled:$e(c.values.contents,a.contents)||c.isSubmitting||D,submitButtonLoading:D||c.isSubmitting,submitButtonText:t}),I&&e.jsxs(o.ConfirmationModal,{title:"Override autoinstall file",confirmButtonLabel:"Override and add file",confirmButtonAppearance:"negative",confirmButtonLoading:c.isSubmitting,onConfirm:ie,close:v,confirmButtonProps:{type:"button"},children:[e.jsx("p",{children:"The autoinstall file you submitted overrides the following fields:"}),e.jsx("ul",{children:d.map(u=>e.jsx("li",{children:u},u))}),e.jsx("p",{children:"Overriding these fields could cause client registration to fail if not formatted correctly."})]})]})},Me="_container_fgz2s_1",Be={container:Me},Z=({openAddForm:t})=>e.jsxs(e.Fragment,{children:[e.jsx(be,{actions:e.jsx("div",{className:Be.container,children:e.jsxs(o.Button,{type:"button",className:"u-no-margin",hasIcon:!0,onClick:t,children:[e.jsx(o.Icon,{name:"plus"}),e.jsx("span",{children:"Add new"})]})})}),e.jsx(he,{filtersToDisplay:["search"]})]}),qe={message:"has been edited and all the changes made have been saved successfully.",title:"You have successfully saved changes for"},Re=({autoinstallFile:t})=>{const{autoinstallFile:s,isAutoinstallFileLoading:a}=W({id:t.id,with_metadata:!0}),{updateAutoinstallFile:n}=K();return a||!s?e.jsx(x,{}):e.jsxs(e.Fragment,{children:[s.metadata.max_versions<=s.version&&e.jsxs(o.Notification,{title:"Edit history limit reached:",severity:"caution",children:["You've reached the limit of"," ",s.metadata.max_versions," saved"," ",V(s.metadata.max_versions,"edit"),". To save your new change, the oldest version will be automatically removed, keeping the most recent"," ",s.metadata.max_versions," ",V(s.metadata.max_versions,"version")," ","in history."]}),e.jsx(X,{buttonText:"Save changes",description:`The duplicated ${s.filename} will be assigned to the same user groups in the identity provider as the original file.`,initialFile:s,notification:qe,onSubmit:async({contents:i,is_default:l,accept_warning:r})=>{await n({id:s.id,contents:i,is_default:l,accept_warning:r})}})]})},Ue="_chip_1aiey_1",ze="_container_1aiey_6",q={chip:Ue,container:ze},E=({file:t,title:s,version:a=t.version})=>e.jsxs("div",{className:q.container,children:[!!s&&`${s} `,t.filename,", v",a,t.is_default&&e.jsx(H,{className:q.chip,value:"Default"})]}),J=({autoinstallFile:t,close:s})=>{const{notify:a}=w(),{closeSidePanel:n}=y(),{deleteAutoinstallFile:i,isAutoinstallFileDeleting:l}=Te(),r=async()=>{await i({id:t.id}),s(),n(),a.success({message:`The autoinstall file ${t.filename} has been permanently removed. All Employee accounts previously relying on it through identity provider group assignments will now fall back to the default autoinstall file.`,title:`You have successfully removed ${t.filename} autoinstall file.`})};return e.jsx(o.ConfirmationModal,{close:s,confirmButtonAppearance:"negative",confirmButtonLabel:"Remove",onConfirm:r,confirmButtonLoading:l,title:`Remove ${t.filename}, autoinstall file`,children:e.jsxs("p",{children:["You are about to remove ",t.filename,", an autoinstall file. This action is irreversible. All Employee accounts previously assigned this file via identity provider will instead use the default autoinstall file."]})})},He=({file:t})=>e.jsxs(b,{children:[e.jsx(b.Item,{label:"Name",value:t.filename}),e.jsx(b.Item,{label:"Version",value:t.version}),e.jsx(b.Item,{label:"Last modified",value:j(t.last_modified_at).format(S)}),e.jsx(b.Item,{label:"Date created",value:j(t.created_at).format(S)})]}),Ge=m.lazy(async()=>z(()=>import("./index-B9cISp33.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),We=({file:t,viewVersionHistory:s})=>{const{setSidePanelContent:a}=y(),{autoinstallFile:n,isAutoinstallFileLoading:i}=W({id:t.id,with_metadata:!0}),[l,r]=m.useState(1),[d,p]=m.useState(20),A=n?n.metadata.versions:[],v=A.slice(l-1,l*d),I=m.useMemo(()=>[{accessor:"version",Header:"Version",Cell:({row:{original:f}})=>{const T=()=>{a(e.jsx(E,{file:t,version:f.version}),e.jsx(m.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(Ge,{file:t,goBack:s,versionInfo:f})}))};return e.jsxs(o.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:T,children:["Version ",f.version]})}},{accessor:"created_at",Header:"Created at",Cell:({row:{original:{created_at:f}}})=>e.jsx("div",{className:"font-monospace",children:j(f).format(S)})}],[]);return i?e.jsx(x,{}):e.jsxs(e.Fragment,{children:[e.jsx(o.ModularTable,{columns:I,data:v}),e.jsx(Ce,{currentItemCount:v.length,currentPage:l,pageSize:d,paginate:r,setPageSize:p,totalItems:A.length})]})},Ye="_tabs_1ks86_1",Ke={tabs:Ye},Qe=[{id:"info",label:"Info"},{id:"version-history",label:"Version history"}],Xe=({file:t,viewVersionHistory:s,initialTabId:a="info"})=>{const[n,i]=m.useState(a),l=Qe.map(({label:r,id:d})=>({label:r,active:d===n,role:"tab",onClick:()=>{i(d)}}));return e.jsxs(e.Fragment,{children:[e.jsx(o.Tabs,{listClassName:Ke.tabs,links:l}),n==="info"&&e.jsx(He,{file:t}),n==="version-history"&&e.jsx(We,{file:t,viewVersionHistory:s})]})},Ze=({autoinstallFile:t,initialTabId:s})=>{const{value:a,setTrue:n,setFalse:i}=N(),{openAutoinstallFileDetails:l,openAutoinstallFileEditForm:r,setAutoinstallFileAsDefault:d}=te(t),p=()=>{l("version-history")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-segmented-control",children:e.jsxs("div",{className:"p-segmented-control__list",children:[e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button",onClick:r,hasIcon:!0,children:[e.jsx(o.Icon,{name:"edit"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button",onClick:d,disabled:t.is_default,hasIcon:!0,children:[e.jsx(o.Icon,{name:"starred"}),e.jsx("span",{children:"Set as default"})]}),e.jsxs(o.Button,{type:"button",className:"p-segmented-control__button",onClick:n,disabled:t.is_default,hasIcon:!0,children:[e.jsx(o.Icon,{name:o.ICONS.delete}),e.jsx("span",{children:"Remove"})]})]})}),e.jsx(Xe,{initialTabId:s,file:t,viewVersionHistory:p}),a&&e.jsx(J,{autoinstallFile:t,close:i})]})},ee=()=>{const{setSidePanelContent:t}=y();return(s,a)=>{t(e.jsx(E,{file:s}),e.jsx(m.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(Ze,{initialTabId:a,autoinstallFile:s})}))}},te=t=>{const{notify:s}=w(),{closeSidePanel:a,setSidePanelContent:n}=y(),{updateAutoinstallFile:i}=K(),l=ee();return{openAutoinstallFileDetails:r=>{l(t,r)},openAutoinstallFileEditForm:()=>{n(e.jsx(E,{file:t,title:"Edit"}),e.jsx(m.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(Re,{autoinstallFile:t})}))},setAutoinstallFileAsDefault:async()=>{await i({id:t.id,is_default:!0}),a(),s.success({message:"Employee accounts without a specific autoinstall file assigned via the identity provider will now inherit this default file.",title:`You have successfully set ${t.filename} as the default autoinstall file`})}}},Je=({autoinstallFile:t})=>{const{value:s,setTrue:a,setFalse:n}=N(),{openAutoinstallFileDetails:i,openAutoinstallFileEditForm:l,setAutoinstallFileAsDefault:r}=te(t),d=()=>{i()},p=[{icon:"show",label:"View details","aria-label":`View ${t.filename} details`,onClick:d},{icon:"edit",label:"Edit","aria-label":`Edit ${t.filename}`,onClick:l},{icon:"starred",label:"Set as default","aria-label":`Set ${t.filename} as default`,onClick:r,disabled:t.is_default}],A=[{icon:"delete",label:"Remove","aria-label":`Remove ${t.filename}`,onClick:a,disabled:t.is_default}];return e.jsxs(e.Fragment,{children:[e.jsx(ge,{toggleAriaLabel:`${t.filename} actions`,actions:p,destructiveActions:A}),s&&e.jsx(J,{autoinstallFile:t,close:n})]})},et="_container_56wd4_1",tt="_header_56wd4_6",R={container:et,header:tt},st=({column:t})=>{{const s={};switch(t.id){case"filename":s.role="rowheader";break;case"last_modified_at":s["aria-label"]="last modified at";break}return s}},nt=()=>({}),se=({autoinstallFiles:t})=>{const s=ee(),a=m.useMemo(()=>[{...Ie,accessor:"filename",Header:e.jsxs("div",{className:R.header,children:["Name",e.jsx("span",{className:"u-text--muted",children:"Version"})]}),Cell:({row:{original:n}})=>e.jsxs(xe,{children:[e.jsxs("div",{className:R.container,children:[e.jsx(o.Button,{type:"button",appearance:"link",className:"u-no-margin u-no-padding--top u-align-text--left",onClick:()=>{s(n)},children:n.filename}),n.is_default&&e.jsx(H,{value:"Default"})]}),e.jsxs("span",{className:"u-text--muted",children:["Version ",n.version]})]})},{accessor:"last_modified_at",Header:"Last edited",Cell:({row:{original:{last_modified_at:n}}})=>e.jsx("div",{className:"font-monospace",children:j(n).format(S)})},{...Fe,Cell:({row:{original:n}})=>e.jsx(Je,{autoinstallFile:n})}],[]);return e.jsx(Ae,{columns:a,data:t,emptyMsg:"No autoinstall files found according to your search parameters.",getCellProps:st,getRowProps:nt})},at=Object.freeze(Object.defineProperty({__proto__:null,AutoinstallFileForm:X,AutoinstallFilesHeader:Z,AutoinstallFilesList:se,useAddAutoinstallFile:G,useGetAutoinstallFiles:Y},Symbol.toStringTag,{value:"Module"})),it={message:"is now available and can be assigned to identity provider user groups.",title:"You have successfully added"},lt=m.lazy(async()=>z(()=>Promise.resolve().then(()=>at),void 0).then(t=>({default:t.AutoinstallFileForm}))),ot=()=>{const{currentPage:t,pageSize:s,search:a}=_e(),{setSidePanelContent:n}=y(),{addAutoinstallFile:i}=G(),{autoinstallFiles:l,autoinstallFilesCount:r,isAutoinstallFilesLoading:d}=Y({limit:s,offset:(t-1)*s,search:a}),p=()=>{n("Add new autoinstall file",e.jsx(m.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(lt,{buttonText:"Add",description:"Add autoinstall file. It can be applied during the initial setup of associated instances.",notification:it,onSubmit:i})}))};return!l.length&&!a&&!d?e.jsx(ye,{icon:"file",title:"No autoinstall files found",body:e.jsx("p",{className:"u-no-margin--bottom",children:"You haven't added any autoinstall files yet."}),cta:[e.jsx(o.Button,{appearance:"positive",onClick:p,className:"u-no-margin--right",children:"Add autoinstall file"},"add-autoinstall-file")]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{openAddForm:p}),d?e.jsx(x,{}):e.jsx(se,{autoinstallFiles:l}),e.jsx(ve,{currentItemCount:l.length,totalItems:r})]})},xt=Object.freeze(Object.defineProperty({__proto__:null,default:ot},Symbol.toStringTag,{value:"Module"}));export{M as A,P as a,xt as b,B as r,W as u};
