import{j as a,d as l,aM as E,r as g,a0 as H,R as t,aq as x,I as n,aN as A,L as m,a as q,u as B,aa as S,X as L,Z as P,z as M,aO as F,aP as G,y as V,h as W,aQ as Q,P as K,S as z,aR as Y,e as Z}from"./index-Dfc97QGW.js";import{A as X}from"./SidePanel-BVCSOSpO.js";import{b as J}from"./useGetOverLimitSecurityProfiles-BcqEGzNx.js";import"./helpers-BbXQOWxJ.js";import"./InstancesPageActions-Dns4Yse-.js";import"./index-DiSNWm9B.js";import"./InfoGrid-CrJbMYy5.js";import"./constants-DP4KACWi.js";import"./Blocks-D5DN66oP.js";import"./index-S_kjB96R.js";import{I as aa}from"./InfoItem-DImpX37B.js";import{u as ea}from"./useAuthAccounts-C0VrFEFy.js";import"./useFetchOld-BgGVMMmJ.js";import"./ListTitle-DsIgCqjQ.js";import"./NoData-DMN9LLPq.js";import"./ResponsiveTable-ViIMTRR6.js";import"./StaticLink-BNg3qc2M.js";import"./TruncatedCell-Cf7_euhM.js";import"./Truncated-D8EZCoK1.js";import"./useExpandableRow-DYtdXwcw.js";import"./TextConfirmationModal-O9rtHEfo.js";import"./TablePagination-B0v8QAQr.js";import"./TableFilterChips-DXWGZ6VK.js";import"./PageParamFilter-C5PJgjVf.js";import"./TableFilter-BmLRyeMD.js";import"./formikErrors-Bw8iTXYS.js";const sa=({hideBanner:e})=>a.jsxs(l.Modal,{close:e,title:"Landscape web portal (Preview)",buttonRow:a.jsx(l.Button,{appearance:"positive",className:"u-no-margin--bottom",onClick:e,children:"Got it!"}),children:[a.jsx("p",{children:"Welcome to the new Landscape web portal (Preview)!"}),a.jsx("p",{children:"This portal is still a work-in-progress. Some features may not be available yet and you may encounter some bugs."}),a.jsxs("p",{children:["You can switch back to the classic portal at any time and"," ",a.jsx("a",{href:E,target:"_blank",rel:"noopener noreferrer",children:"share your feedback with us on Discourse"}),"."]})]}),na=()=>{const[e,s]=g.useState(!1),i=()=>{s(!1),localStorage.setItem("_landscape_isWelcomePopupClosed","true")};return g.useEffect(()=>{const o=localStorage.getItem("_landscape_isWelcomePopupClosed");s(!o)},[]),e?a.jsx(sa,{hideBanner:i}):null},ta="_wrapper_1q4dg_1",ia="_secondaryNavigation_1q4dg_5",oa="_pageContent_1q4dg_9",w={wrapper:ta,secondaryNavigation:ia,pageContent:oa},la=()=>{const{isDarkMode:e,set:s}=H();return a.jsx(l.Switch,{id:"dark-mode-switch",checked:e,onChange:()=>{s(!e)},label:"Dark mode"})},ra="_secondaryNavigation_1ag2x_1",ca="_secondaryNavigation__drawer_1ag2x_18",da="_secondaryNavigation__title_1ag2x_25",pa="_secondaryNavigation__link_1ag2x_30",ga="_secondaryNavigation__label_1ag2x_34",ha="_isActive_1ag2x_38",_a="_footer_1ag2x_42",u={secondaryNavigation:ra,secondaryNavigation__drawer:ca,secondaryNavigation__title:da,secondaryNavigation__link:pa,secondaryNavigation__label:ga,isActive:ha,footer:_a},C={label:"Account settings",path:t.account.root(),items:[{label:"General",path:t.account.general()},{label:"Alerts",path:t.account.alerts()},{label:"API credentials",path:t.account.apiCredentials()}]},ua=()=>{const e=x();return a.jsxs("div",{className:n("p-side-navigation p-panel is-dark",u.secondaryNavigation),children:[a.jsxs("nav",{className:n("u-padding-top--medium is-dark",u.secondaryNavigation__drawer),"aria-labelledby":"secondary-navigation-title",children:[a.jsx("h2",{className:n("p-heading--4 p-panel__logo-name is-dark u-no-padding--top",u.secondaryNavigation__title),id:"secondary-navigation-title",children:C.label}),a.jsx("ul",{className:"p-side-navigation__list",children:C.items?.map(s=>{const i=A(s.path,e.pathname);return a.jsx("li",{children:a.jsx(m,{"aria-current":i?"page":void 0,className:n("p-side-navigation__link",u.secondaryNavigation__link,{[u.isActive]:i}),to:s.path,children:a.jsx("span",{className:u.secondaryNavigation__label,children:s.label})})},s.path)})})]}),a.jsx("div",{className:u.footer,children:a.jsx(la,{})})]})},ma="_label_vjkqv_1",va="_badge_vjkqv_5",xa="_hasBadge_vjkqv_9",ba="_link_vjkqv_16",ja="_accordionButton_vjkqv_29",Na="_icon_vjkqv_53",fa="_hasDivider_vjkqv_58",d={label:ma,badge:va,hasBadge:xa,link:ba,accordionButton:ja,icon:Na,hasDivider:fa},T=({item:e})=>a.jsxs("a",{className:n("p-side-navigation__link",d.link),href:e.path,target:"_blank",rel:"nofollow noopener noreferrer",children:[e.icon&&a.jsx("i",{className:n(`p-icon--${e.icon} is-light p-side-navigation__icon`,d.icon)}),a.jsx("span",{className:n("p-side-navigation__label",d.label),children:e.label})]}),O=({item:e,current:s})=>a.jsxs(m,{className:n("p-side-navigation__link",d.link),to:e.path,"aria-current":s?"page":void 0,children:[e.icon&&a.jsx("i",{className:n(`p-icon--${e.icon} is-light p-side-navigation__icon`,d.icon)}),a.jsxs("span",{className:n("p-side-navigation__label",d.label,{[d.hasBadge]:e.badge!==void 0&&e.badge.count>0}),children:[e.label,e.badge!==void 0&&e.badge.count>0&&a.jsx("div",{className:d.badge,children:a.jsx(l.Badge,{value:e.badge.count,isNegative:e.badge.isNegative})})]})]}),ya=[{label:"Repository profiles",path:t.profiles.repository()},{label:"Package profiles",path:t.profiles.package()},{label:"Upgrade profiles",path:t.profiles.upgrade()},{label:"Reboot profiles",path:t.profiles.reboot()},{label:"Removal profiles",path:t.profiles.removal()},{label:"WSL profiles",path:t.profiles.wsl(),requiresFeature:"wsl-child-instance-profiles"},{label:"Security profiles",path:t.profiles.security(),requiresFeature:"usg-profiles"}],ka=[{label:"Mirrors",path:t.repositories.mirrors(),env:"selfHosted"},{label:"GPG Keys",path:t.repositories.gpgKeys()},{label:"APT Sources",path:t.repositories.aptSources()}],wa=[{label:"General",path:t.settings.general()},{label:"Administrators",path:t.settings.administrators()},{label:"Employees",path:t.settings.employees(),requiresFeature:"employee-management"},{label:"Roles",path:t.settings.roles()},{label:"Access groups",path:t.settings.accessGroups()},{label:"Identity providers",path:t.settings.identityProviders(),requiresFeature:"oidc-configuration"}],$=[{label:"Overview",path:t.overview.root(),icon:"switcher-dashboard"},{label:"Instances",path:t.instances.root(),icon:"machines"},{label:"Activities",path:t.activities.root(),icon:"switcher-environments"},{label:"Scripts",path:t.scripts.root(),icon:"code"},{label:"Events log",path:t.eventsLog.root(),icon:"status"},{label:"Profiles",path:t.profiles.root(),icon:"cluster",items:ya},{label:"Repositories",path:t.repositories.root(),icon:"fork",items:ka},{label:"Org. settings",path:t.settings.root(),icon:"settings",items:wa},{label:"Documentation",path:t.external.documentation(),hasDivider:!0},{label:"Support",path:t.external.support()}],D=({isSaas:e,isSelfHosted:s,items:i})=>i.filter(({env:o})=>!e&&o!=="saas"||!s&&o!=="selfHosted").map(o=>o.items?{...o,items:D({items:o.items,isSaas:e,isSelfHosted:s})}:o),R=({isFeatureEnabled:e,items:s})=>s.filter(({requiresFeature:i})=>!i||e(i)).map(i=>i.items?{...i,items:R({items:i.items,isFeatureEnabled:e})}:i),Ia=e=>$.filter(({items:s})=>s&&s.length>0).find(({path:s})=>e.startsWith(s))?.path,Sa=({item:e,expanded:s,onClick:i})=>a.jsxs(l.Button,{className:n("p-side-navigation__accordion-button",d.accordionButton),type:"button","aria-expanded":s===e.path,onClick:i,children:[e.icon&&a.jsx("i",{className:n(`p-icon--${e.icon} is-light p-side-navigation__icon`,d.icon)}),a.jsx("span",{className:n("p-side-navigation__label",d.label),children:e.label})]}),Ca=({item:e})=>{const[s,i]=g.useState(""),{pathname:o}=x();return g.useEffect(()=>{const r=Ia(o);r&&i(r)},[o]),a.jsxs(a.Fragment,{children:[a.jsx(Sa,{item:e,expanded:s,onClick:()=>{i(s===e.path?"":e.path)}}),e.items&&e.items.length>0&&a.jsx("ul",{className:"p-side-navigation__list","aria-expanded":s===e.path,children:e.items.map(r=>a.jsx("li",{children:r.path.startsWith("http")?a.jsx(T,{item:r}):a.jsx(O,{item:r,current:o===r.path})},r.path))})]})},Pa=({item:e})=>{const{pathname:s}=x();return a.jsx("li",{className:n("p-side-navigation__item",{[d.hasDivider]:e.hasDivider}),children:e.items&&e.items.length>0?a.jsx(Ca,{item:e}):a.jsx(a.Fragment,{children:e.path.startsWith("http")?a.jsx(T,{item:e}):a.jsx(O,{item:e,current:s===e.path})})},e.path)},Ea=20;function Aa(){const{isSaas:e,isSelfHosted:s}=q(),{isFeatureEnabled:i}=B(),{hasOverLimitSecurityProfiles:o,overLimitSecurityProfilesCount:r}=J({limit:Ea,offset:0},{enabled:i("usg-profiles")});return g.useMemo(()=>{const b=D({isSaas:e,isSelfHosted:s,items:$});return R({isFeatureEnabled:i,items:b}).map(h=>!o||h.label!=="Profiles"?h:{...h,items:h.items?.map(_=>_.label==="Security profiles"?{..._,badge:{count:r,isNegative:!0}}:_)})},[e,s,i,o])}const Ba=()=>{const e=Aa();return a.jsx("div",{className:"p-side-navigation--icons is-dark",children:a.jsx("nav",{"aria-label":"Main",children:a.jsx("ul",{className:"u-no-margin--bottom u-no-margin--left u-no-padding--left",children:e.map(s=>a.jsx(Pa,{item:s},s.path))})})})},U="/assets/logo-white-full-C918wjMe.svg",La="data:image/svg+xml,%3csvg%20width='31'%20height='56'%20viewBox='0%200%2031%2056'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_316_10103)'%3e%3cpath%20d='M30.4262%200.318237H0.000976562V53.7546H30.4262V0.318237Z'%20fill='%23E9500E'/%3e%3cpath%20d='M23.0382%2043.617H13.9041C13.878%2043.617%2013.852%2043.63%2013.839%2043.6431C13.8259%2043.6561%2013.8129%2043.6822%2013.8129%2043.7082L13.8259%2045.1936C13.8259%2045.2458%2013.865%2045.2849%2013.9302%2045.2849H21.3052V46.8354H12.3144V28.1112C12.3144%2028.0591%2012.2753%2028.007%2012.2102%2028.007H7.40209C7.34997%2028.007%207.29785%2028.046%207.29785%2028.1112V48.4121C7.29785%2048.4642%207.33694%2048.5163%207.40209%2048.5163H8.95267C8.97873%2048.5163%209.00479%2048.5033%209.01782%2048.4903C9.03085%2048.4772%209.04388%2048.4512%209.04388%2048.4251V29.6357L10.6336%2029.6227L10.5814%2048.3469C10.5814%2048.373%2010.5945%2048.399%2010.6075%2048.4121C10.6205%2048.4251%2010.6466%2048.4381%2010.6726%2048.4381H23.0382C23.0903%2048.4381%2023.1424%2048.399%2023.1424%2048.3339V43.7082C23.1294%2043.6561%2023.0903%2043.617%2023.0382%2043.617Z'%20fill='white'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_316_10103'%3e%3crect%20width='31'%20height='55'%20fill='white'%20transform='translate(0%200.318115)'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",Ma="_container_1gwom_1",Ta="_link_1gwom_7",Oa="_logoImg_1gwom_11",$a="_logoIcon_1gwom_12",f={container:Ma,link:Ta,logoImg:Oa,logoIcon:$a},Da=1.6,Ra=({closeMenu:e})=>a.jsxs("div",{className:n("p-panel__header is-sticky u-no-padding--left u-no-padding--right",f.container),children:[a.jsxs(m,{to:t.root.root(),className:f.link,children:[a.jsx("img",{className:n("is-fading-when-collapsed",f.logoImg),src:U,alt:S,width:144}),a.jsx("img",{className:f.logoIcon,src:La,alt:S,width:Da*16})]}),a.jsx("div",{className:"u-hide--large",children:a.jsx(l.Button,{type:"button",className:"p-button--base is-dark u-no-margin u-hide--medium",hasIcon:!0,onClick:s=>{e(),s.currentTarget.blur()},"aria-label":"Close navigation",children:a.jsx(l.Icon,{name:"close-sidebar",className:"is-light"})})})]}),Ua=({toggleMenu:e})=>a.jsxs("div",{className:"p-panel__header",children:[a.jsx(m,{to:t.root.root(),children:a.jsx("img",{className:"p-panel__logo-name is-fading-when-collapsed",src:U,alt:S,width:144})}),a.jsx("div",{className:"p-panel__controls u-no-padding--top",children:a.jsx(l.Button,{type:"button",className:"p-panel__toggle",dense:!0,onClick:e,children:"Menu"})})]}),Ha="_container_1jiu5_1",qa="_navigation_1jiu5_10",Fa="_footer_1jiu5_15",I={container:Ha,navigation:qa,footer:Fa},Ga="_container_1i1cl_1",Va="_label_1i1cl_8",Wa="_link_1i1cl_12",Qa="_icon_1i1cl_24",Ka="_button_1i1cl_29",za="_accordionButton_1i1cl_35",Ya="_versionInfo_1i1cl_59",c={container:Ga,label:Va,link:Wa,icon:Qa,button:Ka,accordionButton:za,versionInfo:Ya},Za=()=>{const{user:e,logout:s}=B(),{pathname:i}=x(),o=L("(max-width: 619px)"),{handleLogoutQuery:r}=P(),b=M(),[j,h]=g.useState(!1),{mutateAsync:_}=r,y=async()=>{try{await _(),s()}catch(p){b(p)}};return a.jsxs("div",{className:n("p-side-navigation--icons is-dark",c.container),children:[a.jsxs("ul",{className:"u-no-margin--bottom u-no-margin--left u-no-padding--left",children:[a.jsxs("li",{className:"p-side-navigation__item",children:[o&&a.jsxs(a.Fragment,{children:[a.jsxs(l.Button,{className:n("p-side-navigation__accordion-button",c.accordionButton),type:"button","aria-expanded":j,onClick:()=>{h(p=>!p)},children:[a.jsx(l.Icon,{name:"account",className:n("is-light p-side-navigation__icon",c.icon)}),a.jsx("span",{className:n("p-side-navigation__label",c.label),children:e?.name??"Unknown user"})]}),a.jsx("ul",{className:"p-side-navigation__list","aria-expanded":j,children:C.items?.map(p=>a.jsx("li",{children:a.jsx(m,{className:n("p-side-navigation__link",c.link),to:p.path,"aria-current":i===p.path?"page":void 0,children:a.jsx("span",{className:n("p-side-navigation__label",c.label),children:p.label})})},p.path))})]}),!o&&a.jsxs(m,{to:t.account.general(),className:n("p-side-navigation__link",c.accordionButton),"aria-expanded":!1,"aria-current":i.includes(t.account.root())?"page":void 0,children:[a.jsx(l.Icon,{name:"account",className:n("is-light p-side-navigation__icon",c.icon)}),a.jsx("span",{className:n("p-side-navigation__label",c.label),children:e?.name??"Unknown user"})]})]}),a.jsx("li",{className:"p-side-navigation__item",children:a.jsxs(m,{className:n("p-side-navigation__link",c.link),to:t.alerts.root(),"aria-current":i===t.alerts.root()?"page":void 0,children:[a.jsx(l.Icon,{name:"bell",className:n("is-light p-side-navigation__icon",c.icon)}),a.jsx("span",{className:n("p-side-navigation__label",c.label),children:"Alerts"})]})}),a.jsx("li",{className:"p-side-navigation__item",children:a.jsxs(l.Button,{type:"button",appearance:"base",className:n("u-no-margin--bottom",c.link,c.button),onClick:y,children:[a.jsx(l.Icon,{name:"logout",className:n("is-light p-side-navigation__icon",c.icon)}),a.jsx("span",{className:n("p-side-navigation__label",c.label),children:"Sign out"})]})})]}),a.jsxs("span",{className:c.versionInfo,children:["v",F," (",G.slice(0,7),")"]})]})},Xa="_organisation_1bu4l_1",Ja="_container_1bu4l_5",ae="_marginBottom_1bu4l_17",N={organisation:Xa,container:Ja,marginBottom:ae},ee=()=>{const{isOnSubdomain:e,options:s,handleAccountSwitch:i,currentAccount:o}=ea(),r=M(),{closeSidePanel:b}=V(),{switchAccountQuery:j}=P();if(e||s.length===1)return a.jsx("div",{className:n(N.container,N.marginBottom),children:a.jsx(aa,{label:"Organization",value:o.title,className:N.organisation})});const{mutateAsync:h}=j,_=async y=>{const p=y.target.value;try{const{data:k}=await h({account_name:p});i(k.token,p),b()}catch(k){r(k)}};return a.jsx("div",{className:N.container,children:a.jsx(l.Select,{label:"Organization",labelClassName:n(N.organisation,"p-text--small p-text--small-caps u-no-margin--bottom"),options:s,value:o.name,onChange:_})})},se="_container_dmvyl_7",ne="_listItem_dmvyl_14",te="_title_dmvyl_24",ie="_feedbackLink_dmvyl_29",v={container:se,listItem:ne,title:te,feedbackLink:ie},oe="This portal is still a work-in-progress. Some features may not be available yet and you may encounter some bugs. You can switch back to the classic portal at any time and share your feedback with us on Discourse.",le=()=>{const{getClassicDashboardUrlQuery:e}=P(),{data:s,refetch:i}=e({},{enabled:!1});return g.useEffect(()=>{s&&W(s.data.url)},[s]),a.jsx("div",{className:n("is-fading-when-collapsed",v.container),children:a.jsxs("ul",{className:"p-list p-list--divided u-no-margin--bottom",children:[a.jsxs("li",{className:n("p-list__item",v.listItem),children:[a.jsx("span",{className:v.title,children:"New web portal"}),a.jsx(l.Tooltip,{position:"right",message:oe,children:a.jsx(l.Icon,{name:l.ICONS.help})})]}),a.jsx("li",{className:n("p-list__item",v.listItem),children:a.jsx("a",{href:E,target:"_blank",rel:"noreferrer noopener nofollow",className:v.feedbackLink,children:"Share your feedback"})}),a.jsx("li",{className:n("p-list__item",v.listItem),children:a.jsx(l.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:i,children:a.jsx("span",{children:"Switch to classic dashboard"})})})]})})},re=()=>{const[e,s]=g.useState(!0);return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"l-navigation-bar",children:a.jsx("div",{className:"p-panel is-dark",children:a.jsx(Ua,{toggleMenu:()=>{s(i=>!i)}})})}),a.jsx("header",{className:n("l-navigation",{"is-collapsed":e}),children:a.jsx("div",{className:"l-navigation__drawer",children:a.jsx("div",{className:"p-panel is-dark",children:a.jsxs("div",{className:I.container,children:[a.jsx(Ra,{closeMenu:()=>{s(!0)}}),a.jsxs("div",{className:I.navigation,children:[a.jsx(ee,{}),a.jsx(Ba,{})]}),a.jsxs("div",{className:I.footer,children:[a.jsx(le,{}),a.jsx(Za,{})]})]})})})})]})},ce=({children:e})=>{const{pathname:s}=x(),i=A("/account/*",s),o=L("(min-width: 620px)"),r=g.useId();return a.jsxs("div",{id:r,className:"l-application",role:"presentation",children:[a.jsxs(Q,{children:[a.jsx(re,{}),a.jsx(X,{value:r,children:a.jsxs("main",{className:n("l-main",w.wrapper),children:[i&&o&&a.jsx("div",{className:n("l-navigation__drawer",w.secondaryNavigation),children:a.jsx(ua,{})}),a.jsx("div",{className:w.pageContent,children:e})]})})]}),a.jsx(na,{})]})},Oe=()=>{const e=K(),{pathname:s}=x();return g.useEffect(()=>{t.root.root()===s&&e(z,{replace:!0})},[s]),a.jsx(ce,{children:a.jsx(g.Suspense,{fallback:a.jsx(Z,{}),children:a.jsx(Y,{})})})};export{Oe as default};
