import{e as G,j as t,l as H,h as s,B as u}from"./index-u_EhbhC_.js";import{h as p}from"./moment-C5S46NFB.js";import{I as a}from"./InfoItem-DfMbt4qK.js";import{u as J,a as j}from"./index-Dehqy0t2.js";import{u as K}from"./useConfirm-B8tJ1H3c.js";import{u as W}from"./useInstances-iAR4_yRz.js";import"./moment-BMNhdv00.js";import"./TablePagination-B-hCaI46.js";import"./TablePagination.module-CgQ3jx4B.js";import"./usePageParams-TkE3cuN_.js";import"./EmptyState-BqInhbHc.js";import"./SearchHelpPopup-DV4iUDnA.js";import"./PageMain-CmLgxdJK.js";import"./useMutation-CrcSbzv3.js";import"./useFetchOld-BBfSXCp-.js";import"./NoData-BfY2RoAl.js";const X="_statusIcon_1efxa_1",Z="_output_1efxa_5",C={statusIcon:X,output:Z},tt=({activityId:f})=>{var v,A,b,h,x,g,_;const n=G(),{confirmModal:c,closeConfirmModal:l}=K(),{approveActivitiesQuery:I,cancelActivitiesQuery:D,getSingleActivityQuery:k,redoActivitiesQuery:w,undoActivitiesQuery:B}=J(),{getInstancesQuery:N}=W(),{mutateAsync:L,isPending:R}=I,{mutateAsync:T,isPending:$}=D,{mutateAsync:z,isPending:Q}=w,{mutateAsync:S,isPending:U}=B,{data:r,isLoading:m}=k({activityId:f}),e=r==null?void 0:r.data,{data:d}=N({query:`id:${e==null?void 0:e.computer_id}`,root_only:!1},{enabled:!!(e!=null&&e.computer_id)}),y=d&&d.data.results.length>0?d.data.results[0].title:"",E=async i=>{try{await L({query:`id:${i.id}`})}catch(o){n(o)}finally{l()}},P=i=>{c({title:"Approve activity",body:`Are you sure you want to approve ${i.summary} activity?`,buttons:[t.jsx(s.Button,{appearance:"positive",onClick:()=>E(i),children:"Approve"},"approve")]})},F=async i=>{try{await T({query:`id:${i.id}`})}catch(o){n(o)}finally{l()}},M=i=>{c({title:"Cancel activity",body:`Are you sure you want to cancel ${i.summary} activity?`,buttons:[t.jsx(s.Button,{appearance:"positive",onClick:()=>F(i),children:"Apply"},"cancel")]})},q=async i=>{try{await z({activity_ids:[i.id]})}catch(o){n(o)}finally{l()}},O=i=>{c({title:"Redo activity",body:`Are you sure you want to redo ${i.summary} activity?`,buttons:[t.jsx(s.Button,{appearance:"positive",onClick:()=>q(i),children:"Redo"},"redo")]})},Y=async i=>{try{await S({activity_ids:[i.id]})}catch(o){n(o)}finally{l()}},V=i=>{c({title:"Undo activity",body:`Are you sure you want to undo ${i.summary} activity?`,buttons:[t.jsx(s.Button,{appearance:"positive",onClick:()=>Y(i),children:"Undo"},"undo")]})};return t.jsxs(t.Fragment,{children:[m&&t.jsx(H,{}),!m&&e&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"p-segmented-control",children:t.jsxs("div",{className:"p-segmented-control__list",children:[((v=e.actions)==null?void 0:v.approvable)&&t.jsx(s.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>P(e),disabled:R,children:"Approve"}),((A=e.actions)==null?void 0:A.cancelable)&&t.jsx(s.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>M(e),disabled:$,children:!((b=e.actions)!=null&&b.approvable)&&!((h=e.actions)!=null&&h.reappliable)&&!((x=e.actions)!=null&&x.revertable)?"Cancel activity":"Cancel"}),((g=e.actions)==null?void 0:g.revertable)&&t.jsx(s.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>V(e),disabled:U,children:"Undo"}),((_=e.actions)==null?void 0:_.reappliable)&&t.jsx(s.Button,{className:"p-segmented-control__button",type:"button",onClick:()=>O(e),disabled:Q,children:"Redo"})]})},"buttons"),t.jsxs(s.Row,{className:"u-no-padding--left u-no-padding--right",children:[t.jsx(s.Col,{size:12,children:t.jsx(a,{label:"Description",value:e.summary})}),y&&t.jsx(s.Col,{size:12,children:t.jsx(a,{label:"Instance",value:y})}),t.jsx(s.Col,{size:6,children:t.jsx(a,{label:"Status",value:t.jsxs(t.Fragment,{children:[t.jsx(s.Icon,{name:j[e.activity_status].icon,className:C.statusIcon}),t.jsx("span",{children:j[e.activity_status].label})]})})}),t.jsx(s.Col,{size:6,children:t.jsx(a,{label:"Created at",value:p(e.creation_time).format(u)})}),typeof e.delivery_time=="string"&&t.jsx(s.Col,{size:6,children:t.jsx(a,{label:"Delivered at",value:p(e.delivery_time).format(u)})}),e.completion_time&&t.jsx(s.Col,{size:6,children:t.jsx(a,{label:"Completed at",value:p(e.completion_time).format(u)})}),e.result_text&&t.jsx(s.Col,{size:12,children:t.jsx(a,{label:"Output",type:"snippet",value:e.result_text,className:C.output})})]})]})]})},bt=tt;export{bt as default};
