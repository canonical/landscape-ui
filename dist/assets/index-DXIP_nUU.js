const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BewyFm9t.js","assets/index-DYykpNVa.js","assets/index-hef1aQzf.css","assets/useGetOverLimitSecurityProfiles-DhgD9daD.js","assets/SidePanelFormButtons-Aj5ThB2m.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/SidePanel-DVyPWXM9.js","assets/SidePanel-5ugWznou.css","assets/helpers-DblkVUdf.js","assets/AssociationBlock-Bs5is6Zl.js","assets/MultiSelectField-85mhFA5_.js","assets/MultiSelectField-GyNA33om.css","assets/useGetTags-BbkSXw8M.js","assets/AssociationBlock-vsPH8fvb.css","assets/useGetInstances-CQaSwVqm.js","assets/InstancesPageActions-nbDXpXLr.js","assets/index-C2TKYmcI.js","assets/NoData-CT6SeJUX.js","assets/ResponsiveTable-C-8YbfBJ.js","assets/ResponsiveTable-Czda4kFo.css","assets/TablePagination-CIA4CRba.js","assets/TableFilterChips-DLH4XQ-H.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-DZURD2KR.css","assets/useFetchOld-BGD2hIpr.js","assets/PageParamFilter-LH49uHXA.js","assets/TableFilter-C7yTBfOe.js","assets/TableFilter-B85Stwni.css","assets/formikErrors-Bw8iTXYS.js","assets/index-DzMlcK9Q.css","assets/ListTitle-anvzyHx6.js","assets/ListTitle-CxCHkD9o.css","assets/StaticLink-BX9qJBBO.js","assets/TruncatedCell-DQQZxgbr.js","assets/Truncated-DtD6hAHP.js","assets/Truncated-uqJp6ujM.css","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-CGDZ27WS.js","assets/index-Cbj0Sz5k.js","assets/TextConfirmationModal-DuGXYB1S.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/InfoGrid-CVtcW3Y8.js","assets/InfoItem-DMBAN7ig.js","assets/InfoItem-D8nPzgUA.css","assets/InfoGrid-D3QqOHFx.css","assets/InstancesPageActions-ChZMRYY_.css","assets/FileInput-B1IY8xqt.js","assets/useOrgSettings-BfuduGZV.js","assets/constants-Dy8_1E-v.js","assets/useRoles-CK1OAvut.js","assets/RadioGroup-DD61dFf3.js","assets/RadioGroup-WBbAFTwm.css","assets/RandomizationBlock-DjoHppMG.js","assets/Blocks-C-bFP-tp.js","assets/Blocks-bdK2PNd9.css","assets/ProfileAssociatedInstancesLink-CRAimTVK.js","assets/ProfileAssociationInfo-3j9RTKgZ.js","assets/PageMain-BnPck7ZK.js","assets/PageMain-30196XJe.css","assets/HeaderWithSearch-DH3OfcZg.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/constants-CXofZZ4i.js","assets/constants-C7fhH3UY.js","assets/table-CdFwMAPu.js","assets/useGetActivities-BUXsLbmh.js","assets/index-TXEmn2K-.css"])))=>i.map(i=>d[i]);
import{f as L,v as G,w as D,c as ae,j as e,d as c,o as v,N as F,ag as E,B as K,z as J,r as p,s as S,C as ne,p as re,l as k,P as X,g as oe,ab as le,R as C,L as B,aq as ce,H as q,e as Z,E as de,$ as b}from"./index-DYykpNVa.js";import{P as ue,a as me,b as pe}from"./PageMain-BnPck7ZK.js";import{S as P}from"./SidePanel-DVyPWXM9.js";import{A as V,S as j,a as he,u as ee,b as fe}from"./useGetOverLimitSecurityProfiles-DhgD9daD.js";import"./helpers-DblkVUdf.js";import"./InstancesPageActions-nbDXpXLr.js";import"./index-Cbj0Sz5k.js";import"./InfoGrid-CVtcW3Y8.js";import"./constants-Dy8_1E-v.js";import"./Blocks-C-bFP-tp.js";import"./index-C2TKYmcI.js";import{a as ge,u as ye}from"./TableFilterChips-DLH4XQ-H.js";import{a as xe}from"./TablePagination-CIA4CRba.js";import{P as _e}from"./PageParamFilter-LH49uHXA.js";import{T as Pe,t as U}from"./TableFilter-C7yTBfOe.js";import{g as H}from"./formikErrors-Bw8iTXYS.js";import{H as Se}from"./HeaderWithSearch-DH3OfcZg.js";import{P as ve}from"./ProfileAssociatedInstancesLink-CRAimTVK.js";import{L as be}from"./constants-CXofZZ4i.js";import{L as je}from"./constants-C7fhH3UY.js";import{L as Ie}from"./ListTitle-anvzyHx6.js";import{N as I}from"./NoData-CT6SeJUX.js";import{R as Ne}from"./ResponsiveTable-C-8YbfBJ.js";import{T as Te}from"./TextConfirmationModal-DuGXYB1S.js";import{c as Ae}from"./table-CdFwMAPu.js";import{u as Re}from"./useGetActivities-BUXsLbmh.js";const Le=()=>{const t=L(),s=G(),{isPending:n,mutateAsync:i}=D({mutationFn:async({id:r})=>t.post(`security-profiles/${r}:archive`),onSuccess:async()=>s.invalidateQueries({queryKey:["securityProfiles"]})});return{isArchivingSecurityProfile:n,archiveSecurityProfile:i}},we=()=>{const t=L(),{isPending:s,mutateAsync:n}=D({mutationFn:async({path:i})=>t.get(`security-profiles/blob?path=${i}`)});return{getSecurityProfileAuditDownload:n,isSecurityProfileAuditDownloadLoading:s}},O=()=>{const t=L(),{data:s}=ae({queryKey:["securityProfiles","check-limit"],queryFn:async()=>t.get("security-profiles",{params:{status:"active",offset:0,limit:V+1}})});return Number(s?.data.count)>=V},Ee=()=>{const t=L(),s=G(),{isPending:n,mutateAsync:i}=D({mutationFn:async({id:r})=>t.post(`security-profiles/${r}:execute`),onSuccess:async()=>s.invalidateQueries({queryKey:["securityProfiles"]})});return{isRunningSecurityProfile:n,runSecurityProfile:i}},Fe=t=>{switch(t%100){case 11:case 12:case 13:return"th"}switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},te=t=>`${t}${Fe(t)}`,es=t=>{const s=t.getDate();return[{label:`${te(s)} of every month`,value:"day-of-month"},{label:`${["First","Second","Third","Fourth","Last"][Math.ceil(s/7)-1]} ${new Intl.DateTimeFormat("en-US",{weekday:"long"}).format(t)} of every month`,value:"day-of-week"}]},Ce="_truncated_qn45o_1",$e="_container_qn45o_8",De="_statusWithIcon_qn45o_13",Oe="_tooltipIcon_qn45o_19",R={truncated:Ce,container:$e,statusWithIcon:De,tooltipIcon:Oe},$=(t=[])=>`${t.slice(0,-1).join(", ")}${t.length>2?",":""}${t.length>1?" and ":""}${t.slice(-1)}`,ts=(t,s)=>{const n=["perform an initial run"];t.mode!="audit"&&n.push("apply remediation fixes on associated instances"),t.mode=="audit-fix-restart"&&n.push("restart them"),n.push("generate an audit"),s.success({title:`You have successfully created ${t.title} security profile.`,message:`This profile will ${$(n)}.`})},Me=t=>t.all_computers?"All instances":t.tags.join(", ")||e.jsx(I,{}),ss=t=>{if(!t.tailoring_file_uri)return e.jsx(I,{});const s=t.tailoring_file_uri.match(/[^/]+$/);return e.jsxs("div",{className:R.container,children:[e.jsx("div",{className:R.truncated,children:s?s[0]:"tailoring-file.xml"}),e.jsx("a",{href:t.tailoring_file_uri,download:!0,children:e.jsx(c.Icon,{name:"begin-downloading"})})]})},W=t=>{const s=Object.fromEntries(t.schedule.split(";").map(r=>r.split("="))),n=-2;if(s.COUNT==1)return"On a date";let i="Recurring, every ";switch(s.INTERVAL>1&&(i+=`${s.INTERVAL} `),i+={DAILY:"day",WEEKLY:"week",MONTHLY:"month",YEARLY:"year"}[s.FREQ],s.INTERVAL>1&&(i+="s"),s.FREQ){case"WEEKLY":{i+=` on ${$(s.BYDAY.split(",").map(r=>({SU:"Sunday",MO:"Monday",TU:"Tuesday",WE:"Wednesday",TH:"Thursday",FR:"Friday",SA:"Saturday"})[r]))}`;break}case"MONTHLY":{if(i+=" on the ",s.BYMONTHDAY){i+=`${te(s.BYMONTHDAY)} day`;break}s.BYDAY&&(i+=`${{1:"first",2:"second",3:"third",4:"fourth","-1":"last"}[s.BYDAY.slice(0,n)]} ${{SU:"Sunday",MO:"Monday",TU:"Tuesday",WE:"Wednesday",TH:"Thursday",FR:"Friday",SA:"Saturday"}[s.BYDAY.slice(n)]}`);break}case"YEARLY":{i+=` in ${$(s.BYMONTH.split(",").toSorted((r,a)=>r-a).map(r=>({1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"Novebmer",12:"December"})[r]))}`;break}}return s.UNTIL&&(i+=` until ${v(s.UNTIL).format(F)}`),i},z=t=>t.status==="archived"?{label:"Archived",icon:"status-queued-small"}:t.associated_instances>j?{label:e.jsxs("div",{className:R.statusWithIcon,children:[e.jsx("span",{children:"Over limit"}),e.jsx(c.Tooltip,{position:"top-center",message:"Only the first 5,000 instances are covered. Instances beyond the limit are not covered.",children:e.jsx("div",{className:R.tooltipIcon,children:e.jsx("i",{className:"p-icon--help"})})})]}),icon:"status-failed-small"}:{label:"Active",icon:"status-succeeded-small"},is=t=>{const s=Object.fromEntries(t.schedule.split(";").map(n=>n.split("=")));return{day_of_month_type:s.FREQ=="MONTHLY"&&s.BYDAY?"day-of-week":"day-of-month",days:s.FREQ=="WEEKLY"&&s.BYDAY?s.BYDAY.split(","):[],delivery_time:t.restart_deliver_delay?"delayed":"asap",end_date:s.UNTIL?v(s.UNTIL).format(E):v().format(E),end_type:s.UNTIL?"on-a-date":"never",every:s.INTERVAL,months:s.FREQ=="YEARLY"&&s.BYMONTH?s.BYMONTH.split(",").map(n=>Number(n)):[],randomize_delivery:!!t.restart_deliver_delay_window,start_date:v(t.next_run_time??t.last_run_results.timestamp).format(E),start_type:s.COUNT==1?"on-a-date":"recurring",tailoring_file:null,unit_of_time:s.FREQ||"DAILY",...t,deliver_delay_window:t.restart_deliver_delay_window}},Ye=t=>{switch(t){case"audit-fix-restart":return"Applying remediation fixes, restarting associated instances, and generating an audit have been queued in Activities.";case"audit":return"Applying remediation fixes, restarting associated instances, and generating an audit have been queued in Activities.";default:return"Applying remediation fixes and generating an audit have been queued in Activities."}},as=t=>t.getDay(),ke=({close:t,opened:s,profile:n})=>{const{notify:i}=K(),r=J(),{archiveSecurityProfile:a,isArchivingSecurityProfile:o}=Le(),d=async()=>{try{await a({id:n.id}),i.success({title:`You have archived "${n.title}" profile`,message:"It will no longer run, but past audit data and profile details will remain accessible for selected duration of the retention period."})}catch(l){r(l)}finally{t()}};return e.jsx(Te,{isOpen:s,title:`Archive "${n.title}" profile`,close:t,confirmButtonLabel:"Archive",confirmationText:`archive ${n.title}`,confirmButtonLoading:o,confirmButtonDisabled:o,onConfirm:d,children:e.jsxs("p",{children:["You are about to archive the ",n.title," profile. Archiving this security profile will prevent it from running. However, it will"," ",e.jsx("strong",{children:"NOT"})," delete past audit data or remove the profile details. You will not be able to reactivate the profile after it has been archived."]})})},Be=()=>{const{getSecurityProfileAuditDownload:t}=we();return async s=>{if(!s)throw new Error;const{data:n}=await t({path:s}),i=new Blob([n],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(i),a=document.createElement("a");a.href=r,a.download=s.slice(s.lastIndexOf("/")+1),document.body.appendChild(a),a.click(),document.body.removeChild(a)}},qe=({checkboxProps:t={label:void 0},children:s,hideModal:n,hideNotification:i,ignore:r,...a})=>{const[o,d]=p.useState(!1),l=h=>{n(),i(h),o&&r(h)},m=()=>{n(),d(!1)},g=()=>{d(h=>!h)};return e.jsxs(c.ConfirmationModal,{...a,onConfirm:l,close:m,children:[e.jsx(e.Fragment,{children:s}),e.jsx(c.CheckboxInput,{checked:o,onChange:g,...t})]})},Ve=({children:t,hide:s,modalProps:n={confirmButtonLabel:void 0},storageKey:i,...r})=>{const[a,o]=p.useState(!1),d=()=>{o(!0)},l=()=>{o(!1)},m=()=>{localStorage.setItem(i,"true")};return e.jsxs(e.Fragment,{children:[localStorage.getItem(i)!="true"&&e.jsx(c.Notification,{...r,onDismiss:d,children:t}),a&&e.jsx(qe,{hideModal:l,hideNotification:s,ignore:m,...n,children:e.jsx("p",{children:t})})]})},Ue="_container_rbi8q_1",He="_buttons_rbi8q_6",We="_inlineInput_rbi8q_13",ze="_input_rbi8q_19",Qe="_percent_rbi8q_23",x={container:Ue,buttons:He,inlineInput:We,input:ze,percent:Qe},Ge=({closeMenu:t})=>{const{setPageParams:s,passRateFrom:n,passRateTo:i}=S(),r=({passRateFrom:d,passRateTo:l})=>{s({passRateFrom:d,passRateTo:l}),t?.()},a=ne({initialValues:{passRateFrom:n,passRateTo:i},enableReinitialize:!0,validationSchema:re().shape({passRateFrom:k().required("This field is required").min(0,"Must not be negative").integer("Enter an integer").max(100,"Must not be greater than 100"),passRateTo:k().required("This field is required").max(100,"Must not be greater than 100").when("passRateFrom",([d],l)=>l.min(d,"Must not be less than minimum pass rate"))}),onSubmit:r}),o=()=>{r({passRateFrom:0,passRateTo:100})};return e.jsxs(c.Form,{onSubmit:a.handleSubmit,noValidate:!0,className:x.container,children:[e.jsxs("div",{className:x.inlineInput,children:[e.jsx(c.Input,{className:x.input,type:"number",label:"From",min:0,max:a.values.passRateTo,...a.getFieldProps("passRateFrom"),error:H(a,"passRateFrom")}),e.jsx("span",{className:x.percent,children:"%"})]}),e.jsxs("div",{className:x.inlineInput,children:[e.jsx(c.Input,{className:x.input,type:"number",label:"To",min:a.values.passRateFrom,max:100,...a.getFieldProps("passRateTo"),error:H(a,"passRateTo")}),e.jsx("span",{className:x.percent,children:"%"})]}),e.jsxs("div",{className:x.buttons,children:[e.jsx(c.Button,{small:!0,type:"button",appearance:"base",className:"u-no-margin--bottom",onClick:o,children:"Reset"}),e.jsx(c.Button,{small:!0,type:"submit",appearance:"positive",className:"u-no-margin--bottom",disabled:!a.isValid,children:"Apply"})]})]})},Ke=()=>{const{passRateFrom:t,passRateTo:s}=S(),n=+(t>0)+ +(s<100);return e.jsx(Pe,{type:"custom",label:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Pass rate"}),e.jsx("span",{className:U.badgeContainer,children:n>0&&e.jsx(c.Badge,{value:n,className:U.badge})})]}),customComponent:Ge})},Q=[{label:"All",value:"all"},{label:"Active",value:""},{label:"Archived",value:"archived"}],Je="_filters_1bctl_1",Xe={filters:Je},Ze=()=>e.jsxs(e.Fragment,{children:[e.jsx(Se,{actions:e.jsxs("div",{className:Xe.filters,children:[e.jsx(_e,{pageParamKey:"status",options:Q,label:"Status"}),e.jsx(Ke,{})]})}),e.jsx(ge,{filtersToDisplay:["status","search","passRateFrom","passRateTo"],statusOptions:Q})]}),et=({profile:t})=>{const s=J(),n=X(),{notify:i}=K(),{setPageParams:r,createPageParamsSetter:a}=S(),o=O(),{runSecurityProfile:d}=Ee(),{value:l,setTrue:m,setFalse:g}=oe(),h=async()=>{try{const{data:_}=await d({id:t.id});r({sidePath:[],profile:""});const y=Ye(t.mode);i.success({title:`You have successfully initiated run of the ${t.title} security profile`,message:y,actions:[{label:"View details",onClick:()=>{n(C.activities.root({query:`parent-id:${_.id}`}))}}]})}catch(_){s(_)}},f=[{icon:"show",label:"View details","aria-label":`View "${t.title}" security profile details`,onClick:a({sidePath:["view"],profile:t.id.toString()})},{icon:"file-blank",label:"Download audit","aria-label":`Download "${t.title}" security profile audit`,onClick:a({sidePath:["download"],profile:t.id.toString()})}];t.status!=="archived"&&f.push({icon:"edit",label:"Edit","aria-label":`Edit "${t.title}" security profile`,onClick:a({sidePath:["edit"],profile:t.id.toString()})},{icon:"play",label:"Run","aria-label":`Run "${t.title}" security profile`,onClick:async()=>{if(!t.mode.includes("fix")){await h();return}r({sidePath:["run"],profile:t.id.toString()})},disabled:!t.associated_instances}),f.push({icon:"canvas",label:"Duplicate profile","aria-label":`Duplicate "${t.title}" security profile`,onClick:a({sidePath:["duplicate"],profile:t.id.toString()}),disabled:o});const N=t.status!=="archived"?[{icon:"archive",label:"Archive","aria-label":`Archive "${t.title}" security profile`,onClick:m}]:void 0;return e.jsxs(e.Fragment,{children:[e.jsx(le,{toggleAriaLabel:`${t.title} profile actions`,actions:f,destructiveActions:N}),e.jsx(ke,{close:g,opened:l,profile:t})]})},tt="_header_1dxxh_1",st="_textContainer_1dxxh_6",it="_lineContainer_1dxxh_14",at="_linePassed_1dxxh_24",nt="_lineFailed_1dxxh_25",rt="_lineInProgress_1dxxh_26",ot="_lineNotRun_1dxxh_27",lt="_tooltip_1dxxh_60",ct="_truncated_1dxxh_64",dt="_status_1dxxh_77",ut="_associatedInstances_1dxxh_81",mt="_mode_1dxxh_85",pt="_ellipsis_1dxxh_89",u={header:tt,textContainer:st,lineContainer:it,linePassed:at,lineFailed:nt,lineInProgress:rt,lineNotRun:ot,tooltip:lt,truncated:ct,status:dt,associatedInstances:ut,mode:mt,ellipsis:pt},{getCellProps:ht,getRowProps:ft}=Ae({itemTypeName:"security profile",headerColumnId:"title"}),gt=e.jsxs("div",{className:u.header,children:["Associated instances",e.jsx("span",{className:"u-text--muted",children:"Tags"})]}),yt=e.jsxs("div",{className:u.header,children:["Last run",e.jsx("span",{className:"u-text--muted",children:"Schedule"})]}),xt=({securityProfiles:t})=>{const{createPageParamsSetter:s}=S(),n=p.useMemo(()=>[{...je,meta:{ariaLabel:({original:i})=>`${i.title} profile title and name`},Cell:({row:{original:i}})=>e.jsxs(Ie,{children:[e.jsx(c.Button,{appearance:"link",type:"button",className:"u-no-margin--bottom u-no-padding--top u-align--left",onClick:s({sidePath:["view"],profile:i.id.toString()}),children:i.title}),e.jsx("span",{className:"u-text--muted",children:i.name})]})},{accessor:"status",Header:"Status",meta:{ariaLabel:({original:i})=>`${i.title} profile status`},className:u.status,Cell:({row:{original:i}})=>z(i).label,getCellIcon:({row:{original:i}})=>z(i).icon},{accessor:"lastAuditPassrate",Header:"Last audit's pass rate",meta:{ariaLabel:({original:i})=>`${i.title} last audit pass rate`},Cell:({row:i})=>{const{passing:r,failing:a,in_progress:o,not_started:d}=i.original.last_run_results,l=r+a+o+d;if(!l)return e.jsx(I,{});const m=(r/l*100).toFixed(0),g=(a/l*100).toFixed(0),h=(o/l*100).toFixed(0),f=(d/l*100).toFixed(0),_=100-(parseInt(m)+parseInt(g)+parseInt(h)+parseInt(f)),y=(parseInt(m)+_).toString(),T=e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Passed:"})," ",`${r} instances (${y}%)`]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Failed:"})," ",`${a} instances (${g}%)`]}),e.jsxs("div",{children:[e.jsx("strong",{children:"In progress:"})," ",`${o} instances (${h}%)`]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Not Run:"})," ",`${d} instances (${f}%)`]})]})});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:u.textContainer,children:[e.jsx("div",{children:r>0?e.jsx(B,{to:C.instances.root({query:`security-profile:${i.original.id}:pass`}),children:e.jsxs("span",{children:[r," passed"]})}):e.jsxs("span",{children:[r," passed"]})}),a>0?e.jsx(B,{to:C.instances.root({query:`security-profile:${i.original.id}:fail`}),children:e.jsxs("span",{children:[a," failed"]})}):e.jsxs("span",{children:[a," failed"]})]}),e.jsx(c.Tooltip,{position:"btm-center",positionElementClassName:u.tooltip,message:T,children:e.jsxs("div",{className:u.lineContainer,children:[r>0&&e.jsx("div",{className:u.linePassed,style:{width:`${r/l*100}%`}}),a>0&&e.jsx("div",{className:u.lineFailed,style:{width:`${a/l*100}%`}}),o>0&&e.jsx("div",{className:u.lineInProgress,style:{width:`${o/l*100}%`}}),d>0&&e.jsx("div",{className:u.lineNotRun,style:{width:`${d/l*100}%`}})]})})]})}},{accessor:"associatedInstances",Header:gt,className:u.associatedInstances,meta:{ariaLabel:({original:i})=>`${i.title} associated instances and tags`},Cell:({row:{original:i}})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:u.ellipsis,children:[e.jsx(ve,{count:i.associated_instances,profile:i,query:`security:${i.id}`}),e.jsx("br",{}),e.jsx("span",{"aria-label":`${i.title} profile tags`,children:Me(i)})]})})},{accessor:"mode",Header:"Mode",meta:{ariaLabel:({original:i})=>`${i.title} profile mode`},className:u.mode,Cell:({row:{original:{mode:i}}})=>he[i]},{accessor:"schedule",Header:yt,meta:{ariaLabel:"Last run and schedule"},className:"date-cell",Cell:({row:i})=>{const r=i.original.last_run_results.timestamp?v(i.original.last_run_results.timestamp).format(F):e.jsx(I,{}),a=i.original.next_run_time?v(i.original.next_run_time).format(F):e.jsx(I,{}),o=e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Last run:"})," ",r,r?"":" GMT"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Next run:"})," ",a,a?"":" GMT"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Schedule:"})," ",W(i.original)]})]});return e.jsx(c.Tooltip,{position:"top-center",positionElementClassName:u.tooltip,message:o,children:e.jsxs("div",{className:u.truncated,children:[e.jsx("span",{className:"font-monospace","aria-label":`Last run for ${i.original.title} profile`,children:r}),e.jsx("br",{}),e.jsx("span",{className:u.ellipsis,"aria-label":`Schedule for ${i.original.title} profile`,children:W(i.original)})]})})}},{...be,Cell:({row:{original:i}})=>e.jsx(et,{profile:i})}],[s]);return e.jsx(Ne,{emptyMsg:"No security profiles found according to your search parameters.",columns:n,data:t,minWidth:1200,getCellProps:ht(),getRowProps:ft()})},_t=t=>{if(t!=="all")return t||"active"},Pt=({hideRetentionNotification:t,retentionNotificationVisible:s})=>{const n=ce(),i=X(),{currentPage:r,pageSize:a,search:o,status:d,passRateFrom:l,passRateTo:m}=S(),{createPageParamsSetter:g}=S(),h=O(),{securityProfiles:f,securityProfilesCount:N,isSecurityProfilesLoading:_}=ee({search:o,status:_t(d),limit:a,offset:(r-1)*a,pass_rate_from:l!=0?l:void 0,pass_rate_to:m!=100?m:void 0}),{overLimitSecurityProfiles:y}=fe({limit:20,offset:0}),[T,M]=p.useState(JSON.parse(localStorage.getItem("_landscape_pendingSecurityProfileReports")??"[]")),{activities:A}=Re({query:`status:succeeded ${T.map(w=>`id:${w.activityId}`).join(" OR ")}`},{listenToUrlParams:!1},{enabled:!!T.length}),Y=Be(),[se,ie]=p.useState(localStorage.getItem("_landscape_isSecurityProfileLimitNotificationIgnored")=="true");return e.jsxs(e.Fragment,{children:[s&&e.jsx(Ve,{inline:!0,title:"Audit retention policy:",storageKey:"_landscape_isAuditModalIgnored",hide:t,modalProps:{title:"Dismiss audit retention acknowledgment",confirmButtonAppearance:"positive",confirmButtonLabel:"Dismiss",checkboxProps:{label:"I understand and acknowledge this policy. Don't show this message again."}},children:e.jsx(e.Fragment,{children:"Any audit older than the specified retention period for a given profile will be automatically removed. We recommend downloading and storing audit data externally before it expires. You can view the exact retention period for each profile in its details."})}),y.length>1&&e.jsxs(c.Notification,{severity:"negative",inline:!0,title:"Profiles exceeded associated instance limit:",children:["Some of your security profiles are assigned to more than"," ",e.jsxs("strong",{children:[j.toLocaleString()," ","instances"]}),". Only the first"," ",j.toLocaleString()," will be audited. Edit the profiles or duplicate them to cover the rest."," ",e.jsx(c.Button,{type:"button",appearance:"link",onClick:()=>{i({pathname:n.pathname,search:"?status=over-limit"})},children:"View profiles"})]}),q(y)&&e.jsxs(c.Notification,{severity:"negative",inline:!0,title:"Profile exceeded associated instance limit:",children:["Your security profile"," ",e.jsx("strong",{children:y[0].title})," is assigned to more than"," ",e.jsxs("strong",{children:[j.toLocaleString()," ","instances"]}),". Only the first"," ",j.toLocaleString()," will be covered. Edit the profile or duplicate it to cover the rest."," ",e.jsx(c.Button,{type:"button",appearance:"link",onClick:g({sidePath:["edit"],profile:y[0].id.toString()}),children:"Edit profile"})]}),h&&!se&&e.jsxs(c.Notification,{severity:"caution",inline:!0,title:"Security profiles limit reached:",onDismiss:()=>{localStorage.setItem("_landscape_isSecurityProfileLimitNotificationIgnored","true"),ie(!0)},children:["You've reached the maximum of"," ",e.jsx("strong",{children:"5 security profiles"}),". To add more, archive profiles that are no longer in use to free up space for active ones."]}),A.length>1&&e.jsxs(c.Notification,{inline:!0,title:"Your audits are ready for download:",onDismiss:()=>{localStorage.removeItem("_landscape_pendingSecurityProfileReports"),M([])},children:["Several of your audits have been successfully generated and are now ready for download."," ",e.jsx(c.Button,{appearance:"link",type:"button",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{for(const w of A)Y(w.result_text)},children:"Download audits"})]}),q(A)&&e.jsxs(c.Notification,{inline:!0,title:"Your audit is ready for download:",onDismiss:()=>{localStorage.removeItem("_landscape_pendingSecurityProfileReports"),M([])},children:["Your audit has been successfully generated and is now ready for download."," ",e.jsx(c.Button,{appearance:"link",type:"button",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{Y(A[0].result_text)},children:"Download audit"})]}),e.jsx(Ze,{}),_?e.jsx(Z,{}):e.jsxs(e.Fragment,{children:[e.jsx(xt,{securityProfiles:f}),e.jsx(xe,{totalItems:N,currentItemCount:f.length})]})]})},St=p.lazy(()=>b(()=>import("./index-BewyFm9t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66])).then(t=>({default:t.SecurityProfileAddSidePanel}))),vt=p.lazy(()=>b(()=>import("./index-BewyFm9t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66])).then(t=>({default:t.SecurityProfileDownloadAuditSidePanel}))),bt=p.lazy(()=>b(()=>import("./index-BewyFm9t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66])).then(t=>({default:t.SecurityProfileDuplicateSidePanel}))),jt=p.lazy(()=>b(()=>import("./index-BewyFm9t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66])).then(t=>({default:t.SecurityProfileEditSidePanel}))),It=p.lazy(()=>b(()=>import("./index-BewyFm9t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66])).then(t=>({default:t.SecurityProfileRunFixSidePanel}))),Nt=p.lazy(()=>b(()=>import("./index-BewyFm9t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66])).then(t=>({default:t.SecurityProfileDetailsSidePanel}))),Tt=()=>{const{sidePath:t,lastSidePathSegment:s,createPageParamsSetter:n}=S(),[i,r]=p.useState(!1),{securityProfilesCount:a,isSecurityProfilesLoading:o}=ee({offset:0,limit:0}),d=O();ye("sidePath",["add","download","duplicate","edit","run","view"]);const l=()=>{r(!0)},m=n({sidePath:["add"],profile:""});return e.jsxs(ue,{children:[e.jsx(me,{title:"Security profiles",actions:a?[e.jsx(c.Button,{type:"button",appearance:"positive",onClick:m,disabled:d,children:"Add security profile"},"add-security-profile-button")]:void 0}),e.jsxs(pe,{hasTable:!0,children:[o&&e.jsx(Z,{}),!o&&a===0&&e.jsx(de,{body:e.jsx("p",{children:"Add a security profile to ensure security and complaince across your instances. Security profile audits aggregate audit results over time and in bulk, helping you align with tailored security benchmarks, run scheduled audits, and generate detailed audits for your estate."}),cta:[e.jsx(c.Button,{type:"button",appearance:"positive",onClick:m,disabled:d,children:"Add security profile"},"add-security-profile-button")],title:"You don't have any security profiles yet"}),!o&&!!a&&e.jsx(Pt,{hideRetentionNotification:()=>{r(!1)},retentionNotificationVisible:i})]}),e.jsxs(P,{onClose:n({sidePath:[],profile:""}),isOpen:!!t.length,size:s==="view"?"medium":void 0,children:[s==="add"&&e.jsx(P.Suspense,{children:e.jsx(St,{onSuccess:l})},"add"),s==="download"&&e.jsx(P.Suspense,{children:e.jsx(vt,{})},"download"),s==="duplicate"&&e.jsx(P.Suspense,{children:e.jsx(bt,{})},"duplicate"),s==="edit"&&e.jsx(P.Suspense,{children:e.jsx(jt,{})},"edit"),s==="run"&&e.jsx(P.Suspense,{children:e.jsx(It,{})},"run"),s==="view"&&e.jsx(P.Suspense,{children:e.jsx(Nt,{})},"view")]})]})},ns=Object.freeze(Object.defineProperty({__proto__:null,default:Tt},Symbol.toStringTag,{value:"Module"}));export{ke as S,as as a,z as b,ss as c,W as d,Be as e,is as f,es as g,Ee as h,Ye as i,Pt as j,Ze as k,xt as l,ns as m,ts as n,$ as p,O as u};
