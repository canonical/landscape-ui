import{z as x,G as j,y as A,B as E,H as m,C as k,j as e,d as r}from"./index-Dfc97QGW.js";import{D as B}from"./DeliveryBlock-FX2F7SvQ.js";import{R as I}from"./RandomizationBlock-CEGfJ5_6.js";import"./helpers-BbXQOWxJ.js";import{I as s}from"./InfoGrid-CrJbMYy5.js";import{u as N}from"./index-S_kjB96R.js";import{K as w}from"./constants-CN3ISoM1.js";import{u as R}from"./index-1GLbig6o.js";import{U as O,a as C,N as T}from"./constants-Dwl1JGyb.js";import"./formikErrors-Bw8iTXYS.js";import"./RadioGroup-DkbRD5zc.js";import"./InfoItem-DImpX37B.js";import"./NoData-DMN9LLPq.js";import"./Truncated-D8EZCoK1.js";import"./ResponsiveTable-ViIMTRR6.js";import"./TablePagination-B0v8QAQr.js";import"./TableFilterChips-DXWGZ6VK.js";import"./useFetchOld-BgGVMMmJ.js";import"./PageParamFilter-C5PJgjVf.js";import"./TableFilter-BmLRyeMD.js";import"./PageMain-LS0GxKmV.js";import"./useGetInstance-CjjdVYCe.js";import"./InstancesPageActions-Dns4Yse-.js";import"./ListTitle-DsIgCqjQ.js";import"./StaticLink-BNg3qc2M.js";import"./TruncatedCell-Cf7_euhM.js";import"./useExpandableRow-DYtdXwcw.js";import"./index-DiSNWm9B.js";import"./TextConfirmationModal-O9rtHEfo.js";import"./useUsns-DqfdHX4t.js";import"./constants-BTpoIHxf.js";import"./SingleInstanceTabs.module-DvhuGYYD.js";const ue=({currentKernelVersion:l,upgradeKernelVersions:o,instanceName:c})=>{const p=x(),{instanceId:u}=j(),{closeSidePanel:d}=A(),{notify:f}=E(),{upgradeKernelQuery:_}=R(),{openActivityDetails:b}=N(),{mutateAsync:v,isPending:n}=_,g=[{label:"Select",value:""},...o.map(t=>({label:t.version_rounded,value:t.id.toString()}))],h={deliver_immediately:!0,randomize_delivery:!1,deliver_delay_window:0,deliver_after:"",new_kernel_version_id:m(o)?o[0].id.toString():"",reboot_after:!1},i=k({initialValues:h,validationSchema:w,onSubmit:async t=>{try{const{data:a}=await v({id:Number(u),kernel_package_id:Number(t.new_kernel_version_id),reboot_after:t.reboot_after,deliver_after:t.deliver_immediately?void 0:t.deliver_after,deliver_delay_window:t.randomize_delivery?t.deliver_delay_window:void 0});d();const S=t.reboot_after?O:C;f.success({title:`You queued kernel upgrade for "${c}"`,message:S,actions:[{label:"View details",onClick:()=>{b(a)}}]})}catch(a){p(a)}}}),y=async()=>{await i.setFieldValue("reboot_after",!0),i.handleSubmit()};return e.jsxs(r.Form,{onSubmit:i.handleSubmit,children:[e.jsx(r.Notification,{severity:"information",title:"Restart recommended",children:e.jsx("span",{children:T})}),e.jsxs(s,{spaced:!0,children:[e.jsx(s.Item,{label:"Current version",value:l}),e.jsx(s.Item,{label:"New version",value:m(o)?e.jsx("span",{children:o[0].version_rounded}):e.jsx(r.Select,{options:g,...i.getFieldProps("new_kernel_version")})})]}),e.jsx(B,{formik:i}),e.jsx(I,{formik:i}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(r.Button,{type:"button",appearance:"base",onClick:d,children:"Cancel"}),e.jsx(r.ConfirmationButton,{type:"button",confirmationModalProps:{title:"Upgrading kernel and restarting instance",children:e.jsx("p",{children:"Are you sure? This action will upgrade the kernel and restart the instance."}),confirmButtonLabel:"Upgrade and Restart",confirmButtonAppearance:"positive",confirmButtonLoading:n,confirmButtonDisabled:n,onConfirm:y},children:"Upgrade and Restart"}),e.jsx(r.ConfirmationButton,{type:"button",appearance:"positive",confirmationModalProps:{title:"Upgrading kernel",children:e.jsx("p",{children:"Are you sure? This action will upgrade the kernel."}),confirmButtonLabel:"Upgrade",confirmButtonAppearance:"positive",confirmButtonLoading:n,confirmButtonDisabled:n,type:"submit",onConfirm:()=>{i.handleSubmit()}},children:"Upgrade kernel"})]})]})};export{ue as default};
