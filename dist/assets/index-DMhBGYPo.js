import{v,w as A,j as e,N as F,r as p,d as l,z as L,u as E,B as D,y as M,L as O,R as z,x as u}from"./index-DYykpNVa.js";import{u as P}from"./useFetchOld-BGD2hIpr.js";import"./InstancesPageActions-nbDXpXLr.js";import"./index-Cbj0Sz5k.js";import{u as Y}from"./useRoles-CK1OAvut.js";import{N as k}from"./NoData-CT6SeJUX.js";import{m as Q}from"./index-C2TKYmcI.js";import"./ListTitle-anvzyHx6.js";import"./ResponsiveTable-C-8YbfBJ.js";import"./StaticLink-BX9qJBBO.js";import"./TruncatedCell-DQQZxgbr.js";import"./Truncated-DtD6hAHP.js";import"./useExpandableRow-CGDZ27WS.js";import"./TextConfirmationModal-DuGXYB1S.js";import"./InfoGrid-CVtcW3Y8.js";import"./InfoItem-DMBAN7ig.js";import"./TablePagination-CIA4CRba.js";import"./TableFilterChips-DLH4XQ-H.js";import"./PageParamFilter-LH49uHXA.js";import"./TableFilter-C7yTBfOe.js";import"./formikErrors-Bw8iTXYS.js";const U=()=>{const s=P(),c=v(),{isPending:t,mutateAsync:o}=A({mutationFn:async i=>s.get("AcceptPendingComputers",{params:i}),onSuccess:async()=>c.invalidateQueries({queryKey:["pendingInstances"]})});return{acceptPendingInstances:o,isAcceptingPendingInstances:t}},q=()=>{const s=P(),c=v(),{isPending:t,mutateAsync:o}=A({mutationFn:async i=>s.get("RejectPendingComputers",{params:i}),onSuccess:async()=>c.invalidateQueries({queryKey:["pendingInstances"]})});return{rejectPendingInstances:o,isRejectingPendingInstances:t}},G=({column:{id:s},row:{original:c}})=>{const t={};return s==="title"?t.role="rowheader":s==="checkbox"?t["aria-label"]=`Toggle ${c.title} instance`:s==="hostname"?t["aria-label"]="Hostname":s==="access_group"?t["aria-label"]="Access group":s==="client_tags"?t["aria-label"]="Tags":s==="creation_time"&&(t["aria-label"]="Creation time"),t},K=(s,c)=>c?s.find(({value:t})=>t===c)?.label??c:e.jsx(k,{}),_=s=>Q(s).utc().calendar({sameElse:`${F} [UTC]`,lastWeek:"[Last] dddd, HH:mm [UTC]",sameDay:"[Today], HH:mm [UTC]",lastDay:"[Yesterday], HH:mm [UTC]"}),W="_checkbox_1jtck_1",J="_truncate_1jtck_5",h={checkbox:W,truncate:J},V=({accessGroupOptions:s,instances:c,onSelectedIdsChange:t,selectedIds:o})=>{const i=p.useMemo(()=>c,[c]),n=p.useMemo(()=>[{accessor:"checkbox",className:h.checkbox,Header:()=>e.jsx(l.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:"Toggle all instances"}),inline:!0,checked:o.length===i.length,indeterminate:o.length>0&&o.length<i.length,onChange:()=>{t(o.length>0?[]:i.map(({id:a})=>a))}}),Cell:({row:{original:a}})=>e.jsx(l.CheckboxInput,{label:e.jsx("span",{className:"u-off-screen",children:`Toggle ${a.title} instance`}),inline:!0,checked:o.includes(a.id),onChange:()=>{t(o.includes(a.id)?o.filter(g=>g!==a.id):[...o,a.id])}})},{accessor:"title",Header:"name"},{accessor:"hostname",Header:"Hostname"},{accessor:"access_group",Header:"Access group",Cell:({row:{original:a}})=>K(s,a.access_group)},{accessor:"client_tags",Header:"Tags",Cell:({row:{original:a}})=>a.client_tags.length?e.jsx(l.Tooltip,{message:a.client_tags.join(", "),positionElementClassName:h.truncate,children:a.client_tags.join(", ")}):e.jsx(k,{})},{accessor:"creation_time",Header:"Pending since",Cell:({row:{original:a}})=>e.jsx(l.Tooltip,{message:_(a.creation_time),positionElementClassName:h.truncate,children:_(a.creation_time)})}],[i,o.length]);return e.jsx(l.ModularTable,{columns:n,data:i,getCellProps:G})},X="_help_h15yn_1",Z={help:X},Ce=({instances:s})=>{const[c,t]=p.useState(!1),[o,i]=p.useState(""),[n,a]=p.useState([]),g=L(),{user:f}=E(),{notify:j}=D(),{closeSidePanel:m,changeSidePanelSize:x}=M(),{getAccessGroupQuery:T}=Y(),d=f?.accounts.find(r=>r.name===f?.current_account)?.title,I=()=>{t(!0),x("small")},B=()=>{t(!1),x("large")},{acceptPendingInstances:$,isAcceptingPendingInstances:b}=U(),{rejectPendingInstances:w,isRejectingPendingInstances:y}=q(),H=async()=>{try{await w({computer_ids:n}),m(),j.success({message:`${n.length} pending ${u(n.length,"instance")} ${u(n.length,"has","have")} been rejected to add to your ${d} organization.`,title:`You have rejected ${n.length} pending ${u(n.length,"instance")}`})}catch(r){g(r)}},R=async()=>{try{await $({access_group:o,computer_ids:n}),m(),j.success({message:`${n.length} pending ${u(n.length,"instance")} ${u(n.length,"has","have")} been successfully added to your ${d} organization.`,title:`You have approved ${n.length} pending ${u(n.length,"instance")}`})}catch(r){g(r)}},{data:S}=T(),C=S?.data.map(({name:r,title:N})=>({label:N,value:r}))??[];return e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:Z.help,children:[e.jsxs("span",{children:["You can automatically register new Landscape Client Instances when theyâ€™re configured using a registration key. This eliminates the need for manual approval of each computer. You can enable this feature in the"," "]}),e.jsx(O,{to:z.settings.general(),children:"Org. settings"}),e.jsx("span",{children:" or "}),e.jsx("a",{href:"https://ubuntu.com/landscape/docs/managing-computers",target:"_blank",rel:"nofollow noopener noreferrer",children:"learn more"})]}),c&&e.jsx(l.Select,{label:"Access group",options:C,name:"access_group",value:o,onChange:r=>{i(r.target.value)}}),!c&&e.jsx(V,{accessGroupOptions:C,instances:s,onSelectedIdsChange:r=>{a(r)},selectedIds:n}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(l.Button,{type:"button",appearance:"base",onClick:m,children:"Cancel"}),c&&e.jsxs(e.Fragment,{children:[e.jsx(l.Button,{type:"button",onClick:B,children:"Back"}),e.jsx(l.ConfirmationButton,{type:"button",appearance:"positive",disabled:n.length===0,confirmationModalProps:{title:"Approve pending instances",children:e.jsxs("p",{children:["This will approve ",n.length," selected"," ",u(n.length,"instance")," to add to your"," ",d," organization."]}),confirmButtonLabel:"Approve",confirmButtonAppearance:"positive",confirmButtonLoading:b,confirmButtonDisabled:b,onConfirm:R},children:"Approve"})]}),!c&&e.jsxs(e.Fragment,{children:[e.jsx(l.ConfirmationButton,{type:"button",appearance:"negative",disabled:n.length===0,confirmationModalProps:{title:"Reject pending instances",children:e.jsxs("p",{children:["This will reject ",n.length," selected"," ",u(n.length,"instance")," to add to your"," ",d," organization."]}),confirmButtonLabel:"Reject",confirmButtonAppearance:"negative",confirmButtonLoading:y,confirmButtonDisabled:y,onConfirm:H},children:"Reject"}),e.jsx(l.Button,{type:"button",appearance:"positive",disabled:n.length===0,onClick:I,children:"Approve"})]})]})]})};export{Ce as default};
