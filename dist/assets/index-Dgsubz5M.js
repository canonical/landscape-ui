import{z as S,G as x,y as D,B as k,H as d,C as j,j as e,d as n}from"./index-DYykpNVa.js";import{D as A}from"./DeliveryBlock-C-KDxUEZ.js";import{R as E}from"./RandomizationBlock-DjoHppMG.js";import"./helpers-DblkVUdf.js";import{I as s}from"./InfoGrid-CVtcW3Y8.js";import{u as N}from"./index-C2TKYmcI.js";import{K as B}from"./constants-BhyFFE2A.js";import{u as I}from"./index-CpGh5_Pb.js";import"./formikErrors-Bw8iTXYS.js";import"./RadioGroup-DD61dFf3.js";import"./InfoItem-DMBAN7ig.js";import"./NoData-CT6SeJUX.js";import"./Truncated-DtD6hAHP.js";import"./ResponsiveTable-C-8YbfBJ.js";import"./TablePagination-CIA4CRba.js";import"./TableFilterChips-DLH4XQ-H.js";import"./useFetchOld-BGD2hIpr.js";import"./PageParamFilter-LH49uHXA.js";import"./TableFilter-C7yTBfOe.js";import"./PageMain-BnPck7ZK.js";import"./useGetInstance-BxH-rtml.js";import"./InstancesPageActions-nbDXpXLr.js";import"./ListTitle-anvzyHx6.js";import"./StaticLink-BX9qJBBO.js";import"./TruncatedCell-DQQZxgbr.js";import"./useExpandableRow-CGDZ27WS.js";import"./index-Cbj0Sz5k.js";import"./TextConfirmationModal-DuGXYB1S.js";import"./useUsns-Ky-uaXGZ.js";import"./constants-CXofZZ4i.js";import"./SingleInstanceTabs.module-DvhuGYYD.js";const R="The kernel will be downgraded and the instance will restart afterwards to apply the change.",O="The kernel will be downgraded. You'll need to restart the instance to apply this change.",T="Downgrading the kernel will expose your system to known security vulnerabilities AND reduce your Livepatch coverage.",pe=({currentKernelVersion:c,downgradeKernelVersions:o,instanceName:m})=>{const p=S(),{instanceId:u}=x(),{closeSidePanel:l}=D(),{notify:_}=k(),{downgradeKernelQuery:f}=I(),{openActivityDetails:g}=N(),{mutateAsync:h,isPending:r}=f,w=[{label:"Select",value:""},...o.map(t=>({label:t.version_rounded,value:t.id.toString()}))],b={deliver_immediately:!0,randomize_delivery:!1,deliver_delay_window:0,deliver_after:"",new_kernel_version_id:d(o)?o[0].id.toString():"",reboot_after:!1},i=j({initialValues:b,validationSchema:B,onSubmit:async t=>{try{const{data:a}=await h({id:Number(u),kernel_package_id:Number(t.new_kernel_version_id),reboot_after:t.reboot_after,deliver_after:t.deliver_immediately?void 0:t.deliver_after,deliver_delay_window:t.randomize_delivery?t.deliver_delay_window:void 0});l();const v=t.reboot_after?R:O;_.success({title:`You queued kernel downgrade for instance "${m}"`,message:v,actions:[{label:"View details",onClick:()=>{g(a)}}]})}catch(a){p(a)}}}),y=async()=>{await i.setFieldValue("reboot_after",!0),i.handleSubmit()};return e.jsxs(n.Form,{onSubmit:i.handleSubmit,children:[e.jsx(n.Notification,{severity:"caution",title:"Security warning",children:e.jsx("span",{children:T})}),e.jsxs(s,{spaced:!0,children:[e.jsx(s.Item,{label:"Current version",value:c}),e.jsx(s.Item,{label:"Kernel version",value:d(o)?e.jsx("span",{children:o[0].version_rounded}):e.jsx(n.Select,{options:w,...i.getFieldProps("new_kernel_version_id")})})]}),e.jsx(A,{formik:i}),e.jsx(E,{formik:i}),e.jsxs("div",{className:"form-buttons",children:[e.jsx(n.Button,{type:"button",appearance:"base",onClick:l,children:"Cancel"}),e.jsx(n.ConfirmationButton,{type:"button",confirmationModalProps:{title:"Downgrading kernel and restarting instance",children:e.jsx("p",{children:"Are you sure? This action will downgrade the kernel and restart the instance."}),confirmButtonLabel:"Downgrade and Restart",confirmButtonAppearance:"negative",confirmButtonLoading:r,confirmButtonDisabled:r,onConfirm:y},children:"Downgrade and Restart"}),e.jsx(n.ConfirmationButton,{type:"button",appearance:"negative",confirmationModalProps:{title:"Downgrading kernel",children:e.jsx("p",{children:"Are you sure? This action will downgrade the kernel."}),confirmButtonLabel:"Downgrade",confirmButtonAppearance:"negative",confirmButtonLoading:r,confirmButtonDisabled:r,onConfirm:()=>{i.handleSubmit()}},children:"Downgrade kernel"})]})]})};export{pe as default};
