import{o as r,a6 as v,j as e,d,r as j,E as y,G as _,s as N,e as k}from"./index-DYykpNVa.js";import{a as E}from"./TablePagination-CIA4CRba.js";import{u as T,K as C}from"./index-CpGh5_Pb.js";import{I as c}from"./InfoGrid-CVtcW3Y8.js";import{N as x}from"./NoData-CT6SeJUX.js";import{R as F}from"./ResponsiveTable-C-8YbfBJ.js";import"./TableFilterChips-DLH4XQ-H.js";import"./PageMain-BnPck7ZK.js";import"./useGetInstance-BxH-rtml.js";import"./InstancesPageActions-nbDXpXLr.js";import"./index-C2TKYmcI.js";import"./useFetchOld-BGD2hIpr.js";import"./PageParamFilter-LH49uHXA.js";import"./TableFilter-C7yTBfOe.js";import"./formikErrors-Bw8iTXYS.js";import"./ListTitle-anvzyHx6.js";import"./StaticLink-BX9qJBBO.js";import"./TruncatedCell-DQQZxgbr.js";import"./Truncated-DtD6hAHP.js";import"./useExpandableRow-CGDZ27WS.js";import"./index-Cbj0Sz5k.js";import"./TextConfirmationModal-DuGXYB1S.js";import"./useUsns-Ky-uaXGZ.js";import"./constants-CXofZZ4i.js";import"./SingleInstanceTabs.module-DvhuGYYD.js";import"./InfoItem-DMBAN7ig.js";const K=(t,a)=>{switch(t){case"Fully patched":return"All available kernel security patches have been applied. You have no pending patches.";case"Kernel upgrade available":{const s=r(a);return`A new kernel version is available.${s.isValid()?` The current version is covered by Livepatch until ${s.format(v)}`:""}`}case"Restart required":return"Low and/or medium patches have been installed. You must restart to complete patching.";case"End of life":return"The kernel is no longer covered by Livepatch. It is not getting high and critical security patches.";case"Livepatch disabled":return"Livepatch is disabled. Kernel patches will not be applied automatically until you enabled Livepatch.";default:return"There was an error getting the status."}},w=(t,a)=>{const s=r(a),i=r(),n=s.diff(i,"days");return n<0||!t||!r(a).isValid()?"status-failed-small":n<7?"status-waiting-small":"status-succeeded-small"},B=(t,a)=>{if(!t)return"Livepatch is disabled";const s=r(a),i=r();return s.diff(i,"days")<0?"Expired":`Expires on ${r(a).format(v)}`},R="_statusIcon_pedr9_1",A="_tooltipIcon_pedr9_5",f={statusIcon:R,tooltipIcon:A},V=({kernelOverview:t})=>{const a=t.status!=="Livepatch disabled";return e.jsxs(c,{spaced:!0,children:[e.jsx(c.Item,{label:"current kernel version",value:t.currentVersion}),e.jsx(c.Item,{label:"kernel status",value:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a?t.status:"Not covered by Livepatch"}),e.jsxs(d.Tooltip,{message:K(t.status,t.expirationDate),className:f.tooltipIcon,children:[e.jsx(d.Icon,{name:"help","aria-hidden":!0}),e.jsx("span",{className:"u-off-screen",children:"Help"})]})]})}),e.jsx(c.Item,{label:"livepatch coverage",value:t.expirationDate?e.jsxs(e.Fragment,{children:[e.jsx(d.Icon,{name:w(a,t.expirationDate),"aria-hidden":!0,className:f.statusIcon}),B(a,t.expirationDate)]}):null})]})},q=`There are no pending kernel security patches to apply at this time.
                Livepatch applies critical and high security patches in the background without requiring a system restart.
                Patches found since last restart and their status will be shown here.`,H=t=>`https://ubuntu.com/security/${t}`,M=t=>{const a={};switch(t.column.id){case"Name":a.role="rowheader";break;case"Patched":a["aria-label"]="Status";break;case"Description":a["aria-label"]="Description";break;case"Bug":a["aria-label"]="Bug";break}return a},$="_description_1s9gq_1",U={description:$},Y=({kernelData:t})=>{const a=j.useMemo(()=>[{Header:e.jsx("span",{children:"CVE"}),accessor:"Name",Cell:({row:s})=>e.jsx(d.Link,{href:H(s.original.Name),target:"_blank",rel:"nofollow noopener noreferrer",className:"u-no-margin--bottom u-no-padding--top",children:s.original.Name})},{Header:"Status",accessor:"Patched",Cell:({row:{original:s}})=>s.Patched?"Patched by Livepatch":"Unpatched",getCellIcon:({row:{original:s}})=>s.Patched?"status-succeeded-small":"status-failed-small",disableSortBy:!0},{Header:"Description",accessor:"Description",className:U.description,Cell:({row:s})=>s.original.Description||e.jsx(x,{}),disableSortBy:!0},{Header:"Bug",accessor:"Bug",Cell:({row:s})=>s.original.Bug||e.jsx(x,{}),disableSortBy:!0}],[]);return e.jsx(e.Fragment,{children:t.length===0?e.jsx(y,{title:"No outstanding kernel patches",body:q}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"p-heading--5 u-no-padding u-no-margin",children:"Patches discovered since last restart"}),e.jsx(F,{columns:a,data:t,getCellProps:M,sortable:!0,initialSortColumn:"Name",initialSortDirection:"ascending"})]})})},fe=({instanceTitle:t})=>{const{instanceId:a,childInstanceId:s}=_(),{pageSize:i,currentPage:n}=N(),{getKernelQuery:I,getLivepatchInfoQuery:L}=T(),g=Number(s??a),{data:o,isPending:u}=I({id:g}),{data:p}=L({id:g}),l=p?.data.livepatch_info?.json?.output?.Status&&p?.data.livepatch_info?.json?.output?.Status.length>0?p?.data.livepatch_info?.json?.output?.Status[0]:void 0,h=l?.Livepatch.Fixes??[],D=(P,b)=>h.slice(b,b+P),m=j.useMemo(()=>D(i,(n-1)*i),[h,n,i]),S={currentVersion:l?.Kernel??o?.data.installed?.version_rounded??"",expirationDate:l?.UpgradeRequiredDate&&r(l?.UpgradeRequiredDate).isValid()?l.UpgradeRequiredDate:"",status:o?.data.smart_status??""};return e.jsxs(e.Fragment,{children:[u&&e.jsx(k,{}),!u&&!o?.data.installed&&e.jsx(y,{title:"Kernel information unavailable",body:o?.data.message||"No kernel information available"}),!u&&o?.data.installed&&e.jsxs(e.Fragment,{children:[e.jsx(C,{instanceName:t,hasTableData:m.length>0,kernelStatuses:o.data}),e.jsx(V,{kernelOverview:S}),e.jsx(Y,{kernelData:m}),e.jsx(E,{totalItems:h.length,currentItemCount:m.length})]})]})};export{fe as default};
