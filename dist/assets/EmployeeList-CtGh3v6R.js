const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BvoVnqaX.js","assets/index-Dfc97QGW.js","assets/index-CBwtg6kZ.css","assets/InfoGrid-CrJbMYy5.js","assets/InfoItem-DImpX37B.js","assets/NoData-DMN9LLPq.js","assets/Truncated-D8EZCoK1.js","assets/Truncated-uqJp6ujM.css","assets/InfoItem-D8nPzgUA.css","assets/InfoGrid-D3QqOHFx.css","assets/constants-BTpoIHxf.js","assets/InstancesPageActions-Dns4Yse-.js","assets/index-S_kjB96R.js","assets/ResponsiveTable-ViIMTRR6.js","assets/ResponsiveTable-Czda4kFo.css","assets/TablePagination-B0v8QAQr.js","assets/TableFilterChips-DXWGZ6VK.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-DZURD2KR.css","assets/useFetchOld-BgGVMMmJ.js","assets/PageParamFilter-C5PJgjVf.js","assets/TableFilter-BmLRyeMD.js","assets/TableFilter-B85Stwni.css","assets/formikErrors-Bw8iTXYS.js","assets/index-DzMlcK9Q.css","assets/ListTitle-DsIgCqjQ.js","assets/ListTitle-CxCHkD9o.css","assets/StaticLink-BNg3qc2M.js","assets/TruncatedCell-Cf7_euhM.js","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-DYtdXwcw.js","assets/index-DiSNWm9B.js","assets/TextConfirmationModal-O9rtHEfo.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/InstancesPageActions-ChZMRYY_.css","assets/InstanceRemoveFromLandscapeModal-T_39TnlF.js","assets/useRemoveInstancesFromLandscape-BYphFc8b.js","assets/index-DJG_wlh-.css"])))=>i.map(i=>d[i]);
import{f as v,v as x,w as g,B as b,z as y,j as t,d as m,C as L,y as C,g as h,ab as j,r as p,e as T,$ as w,q as E,L as A,R as F}from"./index-Dfc97QGW.js";import{L as _}from"./constants-BTpoIHxf.js";import{N as z}from"./NoData-DMN9LLPq.js";import{R as P}from"./ResponsiveTable-ViIMTRR6.js";import{T as I}from"./TruncatedCell-Cf7_euhM.js";const D=e=>e.is_active?"Active":"Inactive",S=()=>{const e=v(),a=x(),{mutateAsync:s,isPending:c}=g({mutationKey:["employee","patch"],mutationFn:async({id:d,...l})=>e.patch(`employees/${d}`,l),onSuccess:async()=>a.invalidateQueries({queryKey:["employees"]})});return{patchEmployee:s,isPending:c}},M=()=>{const e=v(),a=x(),{mutateAsync:s,isPending:c}=g({mutationKey:["employee","patch"],mutationFn:async({id:d,...l})=>e.post(`employees/${d}/offboard`,l),onSuccess:async()=>a.invalidateQueries({queryKey:["employees"]})});return{deactivateEmployee:s,isDeactivating:c}},R=({employee:e,handleClose:a})=>{const{notify:s}=b(),c=y(),{patchEmployee:d,isPending:l}=S(),n=async()=>{try{await d({id:e.id,is_active:!0}),s.success({title:`You have successfully activated ${e.name}`,message:`${e.name} will be able to log in to Landscape and register new instances with their account.`}),a()}catch(o){c(o)}};return t.jsx(m.ConfirmationModal,{confirmButtonLabel:"Activate",onConfirm:n,confirmButtonAppearance:"positive",title:`Activate ${e.name}`,close:a,confirmButtonDisabled:l,confirmButtonLoading:l,children:t.jsxs("p",{children:["This will allow ",e.name," to log in to Landscape and register new instances with their account."]})})},N="Irreversibly deletes all data on disks of associated instances. Proceed with caution.",O="This will remove all instances associated with this employee from Landscape.",$={sanitizationConfirmationText:"",sanitizeInstances:!1,removeFromLandscapeConfirmationText:"",removeFromLandscape:!1},k="_title_ip3uo_1",B="_tooltipPositionElement_ip3uo_5",V="_additionalActionContainer_ip3uo_9",q="_confirmationText_ip3uo_17",u={title:k,tooltipPositionElement:B,additionalActionContainer:V,confirmationText:q},H=(e,a)=>a.removeFromLandscape&&a.sanitizeInstances?`Off-board ${e}`:`Deactivate ${e}`,Y=e=>e.removeFromLandscape&&e.sanitizeInstances?"Off-board":e.removeFromLandscape?"Deactivate and remove":e.sanitizeInstances?"Deactivate and sanitize":"Deactivate",K=e=>!!(e.sanitizeInstances&&e.sanitizationConfirmationText!=="sanitize instances"||e.removeFromLandscape&&e.removeFromLandscapeConfirmationText!=="remove instances"||e.sanitizeInstances&&e.removeFromLandscape&&e.sanitizationConfirmationText!=="sanitize instances"&&e.removeFromLandscapeConfirmationText!=="remove instances"),Q=(e,a,s)=>a&&s?{notificationTitle:`You have successfully deactivated ${e} and initiated both Sanitization and Removal of their instances`,notificationMessage:"Sanitization and removal of this employee’s instances have been queued. The data will be permanently irrecoverable once complete. To manage the instances again, they will need to be re-registered in Landscape."}:a?{notificationTitle:`You have successfully deactivated ${e} and initiated sanitization of their instances`,notificationMessage:`Sanitization of the ${e}’s instances has been queued in Activities. The data will be permanently irrecoverable once complete.`}:s?{notificationTitle:`You have successfully deactivated ${e} and initiated the Removal of their instances`,notificationMessage:"The removal of this employee’s instances has been queued. This process will delete all stored data. To manage them again, they will need to be re-registered in Landscape."}:{notificationTitle:`You have successfully deactivated ${e}`,notificationMessage:"This employee won’t be able to log in to Landscape or register new instances with their account."},U=({employee:e,handleClose:a})=>{const{notify:s}=b(),c=y(),{deactivateEmployee:d,isDeactivating:l}=M(),n=L({initialValues:$,enableReinitialize:!0,onSubmit:async o=>{if(!(o.sanitizeInstances&&o.sanitizationConfirmationText!=="sanitize instances"||o.removeFromLandscape&&o.removeFromLandscapeConfirmationText!=="remove instances"))try{await d({id:e.id,remove_instances:n.values.removeFromLandscape,sanitize_instances:n.values.sanitizeInstances}),n.resetForm(),a();const{notificationMessage:i,notificationTitle:r}=Q(e.name,n.values.sanitizeInstances,n.values.removeFromLandscape);s.success({title:r,message:i})}catch(i){c(i)}}});return t.jsx(m.ConfirmationModal,{title:H(e.name,n.values),confirmButtonLabel:Y(n.values),confirmButtonProps:{type:"submit"},onConfirm:()=>{n.handleSubmit()},close:a,confirmButtonDisabled:K(n.values)||l,confirmButtonLoading:l,children:t.jsxs(m.Form,{noValidate:!0,onSubmit:o=>{o.preventDefault(),n.handleSubmit()},children:[t.jsxs("p",{children:["This will prevent ",e.name," from logging in to Landscape and from registering any new instances with their account"]}),t.jsx("b",{children:"Additional actions"}),t.jsxs("div",{children:[t.jsx(m.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:u.title,children:"Sanitize associated instances"}),t.jsxs(m.Tooltip,{position:"top-center",message:N,positionElementClassName:u.tooltipPositionElement,children:[t.jsx(m.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...n.getFieldProps("sanitizeInstances"),onChange:async o=>{n.getFieldProps("sanitizeInstances").onChange(o),await n.setFieldValue("sanitizationConfirmationText","")}}),n.values.sanitizeInstances&&t.jsxs("div",{className:u.additionalActionContainer,children:[t.jsx("p",{children:"Sanitization will permanently delete the encryption keys for associated instances, making its data completely irrecoverable. This action cannot be undone. Please confirm you wish to proceed."}),t.jsxs("p",{children:["Type"," ",t.jsx("b",{className:u.confirmationText,children:"sanitize instances"})," ","to confirm"]}),t.jsx(m.Input,{label:"Confirm instances sanitization",labelClassName:"u-off-screen","aria-label":"Sanitization confirmation text",placeholder:"sanitize instances",autoComplete:"off",type:"text",...n.getFieldProps("sanitizationConfirmationText")},"sanitizationConfirmationText")]}),t.jsx(m.CheckboxInput,{label:t.jsxs("span",{children:[t.jsx("span",{className:u.title,children:"Remove associated instances from Landscape"}),t.jsxs(m.Tooltip,{position:"top-center",message:O,positionElementClassName:u.tooltipPositionElement,children:[t.jsx(m.Icon,{name:"help","aria-hidden":!0}),t.jsx("span",{className:"u-off-screen",children:"Help"})]})]}),...n.getFieldProps("removeFromLandscape"),onChange:async o=>{n.getFieldProps("removeFromLandscape").onChange(o),await n.setFieldValue("removeFromLandscapeConfirmationText","")}}),n.values.removeFromLandscape&&t.jsxs("div",{className:u.additionalActionContainer,children:[t.jsx("p",{children:"This will remove all associated instances from Landscape, along with their stored data. To manage them again, you would need to re-register them in Landscape."}),t.jsxs("p",{children:["Type"," ",t.jsx("b",{className:u.confirmationText,children:"remove instances"})," to confirm"]}),t.jsx(m.Input,{label:"Confirm instances removal from Landscape",labelClassName:"u-off-screen",placeholder:"remove instances",autoComplete:"off","aria-label":"Remove from Landscape confirmation text",type:"text",...n.getFieldProps("removeFromLandscapeConfirmationText")},"removeFromLandscapeConfirmationText")]})]})]})})},G=p.lazy(async()=>w(()=>import("./index-BvoVnqaX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]))),W=({employee:e})=>{const{setSidePanelContent:a}=C(),{value:s,setTrue:c,setFalse:d}=h(),{value:l,setTrue:n,setFalse:o}=h(),i=()=>{a("Employee details",t.jsx(p.Suspense,{fallback:t.jsx(T,{}),children:t.jsx(G,{employee:e})}),"medium")},r=[{icon:"show",label:"View details","aria-label":`View ${e.name} employee details`,onClick:i}],f=[];return e.is_active?f.push({icon:"pause",label:"Deactivate","aria-label":`Deactivate ${e.name}`,onClick:n}):r.push({icon:"play",label:"Activate","aria-label":`Activate ${e.name}`,onClick:c}),t.jsxs(t.Fragment,{children:[t.jsx(j,{toggleAriaLabel:`${e.name} actions`,actions:r,destructiveActions:f}),s&&t.jsx(R,{employee:e,handleClose:d}),l&&t.jsx(U,{employee:e,handleClose:o})]})},Z=e=>({index:a})=>{const s={};return e?.column==="computers"&&e.row===a&&(s.className="expandedRow"),s},J=e=>({column:a,row:{index:s}})=>{const c={};return a.id==="computers"?(c["aria-label"]="Associated instances",e?.column===a.id&&e.row===s&&(c.className="expandedCell")):a.id==="name"?c.role="rowheader":a.id==="email"?c["aria-label"]="Email":a.id==="status"?c["aria-label"]="Status":a.id==="actions"&&(c["aria-label"]="Actions"),c},X=e=>a=>{a&&(e.current=[...a.querySelectorAll("tbody tr")])},ee=p.lazy(async()=>w(()=>import("./index-BvoVnqaX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]))),oe=({employees:e})=>{const{setSidePanelContent:a}=C(),[s,c]=p.useState(null),d=p.useRef([]);E(s?.column==="computers"?{current:d.current[s.row]}:[],o=>{o.target instanceof Element&&!o.target.closest("truncatedItem")&&c(null)});const l=(o,i)=>{c(r=>r&&r.column===o&&r.row===i?null:{column:o,row:r&&["computers"].includes(r.column)&&r.row<i?i-1:i})},n=p.useMemo(()=>{const o=i=>{a("Employee details",t.jsx(p.Suspense,{fallback:t.jsx(T,{}),children:t.jsx(ee,{employee:i})}),"medium")};return[{accessor:"name",Header:"name",Cell:({row:{original:i}})=>t.jsx(m.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom u-no-padding--top",onClick:()=>{o(i)},"aria-label":`Show details of user ${i.name}`,children:i.name})},{accessor:"email",Header:"email"},{accessor:"status",Header:"status",Cell:({row:{original:i}})=>t.jsx("span",{children:D(i)}),getCellIcon:({row:{original:{is_active:i}}})=>i?"status-succeeded-small":"status-failed-small"},{accessor:"computers",Header:"associated instances",Cell:({row:{original:i,index:r}})=>i.computers&&i.computers.length>0?t.jsx(I,{content:i.computers?.map(f=>t.jsx(A,{className:"truncatedItem",to:F.instances.details.single(f.id),children:f.title},f.id)),isExpanded:s?.column==="computers"&&s.row===r,onExpand:()=>{l("computers",r)}}):t.jsx(z,{})},{..._,Cell:({row:{original:i}})=>t.jsx(W,{employee:i})}]},[s,a]);return t.jsx(P,{columns:n,ref:X(d),data:e,getCellProps:J(s),getRowProps:Z(s),emptyMsg:"No employees found according to your search parameters.",minWidth:1200})};export{R as A,U as D,oe as E,D as g};
