const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CEQ6yOqJ.js","assets/index-DYykpNVa.js","assets/index-hef1aQzf.css","assets/SidePanelFormButtons-Aj5ThB2m.js","assets/SidePanelFormButtons.module-CcPyiogC.js","assets/SidePanelFormButtons-DP4HE5AU.css","assets/InstancesPageActions-nbDXpXLr.js","assets/index-C2TKYmcI.js","assets/NoData-CT6SeJUX.js","assets/ResponsiveTable-C-8YbfBJ.js","assets/ResponsiveTable-Czda4kFo.css","assets/TablePagination-CIA4CRba.js","assets/TableFilterChips-DLH4XQ-H.js","assets/TableFilterChips-BnP8uMWM.css","assets/TablePagination-DZURD2KR.css","assets/useFetchOld-BGD2hIpr.js","assets/PageParamFilter-LH49uHXA.js","assets/TableFilter-C7yTBfOe.js","assets/TableFilter-B85Stwni.css","assets/formikErrors-Bw8iTXYS.js","assets/index-DzMlcK9Q.css","assets/ListTitle-anvzyHx6.js","assets/ListTitle-CxCHkD9o.css","assets/StaticLink-BX9qJBBO.js","assets/TruncatedCell-DQQZxgbr.js","assets/Truncated-DtD6hAHP.js","assets/Truncated-uqJp6ujM.css","assets/TruncatedCell-DraJKZqh.css","assets/useExpandableRow-CGDZ27WS.js","assets/index-Cbj0Sz5k.js","assets/TextConfirmationModal-DuGXYB1S.js","assets/TextConfirmationModal-I9pZGO8V.css","assets/InfoGrid-CVtcW3Y8.js","assets/InfoItem-DMBAN7ig.js","assets/InfoItem-D8nPzgUA.css","assets/InfoGrid-D3QqOHFx.css","assets/InstancesPageActions-ChZMRYY_.css","assets/TagsAddConfirmationModal-BaByvYt8.js","assets/ModalTablePagination-C4fLxOQV.js","assets/ModalTablePagination-HDr0Q-Wm.css","assets/useRoles-CK1OAvut.js","assets/useGetTags-BbkSXw8M.js","assets/index-CuKO3Aa0.css","assets/index-DgqFOHdW.js","assets/ScriptsTabs-BrOiXEKJ.js","assets/helpers-DblkVUdf.js","assets/constants-CXofZZ4i.js","assets/HeaderWithSearch-DH3OfcZg.js","assets/HeaderWithSearch-C2lwo0VI.css","assets/SingleInstanceTabs.module-DvhuGYYD.js","assets/SingleInstanceTabs-S4NROY16.css","assets/ScriptsTabs-DN44MVZt.css","assets/ScriptDropdown-C9m_9P8C.js","assets/useInfiniteQuery-uvFBsnEF.js","assets/downshift.esm-CVSNbv_O.js","assets/ScriptDropdown-rmGnZk9-.css","assets/useRunScript-E-Qq7n1I.js","assets/DeliveryBlock-C-KDxUEZ.js","assets/RadioGroup-DD61dFf3.js","assets/RadioGroup-WBbAFTwm.css","assets/index-W9SAO84K.js","assets/CodeEditor-B9M2dPM_.js","assets/CodeEditor-KxSGUzo3.css","assets/ScriptFormAttachments-DAnYsFsn.js","assets/AttachmentFile-Dr_XbZxY.js","assets/AttachmentFile-Bqzh6wPs.css","assets/ScriptFormAttachments-DoEC9DUJ.css","assets/index-BPPOKUrU.js","assets/EmployeeList-BGX_o-u-.js","assets/EmployeeList-CnpN88if.css","assets/index-DIDah_0c.css","assets/index-UnElghRO.js","assets/SidePanelTablePagination-ci5SCdZ3.js","assets/Blocks-C-bFP-tp.js","assets/Blocks-bdK2PNd9.css","assets/Chip-KbTDcFQd.js","assets/Chip-R6WqXyae.css","assets/InstanceRemoveFromLandscapeModal-B7-UxEEu.js","assets/useRemoveInstancesFromLandscape-XzdHOOUi.js","assets/SidePanel-DVyPWXM9.js","assets/SidePanel-5ugWznou.css","assets/WslInstancesEmptyState-BxRAHYkJ.js","assets/WslInstancesEmptyState-CBT5OoUG.css","assets/index-DWa9RADh.css"])))=>i.map(i=>d[i]);
import{f as O,v as be,w as ve,c as ge,R as d,j as t,p as xe,an as Ie,n as _e,i as je,o as b,u as Se,z as we,P as Fe,B as Ce,y as Ae,g as p,C as ke,e as f,d as a,I as Re,N as E,H as Me,r as u,$ as S}from"./index-DYykpNVa.js";import{T as Te}from"./TextConfirmationModal-DuGXYB1S.js";import{B as j}from"./Blocks-C-bFP-tp.js";import{C as De}from"./Chip-KbTDcFQd.js";import{t as Ee,v as Pe,H as Le,s as n,w as P}from"./InstancesPageActions-nbDXpXLr.js";import{I as o}from"./InfoGrid-CVtcW3Y8.js";import{u as Oe}from"./index-C2TKYmcI.js";import"./EmployeeList-BGX_o-u-.js";import{u as $e,I as ze}from"./InstanceRemoveFromLandscapeModal-B7-UxEEu.js";import"./index-Cbj0Sz5k.js";import{g as L}from"./formikErrors-Bw8iTXYS.js";import{u as Be}from"./useRoles-CK1OAvut.js";import"./SidePanel-DVyPWXM9.js";import{W as Ne,a as Ve}from"./WslInstancesEmptyState-BxRAHYkJ.js";import{S as qe}from"./StaticLink-BX9qJBBO.js";const Ge=()=>{const e=O(),i=be(),{mutateAsync:c,isPending:h}=ve({mutationKey:["employee","disassociate"],mutationFn:async({employee_id:m,computer_id:r})=>e.delete(`employees/${m}/computers/${r}`),onSuccess:(m,r)=>{i.invalidateQueries({queryKey:["instances",r.computer_id]})}});return{disassociateEmployeeFromInstance:c,isDisassociating:h}},Ue=(e,i={})=>{const c=O(),{id:h,...m}=e,{data:r,isLoading:v}=ge({queryKey:["employees","employee",e],queryFn:async()=>c.get(`employees/${h}`,{params:m}),...i});return{employee:r?.data,isGettingEmployee:v}},He=e=>{switch(e.type){case"package":return d.profiles.package({sidePath:["view"],profile:e.name||""});case"reboot":return d.profiles.reboot({sidePath:["view"],profile:e.id.toString()||""});case"removal":return d.profiles.removal({sidePath:["view"],profile:e.id.toString()||""});case"repository":return d.profiles.repository({search:e.title||""});case"script":return d.scripts.root({tab:"profiles",sidePath:["view"],profile:e.id.toString()||""});case"security":return d.profiles.security({sidePath:["view"],profile:e.id.toString()||""});case"upgrade":return d.profiles.upgrade({sidePath:["view"],profile:e.id.toString()||""});case"wsl":return d.profiles.wsl({sidePath:["view"],profile:e.name||""})}},Ke=({profile:e})=>t.jsx(qe,{to:He(e),children:e.title}),Qe={deliver_after:"",deliverImmediately:!0,action:null},Ye=xe().shape({deliver_after:je().when("deliverImmediately",{is:!1,then:e=>e.required("This field is required").test({message:"Invalid date",test:i=>b(i).isValid()}).test({message:"Date must be in the future",test:i=>b(i).isAfter()})}),deliverImmediately:_e(),action:Ie().oneOf(["shutdown","reboot"]).required()}),We=e=>{const i=e.employee_id??"no-employee",c=e.tags.join(",");return`${i}-${c}`},Ze="_headerContainer_10wnq_1",Je="_status_10wnq_6",Xe="_heading_10wnq_12",w={headerContainer:Ze,status:Je,heading:Xe},et=u.lazy(async()=>S(()=>import("./index-CEQ6yOqJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42]))),tt=u.lazy(async()=>S(()=>import("./index-DgqFOHdW.js"),__vite__mapDeps([43,44,1,2,11,12,13,14,45,46,8,9,10,23,24,25,26,27,28,40,15,30,31,16,17,18,47,48,49,50,29,51,52,53,54,55,3,4,5,56,19,57,58,59,60,61,62,63,64,65,66])).then(e=>({default:e.RunInstanceScriptForm}))),st=u.lazy(async()=>S(()=>import("./index-BPPOKUrU.js"),__vite__mapDeps([67,1,2,3,4,5,68,46,8,9,10,24,25,26,27,69,54,53,19,70]))),ot=u.lazy(async()=>S(()=>import("./index-UnElghRO.js"),__vite__mapDeps([71,1,2,17,18,12,13,72,11,14,30,31,73,74,75,76,6,7,8,9,10,15,16,19,20,21,22,23,24,25,26,27,28,29,32,33,34,35,36,68,46,69,77,78,40,79,80,81,47,48,82,83]))),at=({instance:e})=>{const{isFeatureEnabled:i}=Se(),c=we(),h=Fe(),{notify:m}=Ce(),{setSidePanelContent:r}=Ae(),{openActivityDetails:v}=Oe(),{employee:g,isGettingEmployee:$}=Ue({id:e.employee_id??0},{enabled:!!e.employee_id}),{restartInstances:z,isRestartingInstances:F}=Ee(),{getAccessGroupQuery:B}=Be(),{sanitizeInstance:N,isSanitizingInstance:C}=$e(),{shutDownInstances:V,isShuttingDownInstances:A}=Pe(),{disassociateEmployeeFromInstance:q,isDisassociating:k}=Ge(),{value:G,setTrue:U,setFalse:H}=p(),{value:K,setTrue:Q,setFalse:Y}=p(),{value:W,setTrue:Z,setFalse:J}=p(),{value:X,setTrue:ee,setFalse:te}=p(),{value:se,setTrue:oe,setFalse:ae}=p(),{value:ie,setTrue:le,setFalse:R}=p(),{value:ne,setTrue:re,setFalse:M}=p(),{data:T,isPending:ce}=B(),l=ke({initialValues:Qe,validationSchema:Ye,onSubmit:async s=>{if(!s.action)return;const I={computer_ids:[e.id],deliver_after:s.deliverImmediately?void 0:`${s.deliver_after}:00Z`};try{const{data:y}=s.action==="reboot"?await z(I):await V(I),_=s.action==="reboot"?"restarted":"shut down";m.success({title:`You queued "${e.title}" to be ${_}`,message:`Instance "${e.title}" will be ${_} and is queued in Activities`,actions:[{label:"View details",onClick:()=>{v(y)}}]})}catch(y){c(y)}}});if(ce||$)return t.jsx(f,{});const de=async()=>{try{const{data:s}=await N({computer_id:e.id,computer_title:e.title});m.success({title:`You have successfully marked ${e.title} to be sanitized.`,message:"An activity has been queued to sanitize it. The data will be permanently irrecoverable once complete.",actions:[{label:"View details",onClick:()=>{v(s)}}]})}catch(s){c(s)}finally{R()}},ue=()=>{r("Edit instance",t.jsx(u.Suspense,{fallback:t.jsx(f,{}),children:t.jsx(et,{instance:e})}))},me=()=>{r("Run script",t.jsx(u.Suspense,{fallback:t.jsx(f,{}),children:t.jsx(tt,{parentAccessGroup:e.access_group,query:`id:${e.id}`})}))},pe=()=>{r(`Associate employee with ${e.title}`,t.jsx(u.Suspense,{fallback:t.jsx(f,{}),children:t.jsx(st,{instanceTitle:e.title})}))},he=()=>{r(`Active profiles associated with ${e.title}`,t.jsx(u.Suspense,{fallback:t.jsx(f,{}),children:t.jsx(ot,{instance:e})}),"medium")},ye=async()=>{try{await q({computer_id:e.id,employee_id:e.employee_id??0}),M(),m.success({title:`You have successfully disassociated ${g?.name??"the employee"}.`,message:`${g?.name??"The employee"} has been successfully disassociated from ${e.title}.`})}catch(s){c(s)}},x=async s=>{await l.setFieldValue("action",s),l.handleSubmit()},D=()=>{h(d.instances.root(),{replace:!0})},fe=T?T.data:[];return t.jsxs(t.Fragment,{children:[t.jsx(Le,{title:t.jsxs("div",{className:w.headerContainer,children:[t.jsx("h2",{className:Re("p-heading--4 u-no-padding--top",w.heading),children:e.title}),e.is_wsl_instance&&t.jsx(De,{value:"WSL instance"})]}),actions:{nondestructive:[{icon:"edit",label:"Edit",onClick:ue},{icon:"restart",label:"Restart",onClick:U,excluded:!n(e).power},{icon:"power-off",label:"Shut down",onClick:Q,excluded:!n(e).power},{icon:"code",label:"Run script",onClick:me,excluded:!n(e).scripts},{icon:a.ICONS.user,label:"Associate employee",onClick:pe,collapsed:!0,excluded:!i("employee-management")||!n(e).employees||e.employee_id!==null},{icon:a.ICONS.user,label:"Disassociate employee",onClick:re,collapsed:!0,excluded:!i("employee-management")||!n(e).employees||e.employee_id===null}],destructive:[{icon:"restart",label:"Reinstall",onClick:Z,collapsed:!0,excluded:!n(e).uninstallation},{icon:"close",label:"Uninstall",onClick:ee,collapsed:!0,excluded:!n(e).uninstallation},{icon:a.ICONS.delete,label:"Remove from Landscape",onClick:oe,collapsed:!0},{icon:"tidy",label:"Sanitize",onClick:le,collapsed:!0,excluded:!n(e).sanitization}]}},We(e)),t.jsxs(j,{children:[t.jsx(j.Item,{title:"Status",children:t.jsxs(o,{children:[t.jsx(o.Item,{label:"Status",value:t.jsxs("div",{className:w.status,children:[t.jsx(a.Icon,{name:P(e).icon??""}),t.jsx("span",{children:P(e).label})]})}),t.jsx(o.Item,{label:"Last ping time",value:b(e.last_ping_time).isValid()?b(e.last_ping_time).format(E):null}),t.jsx(o.Item,{label:"Access group",value:fe.find(s=>s.name===e.access_group)?.title||e.access_group}),t.jsx(o.Item,{label:"Tags",value:e.tags.join(", "),type:"truncated"}),t.jsx(o.Item,{label:"Profiles",value:e.profiles?.length?Me(e.profiles)?t.jsx(Ke,{profile:e.profiles[0]}):t.jsxs(a.Button,{type:"button",className:"u-no-margin",appearance:"link",onClick:he,children:[e.profiles.length," profiles"]}):null,type:"truncated"}),n(e).employees&&t.jsx(o.Item,{label:"Associated employee",value:g?.name})]})}),t.jsx(j.Item,{title:"Registration details",children:t.jsxs(o,{children:[t.jsx(o.Item,{label:"Hostname",value:e.hostname}),t.jsx(o.Item,{label:"ID",value:e.id}),n(e).hardware&&t.jsx(o.Item,{label:"Serial number",value:e.grouped_hardware?.system.serial}),n(e).hardware&&t.jsx(o.Item,{label:"Product identifier",value:e.grouped_hardware?.system.model}),t.jsx(o.Item,{label:"OS",value:e.distribution_info?.description}),n(e).hardware&&t.jsx(o.Item,{label:"IP addresses",value:Array.isArray(e.grouped_hardware?.network)?e.grouped_hardware.network.map(s=>s.ip).join(", "):null,type:"truncated"}),t.jsx(o.Item,{label:"Registered",value:b(e.registered_at).format(E)})]})}),t.jsx(j.Item,{title:"Other",children:t.jsxs(o,{children:[t.jsx(o.Item,{label:"Annotations",value:e.annotations?Object.entries(e.annotations).map(([s,I],y,_)=>t.jsxs(u.Fragment,{children:[t.jsx("span",{children:`${s}: ${I}`}),y<_.length-1&&t.jsx("br",{})]},s)):null}),t.jsx(o.Item,{label:"Comment",value:e.comment})]})})]}),G&&t.jsx(a.ConfirmationModal,{close:H,title:"Restart instance",confirmButtonLabel:"Restart",confirmButtonAppearance:"positive",confirmButtonDisabled:F,confirmButtonLoading:F,onConfirm:async()=>x("reboot"),children:t.jsxs(a.Form,{onSubmit:async()=>x("reboot"),noValidate:!0,children:[t.jsx(a.CheckboxInput,{label:"Deliver as soon as possible",...l.getFieldProps("deliverImmediately"),checked:l.values.deliverImmediately}),t.jsx(a.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...l.getFieldProps("deliver_after"),disabled:l.values.deliverImmediately,error:L(l,"deliver_after")}),t.jsxs("p",{children:['This will restart "',e.title,'" instance.']})]})}),K&&t.jsx(a.ConfirmationModal,{close:Y,title:"Shut down instance",confirmButtonLabel:"Shut down",confirmButtonAppearance:"positive",confirmButtonDisabled:A,confirmButtonLoading:A,onConfirm:async()=>x("shutdown"),children:t.jsxs(a.Form,{onSubmit:async()=>x("shutdown"),noValidate:!0,children:[t.jsx(a.CheckboxInput,{label:"Deliver as soon as possible",...l.getFieldProps("deliverImmediately"),checked:l.values.deliverImmediately}),t.jsx(a.Input,{type:"datetime-local",label:"Schedule time",labelClassName:"u-off-screen",placeholder:"Scheduled time",...l.getFieldProps("deliver_after"),disabled:l.values.deliverImmediately,error:L(l,"deliver_after")}),t.jsxs("p",{children:['This will shut down "',e.title,'" instance.']})]})}),ne&&t.jsx(a.ConfirmationModal,{close:M,title:`Disassociate employee from ${e.title}`,confirmButtonLabel:"Disassociate",confirmButtonAppearance:"negative",confirmButtonDisabled:k,confirmButtonLoading:k,onConfirm:ye,children:t.jsxs("p",{children:["You are about to disassociate instance ",e.title," from"," ",g?.name,". This will revoke their access to the instanceâ€™s details and recovery key."]})}),e.is_wsl_instance&&t.jsxs(t.Fragment,{children:[t.jsx(Ne,{close:J,instances:[{name:e.title,computer_id:e.id}],isOpen:W,windowsInstance:e}),t.jsx(Ve,{close:te,instances:[{name:e.title,computer_id:e.id}],isOpen:X,onSuccess:D,parentId:e.parent.id})]}),t.jsx(ze,{close:ae,instance:e,isOpen:se,onSuccess:D}),t.jsx(Te,{isOpen:ie,confirmButtonLabel:"Sanitize",confirmButtonAppearance:"negative",confirmButtonDisabled:C,confirmButtonLoading:C,onConfirm:de,close:R,confirmationText:`sanitize ${e.title}`,title:"Sanitize instance",children:t.jsxs("p",{children:["Sanitization will permanently delete the encryption keys for"," ",e.title,", making its data completely irrecoverable. This action cannot be undone. Please confirm your wish to proceed."]})})]})},It=Object.freeze(Object.defineProperty({__proto__:null,default:at},Symbol.toStringTag,{value:"Module"}));export{Ke as P,It as i};
