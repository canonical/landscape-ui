import{f as A,v as R,w as S,p as w,n as I,z as B,G as x,y as k,B as C,C as j,j as t,d as n}from"./index-Dfc97QGW.js";import{u as E}from"./index-S_kjB96R.js";import"./InstancesPageActions-Dns4Yse-.js";import"./index-DiSNWm9B.js";import{u as T}from"./index-1GLbig6o.js";import{U}from"./constants-Dwl1JGyb.js";import{r as D,d as F}from"./helpers-BbXQOWxJ.js";import{D as L}from"./DeliveryBlock-FX2F7SvQ.js";import{R as P}from"./RandomizationBlock-CEGfJ5_6.js";import"./NoData-DMN9LLPq.js";import"./ResponsiveTable-ViIMTRR6.js";import"./TablePagination-B0v8QAQr.js";import"./TableFilterChips-DXWGZ6VK.js";import"./useFetchOld-BgGVMMmJ.js";import"./PageParamFilter-C5PJgjVf.js";import"./TableFilter-BmLRyeMD.js";import"./formikErrors-Bw8iTXYS.js";import"./ListTitle-DsIgCqjQ.js";import"./StaticLink-BNg3qc2M.js";import"./TruncatedCell-Cf7_euhM.js";import"./Truncated-D8EZCoK1.js";import"./useExpandableRow-DYtdXwcw.js";import"./TextConfirmationModal-O9rtHEfo.js";import"./InfoGrid-CrJbMYy5.js";import"./InfoItem-DImpX37B.js";import"./PageMain-LS0GxKmV.js";import"./useGetInstance-CjjdVYCe.js";import"./useUsns-DqfdHX4t.js";import"./constants-BTpoIHxf.js";import"./SingleInstanceTabs.module-DvhuGYYD.js";import"./RadioGroup-DkbRD5zc.js";const V=()=>{const s=A(),i=R(),{isPending:o,mutateAsync:d}=S({mutationFn:async({id:c,...r})=>s.post(`computers/${c}/restart`,r),onSuccess:async()=>i.invalidateQueries({queryKey:["instances"]})});return{restartInstance:d,isRestartingInstance:o}},N=w().shape({...F,...D,upgrade_and_restart:I()}),M={deliver_immediately:!0,randomize_delivery:!1,deliver_delay_window:0,deliver_after:"",upgrade_and_restart:!1},$="To save patches, upgrade your kernel and then Restart. If you Restart without upgrading, you will lose patches until Livepatch automatically applies them again.",bt=({showNotification:s,instanceName:i,newKernelVersionId:o})=>{const d=B(),{instanceId:c}=x(),{closeSidePanel:r}=k(),{notify:u}=C(),{upgradeKernelQuery:y}=T(),{openActivityDetails:m}=E(),{restartInstance:f,isRestartingInstance:p}=V(),{mutateAsync:h,isPending:g}=y,_=async()=>{const{data:e}=await h({id:Number(c),kernel_package_id:Number(o),reboot_after:!0});r(),u.success({title:`You queued kernel upgrade for "${i}"`,message:U,actions:[{label:"View details",onClick:()=>{m(e)}}]})},b=async e=>{const{data:l}=await f({id:Number(c),deliver_after:e.deliver_after,deliver_delay_window:e.deliver_delay_window});r(),u.success({title:`You queued "${i}" to be restarted.`,message:`Instance "${i}" will be restarted and is queued in Activities`,actions:[{label:"View details",onClick:()=>{m(l)}}]})},a=j({initialValues:M,validationSchema:N,onSubmit:async e=>{try{e.upgrade_and_restart?await _():await b(e)}catch(l){d(l)}}}),v=async()=>{await a.setFieldValue("upgrade_and_restart",!0),a.handleSubmit()};return t.jsxs(n.Form,{onSubmit:a.handleSubmit,noValidate:!0,children:[s&&t.jsx(n.Notification,{title:"Restart recommended",severity:"caution",children:$}),t.jsx(L,{formik:a}),t.jsx(P,{formik:a}),t.jsxs("div",{className:"form-buttons",children:[t.jsx(n.Button,{type:"button",appearance:"base",onClick:r,children:"Cancel"}),s&&o&&t.jsx(n.ConfirmationButton,{type:"button",confirmationModalProps:{title:"Upgrading kernel and restarting instance",children:t.jsx("p",{children:"Are you sure? This action will upgrade the kernel and restart the instance."}),confirmButtonLabel:"Upgrade and Restart",confirmButtonAppearance:"negative",confirmButtonLoading:g,confirmButtonDisabled:g,onConfirm:v},children:"Upgrade and Restart"}),t.jsx(n.ConfirmationButton,{type:"button",appearance:"negative",confirmationModalProps:{title:"Restarting instance",children:t.jsx("p",{children:"Are you sure? This action will restart the instance."}),confirmButtonLabel:"Restart",confirmButtonAppearance:"negative",confirmButtonLoading:p,confirmButtonDisabled:p,onConfirm:()=>{a.handleSubmit()}},children:"Restart"})]})]})};export{bt as default};
