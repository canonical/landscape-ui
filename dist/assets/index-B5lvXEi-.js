import{j as t,r as x,G as P,z as w,am as q,d as h,e as z,I as k,B as H,y as K,x as C}from"./index-Dfc97QGW.js";import{S as V}from"./SidePanelFormButtons-BdOP5SSP.js";import{u as Y}from"./index-S_kjB96R.js";import{a as A}from"./useUsns-DqfdHX4t.js";import{D as G}from"./downshift.esm-DGSOz4JI.js";import"./SidePanelFormButtons.module-CcPyiogC.js";import"./NoData-DMN9LLPq.js";import"./ResponsiveTable-ViIMTRR6.js";import"./TablePagination-B0v8QAQr.js";import"./TableFilterChips-DXWGZ6VK.js";import"./useFetchOld-BgGVMMmJ.js";import"./PageParamFilter-C5PJgjVf.js";import"./TableFilter-BmLRyeMD.js";import"./formikErrors-Bw8iTXYS.js";import"./constants-BTpoIHxf.js";import"./InstancesPageActions-Dns4Yse-.js";import"./ListTitle-DsIgCqjQ.js";import"./StaticLink-BNg3qc2M.js";import"./TruncatedCell-Cf7_euhM.js";import"./Truncated-D8EZCoK1.js";import"./useExpandableRow-DYtdXwcw.js";import"./index-DiSNWm9B.js";import"./TextConfirmationModal-O9rtHEfo.js";import"./InfoGrid-CrJbMYy5.js";import"./InfoItem-DImpX37B.js";const M=200,J=(s,l)=>{const a=s.toLowerCase(),i=l.toLowerCase(),n=a.indexOf(i);return n>=0?t.jsxs(t.Fragment,{children:[s.substring(0,n),t.jsx("strong",{children:s.substring(n,n+l.length)}),s.substring(n+l.length)]}):s},W="_container_1orjt_1",X="_suggestionsContainer_1orjt_5",Z="_pointer_1orjt_12",ee="_highlighted_1orjt_17",te="_selectedContainer_1orjt_21",d={container:W,suggestionsContainer:X,pointer:Z,highlighted:ee,selectedContainer:te},se=({selectedItems:s,setSelectedItems:l})=>{const[a,i]=x.useState(""),[n,r]=x.useState(!1),[c,m]=x.useState(""),{instanceId:b}=P(),f=w(),{getInstancePackagesQuery:_}=A(),j=Number(b),{data:S,isFetching:o}=_({instance_id:j,available:!0,installed:!1,upgrade:!1,held:!1,limit:50,search:a},{enabled:a.length>2}),p=S?.data?.results??[],B=e=>!s.map(u=>u.name).includes(e.name),N=p.filter(B),$=e=>{l(s.filter(u=>u.name!==e))},E=()=>{r(!1)},y=()=>{m(""),i("")},I=()=>{c.length>2?r(!0):r(!1)},T=e=>{m(e),e.length>2&&i(e)},F=q(()=>{try{I()}catch(e){f(e)}},M),O=e=>{l([...s,e]),y()},L=e=>{e&&(O(e),r(!1))},R=e=>{e.key==="Escape"?e.currentTarget.blur():F()},v=!n&&c.length<3?"Min 3. characters":p.length===0&&a&&!o?`No packages found by "${a}"`:null;return t.jsxs("div",{className:d.container,children:[t.jsx(G,{onSelect:L,itemToString:()=>"",isOpen:n,children:({getInputProps:e,getItemProps:u,getMenuProps:Q,highlightedIndex:U})=>t.jsxs("div",{className:"p-autocomplete",children:[t.jsx(h.SearchBox,{...e(),placeholder:"Search for available packages",className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:c,onChange:T,onClear:y,onBlur:E,onFocus:I,onKeyUp:R}),v?t.jsx("span",{className:"p-form-help-text",children:v}):null,n&&(N.length>0||o)?t.jsx("ul",{className:k("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",d.suggestionsContainer),...Q(),children:o?t.jsx(z,{}):N.map((g,D)=>t.jsxs("li",{className:k("p-list__item",d.pointer,{[d.highlighted]:U===D}),...u({item:g,index:D}),children:[t.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:J(g.name,a)}),t.jsx("div",{children:t.jsx("small",{className:"u-text-muted",children:g.available_version})})]},g.name))}):null]})}),t.jsx("ul",{className:"p-list p-autocomplete__result-list u-no-margin--bottom",children:s.length?s.map(e=>t.jsxs("li",{className:k("p-autocomplete__result p-list__item p-card u-no-margin--bottom",d.selectedContainer),children:[t.jsxs("div",{children:[t.jsx("div",{children:e.name}),t.jsx("small",{className:"u-text--muted p-text--small",children:e.available_version})]}),t.jsx(h.Button,{type:"button",appearance:"link",className:"u-no-margin--bottom","aria-label":`Delete ${e.name}`,onClick:()=>{$(e.name)},children:t.jsx(h.Icon,{name:h.ICONS.delete})})]},e.name)):null})]})},Pe=()=>{const[s,l]=x.useState([]),{instanceId:a,childInstanceId:i}=P(),n=w(),{notify:r}=H(),{packagesActionQuery:c}=A(),{closeSidePanel:m}=K(),{openActivityDetails:b}=Y(),f=Number(i??a),{mutateAsync:_,isPending:j}=c,S=async()=>{try{const{data:o}=await _({action:"install",computer_ids:[f],package_ids:s.map(({id:p})=>p)});m(),r.success({title:`You queued ${C(s.length,`package ${s[0]?.name??""}`,`${s.length} packages`)} to be installed.`,message:`${C(s.length,`${s[0]?.name??""} package`,`${s.length} selected packages`)} will be installed and ${C(s.length,"is","are")} queued in Activities.`,actions:[{label:"Details",onClick:()=>{b(o)}}]})}catch(o){n(o)}};return t.jsxs(t.Fragment,{children:[t.jsx(se,{selectedItems:s,setSelectedItems:o=>{l(o)}}),t.jsx(V,{submitButtonDisabled:j||s.length===0,submitButtonText:"Install packages",submitButtonAppearance:"positive",onSubmit:S})]})};export{Pe as default};
