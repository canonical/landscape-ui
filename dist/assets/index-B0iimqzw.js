import{c as C,C as S,p as f,n as T,l as k,j as e,d as i,y as q,x as p,I as w}from"./index-Dfc97QGW.js";import{S as D}from"./SidePanelFormButtons-BdOP5SSP.js";import{u as B}from"./useFetchOld-BgGVMMmJ.js";import{g as L}from"./formikErrors-Bw8iTXYS.js";import"./SidePanelFormButtons.module-CcPyiogC.js";function U(){const t=B();return{getCsvComplianceData:(n={},s={})=>C({queryKey:["csvComplianceData",n],queryFn:async()=>t.get("GetCSVComplianceData",{params:n}),...s}),getInstancesNotUpgraded:(n={},s={})=>C({queryKey:["instancesNotUpgraded",n],queryFn:async()=>t.get("GetComputersNotUpgraded",{params:n}),...s}),getNotPingingInstances:(n,s={})=>C({queryKey:["notPingingInstances",n],queryFn:async()=>t.get("GetNotPingingComputers",{params:n}),...s}),getUsnTimeToFix:(n={},s={})=>C({queryKey:["usnTimeToFix",n],queryFn:async()=>t.get("GetUSNTimeToFix",{params:n}),...s}),getUpgradedInstancesByFrequency:(n={},s={})=>C({queryKey:["upgradedInstancesByFrequency",n],queryFn:async()=>t.get("GetUpgradedComputersByFrequency",{params:n}),...s})}}const O="_rangeContainer_1omsg_1",V={rangeContainer:O},I=(t,r)=>{const c=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(c),o=document.createElement("a");o.href=a,o.download=r,document.body.appendChild(o),o.click(),document.body.removeChild(o)},P=({instanceIds:t})=>{const{getCsvComplianceData:r}=U(),{data:c}=r({query:`id:${t.join(" OR id:")}`}),a=S({initialValues:{range:0,reportByCve:!0},validationSchema:f({range:k().required("This field is required"),reportByCve:T()}),onSubmit:()=>{I(c?.data||"","report.csv")}});return e.jsxs(i.Form,{onSubmit:a.handleSubmit,noValidate:!0,children:[e.jsx(i.CheckboxInput,{label:"Report by CVE",inline:!0,...a.getFieldProps("reportByCve"),checked:a.values.reportByCve}),e.jsxs("div",{className:V.rangeContainer,children:[e.jsx(i.Input,{type:"number",label:"Range",className:"u-no-margin--bottom",style:{maxWidth:"min-content"},...a.getFieldProps("range"),error:L(a,"range")}),e.jsx("span",{children:"Days"})]}),e.jsx(D,{submitButtonDisabled:!1,submitButtonText:"Download"})]})},z="_header_tkk7g_1",E="_lineContainer_tkk7g_8",G="_line_tkk7g_8",$={header:z,lineContainer:E,line:G},y=({currentCount:t,negativeDescription:r,positiveDescription:c,title:a,totalCount:o})=>{const d=(100*t/o).toFixed();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:$.header,children:[e.jsx("span",{children:a}),e.jsx("span",{children:`${d}%`})]}),e.jsx("div",{className:$.lineContainer,children:e.jsx("div",{className:$.line,style:{width:`${d}%`}})}),e.jsx("p",{className:"u-text--muted p-text--small",children:c}),e.jsx("p",{className:"u-text--muted p-text--small u-no-margin--bottom",children:r})]})},K="_rowContainer_w509d_7",W="_row_w509d_7",v={rowContainer:K,row:W},X=({instanceIds:t})=>{const{setSidePanelContent:r}=q(),{getNotPingingInstances:c,getInstancesNotUpgraded:a,getUsnTimeToFix:o}=U(),{data:d,isLoading:n}=c({since_minutes:5,query:`id:${t.join(" OR id:")}`}),s=d?t.length-d.data.length:0,{data:x,isLoading:_}=a({query:`id:${t.join(" OR id:")}`}),j=x?t.length-x.data.length:0,{data:h,isLoading:b}=o({query:`id:${t.join(" OR id:")}`,fixed_in_days:[2,14,30,60]}),l={month:h?.data["30"]?.length||0,old:h?.data["60"]?.length||0,pending:h?.data.pending.length||0,recent:h?.data["2"]?.length||0,twoWeeks:h?.data["14"]?.length||0},N={recent:2,twoWeeks:14,month:30,old:60},F=(u,m)=>{const g=m==="positive"?l[u]:t.length-l[u];return g!==1?`${g||"No"} instances have${m==="negative"?" not":""} applied USNs in ${N[u]} days or less.`:`1 instance has${m==="negative"?" not":""} applied USNs in ${N[u]} days or less.`},R=()=>{r("Download report as CSV",e.jsx(P,{instanceIds:t}))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:v.rowContainer,children:e.jsxs(i.Row,{className:w("u-no-padding--left u-no-padding--right",v.row),children:[e.jsx(i.Col,{size:6,children:!b&&e.jsx(y,{currentCount:t.length-l.pending,negativeDescription:`${l.pending||"No"} instance${p(l.pending," is","s are")} not yet patched.`,positiveDescription:`${t.length-l.pending||"No"} instance${p(t.length-l.pending," is","s are")} securely patched.`,title:"Securely patched",totalCount:t.length})}),e.jsx(i.Col,{size:6,children:!_&&e.jsx(y,{currentCount:j,negativeDescription:`${x?.data.length||"No"} instance${p(Number(x?.data.length)," is","s are")} not covered by upgrade profiles.`,positiveDescription:`${j||"No"} instance${p(j," is","s are")} covered by upgrade profiles.`,title:"Upgrade profiles",totalCount:t.length})}),e.jsx(i.Col,{size:6,children:!n&&e.jsx(y,{currentCount:s,negativeDescription:`${d?.data.length||"No"} instance${p(Number(d?.data.length)," has","s have")} not contacted the server within the last 5 minutes.`,positiveDescription:`${s||"No"} instance${p(s," has","s have")} contacted the server within the last 5 minutes.`,title:"Contacted",totalCount:t.length})})]})}),!b&&e.jsxs("div",{className:v.rowContainer,children:[e.jsx("h4",{children:"Security upgrades"}),e.jsx(i.Row,{className:w("u-no-padding--left u-no-padding--right",v.row),children:Object.entries(N).map(([u,m])=>{const g=u;return e.jsx(i.Col,{size:6,children:e.jsx(y,{currentCount:l[g],negativeDescription:F(g,"negative"),positiveDescription:F(g,"positive"),title:`${m} days`,totalCount:t.length})},g)})})]}),e.jsx(D,{submitButtonDisabled:!1,submitButtonText:"Download as CSV",onSubmit:R})]})};export{X as default};
