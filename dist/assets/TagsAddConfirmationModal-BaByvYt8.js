import{f as P,c as C,ad as x,r as w,x as o,j as r,d as s,ae as u,e as $,af as c}from"./index-DYykpNVa.js";import{M as _}from"./ModalTablePagination-C4fLxOQV.js";const j=(i,t)=>{const g=P(),{data:n,isFetching:d,isPending:h,refetch:l}=C({queryKey:["profileChanges",i],queryFn:async()=>g.get("tags/profile-diff",{params:i}),...t});return{isFetchingProfileChanges:d,isPendingProfileChanges:h,profileChanges:n?.data.results??[],profileChangesCount:n?.data.count??0,refetchProfileChanges:l}},y=i=>{const t={};return t["aria-label"]=`${i.original.profile.name} profile change row`,t},M=({instances:i,tags:t,...g})=>{const{count:n,decrement:d,increment:h}=x(1),{isPendingProfileChanges:l,profileChanges:p,profileChangesCount:a}=j({instance_ids:i.map(e=>e.id),tags:t,limit:c,offset:(n-1)*c}),m=w.useMemo(()=>[t.length>1?{Header:"Tag",Cell:({row:{original:e}})=>e.tag}:null,{Header:"Active profiles",Cell:({row:{original:e}})=>e.profile.name},{Header:"Profile type",Cell:({row:{original:e}})=>({ChildInstanceProfile:"WSL",PackageProfile:"Package",RebootProfile:"Reboot",RemovalProfile:"Removal",RepositoryProfile:"Repository",ScriptProfile:"Script",UpgradeProfile:"Upgrade",UsgProfile:"Security"})[e.profile.profile_type]},{Header:"Associated instances",Cell:({row:{original:e}})=>{const f=`${e.profile.current_associated_instances} ${o(e.profile.current_associated_instances,"instance")}`;return e.profile.will_exceed_limit?r.jsxs(s.Tooltip,{message:`Adding ${o(i.length,"this instance","these instances")} will exceed the instance limit.`,children:[r.jsx(s.Icon,{name:"warning"}),f]}):f},getCellIcon:({row:{original:e}})=>e.profile.will_exceed_limit?"":null}].filter(e=>e!=null),[]);return r.jsxs(s.ConfirmationModal,{title:`Add ${o(t.length,`"${t[0]}" tag`,`${t.length} tags`)} to ${u(i,e=>`"${e.title}"`,`${i.length} instances`)}`,confirmButtonLabel:"Add tags",...g,children:[r.jsx("p",{children:"Adding tags could trigger irreversible changes to your instances."}),r.jsxs("p",{children:["Adding"," ",o(t.length,`the ${t[0]} tag`,`these ${t.length} tags`)," ","to"," ",u(i,e=>`the ${e.title} instance`,`${i.length} instances`)," ","will associate the ",o(i.length,"instance")," with the following profiles."]}),r.jsx("p",{children:"Some instances might not be associated with certain profiles due to restrictions."}),l&&r.jsx($,{}),!l&&a>0&&r.jsxs(r.Fragment,{children:[r.jsx(s.ModularTable,{className:"u-no-margin--bottom",columns:m,data:p,getRowProps:y}),a>Math.ceil(a/c)&&r.jsx(_,{max:Math.ceil(a/c),current:n,onPrev:d,onNext:h})]})]})};export{M as T,j as u};
