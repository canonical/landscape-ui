import{f as M,j as e,g as Q,r as C,ap as U,d as N,e as v,I as h}from"./index-Dfc97QGW.js";import{d as Y}from"./ScriptsTabs-BSK7sb4n.js";import{u as G}from"./useInfiniteQuery-Dl6Bz4vo.js";import"./helpers-BbXQOWxJ.js";import"./index-DiSNWm9B.js";import{D as K}from"./downshift.esm-DGSOz4JI.js";const $=({search:s,limit:r,enabled:n,parentAccessGroup:i})=>{const o=M(),d=["scripts",s,i],{data:l,isPending:m,isFetchingNextPage:g,hasNextPage:f,fetchNextPage:p,error:u}=G({queryKey:d,queryFn:async({pageParam:c=0})=>o.get("scripts",{params:{search:s||void 0,script_type:"active",limit:r,offset:c*r,parent_access_group:i}}),initialPageParam:0,getNextPageParam:(c,w,x)=>{const _=x+1;if(c.data.count>_*r)return _},enabled:n});return{scripts:l?l.pages.flatMap(c=>c.data.results):[],isPending:m,isFetchingNextPage:g,hasNextPage:f,fetchNextPage:p,error:u}},z="_container_um210_1",J="_suggestionsContainer_um210_6",W="_pointer_um210_14",X="_highlighted_um210_19",Z="_selectedScript__container_um210_23",ee="_selectedScript__name_um210_30",te="_selectedScript__button_um210_35",se="_selectedScript__icon_um210_44",ne="_marginTop_um210_48",a={container:z,suggestionsContainer:J,pointer:W,highlighted:X,selectedScript__container:Z,selectedScript__name:ee,selectedScript__button:te,selectedScript__icon:se,marginTop:ne},re=200,oe=20,ce=1.25,ae=(s,r)=>{const n=s.toLowerCase(),i=r.toLowerCase(),o=n.indexOf(i);return o>=0?e.jsxs(e.Fragment,{children:[s.substring(0,o),e.jsx("strong",{children:s.substring(o,o+r.length)}),s.substring(o+r.length)]}):s},he=({script:s,setScript:r,existingScriptId:n,errorMessage:i,parentAccessGroup:o})=>{const{value:d,setTrue:l,setFalse:m}=Q(!1),[g,f]=C.useState(""),[p,u]=U("",re),j=C.useRef(null),{script:c,isScriptLoading:w}=Y(n||0,{enabled:!!n});C.useEffect(()=>{n&&s?.id!==c?.id&&r(c)},[c]);const{scripts:x,isPending:_,isFetchingNextPage:E,hasNextPage:O,fetchNextPage:L,error:D}=$({search:p,limit:oe,enabled:d||p.length>0,parentAccessGroup:o});if(D)throw D;const q=t=>s?.id!==t.id,F=x.filter(q),A=()=>{r(null)},y=(t=!0)=>{f(""),u.cancel(),u(""),t&&l()},H=()=>{l()},I=t=>{if(f(t),!t){u.cancel(),u(""),l();return}u(t),l()},V=t=>{t&&(r(t),m(),y(!1),j.current?.blur())},k=t=>{const{scrollTop:b,scrollHeight:P,clientHeight:T}=t.currentTarget;P-b<=T*ce&&O&&!E&&L()},B=x.length===0&&p&&!_?`No scripts found by "${p}"`:n?"Scripts can't be replaced after the profile has been created.":null;return e.jsxs("div",{className:h(a.container,"p-form__group p-form-validation"),children:[e.jsx("label",{className:"is-required p-form__label",htmlFor:n?"script-selected":"script-search",children:"Script"}),!n&&e.jsx(K,{onSelect:V,itemToString:t=>t?t.title:"",isOpen:d,onOuterClick:m,children:({getInputProps:t,getItemProps:b,getMenuProps:P,highlightedIndex:T})=>e.jsxs("div",{className:"p-autocomplete",children:[e.jsx(N.SearchBox,{...t(),id:n?void 0:"script-search",placeholder:"Search for scripts",required:!0,className:"u-no-margin--bottom",shouldRefocusAfterReset:!0,externallyControlled:!0,autocomplete:"off",value:g,ref:j,onChange:I,onClear:y,onBlur:m,onFocus:H}),B?e.jsx("span",{className:"p-form-help-text",children:B}):null,i&&!d?e.jsx("div",{className:"is-error",children:e.jsx("span",{className:"p-form-validation__message",id:"script-error",children:e.jsx("span",{children:i})})}):null,d&&(F.length>0||_)?e.jsx("ul",{className:h("p-list p-card--highlighted u-no-padding u-no-margin--bottom p-autocomplete__suggestions",a.suggestionsContainer),...P(),onScroll:k,children:_?e.jsx(v,{}):e.jsxs(e.Fragment,{children:[F.map((S,R)=>e.jsx("li",{className:h("p-list__item",a.pointer,{[a.highlighted]:T===R}),...b({item:S,index:R}),children:e.jsx("div",{className:"u-truncate","data-testid":"dropdownElement",children:ae(S.title,g)})},S.id)),E&&e.jsx("li",{className:"p-list__item u-align--center",children:e.jsx(v,{})})]})}):null]})}),w?e.jsx(v,{}):null,s&&e.jsxs("div",{id:"script-selected",className:h("p-autocomplete__result p-list__item p-card u-no-margin--bottom",a.selectedScript__container,{[a.marginTop]:!n}),children:[e.jsx("span",{className:a.selectedScript__name,children:e.jsx("b",{children:s.title})}),n?null:e.jsx(N.Button,{type:"button",title:"Remove",appearance:"base",className:h(a.selectedScript__button,"u-no-margin--bottom u-no-margin--right"),onClick:A,children:e.jsx(N.Icon,{name:N.ICONS.delete,className:a.selectedScript__icon})})]},s.id)]})};export{he as S,$ as u};
